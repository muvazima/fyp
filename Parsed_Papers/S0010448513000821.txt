@&#MAIN-TITLE@&#Functionally heterogeneous porous scaffold design for tissue engineering

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Functionally gradient porous scaffolds are designed for tissue engineering.


                        
                        
                           
                           An optimum deposition angle has been determined for multi-functional regions.


                        
                        
                           
                           The proposed methodology designs scaffolds with gradient porosity.


                        
                        
                           
                           Provides more control over the desired porosity level.


                        
                        
                           
                           The designed heterogeneous scaffolds are fabricated with a bio-additive process.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Functionally gradient porous structures

Scaffold architecture

Deposition direction

Tissue engineering

@&#ABSTRACT@&#


               
               
                  Porous scaffolds with interconnected and continuous pores have recently been considered as one of the most successful tissue engineering strategies. In the literature, it has been concluded that properly interconnected and continuous pores with their spatial distribution could contribute to perform diverse mechanical, biological and chemical functions of a scaffold. Thus, there has been a need for reproducible and fabricatable scaffold design with controllable and functional gradient porosity. Improvements in Additive Manufacturing (AM) processes for tissue engineering and their design methodologies have enabled the development of controlled and interconnected scaffold structures. However homogeneous scaffolds with uniform porosity do not capture the intricate spatial internal micro architecture of the replaced tissue and thus are not capable of capturing the design. In this work, a novel heterogeneous scaffold modeling is proposed for layered-based additive manufacturing processes. First, layers are generated along the optimum build direction considering the heterogeneous micro structure of tissue. Each layer is divided into functional regions based on the spatial homogeneity factor. An area weight based method is developed to generate the spatial porosity function that determines the deposition pattern for the desired gradient porosity. To design a multi-functional scaffold, an optimum deposition angle is determined at each layer by minimizing the heterogeneity along the deposition path. The proposed methodology is implemented and illustrative examples are also provided. The effective porosity is compared between the proposed design and the conventional uniform porous scaffold design. Sample designed structures have also been fabricated with a novel micro-nozzle biomaterial deposition system. The result has shown that the proposed methodology generates scaffolds with functionally gradient porosity.
               
            

@&#INTRODUCTION@&#

Reconstructing or repairing tissues with porous structures or scaffolds to restore its mechanical, biological and chemical functions is one of the major tissue engineering strategies. The intended use of such porous structures is to stimulate the tissue regeneration processes while minimally upsetting the delicate equilibrium of the local environment and the patient’s biology. Even though biocompatibility of such structures is crucial, but the structure itself must facilitate to some significant  [1–4] but conflicting  [5,6] functions such as the structural integrity, cell migration, proliferation, waste removal, and vascularization.These criteria could be achieved by designing the scaffold with factors such as pore size, total porosity, pore shape and pore interconnectivity  [7,8]. Clearly, fulfilling all of these criteria by a natural or synthesized scaffold design is yet to be achieved  [5]. Considering the micro architecture, type, and size of the damaged tissue that are differentiated by age and mobility of patients, the demand for individualized scaffold structure is imminent.

Bone tissue has a varied arrangement of its micro architecture in concert to perform diverse mechanical, biological and chemical functions. The bone’s micro structure varies considerably making the bone architecture highly anisotropic in nature  [9]. Researchers  [10] have invested in the scaffold design concept via inversing the morphological structure to achieve the desired and choreographed multi-functionality. Bone tissue can be considered as a hierarchical material whose mechanical properties can vary considerably and does not depend upon its density alone  [11]. Anisotropic mechanical properties of bone, caused by the difference in the micro structure, have been reported in  [12]. Both cortical and cancellous bone segments have different structural forms with distinct characteristics. Moreover, within cancellous bone there exists a complex relationship  [13] between trabecular density and its structural mechanical integrity which makes the bone spatially heterogeneous. Thus, achieving the optimum scaffold design by only copying the bone morphology may not capture the regional heterogeneity in bone’s spatial extrinsic and intrinsic properties. Such a complex design requires significant amount of computational resources and might become limited in terms of the fabrication.

Bone structures adapt its strength via remodeling  [14] in response to the anisotropic load distribution along multiple directions. This physiological multi-axial load transfer phenomenon through the bone supports its spatial and regional heterogeneous structural properties  [15,16]. But such imminent factors are not considered in most of design considerations and simplified through ‘homogeneous/average property’ methods to determine the overall structural properties. Thus, designing the scaffold with homogenization of property and/or material distribution might not be the proper functional representation.

Another scaffold design approach considers a biodegradable structure for which the degradation of the scaffold material and new tissue formation is expected to occur simultaneously  [17]. However, a scaffold matrix capable to remain viable from its implantation to the end of the healing phase and finally fully absorbed is yet to be achieved. Toward development of an ideal carrier system for bone tissue engineering, researchers are mainly aiming at material types and properties, their processing conditions and biological compatibility  [18,19]. Even though the internal architecture of the implant or structure may have significant influence on the cellular microenvironment, few researches have focused on the design of internal architecture of the porous structure and even fewer have tried to optimize its geometry. Moreover, the desired choreographed multi-functionality of such a structure may only be achieved with optimally designed carriers that may deliver growth factors spatially  [6,17]. Thus, the need for a reproducible and fabricatable structure design with controllable gradient porosity is obvious but possibly limited by design and fabrication methods [5,20,21].

Lal and Sun  [22] proposed the microsphere-packed scaffold modeling technique where the porosity is stochastically distributed throughout the structure. The achievable porosity range can be controlled with the size and number of microspheres and their packing conditions. In their other work  [23], a heuristic based porous structure modeling has been developed using the constructive solid geometry (CSG) based approach and combining the Boolean function in a stochastic manner. Porous objects with a nested cellular structure have been proposed in the literature [24,25] which may introduce the gradient porosity along the architecture with the function based  [26] geometry and topology variation  [27]. A functionally graded scaffold (FGS)  [28–31] modeling technique has been proposed to replicate the stiffness gradient and porosity of the native tissue with a concentric unit cell selected from their pre-defined library. Pandithevan and Saravana Kumar  [32] proposed space-filling fractal curves to control the porosity in the scaffold. A three dimensional porous structure modeling technique has been proposed with layer based 2D Voronoi tessellation  [33] which ensures the interconnected pore networks. In another work  [34], geometric modeling of functionally graded material (FGM) has been presented with graded micro structures. The gradient porosity in the FGM has been achieved with stochastically distributed voronoi cells. Holdstein et al.  [35] proposed a reverse engineering technique to generate the porous bone structure model with the volumetric texture synthesis method. The method captures the stochastic and porous nature of the bone micro structure into the reconstructed scaffold model. The approaches for modeling of porosity with stochastic processes could generate uncontrollable porosity. Limited control in spatial porosity may be achievable for some methods, but this may sacrifice the true 3D porous characteristics as the interconnectivity and continuity among pores become uncertain. Moreover, the gradient porosity in these works has been achieved either arbitrarily or with axisymmetric uniform region discretization, which might not represent the appropriate functional and regional heterogeneity, and their fabrication could be difficult.

Traditional scaffold fabrication processes are mainly driven by chemical processes. With these techniques, it is often difficult to produce functional structures with pre-defined morphology. Moreover controllable uniformity, repeatability and/or distribution of material and internal architecture are extremely difficult to achieve in such techniques. Micro-fabrication and bio-additive systems have become an attractive tool for developing tissue-engineering scaffolds because of the improved spatial resolutions  [7,36]. Especially the development of Additive Manufacturing (AM) techniques and the improvement in biomaterial’s properties by synergy provides the leverage of using AM techniques to fabricate controlled and interconnected porous structures. As a result, AM techniques are considered to be a viable alternative for achieving extensive and detailed control over the scaffold architecture. A number of researchers have successfully used various AM techniques along with a wide range of biomaterials to fabricate the scaffolds. A comprehensive review on AM can be found in the literature  [37–39]. Some of the fabricated scaffold structures with AM processes are homogeneous in nature and with uniform porosity. However, homogeneous structures do not capture the intricate spatial extrinsic and intrinsic properties presented in tissue’s internal architecture and are not capable of capturing the design  [5,40]. In recent work  [25,26], functionally gradient scaffolds are successfully fabricated with the Selective Laser Sintering (SLS) process. In this paper, the developed methodologies could be used by any bio-additive process. However, the presented methods are most suitable for bio-deposition based processes where a continuous filament of heterogeneous biomaterial needs to be deposited continuously. These bio-deposition based processes require a continuous path planning during the formation of the micro-porous structures.

From the above discussion, it is clear that a true multi-functional scaffold structure design must perform the expected mechanical, biological and chemical functions. But such a design may not be achievable only by homogeneous scaffold structure with uniform porosity. Gradient porosity along the internal architecture could provide both the extrinsic and intrinsic properties. The optimally designed scaffold with such variational porosity could perform the diverse functionality expected by the scaffold  [20]. Thus, achieving controllable, continuous, and interconnected gradient porosity with reproducible and fabricatable design may lead a successful tissue engineering approach. In this work, a novel layer-based heterogeneous porous structure modeling is proposed to achieve the gradient porosity design. Firstly, an optimum build direction is identified to generate the layers considering the internal feature. An optimum filament deposition direction is determined for layers, which minimizes the contour heterogeneity considering the internal heterogeneous region and their locations. The internal region is discretized based on strips’ spatial homogeneity factor along the optimum deposition angle. Finally, an area weight based approach is used to generate the spatial porosity function for each strip. The generated function then determines the filament deposition location for the desired heterogeneous porosity. The proposed method generates a heterogeneous structure by achieving the controllable porosity to capture the functional and regional heterogeneity along the structure. The road map of our modeling and optimization methodology for filament deposition-path planning is shown as in Fig. 1
                     .

The rest of the paper is organized as follows. Section  2 presents the novel variational porous scaffold modeling with controllable porosity. In Section  2.1, we discussed the geometric model extraction for the defected bone segment. The effect of build direction is quantified in Section  2.2. Sections  2.3 and 2.4 describe the layer generation methodology along with the internal feature suitable for the AM technique. Section  2.5 describes the contour discretization and determination of the optimum deposition angle. Section  2.6 presents the spatial function for an optimum filament location to achieve desired porosity. The presented methodology is evaluated in Section  2.7. Section  3 describes the micro-nozzle based biomaterial deposition technique used for the fabrication. The proposed methodology is implemented along with fabricated samples have been shown in Section  4. And finally, we present the summary in Section  5.

@&#METHODOLOGY@&#

Firstly, medical image obtained from non-invasive techniques, such as Computed Tomography (CT), Magnetic Resonance Imaging (MRI), is used to obtain the geometric and topology information of the defected or diseased tissue. The initial geometric information of the model could be represented as a mesh or Stereolithography (STL) model. The STL files are generated by tessellating the outside surface of the 3D volume with triangles. In this paper, bone tissue is chosen as a model. However, the proposed methods can easily be extended for other tissues.

The micro structures of tissues are not uniform or homogeneous, which provide multiple functionality of tissue. For instance, the heterogeneous micro structure of bone provides its multi-functionality, i.e., mechanical, biological and chemical functions simultaneously. Such regional heterogeneity in bone could be consolidated into combination of internal homogeneous features. The geometric significance (i.e. the location, size and shape) of such internal extrinsic features or the heterogeneity of the defected bone segment can be obtained by analyzing the MRI or CT image for bone mineral density  [35,41], bone texture analysis via micro-beam X-ray radiation  [42] or feature recognition algorithms  [11,14]. Spatial/heterogeneous porosity in the bone structure with clear contrast of regional porosity by analyzing the real human bone structure has been reported in the literature  [43,44]. Fig. 2
                        (a) shows an example of the porosity distribution in an imaged proximal femur  [43]. These spatially distributed 3D features might represent uniform properties and their combination could capture the anisotropy in bone’s structure. The accuracy of such representation for bone anisotropy might be a subject of proper data evaluation algorithms and beyond the scope of this paper.

The heterogeneous structure of defected bone segment or targeted region could be represented by any of the method from the literature discussed above. The heterogeneous structure of the interested tissue could have a set of iso-property regions to represent the heterogeneous property of the tissue, which may not be axisymmetric or uniform in shape as show in Fig. 2(b), (c). The corresponding property for each iso-region can also be interpreted as a uniform property or iso-porosity regions and thus the term iso-porosity and iso-property have been used alternatively in this paper. Moreover, any segment or region containing more than one iso-property region is referred as the heterogeneous region in this paper.

In this paper, the designed scaffold is developed for bio-additive manufacturing processes, which fabricates the designed scaffolds layer-by-layer. Therefore, the captured geometry and heterogeneous structure of the damaged tissue need to be sliced and the layers need to be formed. Because of the regional heterogeneity as shown in Fig. 2, the generated slices could have multiple inner contour(s) of the internal feature(s) as shown in Fig. 3
                        .

As shown in Figs. 3 and 4
                        , selecting the arbitrary slicing plane angle or build direction could generate most of the slices as heterogeneous. However, carefully determined building direction can reduce the number of heterogeneous slices significantly as shown in Fig. 4. Changing the build direction may also change the heterogeneity of the slice itself i.e., number of internal feature in the slice could vary by changing the build direction. As shown in Fig. 4, the number of heterogeneous slice with the angular build direction is minimal, but all of them contain multiple contours which can be defined as higher heterogeneity factor. Thus, counting the generated heterogeneous slice may not ensure the optimum build direction as the heterogeneity factor needs to be accounted as well. In this section, the effect of build direction on the heterogeneity of the generated slices is quantified and an optimization algorithm is proposed considering the homogeneous volume and heterogeneity in each slice.

Any build direction can be defined as a 3D vector 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                              =
                              
                                 [
                                 
                                    
                                       b
                                    
                                    
                                       x
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       y
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       z
                                    
                                 
                                 ]
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    3
                                 
                              
                              
                              ∀
                              b
                              =
                              0
                              …
                              B
                            by rotating the standard coordinate system along any two axis. The equation for the transformed coordinate system in 3D Euclidean space can be defined by the following equation: 
                              
                                 (1)
                                 
                                    
                                       [
                                       
                                          
                                             T
                                          
                                          
                                             b
                                          
                                       
                                       ]
                                    
                                    =
                                    
                                       
                                          
                                             Rot
                                          
                                       
                                       
                                          Z
                                       
                                    
                                    
                                    
                                       (
                                       α
                                       )
                                    
                                    ⋅
                                    
                                       
                                          
                                             Rot
                                          
                                       
                                       
                                          y
                                       
                                    
                                    
                                       (
                                       β
                                       )
                                    
                                    
                                    α
                                      and  
                                    β
                                    ∈
                                    
                                       {
                                       0
                                       …
                                       π
                                       }
                                    
                                    .
                                 
                              
                           
                        

Here, 
                              
                                 [
                                 
                                    
                                       T
                                    
                                    
                                       b
                                    
                                 
                                 ]
                              
                            represent the transformation matrix for build direction 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                            where 
                              b
                            is defined by angle 
                              α
                            and 
                              β
                           ; 
                              
                                 
                                    
                                       Rot
                                    
                                 
                                 
                                    z
                                 
                              
                              
                                 (
                                 α
                                 )
                              
                            and 
                              
                                 
                                    
                                       Rot
                                    
                                 
                                 
                                    y
                                 
                              
                              
                                 (
                                 β
                                 )
                              
                            represent the rotation along the 
                              z
                           - and 
                              y
                           -axis with an angle of 
                              α
                            and 
                              β
                            respectively. The heterogeneous volume can be discretized with a set of intersecting parallel planes perpendicular to the build direction 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                           . The intersection plane is constructed with the remaining two transformed axis other than the build direction 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                           . The volume between consecutive planes, which is defined as strip volume, is analyzed for heterogeneity. The overall effect is quantified by multiplying the heterogeneity factor with the corresponding volume. To increase the computational efficiency, a transformed bounding box technique is developed.

A rectilinear bounding box is generated for all features with respect to the transformed coordinate system and the corner points are determined with the axis value set, 
                              C
                              
                                 
                                    P
                                 
                                 
                                    b
                                 
                              
                              =
                              
                                 {
                                 
                                    
                                       x
                                    
                                    
                                       b
                                       ,
                                       min
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       b
                                       ,
                                       max
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       b
                                       ,
                                       min
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       b
                                       ,
                                       max
                                    
                                 
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       b
                                       ,
                                       min
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       z
                                    
                                    
                                       b
                                       ,
                                       max
                                    
                                 
                                 }
                              
                              
                              ∀
                              b
                            which are aligned with the corresponding coordinate system as shown in Fig. 5
                           .

In Fig. 5, 
                              
                                 
                                    z
                                 
                                 
                                    b
                                 
                              
                            is considered as the build direction, and thus, the cutting planes are generated by extending the two bounding planes which are parallel to the 
                              
                                 
                                    x
                                 
                                 
                                    b
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    b
                                 
                              
                            plane up to the external bounding planes. Using this method, a set of intersecting planes 
                              
                                 
                                    P
                                 
                                 
                                    h
                                    ,
                                    b
                                 
                              
                              =
                              
                                 
                                    
                                       {
                                       
                                          
                                             P
                                          
                                          
                                             h
                                             ,
                                             b
                                          
                                       
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             3
                                          
                                       
                                       }
                                    
                                 
                                 
                                    h
                                    =
                                    0
                                    …
                                    
                                       
                                          N
                                       
                                       
                                          b
                                       
                                    
                                    ;
                                    
                                    b
                                    =
                                    0
                                    …
                                    B
                                 
                              
                            are constructed along the build direction 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                            from all internal features where 
                              
                                 
                                    P
                                 
                                 
                                    n
                                    ,
                                    b
                                 
                              
                            represents the 
                              h
                           th intersecting plane for the 
                              b
                           th build direction and 
                              
                                 
                                    N
                                 
                                 
                                    b
                                 
                              
                            is the number of intersecting planes for 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                           . Because of the changing alignments with the build direction, the number of intersecting planes may not be the same. By using the intersecting planes as cutting planes, a set of strip volumes, 
                              S
                              
                                 
                                    V
                                 
                                 
                                    h
                                    ,
                                    b
                                 
                              
                              =
                              
                                 
                                    
                                       {
                                       s
                                       
                                          
                                             v
                                          
                                          
                                             h
                                             ,
                                             b
                                          
                                       
                                       }
                                    
                                 
                                 
                                    h
                                    =
                                    0
                                    …
                                    
                                       (
                                       
                                          
                                             N
                                          
                                          
                                             b
                                          
                                       
                                       +
                                       1
                                       )
                                    
                                    ;
                                    b
                                    =
                                    0
                                    …
                                    B
                                 
                              
                           , are generated along the build direction 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                            as shown in Fig. 6
                           , where 
                              s
                              
                                 
                                    v
                                 
                                 
                                    h
                                    ,
                                    b
                                 
                              
                            represent the 
                              h
                           th strip volume of 
                              b
                           th build direction.

The generated set of strip volumes are constructed based on the number of internal features and can be differentiated as homogeneous (single/external feature) and/or heterogeneous (multiple features) as shown in Fig. 6. Other than the number of features, the variation in the extrinsic property (i.e. porosity) also contributes to the heterogeneity of the strip volumes. The build direction 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                            is quantified by analyzing each strip volume 
                              s
                              
                                 
                                    v
                                 
                                 
                                    h
                                    ,
                                    b
                                 
                              
                            and adding corresponding weight using their heterogeneity:
                              
                                 (2)
                                 
                                    
                                       
                                          Weight
                                       
                                       _
                                       
                                          
                                             
                                                
                                                   D
                                                
                                                →
                                             
                                          
                                          
                                             b
                                          
                                       
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             h
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   b
                                                
                                             
                                          
                                       
                                       
                                          (
                                          w
                                          t
                                          _
                                          E
                                          
                                             
                                                F
                                             
                                             
                                                h
                                             
                                          
                                          +
                                          w
                                          t
                                          _
                                          F
                                          
                                             
                                                E
                                             
                                             
                                                h
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       w
                                       t
                                       _
                                       E
                                       
                                          
                                             F
                                          
                                          
                                             h
                                          
                                       
                                       =
                                       
                                          (
                                          1
                                          −
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      v
                                                      =
                                                      1
                                                   
                                                   
                                                      V
                                                   
                                                
                                                
                                                   (
                                                   
                                                      vol
                                                   
                                                   _
                                                   f
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         v
                                                         ,
                                                         h
                                                      
                                                   
                                                   ×
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         v
                                                         ,
                                                         h
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   vol
                                                
                                                _
                                                s
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      h
                                                   
                                                
                                             
                                          
                                          )
                                       
                                       
                                          (
                                          
                                             avg
                                          
                                          _
                                          F
                                          
                                             
                                                
                                                   Por
                                                
                                             
                                             
                                                h
                                             
                                          
                                          −
                                          
                                             EFPor
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       w
                                       t
                                       _
                                       F
                                       
                                          
                                             E
                                          
                                          
                                             h
                                          
                                       
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             v
                                             =
                                             1
                                          
                                          
                                             V
                                          
                                       
                                       
                                          (
                                          
                                             (
                                             
                                                (
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            vol
                                                         
                                                         _
                                                         f
                                                         
                                                            
                                                               e
                                                            
                                                            
                                                               v
                                                               ,
                                                               h
                                                            
                                                         
                                                         ×
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               v
                                                               ,
                                                               h
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         vol
                                                      
                                                      _
                                                      s
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            h
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                             
                                                (
                                                V
                                                −
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      v
                                                      =
                                                      1
                                                   
                                                   
                                                      V
                                                   
                                                
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      v
                                                      ,
                                                      h
                                                   
                                                
                                                )
                                             
                                             )
                                          
                                          ×
                                          
                                             (
                                             
                                                avg
                                             
                                             _
                                             F
                                             
                                                
                                                   
                                                      Por
                                                   
                                                
                                                
                                                   h
                                                
                                             
                                             −
                                             F
                                             
                                                
                                                   
                                                      Por
                                                   
                                                
                                                
                                                   v
                                                
                                             
                                             )
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             v
                                             ,
                                             h
                                          
                                       
                                       =
                                       
                                          {
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   
                                                   if any segment of  
                                                   v
                                                   th feature is located in
                                                
                                             
                                             
                                                
                                                   h
                                                   th strip volume .
                                                
                                             
                                             
                                                
                                                   0
                                                   ,
                                                   
                                                   Otherwise .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Here, 
                              
                                 Weight
                              
                              _
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                            is the total strip weight at build direction 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                              
                           ; 
                              w
                              t
                              _
                              E
                              
                                 
                                    F
                                 
                                 
                                    h
                                 
                              
                            and 
                              w
                              t
                              _
                              F
                              
                                 
                                    E
                                 
                                 
                                    h
                                 
                              
                            represent the corresponding weight from external and internal features; 
                              
                                 vol
                              
                              _
                              s
                              
                                 
                                    v
                                 
                                 
                                    h
                                 
                              
                            is the volume for the 
                              h
                           th strip; 
                              
                                 vol
                              
                              _
                              f
                              
                                 
                                    e
                                 
                                 
                                    v
                                    ,
                                    h
                                 
                              
                            is the volume of the 
                              v
                           th internal feature segment located in the 
                              h
                           th strip; 
                              
                                 
                                    x
                                 
                                 
                                    v
                                    ,
                                    h
                                 
                              
                            is a binary variable which determines if 
                              v
                           th internal feature is located in the 
                              h
                           th strip; and 
                              
                                 avg
                              
                              _
                              F
                              
                                 
                                    
                                       Por
                                    
                                 
                                 
                                    h
                                 
                              
                            is the volume weighted porosity for the 
                              h
                           th strip. As obvious from Eq. (2), the weight is zero for the homogeneous strip volume. Thus, a build direction that generates minimum weight 
                              min
                              
                              
                                 (
                                 
                                    Weight
                                 
                                 _
                                 
                                    
                                       
                                          
                                             D
                                          
                                          →
                                       
                                    
                                    
                                       b
                                    
                                 
                                 )
                              
                              
                              ∀
                              b
                            is chosen as the optimum build direction, 
                              
                                 
                                    
                                       
                                          D
                                       
                                       →
                                    
                                 
                                 
                                    b
                                 
                                 
                                    ∗
                                 
                              
                           .

The reconstructed heterogeneous volume with the internal features (generated from Section  2.1) is sliced along the optimum build direction (described in Section  2.2) for bio-additive manufacturing processes. By connecting the intersection points between the slicing plane and the surfaces would generate non-self-intersecting, closed and planar contours. The distance between the slicing planes can be constant in uniform slicing which is usually the diameter of the deposited filament of the bio-additive manufacturing process. To generate spatially porous structures, two opposing bi-layers are used to control the porosity as shown in Fig. 7
                        (a–b). A bi-layer set, consists of two consecutive slices/layers 
                           k
                        th and 
                           
                              (
                              k
                              +
                              1
                              )
                           
                        th, is defined as the unit for the proposed methodology. To discretize the 3D space, each layer can only be part of one bi-layer set. Fig. 7(c–d) shows the sample layers with internal iso-porosity region contours. By stacking bi-layers consecutively in the building direction will generate the 3D porous scaffold structure with an optimum filament location in every layer.

It is assumed that the outer contour 
                           
                              
                                 s
                              
                              
                                 k
                              
                           
                         contains all the iso-porosity contour curves 
                           
                              
                                 C
                              
                              
                                 k
                              
                           
                           =
                           
                              {
                              
                                 
                                    c
                                 
                                 
                                    k
                                 
                                 
                                    1
                                 
                              
                              …
                              
                                 
                                    c
                                 
                                 
                                    k
                                 
                                 
                                    m
                                 
                              
                              }
                           
                         inside, where 
                           m
                         is the number of iso-porosity contours in the 
                           k
                        th slice. A set of iso-porosity contour curves embedded in the outer slice contour represents each layer with a set of contours 
                           C
                           =
                           
                              {
                              
                                 
                                    C
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    C
                                 
                                 
                                    k
                                 
                              
                              }
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    }
                                 
                              
                              
                                 i
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 m
                              
                           
                        . Each contour is assigned with a desired porosity defined by 
                           
                              
                                 
                                    Por
                                 
                              
                              
                                 i
                              
                           
                         which represent the porosity of 
                           i
                        th contour. All contour curves are assumed to be a simple planar closed curve, i.e. a planar curve does not intersect itself other than its start and end points and have the same (positive) orientation. The general equation for these contours can be parametrically represented as 
                           
                              (3)
                              
                                 
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             u
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       (
                                       x
                                       
                                          (
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       ,
                                       y
                                       
                                          (
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    
                                    ∀
                                    i
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    m
                                 
                              
                              
                                 
                                    
                                       
                                          u
                                       
                                       
                                          i
                                       
                                    
                                    ∈
                                    
                                       [
                                       
                                          
                                             a
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             b
                                          
                                          
                                             i
                                          
                                       
                                       ]
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             a
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             b
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

Here, 
                           
                              
                                 C
                              
                              
                                 i
                              
                           
                           
                              (
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         represent the parametric equation for 
                           i
                        th contour with respect to parameter 
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                         at a range between 
                           
                              [
                              
                                 
                                    a
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              ]
                           
                        .

Most scaffold structures fabricated with a uniform 0°–90° lay-down pattern as shown in Fig. 8
                        . The porosity remains constant throughout the structure as the filament deposition direction follows a repetitive cycle.

In such circumstances, the porosity can be calculated by considering two adjacent filaments of a single layer. Based on the geometry, the volume covered by a single layer can be discretized into segments shown in Fig. 8 where 
                           R
                         is the filament radius, 
                           W
                         is the segment width and 
                           S
                         is the distance between filaments. Thus the porosity in each segment is the same and can be calculated by the following equation:
                           
                              (4)
                              
                                 
                                    
                                       
                                          Porosity
                                       
                                    
                                    
                                       
                                          Seg
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             
                                                seg
                                             
                                          
                                       
                                       −
                                       
                                          
                                             V
                                          
                                          
                                             
                                                fil
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             
                                                seg
                                             
                                          
                                       
                                    
                                 
                                 ×
                                 100
                                 %
                                 .
                              
                           
                        
                     

Here, 
                           
                              
                                 V
                              
                              
                                 
                                    seg
                                 
                              
                           
                         is the segment volume and 
                           
                              
                                 V
                              
                              
                                 
                                    fil
                                 
                              
                           
                         is the filament volume in each segment. Even though homogeneous scaffolds may have a design convenience, but they are limited to achieve the desired functional gradient porosity. On the other hand, heterogeneous or gradient porosity can be achieved through some additive manufacturing techniques either by changing the deposited filament diameter or by controlling the segment size, i.e., the pore size during the fabrication processes. In this paper, deposition based bio-additive processes (i.e., micro-nozzle deposition system and fused deposition modeling (FDM) system) are used so varying filament diameter may not be possible during the deposition process. In the next section, the proposed modeling technique will be presented to addresses the regional heterogeneity by locally adjusting the distance between filaments for bio-additive manufacturing processes.

As mentioned above, homogeneous scaffolds generally have equidistant filaments throughout their internal region as shown in Fig. 8. Such property homogenization may address the desired property of a single uniform region, but completely ignores the presence of any regional heterogeneity. Fig. 9
                         shows an example to demonstrate how the filament deposition direction affects the overall heterogeneity. As shown in Fig. 9, the outer boundary contour in the example contains four internal features. Almost all segments could pass through the heterogeneous regions if an arbitrary filament deposition direction is used as shown in Fig. 9(a). However, choosing a proper filament deposition direction, most of the segments could pass through the homogeneous region as shown in Fig. 9(b).

Therefore, to decrease the porosity difference between the iso-porosity regions, an optimum filament deposition direction needs to be determined for each layer based on the contour geometry and location of the iso-property regions.

To determine the porosity difference over a heterogeneous region, a reference frame concept is developed. The filament deposition angle 
                              θ
                            can be defined based on this reference frame as shown in Fig. 10
                           , where 
                              θ
                              ∈
                              
                                 [
                                 0
                                 ,
                                 π
                                 ]
                              
                           . To measure the heterogeneity, each layer contour can be discretized by a set of parallel lines aligned with the reference frame angle 
                              θ
                            as shown in Fig. 10(a). Then the area generated between two adjacent parallel lines is analyzed for heterogeneity. These parallel lines might be equidistant from each other, i.e. 
                              
                                 
                                    h
                                 
                                 
                                    t
                                 
                              
                              =
                              
                                 
                                    h
                                 
                                 
                                    s
                                 
                              
                            or varying distant 
                              
                                 
                                    h
                                 
                                 
                                    t
                                 
                              
                              ≠
                              
                                 
                                    h
                                 
                                 
                                    s
                                 
                              
                            where both 
                              
                                 
                                    h
                                 
                                 
                                    t
                                 
                              
                            and 
                              
                                 
                                    h
                                 
                                 
                                    s
                                 
                              
                            are variables. However, the combination of such design parameters can virtually be infinite and by adding the frame angle 
                              θ
                            as a decision variable could increase the computational time extensively. To avoid such computation complexity, a rectilinear bounding box technique is introduced that would eventually reduce the feasible solution region significantly without compromising the optimality.

In this method, the rectilinear bounding box with a corner point set, 
                              P
                              
                                 
                                    T
                                 
                                 
                                    i
                                 
                                 
                                    θ
                                 
                              
                              =
                              
                                 {
                                 p
                                 
                                    
                                       t
                                    
                                    
                                       1
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       θ
                                    
                                 
                                 ,
                                 
                                 p
                                 
                                    
                                       t
                                    
                                    
                                       2
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       θ
                                    
                                 
                                 ,
                                 p
                                 
                                    
                                       t
                                    
                                    
                                       3
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       θ
                                    
                                 
                                 ,
                                 p
                                 
                                    
                                       t
                                    
                                    
                                       4
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       θ
                                    
                                 
                                 }
                              
                              
                              ∀
                              i
                              ,
                              
                              θ
                            aligned with the reference frame angle 
                              θ
                           , has been introduced for every single contour as shown in this Fig. 10(b). Here 
                              
                                 
                                    x
                                 
                                 
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    min
                                 
                                 
                                    θ
                                 
                              
                                and  
                              
                                 
                                    y
                                 
                                 
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    min
                                 
                                 
                                    θ
                                 
                              
                            represent the minimum extent of 
                              i
                           th contour with the reference coordinate angle of 
                              θ
                           . Similarly, 
                              
                                 
                                    x
                                 
                                 
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    max
                                 
                                 
                                    θ
                                 
                              
                                and  
                              
                                 
                                    y
                                 
                                 
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    max
                                 
                                 
                                    θ
                                 
                              
                            represent the maximum extent of 
                              i
                           th contour with the reference coordinate angle of 
                              θ
                           . 
                              P
                              
                                 
                                    T
                                 
                                 
                                    i
                                 
                                 
                                    θ
                                 
                              
                            represents the corner point set of 
                              i
                           th contour’s bounding box with the reference coordinate angle of 
                              θ
                           . The lines with the same unit vector 
                              
                                 (
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       θ
                                    
                                 
                                   or  
                                 
                                    
                                       
                                          
                                             y
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       θ
                                    
                                 
                                 )
                              
                            are extended in both directions to intersect with the outer contour and this 
                              
                                 
                                    L
                                 
                                 
                                    j
                                 
                              
                            line can be represented as


                           
                              
                                 (5)
                                 
                                    
                                       
                                          
                                             L
                                          
                                          
                                             j
                                          
                                          
                                             θ
                                             ,
                                             a
                                          
                                       
                                       =
                                       
                                          
                                             p
                                             
                                                
                                                   t
                                                
                                                
                                                   2
                                                   ,
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   θ
                                                
                                             
                                             p
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                   ,
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   θ
                                                
                                             
                                          
                                          
                                             ⃗
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             θ
                                          
                                       
                                       
                                          ‖
                                          
                                             
                                                x
                                             
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                min
                                             
                                             
                                                θ
                                             
                                          
                                          
                                             
                                                x
                                             
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ,
                                                min
                                             
                                             
                                                θ
                                             
                                          
                                          ‖
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             L
                                          
                                          
                                             j
                                          
                                          
                                             θ
                                             ,
                                             b
                                          
                                       
                                       =
                                       
                                          
                                             p
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                   ,
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   θ
                                                
                                             
                                             p
                                             
                                                
                                                   t
                                                
                                                
                                                   2
                                                   ,
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   θ
                                                
                                             
                                          
                                          
                                             ⃗
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             θ
                                          
                                       
                                       
                                          ‖
                                          
                                             
                                                x
                                             
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                max
                                             
                                             
                                                θ
                                             
                                          
                                          
                                             
                                                x
                                             
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ,
                                                max
                                             
                                             
                                                θ
                                             
                                          
                                          ‖
                                       
                                       
                                       ∀
                                       i
                                       =
                                       1
                                       …
                                       m
                                       ;
                                       
                                       j
                                       =
                                       0
                                       …
                                       2
                                       m
                                       ;
                                       θ
                                    
                                 
                                 
                                    
                                       
                                          
                                             L
                                          
                                          
                                             j
                                          
                                          
                                             θ
                                          
                                       
                                       =
                                       
                                          
                                             L
                                          
                                          
                                             j
                                          
                                          
                                             θ
                                             ,
                                             a
                                          
                                       
                                       ∪
                                       
                                          
                                             L
                                          
                                          
                                             j
                                          
                                          
                                             θ
                                             ,
                                             b
                                          
                                       
                                       .
                                    
                                 
                              
                           
                        

Here 
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    θ
                                 
                              
                            is the unit vector of two parallel lines of all contour set with a reference coordinate angle 
                              θ
                           . Thus a set of extended planar lines 
                              
                                 
                                    L
                                 
                                 
                                    θ
                                 
                              
                              =
                              
                                 
                                    
                                       {
                                       
                                          
                                             L
                                          
                                          
                                             j
                                          
                                          
                                             θ
                                          
                                       
                                       }
                                    
                                 
                                 
                                    j
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    n
                                 
                              
                            tangent to the contour sets and parallel to the reference frame angle are used to discretize the slice contours. This method will generate a line 
                              
                                 
                                    L
                                 
                                 
                                    j
                                 
                                 
                                    θ
                                 
                              
                            segment if any changes in heterogeneity occur as shown in Fig. 11
                           . Therefore, the distance between two adjacent parallel lines become a function of iso-property contour sets and their geometric properties, rather than a decision variable.

These parallel lines split both the contours and corresponding contour’s area. The area generated between two adjacent parallel lines has been denoted as strips 
                              S
                              T
                              =
                              
                                 
                                    
                                       {
                                       s
                                       
                                          
                                             t
                                          
                                          
                                             j
                                          
                                       
                                       }
                                    
                                 
                                 
                                    j
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    n
                                 
                              
                            with a variable width of 
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                           . The generated strips are classified as homogeneous and heterogeneous depending upon the number of intersected contours as shown in Fig. 11(b). The area between 
                              j
                           th strip and the outer geometric contour 
                              
                                 
                                    C
                                 
                                 
                                    0
                                 
                              
                            is defined as the effective strip area as shown in Fig. 11(b). The rest of the paper will use the term strip area to identify the corresponding effective strip area. The cost function for each strip is defined based on the number of intersecting contours or heterogeneity factor. The cost function and the associated properties, i.e., the area and the range of porosity of each strip determine the weight of the strips. By aggregating the weight for each strip would provide the total weight of the layer for a single deposition angle 
                              θ
                           .

The intersection between contour 
                              
                                 
                                    C
                                 
                                 
                                    i
                                 
                              
                            and the line 
                              
                                 
                                    L
                                 
                                 
                                    j
                                 
                              
                            for any reference coordinate angle of 
                              θ
                            can be calculated with the following equation: 
                              
                                 (6)
                                 
                                    
                                       
                                          L
                                       
                                       
                                          j
                                       
                                       
                                          θ
                                       
                                    
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             
                                                
                                                   C
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             θ
                                          
                                       
                                       
                                          (
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       ,
                                       
                                          
                                             Y
                                          
                                          
                                             
                                                
                                                   C
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             θ
                                          
                                       
                                       
                                          (
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    =
                                    0
                                    
                                    ∀
                                    i
                                    ,
                                    j
                                    ,
                                    θ
                                    .
                                 
                              
                           
                        

By setting the root for the above equation to zero, a set of intersection location 
                              U
                              ∈
                              
                                 [
                                 
                                    
                                       a
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 ]
                              
                            with respect to the parameter 
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                            can be calculated along with the geometric information as shown in Fig. 12
                           . The index 
                              θ
                            is dropped to simplify the variable notations during the illustration of the algorithm. 
                              
                                 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       i
                                    th contour that represent the iso-porosity closed curve (
                                       i
                                       =
                                       0
                                       ,
                                       …
                                       ,
                                       m
                                    ).


                                    
                                       
                                          
                                             L
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       j
                                    th line that represent the tangent for the iso-porosity closed curve 
                                       
                                          (
                                          j
                                          =
                                          0
                                          ,
                                          …
                                          ,
                                          n
                                          )
                                       
                                    .


                                    
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       Area of  
                                       j
                                       th strip
                                    .


                                    
                                       
                                          
                                             P
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                          
                                             x
                                          
                                       
                                       =
                                       x
                                    th intersecting point between the 
                                       j
                                    th line and 
                                       i
                                    th iso-porosity closed curve.


                                    
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       =
                                         Number of intersection
                                     points between the 
                                       j
                                    th line and 
                                       i
                                    th iso-porosity closed curve.


                                    
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       =
                                       Number of tangent
                                     intersection points between the 
                                       j
                                    th line and 
                                       i
                                    th iso-porosity closed curve.

The effective area 
                              
                                 
                                    A
                                 
                                 
                                    j
                                 
                              
                            of 
                              j
                           th strip is calculated by using the following equation: 
                              
                                 (7)
                                 
                                    
                                       
                                          A
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         x
                                                         =
                                                         0
                                                      
                                                      
                                                         
                                                            
                                                               n
                                                            
                                                            
                                                               0
                                                               ,
                                                               j
                                                            
                                                         
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         (
                                                         
                                                            
                                                               ∫
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     0
                                                                     ,
                                                                     j
                                                                  
                                                                  
                                                                     x
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     0
                                                                     ,
                                                                     j
                                                                  
                                                                  
                                                                     x
                                                                     +
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               C
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                            )
                                                         
                                                         d
                                                         
                                                            
                                                               u
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         |
                                                         
                                                            (
                                                            
                                                               
                                                                  ∫
                                                               
                                                               
                                                                  
                                                                     
                                                                        P
                                                                     
                                                                     
                                                                        0
                                                                        ,
                                                                        j
                                                                     
                                                                     
                                                                        x
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        P
                                                                     
                                                                     
                                                                        0
                                                                        ,
                                                                        j
                                                                     
                                                                     
                                                                        x
                                                                        +
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  C
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  
                                                                     u
                                                                  
                                                                  
                                                                     0
                                                                  
                                                               
                                                               )
                                                            
                                                            d
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                      >
                                                      0
                                                      )
                                                   
                                                   )
                                                
                                                −
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   
                                                      j
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                      −
                                                      1
                                                   
                                                
                                                ;
                                                
                                                for
                                                
                                                1
                                                ≤
                                                j
                                                <
                                                n
                                                .
                                             
                                          
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         ∫
                                                      
                                                      
                                                         
                                                            
                                                               a
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                   y
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         d
                                                         x
                                                         
                                                            (
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                      
                                                         d
                                                         
                                                            
                                                               u
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                   d
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   )
                                                
                                                −
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   
                                                      n
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      n
                                                      −
                                                      1
                                                   
                                                
                                                ;
                                                
                                                for  
                                                j
                                                =
                                                n
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

To determine the area weight contribution of 
                              i
                           th contour 
                              
                                 
                                    C
                                 
                                 
                                    i
                                 
                              
                            in 
                              j
                           th strip 
                              s
                              
                                 
                                    t
                                 
                                 
                                    j
                                 
                              
                           , five possible cases have been defined based on the corresponding intersection between them: 
                              
                                 (8)
                                 
                                    
                                       
                                          Case
                                       
                                       
                                       1
                                       :
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       ≥
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       ≥
                                       1
                                       
                                       i
                                       =
                                       0
                                       ;
                                       
                                       j
                                       =
                                       1
                                    
                                 
                                 
                                    
                                       
                                          Case
                                       
                                       
                                       2
                                       :
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       ≥
                                       1
                                       
                                       and
                                       
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                             −
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                             −
                                             1
                                          
                                       
                                       ≥
                                       1
                                       
                                       ∀
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       m
                                       :
                                       j
                                       >
                                       1
                                    
                                 
                                 
                                    
                                       
                                          Case
                                       
                                       
                                       3
                                       :
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       >
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       ≥
                                       1
                                       
                                       and
                                       
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                             −
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                             −
                                             1
                                          
                                       
                                       ≥
                                       1
                                       
                                       ∀
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       m
                                       :
                                       j
                                       >
                                       1
                                    
                                 
                                 
                                    
                                       
                                          Case
                                       
                                       
                                       4
                                       :
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       ≥
                                       1
                                       
                                       and
                                       
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                             −
                                             1
                                          
                                       
                                       >
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                             −
                                             1
                                          
                                       
                                       ≥
                                       1
                                       
                                       ∀
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       m
                                       :
                                       j
                                       >
                                       1
                                    
                                 
                                 
                                    
                                       
                                          Case
                                       
                                       
                                       5
                                       :
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       >
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       ≥
                                       1
                                       
                                       and
                                       
                                       
                                          
                                             n
                                          
                                          
                                             i
                                             ,
                                             j
                                             −
                                             1
                                          
                                       
                                       >
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             ,
                                             j
                                             −
                                             1
                                          
                                       
                                       ≥
                                       1
                                       
                                       ∀
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       m
                                       :
                                       j
                                       >
                                       1
                                       .
                                    
                                 
                              
                           
                        

Here, Case 1 is used for the first strip which is always generated by the intersection between the first tangent line and the outer contour. Case 2 denotes a situation when the 
                              j
                           th strip contains the whole 
                              i
                           th contour. Case 3 defines the 
                              j
                           th strip that contains the final segment of 
                              i
                           th contour. Similarly, Case 4 defines the 
                              j
                           th strip that contains the first segment of 
                              i
                           th contour. Finally, Case 5 defines the 
                              j
                           th strip that contains the intermediate segment of 
                              i
                           th contour. The area of 
                              i
                           th contour contributed to the effective area of 
                              j
                           th strip 
                              C
                              
                                 
                                    A
                                 
                                 
                                    
                                       
                                          A
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                            can be calculated by using the following equation: 
                              
                                 (9)
                                 
                                    C
                                    
                                       
                                          A
                                       
                                       
                                          
                                             
                                                A
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                
                                                ;
                                                
                                                for Case
                                                
                                                1
                                             
                                          
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         ∫
                                                      
                                                      
                                                         
                                                            
                                                               a
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                   y
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         d
                                                         x
                                                         
                                                            (
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                      
                                                         d
                                                         
                                                            
                                                               u
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                   d
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                ;
                                                
                                                for Case
                                                
                                                2
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      x
                                                      =
                                                      0
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                      
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      (
                                                      
                                                         
                                                            ∫
                                                         
                                                         
                                                            
                                                               
                                                                  P
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                               
                                                                  x
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  P
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                               
                                                                  x
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            C
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               u
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                      d
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      |
                                                      
                                                         (
                                                         
                                                            
                                                               ∫
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     i
                                                                     ,
                                                                     j
                                                                  
                                                                  
                                                                     x
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     i
                                                                     ,
                                                                     j
                                                                  
                                                                  
                                                                     x
                                                                     +
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               C
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                         
                                                         d
                                                         
                                                            
                                                               u
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   >
                                                   0
                                                   )
                                                
                                                ;
                                                
                                                for Case  
                                                3
                                                .
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      x
                                                      =
                                                      0
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            i
                                                            ,
                                                            j
                                                            −
                                                            1
                                                         
                                                      
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      (
                                                      
                                                         
                                                            ∫
                                                         
                                                         
                                                            
                                                               
                                                                  P
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                                  −
                                                                  1
                                                               
                                                               
                                                                  
                                                                     
                                                                        n
                                                                     
                                                                     
                                                                        i
                                                                        ,
                                                                        j
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  −
                                                                  x
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  P
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                                  −
                                                                  1
                                                               
                                                               
                                                                  
                                                                     
                                                                        n
                                                                     
                                                                     
                                                                        i
                                                                        ,
                                                                        j
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  −
                                                                  
                                                                     (
                                                                     x
                                                                     +
                                                                     1
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            C
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               u
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                      d
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      |
                                                      
                                                         (
                                                         
                                                            
                                                               ∫
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     i
                                                                     ,
                                                                     j
                                                                     −
                                                                     1
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           i
                                                                           ,
                                                                           j
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     −
                                                                     x
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     i
                                                                     ,
                                                                     j
                                                                     −
                                                                     1
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           i
                                                                           ,
                                                                           j
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     −
                                                                     
                                                                        (
                                                                        x
                                                                        +
                                                                        1
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               C
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                         
                                                         d
                                                         
                                                            
                                                               u
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   <
                                                   0
                                                   )
                                                
                                                ;
                                                  for Case
                                                
                                                4
                                                .
                                             
                                          
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         x
                                                         =
                                                         0
                                                      
                                                      
                                                         
                                                            
                                                               n
                                                            
                                                            
                                                               i
                                                               ,
                                                               j
                                                            
                                                         
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         (
                                                         
                                                            
                                                               ∫
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     i
                                                                     ,
                                                                     j
                                                                  
                                                                  
                                                                     x
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     i
                                                                     ,
                                                                     j
                                                                  
                                                                  
                                                                     x
                                                                     +
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               C
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                         
                                                         d
                                                         
                                                            
                                                               u
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         |
                                                         
                                                            (
                                                            
                                                               
                                                                  ∫
                                                               
                                                               
                                                                  
                                                                     
                                                                        P
                                                                     
                                                                     
                                                                        i
                                                                        ,
                                                                        j
                                                                     
                                                                     
                                                                        x
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        P
                                                                     
                                                                     
                                                                        i
                                                                        ,
                                                                        j
                                                                     
                                                                     
                                                                        x
                                                                        +
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  C
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  
                                                                     u
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               )
                                                            
                                                            d
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                      >
                                                      0
                                                      )
                                                   
                                                   )
                                                
                                                −
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   
                                                      j
                                                      −
                                                      1
                                                   
                                                
                                                C
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         
                                                            j
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ;
                                                for Case
                                                
                                                5
                                             
                                          
                                       
                                    
                                    ∀
                                    i
                                    ,
                                    j
                                    .
                                 
                              
                           
                        

After determining the area weight contribution of each contour for each strip, the heterogeneity factor for the strips needs to be determined. As shown in Fig. 12, the strips have been classified into homogeneous (single contour strip) and heterogeneous (multiple-contour strip). The heterogeneous strip can be further sub-classified based on the number of contours present in each strip. The higher the number of contours in each strip, the more heterogeneous the strip is. The extrinsic property (i.e. porosity) of the contour may also influence the heterogeneity of the strip. Therefore, their contribution needs to be incorporated for weight determination of the strips and can be calculated by the following equations: 
                              
                                 
                                    (10)
                                    
                                       
                                          
                                             
                                                het
                                             
                                          
                                          
                                             j
                                          
                                          
                                             
                                                Contour
                                             
                                          
                                       
                                       =
                                       ∫
                                       
                                          (
                                          n
                                          _
                                          
                                             
                                                
                                                   Contour
                                                
                                             
                                             
                                                j
                                             
                                          
                                          ,
                                          
                                             
                                                C
                                             
                                             
                                                i
                                             
                                          
                                          |
                                          
                                             
                                                n
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                          >
                                          
                                             
                                                t
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                          ≥
                                          1
                                          )
                                       
                                       
                                       ∀
                                       j
                                    
                                 
                                 
                                    (11)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         het
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      
                                                         Property
                                                      
                                                   
                                                
                                                =
                                                ∫
                                                
                                                   (
                                                   max
                                                   _
                                                   
                                                      
                                                         
                                                            Por
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ,
                                                   
                                                   min
                                                   _
                                                   
                                                      
                                                         
                                                            Por
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                
                                                ∀
                                                j
                                             
                                          
                                          
                                             
                                                where ,
                                             
                                          
                                          
                                             
                                                max
                                                _
                                                
                                                   
                                                      
                                                         Por
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                =
                                                max
                                                
                                                   {
                                                   
                                                      
                                                         
                                                            Por
                                                         
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   |
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                      
                                                   
                                                   ≥
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                      
                                                   
                                                   ≥
                                                   1
                                                   ;
                                                   
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                         −
                                                         1
                                                      
                                                   
                                                   ≥
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                         −
                                                         1
                                                      
                                                   
                                                   ≥
                                                   1
                                                   ,
                                                   
                                                   ∀
                                                   i
                                                   ,
                                                   j
                                                   }
                                                
                                             
                                          
                                          
                                             
                                                min
                                                _
                                                
                                                   
                                                      
                                                         Por
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                =
                                                min
                                                
                                                   {
                                                   
                                                      
                                                         
                                                            Por
                                                         
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   |
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                      
                                                   
                                                   ≥
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                      
                                                   
                                                   ≥
                                                   1
                                                   ;
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                         −
                                                         1
                                                      
                                                   
                                                   ≥
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                         −
                                                         1
                                                      
                                                   
                                                   ≥
                                                   1
                                                   ,
                                                   
                                                   ∀
                                                   i
                                                   ,
                                                   j
                                                   }
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Here, 
                              
                                 
                                    
                                       het
                                    
                                 
                                 
                                    j
                                 
                                 
                                    
                                       Contour
                                    
                                 
                              
                                and  
                              
                                 
                                    
                                       het
                                    
                                 
                                 
                                    j
                                 
                                 
                                    
                                       Property
                                    
                                 
                              
                            are the heterogeneity factor of 
                              j
                           th strips which are based on the number of contours, 
                              n
                              _
                              
                                 
                                    
                                       Contour
                                    
                                 
                                 
                                    j
                                 
                              
                            and the property diversity in 
                              j
                           th strip. 
                              max
                              _
                              
                                 
                                    
                                       Por
                                    
                                 
                                 
                                    j
                                 
                              
                                and  
                              min
                              _
                              
                                 
                                    
                                       Por
                                    
                                 
                                 
                                    j
                                 
                              
                            are respectively the maximum and minimum porosity of all contour contributed in 
                              j
                           th strip. By using the heterogeneity factor along with the contributed area, the weight of a single strip can be calculated as 
                              
                                 (12)
                                 
                                    
                                       Weight
                                    
                                    _
                                    S
                                    
                                       
                                          T
                                       
                                       
                                          j
                                       
                                       
                                          θ
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          (
                                          
                                             
                                                A
                                             
                                             
                                                j
                                             
                                          
                                          −
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                m
                                             
                                          
                                          C
                                          
                                             
                                                A
                                             
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       +
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             m
                                          
                                       
                                       
                                          (
                                          C
                                          
                                             
                                                A
                                             
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                i
                                             
                                          
                                          ×
                                          
                                             
                                                
                                                   het
                                                
                                             
                                             
                                                j
                                             
                                             
                                                
                                                   Contour
                                                
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    
                                       
                                          
                                             het
                                          
                                       
                                       
                                          j
                                       
                                       
                                          
                                             Property
                                          
                                       
                                    
                                    
                                    ∀
                                    j
                                 
                              
                            where 
                              
                                 Weight
                              
                              _
                              S
                              
                                 
                                    T
                                 
                                 
                                    j
                                 
                                 
                                    θ
                                 
                              
                            is the weight of 
                              j
                           th strip evaluated at a frame angle 
                              θ
                           . Thus, by summing weight for all 
                              n
                            strips, the total weight of the slice at frame angle 
                              θ
                            can be calculated: 
                              
                                 (13)
                                 
                                    
                                       Total
                                    
                                    _
                                    
                                       
                                          
                                             Weight
                                          
                                       
                                       
                                          θ
                                       
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          n
                                       
                                    
                                    
                                       Weight
                                    
                                    _
                                    S
                                    
                                       
                                          T
                                       
                                       
                                          j
                                       
                                       
                                          θ
                                       
                                    
                                    
                                    ∀
                                    θ
                                    .
                                 
                              
                           
                        

Here, 
                              
                                 Total
                              
                              _
                              
                                 
                                    
                                       Weight
                                    
                                 
                                 
                                    θ
                                 
                              
                            is the aggregated total weight of the 
                              k
                           th layer evaluated at a frame angle 
                              θ
                           . This aggregated weight is a non-linear function of contributed area and it would be minimum under ideal case, i.e., for a complete homogeneous region. Increasing the heterogeneity in a region would increase the weight of the corresponding strip as well as the layer.

As discussed earlier, the weight is also a function of deposition direction. Therefore, the optimum deposition direction or frame angle 
                              θ
                              ∈
                              
                                 [
                                 0
                                 ,
                                 π
                                 ]
                              
                            for each layer needs to be determined. As shown in Fig. 13
                           , changing the deposition direction generates a new set of strips and by using the same methodology described in the previous section (Section  2.5.2), the weight can be determined for every 
                              θ
                            interval. The optimum deposition direction would be the corresponding minimum weight value for the 
                              k
                           th layer. Now for a bi-layer membrane or three dimensional structures, the optimum deposition direction 
                              
                                 
                                    θ
                                 
                                 
                                    ∗
                                 
                              
                            needs to be determined for each consecutive layers. To ensure the structural integrity between layers, a certain layout pattern or angle should be maintained between them.

To determine the optimum deposition angle for the 
                              k
                           th layer, the weight at a frame angle 
                              θ
                            is calculated with the constraints shown in Eq. (14). Finally, the angle 
                              θ
                            with a minimum total weight is determined as the optimum angle 
                              
                                 
                                    θ
                                 
                                 
                                    ∗
                                 
                              
                            for the 
                              k
                           th layer: 
                              
                                 (14)
                                 
                                    
                                       Min  
                                       
                                          {
                                          
                                             Total
                                          
                                          _
                                          
                                             
                                                
                                                   Weight
                                                
                                             
                                             
                                                k
                                             
                                             
                                                θ
                                             
                                          
                                          }
                                       
                                    
                                 
                                 
                                    
                                       Subject to
                                       −
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             n
                                          
                                       
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             Ω
                                          
                                          
                                             k
                                          
                                       
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             m
                                          
                                       
                                       
                                          (
                                          C
                                          
                                             
                                                A
                                             
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                i
                                             
                                          
                                          |
                                          
                                             (
                                             
                                                
                                                   n
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                             ≥
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                             ≥
                                             1
                                             ;
                                             
                                                
                                                   n
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                   −
                                                   1
                                                
                                             
                                             ≥
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                   −
                                                   1
                                                
                                             
                                             ≥
                                             1
                                             )
                                          
                                          )
                                       
                                       =
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                       
                                       ∀
                                       i
                                       ,
                                       j
                                    
                                 
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             k
                                          
                                       
                                       ∈
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      [
                                                      0
                                                      ,
                                                      π
                                                      ]
                                                   
                                                   :
                                                   
                                                   if  
                                                   k
                                                   =
                                                   0
                                                
                                             
                                             
                                                
                                                   
                                                      [
                                                      0
                                                      ∼
                                                      
                                                         (
                                                         
                                                            
                                                               θ
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                            
                                                               ∗
                                                            
                                                         
                                                         −
                                                         φ
                                                         )
                                                      
                                                      ,
                                                      
                                                         (
                                                         
                                                            
                                                               θ
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                            
                                                               ∗
                                                            
                                                         
                                                         +
                                                         φ
                                                         )
                                                      
                                                      ∼
                                                      π
                                                      ]
                                                   
                                                   :
                                                   
                                                   if  
                                                   k
                                                   >
                                                   0
                                                
                                             
                                          
                                          }
                                       
                                       
                                       ∀
                                       k
                                       .
                                    
                                 
                              
                           
                        

Here, 
                              
                                 {
                                 
                                    Total
                                 
                                 _
                                 
                                    
                                       
                                          Weight
                                       
                                    
                                    
                                       k
                                    
                                    
                                       θ
                                    
                                 
                                 }
                              
                            represent a set of the total weight for every 
                              θ
                            interval in the 
                              k
                           th slice where the individual element of this set can be calculated with Eq. (3). 
                              
                                 
                                    Ω
                                 
                                 
                                    k
                                 
                              
                            is the total area of 
                              k
                           th slice. The optimum deposition direction or frame angle 
                              
                                 
                                    θ
                                 
                                 
                                    k
                                 
                                 
                                    ∗
                                 
                              
                            for any 
                              k
                           th slice can be calculated using Eq. (14). To ensure structural integrity and continuity between any layers, a range of angle must be constrained for the consecutive layer which is defined by the angles 
                              ±
                              φ
                            in Eq. (14). To determine the filament layout angle for any layer, the angle of the supporting layer must be considered. In bottom up building, the 
                              
                                 (
                                 k
                                 −
                                 1
                                 )
                              
                           th layer is the supporting layer for the 
                              k
                           th layer and the 
                              k
                           th layer is the supporting layer for the 
                              
                                 (
                                 k
                                 +
                                 1
                                 )
                              
                           th layer and so on. The segment of deposited material passing through the heterogeneous region may not be eliminated completely with an optimum angle 
                              
                                 
                                    θ
                                 
                                 
                                    k
                                 
                                 
                                    ∗
                                 
                              
                           , but this deposition direction may reduce the overall heterogeneity effect significantly.

After getting the optimum filament deposition directions 
                           
                              
                                 θ
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                         with corresponding strip set 
                           S
                           
                              
                                 T
                              
                              
                                 
                                    
                                       θ
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                              
                           
                           =
                           
                              
                                 
                                    {
                                    s
                                    
                                       
                                          t
                                       
                                       
                                          j
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                k
                                             
                                             
                                                ∗
                                             
                                          
                                       
                                    
                                    }
                                 
                              
                              
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                              
                           
                        , and the strip generating line set 
                           
                              
                                 L
                              
                              
                                 
                                    
                                       θ
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                              
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          L
                                       
                                       
                                          j
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                k
                                             
                                             
                                                ∗
                                             
                                          
                                       
                                    
                                    }
                                 
                              
                              
                                 j
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 n
                              
                           
                        , a function based filament distance determination methodology is developed to determine the optimum filament locations individually. The proposed method needs to apply for all strips 
                           S
                           
                              
                                 T
                              
                              
                                 
                                    
                                       θ
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                              
                           
                         for the 
                           k
                        th slice at the optimum filament deposition directions 
                           
                              
                                 θ
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                         as shown in Fig. 14
                        .

In Fig. 14(a) a heterogeneous contour strip 
                           s
                           
                              
                                 t
                              
                              
                                 j
                              
                           
                        , with the strip generating lines 
                           
                              
                                 L
                              
                              
                                 j
                                 −
                                 1
                              
                           
                         and 
                           
                              
                                 L
                              
                              
                                 j
                              
                           
                        , and contributing contour sets 
                           C
                           
                              
                                 C
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          C
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    
                                       
                                          n
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                    ≥
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                    ≥
                                    1
                                    ;
                                    
                                       
                                          n
                                       
                                       
                                          i
                                          ,
                                          j
                                          +
                                          1
                                       
                                    
                                    ≥
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          ,
                                          j
                                          +
                                          1
                                       
                                    
                                    ≥
                                    1
                                    }
                                 
                              
                              
                                 i
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 m
                              
                           
                        , are shown. To measure the spatial heterogeneity of the strip along its width 
                           
                              
                                 h
                              
                              
                                 j
                              
                           
                        , the area contribution from each contour in strip 
                           s
                           
                              
                                 t
                              
                              
                                 j
                              
                           
                         are calculated by the following equation: 
                           
                              (15)
                              
                                 F
                                 
                                    
                                       A
                                    
                                    
                                       j
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    H
                                    )
                                 
                                 =
                                 
                                    (
                                    C
                                    
                                       
                                          A
                                       
                                       
                                          
                                             
                                                A
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          i
                                       
                                    
                                    ∩
                                    
                                       
                                          L
                                       
                                       
                                          j
                                          −
                                          1
                                       
                                    
                                    H
                                    )
                                 
                                 
                                 ∀
                                 H
                                 ,
                                 i
                                 ,
                                 
                                 j
                                 |
                                 
                                    
                                       n
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 ≥
                                 
                                    
                                       t
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 ≥
                                 1
                                 ;
                                 
                                    
                                       n
                                    
                                    
                                       i
                                       ,
                                       j
                                       +
                                       1
                                    
                                 
                                 ≥
                                 
                                    
                                       t
                                    
                                    
                                       i
                                       ,
                                       j
                                       +
                                       1
                                    
                                 
                                 ≥
                                 1
                                 ;
                                 H
                                 ∈
                                 
                                    [
                                    0
                                    ,
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                    ]
                                 
                              
                           
                         where 
                           F
                           
                              
                                 A
                              
                              
                                 j
                              
                              
                                 i
                              
                           
                           
                              (
                              H
                              )
                           
                         is the functional area generated by 
                           i
                        th contour in the 
                           j
                        th strip evaluated at a variable point 
                           H
                           ∈
                           
                              [
                              0
                              ,
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              ]
                           
                        . At 
                           H
                           =
                           
                              
                                 h
                              
                              
                                 j
                              
                           
                        , the functional area 
                           F
                           
                              
                                 A
                              
                              
                                 j
                              
                              
                                 i
                              
                           
                           
                              (
                              H
                              )
                           
                         becomes the area of 
                           i
                        th contour contributed to the effective area of 
                           j
                        th strip 
                           C
                           
                              
                                 A
                              
                              
                                 
                                    
                                       A
                                    
                                    
                                       j
                                    
                                 
                              
                              
                                 i
                              
                           
                        . By summing all individual contour area at 
                           H
                           =
                           
                              
                                 h
                              
                              
                                 j
                              
                           
                         would provide the effective area of 
                           j
                        th strip which is shown in the following equations:


                        
                           
                              
                                 (16)
                                 
                                    F
                                    
                                       
                                          A
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       H
                                       =
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                       
                                       )
                                    
                                    =
                                    C
                                    
                                       
                                          A
                                       
                                       
                                          
                                             
                                                A
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                    ∀
                                    F
                                    
                                       
                                          A
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       H
                                       )
                                    
                                    >
                                    0
                                    ;
                                    
                                    i
                                    ;
                                    j
                                 
                              
                              
                                 (17)
                                 
                                    
                                       
                                          A
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          m
                                       
                                    
                                    F
                                    
                                       
                                          A
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       H
                                       =
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          m
                                       
                                    
                                    C
                                    
                                       
                                          A
                                       
                                       
                                          
                                             
                                                A
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                    ∀
                                    F
                                    
                                       
                                          A
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       H
                                       )
                                    
                                    >
                                    0
                                    ;
                                    i
                                    ;
                                    j
                                    .
                                 
                              
                           
                        
                     

The functional area for each contributing contours along the width of the strip has been plotted as shown in Fig. 15
                        . The porosity function, 
                           F
                           P
                        , for any segment 
                           
                              Δ
                           
                           H
                         in the strip can be calculated by the following equation:


                        
                           
                              (18)
                              
                                 F
                                 
                                    
                                       P
                                    
                                    
                                       j
                                    
                                 
                                 
                                    (
                                    
                                       Δ
                                    
                                    H
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       F
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          
                                             Δ
                                          
                                          H
                                          )
                                       
                                    
                                    
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                       
                                          (
                                          
                                             Δ
                                          
                                          H
                                          )
                                       
                                    
                                 
                                 ×
                                 
                                    
                                       
                                          Por
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                 ∀
                                 j
                                 ,
                                 
                                 F
                                 
                                    
                                       A
                                    
                                    
                                       j
                                    
                                    
                                       i
                                    
                                 
                                 >
                                 0
                                 .
                              
                           
                        
                     

After getting the porosity function for the strip, the distance between filaments 
                           S
                         can be determined by using the following equation which is the simplification of Eq. (4) presented earlier (also shown in Fig. 16
                        ): 
                           
                              (19)
                              
                                 
                                    
                                       S
                                    
                                    
                                       f
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       π
                                       R
                                    
                                    
                                       2
                                       
                                          (
                                          1
                                          −
                                          F
                                          
                                             
                                                P
                                             
                                             
                                                j
                                             
                                          
                                          
                                             (
                                             f
                                             )
                                          
                                          )
                                       
                                    
                                 
                                 ∃
                                 
                                    
                                       ∑
                                    
                                    
                                       f
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       f
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 ;
                                 
                                 
                                    
                                       S
                                    
                                    
                                       f
                                    
                                    
                                       j
                                    
                                 
                                 ≠
                                 
                                    
                                       S
                                    
                                    
                                       f
                                       +
                                       t
                                    
                                    
                                       j
                                    
                                 
                                 
                                 ∀
                                 j
                                 ,
                                 f
                                 ,
                                 t
                              
                           
                         where 
                           f
                         is the number of filament that fits in 
                           j
                        th strips, 
                           F
                           
                              
                                 P
                              
                              
                                 j
                              
                           
                           
                              (
                              f
                              )
                           
                         is the porosity determined at the filament location 
                           f
                           ,
                           
                              
                                 S
                              
                              
                                 f
                              
                              
                                 j
                              
                           
                         is the corresponding distance between filaments, and 
                           R
                         is the deposited filament radius. The distance between filaments, 
                           
                              
                                 S
                              
                              
                                 f
                              
                              
                                 j
                              
                           
                        , is a variable and depends upon the porosity value at the filament location 
                           f
                        , which is determined by the optimum area weight. The resultant filament locations change with the spatial porosity. The above described methodology needs to be applied for all strips in set 
                           S
                           
                              
                                 T
                              
                              
                                 
                                    
                                       θ
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                              
                           
                           =
                           
                              
                                 
                                    {
                                    s
                                    
                                       
                                          t
                                       
                                       
                                          j
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                k
                                             
                                             
                                                ∗
                                             
                                          
                                       
                                    
                                    }
                                 
                              
                              
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                              
                           
                         and, thus, will generate the optimum filament locations for any layer. Similarly the methodology needs to be repeated for all layers and by stacking those layers consecutively generate the 3D porous scaffold structure with optimum filament location. The porosity distribution in the bi-layer set is optimized for each bi-layer which has a height of twice the filament diameter. Thus, by optimizing the porosity in each bi-layer set, a true 3D spatial controllable heterogeneous porosity can be determined for the whole structure.

The proposed methodology generates a complete non-homogeneous filament structure by adjusting the distance between filaments in response to the internal heterogeneity. To evaluate the resultant anisotropic porosity, every segment in each strip needs to be evaluated by using Eqs. (15)–(19). The following equation aggregates the porosity deviation between the designed and the desired porosity: 
                           
                              (20)
                              
                                 E
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       m
                                    
                                 
                                 
                                    (
                                    
                                       |
                                       F
                                       
                                          
                                             P
                                          
                                          
                                             j
                                          
                                       
                                       
                                          (
                                          f
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                Por
                                             
                                          
                                          
                                             i
                                          
                                       
                                       |
                                    
                                    )
                                 
                                 ×
                                 F
                                 
                                    
                                       A
                                    
                                    
                                       j
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    f
                                    )
                                 
                                 
                                 ∀
                                 f
                              
                           
                         where 
                           E
                         is the resultant porosity evaluation index which is proportional to the total deviation from the desired porosity.

The proposed methodology optimizes the filament deposition location for an individual layer, but to measure the spatial porosity within the regions, the resultant porosity needs to be measured for each pore-cell in the bi-layer section, i.e., combining the adjacent 
                           k
                        th and 
                           
                              (
                              k
                              +
                              1
                              )
                           
                        th layers. A pore-cell is considered as the volumetric area generated between the four planes perpendicular to the deposition surface and passes through the center lines of two adjacent filaments in 
                           k
                        th and 
                           
                              (
                              k
                              +
                              1
                              )
                           
                        th layers. The height of these pore-cells is constant and is the same as the section height. For a 3D porous structure with the 
                           K
                         number of layers, the porosity in each layer may affect not only its adjacent layer but the porosity of the whole structure. In other words, the resultant porosity may vary based on the defined boundaries of the pore cells. Because of the highly anisotropic filament distribution nature in each layer, we use bi-layer sections as pore cell boundary to measure the resultant spatial porosity in our methodology. To measure the spatial porosity for such an anisotropic structure, the porosity of the individual pore-cells need to be measured using the Eq. (4) presented in Section  2.4.

The proposed modeling algorithm generates sequential locations for bio-additive processes. To fabricate the designed model, the points can be fed to any layer based additive manufacturing processes and the system can follow the deposition path to build the designed porous structure. To demonstrate the manufacturability of the designed scaffold, a novel 3D micro-nozzle biomaterial deposition system is used to fabricate the porous scaffold structure. Sodium alginate, a type of hydrogel widely used in cell immobilization, cell transplantation, and tissue engineering, is preferred as biomaterial due to its biocompatibility and formability. However, for hard tissue such as bone, rigid bio-polymers such as poly(L-lactide) (PLLA) or poly(
                        ε
                     -caprolactone) (PCL) materials can be used.

Sodium alginate from brown algae and calcium chloride were purchased from Sigma-Aldrich, USA. Alginate solutions 3% (w/v) were prepared by suspending 0.3 mg sodium alginate (SA) into 10 ml de-ionized (DI) water and stirred in room temperature for 20 min. Nozzle tips for dispensing systems were purchased from EFD®. The sodium alginate solution is filled in a reservoir and a pneumatic system is deployed to flow the solution via the micro-nozzles (100–250 μm). The system runs in room temperature under low pressure (0–8 psi). The reservoir is mounted on the dispensing system that is driven by a 3D motion control. A PC is connected to the system to control the motion in 3D. And by controlling the motion of the dispensing system, the deposition of the material can be controlled. Calcium chloride was suspended in DI water to obtain the 0.6% (w/v) calcium chloride solution. The calcium chloride solution is then dispensed onto a printed alginate structure through another nozzle to provide cross-linking between the alginate anion and the calcium cation to form the hydrogel. A pink color pigment is used just for the proper visualization purpose.

The proposed techniques have been implemented on 2.3 GHz PCs using Rhino Script and Visual Basic programming languages. Two sets of 3D examples have been used to demonstrate the proposed methodology. The first example is the same femur slice discussed in the methodology section with three iso-property internal regions. The generated slice is scaled down for the fabrication purpose. The geometric shapes of such internal regions have been chosen arbitrarily to represent the heterogeneity as shown in Fig. 16 and their designed property is presented in Table 1
                     .

To get the optimum deposition angle, the internal region is discretized with strips generated from the bounding box method described in Section  2.5.1. For each reference frame angle 
                        θ
                        °
                     , the corresponding weight for each strip is determined using Eqs. (7)–(12). And then by adding the individual weights, the total weight for the slice is calculated using Eq. (16). The total weight plot at 
                        
                           Δ
                        
                        θ
                        =
                        1
                        °
                      is shown in Fig. 17
                     .

The heterogeneity factors for Eqs. (10) and (11) have been selected as 
                        
                           
                              
                                 het
                              
                           
                           
                              j
                           
                           
                              
                                 Contour
                              
                           
                        
                        =
                        
                           (
                           i
                           +
                           1
                           )
                        
                      and 
                        
                           
                              
                                 het
                              
                           
                           
                              j
                           
                           
                              
                                 Property
                              
                           
                        
                        =
                        
                           (
                           max
                           _
                           
                              
                                 
                                    Por
                                 
                              
                              
                                 j
                              
                           
                           −
                           min
                           _
                           
                              
                                 
                                    Por
                                 
                              
                              
                                 j
                              
                           
                           )
                        
                      respectively. The optimum deposition direction or frame angle with a minimum total weight for the sample slice is determined as 
                        
                           
                              θ
                           
                           
                              k
                           
                           
                              ∗
                           
                        
                        =
                        41
                        °
                     . To get the frame angle for the next slice, the angle range 
                        
                           
                              θ
                           
                           
                              k
                           
                           
                              ∗
                           
                        
                        ±
                        45
                        °
                      is constraint to ensure structural integrity as discussed in Eq. (14). The optimum deposition direction for the consecutive layer is calculated as 
                        
                           
                              θ
                           
                           
                              k
                              +
                              1
                           
                           
                              ∗
                           
                        
                        =
                        158
                        °
                     . A total of seven numbers of strips have been generated in consecutive optimum layers with both homogeneous and heterogeneous strip property. Also individual weight contribution measured by Eq. (12) is shown in Fig. 18
                     .

The spatial porosity functions for both layers have been determined using Eq. (18) and plotted in Fig. 19
                     . The lower horizontal axis represents the strip width for the 1st layer 
                        
                           (
                           
                              
                                 θ
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           =
                           41
                           °
                           )
                        
                      and the upper horizontal axis represents the consecutive second layer 
                        
                           
                              θ
                           
                           
                              k
                              +
                              1
                           
                           
                              ∗
                           
                        
                        =
                        158
                        °
                     .

The porosity function clearly represents the heterogeneity within the strip, as higher heterogeneity introduce higher deviation in the porosity range. The samples are designed with 100 μm filament diameter to determine the filament locations following the porosity function. The generated bi-layer combining the two layers is shown and the porosity is evaluated for the generated anisotropic pore-cells in Fig. 20
                     .

The same methodology is implemented on the same figure using a different set of porosity as shown in Fig. 21
                     . By changing the extrinsic/intrinsic porosity as 
                        
                           
                              
                                 Por
                              
                           
                           
                              0
                           
                        
                        =
                        88
                        %
                        ;
                        
                           
                              
                                 Por
                              
                           
                           
                              1
                           
                        
                        =
                        50
                        %
                        ;
                        
                           
                              
                                 Por
                              
                           
                           
                              2
                           
                        
                        =
                        75
                        %
                        
                        and
                        
                        
                           
                              
                                 Por
                              
                           
                           
                              3
                           
                        
                        =
                        65
                        %
                     , the methodology generates deposition direction 
                        
                           
                              θ
                           
                           
                              k
                           
                           
                              ∗
                           
                        
                        =
                        98
                        °
                          and  
                        
                           
                              θ
                           
                           
                              k
                              +
                              1
                           
                           
                              ∗
                           
                        
                        =
                        156
                        °
                      with the number of strip 6 and 7 respectively. The resultant porosity distribution is shown in Fig. 21(b).

Because of the variational distance between filaments, the pore cells become highly anisotropic in nature and the porosity for the structure becomes truly gradient. The resultant structure follows the heterogeneity of the internal regions as shown in Figs. 20 and 21. Attaining the exact regional porosity may not be possible, but the proposed methodology minimizes the deviation between the desired and the designed porosity. As shown Fig. 22
                     , the deviation of porosity following the proposed methodology is always lower than the traditional average equidistant filament method. The deviation data is calculated by using Eq. (20) and compared and plotted with a 68% (for Fig. 20) and 77% (for Fig. 21) porosity in Fig. 22.

The combined layers represent the designed porosity for a bi-layer section with the height of twice the diameter of the filament used. Both bi-layer sections represented in Figs. 21 and 22 are shown in Fig. 23
                     (a–b) as the 3D model with the filament diameter of 100 μm. Since the deposition angle between adjacent sections matches the required constraints, both bi-layer sections are combined for demonstration purpose in Fig. 23(c).

The proposed methodology is applied in a second example with five different iso-porosity regions as shown in Fig. 24
                     . These free-form contours have been generated with Rhinoceros 4.0 along with the corresponding property presented in Table 2
                     .

To get the optimum deposition angle, the internal region is discretized with strips generated from the bounding box method described in Section  2.5.1. The total weight plot at 
                        
                           Δ
                        
                        θ
                        =
                        1
                        °
                      is shown in Fig. 25
                     .

The same heterogeneity factor is used for Eqs. (10) and (11) as the earlier example. The optimum deposition direction or frame angle for the 
                        k
                     th slice is found to be 
                        
                           
                              θ
                           
                           
                              k
                           
                           
                              ∗
                           
                        
                        =
                        111
                        °
                     . Similarly the optimum frame angle for the 
                        
                           (
                           k
                           +
                           1
                           )
                        
                     th slice is determined as 
                        
                           
                              θ
                           
                           
                              k
                              +
                              1
                           
                           
                              ∗
                           
                        
                        =
                        41
                        °
                     . The associated strips for both layers have been shown in Fig. 26
                     .

A total of eleven numbers of strips have been generated in the consecutive optimum layers with both homogeneous and heterogeneous strips. Also individual weight contributions were measured by Eq. (12) as shown in Fig. 27
                     .

The spatial porosity function for both layers is determined using Eq. (18) and plotted in Fig. 28
                     . The lower horizontal axis represents the strip width for the 1st layer 
                        
                           (
                           
                              
                                 θ
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           =
                           111
                           °
                           )
                        
                      and the upper horizontal axis represents the consecutive second layer 
                        
                           
                              θ
                           
                           
                              k
                              +
                              1
                           
                           
                              ∗
                           
                        
                        =
                        41
                        °
                     .

By using the porosity function, the filament locations have been determined as shown in Fig. 29
                     . A sample bi-layer combining the two layers is shown in Fig. 29.

The deviation data has also been calculated by using Eq. (20) and compared and plotted with a 65% constant porosity in Fig. 30
                     . The plot shows a significant reduction in deviation compared to the traditional equidistant filament deposition.

For demonstration purpose, two consecutive slices of the above examples have been considered for fabrication with the bio-fabrication system described in Section  3. To fit into the working envelope of the fabrication system, the actual human femur model is scaled down by 70%. The corresponding area and the iso-porosity remain the same as presented in Table 1. The filament locations are generated using the methodology described in Section  2 with 200 μm diameter as shown in Fig. 31
                     (a). The fabricated model is shown in Fig. 31(b). A total of 50 and 31 number of filaments are generated for the 
                        k
                     th and 
                        
                           (
                           k
                           +
                           1
                           )
                        
                     th slices respectively where the location for each of these layers have been determined from the porosity function discussed in Section  2.6.

For the second free-form shape, the example is scaled-down with a factor of 2 from its original size presented in Table 2 as shown in Fig. 32
                     (a). The corresponding filament location for the model is generated using the methodology described in Section  2 with a 250 μm diameter and the fabrication model is shown in Fig. 32(b). A total of 77 and 63 number of filaments are generated for the 
                        k
                     th and 
                        
                           (
                           k
                           +
                           1
                           )
                        
                     th slices respectively where the location for each of these slices has been determined from the porosity function discussed in Section  2.6.

There is some material over deposition along the outer and inner edges, which is clearly visible in both Figs. 31(b) and 32(b). This is due to the sharp and sudden changes in the tool-path direction along the edge. Adjusting the feed rate particularly at these edges could reduce this over deposition but complete elimination would be a challenge for our current fabrication setup. Despite such limitations, the bio-fabrication process could directly print the designed optimum scaffolds layer by layer using biodegradable hydrogels.

The fabricated models have been analyzed using IMAGEJ software. To identify the iso-porosity regions and their proper characterization, the virtual models have been overlaid on the fabricated model to perform the analysis as shown in Fig. 33
                     . To avoid measuring complexity, no partial pore cells are considered during the image analysis. For unbiased sampling during the average porosity calculation, we tried to measure 1 pore cells in every 
                        2
                        
                        
                           
                              
                                 mm
                              
                           
                           
                              2
                           
                        
                      area of the fabricated sample. As shown in the table, the porosity varies within the iso porosity regions but the average matches the desired porosity pattern. The weighted error for both the models is calculated by considering the percentage area contribution and the corresponding average error of the individual contours. For both the model, the weighted error remains close to 4%. Thus, our proposed modeling technique keeps the weighted error low for the whole system by determining the filaments deposition locations as shown in Table 3
                     .

@&#SUMMARY@&#

In this research, a novel modeling approach for heterogeneous scaffolds with functionally gradient porosity is developed. The build direction is optimized to generate layers with heterogeneity. The layers along the desired build direction are analyzed and the design methodology generates spatial variational porosity following the heterogeneity of the internal regions. An optimum filament deposition angle for the layers is determined by considering spatial in-homogeneity. A function based approach is developed to determine the actual filament locations that can minimize the porous heterogeneity while attaining the desired porosity as close as to the intend one. Achieving the exact porosity in a heterogeneous scaffold may not be possible by the proposed methodology; however, the developed methods minimize the deviation between the desired and the designed porosity while ensuring continuity and connectivity of the deposited filaments. The layer based design method optimizes the bi-layer section and combining them can generate the 3D porous structure. The developed methodologies could be used by additive manufacturing based processes where a continuous filament of heterogeneous biomaterial needs to be deposited continuously. A continuous path planning has been developed for each layer to fabricate the micro-porous structures. To demonstrate the manufacturability of the designed scaffolds, several example designs are fabricated with a bio-additive fabrication system.

@&#ACKNOWLEDGMENTS@&#

The research was partially supported by the Telemedicine and Advanced Technology Research Center (TATRC) at the US Army Medical Research and Material Command (USAMRMC) through award W81XWH-05-1-0401 and by EU FP7 Marie Curie Grant #: PCIG09-GA-2011-294088 awarded to Dr. Koc.

@&#REFERENCES@&#

