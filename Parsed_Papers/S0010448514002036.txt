@&#MAIN-TITLE@&#Hexahedral mesh smoothing via local element regularization and global mesh optimization

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A novel local to global hexahedral mesh smoothing algorithm is proposed.


                        
                        
                           
                           An element size adjustment method is proposed to scale transformed ideal elements.


                        
                        
                           
                           The volumetric Laplacian operator is used to stitch the regularized elements.


                        
                        
                           
                           Geometric constraints of surface meshes are introduced to global optimization.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Hexahedral mesh

Mesh quality

Mesh smoothing

Volumetric Laplacian

@&#ABSTRACT@&#


               Graphical abstract
               
                  
                     
                        
                           
                        
                     
                  
               
            

@&#INTRODUCTION@&#

Hexahedral meshes are preferred to tetrahedral meshes in many finite element analysis applications, since hexahedral meshes offer several numerical advantages over tetrahedral meshes due to their tensor product nature  [1]. However, the automatic hexahedral mesh generation for a complicated three-dimensional solid remains far more challenging than the generation of tetrahedral meshes. Many hexahedral meshes are generated by the divide and conquer approach that decomposes the entire geometry into several simpler volumes  [2], which can be subsequently meshed by using mapping/sub-mapping  [3,4], sweeping  [5,6], and advancing front method  [7,8]. However, for solid models with complex geometries, hexahedral meshing frequently produces meshes of unsatisfactory quality. As accuracy and reliability of finite element analysis results depend on mesh quality, there is frequently a need to improve the quality of hexahedral meshes.

Hexahedral mesh quality improvement involves two main approaches: node-smoothing method and topological modification method  [9,10]. The topological modification method is used for hexahedral meshes which have poor topological connections with neighboring meshes. In most cases, topological modifications of hexahedral meshes are far more complex than other types of meshes due to their specific adjacency structure. Therefore, we focus on node-smoothing method, which can improve mesh quality only based on node movements without altering mesh topology.

Much work has been done on hexahedral mesh smoothing, and the related techniques can be classified by the general strategies they employ, including local smoothing and global smoothing. While local smoothing methods operate one vertex at a time to improve mesh quality in a neighborhood of that vertex, global smoothing methods aim to improve the overall mesh quality by solving a linear or non-linear system. Laplacian smoothing method is considered as the most well-known local smoothing method for mesh smoothing  [11]. In Laplacian smoothing, nodes are iteratively moved to the geometric center by weighting the contribution of each neighboring node in the averaging function. While Laplacian method is simple and easy to use, it may produce invalid elements and is not effective in models which have non-convex regions. In order to ensure the mesh quality improvement and to prevent the generation of invalid elements, a smart variant of Laplacian smoothing is proposed, where node moves only if the quality of the local mesh is improved  [12]. Freitag and Plassmann  [13] presented a local optimization method for mesh quality improvement which aims to maximize the sum of minimal angle of local influence mesh, and new node positions can be obtained by solving a non-linear system using an analogue of the steepest descent method. Instead of mesh quality, a node quality metric is chosen in  [14] and a combined gradient driven and simulated annealing technique is used to force each node to a better position. Zhang et al.  [15] proposed a feature preserving mesh quality improvement method, which moves each surface node in their tangent plane and relocates every inner node to the mass center of all its surrounding hexahedra to improve the aspect ratio. Vartziotis and Wipper  [16,17] proposed a geometric element transformation method (GETMe) for hexahedral mesh smoothing based on a dual element based regularizing transformation, in which low quality elements are sequentially transformed and new inner node positions are updated by averaging the transformed element nodes only if quality is improved. While local smoothing is simple and computationally efficient, it cannot guarantee the quality improvement of overall mesh.

The most widely used global smoothing is global optimization-based method. In global optimization-based method, mesh quality improvement is performed by the minimization of a smoothed objective function, which is established based on different mesh quality metrics. The existing methods differ mainly in the quality metrics and minimization techniques used. In  [18], the condition number of Jacobian matrix is chosen to create global objective functions, and smoothing results can be obtained by conjugate gradient and line-search method. With the same objective function, Yilmaz and Kuzuoglu  [19] proposed a particle swarm approach based smoothing method to improve the overall mesh quality. Guerra  [20] presented a modified objective function of hexahedral meshes that depends on the shape matrix and a function used in tetrahedral mesh smoothing, and the global minimum with this modified objective function can be reached by Newton–Raphson method. While global optimization-based methods yield better results, they are computationally expensive and non-convergence occurs in some cases. In  [21], a physics-based smoothing method is used to improve the overall mesh quality, in which hexahedral meshes are deformed by resolving a linear system composed of global stiffness matrix. Physics-based smoothing method provides good results while it is only applicable to hexahedral meshes without poor quality. In addition, the space mapping technique is introduced to the improvement of the quality of tetrahedral and hexahedral meshes  [22].

While hexahedral mesh smoothing methods considered only local smoothing or global smoothing, the smoothing operations often led to invalid quality improvements and non-convergence results. Additionally, most of hexahedral mesh smoothing methods did not take into account the effect of surface mesh quality on smoothing results, since the quality of surface meshes is one of the key factors that affect the improvement of the minimal element quality. In this paper, we proposed a local to global hexahedral mesh smoothing algorithm using the volumetric Laplacian. Instead of a local or global smoothing technique, our smoothing algorithm consists of geometric transformation based local regularization and global optimization using the volumetric Laplacian operator. The global optimization procedure is performed by the minimization of a quadric energy function, which is composed of volumetric Laplacian operator, transformed node displacements and geometric constraints of surface meshes.

Contributions of this paper are summarized as follows: 
                           
                              –
                              An element size adjustment algorithm based on edge direction constraints and node position constraints is proposed to scale ideal elements produced by geometric transformation.

The global volumetric Laplacian operator is used to stitch the regularized elements that can ensure the validity of smoothed hexahedral meshes.

Geometric constraints of surface meshes are introduced to global optimization of hexahedral meshes that can highly improve the minimal quality of hexahedral meshes.

Our hexahedral mesh smoothing algorithm is based on a local to global smoothing strategy, which consists of local hexahedron regularization and global optimization. Each individual hexahedral element is locally regularized by dual element based geometric transformation method. The geometric transformation has a strong regularizing effect, and meanwhile the size of the hexahedral element might also changes significantly. The size of the ideal element obtained by geometric transformation must be adjusted so that the regularized element keeps the size close to the initial one. In order to stitch the regularized elements together, we adopt the volumetric Laplacian operator in a global way and surface geometric constraints are also introduced to preserve the features of the original hexahedral meshes. The steps of our algorithm are described as follows: 
                        
                           Step 1:
                           Local regularization of hexahedral meshes

For each element of the input hexahedral meshes, performing the following steps: 
                                 
                                    Step 1.1
                                    Transform the element to its corresponding ideal element by using dual element based geometric transformation method.

Adjust the size of the transformed ideal element. Relocate the transformed ideal element nodes to minimize the distance to their corresponding nodes of the initial element without changing the edge direction of the ideal element.

Global optimization of hexahedral meshes 
                                 
                                    Step 2.1
                                    Compute the transformed displacement of each node in hexahedral meshes by averaging the temporary transformed displacements of each node.

Extract the feature point constraints and normal constraints of the surface meshes in hexahedral meshes, and compute the normal of the normal constraints.

Compute the displacements for all nodes by minimizing a quadric energy function, which is established by the global Laplacian operator, transformed node displacements and geometric constraints of the surface meshes.

Termination control 
                                 
                                    Step3.1
                                    Compute the norm of the displacement vector calculated by step 2.3.

Terminate if the norm of the displacement vector is below a given tolerance or maximal number of iterations reached. Otherwise go to step 1.

In general, hexahedral meshes include hexahedral element, pentahedral element, and their combination. Hence, hexahedral and pentahedral elements are considered in our algorithm, and dual element based geometric transformation method is used to transform different types of elements to their ideal elements. Instead of the volume preserving method in GETMe, we proposed an element size adjustment method to scale the ideal element transformed by geometric transformation method.

Given a hexahedral element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 
                                    hex
                                 
                              
                           
                           =
                           
                              (
                              
                                 
                                    v
                                 
                                 
                                    1
                                    ,
                                    j
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    8
                                    ,
                                    j
                                 
                              
                              )
                           
                         and a pentahedral element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 
                                    pen
                                 
                              
                           
                           =
                           
                              (
                              
                                 
                                    v
                                 
                                 
                                    1
                                    ,
                                    j
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    6
                                    ,
                                    j
                                 
                              
                              )
                           
                           ,
                           
                              
                                 v
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                         is the nodes of the given elements, the node indices for different element types are described in Fig. 1
                        . In order to illustrate the construction and transformation of dual element, we adopt the node matrices to represent all elements. The node index matrices of element faces can be defined as:
                           
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          
                                             hex
                                          
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          (
                                          1
                                          ,
                                          2
                                          ,
                                          3
                                          ,
                                          4
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          5
                                          ,
                                          6
                                          ,
                                          2
                                          )
                                       
                                       ,
                                       
                                          (
                                          2
                                          ,
                                          6
                                          ,
                                          7
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          3
                                          ,
                                          7
                                          ,
                                          8
                                          ,
                                          4
                                          )
                                       
                                       ,
                                       
                                          (
                                          4
                                          ,
                                          8
                                          ,
                                          5
                                          ,
                                          1
                                          )
                                       
                                       ,
                                       
                                          (
                                          5
                                          ,
                                          8
                                          ,
                                          7
                                          ,
                                          6
                                          )
                                       
                                       )
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          
                                             pen
                                          
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          (
                                          1
                                          ,
                                          2
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          4
                                          ,
                                          5
                                          ,
                                          2
                                          )
                                       
                                       ,
                                       
                                          (
                                          2
                                          ,
                                          5
                                          ,
                                          6
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          3
                                          ,
                                          6
                                          ,
                                          4
                                          ,
                                          1
                                          )
                                       
                                       ,
                                       
                                          (
                                          4
                                          ,
                                          6
                                          ,
                                          5
                                          )
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

The geometric transformation approach is based on the dual elements, which are generated by averaging the nodes of each face in different elements. The nodes 
                           
                              
                                 O
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                         of a dual element are calculated by: 
                           
                              (1)
                              
                                 
                                    
                                       O
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 =
                                 1
                                 /
                                 
                                    |
                                    
                                       
                                          F
                                       
                                       
                                          i
                                       
                                    
                                    |
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       
                                          |
                                          
                                             
                                                F
                                             
                                             
                                                i
                                             
                                          
                                          |
                                       
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       F
                                       
                                          (
                                          i
                                          ,
                                          k
                                          )
                                       
                                       ,
                                       j
                                    
                                 
                                 
                                 i
                                 =
                                 
                                    (
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       |
                                       F
                                       |
                                    
                                    )
                                 
                              
                           
                         where 
                           F
                           
                              (
                              i
                              ,
                              k
                              )
                           
                         is the element of 
                           i
                        th row and 
                           k
                        th column in node index matrix; 
                           
                              |
                              
                                 
                                    F
                                 
                                 
                                    i
                                 
                              
                              |
                           
                         denotes the number of nodes in the 
                           i
                        th face and 
                           
                              |
                              F
                              |
                           
                         is the number of element faces. For dual elements shown in Fig. 1, their node indices of element faces are given by: 
                           
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          
                                             hex
                                          
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          (
                                          1
                                          ,
                                          2
                                          ,
                                          5
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          3
                                          ,
                                          2
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          4
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          5
                                          ,
                                          4
                                          )
                                       
                                       ,
                                       
                                          (
                                          6
                                          ,
                                          5
                                          ,
                                          2
                                          )
                                       
                                       ,
                                       
                                          (
                                          6
                                          ,
                                          2
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          6
                                          ,
                                          3
                                          ,
                                          4
                                          )
                                       
                                       ,
                                       
                                          (
                                          6
                                          ,
                                          4
                                          ,
                                          5
                                          )
                                       
                                       )
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          
                                             pen
                                          
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          (
                                          1
                                          ,
                                          2
                                          ,
                                          4
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          3
                                          ,
                                          2
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          4
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          5
                                          ,
                                          2
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          5
                                          ,
                                          3
                                          ,
                                          4
                                          )
                                       
                                       ,
                                       
                                          (
                                          5
                                          ,
                                          4
                                          ,
                                          2
                                          )
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

The transformed element nodes can be generated by moving the base points along the normals of dual element faces, where the normals 
                           
                              
                                 
                                    n
                                 
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                         are oriented outward and can be defined as: 
                           
                              (2)
                              
                                 
                                    
                                       
                                          n
                                       
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          O
                                       
                                       
                                          G
                                          
                                             (
                                             i
                                             ,
                                             2
                                             )
                                          
                                          ,
                                          j
                                       
                                    
                                    −
                                    
                                       
                                          O
                                       
                                       
                                          G
                                          
                                             (
                                             i
                                             ,
                                             1
                                             )
                                          
                                          ,
                                          j
                                       
                                    
                                    )
                                 
                                 ×
                                 
                                    (
                                    
                                       
                                          O
                                       
                                       
                                          G
                                          
                                             (
                                             i
                                             ,
                                             3
                                             )
                                          
                                          ,
                                          j
                                       
                                    
                                    −
                                    
                                       
                                          O
                                       
                                       
                                          G
                                          
                                             (
                                             i
                                             ,
                                             1
                                             )
                                          
                                          ,
                                          j
                                       
                                    
                                    )
                                 
                                 
                                 i
                                 =
                                 
                                    (
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       |
                                       G
                                       |
                                    
                                    )
                                 
                              
                           
                         where 
                           
                              |
                              G
                              |
                           
                         denotes the number of dual element faces, which is equal to the number of element nodes. Suitable base points for regularizing transformation scheme are defined with different element types:
                           
                              (3)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                             =
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      |
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      |
                                                   
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      |
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      |
                                                   
                                                
                                             
                                             
                                                
                                                   O
                                                
                                                
                                                   G
                                                   
                                                      (
                                                      i
                                                      ,
                                                      k
                                                      )
                                                   
                                                   ,
                                                   j
                                                
                                             
                                             
                                             if  
                                             
                                                
                                                   E
                                                
                                                
                                                   j
                                                
                                             
                                             =
                                             
                                                
                                                   E
                                                
                                                
                                                   
                                                      hex
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                λ
                                                )
                                             
                                             =
                                             
                                                (
                                                1
                                                −
                                                λ
                                                )
                                             
                                             
                                                
                                                   O
                                                
                                                
                                                   G
                                                   
                                                      (
                                                      i
                                                      ,
                                                      1
                                                      )
                                                   
                                                   ,
                                                   j
                                                
                                             
                                             +
                                             1
                                             /
                                             2
                                             λ
                                             
                                                (
                                                
                                                   
                                                      O
                                                   
                                                   
                                                      G
                                                      
                                                         (
                                                         i
                                                         ,
                                                         2
                                                         )
                                                      
                                                      ,
                                                      j
                                                   
                                                
                                                +
                                                
                                                   
                                                      O
                                                   
                                                   
                                                      G
                                                      
                                                         (
                                                         i
                                                         ,
                                                         3
                                                         )
                                                      
                                                      ,
                                                      j
                                                   
                                                
                                                )
                                             
                                             
                                             if  
                                             
                                                
                                                   E
                                                
                                                
                                                   j
                                                
                                             
                                             =
                                             
                                                
                                                   E
                                                
                                                
                                                   
                                                      pen
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                 i
                                 =
                                 
                                    (
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       |
                                       G
                                       |
                                    
                                    )
                                 
                              
                           
                         where 
                           λ
                         is the weight of the midpoint of the edge opposite the triangular face apex, and it is deduced from the scaling factor 
                           μ
                         in  [17]. With a user defined scaling factor 
                           μ
                           >
                           0
                        , the nodes 
                           
                              
                                 v
                              
                              
                                 i
                                 ,
                                 j
                              
                              
                                 ′
                              
                           
                         of the transformed element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 ′
                              
                           
                         can be obtained by 
                           
                              (4)
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       b
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 +
                                 
                                    
                                       μ
                                    
                                    
                                       
                                          
                                             
                                                |
                                                
                                                   
                                                      
                                                         n
                                                      
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                |
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          n
                                       
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 
                                 i
                                 =
                                 
                                    (
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       |
                                       G
                                       |
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

The transformation for different types of elements is depicted in Fig. 2
                         for the specific choice 
                           μ
                           =
                           1
                        . Here, the faces of dual elements are marked gray with blue edges, the base points 
                           
                              
                                 b
                              
                              
                                 k
                              
                           
                         are indicated by black markers, and the normals 
                           
                              
                                 n
                              
                              
                                 k
                              
                           
                         by black arrows. The initial hexahedron is shown in Fig. 2(a) marked by red dotted lines, and its corresponding dual element in Fig. 2(a) is determined according to Eq. (1). Fig. 2(b) shows the transformed hexahedron marked by red dotted lines. Fig. 2(c) and (d) illustrate the transformation for a pentahedron. The red dotted lines in Fig. 2(c) shows the initial pentahedron, and the transformed pentahedron is shown in Fig. 2(d) by red dotted lines. As can be seen from Fig. 2, the transformation has a strong regularizing effect, which can transform a general hexahedral element to ideal element by consecutively applying the transformation three times. Since the transformation involves a scaling operation, the element size also changes significantly. Therefore, in order to keep the size of the initial element, we need to adjust the size of the transformed ideal element.

Given an ideal element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 ′
                              
                           
                        , our goal is to create another element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 ″
                              
                           
                         with high quality which is as close as possible to the initial element. Thus, the size adjustment is formulated as a quadric optimization problem, where the minimized energy contains two terms, one is the edge direction constraints of the ideal element which keeps the high quality and the second is the node position constraints of the initial element which reserves the element size. First, we construct a direction preserving function for all edges, the node index matrices of element edges can be defined as: 
                           
                              
                                 
                                    
                                       
                                          E
                                       
                                       
                                          
                                             hex
                                          
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          (
                                          1
                                          ,
                                          2
                                          )
                                       
                                       ,
                                       
                                          (
                                          2
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          3
                                          ,
                                          4
                                          )
                                       
                                       ,
                                       
                                          (
                                          4
                                          ,
                                          1
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          5
                                          )
                                       
                                       ,
                                       
                                          (
                                          2
                                          ,
                                          6
                                          )
                                       
                                       ,
                                       
                                          (
                                          3
                                          ,
                                          7
                                          )
                                       
                                       ,
                                       
                                          (
                                          4
                                          ,
                                          8
                                          )
                                       
                                       ,
                                       
                                          (
                                          5
                                          ,
                                          6
                                          )
                                       
                                       ,
                                       
                                          (
                                          6
                                          ,
                                          7
                                          )
                                       
                                       ,
                                       
                                          (
                                          7
                                          ,
                                          8
                                          )
                                       
                                       ,
                                       
                                          (
                                          8
                                          ,
                                          5
                                          )
                                       
                                       )
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          E
                                       
                                       
                                          
                                             pen
                                          
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          (
                                          1
                                          ,
                                          2
                                          )
                                       
                                       ,
                                       
                                          (
                                          2
                                          ,
                                          3
                                          )
                                       
                                       ,
                                       
                                          (
                                          3
                                          ,
                                          1
                                          )
                                       
                                       ,
                                       
                                          (
                                          1
                                          ,
                                          4
                                          )
                                       
                                       ,
                                       
                                          (
                                          2
                                          ,
                                          5
                                          )
                                       
                                       ,
                                       
                                          (
                                          3
                                          ,
                                          6
                                          )
                                       
                                       ,
                                       
                                          (
                                          4
                                          ,
                                          5
                                          )
                                       
                                       ,
                                       
                                          (
                                          5
                                          ,
                                          6
                                          )
                                       
                                       ,
                                       
                                          (
                                          6
                                          ,
                                          4
                                          )
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

For each edge 
                           
                              
                                 
                                    e
                                 
                              
                              
                                 E
                                 
                                    (
                                    k
                                    ,
                                    1
                                    )
                                 
                                 E
                                 
                                    (
                                    k
                                    ,
                                    2
                                    )
                                 
                                 ,
                                 j
                              
                              
                                 ″
                              
                           
                           =
                           
                              
                                 v
                              
                              
                                 E
                                 
                                    (
                                    k
                                    ,
                                    2
                                    )
                                 
                                 ,
                                 j
                              
                              
                                 ″
                              
                           
                           −
                           
                              
                                 v
                              
                              
                                 E
                                 
                                    (
                                    k
                                    ,
                                    1
                                    )
                                 
                                 ,
                                 j
                              
                              
                                 ″
                              
                           
                         of the element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 ″
                              
                           
                           ,
                           
                           k
                           ∈
                           
                              {
                              1
                              ,
                              …
                              ,
                              
                                 |
                                 E
                                 |
                              
                              }
                           
                        , it is parallel to the edge 
                           
                              
                                 
                                    e
                                 
                              
                              
                                 E
                                 
                                    (
                                    k
                                    ,
                                    1
                                    )
                                 
                                 E
                                 
                                    (
                                    k
                                    ,
                                    2
                                    )
                                 
                                 ,
                                 j
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 v
                              
                              
                                 E
                                 
                                    (
                                    k
                                    ,
                                    2
                                    )
                                 
                                 ,
                                 j
                              
                              
                                 ′
                              
                           
                           −
                           
                              
                                 v
                              
                              
                                 E
                                 
                                    (
                                    k
                                    ,
                                    1
                                    )
                                 
                                 ,
                                 j
                              
                              
                                 ′
                              
                           
                         of the ideal element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 ′
                              
                           
                        , where 
                           
                              
                                 v
                              
                              
                                 i
                                 ,
                                 j
                              
                              
                                 ″
                              
                           
                           =
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                                 
                                    ″
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                                 
                                    ″
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                                 
                                    ″
                                 
                              
                              )
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                         is the nodes of the adjusted element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 ″
                              
                           
                        . It can be formulized as:
                           
                              (5)
                              
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          E
                                          
                                             (
                                             k
                                             ,
                                             2
                                             )
                                          
                                          ,
                                          j
                                       
                                       
                                          ″
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          E
                                          
                                             (
                                             k
                                             ,
                                             1
                                             )
                                          
                                          ,
                                          j
                                       
                                       
                                          ″
                                       
                                    
                                    )
                                 
                                 ×
                                 
                                    
                                       
                                          e
                                       
                                    
                                    
                                       E
                                       
                                          (
                                          k
                                          ,
                                          1
                                          )
                                       
                                       E
                                       
                                          (
                                          k
                                          ,
                                          2
                                          )
                                       
                                       ,
                                       j
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 0
                              
                           
                         where 
                           
                              
                                 
                                    e
                                 
                              
                              
                                 E
                                 
                                    (
                                    k
                                    ,
                                    1
                                    )
                                 
                                 E
                                 
                                    (
                                    k
                                    ,
                                    2
                                    )
                                 
                                 ,
                                 j
                              
                              
                                 ′
                              
                           
                           =
                           
                              (
                              
                                 
                                    e
                                 
                                 
                                    x
                                 
                              
                              ,
                              
                                 
                                    e
                                 
                                 
                                    y
                                 
                              
                              ,
                              
                                 
                                    e
                                 
                                 
                                    z
                                 
                              
                              )
                           
                         can be easily calculated from the ideal element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 ′
                              
                           
                        . Eq. (5) can be written as: 
                           
                              (6)
                              
                                 
                                    [
                                    
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   z
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   e
                                                
                                                
                                                   y
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             −
                                             
                                                
                                                   e
                                                
                                                
                                                   z
                                                
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   y
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   z
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             −
                                             
                                                
                                                   e
                                                
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   e
                                                
                                                
                                                   z
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   x
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   y
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   e
                                                
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             −
                                             
                                                
                                                   e
                                                
                                                
                                                   y
                                                
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    
                                       
                                          [
                                          
                                             
                                                x
                                             
                                             
                                                E
                                                
                                                   (
                                                   k
                                                   ,
                                                   1
                                                   )
                                                
                                                ,
                                                j
                                             
                                             
                                                ″
                                             
                                          
                                          
                                          
                                             
                                                y
                                             
                                             
                                                E
                                                
                                                   (
                                                   k
                                                   ,
                                                   1
                                                   )
                                                
                                                ,
                                                j
                                             
                                             
                                                ″
                                             
                                          
                                          
                                          
                                             
                                                z
                                             
                                             
                                                E
                                                
                                                   (
                                                   k
                                                   ,
                                                   1
                                                   )
                                                
                                                ,
                                                j
                                             
                                             
                                                ″
                                             
                                          
                                          
                                          
                                             
                                                x
                                             
                                             
                                                E
                                                
                                                   (
                                                   k
                                                   ,
                                                   2
                                                   )
                                                
                                                ,
                                                j
                                             
                                             
                                                ″
                                             
                                          
                                          
                                          
                                             
                                                y
                                             
                                             
                                                E
                                                
                                                   (
                                                   k
                                                   ,
                                                   2
                                                   )
                                                
                                                ,
                                                j
                                             
                                             
                                                ″
                                             
                                          
                                          
                                          
                                             
                                                z
                                             
                                             
                                                E
                                                
                                                   (
                                                   k
                                                   ,
                                                   2
                                                   )
                                                
                                                ,
                                                j
                                             
                                             
                                                ″
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       T
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                       
                                    
                                    ]
                                 
                                 .
                              
                           
                         Hence, the simultaneous equations of all edges can be obtained, which is equivalent to the matrix form: 
                           
                              (7)
                              
                                 
                                    
                                       
                                          KX
                                       
                                    
                                    
                                       
                                          E
                                       
                                    
                                 
                                 =
                                 0
                              
                           
                         where 
                           
                              K
                           
                         is a 
                           3
                           
                              |
                              E
                              |
                           
                           ×
                           3
                           
                              |
                              G
                              |
                           
                         matrix; 
                           
                              
                                 
                                    X
                                 
                              
                              
                                 
                                    E
                                 
                              
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       
                                          x
                                       
                                       
                                          1
                                          ,
                                          j
                                       
                                       
                                          ″
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          1
                                          ,
                                          j
                                       
                                       
                                          ″
                                       
                                    
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          1
                                          ,
                                          j
                                       
                                       
                                          ″
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          
                                             |
                                             G
                                             |
                                          
                                          ,
                                          j
                                       
                                       
                                          ″
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          
                                             |
                                             G
                                             |
                                          
                                          ,
                                          j
                                       
                                       
                                          ″
                                       
                                    
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          
                                             |
                                             G
                                             |
                                          
                                          ,
                                          j
                                       
                                       
                                          ″
                                       
                                    
                                    }
                                 
                              
                              
                                 T
                              
                           
                         is a 
                           3
                           
                              |
                              G
                              |
                           
                           ×
                           1
                         column vector of the node positions of the element 
                           
                              
                                 E
                              
                              
                                 j
                              
                              
                                 ″
                              
                           
                        .

In order to preserve the size of the initial element and keep the edge directions of the ideal element, the positions of all nodes 
                           
                              
                                 v
                              
                              
                                 i
                                 ,
                                 j
                              
                              
                                 ″
                              
                           
                         can be obtained by minimizing the following energy function: 
                           
                              (8)
                              
                                 
                                    
                                       min
                                    
                                    
                                       
                                          
                                             
                                                X
                                             
                                          
                                          
                                             
                                                E
                                             
                                          
                                       
                                    
                                 
                                 
                                    [
                                    
                                       
                                          θ
                                       
                                       
                                          K
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          
                                             ‖
                                             
                                                
                                                   
                                                      KX
                                                   
                                                
                                                
                                                   
                                                      E
                                                   
                                                
                                             
                                             ‖
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             |
                                             G
                                             |
                                          
                                       
                                    
                                    
                                       
                                          
                                             ‖
                                             
                                                
                                                   v
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                                
                                                   ″
                                                
                                             
                                             −
                                             
                                                
                                                   v
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                             ‖
                                          
                                       
                                       
                                          2
                                       
                                    
                                    ]
                                 
                              
                           
                         where 
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                         is the weight of the edge direction constraints. The above function is quadric in every node and hence its partial derivatives are linear expressions. The unique minimum is found if all partial derivatives with respect to the node vanish, which results in a sparse linear system as the following: 
                           
                              (9)
                              
                                 
                                    
                                       
                                          AX
                                       
                                    
                                    
                                       
                                          E
                                       
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   K
                                                
                                             
                                             
                                                K
                                             
                                          
                                       
                                       
                                          
                                             
                                                S
                                             
                                          
                                       
                                    
                                    )
                                 
                                 
                                    
                                       
                                          X
                                       
                                    
                                    
                                       
                                          E
                                       
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             0
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      B
                                                   
                                                
                                                
                                                   S
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    B
                                 
                              
                           
                         where 
                           
                              S
                           
                         is a 
                           3
                           
                              |
                              G
                              |
                           
                        -dimensional unit matrix used to constrain the position of element nodes; 
                           
                              
                                 
                                    B
                                 
                              
                              
                                 S
                              
                           
                         is a 
                           3
                           
                              |
                              G
                              |
                           
                           ×
                           1
                         column vector representing the target positions given by the initial element. Eq. (9) can be solved through a linear least square system: 
                           
                              (10)
                              
                                 
                                    
                                       
                                          X
                                       
                                    
                                    
                                       E
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   A
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             A
                                          
                                          )
                                       
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       
                                          A
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    B
                                 
                                 .
                              
                           
                        
                     

The construction of the regularized element for hexahedron is illustrated in Fig. 3
                        . Fig. 3(a) shows the initial hexahedron, and its corresponding ideal hexahedron obtained by dual element based transformation with 
                           μ
                           =
                           2
                           /
                           3
                         is plotted in Fig. 3(b) marked by red dotted lines. In Fig. 3(c)–(e), the final regularized hexahedrons indicated by black dotted lines are obtained by solving the sparse linear system in Eq. (9) with 
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           =
                           1
                           ,
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           =
                           5
                         and 
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           =
                           10
                         respectively. Fig. 4
                         is a regularization example of pentahedron. In this example, the ideal pentahedron are constructed by Eq. (4) with 
                           μ
                           =
                           2
                           /
                           3
                         marked by red dotted lines, shown in Fig. 4(b). The regularized elements are shown in Fig. 4(c)–(e) with 
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           =
                           1
                           ,
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           =
                           5
                         and 
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           =
                           10
                         respectively. In our experimentations, we found that the regularized elements are almost regular when we set 
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           ≥
                           5
                        .

Local regularization for all elements makes the hexahedral meshes disconnected, hence global optimization is used to stitch the disconnected hexahedral meshes, which is derived by solving a quadric energy function minimization problem. The energy function consists of three terms, including the volumetric Laplacian operator, transformed node displacements and geometric constraints of surface meshes. The volumetric Laplacian operator and geometric constraints of surface meshes represent the volumetric details and the surface details of hexahedral meshes. Transformed node displacements are used to maintain the regularity of all elements.

Let 
                           M
                           =
                           
                              (
                              V
                              ,
                              K
                              )
                           
                         be the given hexahedral meshes we want to smooth, where 
                           V
                         is a set of nodes 
                           V
                           =
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    3
                                 
                              
                              |
                              1
                              ≤
                              i
                              ≤
                              n
                              }
                           
                        , and 
                           K
                         is an abstract simplicial complex which contains all the node connectivity information. There are four types of elements in 
                           K
                        , nodes 
                           
                              {
                              i
                              }
                           
                        , edges 
                           
                              {
                              i
                              ,
                              j
                              }
                           
                        , faces 
                           
                              {
                              i
                              ,
                              j
                              ,
                              k
                              }
                           
                        , and hexahedral elements 
                           
                              {
                              i
                              ,
                              j
                              ,
                              …
                              ,
                              q
                              }
                           
                        . The Laplacian coordinate 
                           
                              
                                 δ
                              
                              
                                 i
                              
                           
                         at node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         is defined as: 
                           
                              (11)
                              
                                 
                                    
                                       δ
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       L
                                    
                                    
                                       M
                                    
                                 
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ∈
                                       N
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                 
                                 
                                    
                                       ω
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          j
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                           
                         where 
                           N
                           
                              (
                              i
                              )
                           
                         is the index set of the neighboring nodes to node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , 
                           
                              
                                 ω
                              
                              
                                 i
                                 j
                              
                           
                         is the weight of edge 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                        , and 
                           
                              
                                 L
                              
                              
                                 M
                              
                           
                         is the Laplacian operator of the given hexahedral meshes. The weights 
                           
                              
                                 ω
                              
                              
                                 i
                                 j
                              
                           
                         should be positive and several weighting schemes  [23–26] have been proposed by using uniform weighting 
                           
                              
                                 ω
                              
                              
                                 i
                                 j
                              
                           
                           =
                           1
                           /
                           
                              |
                              N
                              
                                 (
                                 i
                                 )
                              
                              |
                           
                        , edge length or other similar criteria. We use a more complicated weighting scheme proposed by Liao et al.  [27], which refers only to tetrahedral meshes. Hence we divide the hexahedral meshes into tetrahedral meshes without adding new nodes, i.e. a hexahedron is divided into five tetrahedrons, and a pentahedron is divided into three tetrahedrons. The weights for edge 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                         in the divided tetrahedral meshes can be formulized as: 
                           
                              (12)
                              
                                 
                                    
                                       ω
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 =
                                 1
                                 /
                                 6
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       l
                                    
                                    
                                       k
                                    
                                 
                                 cot
                                 
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                              
                           
                         where 
                           
                              
                                 l
                              
                              
                                 k
                              
                           
                           =
                           
                              
                                 l
                              
                              
                                 p
                                 q
                              
                           
                         is the length of opposite edge 
                           
                              (
                              p
                              ,
                              q
                              )
                           
                         to which edge 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                         is against, and 
                           
                              
                                 θ
                              
                              
                                 k
                              
                           
                           =
                           
                              
                                 θ
                              
                              
                                 p
                                 q
                              
                           
                         is the dihedral angle, as shown in Fig. 5
                        .

To avoid the generation of invalid elements and quality deterioration caused by uncoordinated displacements of individual nodes obtained by the average function in Section  4.2, we try to preserve the Laplacian coordinates during global optimization, which is equivalent to minimize the following energy function:


                        
                           
                              (13)
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                       ∈
                                       V
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             
                                                L
                                             
                                             
                                                M
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   v
                                                
                                                
                                                   i
                                                
                                             
                                             +
                                             
                                                Δ
                                             
                                             
                                                
                                                   v
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          −
                                          
                                             
                                                δ
                                             
                                             
                                                i
                                             
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where 
                           
                              Δ
                           
                           v
                           i
                           =
                           
                              (
                              
                                 Δ
                              
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 Δ
                              
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 Δ
                              
                              
                                 
                                    z
                                 
                                 
                                    i
                                 
                              
                              )
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                         is the node displacement of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , and 
                           
                              
                                 δ
                              
                              
                                 i
                              
                           
                         is the Laplacian coordinate defined in Eq. (11) without rotation and isotropic scale. Note that the quadric energy function is defined for each component of the coordinates 
                           x
                           ,
                           y
                         and 
                           z
                        , whereas the 
                           x
                           ,
                           y
                         and 
                           z
                         coordinates are related with each other by a linear equation in geometric constraints described in Section  4.3. Thus the improvement conditions of all vertices in three coordinate components can be represented in matrix form: 
                           
                              (14)
                              
                                 
                                    
                                       
                                          ‖
                                          
                                             L
                                          
                                          
                                             Δ
                                          
                                          
                                             X
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where 
                           
                              Δ
                           
                           
                              X
                           
                           =
                           
                              
                                 
                                    {
                                    
                                       Δ
                                    
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       Δ
                                    
                                    
                                       
                                          y
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       Δ
                                    
                                    
                                       
                                          z
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       Δ
                                    
                                    
                                       
                                          x
                                       
                                       
                                          n
                                       
                                    
                                    ,
                                    
                                       Δ
                                    
                                    
                                       
                                          y
                                       
                                       
                                          n
                                       
                                    
                                    ,
                                    
                                       Δ
                                    
                                    
                                       
                                          z
                                       
                                       
                                          n
                                       
                                    
                                    }
                                 
                              
                              
                                 T
                              
                           
                         is a 
                           3
                           n
                           ×
                           1
                         column vector of the node displacements, and 
                           
                              L
                           
                         is a 
                           3
                           n
                           ×
                           3
                           n
                         matrix with elements derived from 
                           
                              
                                 ω
                              
                              
                                 i
                                 j
                              
                           
                        : 
                           
                              (15)
                              
                                 
                                    
                                       
                                          L
                                       
                                    
                                    
                                       
                                          (
                                          3
                                          i
                                          ,
                                          3
                                          j
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          L
                                       
                                    
                                    
                                       
                                          (
                                          3
                                          i
                                          +
                                          1
                                          ,
                                          3
                                          j
                                          +
                                          1
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          L
                                       
                                    
                                    
                                       
                                          (
                                          3
                                          i
                                          +
                                          2
                                          ,
                                          3
                                          j
                                          +
                                          2
                                          )
                                       
                                    
                                 
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   ∈
                                                   N
                                                   
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   ω
                                                
                                                
                                                   i
                                                   k
                                                
                                             
                                             ,
                                             
                                             if  
                                             i
                                             =
                                             j
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   ω
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             ,
                                             
                                             if  
                                             j
                                             ∈
                                             N
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                       
                                       
                                          
                                             0
                                             ,
                                             
                                             otherwise .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Let 
                           E
                           
                              (
                              i
                              )
                           
                           ⊆
                           M
                         denote the index set of all elements adjacent to node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        . Local regularizations for elements in 
                           E
                           
                              (
                              i
                              )
                           
                         yield 
                           
                              |
                              E
                              
                                 (
                                 i
                                 )
                              
                              |
                           
                         new temporary transformed element nodes for node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , where 
                           
                              |
                              E
                              
                                 (
                                 i
                                 )
                              
                              |
                           
                         is the number of elements in 
                           E
                           
                              (
                              i
                              )
                           
                        . For each node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , new target position 
                           
                              
                                 v
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           =
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    i
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         is determined by a linear combination of the temporary transformed element nodes: 
                           
                              (16)
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             ∈
                                             E
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                       
                                       
                                          
                                             α
                                          
                                          
                                             j
                                          
                                       
                                       
                                          
                                             v
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                          
                                             ″
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             ∈
                                             E
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                       
                                       
                                          
                                             α
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              
                                 v
                              
                              
                                 i
                                 ,
                                 j
                              
                              
                                 ″
                              
                           
                         is the temporary node of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         in element 
                           
                              
                                 E
                              
                              
                                 j
                              
                           
                        , and 
                           
                              
                                 α
                              
                              
                                 j
                              
                           
                         is the contribution of element 
                           
                              
                                 E
                              
                              
                                 j
                              
                           
                        , which can be weighted by using its mesh quality: 
                           
                              (17)
                              
                                 
                                    
                                       α
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    (
                                    1
                                    −
                                    
                                       J
                                    
                                    
                                       (
                                       
                                          
                                             E
                                          
                                          
                                             j
                                          
                                       
                                       )
                                    
                                    )
                                 
                              
                           
                         where 
                           
                              J
                           
                           
                              (
                              
                                 
                                    E
                                 
                                 
                                    j
                                 
                              
                              )
                           
                         denotes the mesh quality of element 
                           
                              
                                 E
                              
                              
                                 j
                              
                           
                         evaluated by the Scaled Jacobian metric proposed in  [28]. For a hexahedral element 
                           
                              
                                 E
                              
                              
                                 j
                              
                           
                           =
                           
                              (
                              
                                 
                                    v
                                 
                                 
                                    1
                                    ,
                                    j
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    8
                                    ,
                                    j
                                 
                              
                              )
                           
                           ,
                           
                              
                                 v
                              
                              
                                 m
                                 ,
                                 j
                              
                           
                           =
                           
                              (
                              x
                              ,
                              y
                              ,
                              z
                              )
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                         is 
                           m
                        th node in a hexahedron, here we use hexahedron to represent the unstructured mesh that consists of hexahedral and pentahedral elements. Thus, the three normalized edge vectors from the 
                           m
                        th node to three neighboring nodes are defined as 
                           
                              
                                 e
                              
                              
                                 m
                                 k
                              
                           
                           =
                           
                              
                                 N
                              
                              
                                 k
                              
                           
                           −
                           
                              
                                 N
                              
                              
                                 m
                              
                           
                           
                           
                              (
                              k
                              =
                              1
                              ,
                              2
                              ,
                              3
                              )
                           
                        . The Scaled Jacobian matrix at the 
                           m
                        th node is 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 m
                              
                           
                           =
                           
                              [
                              
                                 
                                    
                                       e
                                    
                                 
                                 
                                    m
                                    1
                                 
                              
                              
                              
                                 
                                    
                                       e
                                    
                                 
                                 
                                    m
                                    2
                                 
                              
                              
                              
                                 
                                    
                                       e
                                    
                                 
                                 
                                    m
                                    3
                                 
                              
                              ]
                           
                        , and the value of Scaled Jacobian is the determinant of the matrix 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 m
                              
                           
                        , as shown in Eq. (18). 
                           
                              (18)
                              
                                 
                                    ScaledJacobian
                                 
                                 
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          m
                                          j
                                       
                                    
                                    )
                                 
                                 =
                                 det
                                 
                                    (
                                    
                                       
                                          
                                             J
                                          
                                       
                                       
                                          m
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

The final Scaled Jacobian of the element 
                           
                              
                                 E
                              
                              
                                 j
                              
                           
                         is the minimal value of the Scaled Jacobian at all nodes in hexahedron: 
                           
                              J
                           
                           
                              (
                              
                                 
                                    E
                                 
                                 
                                    j
                                 
                              
                              )
                           
                           =
                           min
                           
                              (
                              
                                 ScaledJacobian
                              
                              
                              
                                 (
                                 
                                    
                                       v
                                    
                                    
                                       m
                                       j
                                    
                                 
                                 )
                              
                              )
                           
                           ,
                           
                           m
                           =
                           
                              (
                              1
                              ,
                              …
                              ,
                              8
                              )
                           
                        .

In order to keep the regularity of all elements, we try to minimize the following energy function: 
                           
                              (19)
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                       ∈
                                       V
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          +
                                          
                                             Δ
                                          
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          −
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         which is equivalent to the matrix form: 
                           
                              (20)
                              
                                 
                                    
                                       
                                          ‖
                                          
                                             T
                                          
                                          
                                             Δ
                                          
                                          
                                             X
                                          
                                          −
                                          
                                             R
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where 
                           
                              T
                           
                         is a 
                           3
                           n
                           ×
                           3
                           n
                         identity matrix and 
                           
                              R
                           
                         is a 
                           3
                           n
                           ×
                           1
                         column vector of the transformed displacements of the initial node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         to the transformed node 
                           
                              
                                 v
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           :
                           
                              
                                 
                                    R
                                 
                              
                              
                                 3
                                 i
                              
                           
                           =
                           
                              
                                 x
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           −
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 
                                    R
                                 
                              
                              
                                 3
                                 i
                                 +
                                 1
                              
                           
                           =
                           
                              
                                 y
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           −
                           −
                           
                              
                                 y
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 
                                    R
                                 
                              
                              
                                 3
                                 i
                                 +
                                 2
                              
                           
                           =
                           
                              
                                 z
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           −
                           
                              
                                 z
                              
                              
                                 i
                              
                           
                           ,
                           
                           i
                           =
                           
                              (
                              1
                              ,
                              …
                              ,
                              n
                              )
                           
                        .

Surface meshes of hexahedral meshes represent the geometric features of the solid model, in order to keep the features of the given solid model during mesh smoothing, several feature nodes are first detected and all surface nodes are classified into two types of geometric constraints, i.e. feature point constraints and normal constraints. When a node is a normal constraint, it can only be moved in its tangent plane, while a feature point constraint node cannot be moved. Laplacian coordinates represent the local details of surface meshes  [29], hence feature points of the surface meshes can be determined quickly by Laplacian coordinates. In order to describe the local curvature features more accurately, we use an improved Laplacian coordinates based on mean value coordinates on tangent plane to detect the feature points  [30].

Let 
                           M
                           s
                           =
                           
                              (
                              V
                              s
                              ,
                              E
                              s
                              ,
                              F
                              s
                              )
                           
                         be the surface meshes of the given hexahedral meshes 
                           M
                        , where 
                           V
                           s
                           =
                           
                              (
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    r
                                 
                              
                              )
                           
                           ⊆
                           V
                         is the index set of all surface nodes, 
                           E
                           s
                           ⊆
                           K
                         is the set of edges, and 
                           F
                           s
                           ⊆
                           K
                         is the set of surface element meshes. The adjacent node index set of node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         are denoted by 
                           N
                           s
                           
                              (
                              i
                              )
                           
                           =
                           
                              {
                              j
                              ∣
                              
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                              ∈
                              E
                              s
                              }
                           
                        , the number of adjacent nodes is called the degree of node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , and is denoted as 
                           
                              |
                              N
                              s
                              
                                 (
                                 i
                                 )
                              
                              |
                           
                        . For each node 
                           
                              
                                 v
                              
                              
                                 j
                              
                           
                           ∈
                           N
                           s
                           
                              (
                              i
                              )
                           
                        , as shown in Fig. 6
                        , the orientation distance to the tangent plane 
                           
                              
                                 F
                              
                              
                                 i
                              
                           
                         of 
                           
                              
                                 v
                              
                              
                                 j
                              
                           
                         can be expressed as: 
                           
                              (21)
                              
                                 
                                    
                                       d
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       
                                          n
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ⋅
                                 
                                    
                                       v
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 
                                    
                                       d
                                    
                                    
                                       i
                                    
                                 
                              
                           
                         where 
                           
                              
                                 d
                              
                              
                                 i
                              
                           
                           =
                           −
                           
                              
                                 
                                    n
                                 
                              
                              
                                 i
                              
                           
                           ⋅
                           
                              
                                 
                                    v
                                 
                              
                              
                                 i
                              
                           
                        , and 
                           
                              
                                 
                                    n
                                 
                              
                              
                                 i
                              
                           
                         is the unit normal vector of the tangent plane 
                           
                              
                                 F
                              
                              
                                 i
                              
                           
                        , which can be obtained by averaging the normal of elements adjacent to 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        :
                           
                              (22)
                              
                                 
                                    
                                       
                                          n
                                       
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          |
                                          N
                                          s
                                          
                                             (
                                             i
                                             )
                                          
                                          |
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       
                                          |
                                          N
                                          s
                                          
                                             (
                                             i
                                             )
                                          
                                          |
                                       
                                    
                                 
                                 
                                    
                                       
                                          n
                                       
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         where 
                           
                              
                                 
                                    n
                                 
                              
                              
                                 j
                              
                           
                         is the unit normal vector of the neighboring element of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        .

The improved Laplacian coordinate 
                           δ
                           
                              
                                 s
                              
                              
                                 i
                              
                           
                         at node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           
                           
                              (
                              1
                              ≤
                              i
                              ≤
                              r
                              )
                           
                         is defined as follows: 
                           
                              (23)
                              
                                 δ
                                 
                                    
                                       s
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       
                                          n
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ⋅
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       
                                          |
                                          N
                                          s
                                          
                                             (
                                             i
                                             )
                                          
                                          |
                                       
                                    
                                 
                                 
                                    
                                       λ
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 
                                    
                                       d
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                              
                           
                         where 
                           
                              
                                 d
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                         is the orientation distance described in Eq. (21), and 
                           
                              
                                 λ
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                         is the weight of edge 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                        , which is also known as mean value coordinates for 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         with respect to 
                           v
                           
                              
                                 f
                              
                              
                                 j
                              
                           
                           [31], where 
                           v
                           
                              
                                 f
                              
                              
                                 j
                              
                           
                         is the projection of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         on the tangent plane 
                           
                              
                                 F
                              
                              
                                 i
                              
                           
                        , as shown in Fig. 6.

The length of Laplacian coordinate 
                           δ
                           
                              
                                 s
                              
                              
                                 i
                              
                           
                         is proportional to the mean curvature at node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , and the larger the length of 
                           δ
                           
                              
                                 s
                              
                              
                                 i
                              
                           
                        , the greater is its mean curvature. Given a tolerance 
                           σ
                        , if 
                           
                              ‖
                              δ
                              
                                 
                                    s
                                 
                                 
                                    i
                                 
                              
                              ‖
                           
                           >
                           σ
                        , 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        
                         is a feature point constraint, and the displacement of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                          is 0, i.e. 
                           
                              Δ
                           
                           
                              
                                 
                                    v
                                 
                              
                              
                                 i
                              
                           
                           =
                           0
                        ; otherwise, 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         is a normal constraint which is constrained to lie on the tangent plane 
                           
                              
                                 F
                              
                              
                                 i
                              
                           
                        , and the displacement of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         is perpendicular to the normal of tangent plane, i.e. 
                           
                              
                                 
                                    n
                                 
                              
                              
                                 i
                              
                           
                           ⋅
                           
                              Δ
                           
                           
                              
                                 
                                    v
                                 
                              
                              
                                 i
                              
                           
                           =
                           0
                        . It can be formulized as: 
                           
                              (24)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                Δ
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             
                                                Δ
                                             
                                             
                                                
                                                   y
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             0
                                             
                                             if  
                                             
                                                ‖
                                                δ
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ‖
                                             
                                             >
                                             σ
                                          
                                       
                                       
                                          
                                             
                                                Δ
                                             
                                             
                                                
                                                   z
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      n
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             ⋅
                                             
                                                
                                                   
                                                      [
                                                      
                                                         Δ
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         Δ
                                                      
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         Δ
                                                      
                                                      
                                                         
                                                            z
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             =
                                             0
                                             
                                             if  
                                             
                                                ‖
                                                δ
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ‖
                                             
                                             ≤
                                             σ
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Thus the equations for all geometric constraints can be represented in matrix form:
                           
                              (25)
                              
                                 
                                    C
                                 
                                 
                                    Δ
                                 
                                 
                                    X
                                 
                                 =
                                 0
                              
                           
                         where 
                           
                              C
                           
                         is an 
                           s
                           ×
                           3
                           n
                         matrix, and 
                           s
                           =
                           3
                           ×
                           
                              
                                 r
                              
                              
                                 d
                              
                           
                           +
                           
                              
                                 r
                              
                              
                                 n
                              
                           
                        , where 
                           
                              
                                 r
                              
                              
                                 d
                              
                           
                         is the number of feature point constraints and 
                           
                              
                                 r
                              
                              
                                 n
                              
                           
                         is the number of normal constraints. To preserve the geometric features of the given hexahedral meshes, we try to minimize the following energy function: 
                           
                              (26)
                              
                                 
                                    
                                       
                                          ‖
                                          
                                             C
                                          
                                          
                                             Δ
                                          
                                          
                                             X
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                        
                     

The displacements of all element nodes are obtained by minimizing the following sum of all energy terms:
                           
                              
                                 
                                    
                                       
                                          ‖
                                          
                                             L
                                          
                                          
                                             Δ
                                          
                                          
                                             X
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       θ
                                    
                                    
                                       T
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             T
                                          
                                          
                                             Δ
                                          
                                          
                                             X
                                          
                                          −
                                          
                                             R
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       θ
                                    
                                    
                                       C
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             C
                                          
                                          
                                             Δ
                                          
                                          
                                             X
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where 
                           
                              
                                 θ
                              
                              
                                 T
                              
                           
                         and 
                           
                              
                                 θ
                              
                              
                                 C
                              
                           
                         are the weights of node displacements and geometric constraints, which are used to balance these objectives. In general, 
                           
                              
                                 θ
                              
                              
                                 C
                              
                           
                         is much larger than 
                           
                              
                                 θ
                              
                              
                                 T
                              
                           
                         to preserve the features of the given hexahedral meshes strictly.

The above energy function is quadratic in every vertex, and the above energy minimization problem can be solved by a sparse linear system: 
                           
                              (27)
                              
                                 
                                    
                                       
                                          A
                                       
                                    
                                    
                                       K
                                    
                                 
                                 
                                    Δ
                                 
                                 
                                    X
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                L
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                T
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   C
                                                
                                             
                                             
                                                C
                                             
                                          
                                       
                                    
                                    )
                                 
                                 
                                    Δ
                                 
                                 
                                    X
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             0
                                          
                                       
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                R
                                             
                                          
                                       
                                       
                                          
                                             0
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          B
                                       
                                    
                                    
                                       K
                                    
                                 
                                 .
                              
                           
                        
                     

The displacements of all nodes can be found by solving the sparse linear system: 
                           
                              (28)
                              
                                 
                                    Δ
                                 
                                 
                                    X
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      K
                                                   
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                
                                                   A
                                                
                                             
                                             
                                                K
                                             
                                          
                                          )
                                       
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                A
                                             
                                          
                                          
                                             K
                                          
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          B
                                       
                                    
                                    
                                       K
                                    
                                 
                                 .
                              
                           
                        
                     

In our local to global mesh smoothing algorithm, an iterative procedure is used to update the positions of all nodes. The iterative procedure is formulated as the following: 
                           
                              (29)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                
                                                
                                                   K
                                                
                                                
                                                   j
                                                
                                             
                                             
                                                Δ
                                             
                                             
                                                
                                                   
                                                      X
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      B
                                                   
                                                
                                                
                                                   K
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      X
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             +
                                             
                                                Δ
                                             
                                             
                                                
                                                   
                                                      X
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              Δ
                           
                           
                              
                                 
                                    X
                                 
                              
                              
                                 j
                              
                           
                         is node displacements of 
                           j
                        th iteration; 
                           
                              
                                 
                                    X
                                 
                              
                              
                                 j
                              
                           
                         and 
                           
                              
                                 
                                    X
                                 
                              
                              
                                 j
                                 +
                                 1
                              
                           
                         are the node positions of 
                           j
                        th and 
                           
                              (
                              j
                              +
                              1
                              )
                           
                        th iterations; and 
                           
                              
                                 
                                    B
                                 
                              
                              
                                 K
                              
                              
                                 j
                              
                           
                         and 
                           
                              
                                 
                                    A
                                 
                              
                              
                                 K
                              
                              
                                 j
                              
                           
                         are known at the current iteration. During each iteration, all elements are regularized and the sparse linear system (27) can be obtained according to the node positions from the last iteration. The terminal condition for the iterative procedure is determined as: 
                           
                              (30)
                              
                                 
                                    ‖
                                    
                                       Δ
                                    
                                    
                                       
                                          
                                             X
                                          
                                       
                                       
                                          j
                                       
                                    
                                    ‖
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       3
                                       n
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             3
                                             n
                                          
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   Δ
                                                
                                                
                                                   
                                                      
                                                         X
                                                      
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 ≤
                                 ε
                                 
                                 or
                                 
                                 j
                                 ≥
                                 
                                    
                                       N
                                    
                                    
                                       
                                          max
                                       
                                    
                                 
                              
                           
                         where 
                           ε
                         is a given precision and 
                           
                              
                                 N
                              
                              
                                 
                                    max
                                 
                              
                           
                         is a given maximal number of iterations.

@&#EXPERIMENTAL RESULTS@&#

In this paper, the described local to global hexahedral mesh smoothing algorithm was implemented with the C++ language. In order to confirm the effectiveness of our method, we adopt the Scaled Jacobian to evaluate the mesh quality. The Scaled Jacobian is the fundamental quality criterion to a finite element mesh  [28]. For an element, the full range of the Scaled Jacobian value is from −1 to +1. And 
                        
                           
                              f
                           
                           
                              
                                 scaled_jacobian
                              
                           
                        
                        =
                        1
                      if the element is an ideal element, 
                        
                           
                              f
                           
                           
                              
                                 scaled_jacobian
                              
                           
                        
                        =
                        −
                        1
                      if the element is a worst distorted element. The minimal and mean mesh quality numbers are determined by Scaled Jacobian criterion: 
                        
                           (31)
                           
                              
                                 
                                    J
                                 
                                 
                                    
                                       min
                                    
                                 
                              
                              =
                              
                                 
                                    min
                                 
                                 
                                    j
                                    ∈
                                    
                                       {
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             H
                                          
                                       
                                       }
                                    
                                 
                              
                              J
                              
                                 (
                                 
                                    
                                       E
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                              ,
                              
                              
                                 
                                    J
                                 
                                 
                                    
                                       mean
                                    
                                 
                              
                              =
                              1
                              /
                              
                                 
                                    n
                                 
                                 
                                    H
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    ∈
                                    
                                       {
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             H
                                          
                                       
                                       }
                                    
                                 
                              
                              J
                              
                                 (
                                 
                                    
                                       E
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                           
                        
                      where 
                        
                           
                              n
                           
                           
                              H
                           
                        
                      is the element number of hexahedral meshes.

Several classical hexahedral mesh models were tested to illustrate the applicability and effectiveness of our hexahedral mesh smoothing approach in finite element analysis applications. The first example is shown in Fig. 7
                     . Fig. 7(a) displays the initial cube model with hexahedral elements colored according to their Scaled Jacobian value. Obviously, this model contains many poor quality elements with a negative Scaled Jacobian value. After local regularization for all elements and global optimization, the resulting hexahedral mesh in Fig. 7(b) was obtained. As can be seen from Fig. 7(b), the smoothed hexahedral mesh is ideal, and the minimal Scaled Jacobian 
                        
                           
                              J
                           
                           
                              
                                 min
                              
                           
                        
                        =
                        0.99
                     . Our smoothing method is applicable to unacceptable hexahedral meshes with negative Scaled Jacobian value.

To demonstrate the effectiveness of our method, we compare it with two related methods, including Smart Laplace  [12] and GETMe  [16,17]. In our method, the main parameters are the weights 
                        
                           
                              θ
                           
                           
                              T
                           
                        
                      and 
                        
                           
                              θ
                           
                           
                              C
                           
                        
                      of the transformed node displacements and the geometric constraints. According to our experimental tests, good results are produced by setting 
                        
                           
                              θ
                           
                           
                              T
                           
                        
                        =
                        5
                      and 
                        
                           
                              θ
                           
                           
                              C
                           
                        
                        =
                        100
                     . Fig. 8
                      shows the initial hexahedral mesh and smoothing results of a rotator model with elements colored according to their Scaled Jacobian value. The initial mesh is generated based on sweep method. The smoothed mesh using Smart Laplace, GETMe and our method are shown in Fig. 8(b)–(d). Histograms of Scaled Jacobian are shown in Fig. 9
                      to compare the quality of different hexahedral meshes in Fig. 8. As can be seen from Fig. 9, the minimal element quality number of the initial mesh is 0.54, and minimal element quality numbers of the smoothing results by Smart Laplace, GETMe and our method are 0.54, 0.58 and 0.66. We can see that our method can effectively improve the mesh quality of hexahedral meshes, and can gain better result than Smart Laplace and GETMe.

The torque arm is a typical part of the mechanical structure for connecting the active parts and transmission parts, and Fig. 10
                      shows a hexahedral mesh smoothing example for a torque arm. As can be seen from Fig. 10(a), the minimal element quality number given by 
                        
                           
                              J
                           
                           
                              
                                 min
                              
                           
                        
                        =
                        0.24
                      is below the acceptable range for finite element analysis. Fig. 10(b)–(d) give the smoothed torque arm hexahedral meshes with elements colored according to their Scaled Jacobian value using Smart Laplace, GETMe and our method. In Fig. 11
                     , histograms of Scaled Jacobian for initial mesh and different smoothing results in Fig. 10 are plotted. As can be seen in the case of Smart Laplace, the improvement of the mean and minimal mesh quality is not achieved. With GETMe smoothing, although the quality of inner elements has been considerably improved, low quality elements remain on the surface of hexahedral meshes. By using our method, the minimal mesh quality can be significantly improved to 0.5 with an improvement of the overall mesh quality. It is clear that the quality of the mesh after smoothing by our method is in the acceptable range for finite element analysis.


                     Fig. 12
                     (a) shows the initial hexahedral mesh of a turbine disk model with elements colored according to their Scaled Jacobian value. Fig. 12(b)–(d) present the smoothing results of the turbine disk model with Smart Laplace, GETMe and our method respectively. The corresponding mesh quality histograms of the initial mesh and the smoothed meshes are shown in Fig. 13
                     . With our method, the minimal mesh quality can be improved from 0.24 to 0.37, and the quality of all elements is also in the acceptable range for finite element analysis.

The octree-based method is widely used in hexahedral mesh generation, and mesh quality optimization for models generated by octree-based method is more difficult due to its complicated mesh connectivity and variable element size. Fig. 14
                      gives a hexahedral mesh smoothing example of a rod model, which is generated by octree-based method. Fig. 14 shows the initial unstructured hexahedral mesh and the smoothing results obtained by Smart Laplace, GETMe and our method respectively, while Fig. 15
                      presents the corresponding quality histograms measured by Scaled Jacobian. From the histograms, our method still has good performance on those unstructured complex hexahedral mesh models.

The tetrahedral splitting method is an indirect hexahedral mesh generation method, which is relatively easy to operate. In this method, a conformal tetrahedral mesh is first generated in the domain, after which a horrible quality mesh is generated via subdivision of each tetrahedral element into four hexahedral elements. Fig. 16
                      gives a hexahedral mesh smoothing example of an eight shape model, which is generated by tetrahedral splitting method. The corresponding mesh quality histograms of the initial mesh and the smoothed meshes are shown in Fig. 17
                     . Hence one can see that, our method outperforms other methods for this kind of difficult mesh generated by tetrahedral splitting method.


                     Table 1
                      gives the mesh quality statistics of smoothing results on several models as shown in Figs. 8, 10, 12 and 14. From Table 1, meshes with a good overall quality 
                        
                           
                              J
                           
                           
                              
                                 mean
                              
                           
                        
                      can still contain elements of particularly low quality 
                        
                           
                              J
                           
                           
                              
                                 min
                              
                           
                        
                     , which might affect the results of subsequent finite element analysis applications. Therefore, our method not only leads to better results with respect to 
                        
                           
                              J
                           
                           
                              
                                 mean
                              
                           
                        
                     , but also with respect to the minimal element quality 
                        
                           
                              J
                           
                           
                              
                                 min
                              
                           
                        
                     .


                     Table 2
                      shows the time consumption of the aforementioned models by Smart Laplace, GETMe and our method. All the timings reported here are recorded on a machine using an Intel Core i5 2.8 GHz CPU and 4 GB memory. From the result, our method is slower than Smart Laplace and GETMe, but produces better results than these two methods.

In this paper, we present a local to global hexahedral mesh smoothing method for hexahedral mesh quality improvement. Motivated by the strong regularizing and element size changing effect of the dual element based transformation, the geometric transformation method and the element size adjustment algorithm are sequentially used to obtain a regular form for each hexahedral element. After that, the volumetric Laplacian operator is used to ensure the validity of hexahedral meshes during global optimization, and geometric constraints of surface meshes are introduced into the global optimization to highly improve the minimal mesh quality of hexahedral meshes. As compared to other geometry-based hexahedral mesh smoothing algorithms, our method provides better results with higher overall mesh quality and higher minimal mesh quality. And the smoothed meshes using our method are acceptable for finite element analysis.

As mentioned in our paper, exterior nodes in a feature edge are designed not to be moved. However, for many bad-quality elements lie on feature edges, it is hard to improve the quality of this kind of elements. In the future work, we will consider the tangent vector constraints for internal nodes in a feature edge, and the mesh smoothing problem of arbitrary types of elements, e.g. tetrahedral elements, quadrilateral elements and triangular elements will be studied. To reduce the computational time, we would like to consider the GPU-based mesh smoothing method, which can perform the computations at interactive rates.

@&#ACKNOWLEDGMENTS@&#

We would like to thank Dr. Marechal for providing us with the hexahedral mesh model generated by his octree-based method. This work was funded by the Key Project of the National Natural Science Foundation of China (No. 10932010), National Basic Research Program of China (No. 2011CB707305) and National Science and Technology Major Project of the Ministry of Science and Technology of China (No. 2011ZX05009-006). These supports are gratefully acknowledged.

@&#REFERENCES@&#

