@&#MAIN-TITLE@&#A generic uniform scallop tool path generation method for five-axis machining of freeform surface

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Uniform scallop tool path has been generated via cutting simulation.


                        
                        
                           
                           Grass/CC rings are calculated both in parametric and 3D Euclidean space.


                        
                        
                           
                           Optimized methods are used to fast calculate the grass/CC ring.


                        
                        
                           
                           The method is free of local geometry assumptions; thus is more precise.


                        
                        
                           
                           The method is generic for any cutter, parametric surface and tool path pattern.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Five-axis machining

Uniform scallop tool path

Cutting simulation

Ring

@&#ABSTRACT@&#


               
               
                  In this paper, a generic uniform scallop tool path generation method for five-axis machining is presented. Unlike the conventional methods which are based on the local surface geometry assumptions, this method is inspired by cutting simulation. Initially, the designed surface is planted with dense grasses. If a cutter is put onto the surface, the affected grasses will be cut short. All the affected grasses form a grass ring on the surface. When the cutter moves along the previous tool path, the envelope of the grass rings will form a machining band. Based on the machining band, cutter contact points can be found on the surface to ensure that the cutting edge touches exactly on the side of the band. These cutter contact points are fitted to construct the next tool path. In this way, all the tool paths can be generated recursively. An optimization is also developed to improve the computing efficiency of the path generation process. The proposed uniform scallop tool path generation method is generic. It can be popularized to (1) any kind of end mill with various sizes, (2) any kind of parametric surface and (3) directional- or contour-parallel tool path topologies. Another salient feature of this method is that it is free of local surface geometry assumptions, so the obtained tool paths are more precise. The proposed method is implemented and evaluated with several freeform surface examples. The feasibility of the method is also verified by actual cutting experiment.
               
            

@&#INTRODUCTION@&#

Freeform surfaces are widely used in various industry applications. It is defined in a parametric way as the form 
                        S
                        
                           (
                           u
                           ,
                           
                           v
                           )
                        
                     , in which 
                        u
                      and 
                        v
                      are two parameters. Usually, freeform surfaces are sent to CAM systems before they can be machined on three- or five-axis machine tools. The main task of the CAM systems is to plan tool paths on the input surface. The tool path can be classified into roughing and finishing according to different machining stages. In our previous work  [1], we were able to generate contour-parallel roughing tool path. In this work, we put our focus on five-axis finishing tool path generation.

A tool path defines the feed directions of the cutter on the surface. There are two basic error types involved in generating the finishing tool path: the chord error and the scallop error. The chord error is defined in the tool feed direction along the tool path, which is used to evaluate the cutter trajectory precision between two continuous cutter contact (CC) points; while the scallop error is defined in the cross section of the two adjacent tool paths, which is used to evaluate the surface roughness after machining. In the tool path generation strategy presented by Lo and Lin  [2], these two errors are integrated to get the finishing tool path. In this paper, however, the term tool path refers to an accurate curve on the designed surface. So in the tool path planning stage, the chord error is not taken into consideration.

The quality of the finishing tool path has a direct influence on the final surface precision and the machining efficiency. For a high-quality tool path, the machining strip should be maximized while the geometric errors should be minimized  [3]. Among the available tool path planning strategies, the iso-parametric strategy seems to be the most straightforward. In an iso-parametric path, the cutter moves along constant parametric curves. The side step is constrained by maximum scallop between two adjacent parametric curves. Obviously, the maximum scallop must be smaller than the scallop allowance. Another strategy which is often used is the iso-planar strategy. The only difference between the iso-parametric and iso-planar strategies is that for the latter, tool path curves are obtained by intersecting planes with the designed surface. Both the iso-parametric and iso-planar strategies belong to the category of constrained scallop strategy, which is characterized as low efficiency as it might have overlapped or redundant tool paths. The uniform scallop (iso-scallop) strategy finds a balance between the machining precision and efficiency. It attracts much research attention in this area since it was first proposed probably by Suresh and Yang  [4]. However, it has never been an easy task to generate the iso-scallop tool path due to the irregular curvature distributions of freeform surfaces  [5], especially for five-axis machining, which has two additional motion degrees and is considered to be collision-prone.

Five-axis machining has brought in many advantages including faster material-removal rates, improved surface finish, and the elimination of hand polishing  [6], as well as new problems such as tool positioning and collisions. In five-axis machining, the tool positions including its orientations should be carefully adjusted as to achieve the maximum machining strip. Methods such as curvature matching machining  [7,8], principle axis method  [9], multi-point machining  [10,11] and arc-intersect method  [12] are interesting. For collision detection and avoidance issue, it has been a significant research topic in five-axis machining during the last decades [13–18]. In our previous work presented in  [19], we aimed to efficiently calculate tool admissible area for any surface point, using the idea of sample admissible areas interpolation. In this work, the collision problem is left as an interface so it is not discussed at present. Also, this interface is compatible with the tool positioning problem.

The main difficulty in generating the five-axis iso-scallop tool path is finding the corresponding CC point of the next tool path for a current CC point of the current tool path. On one hand, the surface curvature in the vicinity of the current CC point is irregular, making it nearly impossible to precisely formulize the position of the next iso-scallop CC point; on the other hand, as the tool orientation of the next point is unknown, the effective cutting radius (for flat- or fillet-end mills) is unknown, either. Meanwhile, one has to be careful to avoid the possible gouging or collision problems when adjusting the tool orientations.

The purpose of this work is to build a framework for generating five-axis iso-scallop tool paths via cutting simulation. Many techniques can be used to do cutting simulation  [20–24], in which a well-known method is the normal vector method (NVM)  [9]. This method can be vividly described as mowing the lawn on the surface. At first, grasses (considered as straight) with appropriate lengths are planted perpendicularly onto the surface. Then a cutter is forced to move on the surface along a tool path. Any grass that makes contact with the cutting edge of the cutter is cut short at the intersecting point. As the cutter reaches the end of the path, the resulting grasses can be used to approximate the machined surface. The precision of the simulated surface is controlled by the density of the grasses on the surface. In this work, the concept of NVM is adopted to calculate the grass curve for the current tool path. And then the next iso-scallop tool path is calculated based on the grass curve. The benefit of using this method is that no surface curvature assumptions are needed, thus cutters with larger radii can be used. The fillet-end mill is used in this work. The advantage of fillet-end mills over ball- or flat-end mills is that it inherits the merits of the other two cutters and produces smaller scallops across the feed direction and low roughness along the feed direction  [25].

The rest of the paper is organized as follows. Section  2 studies the backgrounds of iso-scallop tool path. In Section  3, some preliminary definitions and operations throughout the paper are given. The intermediate grass curve is generated in Section  4. Based on the grass curve, the tool path curve is generated in Section  5. Section  6 optimizes the proposed tool path generation method. Some iso-scallop tool paths examples including a real cutting test are given in Section  7. The last section concludes this paper.

The iso-scallop tool paths are usually generated recursively  [26]: initially, a primary tool path from which the other paths are constructed is selected, usually, from the surface boundary curves. Then, all the CC points of the next tool path are calculated from the corresponding CC points of the current path, such that the scallop between the two paths remains at constant height. Theoretically, if these newly generated CC points are dense enough, they can be used directly as a tool path. Practically, these points cannot be too dense in order to save computation. They are usually fitted (interpolated or approximated) to a cubic spline, either in 3D physical space or 2D parametric domain. In practice, 2D parametric fitting is superior to 3D physical fitting in terms of accumulation errors as the former resulting splines remain staying always on the designed surface. The secondary path is then used as a primary path for generating another tool path. This process keeps recursively running until the stop condition is met.

The real challenge here is to compute the next CC point according to the current one in the path interval direction. In three-axis machining, as ball-end mills are used, things are relatively easier because one only needs to handle the irregular freeform surfaces. For five-axis machining, flat-end or fillet-end mills are often used. In this case, the challenge is even bigger, because one has to deal with the irregular cutter surfaces, too.

Suresh and Yang  [4] made probably the first attempt to plan tool path with constant scallop criterion for three-axis machining with ball-end mills. In their work, the classic scallop models on flat, convex and concave spherical surfaces (with regular curvature) are built (as shown in Fig. 1
                     ) and formulated as:
                        
                           (1)
                           
                              g
                              =
                              
                                 
                                    2
                                    a
                                 
                                 
                                    1
                                    +
                                    sign
                                    ⋅
                                    r
                                    /
                                    R
                                 
                              
                              ,
                           
                        
                      in which 
                        g
                      is the path interval in physical space, 
                        r
                      is tool end radius, 
                        R
                      is the surface curvature, and 
                        2
                        a
                      (as 
                        A
                        B
                      in Fig. 1) is the distance between two adjacent tool centers, as shown in Fig. 1. sign is an operator whose value is 0 for flat surface, 1 for convex surface and −1 for concave surface. In Eq. (1), the solution of 
                        a
                      requires a tedious iterative process. Local surfaces are approximated in the neighborhood by spheres (referred as sphere assumption) so that the path interval can be calculated with Eq. (1). This path interval is converted (referred as conversion assumption) to parametric interval with the first order Taylor expansion, thus the next CC point can be located on the surface. Lin and Koren  [27] concerned that the first order Taylor expansion is only valid when the converted parametric interval is very small. They introduced a more accurate conversion technique based on both the second order Taylor expansion and an error compensation method. Besides, they further developed Eq. (1) and gave a much more neat expression of the path interval, as: 
                        
                           (2)
                           
                              g
                              =
                              
                                 
                                    
                                       
                                          8
                                          h
                                          r
                                          R
                                       
                                       
                                          R
                                          +
                                          sign
                                          ⋅
                                          r
                                       
                                    
                                 
                              
                              .
                           
                        
                      Eq. (2) or similar forms of Eq. (2) were later also used by authors  [28–30] to evaluate the CC path interval.

Feng and Li  [31] argued that the previous work had simply assumed that the corresponding swept sections on adjacent tool paths were coplanar. This assumption (referred as coplanar assumption) caused inaccuracy in the calculation of tool path intervals and compromised the generation of optimal tool path. In their work, two offset surfaces, the scallop surface and the tool center surface, are employed to successively establish scallop curves on the scallop surface and cutter location paths for the designed surface, such that the coplanar assumption is avoided. Besides, the questionable conversion assumptions involved in transforming the 3D cutting geometry to 2D parametric domain are not required. Their work was followed and further developed by Yoon  [32,33], who improved significantly not only the computing efficiency but also the accuracy of the tool path. These works are for three-axis machining with ball-end mill. In another work presented by Li and Feng  [34], the authors introduced the same method to five-axis iso-scallop tool path generation with flat-end mills. One notable difference is that, for five-axis machining, owing to the rotated and changing tool orientations, the scallop curve is facilitated by tedious coordinate system transformations.

A similar method was adopted by Tournier and Duc  [35] by planning the iso-scallop tool path on machining surface  [36]. A general definition of the machining surface is a surface including all the information necessary for the driving of the tool. For three-axis ball-end mills, the machining surface is a traditional offset surface. The machining surface has an aptitude to treat curvature discontinuities; however, it may also have the invalid loop problem. To free the loops, in their work, only the cutters whose radius is smaller than the smallest concave radius of the surface are used. In one of our earlier research, Shen et al.  [37] used the Level Set Method to generate the offset surface and then plan iso-scallop tool path. With Level Set Method, loop problems during offsetting can be naturally eliminated. Afterwards, the machining surface method was popularized to five-axis iso-scallop tool path generation with fillet end-mill through a bi-parametric modeling method, also by Tournier and Duc  [38].

For five-axis machining, Lee  [39] proposed a feasible machining strip evaluation technique for iso-scallop tool path generation with flat-end mills. In the osculating plane normal to the feed direction, the feasible machining strip is evaluated by intersecting the effective cutting shape with the scallop surface. Two adjacent machining strips can be put side by side so as to maximize the machining efficiency while maintaining the machined surface error, as shown in Fig. 2
                     . In this way, the next CC point can be located. The parametric increments are determined by solving two vector form equations, one in the feed direction, and the other in the cross-feed direction. A searching method is proposed to improve precision of the parametric increments solution. As mentioned in his paper by the author himself, one limitation of the method comes from the assumption of using local surface curvatures at the cutter contact point in approximating the neighborhood surface (which is actually the spherical assumption). The approximation might introduce errors as tool size can be quite large. Another hidden assumption (referred cutting shape assumption) in this method might be using the current effective cutting shape in approximating the adjacent one.

Pi et al.  [7] introduced a new automatic five-axis tool path generation method called Grind-Free tool path generation with a fillet-end mill. The CC path interval is calculated using a curvature matched machining algorithm. Lo  [40] also referred to Eq. (2) to calculate the CC path interval for five-axis iso-scallop tool path generation. Here in Eq. (2)
                     
                        r
                      is the tool effective radius. Ahmet and Ali  [41] presented a rather complicated searching procedure for the next iso-scallop tool path on both the physical surface and parametric domain. However, in the procedure, many assumptions and estimations are involved to cope with the irregular surface curvatures and numerical iterations. Yet one noteworthy point in their work is that no differential geometry is applied to evaluate the surface curvatures and surface normal–tangent vectors. For a surface point, these features are calculated with three or four points in its neighborhood.

Recently, the mesh surface has become the focus of considerable interest, since its geometric computation is simpler and more robust than that of the parametric surface. Kim and Yang  [42] presented a CL surface deformation approach for constant scallop height tool path generation from triangle mesh. One difficulty of planning iso-scallop tool path on meshed surface is that mesh surface does not have curvature information. Realizing that, Lee et al.  [43] presented several methods for estimating the curvature form the mesh, and compared these methods in terms of tool path generation. In their work, a drive surface method is proposed for propagating constant scallop paths flexibly on the mesh surface.

Conventionally, the primary tool path is selected from the surface boundary curves. Agrawal et al.  [44] optimized the orientation of the primary path through application of a genetic algorithm for minimizing machining time. Giri et al.  [45] suggested that the direction of the maximum convex (or minimum concave) curvature should be selected as the initial tool path. Usually, the iso-scallop paths are organized in a directional-parallel way. In order to minimize the fluctuation of cutting load and the times of cutter retractions during the cutting operations, a contour-parallel topology tool path with constant scallop height is developed by Lee  [46]. Though, much more efforts should be made on the self-intersections removal and tool path linking issues. Chen et al.  [47] studied the surface scallop generating mechanism in ball-end milling process.

From the above reviewed literatures, it can be seen that most of the current existing iso-scallop tool path generating techniques are based on assumptions, such as the spherical assumption, the coplanar assumption and the cutting shape assumption. These assumptions may have a chance to improve the computing efficiency of the tool path, but at the expense of the path accuracies. In this work, we will build the framework for the five-axis iso-scallop tool path generation without these assumptions. The details are presented in the following sections.

In this work a fillet-end mill is used to generate the iso-scallop tool path. A fillet-end mill is made up of a bottom circular plane, a quarter of torus, and a cylindrical surface, as shown in Fig. 3
                        , in which 
                           
                              
                                 R
                              
                              
                                 1
                              
                           
                         is the bottom radius, 
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                         is the filleted radius (or corner radius), and point 
                           O
                         is the tool center. A tool coordinate system (TCS) can be installed to the cutter with the origin at the tool center and 
                           
                              
                                 Z
                              
                              
                                 T
                              
                           
                        -axis parallel to the tool axis direction, as shown in Fig. 3(a). In the cross section of 
                           X
                           O
                           Y
                        , the tool contour profile can be formulated as: 
                           
                              (3)
                              
                                 r
                                 
                                    (
                                    z
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   R
                                                
                                                
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   R
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                          
                                          
                                             0
                                             ≤
                                             z
                                             <
                                             L
                                          
                                       
                                       
                                          
                                             
                                                
                                                   R
                                                
                                                
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         R
                                                      
                                                      
                                                         2
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                          
                                             
                                                
                                                   R
                                                
                                                
                                                   2
                                                
                                             
                                             ≤
                                             z
                                             <
                                             0
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                         in which 
                           r
                           
                              (
                              z
                              )
                           
                         is the distance from a point on the tool contour profile to the tool axis, as shown in Fig. 3(b).

For any CC point 
                           C
                         on the designed surface, as shown in Fig. 4
                        (a), the local coordinate system (LCS) can be established with the origin at 
                           C
                         and 
                           
                              
                                 Z
                              
                              
                                 L
                              
                           
                        -axis parallel to the surface normal 
                           
                              n
                           
                        . In the LCS, the 
                           
                              
                                 X
                              
                              
                                 L
                              
                           
                        -axis is defined in the cutter feed direction 
                           
                              f
                           
                         at 
                           C
                         and the 
                           
                              
                                 Y
                              
                              
                                 L
                              
                           
                        -axis is determined using the right hand rule. Note that here 
                           
                              n
                           
                        , 
                           
                              f
                           
                         and 
                           
                              b
                           
                         are all unit vectors.

In the LCS, when the fillet-end mill is placed onto a CC point 
                           C
                        , the tool axis direction 
                           
                              T
                           
                         and the tool center point 
                           O
                         can be formulized as: 
                           
                              
                                 (4)
                                 
                                    
                                       T
                                    
                                    =
                                    
                                       n
                                    
                                    cos
                                    β
                                    +
                                    
                                       (
                                       
                                          f
                                       
                                       cos
                                       θ
                                       +
                                       
                                          b
                                       
                                       sin
                                       θ
                                       )
                                    
                                    sin
                                    β
                                    ,
                                 
                              
                              
                                 (5)
                                 
                                    O
                                    =
                                    C
                                    +
                                    
                                       n
                                    
                                    ⋅
                                    
                                       (
                                       
                                          
                                             R
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             R
                                          
                                          
                                             1
                                          
                                       
                                       /
                                       sin
                                       β
                                       )
                                    
                                    −
                                    
                                       T
                                    
                                    ⋅
                                    
                                       
                                          R
                                       
                                       
                                          1
                                       
                                    
                                    /
                                    tan
                                    β
                                    ,
                                 
                              
                           
                         in which 
                           β
                         is the tool inclining angle to the 
                           
                              
                                 Z
                              
                              
                                 L
                              
                           
                        -axis, 
                           β
                           ∈
                           
                              (
                              0
                              ,
                              π
                              /
                              2
                              )
                           
                        , and 
                           θ
                         is the tool rotational angle around the 
                           
                              
                                 Z
                              
                              
                                 L
                              
                           
                        -axis, 
                           θ
                           ∈
                           
                              (
                              0
                              ,
                              2
                              π
                              ]
                           
                        , as shown in Fig. 4. With Eqs. (4) and (5), the cutter location (
                           O
                         and 
                           
                              T
                           
                        ) can be calculated if 
                           C
                        , 
                           
                              f
                           
                        , 
                           β
                         and 
                           θ
                         are given. Note that the coordinates of the vectors 
                           
                              n
                           
                        , 
                           
                              f
                           
                        , 
                           
                              b
                           
                         and 
                           
                              T
                           
                         are calculated with respect to the workpiece coordinate system (WCS), so resulting coordinates of 
                           
                              T
                           
                         and 
                           O
                         from Eqs. (4) and (5) are also in the WCS.

As a basis of this work, it is essential to test whether a grass (consider as a line segment) contacts the cutting edge of the fillet-end mill. The height of the grass is set to be the allowable scallop error. The result should be a true or false Boolean value.

A grass on the surface as mentioned in Section  1 can be represented by its root point 
                           G
                         on the surface, thus: 
                           
                              (6)
                              
                                 G
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 =
                                 S
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 ,
                              
                           
                         in which 
                           S
                           
                              (
                              u
                              ,
                              v
                              )
                           
                         is the surface expression. And the head point 
                           H
                         of the grass can be expressed as: 
                           
                              (7)
                              
                                 H
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 =
                                 G
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 +
                                 
                                    n
                                 
                                 ⋅
                                 h
                                 ,
                              
                           
                         in which 
                           
                              n
                           
                         is the surface normal at the root point 
                           G
                         and 
                           h
                         is the allowable scallop error. With these, the above test can also be described as: for a given cutter location at the CC point 
                           C
                        , and a known grass 
                           G
                         in the neighborhood of 
                           C
                        , decide whether the grass contacts the cutting edge of the fillet-end mill.

Usually, the cutting edge of the fillet-end mill is only on the torus part, so from geometry point of view, it is only necessary to decide whether the grass intersects the quarter torus. In practice, solving the intersection of a spatial torus and a line segment involves solving a quartic equation, which is hard to find the explicit solution. Note that the scallop error (in about 0.01 mm scale) is much shorter than the corner radius (in about 1 mm scale) of the cutter, and usually the tool inclining angle 
                           β
                         in LCS will not be near to 0 or 
                           π
                           /
                           2
                        , it is only necessary to test whether the head point 
                           H
                         of the grass is inside the torus part of cutter.

As shown in Fig. 5
                        , point 
                           
                              
                                 H
                              
                              
                                 ′
                              
                           
                         is a projection of the grass head point 
                           H
                         on the tool axis line. 
                           
                              
                                 H
                              
                              
                                 ′
                              
                           
                         can be expressed by: 
                           
                              (8)
                              
                                 
                                    
                                       H
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 O
                                 +
                                 λ
                                 ⋅
                                 
                                    T
                                 
                                 ,
                              
                           
                         in which 
                           λ
                         is a to-be-determined real parameter. With point 
                           
                              
                                 H
                              
                              
                                 ′
                              
                           
                        , vector 
                           
                              
                                 
                                    H
                                 
                              
                              
                                 ′
                              
                           
                           
                              H
                           
                         can be expressed as: 
                           
                              (9)
                              
                                 
                                    
                                       
                                          H
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    H
                                 
                                 =
                                 
                                    OH
                                 
                                 −
                                 λ
                                 ⋅
                                 
                                    T
                                 
                                 .
                              
                           
                         As 
                           
                              
                                 
                                    H
                                 
                              
                              
                                 ′
                              
                           
                           
                              H
                           
                           ⊥
                           
                              T
                           
                        , namely, 
                           
                              
                                 
                                    H
                                 
                              
                              
                                 ′
                              
                           
                           
                              H
                           
                           ⋅
                           
                              T
                           
                           =
                           0
                        , so 
                           λ
                         can be solved as: 
                           
                              (10)
                              
                                 λ
                                 =
                                 
                                    OH
                                 
                                 ⋅
                                 
                                    T
                                 
                                 .
                              
                           
                         As the coordinates of points 
                           O
                           ,
                           
                           H
                         and vector 
                           
                              T
                           
                         are already known, 
                           λ
                         can be determined with Eq. (10).

Note that when 
                           λ
                           <
                           −
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                         or 
                           λ
                           >
                           0
                           ,
                           
                              
                                 H
                              
                              
                                 ′
                              
                           
                         is outside the torus part of the cutter. In this case, the grass will not intersect the cutting edge. When 
                           −
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                           ≤
                           λ
                           ≤
                           0
                        , 
                           
                              |
                              
                                 
                                    H
                                 
                                 
                                    ′
                                 
                              
                              H
                              |
                           
                         is compared with 
                           
                              |
                              
                                 
                                    H
                                 
                                 
                                    ′
                                 
                              
                              E
                              |
                           
                         (
                           =
                           r
                           
                              (
                              λ
                              )
                           
                        , as in Eq. (3)), in which point 
                           E
                         is the intersection point between the extended line of 
                           
                              
                                 H
                              
                              
                                 ′
                              
                           
                           H
                         and the cutting edge. If 
                           
                              |
                              
                                 
                                    H
                                 
                                 
                                    ′
                                 
                              
                              H
                              |
                           
                           >
                           
                              |
                              
                                 
                                    H
                                 
                                 
                                    ′
                                 
                              
                              E
                              |
                           
                        , then the grass will not intersect the cutting edge, either; otherwise the grass will intersect the cutting edge.

With the above discussion, one can easily decide whether a grass is in contact with the cutting edge with minimum computation cost.

In this work, like in many literatures, we also take the surface boundary curve to generate the first tool path. And then other paths are generated recursively based on the first path. To make it more straightforward, we take the 
                        u
                        =
                        0
                      boundary curve to generate to first path. Suppose the current tool path has been calculated in the previous step and is represented by 
                        
                           
                              
                                 tp
                              
                           
                           
                              i
                           
                        
                        
                           (
                           t
                           )
                        
                     , in which 
                        t
                        ∈
                        
                           [
                           
                              
                                 t
                              
                              
                                 
                                    min
                                 
                              
                           
                           ,
                           
                           
                              
                                 t
                              
                              
                                 
                                    max
                                 
                              
                           
                           ]
                        
                        ⊆
                        
                           [
                           0
                           ,
                           1
                           ]
                        
                     . The task of this section is to calculate the critical grass curve 
                        
                           
                              
                                 gc
                              
                           
                           
                              i
                              +
                              1
                           
                        
                        
                           (
                           t
                           )
                        
                      from 
                        
                           
                              
                                 tp
                              
                           
                           
                              i
                           
                        
                        
                           (
                           t
                           )
                        
                     .


                     
                        
                           
                              
                                 tp
                              
                           
                           
                              i
                           
                        
                        
                           (
                           t
                           )
                        
                      is a curve fitted by a series of 4D abstract point data as 
                        
                           (
                           u
                           ,
                           v
                           ,
                           β
                           ,
                           
                           θ
                           )
                        
                     , in which 
                        u
                      and 
                        v
                      are the surface parameters, 
                        β
                      and 
                        θ
                      are the tool inclining and rotational angles in the corresponding LCS. For a designated parameter 
                        t
                     , the values of 
                        u
                        ,
                        v
                        ,
                        β
                        ,
                        θ
                        ,
                        d
                        u
                        /
                        d
                        t
                      and 
                        d
                        v
                        /
                        d
                        t
                      can be calculated according to 
                        
                           
                              
                                 tp
                              
                           
                           
                              i
                           
                        
                        
                           (
                           t
                           )
                        
                     . If only the 
                        u
                      and 
                        v
                      dimensions are counted, 
                        
                           
                              
                                 tp
                              
                           
                           
                              i
                           
                        
                        
                           (
                           t
                           )
                        
                      can be considered as a curve on the surface, as 
                        S
                        
                           (
                           u
                           
                              (
                              t
                              )
                           
                           ,
                           
                           v
                           
                              (
                              t
                              )
                           
                           )
                        
                     . The tangent of the curve at 
                        t
                      can be calculated as: 
                        
                           (11)
                           
                              
                                 
                                    d
                                    t
                                    
                                       
                                          p
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                 
                                 
                                    d
                                    t
                                 
                              
                              =
                              
                                 
                                    ∂
                                    S
                                 
                                 
                                    ∂
                                    u
                                 
                              
                              ⋅
                              
                                 
                                    d
                                    u
                                 
                                 
                                    d
                                    t
                                 
                              
                              +
                              
                                 
                                    ∂
                                    S
                                 
                                 
                                    ∂
                                    v
                                 
                              
                              ⋅
                              
                                 
                                    d
                                    v
                                 
                                 
                                    d
                                    t
                                 
                              
                              .
                           
                        
                      This tangent is used as the feed direction of the tool path, so: 
                        
                           (12)
                           
                              
                                 f
                              
                              =
                              
                                 
                                    d
                                    t
                                    
                                       
                                          p
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                 
                                 
                                    d
                                    t
                                 
                              
                              .
                           
                        
                      Note that 
                        
                           f
                        
                      is a unit vector, so 
                        
                           f
                        
                        =
                        
                           f
                        
                        /
                        
                           |
                           
                              f
                           
                           |
                        
                     . The CC point 
                        C
                      and surface normal 
                        
                           n
                        
                      (unit vector) can also be calculated with parameters 
                        u
                      and 
                        v
                     . With these, the LCS can be established as in Section  3.1. In the LCS, with the tool inclining and rotational angles 
                        β
                      and 
                        θ
                     , the cutter location can be calculated with Eqs. (4) and (5). On the obtained cutter location, the grass ring is constructed as follows.

Suppose initially, the surface is planted with dense grasses. The heights of the grasses are equal to the allowable scallop error 
                           h
                        . When the cutter is placed on 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              t
                              )
                           
                         at a CC point 
                           C
                         with a certain tool posture, the affected grasses near the CC point will be cut short, leaving a cut area on the surface. This cut area can be represented by a grass ring formed by the critical grasses from the boundary of the area, as shown in Fig. 6
                        . To find these critical grasses, brute-force algorithm can be easily designed by checking each grass on the surface to see whether it intersects the cutting edge. In this work, a bisection in the parametric domain is used to efficiently find the critical grasses for the CC point.

Suppose the corresponding 2D point of the given CC point 
                           C
                         in parametric domain is 
                           
                              
                                 C
                              
                              
                                 ˆ
                              
                           
                           
                              (
                              =
                              
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       C
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       v
                                    
                                    
                                       C
                                    
                                 
                                 )
                              
                              )
                           
                        . For a grass 
                           G
                         in the neighborhood of 
                           C
                        , its corresponding 2D point in parametric domain is 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                           
                              (
                              =
                              
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       G
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       v
                                    
                                    
                                       G
                                    
                                 
                                 )
                              
                              )
                           
                        . The coordinates of 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                         can be represented by:
                           
                              
                                 (13a)
                                 
                                    
                                       
                                          u
                                       
                                       
                                          G
                                       
                                    
                                    =
                                    
                                       
                                          u
                                       
                                       
                                          C
                                       
                                    
                                    +
                                    d
                                    ⋅
                                    cos
                                    φ
                                    ,
                                 
                              
                              
                                 (13b)
                                 
                                    
                                       
                                          v
                                       
                                       
                                          G
                                       
                                    
                                    =
                                    
                                       
                                          v
                                       
                                       
                                          C
                                       
                                    
                                    +
                                    d
                                    ⋅
                                    sin
                                    φ
                                    ,
                                 
                              
                           
                         in which 
                           d
                         is the distance from 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                         to 
                           
                              
                                 C
                              
                              
                                 ˆ
                              
                           
                         in parametric domain and 
                           φ
                         is the angle between segment 
                           
                              
                                 C
                              
                              
                                 ˆ
                              
                           
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                         and the 
                           u
                           +
                         direction, 
                           φ
                           ∈
                           
                              (
                              0
                              ,
                              2
                              π
                              ]
                           
                        , as shown in Fig. 7
                        . With Eq. (13), the grass position on the surface near point 
                           C
                         can also be considered as a function of 
                           φ
                         and 
                           d
                        , namely 
                           G
                           
                              (
                              φ
                              ,
                              
                              d
                              )
                           
                        .

As shown in Fig. 8
                        , for a designated 
                           
                              
                                 φ
                              
                              
                                 0
                              
                           
                         in the parametric domain, in 
                           
                              
                                 φ
                              
                              
                                 0
                              
                           
                         direction, when 
                           d
                           =
                           0
                        , the grass contacts the cutting edge at the grass root (also the CC point 
                           C
                        ); when 
                           d
                         increases, the contact point moves upwards the grass head; and for a relatively large 
                           d
                        , the grass does not contact the cutting edge. The critical 
                           d
                         value that makes the grass contact the cutting edge can be found with a bisection method, as shown in the flow chart in Fig. 9
                        .

In the bisection, the initial lower limit 
                           
                              
                                 d
                              
                              
                                 
                                    lower
                                 
                              
                           
                         is set to be 0. The initial upper limit 
                           
                              
                                 d
                              
                              
                                 
                                    upper
                                 
                              
                           
                         is determined recursively. Initially, 
                           
                              
                                 d
                              
                              
                                 
                                    upper
                                 
                              
                           
                         is set to be a proper guessing value (for example, 0.002). If the current 
                           
                              
                                 d
                              
                              
                                 
                                    upper
                                 
                              
                           
                         value makes the grass contact the cutting edge, then 
                           
                              
                                 d
                              
                              
                                 
                                    upper
                                 
                              
                           
                           =
                           2
                           ⋅
                           
                              
                                 d
                              
                              
                                 
                                    upper
                                 
                              
                           
                        . This process goes on recursively until the grass does not contact the cutting edge. Then the output 
                           
                              
                                 d
                              
                              
                                 
                                    upper
                                 
                              
                           
                         value can be used in the above bisection. The stop condition for the bisection is the satisfaction of the expression: 
                           
                              
                                 d
                              
                              
                                 
                                    upper
                                 
                              
                           
                           −
                           
                              
                                 d
                              
                              
                                 
                                    lower
                                 
                              
                           
                           <
                           
                              
                                 d
                              
                              
                                 ε
                              
                           
                        , in which 
                           
                              
                                 d
                              
                              
                                 ε
                              
                           
                         is a predefined parameter resolution. With the bisection, when 
                           φ
                         grows from 0 to 
                           2
                           π
                        , all the critical grasses can be found and the grass ring can be constructed, as shown in Fig. 6.

When the tool motion is controlled by 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              t
                              )
                           
                         and when 
                           t
                         increases from 
                           
                              
                                 t
                              
                              
                                 
                                    min
                                 
                              
                           
                         to 
                           
                              
                                 t
                              
                              
                                 
                                    max
                                 
                              
                           
                        , two critical grass curves can be found on the envelop of the continuously moving grass rings, as shown in Fig. 10
                        . Only the grass curve in the cross-feed direction is responsible for the next tool path. Notice that the head of the grass curve forms the scallop curve, as has been mentioned in  [31].

In real computational implementations, to calculate the grass ring for a CC point, a 
                           
                              Δ
                           
                           φ
                         is set to control the increment of 
                           φ
                        . For example, if 
                           
                              Δ
                           
                           φ
                           =
                           π
                           /
                           180
                         (one degree), then 360 critical grasses can be calculated on the grass ring. And to calculate all the grass rings for the tool path 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              t
                              )
                           
                        , a 
                           
                              Δ
                           
                           t
                         is set to control the increment of 
                           t
                        . Then the grass curve can be obtained by fitting those responsible target grasses in each grass ring. In a grass ring, only one critical grass is responsible for the to-be-fitted grass curve. It is necessary to find the target grass in each grass ring. And for a given grass ring with its discrete grasses, the target grass should be in the orthogonal direction of the current tool path.

As shown in Fig. 11
                        , point 
                           C
                         is the current CC point, 
                           
                              
                                 G
                              
                              
                                 i
                              
                           
                         is the root point of a random grass from the grass ring, 
                           
                              f
                           
                         (also the feed direction, unit vector) is the tangent of the tool path curve 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              t
                              )
                           
                         at 
                           C
                        , and 
                           
                              n
                           
                         is the surface normal. The angle 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                         formed by 
                           
                              f
                           
                         and 
                           
                              
                                 
                                    CG
                                 
                              
                              
                                 
                                    i
                                 
                              
                           
                         can be calculated as: 
                           
                              (14)
                              
                                 
                                    
                                       ω
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 arccos
                                 
                                    (
                                    
                                       f
                                    
                                    ⋅
                                    
                                       
                                          
                                             
                                                
                                                   CG
                                                
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          
                                             |
                                             
                                                
                                                   
                                                      CG
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             |
                                          
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         Note that the resulting 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                         from Eq. (14) ranges only from 0 to 
                           π
                        , while in reality, 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                         may range from 0 to 
                           2
                           π
                        , as shown in Fig. 11. To get the full range of 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                        , a flag is set as: 
                           
                              (15)
                              
                                 
                                    flag
                                 
                                 =
                                 
                                    (
                                    
                                       f
                                    
                                    ×
                                    
                                       
                                          
                                             CG
                                          
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 ⋅
                                 
                                    n
                                 
                                 ,
                              
                           
                         in which ‘
                           ×
                        ’ and ‘
                           ⋅
                        ’ are the cross and dot product operators, respectively. With flag, at first, Eq. (14) is used to calculate the initial 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                         value. And then Eq. (15) is used. If 
                           
                              flag
                           
                           <
                           0
                        , then 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                           =
                           2
                           π
                           −
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                        ; otherwise, 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                         stays the initial value. Each 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                         can be calculated for each critical grass in the ring. The grass that makes the smallest value for the absolute value expression 
                           
                              |
                              
                                 
                                    ω
                                 
                                 
                                    i
                                 
                              
                              −
                              3
                              π
                              /
                              2
                              |
                           
                         is selected to be target grass.

In this work, as a directional-parallel tool path pattern is applied, for tool path curve 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              t
                              )
                           
                        , when 
                           t
                           =
                           
                              
                                 t
                              
                              
                                 
                                    min
                                 
                              
                           
                         or 
                           t
                           =
                           
                              
                                 t
                              
                              
                                 
                                    max
                                 
                              
                           
                        , the first or last CC point is on (or near) the surface boundary. To ensure that the corresponding to-be-fitted grass curve also touches the surface boundary, the first or last target grass is picked directly on the surface boundary. With the recursive development of the grass curves, it is possible that the first or last target grass moves onto other surface boundaries, as shown in Fig. 12
                        .

The obtained target grasses are expressed by the parametric coordinates 
                           
                              (
                              u
                              ,
                              v
                              )
                           
                         of the root points in parametric domain. These 2D parametric points 
                           
                              (
                              u
                              ,
                              v
                              )
                           
                           s
                         are used as data points for curve fitting (interpolating or approximating). The output of the fitting process is a grass curve 
                           
                              
                                 
                                    gc
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                           ,
                           
                           t
                           ∈
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                        . This curve is used to generate the next tool path 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                         of 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              t
                              )
                           
                        .

Note that due to the truncated error of the computers, the beginning or the ending part of the curve may not be in the legal parametric range, as shown in Fig. 13
                        . A simple bisection method can be designed to find the legal range [
                           
                              
                                 t
                              
                              
                                 
                                    min
                                 
                              
                           
                           ,
                           
                           
                              
                                 t
                              
                              
                                 
                                    max
                                 
                              
                           
                        ] of 
                           t
                        . When 
                           t
                           ∈
                           
                              [
                              
                                 
                                    t
                                 
                                 
                                    
                                       min
                                    
                                 
                              
                              ,
                              
                              
                                 
                                    t
                                 
                                 
                                    
                                       max
                                    
                                 
                              
                              ]
                           
                        , the resulting 2D points are in legal parametric range.

The task of this section is to find the next tool path curve 
                        
                           
                              
                                 tp
                              
                           
                           
                              i
                              +
                              1
                           
                        
                        
                           (
                           t
                           )
                        
                      based on the obtained grass curve 
                        
                           
                              
                                 gc
                              
                           
                           
                              i
                              +
                              1
                           
                        
                        
                           (
                           t
                           )
                        
                     , such that when the tool is positioned at any CC point of 
                        
                           
                              
                                 tp
                              
                           
                           
                              i
                              +
                              1
                           
                        
                        
                           (
                           t
                           )
                        
                     , the cutting edge touches the head of the corresponding grass on the grass curve 
                        
                           
                              
                                 gc
                              
                           
                           
                              i
                              +
                              1
                           
                        
                        
                           (
                           t
                           )
                        
                     . The tool path generating process is similar to the grass curve generating process. At first, a 
                        
                           Δ
                        
                        t
                      is set for the grass curve 
                        
                           
                              
                                 gc
                              
                           
                           
                              i
                              +
                              1
                           
                        
                        
                           (
                           t
                           )
                        
                      to control the increment. For each grass on 
                        
                           
                              
                                 gc
                              
                           
                           
                              i
                              +
                              1
                           
                        
                        
                           (
                           t
                           )
                        
                     , a corresponding CC point is found such that when the tool is positioned at the CC point, the cutting edge touches exactly on the head of the grass. Note that these obtained CC points should contain also the tool orientation information. Then these CC points are fitted into a tool path curve.

However, the above task is much more difficult than that of generating the grass curve based on a known tool path. The main difficulty comes from the undetermined tool orientations of undetermined CC points. To solve the tool orientation problem, the LCS for a to-be-determined CC point should be established first.

On 
                           
                              
                                 
                                    gc
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                        , for a designated 
                           t
                         value, the corresponding grass 
                           G
                         can be calculated. In the neighborhood of grass 
                           G
                        , suppose point 
                           C
                         is the corresponding target CC point. Note that 
                           C
                         will be used as one of the data points for the tool path curve fitting. And when the tool path is obtained, it can be considered to be an offset curve of the grass curve. So the tangent direction (denoted by 
                           
                              f
                           
                        ) of the tool path at CC point 
                           C
                         should be parallel with the tangent direction (denoted by 
                           
                              a
                           
                        ) of the grass curve at grass 
                           G
                        . Note that 
                           
                              f
                           
                         is also the cutter feed direction on 
                           C
                         and it will be used for the 
                           X
                        -axis of the LCS. With 
                           
                              
                                 
                                    gc
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                        , 
                           
                              a
                           
                         can be calculated as: 
                           
                              (16)
                              
                                 
                                    a
                                 
                                 =
                                 
                                    
                                       d
                                       g
                                       
                                          
                                             c
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                    
                                    
                                       d
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       ∂
                                       S
                                    
                                    
                                       ∂
                                       u
                                    
                                 
                                 ⋅
                                 
                                    
                                       d
                                       u
                                    
                                    
                                       d
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       ∂
                                       S
                                    
                                    
                                       ∂
                                       v
                                    
                                 
                                 ⋅
                                 
                                    
                                       d
                                       v
                                    
                                    
                                       d
                                       t
                                    
                                 
                                 .
                              
                           
                        
                     

Note that 
                           
                              f
                           
                         and 
                           
                              a
                           
                         are on the tangent planes of 
                           C
                         and 
                           G
                        , respectively. Due to the irregular surface curvatures, 
                           
                              f
                           
                         and 
                           
                              a
                           
                         might not be in the same direction, as shown in Fig. 14
                        . In reality, 
                           
                              f
                           
                         is calculated with
                           
                              (17)
                              
                                 
                                    f
                                 
                                 =
                                 
                                    (
                                    
                                       a
                                    
                                    ⋅
                                    
                                       i
                                    
                                    )
                                 
                                 ⋅
                                 
                                    i
                                 
                                 +
                                 
                                    (
                                    
                                       a
                                    
                                    ⋅
                                    
                                       j
                                    
                                    )
                                 
                                 ⋅
                                 
                                    j
                                 
                                 ,
                              
                           
                         in which 
                           
                              i
                           
                         and 
                           
                              j
                           
                         are random picked orthogonal unit vectors on the tangent plane of 
                           C
                        , as shown in Fig. 14. As 
                           
                              f
                           
                         is a unit vector, the result from Eq. (17) needs to be unitized. With the above information, the LCS of 
                           C
                         can be established referring to Section  3.1.

In the LCS, the tool orientation is controlled by the inclining angle 
                           β
                         and the rotational angle 
                           θ
                        . Here many tool positioning and collision detecting and avoidance techniques as mentioned in Section  2 can be used, by adjusting the 
                           β
                         and 
                           θ
                         values. The purpose of using these techniques is to achieve the maximum machining strip, meanwhile to avoid collisions.

In this work, however, we focus specifically on the iso-scallop tool path generation. So the optimization for 
                           β
                         and 
                           θ
                         are left as an interface for the available techniques. In this work, for convenience, once the 
                           β
                         and 
                           θ
                         values are set, they remain unchanged for all the CC points, for example, 
                           θ
                           =
                           0
                         and 
                           β
                           =
                           π
                           /
                           9
                         (20°).

For a given grass 
                           G
                         on the grass curve 
                           
                              
                                 
                                    gc
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                        , its coordinates in the 2D parametric domain is denoted by 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                           
                              (
                              =
                              
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       G
                                    
                                 
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       G
                                    
                                 
                                 )
                              
                              )
                           
                        . In the neighborhood of grass 
                           G
                        , the coordinates of a CC point 
                           C
                         in the 2D parametric domain is denoted by 
                           
                              
                                 C
                              
                              
                                 ˆ
                              
                           
                           
                              (
                              =
                              
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       C
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       v
                                    
                                    
                                       C
                                    
                                 
                                 )
                              
                              )
                           
                        . 
                           
                              
                                 u
                              
                              
                                 C
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 C
                              
                           
                         can be expressed as: 
                           
                              
                                 (18a)
                                 
                                    
                                       
                                          u
                                       
                                       
                                          C
                                       
                                    
                                    =
                                    
                                       
                                          u
                                       
                                       
                                          G
                                       
                                    
                                    +
                                    d
                                    cos
                                    φ
                                    ,
                                 
                              
                              
                                 (18b)
                                 
                                    
                                       
                                          v
                                       
                                       
                                          C
                                       
                                    
                                    =
                                    
                                       
                                          v
                                       
                                       
                                          G
                                       
                                    
                                    +
                                    d
                                    sin
                                    φ
                                    ,
                                 
                              
                           
                         in which 
                           d
                         is the distance from 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                         to 
                           
                              
                                 C
                              
                              
                                 ˆ
                              
                           
                         in the parametric domain, and 
                           φ
                         is angle formed by segment 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                           
                              
                                 C
                              
                              
                                 ˆ
                              
                           
                         and the 
                           u
                           +
                         line, 
                           φ
                           ∈
                           
                              (
                              0
                              ,
                              2
                              π
                              ]
                           
                        , as shown in Fig. 15
                        . Actually, Eq. (18) is the reverse form of Eq. (13).

From Eq. (18), if 
                           d
                         and 
                           φ
                         values in parametric domain are given, the CC point 
                           C
                         can be located. With grass 
                           G
                        , the LCS for the CC point 
                           C
                         can be built (see Section  5.1). In the LCS, optimized 
                           β
                         and 
                           θ
                         values can be determined from the interface. With 
                           β
                         and 
                           θ
                         values, the tool position can be calculated. It is a fact that in the neighborhood of grass 
                           G
                        , if the same optimized rule is used to optimize the tool orientation, then the tool orientation will not change much.

For a fixed 
                           
                              
                                 φ
                              
                              
                                 0
                              
                           
                         value, as shown in Fig. 16
                        , when 
                           d
                           =
                           0
                        , the cutting edge contacts the grass 
                           G
                         at the grass root; when 
                           d
                         increases, the contact point moves along the grass upwards the grass head; and when 
                           d
                         equals to a relatively large value, the cutting edge will not contact the grass at all. A bisection method similar to that in Section  4.1 can be used to find the critical 
                           d
                        .

When the critical 
                           d
                         value in 
                           
                              
                                 φ
                              
                              
                                 0
                              
                           
                         direction is determined, the corresponding critical CC point can be calculated. And when 
                           φ
                         increases from 0 to 
                           2
                           π
                        , all the CC points can be found and they form a ring (CC ring) around the grass, as shown in Fig. 17
                        .

As shown in Fig. 17, also, a 
                           
                              Δ
                           
                           φ
                         is set to control the increment of 
                           φ
                        . In the obtained CC points, only one point is responsible for the to-be-fitted tool path curve. The rule of finding the target CC point in a CC ring is similar to that in Section  4.2. As shown in Fig. 17, 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                         is the angle formed by the tangent (
                           
                              a
                           
                        ) of the grass curve at grass 
                           G
                         and the vector 
                           
                              
                                 
                                    GC
                                 
                              
                              
                                 
                                    i
                                 
                              
                           
                        , 
                           
                              
                                 ω
                              
                              
                                 i
                              
                           
                           ∈
                           
                              (
                              0
                              ,
                              2
                              π
                              ]
                           
                        . The target CC point is the CC point that makes the minimum value of the absolute value expression 
                           
                              |
                              
                                 
                                    ω
                                 
                                 
                                    i
                                 
                              
                              −
                              3
                              π
                              /
                              2
                              |
                           
                        . For the first and last target CC points, they are also picked on the surface boundary, as in Section  4.2.

The obtained CC points are expressed in the format as 
                           
                              (
                              u
                              ,
                              v
                              ,
                              β
                              ,
                              θ
                              )
                           
                        , in which 
                           u
                         and 
                           v
                         are the surface parameters, 
                           β
                         and 
                           θ
                         are tool inclining and rotational angles in the corresponding LCS. These 
                           
                              (
                              u
                              ,
                              v
                              ,
                              β
                              ,
                              θ
                              )
                           
                        s are used as the data points for the tool path curve fitting. The output of the fitting process is a tool path curve 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                        . Please also note that due to the truncated error of the computers, the beginning or the ending part of the curve may not be in the legal range. The legal range [
                           
                              
                                 t
                              
                              
                                 
                                    min
                                 
                              
                           
                           ,
                           
                           
                              
                                 t
                              
                              
                                 
                                    max
                                 
                              
                           
                        ] of 
                           t
                         can be found. When 
                           t
                           ∈
                           
                              [
                              
                                 
                                    t
                                 
                                 
                                    
                                       min
                                    
                                 
                              
                              ,
                              
                              
                                 
                                    t
                                 
                                 
                                    
                                       max
                                    
                                 
                              
                              ]
                           
                        , the resulting 2D points are in legal parametric range.

The obtained 
                           
                              
                                 
                                    tp
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                           ,
                           t
                           ∈
                           
                              [
                              
                                 
                                    t
                                 
                                 
                                    
                                       min
                                    
                                 
                              
                              ,
                              
                              
                                 
                                    t
                                 
                                 
                                    
                                       max
                                    
                                 
                              
                              ]
                           
                        , is then substituted into Section  4 to generate the next grass curve until the whole surface is covered. In this way the iso-scallop tool paths can be generated recursively.

In Sections  4 and 5, the concepts of grass and CC rings are introduced. However, in a grass/CC ring, only one grass/CC point is useful. Obviously it is inefficient to first calculate all the grasses/CC points in a ring and then find the target one. To speed up to tool path generation process, in real computational implementations, finding the target grass/CC point in a ring must be optimized.

As in Sections  4 and 5, for a designated 
                        φ
                      value in the parametric domain, the corresponding critical grass/CC point in physical space can be found; and then the angle 
                        ω
                      (see Figs. 11 or 17) between the grass/CC point and the curve tangent can also be found. So 
                        ω
                      can be considered as a function of 
                        φ
                      (see Figs. 7 and 15), thus: 
                        
                           (19)
                           
                              ω
                              =
                              ω
                              
                                 (
                                 φ
                                 )
                              
                              .
                           
                        
                      As the surface mapping system from 2D parametric domain to 3D physical space is nonlinear, Eq. (19) is nonlinear, either.

Here we take the grass ring for example. The to-be-optimized problem can be simply described as: finding the grass in the 
                        3
                        π
                        /
                        2
                     -direction of the feed direction 
                        
                           f
                        
                      as quickly as possible, as shown in Fig. 11. If Eq. (19) is also involved, then the problem can be specifically described as: finding the 
                        φ
                      that makes 
                        ω
                      equal to 
                        3
                        π
                        /
                        2
                      with minimum computation. Although Eq. (19) is known to be nonlinear, the independent and dependent variables have certain connections: 
                        
                           1.
                           
                              
                                 φ
                               is in the range of 
                                 
                                    (
                                    0
                                    ,
                                    2
                                    π
                                    ]
                                 
                               and 
                                 ω
                               is obviously also in the range of 
                                 
                                    (
                                    0
                                    ,
                                    2
                                    π
                                    ]
                                 
                              .

When 
                                 φ
                               turns a round from 0 to 
                                 2
                                 π
                                 ,
                                 ω
                               also turns a round back to its initial value.

When 
                                 φ
                               increases 
                                 π
                                 /
                                 180
                               (1°), 
                                 ω
                               also increases averagely 
                                 π
                                 /
                                 180
                              .

With these connections, another bisection as shown in Fig. 18
                      is designed to efficiently find the target grass/CC point. As 
                        ω
                        
                           (
                           φ
                           )
                        
                      is a periodic function and the period is 
                        2
                        π
                     , in the bisection, the initial lower limit of 
                        φ
                     , which is 
                        
                           
                              φ
                           
                           
                              
                                 lower
                              
                           
                        
                     , is set to be 0, and the initial upper limit of 
                        φ
                     , which is 
                        
                           
                              φ
                           
                           
                              
                                 upper
                              
                           
                        
                     , is set to be 
                        π
                     . The calculated 
                        ω
                      values for 
                        
                           
                              φ
                           
                           
                              
                                 lower
                              
                           
                        
                      and 
                        
                           
                              φ
                           
                           
                              
                                 upper
                              
                           
                        
                      are denoted by 
                        
                           
                              ω
                           
                           
                              
                                 lower
                              
                           
                        
                      and 
                        
                           
                              ω
                           
                           
                              
                                 upper
                              
                           
                        
                     , respectively. If 
                        3
                        π
                        /
                        2
                      is not in the domain of [
                        
                           
                              ω
                           
                           
                              
                                 lower
                              
                           
                        
                        ,
                        
                           
                              ω
                           
                           
                              
                                 upper
                              
                           
                        
                     ], then 
                        
                           
                              φ
                           
                           
                              
                                 lower
                              
                           
                        
                      is reset to 
                        π
                      and 
                        
                           
                              φ
                           
                           
                              
                                 upper
                              
                           
                        
                      is reset to 
                        2
                        π
                     . It must be noticed that here in the domain of [
                        
                           
                              ω
                           
                           
                              
                                 lower
                              
                           
                        
                        ,
                        
                        
                           
                              ω
                           
                           
                              
                                 upper
                              
                           
                        
                     ], 
                        
                           
                              ω
                           
                           
                              
                                 lower
                              
                           
                        
                      must be smaller than 
                        
                           
                              ω
                           
                           
                              
                                 upper
                              
                           
                        
                     . If the calculated results do not agree with this, for example, 
                        
                           
                              ω
                           
                           
                              
                                 lower
                              
                           
                        
                        =
                        π
                      and 
                        
                           
                              ω
                           
                           
                              
                                 upper
                              
                           
                        
                        =
                        π
                        /
                        4
                     , then 
                        
                           
                              ω
                           
                           
                              
                                 upper
                              
                           
                        
                      is added with 
                        2
                        π
                     , so for this case, 
                        
                           
                              ω
                           
                           
                              
                                 upper
                              
                           
                        
                      becomes 
                        9
                        π
                        /
                        4
                     . When the obtained initial upper and lower limits of 
                        φ
                     , the bisection begins to quickly find the target grass/CC point.

The stop condition for the bisection shown in Fig. 18 is the satisfaction of the expression: 
                        
                           
                              φ
                           
                           
                              
                                 upper
                              
                           
                        
                        −
                        
                           
                              φ
                           
                           
                              
                                 lower
                              
                           
                        
                        <
                        
                           
                              φ
                           
                           
                              ε
                           
                        
                     , in which 
                        
                           
                              φ
                           
                           
                              ε
                           
                        
                      is a predefined angle resolution. For example, if 
                        
                           
                              φ
                           
                           
                              ε
                           
                        
                      is set to be 
                        π
                        /
                        180
                     , then the target grass/CC point angle precision is within one degree; and only 10 times of Eq. (19) will be called to calculate the 
                        ω
                      values.

With this optimization, the target grass/CC point in a ring can be efficiently found, without calculating the whole ring. Thus the whole tool path generation efficiency can be improved.

The proposed iso-scallop tool path generation method in this work is implemented in C++ programming language. Meanwhile, the Standard Template Library (STL) is used to handle the arrays and the Matrix Template Library (MTL)  [48] is used to handle the sparse matrix operations in the curve fitting process. The test program is run on a Lenovo T400 model laptop with P8700 CPU @ 2.53 GHz and 3 GB RAM. In the test program, the inclining angle 
                        β
                      and the rotational angle 
                        θ
                      in the LCS are left as an interface.

Though, in the test examples, we focus on the iso-scallop tool path generation process, so the tool positioning and the collision problems are not taken into consideration. We set constant values to 
                        β
                      and 
                        θ
                     . They are set to be 
                        π
                        /
                        9
                      (20°) and 0, respectively, that is to say, the cutter inclines 20° forwards the cutter feed direction. The parameter resolution 
                        
                           
                              d
                           
                           
                              ε
                           
                        
                      as in Fig. 9 is set to be 1.0×10−5. The angle resolution 
                        
                           
                              φ
                           
                           
                              ε
                           
                        
                      as in Fig. 18 is set to be 
                        π
                        /
                        180
                      (1°). The increment step 
                        
                           Δ
                        
                        t
                      of 
                        t
                      for the tool path curve 
                        
                           
                              
                                 tp
                              
                           
                           
                              i
                           
                        
                        
                           (
                           t
                           )
                        
                      or grass curve 
                        
                           
                              
                                 gc
                              
                           
                           
                              i
                           
                        
                        
                           (
                           t
                           )
                        
                      is set to be 0.01, that is to say, about 100 sample target grasses/CC points will be imported into the curve fitting procedure in each recursive step. The parameter settings are also listed in Table 1
                     .

In the test program, the target grasses/CC points are fitted into curves by the cubic 
                        B
                     -spline curve approximation method. In the approximation process, 20 control points are used to approximate the 100 data points. And the knot vector of the 
                        B
                     -spline is evenly selected from 0 to 1. Frankly, in this work, we have not done any optimizations to improve the precision of the 
                        B
                     -spline curve approximation.

The tested parametric surfaces are created in the famous software CATIA and are saved in IGES format. These surfaces are actually NURBS surfaces. Fig. 19
                      shows the first surface we have tested. It is a typical four-side surface with the size about 
                        90
                        ×
                        90
                        
                        
                           
                              
                                 mm
                              
                           
                           
                              2
                           
                        
                     . The boundary areas of the surface are convex and the center area is concave like a bowl. A filleted-end mill with the bottom radius 
                        
                           
                              R
                           
                           
                              1
                           
                        
                        =
                        5
                        
                        
                           mm
                        
                      and the corner radius 
                        
                           
                              R
                           
                           
                              2
                           
                        
                        =
                        3
                        
                        
                           mm
                        
                      is used to cut along a pre-existing tool path to generate the machining band. For better view, the scallop error 
                        h
                      will be set relatively bigger, in this example, 
                        h
                        =
                        0.04
                        
                        
                           mm
                        
                     . Note that in this example, the rings are calculated brutally. In each ring, there are 360 grasses. The increment step 
                        
                           Δ
                        
                        t
                      of the tool path is set to be 0.004, so there are about 250 grass rings. Fig. 19 shows the calculated machining band, which is formed by the crowded root points of the grass rings (see also the enlarged view). From Fig. 19, it can be seen clearly that the width of the machining band in the concave area is wider than that in the convex area, which agrees well with the conclusions of Lee  [39]. With the same cutting parameters, iso-scallop tool paths are generated to cover the same surface, as shown in Fig. 20
                     . It can be seen from Fig. 20 that these tool paths are well distributed. In Fig. 20, there are in all 49 tool path curves; and the start and end points of the last five tool path curves are on the 
                        u
                        =
                        1
                      boundary curve. The tool path generation process stops because the last tool path curve locates entirely on the 
                        u
                        =
                        1
                      boundary curve.

In the second example, we have compared our program with PowerMILL 10.0 and UG NX 8 on machining parametric surface. Another surface as shown in Fig. 21
                      is picked in this example. This surface is specially designed so that the 
                        v
                        =
                        1
                      boundary curve (about 36 mm) is much shorter than the 
                        v
                        =
                        0
                      boundary curve (about 110 mm), as shown in Fig. 21(a). In these tests, fillet-end mills with the same size (
                        
                           
                              R
                           
                           
                              1
                           
                        
                        =
                        5
                        
                        
                           mm
                        
                     , 
                        
                           
                              R
                           
                           
                              2
                           
                        
                        =
                        3
                        
                        
                           mm
                        
                     ) are selected. In UG and our test program, the scallop errors are both set to be 0.04 mm. In PowerMILL, for parametric surface finish machining, only the path interval can be set and this value is set to be 2 mm. The generated tool paths are shown in Fig. 21. Fig. 21(a) shows the iso-scallop tool path generated by our program; Fig. 21(b) shows the tool path generated by PowerMILL; and Fig. 21(c) shows the tool path generated by UG. It can be seen from Fig. 21(a) that all the path intervals are uniformly distributed. From Fig. 21(b) and (c), it can been seen that the path intervals of PowerMILL and UG are wider near the 
                        v
                        =
                        0
                      boundary curve; and the intervals become narrower near the 
                        v
                        =
                        1
                      boundary curve. As a result, narrower path intervals cause reluctant tool paths and lower machining efficiency. For PowerMILL and UG, guessing from distributions, their paths might be iso-parametric.

Two more examples are used to test our program. The third example is tested on a peanut-like surface, as shown in Fig. 22
                     . This surface is about 120 mm by 70 mm in size and is machined with a cutter with 
                        
                           
                              R
                           
                           
                              1
                           
                        
                        =
                        3
                        
                        
                           mm
                        
                      and 
                        
                           
                              R
                           
                           
                              2
                           
                        
                        =
                        2
                        
                        
                           mm
                        
                     . The scallop error is set to be 0.01 mm, so the tool path curves in Fig. 22 are much denser. The fourth example is tested on a turbo fan surface, as shown in Fig. 23
                     (a). Originally, the fan is about 2000 mm in length. It is scaled to 200 mm in length for the demonstration purpose. A cutter with 
                        
                           
                              R
                           
                           
                              1
                           
                        
                        =
                        5
                        
                        
                           mm
                        
                      and 
                        
                           
                              R
                           
                           
                              2
                           
                        
                        =
                        3
                        
                        
                           mm
                        
                      is selected and the scallop error is set to be 0.02 mm. The generated iso-scallop tool path is depicted in Fig. 23(b).

Although the tool path generation method in this work is designed for directional-parallel pattern iso-scallop tool path, the same method has also the ability to generate contour-parallel pattern iso-scallop tool path, simply by neglecting the operations on the first/last grasses/CC points which are on the surface boundary. This ability is verified in the fifth example. For convenience, we pick an arbitrary 2D circle (expressed also in cubic 
                        B
                     -spline curve) in the parametric domain of the freeform surface. This 2D circle, when mapping on to the 3D surface, is used as the initial grass curve for the contour-parallel tool path generation process. In this example, a tool with 
                        
                           
                              R
                           
                           
                              1
                           
                        
                        =
                        3
                        
                        
                           mm
                        
                      and 
                        
                           
                              R
                           
                           
                              2
                           
                        
                        =
                        3
                        
                        
                           mm
                        
                      is used and the scallop error is set to be 0.01 mm. The generated contour-parallel tool path curves are depicted in Fig. 24
                     . In Fig. 24, there are 30 tool path curves. The stop condition of the generation process is manually controlled. If the process continues, sharp angles and self-intersections will appear on tool path. We have done some research on predicting and handling self-intersections in 2D curve offsetting  [1]; however, so far, we are not able to handle them in the 3D space. It seems that if a contour-parallel tool path pattern is applied, no matter how smooth the first tool path is, sharp angles would eventually appear in the successive shrinking process. These unavoidable sharp angles will cause sudden changes of cutter feed directions, which is bad for finished surface quality. On this sense, directional-parallel tool path pattern might be more suitable for the surface finishing process.

The statistics including the parameter settings and the executing time of each example above by our program is detailed in Table 2
                     . From Table 2, the program executing time for each example is much greater (about 36 times) if the optimization of finding the target grass/CC point as in Section  6 is not applied. However, with optimization, the executing time of each example is within 1 min. This performance suggests that the proposed iso-scallop tool path generation method is suitable for practical use.

A real cutting experiment is carried out on the Mikron UCP 600 model five-axis machine tool. This machine tool is equipped with Heidenhain iTNC530 control system and has two rotary axes (
                        A
                      and 
                        C
                      axes) on the working table, as shown in Fig. 25
                     (a). The surface as shown in Fig. 19 is used for this experiment. A filleted-end mill with 
                        
                           
                              R
                           
                           
                              1
                           
                        
                        =
                        2
                        
                        
                           mm
                        
                      and 
                        
                           
                              R
                           
                           
                              2
                           
                        
                        =
                        1
                        
                        
                           mm
                        
                      is picked to generate the iso-scallop tool path on this surface and the scallop height is set to be 0.02 mm. To make it simple, each of the obtained tool path curves is scattered with constant parameter distance. The obtained scattered cutter locations are then processed by a simple postprocessor developed by ourselves with the M128 TCPM (Tool Center Point Management) function. Fig. 25(a) shows the aluminum stock setup on the machine tool and Fig. 25(b) shows the roughed stock. The roughing tool path is generated by UG NX 8. Fig. 25(c) shows the finished workpiece by the proposed iso-scallop tool path. In the finishing process, the feed speed is set to be 1500 mm/min, and the spindle speed is set to be 15000 r/min. The whole finishing process takes about 35 min. Fig. 25(d) shows the amplified details of the tool tracks on the machined surface. From Fig. 25(d), it can be seen clearly that the scallops between the tool tracks are uniformly distributed. The cutting experiment suggests the proposed iso-scallop tool path is feasible in practice.

@&#CONCLUSIONS AND FUTURE WORK@&#

In this work, we have generated the five-axis iso-scallop tool path on freeform surfaces via cutting simulation. Here the term tool path refers to a four-dimensional curve, in which the first two dimensions identify the CC points and the last two dimensions identify the tool orientations. The basic idea of this work is simple. Initially, the freeform surface is planted with dense grasses and then a cutter is driven along the current tool path. The grasses that make contact with the cutting edge of the cutter are cut short. As a result, the machining band of the current tool path can be formed. After that, the next tool path can be calculated so that the next and current machining bands share the common boundary. This common boundary is formed by the critical grasses thus is called grass curve. So basically, there are two steps in generating an iso-scallop tool path: generating the grass curve and generating the tool path curve.

In the first step, a number of CC points are picked on the current tool path. When the cutter is placed on each CC point, the grass ring can be constructed with a bisection method. The target grasses can be located in the vertical direction current tool path. The obtained target grasses are then fitted in parametric domain into a grass curve. The grass curve is then used for the next tool path generation. In the second step, a number of grasses are picked on the above obtained grass curve. For each grass, the CC ring can be constructed. In each CC ring, the target CC point can also be found in the vertical direction of the grass curve. Then the tool path curve can be generated by fitting the obtained target CC points. With these two fundamental steps, the iso-scallop tool path curves can be generated recursively until the whole surface is covered. An optimization is also proposed to improve the computing efficiency of finding the target grasses/CC points. The proposed iso-scallop tool path generation method in this work is free of the spherical assumption, the coplanar assumption and the cutting shape assumption, so the method is generic and suitable for larger cutters.

One inherited problem in the recursive way of generating tool path is that if a tool path is disturbed (maybe by a sudden change of the surface curvature) somewhere, then this disturbance will be passed on to its successors. This phenomenon can be observed from the waved paths in Fig. 21(a). Another problem is in the sampling and fitting process. Now in this work, the sampling grass/CC points are picked evenly in the parametric domain, and the knot vectors of the 
                        B
                     -spline fitting process are also picked evenly, which will surely influence the precision of the generated tool path. In the cutting experiment, we have observed vibrations of the machine tool during the machining process. As a result, some tool marks are left on the finished surface. Further research should be done on these aspects.

@&#ACKNOWLEDGMENTS@&#

This work was financially supported by Science Fund for Creative Research Groups of National Natural Science Foundation of China (No. 51221004), the National Nature Science Foundation of China (No. 51175461) and the Fundamental Research Funds for the Central Universities (No. 2014QNA4004).

@&#REFERENCES@&#

