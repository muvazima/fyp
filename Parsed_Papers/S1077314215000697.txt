@&#MAIN-TITLE@&#Identifying multiple objects from their appearance in inaccurate detections

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Localize and learn appearances of targets from object detections in video.


                        
                        
                           
                           Associate targets to features instead of detections to deal with partial occlusions.


                        
                        
                           
                           Post-processing provides pixel-level segmentation of individual objects.


                        
                        
                           
                           Scenarios can have inaccurate detections, occlusions, erratic motion, frame skips.


                        
                        
                           
                           Outperforms state-of-the-art batch and online multi-view trackers on fight scenes.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Object recognition

Segmentation

Generative model

Unsupervised learning

Latent Dirichlet Allocation

Video surveillance

@&#ABSTRACT@&#


               
               
                  We propose a novel method for keeping track of multiple objects in provided regions of interest, i.e. object detections, specifically in cases where a single object results in multiple co-occurring detections (e.g. when objects exhibit unusual size or pose) or a single detection spans multiple objects (e.g. during occlusion). Our method identifies a minimal set of objects to explain the observed features, which are extracted from the regions of interest in a set of frames. Focusing on appearance rather than temporal cues, we treat video as an unordered collection of frames, and “unmix” object appearances from inaccurate detections within a Latent Dirichlet Allocation (LDA) framework, for which we propose an efficient Variational Bayes inference method. After the objects have been localized and their appearances have been learned, we can use the posterior distributions to “back-project” the assigned object features to the image and obtain segmentation at pixel level. In experiments on challenging datasets, we show that our batch method outperforms state-of-the-art batch and on-line multi-view trackers in terms of number of identity switches and proportion of correctly identified objects. We make our software and new dataset publicly available for non-commercial, benchmarking purposes.
               
            

@&#INTRODUCTION@&#

Traditional tracking-by-detection approaches contain a data association step in which detections are matched to inferred object properties such as appearance, size, and location. However, this poses problems when objects are temporarily (partially) occluded or undetected. Wrong data association can deteriorate the learned object appearances, which further affects future associations. This exposes a chicken-and-egg problem: To localize objects in a scene, image observations need to be correctly associated to candidate objects, which requires knowledge of the object-specific identifying properties. Learning such properties from the observations, however, requires prior knowledge of the presence and location of the objects in the scene. Additionally, camera calibration may be unreliable (i.e. camera orientation may have changed) or unavailable, thus predefined detection windows may not necessarily fit the targets, and objects may exhibit unusual pose or size, resulting in low confidence detections that complicate association even more.

This paper focuses on these related problems, and presents a novel graphical model to determine the number of objects, their appearance, and their location per frame, from possibly inaccurate detections. To exploit detections that contain multiple partially occluding objects and background, we seek to loosen the traditional one-to-one relation between detections and objects, and instead infer which of the low-level appearance features present in a detection belong to what target. Key to our method is the adaptation of Latent Dirichlet Allocation (LDA) to “unmix” a number of consistent object appearances in the comparatively large number of detected regions, which are represented as a bag-of-features. This allows us to infer the presence and appearance of an object, even when a single object is responsible for multiple detections and when a single detection spans multiple objects, as often happens in the case of partial occlusion of one object by another. Hence, occluding objects are separated at the feature level and we eliminate the need for special treatment of assignments and appearance updates under occlusion. Additionally, we exploit that in a single frame an object is local to a part of that frame, so that non-overlapping detections are unlikely to both contain the same object. This spatial constraint is enforced by modeling each frame as a mixture of objects whose feature locations have a Gaussian distribution centered at an object’s image location. In post-processing, we can optionally “back-project” the feature labels in all images, and segment individual targets. These steps are illustrated in Fig. 1
                      on a frame from a challenging fight scene.

To demonstrate the appearance “unmixing” paradigm, we address multi-target association (up to the pixel level) in a batch of frames for scenes with static background and a reasonable upper limit on the expected object count, but where detections from an external object detector may be inaccurate. Our method is compatible with traditional tracking frameworks where motion models reduce the positional uncertainty, since our model incorporates a prior distribution over each object’s location. Many different approaches have been proposed to enforce temporal consistency (e.g. merging tracklets [32], searching the space–time volume for globally consistent paths [13,22] or particle filters [11,31]), and state-of-the-art trackers have used strong motion models and the explicit specification of entry/exit regions to push performance. Therefore, our work focuses on appearance without dictating how to exploit such additional cues, and can be seen as complementing recent work on tracking under occlusion [2,22] which solely relies on temporal information. As a result, this paper treats video as an unordered collection of frames without temporal information, using the same positional prior for each individual frame, though for evaluation the output of our model will be compared to that of complete multi-target trackers.

Our proposed method is related to tracking, image segmentation and object-recognition methods. The body of literature on these is extensive, and here we can only discuss a small set of papers which are most directly relevant.

Tracking-by-detection employs some method to detect target objects in video frames, and combine the detections into consistent tracks. For example, person detectors can be trained on HOG features [12], or by reasoning about spatial occupancy to explain background/foreground masks [5,13,21]. In terms of tracking, we can distinguish between on-line trackers that incorporate new observations on a frame-by-frame basis [11,15,21,31], and batch methods that perform global optimization for multiple frames at once [1–3,22,5,24,33].

Multi-view trackers observe targets simultaneously from various overlapping views, and are therefore more robust against occlusion in a single view. Using Probabilistic Occupancy Maps (POM) [13] for detection in calibrated views, [5] applies global appearance constraints to formulate a network flow optimization problem over all frames. This requires defining a priori appearance templates for distinct object classes, rather than learning the appearance of individuals from data. The on-line multi-view tracker of [21] relies on background subtraction and voxel carving to find candidate object locations in 3D. Using the Hungarian method [18], candidates are assigned to tracks or labeled as ‘ghosts’, i.e. faulty correspondences of foreground from different views, based on similarity scores for appearance, size, and Kalman filtered position. Back-projecting voxels to the images yields per-view object masks that take inter-object occlusion into account, which are used to learn the object appearances.

In the single view tracker of [24], appearances are first learned by clustering body part patches from a generic part-based person detector. The trained model is then used to track an individual and makes it possible to reason about self-occlusion. In [33] a part-model is used to deal with other types of occlusions, and fuses tracklets (i.e. trajectory fragments) into consistent tracks while learning a discriminative appearance model for each person. Another use of part-based models is to exploit the dynamics of parts to disambiguate tracks and recover after occlusion, e.g. [1] distinguishes multiple people seen in side-view from their articulated leg pose within a walking cycle.

Part-based models are not the only way to deal with occlusion. [2] adds occlusion reasoning to a continuous energy minimization framework [3] that globally optimizes detection-to-track associations under temporal constraints. In [22] this framework is extended to mixed discrete–continuous optimization for improved data association, with additional global constraints to consider track dynamics and exclude collisions, and keep overlapping tracks separated.

Others treat occlusions as temporary occurrences where no association can reliably be made. For instance, [15] weighs a large set of features to construct an affinity matrix between tracks and detections, and applies the Hungarian algorithm to find an optimal assignment. Ground truth annotations are required to optimize the weights for the various features using SVM and to handle entering/leaving correctly, and only short-term occlusions are dealt with by maintaining a history of features (occlusions of about a second can result in track termination). Likewise, [31] learns scene-specific feature weights from ground-truth with SVM too, but considerably extends the set of candidate regions with predictions from particle filters. Ref. [11] does not rely on annotations, but uses detector outputs as an object confidence map to weigh a particle filter, and learn discriminative target classifiers on-line. These methods thus focus on reducing the periods where objects are undetected, and/or rely on discriminative appearance models to improve track recovery after such gaps. However, occlusions must still be short and treated as a special case where the discriminative appearance model cannot be applied or updated.

Let us now look at topic models, which originate from the unsupervised analysis for text documents, and have been successfully applied to computer vision tasks by defining these in terms of ‘visual document’ and a codebook of ‘visual words’ [26,25,23,29,19,14,17]. Latent Dirichlet Allocation (LDA) [8] is a topic model that represents a document as an unordered bag-of-words, i.e. occurrence counts of each word, and then jointly infers topics as distributions over co-occurring words, and infers per document the mixture of topics within it. There are various techniques for approximate inference in such graphical models [7], e.g. [8] presents variational inference for LDA.

In the context of image segmentation, [25] uses LDA to discover object classes and their appearance in an image database, relying on an external image segmentation algorithm to provide relevant regions. Spatial LDA [28] discovers object classes too, but also segments each image by assigning each feature to one of many overlapping regions to enforce spatially consistent labeling. In the hierarchical model for object recognition by [26], LDA was adapted for unsupervised learning of part-models in a supervised object recognition task. Note that [25,26,28] focus on recognizing distinct object classes, not distinct instances within the same class. Topic models have also been used to discover common motion patterns exhibited by moving objects in video, though none of these methods perform any tracking. Refs. [30,14] avoid the need to track individuals in far-field surveillance. Regarding individual frames as documents, a visual codebook is created by quantizing optical flow in both location and direction, such that topics capture typical [30] (or rare [14]) co-occurring regions of motion. If an external tracker can provide tracks, one can also treat these as documents, and discover typical motion patterns that co-occur within a single track [29,17]. Ref. [34] takes an intermediate approach, finding scene wide patterns from given tracklets without merging them into complete tracks. These methods either quantize the track position and motion into visual words [14,29,34], or learn continuous distributions in the spatial domain [17]. LDA has also been used to compare person appearances in a multi-camera setup [23] from externally provided trajectories, and establish probable matches among non-overlapping viewpoints. In [19] LDA is adapted to discover behavior patterns in a multi-camera CCTV setup from quantized optical flow.

Our approach processes a collection of input frames simultaneously (i.e. in batch mode), and consists of a feature extraction step, a joint inference step, and optionally an image segmentation step. In the feature extraction step, we use the output of an external object detector to determine in all images the presence of the object class of interest (e.g. person) at a given set of (possible overlapping) candidate regions. We keep those detections for which the detector confidence is sufficiently large, though we use a low threshold to keep inaccurate detections too. In each detection we extract low-level appearance features. A feature is described by a visual word, obtained by feature quantization, and its spatial position. Our inference algorithm however will represent each detection by a bag-of-features, i.e. the word occurrence counts, and mean and variance of the spatial distribution of the features in the detection. In our experiments we regard each pixel in a detection as a feature, and use its binned color value as visual word, thus we record per detection only a color histogram. The spatial distribution is derived analytically from the detection bounding box.

Since detections can contain several (occluding) objects, we do not seek to associate whole detections to a unique target. Instead, the observed features in a detection are considered to be distributed as a mixture of objects. Each object thus has a specific appearance distribution over the feature words, and per image a spatial distribution over feature positions. Hence, we wish to learn a relatively low number of object appearances from a relatively high number of mixed detections with unknown mixture proportions. This “unmixing” task is analogous to LDA, where documents, described as a bag-of-words, are decomposed into a small set of topics, i.e. word distributions. However, our generative model additionally accounts for the fact that a target can only be supported in (at most) one spatial region within each frame. The model therefore has latent variables that represent each object’s appearance, and location per time step, and the mixture coefficients per detection. Joint approximate Bayesian inference yields posterior distributions over these latent variables, as illustrated in Fig. 2
                     . One can extract object tracks from this posterior (though we have not included any temporal constraints), as it describes for each time step which objects are present, and where.

As noted before, while the generative model is expressed in terms of individual features, described in Section 4, inference will exploit an efficient bag-of-features representation (similar to LDA), as discussed in Section 5. In the optional image segmentation step we can back-project the posterior distributions of the feature assignments to the original images to obtain object foreground masks, as will be discussed in Section 5.2.

One parameter that has to be set in advance is K, the upper limit of distinct objects that will be detected. Unlike traditional clustering methods, such as K-means and maximum likelihood estimates for mixture models, the variational inference scheme avoids overfitting even when K is set much larger than the true number of objects, due to the use of priors on the model parameters [7]. During the iterative learning processes, candidate objects that are redundant are assigned fewer times to observed features, which makes their appearance and spatial position less specific. This further reduces the probability of assigning such objects in future iterations, until they are not assigned at all anymore. In practice it is preferable to set K not too large either since complexity grows linearly with K, but one could test increasing values for K until the found object count stabilizes.

False positive detections (i.e. background identified as a target object) may affect our method, but in general the model copes with these by either (a) learning an appearance for the background region, regarding it as a mostly static object, or (b) identifies it as background if we include the option of a background distribution in our model (see Section 5.1). A target is not located in an image if it is fully occluded, has (temporarily) left the scene, or not yet entered, or if there are missing detections (i.e. false negatives). The presented generative model does not by itself distinguish or resolve such cases, but should (re-)identify the object in the other frames. A low detection threshold reduces the risk of false negatives. If the frame rate is high and targets move predictably, one could extrapolate an object’s motion, though we do not make such assumptions here as we focus on exploiting available detections instead. Further, the proposed method does not rely on accurate detections with non-maximum suppression, no calibrated cameras [21,33], nor knowledge of part-configurations [1,24,33], but uses only on an appropriate object detector to select regions of interest.

Our experiments will focus on keeping track of multiple persons against a static background, while in principle other object types could be dealt with too. Whereas part-based methods try to explicitly model the non-rigid nature of people, our bag-of-features representation drops any rigidity assumption. Because we can use a low detection confidence threshold, we found that a trained person detector based on HOG features [12] even yields usable detections when a person is partially occluded by another person or scenery.

The proposed adaptation of LDA has similarities to [26,28], but there the goal is to recognize various object classes in a set of images, which results distinct models and inference schemes. Ref. [26] performs supervised image classification by learning common parts and their spatial configurations per image class. Spatial LDA [28] performs unsupervised image segmentation by learning class appearances that account for consistently labeled pixel neighborhoods. It does not however constraint the occurrence of a single appearance at various places in the image, nor segment occluding instances of the same class, nor use an object detector to focus on a specific class as our method does. And, [28] jointly Gibbs samples the labels of individual features, which we avoid with the bag-of-features representation. Topic models have also been used for video analysis to discover typical objects motion patterns for a particular environment, e.g. without tracking using optical flow at the image level [30,34], or by analyzing tracks provided by an external tracker [29,34,17]. These applications did not address the track association problem itself, nor resolve partial occlusions.

In summary, the main contributions of this paper are:
                        
                           1.
                           A novel model to jointly localize and learn appearances of an unknown number of objects in a batch of images. We introduce an efficient Variational Bayesian inference algorithm with linear complexity w.r.t. frames, objects.

Address scenarios with inaccurate detections, and that contain erratically moving objects and/or have irregular or low frame rates (since objects are identified in the images without considering temporal information).

Introducing feature-to-object instead of detection-to-object correspondences to deal with partial occlusion.

Pixel-level segmentation of individual objects from object detectors and color histograms only.

We now specify the variables and full distribution of our generative model, which is depicted as a graphical model in Fig. 3
                     . There are T time steps with 
                        
                           
                              
                                 D
                              
                              
                                 t
                              
                           
                        
                      detections at time t obtained from the external object detector, and detection 
                        
                           (
                           j
                           ,
                           t
                           )
                        
                      at window (i.e. image region) j contains 
                        
                           
                              
                                 N
                              
                              
                                 j
                              
                              
                                 t
                              
                           
                        
                      features. The tuple 
                        
                           (
                           j
                           ,
                           t
                           ,
                           i
                           )
                        
                      identifies the i-th feature in 
                        
                           (
                           j
                           ,
                           t
                           )
                        
                     , which has two observed properties: a discrete visual word, which we represent as an integer 
                        
                           
                              
                                 y
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                           ∈
                           [
                           1
                           ,
                           V
                           ]
                        
                     , and a (2D) position 
                        
                           
                              
                                 x
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                        
                      in the image plane. We define the word occurrence count of word v in detection window 
                        
                           (
                           j
                           ,
                           t
                           )
                        
                      as 
                        
                           
                              
                                 N
                              
                              
                                 jv
                              
                              
                                 t
                              
                           
                           =
                           
                              
                                 ∑
                              
                              
                                 i
                              
                           
                           δ
                           (
                           
                              
                                 y
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                           ,
                           v
                           )
                        
                     , with 
                        
                           δ
                           (
                           a
                           ,
                           b
                           )
                           =
                           1
                        
                      iff 
                        
                           a
                           =
                           b
                        
                      and 0 otherwise. For instance, when quantized pixel colors are used as words, then the vector 
                        
                           
                              
                                 N
                              
                              
                                 j
                                 ·
                              
                              
                                 t
                              
                           
                           =
                           [
                           
                              
                                 N
                              
                              
                                 j
                                 1
                              
                              
                                 t
                              
                           
                           ⋯
                           
                              
                                 N
                              
                              
                                 jV
                              
                              
                                 t
                              
                           
                           ]
                        
                      is the color histogram of 
                        
                           (
                           j
                           ,
                           t
                           )
                        
                     , where 
                        
                           V
                           =
                           
                              
                                 c
                              
                              
                                 3
                              
                           
                        
                      if each color channel is discretized in c bins.

We assume that the feature is generated by one out of K objects, indicated by the latent variable 
                        
                           
                              
                                 z
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                           ∈
                           [
                           1
                           ,
                           K
                           ]
                        
                     . Since each detection contains a mixture of objects, the 
                        
                           
                              
                                 z
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                        
                      in a detection 
                        
                           (
                           j
                           ,
                           t
                           )
                        
                      follow a multinomial
                        1
                        For clarity later on we use the multinomial distributions as a generalization of the categorical distribution, for instance 
                              
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                              
                            can be represented equivalently as a one-of-K vector.
                     
                     
                        1
                      distribution with parameter vector 
                        
                           
                              
                                 θ
                              
                              
                                 j
                              
                              
                                 t
                              
                           
                        
                     , e.g. element 
                        
                           
                              
                                 θ
                              
                              
                                 j
                                 (
                                 k
                                 )
                              
                              
                                 t
                              
                           
                        
                      is the mixture weight of object k in 
                        
                           (
                           j
                           ,
                           t
                           )
                        
                     . Each of the K objects defines a multinomial appearance distribution 
                        
                           
                              
                                 β
                              
                              
                                 k
                              
                           
                        
                      over the V visual words, which is shared by detections in all time steps, and each object has per time step a multivariate Gaussian distribution with mean 
                        
                           
                              
                                 μ
                              
                              
                                 k
                              
                              
                                 t
                              
                           
                        
                      and precision matrix 
                        
                           
                              
                                 Λ
                              
                              
                                 k
                              
                              
                                 t
                              
                           
                        
                      over the image positions of features. The full distribution is thus factorized into the following terms:
                        
                           (1)
                           
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    z
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              ,
                              {
                              
                                 
                                    μ
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    Λ
                                 
                                 
                                    k
                                 
                              
                              }
                              )
                              =
                              N
                              (
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              
                              |
                              
                              
                                 
                                    μ
                                 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          ji
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    (
                                    
                                       
                                          Λ
                                       
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                       
                                       
                                          t
                                       
                                    
                                    )
                                 
                                 
                                    -
                                    1
                                 
                              
                              )
                           
                        
                     
                     
                        
                           (2)
                           
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    z
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              ,
                              {
                              
                                 
                                    β
                                 
                                 
                                    k
                                 
                              
                              }
                              )
                              =
                              Mult
                              (
                              
                                 
                                    y
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              
                              |
                              
                              
                                 
                                    β
                                 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          ji
                                       
                                       
                                          t
                                       
                                    
                                 
                              
                              )
                           
                        
                     
                     
                        
                           (3)
                           
                              p
                              (
                              
                                 
                                    z
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              )
                              =
                              Mult
                              (
                              
                                 
                                    z
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              
                              |
                              
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              )
                              .
                           
                        
                     We place conjugate priors on the latent variables,
                        
                           (4)
                           
                              p
                              (
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    α
                                 
                                 
                                    0
                                 
                              
                              )
                              =
                              Dir
                              (
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              
                              |
                              
                              
                                 
                                    α
                                 
                                 
                                    0
                                 
                              
                              )
                           
                        
                     
                     
                        
                           (5)
                           
                              p
                              (
                              
                                 
                                    β
                                 
                                 
                                    k
                                 
                              
                              |
                              
                                 
                                    η
                                 
                                 
                                    0
                                 
                              
                              )
                              =
                              Dir
                              (
                              
                                 
                                    β
                                 
                                 
                                    k
                                 
                              
                              
                              |
                              
                              
                                 
                                    η
                                 
                                 
                                    0
                                 
                              
                              )
                           
                        
                     
                     
                        
                           (6)
                           
                              p
                              (
                              
                                 
                                    Λ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    W
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              )
                              =
                              W
                              (
                              
                                 
                                    Λ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              
                              |
                              
                              
                                 
                                    W
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              )
                           
                        
                     
                     
                        
                           (7)
                           
                              p
                              (
                              
                                 
                                    μ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    m
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    Λ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    0
                                 
                              
                              )
                              =
                              N
                              
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       
                                       |
                                       
                                       
                                          
                                             m
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             (
                                             
                                                
                                                   λ
                                                
                                                
                                                   0
                                                
                                             
                                             
                                                
                                                   Λ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                          
                                          
                                             -
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                     where Dir and 
                        
                           W
                        
                      represent the (symmetric) Dirichlet and Wishart distribution respectively. Details of the used distribution can be found in Appendix A.

Inference on the latent variables is performed on all detections of all time steps jointly. Since exact inference is intractable, we resort to Variational Bayesian (VB) inference to find good approximate solutions. In VB, one approximates the target distribution p by a simpler distribution q, typically by assuming independence between various (latent) variables in p. Inference then proceeds by minimizing the Kullback–Leibler (KL) divergence 
                        
                           KL
                           (
                           q
                           |
                           |
                           p
                           )
                        
                     , see [7].

Unfortunately, inferring a variational distribution for each latent assignment label 
                        
                           
                              
                                 z
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                        
                      is computationally demanding. In VB for standard LDA this problem is mitigated by noting that per document all observations of the same word v are exchangeable. Instead of reasoning about individual indicators z, a multinomial distribution over the number of words v assigned to object k in a document can be used, which leads to a more efficient variational inference scheme [8]. In our model, however, features with the same visual word in a detection are not exchangeable, since features do not share the same position 
                        
                           
                              
                                 x
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                        
                     . We therefore remove the correspondence between positions 
                        
                           
                              
                                 x
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                        
                      and words 
                        
                           
                              
                                 y
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                        
                     , and instead model the 
                        
                           
                              
                                 x
                              
                              
                                 ji
                              
                              
                                 t
                              
                           
                        
                      in the detection window as i.i.d. normally distributed random variables. More precisely, if window j has center 
                        
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 j
                              
                           
                        
                     , width w and height h, then we analytically derive (see Appendix B for details)
                        
                           (8)
                           
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              
                              ∼
                              N
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   Σ
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                              
                              
                              with
                              
                              
                                 
                                    
                                       
                                          Σ
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      2
                                                   
                                                
                                                /
                                                12
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      2
                                                   
                                                
                                                /
                                                12
                                             
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     We can now avoid inferring the assignment of individual features in the variational approximation, and use instead the multinomial distribution per detection over the number of features assigned to each of the K candidate objects, as is the case with VB for standard LDA.

In Appendix C we present detailed derivations of the variational distribution, and all update equations. We group the update equations into the three parts, which must be executed iteratively since updates are coupled:
                        
                           •
                           the updates for the object priors and appearances, which are similar to those for standard LDA [8,4].

the updates for the spatial distributions, which follow the VB updates for standard MoG (see [7], Chapter 10).

the assignment updates which, as expected, are a combination of the assignment updates found in LDA [8] and MoG [7], but where special care has to be taken to include the uncertainty of a feature’s position 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ji
                                       
                                       
                                          t
                                       
                                    
                                 
                              .

To initialize inference, we sample the parameters of the variational distributions on all feature-to-object assignment counts uniformly, and normalize the distribution for each detection (see Appendix C.6). Effectively, all observations are initially assigned almost uniformly to all K candidate objects, and therefore all objects have almost the same spatial distribution in each image, and similar appearances. At subsequent iterations however, the small random variations in the appearance and spatial distributions becoming increasingly distinctive. As more features are assigned to certain objects, the uncertainty on their appearance and spatial distributions decreases, while the distributions of objects with few features reduce to the prior which avoids overfitting. Fig. 4
                      illustrates the procedure at different iterations, showing for two frames in a sequence how the spatial and assignment distributions change, until eventually all features are assigned to only four candidate objects.

Direct application of the variational update equations can unfortunately get stuck in a suboptimal solution. Initially when appearances distributions are not yet representative of the true objects appearances, we observe that the positional likelihood tends to outweigh the appearance likelihood, forcing inferred objects to quickly cluster detections spatially without discovering meaningful and distinct appearances. To guide inference through this parameter space with many local optima, the variational updates initially only include the spatial distribution at every fifth iteration, until the appearance distributions converge. We found that this provides good initial distributions for the final variational updates, which include every term at each iteration, and are again performed until convergence.

The complexity of the variational inference updates is 
                        
                           O
                           (
                           T
                           ×
                           D
                           ×
                           K
                           ×
                           V
                           )
                        
                     , where 
                        
                           T
                           ×
                           D
                        
                      is the total number of detections. Computationally, the appearance and prior updates are mostly sums and multiplications that are fast to execute. Updating the spatial locations is the most costly operation, though these could be run in parallel for objects and time steps. Assignment updates can also benefit from parallelization.

The features within a detection may stem from one or more objects, but could also come from the background (or occluding foreground) of the scene. In our experience, when the background is sufficiently uniform this tends not to be a problem, especially when the detections are accurate and therefore contain many object features and few background features. In those cases, all object appearances include some low probability of observing the background features. But when the detections contain a lot of background, and/or the background varies across the image, the model will infer additional objects associated with the background features, resulting in many false positives. For this reason, and with the upcoming image segmentation step of Section 5.2 in mind, we wish to exploit background information in our model to segment fore- and background.

For each detector window location we create a background object, such that each detection 
                           
                              (
                              j
                              ,
                              t
                              )
                           
                         can be a mixture of 
                           
                              K
                              +
                              1
                           
                         possible object models: the K objects plus the background of window j. Background object j then has appearance distribution 
                           
                              
                                 
                                    
                                       
                                          β
                                       
                                       
                                          ̇
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                           
                        , and we fix its spatial distribution to 
                           
                              N
                              (
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          Σ
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              )
                           
                         as in Eq. (8). This means that background objects are not treated differently from the K target objects, except that we do not update their location (the most computationally expensive part of our method), and that instead of prior 
                           
                              
                                 
                                    η
                                 
                                 
                                    0
                                 
                              
                           
                         we use window specific background prior 
                           
                              
                                 
                                    
                                       
                                          η
                                       
                                       
                                          ̇
                                       
                                    
                                 
                                 
                                    0
                                    j
                                 
                              
                           
                        . In our experiments we obtain 
                           
                              
                                 
                                    
                                       
                                          η
                                       
                                       
                                          ̇
                                       
                                    
                                 
                                 
                                    0
                                    j
                                 
                              
                           
                         by taking the input images, removing the features in the windows that will be kept as detections (i.e. erase object appearances), and count the remaining features within each window j over all images. Standard background subtraction, performed as pre-processing step, evaluates only once the observation likelihood under a background distribution, and may discard actual foreground with appearance similar to the background. Our approach (re)evaluates the feature likelihood for both background and all object appearances during inference, and background segmentation is a result of inferring the assignment labels. One may come up with different background models for different scenarios. For instance, if the background has little variation a single background appearance shared by all windows might be used. Or, if reliable foreground masks are in fact available, those could be used to remove background features and no background model would be necessary.

A benefit of using a generative appearance model instead of a discriminative one (e.g. [11]) is that the model can be utilized for image segmentation. After the variational distributions converged, the distributions 
                           
                              q
                              (
                              
                                 
                                    z
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              =
                              k
                              |
                              ·
                              )
                           
                         express the probability that a word 
                           
                              
                                 
                                    y
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                           
                         in detection 
                           
                              (
                              j
                              ,
                              t
                              )
                           
                         belongs to object k. In a post-processing step we can then compute the object appearance responses in the original input image frames by back-projecting. The object probabilities from overlapping detections are averaged per pixel, and pixels that are not in any detection window are fixed to background. Subsequently, we use the object responses as input for standard multi-label image segmentation software.
                           2
                           
                              http://vision.csd.uwo.ca/code/.
                        
                        
                           2
                         We use energy minimization [10,9,16] to determine per pixel the optimal object label, taking into account both object responses and labeling consistency between neighboring pixels. The energy minimization problem formulation makes assumptions complementary to the bag-of-features representation in our model, which does not enforce consistent neighborhood labeling. While that enables very fast variational updates, it also results in more noisy assignments of features to objects. Since the human visual system is very sensitive to edges, approximate global optimization of neighborhood consistency on the complete frame obtains visually more pleasing results.

@&#EXPERIMENTS@&#

After explaining the used evaluation metric in Section 6.1, we present results on two types of datasets. Section 6.2 discusses experiments using inaccurate detections on challenging sequences containing several people fighting. In Section 6.3 we additionally show how our method is competitive with different state-of-the-art methods on publicly available data where motion models play a major beneficial role. These experiments also show how the quality of the detections affect the tracking results. We make both our software and our new dataset publicly available for non-commercial, benchmarking purposes.

For quantitative evaluation we use common metrics for evaluating multi-target tracking performance, namely the Mostly Tracked (MT) and Mostly Lost (ML) measures from [20] (similar to [22]), and the CLEAR MOT metrics [6]: Identity switches (IDS), False Positive ratio (FP) and False Negative ratio (FN), the Multiple Object Tracking Accuracy (MOTA) and the Multiple Object Tracking Precision (MOTP). The statistics are computed by comparing object bounding boxes to ground truth bounding boxes, and we keep correspondences as long as the boxes intersect. To obtain bounding boxes from our model’s output, we use the estimated object locations given by the Gaussian 
                           
                              N
                              (
                              
                                 
                                    μ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    (
                                    
                                       
                                          Λ
                                       
                                       
                                          k
                                       
                                       
                                          t
                                       
                                    
                                    )
                                 
                                 
                                    -
                                    1
                                 
                              
                              )
                           
                        . A bounding box rectangle is created with its center at the Gaussian’s mean position, and the width and height of the box are estimated from the covariance matrix with the same formula as in Eq. (8).

The complete set of measures and statistics are as follows:
                           
                              •
                              
                                 MT: the percentage of ground truth tracks which are matched to a tracker for more than 80% in length.


                                 ML: the percentage of ground truth tracks which are matched to a tracker for less than 20% in length.


                                 IDS: the number of ID switches, which counts the number of times a ground truth object is matched to a different track than that of the previous time instance.


                                 FP: the false positives ratio in percentage, the number of false positives divided by the number of ground truth objects.


                                 FN: the false negative ratio in percentage, the number of false negative divided by the number of ground truth objects.


                                 MOTA: an accuracy score in percentage, based on the false positives, false negatives and identity switches relative to the total number of matches.


                                 MOTP: a precision score in percentage, that measures the average overlap between ground truth and matched tracker results. In our case, we measure overlap of bounding boxes in the 2D image plane.


                                 GT: the number of ground truth tracks.

We evaluate our method both quantitatively and qualitatively on a new dataset with three challenging sequences, and compare to the tracker output obtained from the on-line multi-view tracker [21], that tracks people in 3D using multiple overlapping camera viewpoints, and from the state-of-the-art global energy minimization tracker with exclusion constraints [22].
                           3
                           Code was made available by the authors of [22] at https://bitbucket.org/amilan/dctracking.
                        
                        
                           3
                         Each sequence consists of 
                           
                              T
                              =
                              300
                           
                         frames at 20fps with a resolution of 752×560pixels, and was simultaneously recorded from three overlapping and calibrated wide-angle viewpoints. Unlike other available tracking benchmarks with people walking normally, individuals exhibit a lot of rapid motion changes and uncommon poses (e.g. kicking, punching, falling), and many long term inter-person occlusions and interactions occur (see also Figs. 1 and 4).

Baseline method [21] relies on voxel carving with segmented background in all three views to generate volumetric detections in 3D. It uses the Hungarian algorithm [18] to on-line assign detections to tracks, or label them as ‘ghosts’. For data association it uses appearance features similar to our method (color histograms), and separates appearances of inter-occluding objects by back-projecting the voxels to the images. Unlike our method, it incorporates a motion model for temporal consistency, and as it benefits from more extensive sensory data, it does not suffer from single-view occlusions. The method by [22] uses the same single view person detections as our method, and also processes all frames in a single batch. The tracker combines discrete optimization to associate detections to candidate tracks, and continuous optimization to fit tracks as splines to detections in the space–time cube, focusing on temporal consistency rather than appearance.

We manually annotated ground truth tracks with bounding boxes in a single view every 5 frames. The boxes completely contain a person (thus due to the unusual poses in the data, the aspect ratios of the boxes vary considerably), and we also annotated people when they are almost completely occluded in the available view, to the best of our capabilities. For our method and [22], we obtained object detections from a HOG person detector [12] of fixed size (200×100pixels) on a fixed grid (at steps of 20pixels), applied across each frame with a low threshold (0.2) to reduce false negatives. Detections are not well tuned to the particular size of observed targets, and a target can span several detections, i.e. detections are inaccurate. We performed non-maxmimum suppression for [22], as we found that improved the results, but not for our method (i.e. we used all detections that passed the threshold). For the quantitative comparison the 3D voxel output of [21] is projected to the same view to create track bounding boxes.

We quantized the Hue-Saturation-Value (HSV) colorspace into 6 bins per color channel (
                              
                                 V
                                 =
                                 
                                    
                                       6
                                    
                                    
                                       3
                                    
                                 
                                 =
                                 216
                              
                           ). The parameter vector of the object prior, 
                              
                                 
                                    
                                       α
                                    
                                    
                                       0
                                    
                                 
                              
                           , is a 
                              
                                 K
                              
                           -dimensional vector, with all elements k set to 
                              
                                 
                                    
                                       α
                                    
                                    
                                       0
                                       (
                                       k
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       10
                                    
                                    
                                       -
                                       5
                                    
                                 
                                 /
                                 K
                              
                           . The word prior, 
                              
                                 
                                    
                                       η
                                    
                                    
                                       0
                                    
                                 
                              
                           , is a 
                              
                                 V
                              
                           -dimensional vector, with all elements v set to 
                              
                                 
                                    
                                       η
                                    
                                    
                                       0
                                       (
                                       v
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       10
                                    
                                    
                                       6
                                    
                                 
                                 /
                                 V
                              
                           . We set a weak spatial prior, 
                              
                                 
                                    
                                       ν
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 2
                              
                           , with low precision and which prefers a 2:1 height to width ratio, 
                              
                                 
                                    
                                       W
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       10
                                    
                                    
                                       -
                                       4
                                    
                                 
                                 ×
                                 
                                    
                                       
                                          
                                             
                                                
                                                   2
                                                
                                                
                                                   0
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           . Further, 
                              
                                 
                                    
                                       λ
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       10
                                    
                                    
                                       -
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       μ
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             I
                                          
                                          
                                             w
                                          
                                       
                                       /
                                       2
                                       ,
                                       
                                          
                                             I
                                          
                                          
                                             h
                                          
                                       
                                       /
                                       2
                                       ]
                                    
                                    
                                       ⊤
                                    
                                 
                              
                            where 
                              
                                 [
                                 
                                    
                                       I
                                    
                                    
                                       w
                                    
                                 
                                 ,
                                 
                                    
                                       I
                                    
                                    
                                       h
                                    
                                 
                                 ]
                              
                            are the image dimensions in pixels. Inference was run for 700 iterations, using 
                              
                                 K
                                 =
                                 10
                              
                            objects. After these iterations, we keep the object locations at time instances for which the expected number of assigned features exceeds 2500.

@&#RESULTS@&#

Qualitative results of both methods are shown in Fig. 5
                           , which illustrates that our method actually yields better foreground segmentation than [21] despite using only one camera.
                              4
                              Associated video clips can be found on the websites of the authors.
                           
                           
                              4
                            The method of [22] does not perform image segmentation, but it should be noted that tracked bounding boxes exhibit smooth motion, though tracks are highly fragmented. As shown in Table 1
                           , our method outperforms the baselines on the most important measures in terms of correct identification of the objects, namely the MT, ML, IDS and MOTA scores. In contrast, the methods of [21,22] tend to segment tracks into many small ones, leading to a lot of identity changes, or fail to correctly recuperate tracks, leading to low Mostly Tracked scores. The higher MOTP scores of [21] are due to the very accurate estimates of target size that voxel carving in the multi-view calibrated-camera setup allow. We now discuss the various sequences in more detail.

In this scene, a person intervenes between two aggressive men, and keeps them apart to deescalate the situation. As seen in Table 1, our method consistently identifies and localizes the three individuals. Our method outperforms the baselines on all measures except the MOTP score. Ref. [21] benefits from accurately sized bounding boxes from voxel carving, but performs more poorly on this sequence with regard to the other measures. First, due to the multiple persons, their proximity, and the dynamic background, there is a large number of ‘ghosts’ in each frame. As a result, that method tends to initialize multiple tracks on a single person, or incorrectly assumes that an actual person is a ghost. The temporal model does not help much in making a correct distinction because of the erratic motion of the people. Second, since the appearance model of each track is updated after back-projecting the voxels, incorrect identification of ‘ghosts’ leads to inaccurate appearance models, which hurts tracking in subsequent frames even more.

The temporal smoothing in [22] also results in multiple track fragments and identity switches, though also a reasonable MOTP score, since the spline fitting prefers smooth paths over sudden motion changes. There is a large number of false negatives however, since targets remain close together for prolonged time and the tracker outputs at most frames only two tracks.

Our method, on the other hand, does not have to deal with incorrect correspondences between multiple viewpoints as [21], and can successfully ‘unmix’ all three objects in only a single view, even during occlusion. Compared to the other batch method [22], we benefit from appearance cues to keep people apart, while the poor appearance models learned by [21] induce more identity switches as tracks are often lost and replaced.

This is a fighting sequence containing four people, with a real-world artifact that is usually excluded from experiments: during recording, 13 frames were dropped by the recording equipment, resulting in a abrupt change in the sequence. Because we do not rely on temporal information, our method has no problem with inconsistent intervals, and thus again correctly identifies all people. The tracker of [21], on the other hand, misses one person after the unexpected gap because it violates its motion model’s assumptions in 3D space. This track is not recovered because the detections in the center of the scene, a low-probability area for creating new tracks, are typically considered ‘ghosts‘. The batch tracker [22] creates again many fragmented tracks, but also has moments where there are too few detections due to non-maximum suppression. Without the non-maximum suppression however, we found it would create many more short spurious tracks.

In this third fight sequence people punch each other, fall down, get up, kick and jump. Still, [21] and our method are capable of tracking all four persons most of the time. However, on-line tracker [21] does lose people several times, and initializes extra tracks as people change motion very quickly, re-enter the scene, or are divided into multiple detections in the voxel space due to wide spread arms and legs. This problem is even worse for [22], which cannot rely on the multiple viewpoints accessible to [21]. For our method such motion changes, scene re-entering, or multiple detections per person do not pose a problem. In fact, due to the low detector threshold even a person performing a flying kick (i.e. kick performed in mid-air) is detected and correctly identified, as can be seen in Fig. 5(e). The slightly higher FN rate is due to the heavy occlusion in the used viewpoint.

The publicly available TUD-campus dataset consists of 
                           
                              T
                              =
                              71
                           
                         frames, showing several persons seen from the side walking in straight lines from left to right, or right to left, across the scene. Due to the low viewpoint and many people occurring simultaneously in the scene, partial and full occlusions occur regularly. Unlike the fighting sequences used in Section 6.2, this sequence is much shorter, contains common poses (all observed poses are from gait cycles with little to no articulation except for legs), and predictable motion patterns (fixed speed without curvature). In fact, using a person detector at various scales and a fine spatial grid, and after non-maxima suppression, quite accurate detections can be obtained for this sequence, such as those made available by the TU-Darmstadt.
                           5
                           Detections and groundtruth for TUD-campus can be found at http://www.gris.informatik.tu-darmstadt.de/aandriye/data.html.
                        
                        
                           5
                        
                     

While this sequence is not representative of the problems our method addresses, we will demonstrate that the method in principle also handles cases that are well suited for traditional trackers. Results will be compared to those of to the state-of-the-art trackers of [11,31]. The compared trackers use an extended set of detection regions obtained from particle filters [31], temporal models [11,31], more extensive features [11,31], and training association weights on ground truth annotations [31].

Since our method solely focuses on identifying targets and their appearances without committing to any particular way of modeling temporal consistency, we consider four types of results for our method to relate it to the these trackers:
                              
                                 •
                                 
                                    full-gt, using the publicly available objects detections as input. The 
                                       
                                          T
                                          ×
                                          D
                                          =
                                          220
                                       
                                     detections are of varying sizes and obtained with non-maxima suppression, such that detections correspond well to various targets. However, only detections with high confidence have been provided, and this translates to many false negatives, i.e. ground truth bounding boxes that do not overlap with any detection. Since our proposed method does not add missing detections, we expect to miss ground truth objects.


                                    clean-gt, using the same publicly available objects detections as input, but removing ground truth without any detector overlap. This gives a better indication of how our method copes with the available detections.


                                    weak-detec-full-gt, using an object detector of fixed size with low threshold, and no non-maxima suppression. These detections are inaccurate, and detections are not well tuned to the particular size of observed targets. Similar to the experiments of Section 6.2, we applied a HOG person detector [12] of fixed size and a 1:2 width-height ratio on a fixed grid across each frame, and set a low threshold of 0.2 on the confidence threshold to accept detections, though we have not spent time optimizing this threshold for best performance.


                                    weak-detec-clean-gt, uses the same detections as in weak-detec-full-gt, but ground truth without any overlapping detection has been removed, as was done in clean-gt.

For evaluation we compare the bounding boxes to the bounding boxes of the ground truth annotations made available by the TU-Darmstadt. For clean-gt, 25 of 303 (8.25%) ground truth annotations were removed because of missing detections, for weak-detec-clean-gt this resulted in removing 17 of 303 (5.61%) annotations. We set 
                              
                                 K
                                 =
                                 15
                              
                           , and quantize the HSV colorspace in 8 bins per channel (
                              
                                 V
                                 =
                                 512
                              
                           ).

@&#RESULTS@&#

Quantitative results of our method are shown in Table 2
                           , together with the published results of [11,31].

Comparing the statistics computed for clean-gt and full-gt, we see that missing detections in the detector output strongly affects, as expected, the Mostly Tracked (MT), False Negative (FN) and thus MOTA score. By just considering ground truth that does contains detections (i.e. clean-gt), we can see that our method can compare to state-of-the-art trackers, even though we rely only on simple color features and did not include temporal information. Yan [31] does report better FP and FN, and as a result a higher MOTA score. Indeed, this sequence is well suited to their constant velocity motion model, which via particle filtering also yields good additional detections, and also relies on more features. But we also observe that our method’s scores are lower because the method identifies the tight group of three people in the background as a single object, since the people’s appearances occur consistently together. In the ground truth annotations, however, these persons are labeled individually, but even there not all three are fully annotated throughout the sequence due to the strong occlusion. This highlights a common difficulty with creating annotations and the choice of deciding which and when people should be included in the ground truth.

In case of weak-detec-full-gt, we see that even with the inaccurate detections we obtain good results, and weak-detec-clean-gt yields even a better MOTA score than full-gt due to less false negatives, although the MOTP score is relatively low. This is mainly due to the fact that the ground truth bounding boxes of the more distant people are much smaller than the detection windows we used. Since the precision matrix of the localized objects depends on the precision (i.e. inverse covariance) matrix of the detection windows, the bounding boxes are at least as large as the used detection window size. Therefore, the overlap with people much smaller than the detection window size is generally low, as expressed by the MOTP score.

@&#IMPLEMENTATION@&#

Our single core Matlab implementation ran on a 2.67Ghz 64-bit CPU. It takes for instance 
                           
                              ±
                              232
                              
                              s
                           
                         for 700 iterations on Trainstation A with inaccurate detections (
                           
                              T
                              =
                              300
                              ,
                              K
                              =
                              10
                              ,
                              V
                              =
                              216
                              ,
                              T
                              ×
                              D
                              =
                              3513
                           
                        ). Inference on the TUD sequence with 
                           
                              T
                              ×
                              D
                              =
                              220
                           
                         good detections (
                           
                              T
                              =
                              71
                              ,
                              K
                              =
                              15
                              ,
                              V
                              =
                              512
                           
                        ) takes 
                           
                              ±
                              64
                              
                              s
                           
                         for 900 iterations. Runtimes could be improved by performing variational updates in parallel over object, detections and time steps, and porting code to C/C++.

@&#DISCUSSION@&#

In this paper we have cast the related problems of discovering the number of objects, detection to object association, occlusion handling, appearance modeling, and foreground and background segmentation, as an inference problem in a single graphical model. This formulation allows us to benefit from advancements in the actively researched area of Bayesian inference in graphical models, and provides a unified framework to deal with ambiguities and missing data. Traditional trackers take an ad hoc approach to deal with these types of problems, relying on thresholds and staged filters instead. For example, an initial background subtraction stage will make a hard binary decision at the pixel level, but is not informed by the learned foreground color distributions used in a later stage.

However, our method does not stand in direct competition with these traditional trackers, as different assumptions are made about accuracy of detections, occlusions, and pedestrian movement. Future research will investigate various ways to combine the strength of our method, which has focused on identifying objects using their appearance only, with state-of-the-art trackers and the complementary information that they exploit.

First, we currently rely on a K-dimensional symmetric Dirichlet prior, which bounds the number of possible targets. To remove this limit, one could run the procedure for increasing K until the object count converges. Alternatively, the model could be reformulated as a Dirichlet Process (DP) mixture model (our Dirichlet prior can be seen as a fixed-size approximation of the infinite DP prior [27]) to adapt K during a single inference run.

Second, there is currently no temporal relation between the frames, but appearance alone may not be sufficient to resolve certain ambiguities that are easily resolved when considering temporal constraints. How temporal information can best be included in our model is an open research question, and many possible directions can be found in the literature (e.g. Kalman filter positions, augmenting detections with predictions, merging tracklets in post-processing). On the other hand, we have seen that motion models are designed to deal with typical common movements, but that sudden changes in direction, occlusions, and people taking different poses can lead to spurious track creation and deletion. Not relying on time may also benefit other applications, such as when images are taken at long intervals and motion models are essentially useless (e.g. surveillance cameras recording images every few seconds), or when analyzing multiple frames from different viewpoints.

Another option is to combine our method with existing trackers that already account for temporal consistency. For instance, the appearance unmixing paradigm may be useful to resolve the partial occlusions that are skipped by the tracker, or deal with dropped frames in the video. Indeed, our experiments on the TUD dataset show that our method is compatible with and benefits from having accurate object locations, which a traditional tracker may provide, but can also deal with the degenerate cases with occlusions in inaccurate detections.

Furthermore, we modeled appearance as a single latent distribution over binned color values. Adding dynamics to the appearance distribution may improve performance under changing lighting conditions. Other types of features could also be envisioned, e.g. by coupling color information to body regions to distinguish for instance black trousers from a black shirt. Another source of information is the detector confidence, which is currently not exploited (low confidence detections could also result from, say, an unusual pose). It may not even be necessary to use an object detector at all, but just use all detection windows and trust that the background appearance model deals with the false positives. From this point of view, the object detector is just a convenient way to focus computational resources on areas of interest, but at the risk of introducing false negatives.

@&#CONCLUSION@&#

We have described a novel method for identifying multiple objects in a collection of images, which relaxes the one-to-one correspondence between an object’s detection in an image and the object’s identity. Data association and the related problems of discovering the number of objects, appearance modeling, occlusion handling, and foreground and background segmentation, are treated in a principled way as a joint inference problem in a single graphical model.

Experiments on challenging video sequences of people fighting, and a public benchmark with detections of varying quality, show that the proposed method is particularly effective when the object detection itself is challenging or when temporal modeling is difficult. Such conditions are common in real-life situations, and occur due to occlusion, to fast and irregular motion of the targets, to perspective distortion, to unexpected poses of individuals, or to irregular time intervals between frames in the recording (i.e. frame drops). On sequences with inaccurate detections we show substantially improved identification results in terms of tracked and lost identities, and of identity switches, compared to both global batch-mode and on-line multi-view state-of-the-art trackers, despite the lack of a temporal model.

Future work will extend the method with temporal motion constraints, with dynamics for the appearance model, removing the prior target upper-limit K, and by support for multiple object classes.

In this section we provide a more detailed description of the distribution of our model before we describe inference in Appendix C.

The likelihood of an observed location 
                           
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                           
                         is
                           
                              (A.1)
                              
                                 p
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 {
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 }
                                 )
                                 =
                                 N
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          
                                             
                                                μ
                                             
                                             
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      ji
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                (
                                                
                                                   
                                                      Λ
                                                   
                                                   
                                                      
                                                         
                                                            z
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                )
                                             
                                             
                                                -
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        This means that the likelihood of all observed locations 
                           
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              =
                              {
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              }
                           
                         in detection 
                           
                              (
                              j
                              ,
                              t
                              )
                           
                         is
                           
                              (A.2)
                              
                                 p
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 {
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 }
                                 )
                              
                           
                        
                        
                           
                              (A.3)
                              
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                       
                                    
                                 
                                 N
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          
                                             
                                                μ
                                             
                                             
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      ji
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                (
                                                
                                                   
                                                      Λ
                                                   
                                                   
                                                      
                                                         
                                                            z
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                )
                                             
                                             
                                                -
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (A.4)
                              
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                       
                                    
                                 
                                 N
                                 
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       |
                                       
                                          
                                             μ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             (
                                             
                                                
                                                   Λ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                          
                                          
                                             -
                                             1
                                          
                                       
                                       )
                                    
                                    
                                       δ
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       k
                                       )
                                    
                                 
                              
                           
                        
                     

However, we have uncertainty about the true locations 
                           
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                           
                         and instead assumed that these are distributed according to Eq. (8) as 
                           
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              ∼
                              N
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   Σ
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                              
                           
                        . Therefore,
                           
                              (A.5)
                              
                                 E
                                 
                                    
                                       
                                          p
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                j
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          
                                             
                                                z
                                             
                                             
                                                j
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          {
                                          
                                             
                                                μ
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                Λ
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          }
                                          )
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (A.6)
                              
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                       
                                    
                                 
                                 N
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       |
                                       
                                          
                                             μ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             (
                                             
                                                
                                                   Λ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                          
                                          
                                             -
                                             1
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   Σ
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       )
                                    
                                    
                                       δ
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       k
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (A.7)
                              
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 N
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         ∼
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             |
                                             
                                                
                                                   μ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   (
                                                   
                                                      
                                                         Λ
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                
                                                   -
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         Σ
                                                      
                                                      
                                                         ∼
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                          
                                       
                                       δ
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       k
                                       )
                                    
                                 
                              
                           
                        So because of this assumption, we can forget about the exact locations 
                           
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                           
                         and instead take the detection window location 
                           
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                           
                        . But during inference, which will be discussed in Appendix C, we will need to account for the added uncertainty.

The likelihood of observing words 
                           
                              
                                 
                                    y
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              =
                              {
                              
                                 
                                    y
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              }
                           
                         in detection 
                           
                              (
                              j
                              ,
                              t
                              )
                           
                         is expressed as
                           
                              (A.8)
                              
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 {
                                 
                                    
                                       β
                                    
                                    
                                       k
                                    
                                 
                                 }
                                 )
                                 =
                                 Mult
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       β
                                    
                                    
                                       
                                          
                                             z
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (A.9)
                              
                                 
                                 
                                 
                                 
                                 
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             β
                                          
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   ji
                                                
                                                
                                                   t
                                                
                                             
                                             (
                                             v
                                             )
                                          
                                       
                                       )
                                    
                                    
                                       δ
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       v
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (A.10)
                              
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 {
                                 
                                    
                                       β
                                    
                                    
                                       k
                                    
                                 
                                 }
                                 )
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                       
                                    
                                 
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 {
                                 
                                    
                                       β
                                    
                                    
                                       k
                                    
                                 
                                 }
                                 )
                              
                           
                        
                        
                           
                              (A.11)
                              
                                 
                                 
                                 
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             β
                                          
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   ji
                                                
                                                
                                                   t
                                                
                                             
                                             (
                                             v
                                             )
                                          
                                       
                                       )
                                    
                                    
                                       δ
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       v
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (A.12)
                              
                                 
                                 
                                 
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             β
                                          
                                          
                                             k
                                             (
                                             v
                                             )
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                          
                                       
                                       δ
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       v
                                       )
                                       δ
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       (
                                       v
                                       )
                                       ,
                                       k
                                       )
                                    
                                 
                              
                           
                        
                     

Indicator variables 
                           
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              =
                              {
                              
                                 
                                    z
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              }
                           
                         are distributed as
                           
                              (A.13)
                              
                                 p
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 Mult
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             j
                                             (
                                             k
                                             )
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       δ
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       k
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (A.14)
                              
                                 p
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                       
                                    
                                 
                                 p
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             j
                                             (
                                             k
                                             )
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       δ
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       k
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (A.15)
                              
                                 
                                 
                                 
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             j
                                             (
                                             k
                                             )
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                          
                                       
                                       δ
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       k
                                       )
                                    
                                 
                              
                           
                        
                     

We use the following conjugate prior distributions
                           
                              (A.16)
                              
                                 p
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 =
                                 Dir
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (A.17)
                              
                                 
                                 
                                 
                                 =
                                 C
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             j
                                             (
                                             k
                                             )
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             α
                                          
                                          
                                             0
                                             (
                                             k
                                             )
                                          
                                       
                                       -
                                       1
                                    
                                 
                              
                           
                        
                        
                           
                              (A.18)
                              
                                 p
                                 (
                                 
                                    
                                       β
                                    
                                    
                                       k
                                    
                                 
                                 |
                                 
                                    
                                       η
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 =
                                 Dir
                                 (
                                 
                                    
                                       β
                                    
                                    
                                       k
                                    
                                 
                                 |
                                 
                                    
                                       η
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (A.19)
                              
                                 
                                 
                                 
                                 
                                 =
                                 C
                                 (
                                 
                                    
                                       η
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             β
                                          
                                          
                                             k
                                             (
                                             v
                                             )
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             η
                                          
                                          
                                             0
                                             (
                                             v
                                             )
                                          
                                       
                                       -
                                       1
                                    
                                 
                              
                           
                        
                     

And finally, 
                           
                              (
                              
                                 
                                    μ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    Λ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         are drawn from the Normal–Wishart distribution, which can be written as the product
                           
                              (A.20)
                              
                                 p
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 p
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       m
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 p
                                 (
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       W
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       ν
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                           
                        where
                           
                              (A.21)
                              
                                 p
                                 (
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       W
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       ν
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 =
                                 W
                                 (
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 
                                 |
                                 
                                 
                                    
                                       W
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       ν
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (A.22)
                              
                                 p
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       m
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 =
                                 N
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 
                                 |
                                 
                                 
                                    
                                       m
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       (
                                       
                                          
                                             λ
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             Λ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 )
                                 .
                              
                           
                        
                     

We now show how to derive the spatial uncertainty,
                        
                           (B.1)
                           
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              ∼
                              N
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   Σ
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                              
                              
                              where
                           
                        
                     
                     
                        
                           (B.2)
                           
                              
                                 
                                    
                                       
                                          Σ
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      2
                                                   
                                                
                                                /
                                                12
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      2
                                                   
                                                
                                                /
                                                12
                                             
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

The diagonal components in the covariance matrix 
                        
                           
                              
                                 
                                    
                                       Σ
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 j
                              
                           
                        
                      are obtained as follows: Given a (univariate) variable x uniformly distributed on the range 
                        
                           [
                           -
                           r
                           /
                           2
                           ,
                           +
                           r
                           /
                           2
                           ]
                        
                     , i.e. a range of size r with 
                        
                           E
                           (
                           x
                           )
                           =
                           0
                        
                     , then the variance of x is
                        
                           (B.3)
                           
                              var
                              (
                              x
                              )
                              =
                              E
                              [
                              
                                 
                                    (
                                    x
                                    -
                                    E
                                    [
                                    x
                                    ]
                                    )
                                 
                                 
                                    2
                                 
                              
                              ]
                              =
                              E
                              [
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              ]
                           
                        
                     
                     
                        
                           (B.4)
                           
                              
                              
                              =
                              
                                 ∫
                                 
                                    -
                                    r
                                    /
                                    2
                                 
                                 
                                    r
                                    /
                                    2
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    1
                                 
                                 
                                    r
                                 
                              
                              dx
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                3
                                                r
                                             
                                          
                                          
                                             
                                                x
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                 
                                 
                                    -
                                    r
                                    /
                                    2
                                 
                                 
                                    r
                                    /
                                    2
                                 
                              
                           
                        
                     
                     
                        
                           (B.5)
                           
                              
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    3
                                    r
                                 
                              
                              
                                 
                                    (
                                    r
                                    /
                                    2
                                    )
                                 
                                 
                                    3
                                 
                              
                              -
                              
                                 
                                    1
                                 
                                 
                                    3
                                    r
                                 
                              
                              
                                 
                                    (
                                    -
                                    r
                                    /
                                    2
                                    )
                                 
                                 
                                    3
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    3
                                    ×
                                    8
                                 
                              
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              +
                              
                                 
                                    1
                                 
                                 
                                    3
                                    ×
                                    8
                                 
                              
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                        
                     
                     
                        
                           (B.6)
                           
                              
                              
                              =
                              
                                 
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    12
                                 
                              
                           
                        
                     
                  

Hence, the covariance matrix of the locations within a rectangle (detection window) of width w and height h is
                        
                           (B.7)
                           
                              
                                 
                                    
                                       
                                          Σ
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      2
                                                   
                                                
                                                /
                                                12
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      2
                                                   
                                                
                                                /
                                                12
                                             
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

We start this section with a short description of variational inference in Appendix C.1, after which we continue to derive the update equations for our model in Appendix C.2.

For completeness, we summarize here the explanation of approximate inference for directed graphical models using Variational Bayesian (VB) inference, as found in [7], Chapter 10. Assume we wish to estimate the posterior distribution 
                           
                              p
                              (
                              Z
                              |
                              X
                              )
                           
                         of some distribution 
                           
                              p
                              (
                              X
                              ,
                              Z
                              )
                           
                         with parameters Z and observed variables X. If an exact solution is intractable, we can approximate 
                           
                              p
                              (
                              Z
                              |
                              X
                              )
                           
                         with a variational distribution 
                           
                              q
                              (
                              Z
                              )
                           
                        , for which estimating the optimal parameters is easier, and minimize the Kullback–Leibler (KL) divergence between 
                           
                              KL
                              (
                              q
                              |
                              |
                              p
                              )
                           
                        . This is achieved by maximizing the lower-bound 
                           
                              L
                              (
                              q
                              )
                           
                        , since [7]
                        
                           
                              (C.1)
                              
                                 ln
                                 p
                                 (
                                 X
                                 )
                                 =
                                 L
                                 (
                                 q
                                 )
                                 +
                                 KL
                                 (
                                 q
                                 |
                                 |
                                 p
                                 )
                                 ,
                                 
                                 where
                              
                           
                        
                        
                           
                              (C.2)
                              
                                 L
                                 (
                                 q
                                 )
                                 =
                                 ∫
                                 q
                                 (
                                 Z
                                 )
                                 ln
                                 
                                    
                                       
                                          
                                             
                                                p
                                                (
                                                X
                                                ,
                                                Z
                                                )
                                             
                                             
                                                q
                                                (
                                                Z
                                                )
                                             
                                          
                                       
                                    
                                 
                                 dZ
                              
                           
                        
                        
                           
                              (C.3)
                              
                                 KL
                                 (
                                 q
                                 |
                                 |
                                 p
                                 )
                                 =
                                 -
                                 ∫
                                 q
                                 (
                                 Z
                                 )
                                 ln
                                 
                                    
                                       
                                          
                                             
                                                p
                                                (
                                                Z
                                                |
                                                X
                                                )
                                             
                                             
                                                q
                                                (
                                                Z
                                                )
                                             
                                          
                                       
                                    
                                 
                                 dZ
                                 .
                              
                           
                        
                     

Now suppose that distribution 
                           
                              q
                              (
                              Z
                              )
                           
                         factorizes into M distributions, each for a different subset of parameters 
                           
                              
                                 
                                    Z
                                 
                                 
                                    i
                                 
                              
                           
                        , such that 
                           
                              Z
                              =
                              (
                              
                                 
                                    Z
                                 
                                 
                                    1
                                 
                              
                              …
                              
                                 
                                    Z
                                 
                                 
                                    M
                                 
                              
                              )
                           
                        , i.e.
                           
                              (C.4)
                              
                                 q
                                 (
                                 Z
                                 )
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          M
                                       
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       Z
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 ,
                                 
                                 then
                              
                           
                        
                        
                           
                              (C.5)
                              
                                 
                                    
                                       
                                       
                                          
                                             L
                                             (
                                             q
                                             )
                                             =
                                             ∫
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   Z
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                             ln
                                             
                                                
                                                   p
                                                
                                                
                                                   ∼
                                                
                                             
                                             (
                                             X
                                             ,
                                             
                                                
                                                   Z
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                             
                                                
                                                   dZ
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                             -
                                             ∫
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   Z
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                             ln
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   Z
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                             
                                                
                                                   dZ
                                                
                                                
                                                   j
                                                
                                             
                                             +
                                             const
                                          
                                       
                                    
                                 
                              
                           
                        where the new distribution 
                           
                              
                                 
                                    p
                                 
                                 
                                    ∼
                                 
                              
                              (
                              X
                              ,
                              
                                 
                                    Z
                                 
                                 
                                    j
                                 
                              
                              )
                           
                         is defined as
                           
                              (C.6)
                              
                                 
                                    
                                       p
                                    
                                    
                                       ∼
                                    
                                 
                                 (
                                 X
                                 ,
                                 
                                    
                                       Z
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       i
                                       ≠
                                       j
                                    
                                 
                                 [
                                 ln
                                 p
                                 (
                                 X
                                 ,
                                 Z
                                 )
                                 ]
                                 +
                                 const
                              
                           
                        
                        
                           
                              (C.7)
                              
                                 
                                    
                                       E
                                    
                                    
                                       i
                                       ≠
                                       j
                                    
                                 
                                 [
                                 ln
                                 p
                                 (
                                 X
                                 ,
                                 Z
                                 )
                                 ]
                                 =
                                 ∫
                                 ln
                                 p
                                 (
                                 X
                                 ,
                                 Z
                                 )
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          i
                                          ≠
                                          j
                                       
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       Z
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 
                                    
                                       dZ
                                    
                                    
                                       i
                                    
                                 
                              
                           
                        and 
                           
                              
                                 
                                    E
                                 
                                 
                                    i
                                    ≠
                                    j
                                 
                              
                              [
                              ·
                              ]
                           
                         is the expectation with respect to q over all variables 
                           
                              
                                 
                                    Z
                                 
                                 
                                    i
                                 
                              
                           
                         for 
                           
                              i
                              
                              ≠
                              
                              j
                           
                        .

While we did not assume any particular form for the distributions 
                           
                              q
                              (
                              
                                 
                                    Z
                                 
                                 
                                    j
                                 
                              
                              )
                           
                        , we can keep all 
                           
                              
                                 
                                    Z
                                 
                                 
                                    i
                                    ≠
                                    j
                                 
                              
                           
                         fixed and maximize (C.5) if we use the optimal solution [7],
                           
                              (C.8)
                              
                                 ln
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       Z
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       i
                                       ≠
                                       j
                                    
                                 
                                 [
                                 ln
                                 p
                                 (
                                 X
                                 ,
                                 Z
                                 )
                                 ]
                                 +
                                 const
                              
                           
                        Thus each distribution 
                           
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                                 
                                    ★
                                 
                              
                              (
                              
                                 
                                    Z
                                 
                                 
                                    j
                                 
                              
                              )
                           
                         depends on the other distributions 
                           
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                                 
                                    ★
                                 
                              
                              (
                              
                                 
                                    Z
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         required to solve the expectation 
                           
                              
                                 
                                    E
                                 
                                 
                                    i
                                    ≠
                                    j
                                 
                              
                              [
                              ln
                              p
                              (
                              X
                              ,
                              Z
                              )
                              ]
                           
                        . This leads to an iterative scheme where we compute the parameters of each distribution 
                           
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                                 
                                    ★
                                 
                              
                              (
                              ·
                              )
                           
                         in turn, each step improving the lower-bound 
                           
                              L
                              (
                              q
                              )
                           
                        .

Typically, if 
                           
                              
                                 
                                    Z
                                 
                                 
                                    j
                                 
                              
                           
                         has a conjugate prior in 
                           
                              p
                              (
                              X
                              ,
                              Z
                              )
                           
                        , the variational posterior 
                           
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                                 
                                    ★
                                 
                              
                              (
                              
                                 
                                    Z
                                 
                                 
                                    j
                                 
                              
                              )
                           
                         will have the form of the corresponding factorized prior in 
                           
                              p
                              (
                              X
                              ,
                              Z
                              )
                           
                         
                        [7].

Note that in C.2 we will simplify the notation by simply writing 
                           
                              
                                 
                                    E
                                 
                                 
                                    q
                                 
                              
                              [
                              ·
                              ]
                           
                         instead of 
                           
                              
                                 
                                    E
                                 
                                 
                                    i
                                    ≠
                                    j
                                 
                              
                              [
                              ·
                              ]
                           
                        , where the context will make clear which variables are estimated, and thus that all other variables are fixed.

Recall that we know from our observations the word occurrence counts in detection 
                           
                              (
                              j
                              ,
                              t
                              )
                           
                        ,
                           
                              (C.9)
                              
                                 
                                    
                                       N
                                    
                                    
                                       jv
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                    
                                 
                                 δ
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 v
                                 )
                              
                           
                        but throughout the derivations of the update equations, we also use the following expected word occurrence counts which we will be able to compute after we have determined 
                           
                              
                                 
                                    q
                                 
                                 
                                    ★
                                 
                              
                              (
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        :
                           
                              (C.10)
                              
                                 
                                    
                                       N
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                                 
                                 ≜
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          δ
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          k
                                          )
                                          δ
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          v
                                          )
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (C.11)
                              
                                 
                                    
                                       N
                                    
                                    
                                       jk
                                    
                                    
                                       t
                                    
                                 
                                 
                                 ≜
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          δ
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          k
                                          )
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (C.12)
                              
                                 
                                    
                                       N
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 
                                 ≜
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          δ
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          k
                                          )
                                          δ
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          v
                                          )
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (C.13)
                              
                                 
                                    
                                       N
                                    
                                    
                                       kv
                                    
                                 
                                 
                                 ≜
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          δ
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          k
                                          )
                                          δ
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          v
                                          )
                                       
                                    
                                 
                              
                           
                        
                     

We can now derive the update equations of the parameters of the variational distribution q.

Using Eq. (C.8) to find the optimal variational posterior for 
                           
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                           
                        , we derive
                           
                              (C.14)
                              
                                 ln
                                 
                                    
                                       q
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 p
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 ]
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 p
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                              
                           
                        
                        
                           
                              (C.15)
                              
                                 
                                 
                                 
                                 
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 Dir
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 ]
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 Mult
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                              
                           
                        
                        
                           
                              (C.16)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                             
                                             
                                             
                                             =
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   α
                                                
                                                
                                                   0
                                                   (
                                                   k
                                                   )
                                                
                                             
                                             -
                                             1
                                             )
                                             ln
                                             
                                                
                                                   θ
                                                
                                                
                                                   j
                                                   (
                                                   k
                                                   )
                                                
                                                
                                                   t
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                             
                                             +
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   q
                                                
                                             
                                             [
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                             δ
                                             (
                                             
                                                
                                                   z
                                                
                                                
                                                   ji
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             k
                                             )
                                             ]
                                             ln
                                             
                                                
                                                   θ
                                                
                                                
                                                   j
                                                   (
                                                   k
                                                   )
                                                
                                                
                                                   t
                                                
                                             
                                             +
                                             const
                                          
                                       
                                    
                                 
                              
                           
                        Note that due to the use of a conjugate prior for 
                           
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                           
                        , the optimal variational posterior is indeed the conjugate posterior
                           
                              (C.17)
                              
                                 
                                    
                                       q
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 Dir
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       γ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        with its parameters computed as
                           
                              (C.18)
                              
                                 
                                    
                                       γ
                                    
                                    
                                       j
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       α
                                    
                                    
                                       0
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                    
                                 
                                 δ
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 k
                                 )
                                 ]
                              
                           
                        
                        
                           
                              (C.19)
                              
                                 
                                 =
                                 
                                    
                                       α
                                    
                                    
                                       0
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       N
                                    
                                    
                                       jk
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        Using the standard properties of the Dirichlet [7], we define
                           
                              (C.20)
                              
                                 ln
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 
                                 ≜
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 ]
                                 =
                                 Ψ
                                 
                                    
                                       
                                          
                                             
                                                γ
                                             
                                             
                                                j
                                                (
                                                k
                                                )
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 -
                                 Ψ
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                γ
                                             
                                             
                                                j
                                                (
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                )
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        which will be used in the association updates. Similarly, we find
                           
                              (C.21)
                              
                                 
                                    
                                       q
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       β
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 =
                                 Dir
                                 (
                                 
                                    
                                       β
                                    
                                    
                                       k
                                    
                                 
                                 |
                                 
                                    
                                       η
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (C.22)
                              
                                 
                                    
                                       η
                                    
                                    
                                       k
                                       (
                                       v
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       η
                                    
                                    
                                       0
                                       (
                                       v
                                       )
                                    
                                 
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          δ
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          k
                                          )
                                          δ
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          v
                                          )
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (C.23)
                              
                                 
                                 =
                                 
                                    
                                       η
                                    
                                    
                                       0
                                       (
                                       v
                                       )
                                    
                                 
                                 +
                                 
                                    
                                       N
                                    
                                    
                                       kv
                                    
                                 
                              
                           
                        
                        
                           
                              (C.24)
                              
                                 
                                    
                                       
                                       
                                          
                                             ln
                                             
                                                
                                                   
                                                      
                                                         β
                                                      
                                                      
                                                         ̃
                                                      
                                                   
                                                
                                                
                                                   k
                                                   (
                                                   v
                                                   )
                                                
                                             
                                             
                                             ≜
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   q
                                                
                                             
                                             [
                                             ln
                                             
                                                
                                                   β
                                                
                                                
                                                   k
                                                   (
                                                   v
                                                   )
                                                
                                             
                                             ]
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                             =
                                             Ψ
                                             
                                                
                                                   
                                                      
                                                         
                                                            η
                                                         
                                                         
                                                            k
                                                            (
                                                            v
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             -
                                             Ψ
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               v
                                                               ′
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            η
                                                         
                                                         
                                                            k
                                                            (
                                                            v
                                                            ′
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Due to the use of conjugate priors, we can again find that the variational posterior 
                           
                              
                                 
                                    q
                                 
                                 
                                    ★
                                 
                              
                              (
                              
                                 
                                    μ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    Λ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         is again a Normal–Wishart distribution,
                           
                              (C.25)
                              
                                 
                                    
                                       q
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 N
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       m
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       (
                                       
                                          
                                             λ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       
                                          
                                             Λ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 )
                                 W
                                 (
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       W
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       ν
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 .
                              
                           
                        The posterior parameters 
                           
                              {
                              
                                 
                                    m
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              }
                           
                         of object k at time t are computed from the shared prior parameters 
                           
                              {
                              
                                 
                                    m
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    W
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    ν
                                 
                                 
                                    0
                                 
                              
                              }
                           
                        , the occurrence counts of the features 
                           
                              
                                 
                                    N
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                           
                         and 
                           
                              
                                 
                                    N
                                 
                                 
                                    jk
                                 
                                 
                                    t
                                 
                              
                           
                        , and the mean and covariance 
                           
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    S
                                 
                                 
                                    k
                                 
                                 
                                    t
                                 
                              
                           
                         of the assigned feature locations,
                           
                              (C.26)
                              
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             N
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jk
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        
                        
                           
                              (C.27)
                              
                                 
                                    
                                       S
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             N
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jk
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      ∼
                                                   
                                                
                                             
                                             
                                                j
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          )
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            ∼
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      t
                                                   
                                                
                                                )
                                             
                                             
                                                ⊤
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   
                                                      Σ
                                                   
                                                   
                                                      ∼
                                                   
                                                
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        With these statistics, we compute the posterior parameters as [7],
                           
                              (C.28)
                              
                                 
                                    
                                       λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       λ
                                    
                                    
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       N
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        
                        
                           
                              (C.29)
                              
                                 
                                    
                                       m
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                m
                                             
                                             
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                N
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (C.30)
                              
                                 
                                    
                                       (
                                       
                                          
                                             W
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       W
                                    
                                    
                                       0
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       N
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                    
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             0
                                          
                                       
                                       +
                                       
                                          
                                             N
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 -
                                 
                                    
                                       m
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       -
                                       
                                          
                                             m
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                              
                           
                        
                        
                           
                              (C.31)
                              
                                 
                                    
                                       ν
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       ν
                                    
                                    
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       N
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 .
                              
                           
                        
                     

Due to the coupling of the likelihoods of the standard LDA and MoG model at the mixture indicators 
                           
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              =
                              {
                              
                                 
                                    z
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              }
                           
                        , derivation of 
                           
                              
                                 
                                    q
                                 
                                 
                                    ★
                                 
                              
                              (
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         is less straightforward. From Eq. (C.8) we know that the optimal variational distribution for 
                           
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                           
                         takes the following form,
                           
                              (C.32)
                              
                                 ln
                                 
                                    
                                       q
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 p
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 p
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 {
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 }
                                 )
                                 ]
                                 .
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 {
                                 
                                    
                                       β
                                    
                                    
                                       k
                                    
                                 
                                 }
                                 )
                                 ]
                                 +
                                 const
                              
                           
                        
                     

Let us first define some intermediate results that are needed to express the second (spatial) term in Eq. (C.32). From the standard properties of the Wishart distribution [7] we find
                           
                              (C.33)
                              
                                 ln
                                 
                                    
                                       
                                          
                                             Λ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 
                                 ≜
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 |
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 ]
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          d
                                          =
                                          1
                                       
                                       
                                          D
                                       
                                    
                                 
                                 Ψ
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      t
                                                   
                                                
                                                +
                                                1
                                                -
                                                d
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 +
                                 D
                                 ln
                                 2
                                 +
                                 ln
                                 |
                                 
                                    
                                       W
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 |
                              
                           
                        and also
                           
                              (C.34)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       -
                                       
                                          
                                             μ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 -
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       ν
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 E
                                 
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      ji
                                                   
                                                   
                                                      t
                                                   
                                                
                                                -
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      t
                                                   
                                                
                                                )
                                             
                                             
                                                ⊤
                                             
                                          
                                          
                                             
                                                W
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          -
                                          
                                             
                                                m
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        
                     

Remember from Eq. (A.7) that the positions 
                           
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              =
                              {
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              }
                           
                         have spatial uncertainty 
                           
                              
                                 
                                    x
                                 
                                 
                                    ji
                                 
                                 
                                    t
                                 
                              
                              ∼
                              N
                              (
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          Σ
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              )
                           
                        , which depends on the location and size of window j. Expanding Eq. (C.34), we therefore obtain
                           
                              (C.35)
                              
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             ji
                                          
                                          
                                             t
                                          
                                       
                                       -
                                       
                                          
                                             μ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       Λ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       ji
                                    
                                    
                                       t
                                    
                                 
                                 -
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       ν
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 trace
                                 
                                    
                                       
                                          
                                             
                                                W
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               Σ
                                                            
                                                            
                                                               ∼
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   +
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               ∼
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   )
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     ∼
                                                                  
                                                               
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                         -
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               k
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where we make use of the property,
                           
                              (C.36)
                              
                                 
                                    
                                       E
                                    
                                    
                                       x
                                       ∼
                                       N
                                       (
                                       μ
                                       ,
                                       Σ
                                       )
                                    
                                 
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       ⊤
                                    
                                 
                                 Ax
                                 ]
                                 =
                                 trace
                                 [
                                 A
                                 (
                                 Σ
                                 +
                                 μ
                                 
                                    
                                       μ
                                    
                                    
                                       ⊤
                                    
                                 
                                 )
                                 ]
                                 .
                              
                           
                        for which a proof can be found in Appendix C.7.

Now we can resolve Eq. (C.32),
                           
                              (C.37)
                              
                                 ln
                                 
                                    
                                       q
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jk
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 ]
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jk
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          -
                                          
                                             
                                                D
                                             
                                             
                                                2
                                             
                                          
                                          ln
                                          (
                                          2
                                          π
                                          )
                                          +
                                          
                                             
                                                1
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                E
                                             
                                             
                                                q
                                             
                                          
                                          [
                                          ln
                                          |
                                          
                                             
                                                Λ
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          ]
                                          -
                                          
                                             
                                                1
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                E
                                             
                                             
                                                q
                                             
                                          
                                          [
                                          
                                             
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      ji
                                                   
                                                   
                                                      t
                                                   
                                                
                                                -
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      t
                                                   
                                                
                                                )
                                             
                                             
                                                ⊤
                                             
                                          
                                          
                                             
                                                Λ
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ji
                                             
                                             
                                                t
                                             
                                          
                                          -
                                          
                                             
                                                μ
                                             
                                             
                                                k
                                             
                                             
                                                t
                                             
                                          
                                          )
                                          ]
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 
                                    
                                       β
                                    
                                    
                                       k
                                       (
                                       v
                                       )
                                    
                                 
                                 ]
                                 +
                                 const
                              
                           
                        We can simplify this equations by combining the summations,
                           
                              (C.38)
                              
                                 ln
                                 
                                    
                                       q
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                                 ln
                                 
                                    
                                       ρ
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                                 +
                                 const
                              
                           
                        where we define
                           
                              (C.39)
                              
                                 ln
                                 
                                    
                                       ρ
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 
                                    
                                       θ
                                    
                                    
                                       j
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 ]
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       q
                                    
                                 
                                 [
                                 ln
                                 
                                    
                                       β
                                    
                                    
                                       k
                                       (
                                       v
                                       )
                                    
                                 
                                 ]
                                 -
                                 
                                    
                                       D
                                    
                                    
                                       2
                                    
                                 
                                 ln
                                 (
                                 2
                                 π
                                 )
                              
                           
                        
                        
                           
                              (C.40)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                             
                                             +
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   q
                                                
                                             
                                             [
                                             ln
                                             |
                                             
                                                
                                                   Λ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             |
                                             ]
                                             -
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   q
                                                
                                             
                                             [
                                             
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         μ
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   Λ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ji
                                                
                                                
                                                   t
                                                
                                             
                                             -
                                             
                                                
                                                   μ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                             ]
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                             =
                                             ln
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ̃
                                                      
                                                   
                                                
                                                
                                                   j
                                                   (
                                                   k
                                                   )
                                                
                                                
                                                   t
                                                
                                             
                                             +
                                             ln
                                             
                                                
                                                   
                                                      
                                                         β
                                                      
                                                      
                                                         ̃
                                                      
                                                   
                                                
                                                
                                                   k
                                                   (
                                                   v
                                                   )
                                                
                                             
                                             -
                                             
                                                
                                                   D
                                                
                                                
                                                   2
                                                
                                             
                                             ln
                                             (
                                             2
                                             π
                                             )
                                             +
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                             ln
                                             |
                                             
                                                
                                                   
                                                      
                                                         Λ
                                                      
                                                      
                                                         ̃
                                                      
                                                   
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             |
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                             -
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   q
                                                
                                             
                                             [
                                             
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         μ
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   Λ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ji
                                                
                                                
                                                   t
                                                
                                             
                                             -
                                             
                                                
                                                   μ
                                                
                                                
                                                   k
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                             ]
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

From the form of Eq. (C.38) we see that 
                           
                              
                                 
                                    q
                                 
                                 
                                    ★
                                 
                              
                              (
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         takes the form of a multinomial distribution (the constant term is part of the normalization factor). The parameters ϕ of this normalized distribution are therefore expressed in terms of (C.40) as
                           
                              (C.41)
                              
                                 
                                    
                                       q
                                    
                                    
                                       ★
                                    
                                 
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             ϕ
                                          
                                          
                                             jv
                                             (
                                             k
                                             )
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             N
                                          
                                          
                                             jkv
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 =
                                 Mult
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       j
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       ϕ
                                    
                                    
                                       jv
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (C.42)
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       jv
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ρ
                                          
                                          
                                             jkv
                                          
                                          
                                             t
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       
                                          
                                             ρ
                                          
                                          
                                             
                                                
                                                   jk
                                                
                                                
                                                   ′
                                                
                                             
                                             v
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Substituting the results from Equations (C.20), (C.24), (C.33) and (C.35) in (C.40), we find the update
                           
                              (C.43)
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       jv
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       c
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          Ψ
                                          (
                                          
                                             
                                                η
                                             
                                             
                                                k
                                                (
                                                v
                                                )
                                             
                                          
                                          )
                                          -
                                          Ψ
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            
                                                               
                                                                  v
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         η
                                                      
                                                      
                                                         k
                                                         (
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 exp
                                 {
                                 Ψ
                                 (
                                 
                                    
                                       γ
                                    
                                    
                                       j
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 }
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   Λ
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             k
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                    
                                       1
                                       /
                                       2
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          -
                                          
                                             
                                                D
                                             
                                             
                                                2
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                          trace
                                          
                                             
                                                
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               Σ
                                                            
                                                            
                                                               ∼
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   +
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               ∼
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   )
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     ∼
                                                                  
                                                               
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                         -
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               k
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where c normalizes the distribution.

From the distribution 
                           
                              
                                 
                                    q
                                 
                                 
                                    ★
                                 
                              
                              (
                              z
                              )
                           
                        , we can finally compute the expected word counts,
                           
                              (C.44)
                              
                                 
                                    
                                       N
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       N
                                    
                                    
                                       jv
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       jv
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        
                        
                           
                              (C.45)
                              
                                 
                                    
                                       N
                                    
                                    
                                       jk
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jv
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       jv
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        
                        
                           
                              (C.46)
                              
                                 
                                    
                                       N
                                    
                                    
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jv
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       jv
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        
                        
                           
                              (C.47)
                              
                                 
                                    
                                       N
                                    
                                    
                                       kv
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jv
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       jv
                                       (
                                       k
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       jkv
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        With the updated counts, we can perform again new appearance, prior and spatial updates. Hence, all the discussed updates are coupled, and will need to be executed iteratively.

We initialize inference by uniformly sampling values for all 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    jv
                                    (
                                    k
                                    )
                                 
                                 
                                    t
                                 
                              
                           
                         from 
                           
                              U
                              (
                              0
                              ,
                              1
                              )
                           
                        , and obtain normalized 
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    jv
                                    (
                                    k
                                    )
                                 
                                 
                                    t
                                 
                              
                           
                         according to Eq. (C.42). Then, we can compute the expected word counts (C.44), and proceed to iteratively apply the updates.

Given that vector x is distributed according to a Normal distribution 
                           
                              x
                              ∼
                              N
                              (
                              μ
                              ,
                              Σ
                              )
                           
                        , we wish to compute 
                           
                              E
                              [
                              
                                 
                                    x
                                 
                                 
                                    ⊤
                                 
                              
                              Ax
                              ]
                           
                        , where A is can be written as 
                           
                              A
                              =
                              
                                 
                                    B
                                 
                                 
                                    ⊤
                                 
                              
                              B
                           
                        .

Let us define 
                           
                              y
                              =
                              Bx
                           
                        , then
                           
                              (C.48)
                              
                                 E
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       ⊤
                                    
                                 
                                 Ax
                                 ]
                                 =
                                 E
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       B
                                    
                                    
                                       ⊤
                                    
                                 
                                 Bx
                                 ]
                                 =
                                 E
                                 [
                                 
                                    
                                       y
                                    
                                    
                                       ⊤
                                    
                                 
                                 y
                                 ]
                              
                           
                        and y is distributed as 
                           
                              y
                              ∼
                              N
                              (
                              
                                 
                                    μ
                                 
                                 
                                    y
                                 
                              
                              ,
                              
                                 
                                    Σ
                                 
                                 
                                    y
                                 
                              
                              )
                           
                         with
                           
                              (C.49)
                              
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                 
                                 =
                                 B
                                 μ
                                 
                                 
                                    
                                       Σ
                                    
                                    
                                       y
                                    
                                 
                                 =
                                 B
                                 Σ
                                 
                                    
                                       B
                                    
                                    
                                       ⊤
                                    
                                 
                              
                           
                        
                     

From the definition of the covariance we know that
                           
                              (C.50)
                              
                                 
                                    
                                       Σ
                                    
                                    
                                       y
                                    
                                 
                                 =
                                 E
                                 [
                                 
                                    
                                       yy
                                    
                                    
                                       ⊤
                                    
                                 
                                 ]
                                 -
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                 
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                    
                                       ⊤
                                    
                                 
                                 ,
                              
                           
                        therefore
                           
                              (C.51)
                              
                                 E
                                 [
                                 
                                    
                                       yy
                                    
                                    
                                       ⊤
                                    
                                 
                                 ]
                                 =
                                 
                                    
                                       Σ
                                    
                                    
                                       y
                                    
                                 
                                 +
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                 
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                    
                                       ⊤
                                    
                                 
                                 .
                              
                           
                        
                     

Now we note that 
                           
                              E
                              [
                              
                                 
                                    y
                                 
                                 
                                    ⊤
                                 
                              
                              y
                              ]
                              =
                              trace
                              [
                              E
                              [
                              
                                 
                                    yy
                                 
                                 
                                    ⊤
                                 
                              
                              ]
                              ]
                           
                        . From all of the above, it then follows that
                           
                              (C.52)
                              
                                 E
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       ⊤
                                    
                                 
                                 Ax
                                 ]
                                 =
                                 trace
                                 [
                                 
                                    
                                       Σ
                                    
                                    
                                       y
                                    
                                 
                                 +
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                 
                                 
                                    
                                       μ
                                    
                                    
                                       y
                                    
                                    
                                       ⊤
                                    
                                 
                                 ]
                              
                           
                        
                        
                           
                              (C.53)
                              
                                 
                                 
                                 
                                 
                                 =
                                 trace
                                 [
                                 B
                                 Σ
                                 
                                    
                                       B
                                    
                                    
                                       ⊤
                                    
                                 
                                 +
                                 B
                                 μ
                                 
                                    
                                       μ
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       B
                                    
                                    
                                       ⊤
                                    
                                 
                                 ]
                              
                           
                        
                        
                           
                              (C.54)
                              
                                 
                                 
                                 
                                 
                                 =
                                 trace
                                 [
                                 B
                                 (
                                 Σ
                                 +
                                 μ
                                 
                                    
                                       μ
                                    
                                    
                                       ⊤
                                    
                                 
                                 )
                                 
                                    
                                       B
                                    
                                    
                                       ⊤
                                    
                                 
                                 ]
                              
                           
                        
                        
                           
                              (C.55)
                              
                                 
                                 
                                 
                                 
                                 =
                                 trace
                                 [
                                 
                                    
                                       B
                                    
                                    
                                       ⊤
                                    
                                 
                                 B
                                 (
                                 Σ
                                 +
                                 μ
                                 
                                    
                                       μ
                                    
                                    
                                       ⊤
                                    
                                 
                                 )
                                 ]
                              
                           
                        
                        
                           
                              (C.56)
                              
                                 
                                 
                                 
                                 
                                 =
                                 trace
                                 [
                                 A
                                 (
                                 Σ
                                 +
                                 μ
                                 
                                    
                                       μ
                                    
                                    
                                       ⊤
                                    
                                 
                                 )
                                 ]
                                 .
                              
                           
                        This result was used in Eq. (C.35) to obtain the association updates for our model.

Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.cviu.2015.03.012.


                     
                        
                           
                        
                     
                  

@&#REFERENCES@&#

