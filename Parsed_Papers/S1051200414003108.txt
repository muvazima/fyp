@&#MAIN-TITLE@&#Modeling and estimation of single-trial event-related potentials using partially observed diffusion processes

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Continuous-time partially observed diffusion modeling of single-trial ERPs.


                        
                        
                           
                           Improved modeling of hidden continuous dynamics and irregularly spaced ERPs.


                        
                        
                           
                           Ornstein–Uhlenbeck and Cox, Ingersoll & Ross process (to capture abrupt changes).


                        
                        
                           
                           Incorporate single-trial trend component and stochastic volatility noise process.


                        
                        
                           
                           Better single-trial estimates of auditory brainstem responses & wave V detection.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Diffusion models

Non-linear state-space models

Particle filters

Event-related potentials

@&#ABSTRACT@&#


               
               
                  This paper proposes a new modeling framework for estimating single-trial event-related potentials (ERPs). Existing studies based on state-space approach use discrete-time random-walk models. We propose to use continuous-time partially observed diffusion process which is more natural and appropriate to describe the continuous dynamics underlying ERPs, discretely observed in noise as single-trials. Moreover, the flexibility of the continuous-time model being specified and analyzed independently of observation intervals, enables a more efficient handling of irregularly or variably sampled ERPs than its discrete-time counterpart which is fixed to a particular interval. We consider the Ornstein–Uhlenbeck (OU) process for the inter-trial parameter dynamics and further propose a nonlinear process of Cox, Ingersoll & Ross (CIR) with a heavy-tailed density to better capture the abrupt changes. We also incorporate a single-trial trend component using the mean-reversion variant, and a stochastic volatility noise process. The proposed method is applied to analysis of auditory brainstem responses (ABRs). Simulation shows that both diffusions give satisfactory tracking performance, particularly of the abrupt ERP parameter variations by the CIR process. Evaluation on real ABR data across different subjects, stimulus intensities and hearing conditions demonstrates the superiority of our method in extracting the latent single-trial dynamics with significantly improved SNR, and in detecting the wave V which is critical for diagnosis of hearing loss. Estimation results on data with variable sampling frequencies and missing single-trials show that the continuous-time diffusion model can capture more accurately the inter-trial dynamics between varying observation intervals, compared to the discrete-time model.
               
            

@&#INTRODUCTION@&#

Event-related potentials (ERPs) are bioelectrical responses of the brain to specific stimulus, which provide useful information about neurological processing. The problem is to extract the ERPs hidden behind various noise sources e.g. background electroencephalogram (EEG) and non-neural artifacts, typically in poor signal-to-noise ratio (SNR) condition. Conventional ensemble averaging of time-locked single-trials obtained by repeated stimulations can cancel out random background noise, but implies loss of information related to trial-to-trial variability due to different degree of fatigue, habituation, or attention levels of subjects [1]. Auditory brainstem response (or evoked potentials) (ABRs or ABEPs), a particular type of ERPs is the early portion of the auditory evoked potentials. The major waves of ABR are important for hearing and neurological assessment and exhibit variability across trials. Estimation of inter-trial variability and common trend of major waves for these small-amplitude potentials obscured by various noise and artifacts, poses a challenge to this study.

Various approaches were proposed to solve single-trial based estimation of ERPs which is also the focus of this study. State-space approach was recently proposed for single-trial dynamical ERP estimation in [1–4] and our work [5]. Within the state-space framework, the underlying dynamics of clean ERPs are modeled as a discrete-time first-order Markov process i.e. a simple Gaussian random-walk process in the state equation, which is observed in additive Gaussian noise as single-trial measurements in the observation equation. The latent ERP process is then estimated recursively using Kalman filter (KF) [1], which is optimal in the mean-square sense. Extension using Kalman smoother [2] further improves the performance in tracking of ERP changes. Similar study [3] proposed a particle filter (PF) for the estimation and uses wavelet coefficients, instead of measurement samples, as ERP parameters [1] to reduce the state dimension and hence the computational effort. This study was extended in [4], which models the ERP subcomponent waveforms using shifted Gaussian functions, which can directly characterize important ERP morphological features such as the peak amplitudes and latencies. The Gaussians are also less inclined to capture the abruptly changing random noises, except the usually smooth ERP waves. The parameter estimation is done by Rao–Blackwellised PF (RBPF). However, the above-mentioned studies [1–5] assume discrete-time modeling which is inappropriate to describe the single-trial ERPs, the underlying physiological processes which are typically of continuous nature. Besides, the discrete-time models are unable to handle the irregularly sampled data problem which is common in practice, where the ERP measurements are unequally spaced with some single-trials occasionally missing, probably due to sensor failures. Moreover, these studies use a Gaussian noise model with constant variance, which fails to describe adequately the actual observational noise process whose volatility typically changes over time.

We develop a new framework for modeling the inter-trial dynamics of ERPs based on continuous-time partially-observed (PO) diffusion process, with applications to estimation of single-trials corrupted by noise. Our approach is rooted in the state-space framework of the aforementioned studies, but offers several enhancements over the existing models, by relaxing the inadequate discrete-time and constant noise-volatility modeling assumptions and incorporating additional, important features of ERPs which have not so far been accounted for, such as the trend of the single-trials. In particular, we decompose the single-trial observations into three components: (1) latent clean ERP component, (2) observational noise component and (3) trend component, each described by a separate stochastic process. For the first component, we propose to use continuous-time processes to model the underlying dynamics of the latent clean ERPs. The continuous-time models have been applied extensively in physics, biology, econometrics [6,7] and engineering [8], due to their advantages over their discrete-time counterparts. This also forms our motivation of applying it for modeling single-trial ERPs, with the following reasons. First, it seems more natural and appropriate to use continuous-time modeling to describe real-world dynamical phenomena [7], such as the continuous physiological process underlying the single-trial EPRs considered here. Despite that the observations are always available only at discrete-time points; it is more adequate to assume that they are generated from continuous processes. Secondly, the continuous-time models can deal with variably or irregularly sampled data problem efficiently [8,9], due to their flexibility in defining implicitly and consistently over observation intervals of any length, with their adjustable parameter space estimated independently of the data sampling interval. However, the discrete-time models are specified in relation to a particular sampling interval, and therefore are fixed once estimated and only valid for this chosen sampling rate. Thus, the variable sampled data needs to be incorporated explicitly through model re-estimation. We illustrate these advantages of the continuous-time approach over its discrete-time counterpart, on two real situations in ERP estimation: (1) Estimation with variably sampled (down-sampled) single-trials, which can save computational effort without affecting the overall estimated dynamic pattern of ERPs; and (2) Estimation with irregularly spaced single-trials with missing observations where some trials contains very low (sometimes zeros) signals, which are currently solved only by direct elimination [10].

We consider the commonly used continuous-time model i.e. the diffusion process driven by Brownian noise. Diffusion processes governed by the stochastic differential equations (SDEs) can accommodate random disturbances in the deterministic behavior, and are widely used for modeling physical and biological dynamical systems disturbed by noise [11]. Besides, the diffusion process is a continuous-time Markovian process to be contrasted with the discrete-time random-walk process used previously in [1–5]. Various variants of diffusion models with rich modeling properties have been proposed. To accommodate the discrete-time observation scheme of single-trial ERPs, we use a particular family of PO diffusion processes where the continuous-time diffusions are discretely observed [11], possibly further with noise [12]. Such formulation is suitable to describe the continuous dynamics underlying ERPs which are observed only as discrete-time noisy single-trials. Specifically, the hidden continuous dynamic changes in the ERP Gaussian mixture parameters are assumed to follow a multivariate diffusion process, which is only partially observed at discrete times with additive background noise as single-trial data in the observation model. To the authors' knowledge, there are no studies applying this kind of models for analyzing ERPs and its use for bio-signals in general is still very limited.

A simple special case of diffusion process is first considered, i.e. the Ornstein–Uhlenbeck (OU) process. The use of OU model in its linear Gaussian form, assumes marginal inter-trial ERP changes that can be captured by its normal transition density. However, this assumption is inconsistent with the presence of both smooth and abrupt changes in the actual ERP dynamics, which implies a non-Gaussian behavior. The OU model is unable to capture both of these changes simultaneously, where a small variance of the normal transition density fails to detect rapidly the abrupt changes, while large variance tends to produce noisy estimates. This Gaussian modeling problem has been addressed in [13] and our earlier work [14] for other types of models in discrete-time. Another limitation of the OU model is that it allows for a negative process which is unsuitable for the non-negative latency and width parameters of the Gaussian ERP components. To accommodate these non-Gaussian dynamics of ERPs, we further propose an enhancement over the linear Gaussian OU process by considering a non-linear diffusion process of Cox, Ingersoll & Ross (CIR) [15]. The non-Gaussian heavy-tailed transition density of CIR process, a noncentral chi-squared density can capture both abrupt and smooth ERP parameter changes, hence providing more accurate single-trial estimates than the OU model. We use the Gaussian OU process which can take negative values to model the amplitude parameters, and the non-negative CIR process for the latency and width parameters. Moreover, both diffusions are stationary and thus produce more stable ERP estimates than the non-stationary random-walk models of [1–4].

To incorporate the single-trial trend component, we proceed to use the mean-reverting variant for both diffusion processes, which approaches a stationary asymptotic distribution in long run. The advantage is that the asymptotic mean of the stationary distribution can represent the underlying trend of the trial-varying ERPs, revealing more clearly the overall morphology of the ERP waveform. To capture more accurately the changing-volatility in the noise component in order to achieve better noise-reduction, we allow the observational noise variance to be varying over trials instead of a constant one. We consider the stochastic volatility (SV) modeling [16] where the trial-varying variance is modeled directly as a latent stochastic process, which is flexible and easy to generalize to multivariate case. The idea of incorporating SV noise models for denoising of single-trial ERPs has been explored in our recent work [17]. Preliminary evaluation on normal ERPs of a single-subject showed more accurate estimates of inter-trial dynamics compared to the constant noise variance. The evolution of both the trend and noise components is assumed to follow a simple random-walk process.

The proposed PO diffusion model of ERPs is then reformulated and estimated under the state-space framework. Estimation of the non-linear processes of latency and width parameters admits no closed-form solution and has to resort to simulation-based PF methods. Considering that the linear Gaussian process of amplitudes can be estimated analytically by KF, the partially-nonlinear ERP model is re-formulated in conditionally-linear Gaussian state-space form to enable estimation using the more efficient RBPF. Although our RBPF framework is based on [4], its implementation to the diffusion process is not as straightforward as to the discrete-time models, which requires explicit solution to the continuous-time SDEs and closed-form transition densities for the processes. Both OU and CIR diffusions considered here have transition densities in closed-form obtained via Ito integration, for which RBPF can be applied directly. We consider time-varying parameter estimation by augmenting the model parameters to state vector followed by simultaneous estimation by the generic PF [17].

We apply the proposed methods to single-trial ABR estimation, for extracting inter-trial dynamics from noise and detecting the wave V component of ABR, critical for hearing problem assessment. We demonstrate the advantages of our model over the conventional discrete-time random-walk model based on evaluation using simulated and real data, particularly in handling irregularly spaced data in ABR estimation. We also investigate the effect of the model parameter choices on the estimation performance which was not addressed much in the previous works [1–4].

Thus, in common with the previous studies [1–4], we attempt the state-space method for dynamical estimation of single-trial ERPs. In contrast to the discrete-time Gaussian random-walk modeling, we develop an enhanced framework for modeling and estimating single-trial ERPs based on continuous-time PO diffusion process. The main contributions of this paper are summarized as follows
                        
                           •
                           We introduce continuous-time diffusion processes for improved modeling of the underlying continuous dynamics of single-trial ERPs and handling of irregularly spaced data, compared to the existing discrete-time approach.

We consider OU and CIR process which are stationary and produce more stable ERP estimates than the random-walks. The heavy-tailed density of CIR can also capture the abrupt changes better than the Gaussian models.

We incorporate a single-trial trend model for better representation of major ERP morphology and a stochastic volatility noise model to enhance noise reduction.

We apply the methods to estimation of single-trial ABRs and detection of wave V for hearing-loss diagnosis, with evaluation across different subjects, stimulus intensities and pathological case, instead of normal cases only as in the previous studies [1–5].

The d-dimensional vector of single-trial ERP parameters 
                        
                           
                              o
                           
                           
                              t
                           
                        
                      is assumed to follow a multivariate continuous-time diffusion process solution to an SDE of the form
                        
                           (1)
                           
                              d
                              
                                 
                                    o
                                 
                                 
                                    t
                                 
                              
                              =
                              b
                              (
                              
                                 
                                    o
                                 
                                 
                                    t
                                 
                              
                              ,
                              θ
                              )
                              d
                              t
                              +
                              σ
                              (
                              
                                 
                                    o
                                 
                                 
                                    t
                                 
                              
                              ,
                              θ
                              )
                              d
                              
                                 
                                    W
                                 
                                 
                                    t
                                 
                              
                           
                        
                      where functions 
                        b
                        (
                        
                           
                              o
                           
                           
                              t
                           
                        
                        ,
                        θ
                        )
                      and 
                        σ
                        (
                        
                           
                              o
                           
                           
                              t
                           
                        
                        ,
                        θ
                        )
                      are drift and diffusion coefficients respectively, which depend on unknown parameter vector 
                        θ
                     . 
                        
                           
                              W
                           
                           
                              t
                           
                        
                      is a d-dimensional standard Brownian motion. Let 
                        
                           
                              y
                           
                           
                              n
                           
                        
                        =
                        
                           
                              [
                              
                                 
                                    y
                                 
                                 
                                    n
                                 
                              
                              (
                              1
                              )
                              ,
                              
                                 
                                    y
                                 
                                 
                                    n
                                 
                              
                              (
                              2
                              )
                              ,
                              …
                              ,
                              
                                 
                                    y
                                 
                                 
                                    n
                                 
                              
                              (
                              k
                              )
                              ]
                           
                           
                              T
                           
                        
                      be measurement samples of length k of a single-trial ERP at trial n, and observations 
                        
                           
                              y
                           
                           
                              1
                           
                        
                        ,
                        
                           
                              y
                           
                           
                              2
                           
                        
                        ,
                        …
                        ,
                        
                           
                              y
                           
                           
                              n
                           
                        
                      occur at discrete time points 
                        0
                        ≤
                        
                           
                              t
                           
                           
                              1
                           
                        
                        <
                        
                           
                              t
                           
                           
                              2
                           
                        
                        <
                        …
                        <
                        
                           
                              t
                           
                           
                              n
                           
                        
                     . The continuous process (1) is only discretely observed at time 
                        
                           
                              t
                           
                           
                              n
                           
                        
                     , denoted as 
                        
                           
                              o
                           
                           
                              
                                 
                                    t
                                 
                                 
                                    n
                                 
                              
                           
                        
                        
                           =
                           Δ
                        
                        
                           
                              o
                           
                           
                              n
                           
                        
                     , with further noise source 
                        
                           
                              v
                           
                           
                              n
                           
                        
                      and through mapping 
                        h
                        (
                        .
                        )
                      as noisy single-trials 
                        
                           
                              y
                           
                           
                              n
                           
                        
                     :
                        
                           (2)
                           
                              
                                 
                                    y
                                 
                                 
                                    n
                                 
                              
                              =
                              h
                              (
                              
                                 
                                    o
                                 
                                 
                                    n
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    n
                                 
                              
                              ,
                              θ
                              )
                              .
                           
                        
                      Refer to [12] for various observation schemes for PO diffusions.

We use a special case of observation model (2), an additive noise model as in [1–4] with the following decomposition
                           
                              (3)
                              
                                 
                                    
                                       y
                                    
                                    
                                       n
                                    
                                 
                                 =
                                 h
                                 (
                                 
                                    
                                       o
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                                 ∼
                                 N
                                 (
                                 0
                                 ,
                                 R
                                 )
                              
                           
                         where 
                           
                              
                                 v
                              
                              
                                 n
                              
                           
                         is 
                           k
                           ×
                           1
                         Gaussian white noise with mean zero and diagonal covariance matrix 
                           R
                           =
                           
                              
                                 σ
                              
                              
                                 v
                              
                              
                                 2
                              
                           
                           
                              
                                 I
                              
                              
                                 k
                              
                           
                         where 
                           
                              
                                 I
                              
                              
                                 k
                              
                           
                         denotes a 
                           k
                           ×
                           k
                         identity matrix. The noise component 
                           
                              
                                 v
                              
                              
                                 n
                              
                           
                         can represent the background EEG and artifacts.

The vector function 
                           h
                           :
                           
                              
                                 R
                              
                              
                                 k
                              
                           
                           ×
                           
                              
                                 R
                              
                              
                                 d
                              
                           
                           →
                           
                              
                                 R
                              
                              
                                 k
                              
                           
                         maps the ERP parameters 
                           
                              
                                 o
                              
                              
                                 n
                              
                           
                         to the observations 
                           
                              
                                 y
                              
                              
                                 n
                              
                           
                        . The term 
                           
                              
                                 
                                    
                                       y
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 n
                              
                           
                           
                              =
                              Δ
                           
                           h
                           (
                           
                              
                                 o
                              
                              
                                 n
                              
                           
                           )
                         is the clean or denoised single-trial of ERP. Since ERP waveform consists of subcomponents with approximately Gaussian shape, 
                           
                              
                                 
                                    
                                       y
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 n
                              
                           
                         can be modeled as a mixture of M Gaussians using a non-linear mapping function for h with each element given as [4]
                        
                           
                              (4)
                              
                                 
                                    
                                       h
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       o
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       h
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 =
                                 
                                    ∑
                                    
                                       m
                                       =
                                       1
                                    
                                    M
                                 
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 m
                                 )
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       
                                          
                                             (
                                             k
                                             −
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             m
                                             )
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       /
                                       (
                                       2
                                       
                                          
                                             c
                                          
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       m
                                       )
                                       )
                                    
                                 
                              
                           
                         where 
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                           (
                           m
                           )
                           ,
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                           (
                           m
                           )
                           ,
                           
                              
                                 c
                              
                              
                                 n
                              
                           
                           (
                           m
                           )
                         are respectively the amplitude, latency and width parameters of the m-th Gaussian component for trial n. Thus, a clean single-trial ERP 
                           
                              
                                 
                                    
                                       y
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 n
                              
                           
                         can be represented by the set of Gaussian mixture model parameters, in a compact form 
                           
                              
                                 o
                              
                              
                                 n
                              
                           
                           
                              =
                              Δ
                           
                           (
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                           ,
                           
                              
                                 c
                              
                              
                                 n
                              
                           
                           )
                         where 
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 1
                                 )
                                 ,
                                 …
                                 ,
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 M
                                 )
                                 ]
                              
                              
                                 T
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       b
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 1
                                 )
                                 ,
                                 …
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 M
                                 )
                                 ]
                              
                              
                                 T
                              
                           
                        , and 
                           
                              
                                 c
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       c
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 1
                                 )
                                 ,
                                 …
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 M
                                 )
                                 ]
                              
                              
                                 T
                              
                           
                        . Note that these subcomponent parameters are allowed to be trial-varying to model the inter-trial variations of ERPs.

A simple model for the trial-varying ERP parameters is the discrete-time random walk [4]
                        
                           
                              (5)
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 +
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   η
                                                
                                                
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   η
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   η
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   η
                                                
                                                
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   η
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   η
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ∼
                                 N
                                 
                                    (
                                    
                                       [
                                       
                                          
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                    
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      a
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      b
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      c
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    )
                                 
                              
                           
                         Instead of discrete-time models, it is more natural and advantageous to assume that they are generated by underlying continuous transients which can be described by continuous-time models such as (1). We consider two diffusions: a Gaussian OU process for amplitude parameters and a non-linear CIR process for the latencies and widths.

The amplitude parameters 
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                         are assumed as discretely observed samples of an M-dimensional mean-reverting OU process 
                           
                              
                                 a
                              
                              
                                 t
                              
                           
                         solution to the SDE
                           
                              (6)
                              
                                 d
                                 
                                    
                                       a
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 β
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       a
                                    
                                 
                                 −
                                 
                                    
                                       a
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 d
                                 t
                                 +
                                 
                                    
                                       σ
                                    
                                    
                                       a
                                    
                                 
                                 d
                                 
                                    
                                       W
                                    
                                    
                                       t
                                    
                                 
                              
                           
                         where 
                           β
                           >
                           0
                         is speed of reversion, 
                           
                              
                                 μ
                              
                              
                                 a
                              
                           
                         is long run equilibrium level of process 
                           
                              
                                 a
                              
                              
                                 t
                              
                           
                        , 
                           
                              
                                 σ
                              
                              
                                 a
                              
                              
                                 2
                              
                           
                         is the process variance. The process tends to drift in direction towards equilibrium level 
                           
                              
                                 μ
                              
                              
                                 a
                              
                           
                         with speed determined by β. Refer to [19,20] for details of OU process. By Ito formula, the explicit solution of 
                           
                              
                                 a
                              
                              
                                 t
                              
                           
                         can be obtained as
                           
                              (7)
                              
                                 
                                    
                                       a
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       a
                                    
                                    
                                       0
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       β
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       μ
                                    
                                    
                                       a
                                    
                                 
                                 
                                    (
                                    1
                                    −
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          β
                                          t
                                       
                                    
                                    )
                                 
                                 +
                                 
                                    
                                       α
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       ε
                                    
                                    
                                       t
                                    
                                 
                              
                           
                         where the initial 
                           
                              
                                 a
                              
                              
                                 0
                              
                           
                         is normally distributed and 
                           
                              
                                 ε
                              
                              
                                 t
                              
                           
                         is assumed as a Gaussian white noise with mean zero and covariance matrix 
                           P
                           =
                           
                              
                                 σ
                              
                              
                                 a
                              
                              
                                 2
                              
                           
                           
                              
                                 I
                              
                              
                                 M
                              
                           
                         with 
                           
                              
                                 α
                              
                              
                                 t
                              
                           
                           =
                           
                              
                                 (
                                 1
                                 −
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       2
                                       β
                                       t
                                    
                                 
                                 )
                                 /
                                 2
                                 β
                              
                           
                        . The process has a Gaussian marginal distribution with mean and variance [19]
                        
                           
                              (8)
                              
                                 
                                    E
                                    [
                                    
                                       
                                          a
                                       
                                       
                                          t
                                       
                                    
                                    ]
                                    =
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          β
                                          t
                                       
                                    
                                    E
                                    [
                                    
                                       
                                          a
                                       
                                       
                                          0
                                       
                                    
                                    ]
                                    +
                                    
                                       
                                          μ
                                       
                                       
                                          a
                                       
                                    
                                    
                                       (
                                       1
                                       −
                                       
                                          
                                             e
                                          
                                          
                                             −
                                             β
                                             t
                                          
                                       
                                       )
                                    
                                    →
                                    
                                       
                                          μ
                                       
                                       
                                          a
                                       
                                    
                                    
                                    
                                       as
                                    
                                    
                                    t
                                    →
                                    ∞
                                 
                              
                              
                                 
                                    
                                       Var
                                    
                                    [
                                    
                                       
                                          a
                                       
                                       
                                          t
                                       
                                    
                                    ]
                                    =
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          2
                                          β
                                          t
                                       
                                    
                                    
                                       Var
                                    
                                    [
                                    
                                       
                                          a
                                       
                                       
                                          0
                                       
                                    
                                    ]
                                    +
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                       
                                          2
                                          β
                                       
                                    
                                    
                                       (
                                       1
                                       −
                                       
                                          
                                             e
                                          
                                          
                                             −
                                             2
                                             β
                                             t
                                          
                                       
                                       )
                                    
                                    I
                                    →
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                       
                                          2
                                          β
                                       
                                    
                                    I
                                    
                                    
                                       as
                                    
                                    
                                    t
                                    →
                                    ∞
                                 
                              
                           
                         Note that 
                           
                              
                                 a
                              
                              
                                 t
                              
                           
                         approaches a normal stationary distribution 
                           
                              
                                 a
                              
                              
                                 t
                              
                           
                           ∼
                           N
                           (
                           
                              
                                 μ
                              
                              
                                 a
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 a
                              
                              
                                 2
                              
                           
                           /
                           2
                           β
                           I
                           )
                         as 
                           t
                           →
                           ∞
                        . For the dynamical estimation of ERPs, the component 
                           
                              
                                 μ
                              
                              
                                 a
                              
                           
                         can be used to capture the underlying static trend of the dynamics of 
                           
                              
                                 a
                              
                              
                                 t
                              
                           
                        , and thus provides an alignment for the ERPs which vary across trials.

We denote by 
                           
                              
                                 t
                              
                              
                                 n
                              
                           
                         the time point at which the n-th observation 
                           
                              
                                 y
                              
                              
                                 n
                              
                           
                         is sampled. Let 
                           Δ
                           t
                           =
                           
                              
                                 t
                              
                              
                                 n
                                 +
                                 1
                              
                           
                           −
                           
                              
                                 t
                              
                              
                                 n
                              
                           
                         be the time interval between two consecutive observations. Then, discretization of (7) gives [21]
                        
                           
                              (9)
                              
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                                 =
                                 
                                    
                                       a
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       β
                                       Δ
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       μ
                                    
                                    
                                       a
                                    
                                 
                                 
                                    (
                                    1
                                    −
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          β
                                          Δ
                                          t
                                       
                                    
                                    )
                                 
                                 +
                                 α
                                 
                                    
                                       ε
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       ε
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 ∼
                                 N
                                 
                                    (
                                    0
                                    ,
                                    
                                       
                                          σ
                                       
                                       
                                          a
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          M
                                       
                                    
                                    )
                                 
                              
                           
                         with 
                           α
                           =
                           
                              
                                 (
                                 1
                                 −
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       2
                                       β
                                       Δ
                                       t
                                    
                                 
                                 )
                                 /
                                 2
                                 β
                              
                           
                        . The transition density which follows directly from (9) is normal
                           
                              (10)
                              
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                                 |
                                 
                                    
                                       a
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                                 ∼
                                 N
                                 
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          β
                                          Δ
                                          t
                                       
                                    
                                    +
                                    
                                       
                                          μ
                                       
                                       
                                          a
                                       
                                    
                                    
                                       (
                                       1
                                       −
                                       
                                          
                                             e
                                          
                                          
                                             −
                                             β
                                             Δ
                                             t
                                          
                                       
                                       )
                                    
                                    ,
                                    
                                       
                                          σ
                                       
                                       
                                          a
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          α
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          M
                                       
                                    
                                    )
                                 
                              
                           
                        
                     

The dynamics of latency and width parameters can assume OU process as well with discretization
                           
                              (11)
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       β
                                       Δ
                                       t
                                    
                                 
                                 +
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    (
                                    1
                                    −
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          β
                                          Δ
                                          t
                                       
                                    
                                    )
                                 
                                 +
                                 α
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   ε
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ε
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   ε
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ε
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ∼
                                 N
                                 
                                    (
                                    
                                       [
                                       
                                          
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      b
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      c
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    )
                                 
                              
                           
                         which however is likely to generate negative values. To ensure their positivity, we use the CIR process which was originally proposed as a model for financial interest rate by [15]. Besides, the process has a non-Gaussian transition density ideally suited for both abrupt and gradual changes, which are unable to be captured by the Gaussian one in (10) whose variance can only be set either too small or too large. The latency 
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                        , similarly for 
                           
                              
                                 c
                              
                              
                                 n
                              
                           
                         is assumed to be generated from an M-dimensional mean-reverting CIR process, which has a linear drift term as the OU but with a square-root diffusion, specified by a non-linear SDE [21]
                        
                           
                              (12)
                              
                                 d
                                 
                                    
                                       b
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 β
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       b
                                    
                                 
                                 −
                                 
                                    
                                       b
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 d
                                 t
                                 +
                                 
                                    
                                       σ
                                    
                                    
                                       b
                                    
                                 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          t
                                       
                                    
                                 
                                 d
                                 
                                    
                                       W
                                    
                                    
                                       t
                                    
                                 
                              
                           
                         where β is the mean-reversion speed, 
                           
                              
                                 μ
                              
                              
                                 b
                              
                           
                         is the long-term mean and 
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                         is the volatility, similar to that of the OU process. However, the non-linear term 
                           
                              
                                 
                                    b
                                 
                                 
                                    t
                                 
                              
                           
                         suppresses the variance term to zero as 
                           
                              
                                 b
                              
                              
                                 t
                              
                           
                         approaches zero, preventing the process to become negative. The process also has a Gamma marginal density. Refer to [21] for the discretized model of the process.

Lets assume that elements of 
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                         are mutually independent. The discretized transition density for univariate case 
                           p
                           (
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                           |
                           
                              
                                 b
                              
                              
                                 n
                                 −
                                 1
                              
                           
                           )
                         can be easily obtained from its transform 
                           p
                           (
                           
                              
                                 s
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           |
                           
                              
                                 s
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                              
                           
                           )
                         where 
                           
                              
                                 s
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           =
                           2
                           c
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                         with 
                           c
                           =
                           2
                           β
                           /
                           (
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                           (
                           1
                           −
                           
                              
                                 e
                              
                              
                                 −
                                 β
                                 Δ
                                 t
                              
                           
                           )
                           )
                        . The transformed transition density 
                           p
                           (
                           
                              
                                 s
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           |
                           
                              
                                 s
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                              
                           
                           )
                         follows a noncentral chi-squared distribution with degree of freedom 
                           ν
                           =
                           4
                           
                              
                                 μ
                              
                              
                                 b
                              
                           
                           β
                           /
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                         and non-centrality parameter 
                           λ
                           =
                           
                              
                                 s
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                              
                           
                           
                              
                                 e
                              
                              
                                 −
                                 β
                                 Δ
                                 t
                              
                           
                        , 
                           
                              
                                 s
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           |
                           
                              
                                 s
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                              
                           
                           ∼
                           
                              
                                 χ
                              
                              
                                 v
                              
                              
                                 ′
                                 2
                              
                           
                           (
                           λ
                           )
                         
                        [20]. The noncentral 
                           
                              
                                 χ
                              
                              
                                 2
                              
                           
                         conditional density can predict the rare abrupt parameter changes to high values by its heavier right-tails as well as the smooth changes by its relatively narrow central region.

Use of continuous-time modeling offers several benefits over the discrete-time models both in theoretical and practical perspectives [6–9]. The rationale for using continuous-time models for natural data, as for the ERPs as an example, is founded on the assumption that the underlying dynamic system is continuous e.g. the physiological dynamics behind the single-trials. Analytically, differential-equation models are more easily handled than the difference models [6], owing to the stochastic calculus.

The practical advantage of continuous-time method is that it is well-suited for modeling variably or irregularly spaced data [8,9], due to its flexibility in defining inter-observation time Δt of any length consistently. The solution of a differential equation such as (7) which is based on the integral of the continuous variables yields a continuous sample path that can explain the dynamics for any time-intervals. The discrete-time observations can be seen as generated by the underlying continuous process.

The parameter space of the continuous-time models is more extensive and adjustable to capture the dynamics between varying observation intervals. However, the discrete-time model parameters are fixed and inflexible to account for possible changes in Δt. In fact, the discrete-time models are approximations to their continuous counterparts, where the parameters of a discrete model are discrete samples of those of the underlying continuous model [7]. For example, the OU process of (7) is a continuous-time analogue of the discrete-time AR(1) process in a recursive form. The discretized version of OU process in (9) taken at a particular regular interval of Δt forms an AR(1) process [22]. The OU process parameters, the mean-reversion coefficient 
                              
                                 
                                    e
                                 
                                 
                                    −
                                    β
                                    Δ
                                    t
                                 
                              
                            and noise variance scaling parameter α in (9) are time-varying according to Δt, instead of being fixed as in the ordinary discrete-time AR model [23]. As Δt increases, α becomes larger to predict parameter changes for larger region of uncertainty due to a longer period of dynamics. Thus, the parameters of the continuous models can be specified and analyzed independently of the observation intervals of the samples used for estimation [6–8]. A continuous model estimated or pre-defined for data with a particular sampling interval can be used to analyze data of any intervals consistently. This is in contrast with the fact that the discrete models once fitted to a specific sampling rate, are rigidly fixed and invalid for other sampling intervals. It requires re-estimation of the models for every different sampling interval. Therefore, the continuous-time models have this built-in capability to handle variable sampled data which is also present in the ERP estimation, where measurements are spaced variably at different intervals, which the discrete-time model fails to deal with.

The relatively static 
                           3
                           M
                           ×
                           1
                         trend components (
                           
                              
                                 μ
                              
                              
                                 a
                              
                           
                           ,
                           
                              
                                 μ
                              
                              
                                 b
                              
                           
                           ,
                           
                              
                                 μ
                              
                              
                                 c
                              
                           
                        ) are assumed to follow a stable dynamics by adding a small noise [24]. Here we consider random-walk models with i.i.d. Gaussian noise
                           
                              (13a)
                              
                                 
                                    
                                       μ
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       μ
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 ∼
                                 N
                                 
                                    (
                                    0
                                    ,
                                    
                                       
                                          σ
                                       
                                       
                                          
                                             
                                                u
                                             
                                             
                                                a
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          M
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                        
                           
                              (13b)
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                         −
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                         −
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 +
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ∼
                                 N
                                 
                                    (
                                    
                                       [
                                       
                                          
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            c
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    )
                                 
                                 .
                              
                           
                         For the noise component in (3), we allow the variance (squared volatility) to vary over trials i.e. 
                           
                              
                                 v
                              
                              
                                 n
                              
                           
                           ∼
                           N
                           (
                           0
                           ,
                           
                              
                                 R
                              
                              
                                 n
                              
                           
                           )
                         with 
                           
                              
                                 R
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                              
                              
                                 2
                              
                           
                           
                              
                                 I
                              
                              
                                 k
                              
                           
                         to better model the changing-volatility characteristics of real noise process in ERPs. However, we still assume the variance as locally stationary within a short-segment of single-trial (i.e. identical entries in the diagonal of 
                           
                              
                                 R
                              
                              
                                 n
                              
                           
                        ). We propose to use SV modeling for 
                           
                              
                                 v
                              
                              
                                 n
                              
                           
                         where the trial-varying 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                              
                              
                                 2
                              
                           
                         is modeled directly by a separate latent stochastic process, which we assume here as a Gaussian random-walk model
                           
                              (14)
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ϕ
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       ξ
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       n
                                    
                                 
                                 ∼
                                 N
                                 
                                    (
                                    0
                                    ,
                                    
                                       
                                          σ
                                       
                                       
                                          
                                             
                                                ϕ
                                             
                                             
                                                v
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                              
                           
                         where 
                           
                              
                                 ϕ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           
                              =
                              Δ
                           
                           log
                           ⁡
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                              
                              
                                 2
                              
                           
                         to ensure positivity of 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                              
                              
                                 2
                              
                           
                        .

The models are formulated in a discrete-time conditionally-linear Gaussian state-space form with observation and state equation respectively as
                           
                              (15)
                              
                                 
                                    
                                       y
                                    
                                    
                                       n
                                    
                                 
                                 =
                                 
                                    
                                       A
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 
                                    
                                       x
                                    
                                    
                                       n
                                    
                                 
                                 +
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                                 ∼
                                 N
                                 
                                    (
                                    0
                                    ,
                                    
                                       
                                          R
                                       
                                       
                                          n
                                       
                                    
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                       
                                    
                                    )
                                    )
                                 
                              
                           
                        
                        
                           
                              (16)
                              
                                 
                                    
                                       x
                                    
                                    
                                       n
                                    
                                 
                                 =
                                 B
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 
                                    
                                       x
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                                 +
                                 C
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 
                                    
                                       w
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       w
                                    
                                    
                                       n
                                    
                                 
                                 ∼
                                 N
                                 
                                    (
                                    0
                                    ,
                                    Q
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                       
                                    
                                    )
                                    )
                                 
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 ∼
                                 p
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                                 )
                              
                           
                         where 
                           
                              
                                 θ
                              
                              
                                 n
                              
                           
                         is a vector of unknown model parameters. It is assumed for the initial state 
                           
                              
                                 x
                              
                              
                                 0
                              
                           
                           ∼
                           N
                           (
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 0
                                 |
                                 0
                              
                           
                           (
                           
                              
                                 θ
                              
                              
                                 0
                              
                           
                           )
                           ,
                           
                              
                                 P
                              
                              
                                 0
                                 |
                                 0
                              
                           
                           (
                           
                              
                                 θ
                              
                              
                                 0
                              
                           
                           )
                           )
                        . Similar to [4], by defining a concatenated state vector 
                           
                              
                                 x
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ]
                              
                              
                                 T
                              
                           
                         with 
                           
                              
                                 μ
                              
                              
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       μ
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 (
                                 1
                                 )
                                 ,
                                 …
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 (
                                 M
                                 )
                                 ]
                              
                              
                                 T
                              
                           
                        , the observation model defined by (3) can be written in a compact linear Gaussian form of (15) where 
                           
                              
                                 A
                              
                              
                                 n
                              
                           
                         is a 
                           k
                           ×
                           2
                           M
                         system matrix denoted in terms of latency and width parameters
                           
                              
                                 
                                    
                                       A
                                    
                                    
                                       n
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   g
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             1
                                             )
                                             ,
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             1
                                             )
                                             )
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   g
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             M
                                             )
                                             ,
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             M
                                             )
                                             )
                                          
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                   ×
                                                   M
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   g
                                                
                                                
                                                   2
                                                
                                             
                                             (
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             1
                                             )
                                             ,
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             1
                                             )
                                             )
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   g
                                                
                                                
                                                   2
                                                
                                             
                                             (
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             M
                                             )
                                             ,
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             M
                                             )
                                             )
                                          
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                   ×
                                                   M
                                                
                                             
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             
                                                
                                                   g
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             1
                                             )
                                             ,
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             1
                                             )
                                             )
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   g
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             M
                                             )
                                             ,
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                
                                             
                                             (
                                             M
                                             )
                                             )
                                          
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                   ×
                                                   M
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                              
                           
                         with nonlinear terms 
                           
                              
                                 g
                              
                              
                                 k
                              
                           
                           (
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                           (
                           m
                           )
                           ,
                           
                              
                                 c
                              
                              
                                 n
                              
                           
                           (
                           m
                           )
                           )
                           =
                           
                              
                                 e
                              
                              
                                 −
                                 
                                    
                                       (
                                       k
                                       −
                                       
                                          
                                             b
                                          
                                          
                                             n
                                          
                                       
                                       (
                                       m
                                       )
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 /
                                 (
                                 2
                                 
                                    
                                       c
                                    
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 m
                                 )
                                 )
                              
                           
                        . The discretized linear Gaussian OU model of 
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                         
                        (9) and the model for its trend (13a) can be formulated in state equation (16) with 
                           2
                           M
                           ×
                           2
                           M
                         system matrices
                           
                              
                                 B
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   −
                                                   β
                                                   Δ
                                                   t
                                                
                                             
                                             
                                                
                                                   I
                                                
                                                
                                                   M
                                                
                                             
                                          
                                          
                                             (
                                             1
                                             −
                                             
                                                
                                                   e
                                                
                                                
                                                   −
                                                   β
                                                   Δ
                                                   t
                                                
                                             
                                             )
                                             I
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   I
                                                
                                                
                                                   M
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                                 
                                 C
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             α
                                             
                                                
                                                   I
                                                
                                                
                                                   M
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   I
                                                
                                                
                                                   M
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                              
                           
                         and 
                           2
                           M
                           ×
                           1
                         state noise
                           
                              
                                 
                                    
                                       w
                                    
                                    
                                       n
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   ε
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ∼
                                 N
                                 
                                    (
                                    
                                       [
                                       
                                          
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      a
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            a
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      M
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    )
                                 
                                 .
                              
                           
                         Note that to formulate the linear Gaussian observation equation (15) from the non-linear form of (4), 
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                         and (
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                           ,
                           
                              
                                 c
                              
                              
                                 n
                              
                           
                        ) are treated separately as state and model parameters. The trial-varying parameters of latency 
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                         and width 
                           
                              
                                 c
                              
                              
                                 n
                              
                           
                         in 
                           
                              
                                 A
                              
                              
                                 n
                              
                           
                        , their trends, and observation noise variance 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                              
                              
                                 2
                              
                           
                        , denoted here by 
                           
                              
                                 θ
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       b
                                    
                                    
                                       n
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       n
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       
                                          
                                             b
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       
                                          
                                             c
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ]
                              
                              
                                 T
                              
                           
                        , are assumed unknown and need to be estimated. The model parameters (
                           β
                           ,
                           
                              
                                 σ
                              
                              
                                 a
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       u
                                    
                                    
                                       a
                                    
                                 
                              
                              
                                 2
                              
                           
                        ) are assumed fixed and pre-specified.

For the estimation of the time-varying model parameters, we consider a Bayesian approach where 
                           
                              
                                 θ
                              
                              
                                 n
                              
                           
                         are augmented to the state vector 
                           
                              
                                 x
                              
                              
                                 n
                              
                           
                         as 
                           
                              
                                 z
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       n
                                    
                                    
                                       T
                                    
                                 
                                 ]
                              
                              
                                 T
                              
                           
                         with the joint posterior density 
                           p
                           (
                           
                              
                                 z
                              
                              
                                 1
                                 :
                                 n
                              
                           
                           |
                           
                              
                                 y
                              
                              
                                 1
                                 :
                                 n
                              
                           
                           )
                         estimated using standard PF methods, as in [18,4]. To formulate a state-space model for the augmented state 
                           
                              
                                 z
                              
                              
                                 n
                              
                           
                        , the models for the time-evolution of 
                           
                              
                                 θ
                              
                              
                                 n
                              
                           
                         
                        (17) are pre-specified, as already in (11)–(12) and (13b)–(14). The hyper-parameters of these processes (
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 c
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       u
                                    
                                    
                                       b
                                    
                                 
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       u
                                    
                                    
                                       c
                                    
                                 
                              
                              
                                 2
                              
                           
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       v
                                    
                                 
                              
                              
                                 2
                              
                           
                        )are assumed fixed and known. The initial state 
                           
                              
                                 θ
                              
                              
                                 0
                              
                           
                         is assumed to be distributed according to a density 
                           
                              
                                 p
                              
                              
                                 0
                              
                           
                           (
                           θ
                           )
                         which can be tailored by available prior information. Conditional on the non-linear CIR processes of 
                           
                              
                                 θ
                              
                              
                                 n
                              
                           
                        , (15)–(16) is a linear Gaussian state-space model.

The process of 
                           
                              
                                 θ
                              
                              
                                 n
                              
                           
                         
                        (17) together with the original state-space model (15)–(16) constitutes the complete augmented state-space model for 
                           
                              
                                 z
                              
                              
                                 n
                              
                           
                         with all parameters summarized in Table 1
                        . Thus, the proposed model is now fully specified. The objective is to estimate sequentially the parameters of the Gaussian ERP components for each trial n, and hence to uncover the de-noised ERP 
                           
                              
                                 
                                    
                                       y
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 n
                              
                           
                        .

Let denote 
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        =
                        {
                        
                           
                              y
                           
                           
                              1
                           
                        
                        ,
                        …
                        ,
                        
                           
                              y
                           
                           
                              n
                           
                        
                        }
                     . The inference problem here involves estimating sequentially in time the posterior density 
                        p
                        (
                        
                           
                              z
                           
                           
                              1
                              :
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                        
                           =
                           Δ
                        
                        p
                        (
                        
                           
                              x
                           
                           
                              1
                              :
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              1
                              :
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      where 
                        {
                        
                           
                              x
                           
                           
                              1
                              :
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              1
                              :
                              n
                           
                        
                        }
                      with 
                        
                           
                              x
                           
                           
                              1
                              :
                              n
                           
                        
                        =
                        {
                        
                           
                              x
                           
                           
                              1
                           
                        
                        ,
                        …
                        ,
                        
                           
                              x
                           
                           
                              n
                           
                        
                        }
                      and 
                        
                           
                              θ
                           
                           
                              1
                              :
                              n
                           
                        
                        =
                        {
                        
                           
                              θ
                           
                           
                              1
                           
                        
                        ,
                        …
                        ,
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        }
                      contains the underlying clean ERPs and model parameters. We focus on estimation of its marginal, filtered density 
                        p
                        (
                        
                           
                              z
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                        
                           =
                           Δ
                        
                        p
                        (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                     . Generic PF methods can be applied directly to estimate the joint density 
                        p
                        (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      
                     [18,24]. However, sampling from a high-dimensional density is inefficient due to large number of samples required for accurate approximation, which increases computational complexity. The aforementioned conditionally-linear Gaussian model structure can be utilized to facilitate the implementation of RBPF [25,26], a more efficient variant of PF. The algorithm is based on Rao–Blackwellization method where some of the state-space variables in linear Gaussian form, which is the 
                        
                           
                              x
                           
                           
                              n
                           
                        
                      here, can be marginalized out analytically to reduce the state-space dimension and hence the variance of the sampling estimates. This method has been used for online estimation of clean speech signals [27] and ERP subcomponents [4]. We follow the approach of these studies for the filtering of our model.

We describe here how to use the RBPF to estimate 
                        p
                        (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      in our model; refer to [25–27] and [4] for further details. We observe that
                        
                           (18)
                           
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              )
                              =
                              ∫
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              )
                              p
                              (
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              )
                              d
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                           
                        
                      where 
                        p
                        (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        |
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        ,
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                        ∼
                        N
                        (
                        
                           
                              
                                 
                                    x
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              n
                              |
                              n
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        )
                        ,
                        
                           
                              P
                           
                           
                              n
                              |
                              n
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        )
                        )
                      in which 
                        {
                        
                           
                              
                                 
                                    x
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              n
                              |
                              n
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        )
                        ,
                        
                           
                              P
                           
                           
                              n
                              |
                              n
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        )
                        }
                      can be computed analytically by the KF. Then, estimating 
                        p
                        (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      only needs to sample from a lower dimensional 
                        p
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                     . If we obtain by PF, an approximation of 
                        p
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                     
                     
                        
                           (19)
                           
                              
                                 
                                    p
                                 
                                 
                                    ˆ
                                 
                              
                              (
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              )
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    W
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              
                                 
                                    δ
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                 
                              
                              (
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              )
                              ,
                              
                              
                                 
                                    W
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              /
                              
                                 ∑
                                 
                                    j
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    j
                                    )
                                 
                              
                           
                        
                      where 
                        
                           
                              W
                           
                           
                              t
                           
                           
                              (
                              i
                              )
                           
                        
                      and 
                        
                           
                              
                                 
                                    w
                                 
                                 
                                    ˜
                                 
                              
                           
                           
                              t
                           
                           
                              (
                              i
                              )
                           
                        
                      are the normalized and un-normalized weights associated with samples 
                        
                           
                              θ
                           
                           
                              n
                           
                           
                              (
                              i
                              )
                           
                        
                     . Then, 
                        p
                        (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      can be approximated as a mixture of Gaussian distributions
                        
                           (20)
                           
                              
                                 
                                    p
                                 
                                 
                                    ˆ
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              )
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    W
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              N
                              
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       n
                                    
                                 
                                 ;
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       n
                                       |
                                       n
                                    
                                 
                                 
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    )
                                 
                                 ,
                                 
                                    
                                       P
                                    
                                    
                                       n
                                       |
                                       n
                                    
                                 
                                 
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    )
                                 
                                 )
                              
                           
                        
                     
                  

To obtain estimates (19) sequentially, we use sequential importance sampling (SIS) algorithm [25,28], where 
                        
                           
                              θ
                           
                           
                              n
                           
                           
                              (
                              i
                              )
                           
                        
                      are sampled recursively from some importance function 
                        π
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              θ
                           
                           
                              n
                              −
                              1
                           
                        
                        ,
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      given 
                        
                           
                              θ
                           
                           
                              n
                              −
                              1
                           
                           
                              (
                              i
                              )
                           
                        
                     , with associated weights updated recursively to [27]
                     
                        
                           (21)
                           
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 
                                    n
                                    −
                                    1
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              
                                 
                                    p
                                    (
                                    
                                       
                                          y
                                       
                                       
                                          n
                                       
                                    
                                    |
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          1
                                          :
                                          n
                                          −
                                          1
                                       
                                    
                                    )
                                    p
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    |
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    )
                                 
                                 
                                    π
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    |
                                    
                                       
                                          θ
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          n
                                       
                                    
                                    )
                                 
                              
                              .
                           
                        
                      Prior importance function 
                        π
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              θ
                           
                           
                              n
                              −
                              1
                           
                        
                        ,
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                        =
                        p
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              θ
                           
                           
                              n
                              −
                              1
                           
                        
                        )
                      is used here with weights 
                        
                           
                              
                                 
                                    w
                                 
                                 
                                    ˜
                                 
                              
                           
                           
                              n
                           
                           
                              (
                              i
                              )
                           
                        
                        =
                        
                           
                              
                                 
                                    w
                                 
                                 
                                    ˜
                                 
                              
                           
                           
                              n
                              −
                              1
                           
                           
                              (
                              i
                              )
                           
                        
                        p
                        (
                        
                           
                              y
                           
                           
                              n
                           
                        
                        |
                        
                           
                              θ
                           
                           
                              n
                           
                           
                              (
                              i
                              )
                           
                        
                        ,
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                              −
                              1
                           
                        
                        )
                     . To overcome weight degeneracy problem, re-sampling step [28] is applied when the effective sample size is less than a specified threshold 
                        
                           ESS
                        
                        =
                        
                           
                              (
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    N
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          W
                                       
                                       
                                          t
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    )
                                 
                                 
                                    2
                                 
                              
                              )
                           
                           
                              −
                              1
                           
                        
                        <
                        
                           
                              N
                           
                           
                              T
                           
                        
                     .

Sampling from conditional density 
                        p
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              θ
                           
                           
                              n
                              −
                              1
                           
                        
                        )
                      of our model is performed hierarchically according to
                        
                           
                              
                                 
                                    ϕ
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          n
                                       
                                    
                                 
                              
                              |
                              
                                 
                                    ϕ
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                 
                              
                              ∼
                              N
                              
                                 (
                                 
                                    
                                       ϕ
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             v
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                              ,
                           
                        
                     
                     
                        
                           
                              (
                              
                                 
                                    μ
                                 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          n
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    μ
                                 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          n
                                       
                                    
                                 
                              
                              )
                              |
                              (
                              
                                 
                                    μ
                                 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    μ
                                 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                 
                              
                              )
                              ∼
                              N
                              
                                 (
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                         −
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                         −
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   σ
                                                
                                                
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         b
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   I
                                                
                                                
                                                   M
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   σ
                                                
                                                
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   I
                                                
                                                
                                                   M
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 )
                              
                           
                        
                      and
                        
                           
                              (
                              
                                 
                                    b
                                 
                                 
                                    n
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    n
                                 
                              
                              )
                              |
                              (
                              
                                 
                                    b
                                 
                                 
                                    n
                                    −
                                    1
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    n
                                    −
                                    1
                                 
                              
                              )
                              ∼
                              N
                              
                                 (
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       β
                                       Δ
                                       t
                                    
                                 
                                 +
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    (
                                    1
                                    −
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          β
                                          Δ
                                          t
                                       
                                    
                                    )
                                 
                                 ,
                                 
                                 
                                    
                                       α
                                    
                                    
                                       2
                                    
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   σ
                                                
                                                
                                                   b
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   I
                                                
                                                
                                                   M
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   σ
                                                
                                                
                                                   c
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   I
                                                
                                                
                                                   M
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 )
                              
                              ,
                           
                        
                      for the OU model or for the CIR model through its transform
                        
                           (22)
                           
                              
                                 
                                    s
                                 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          n
                                       
                                    
                                 
                              
                              |
                              
                                 
                                    s
                                 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                 
                              
                              ∼
                              
                                 
                                    χ
                                 
                                 
                                    4
                                    
                                       
                                          μ
                                       
                                       
                                          b
                                       
                                    
                                    β
                                    /
                                    
                                       
                                          σ
                                       
                                       
                                          b
                                       
                                       
                                          ′
                                          2
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             b
                                          
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       β
                                       Δ
                                       t
                                    
                                 
                                 )
                              
                              ,
                              
                              
                                 
                                    s
                                 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          n
                                       
                                    
                                 
                              
                              |
                              
                                 
                                    s
                                 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                 
                              
                              ∼
                              
                                 
                                    χ
                                 
                                 
                                    4
                                    
                                       
                                          μ
                                       
                                       
                                          c
                                       
                                    
                                    β
                                    /
                                    
                                       
                                          σ
                                       
                                       
                                          c
                                       
                                       
                                          ′
                                          2
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             c
                                          
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       β
                                       Δ
                                       t
                                    
                                 
                                 )
                              
                           
                        
                      for each dimension based on independence assumption. Let
                        
                           (23)
                           
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              )
                              =
                              N
                              
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       n
                                    
                                 
                                 ;
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       n
                                       |
                                       n
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       P
                                    
                                    
                                       n
                                       |
                                       n
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 )
                              
                              ,
                              
                              p
                              (
                              
                                 
                                    x
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                    −
                                    1
                                 
                              
                              )
                              =
                              N
                              
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       n
                                    
                                 
                                 ;
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       n
                                       |
                                       n
                                       −
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       P
                                    
                                    
                                       n
                                       |
                                       n
                                       −
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 )
                              
                              
                              and
                              
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                    −
                                    1
                                 
                              
                              )
                              =
                              N
                              
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       n
                                    
                                 
                                 ;
                                 
                                    
                                       y
                                    
                                    
                                       n
                                       |
                                       n
                                       −
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       S
                                    
                                    
                                       n
                                       |
                                       n
                                       −
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                 
                                 )
                                 )
                              
                           
                        
                      denote respectively filtering, one-step ahead prediction, and predictive densities conditional on 
                        
                           
                              θ
                           
                           
                              n
                           
                        
                     , which are estimated by KF. For notational convenience, we write 
                        
                           
                              
                                 
                                    x
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              n
                              |
                              n
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        )
                        =
                        
                           
                              
                                 
                                    x
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              n
                              |
                              n
                           
                        
                     , 
                        
                           
                              P
                           
                           
                              n
                              |
                              n
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        )
                        =
                        
                           
                              P
                           
                           
                              n
                              |
                              n
                           
                        
                      and similarly for other terms. The RBPF used in this paper to estimate 
                        p
                        (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      is summarized in Algorithm 1
                     . The algorithm requires N recursions of KF at each iteration. Instead of computing N ‘full’ KF recursions, we calculate only once 
                        
                           
                              P
                           
                           
                              n
                              |
                              n
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                           
                              (
                              i
                              )
                           
                        
                        )
                        =
                        
                           
                              P
                           
                           
                              n
                              |
                              n
                           
                        
                      and 
                        
                           
                              P
                           
                           
                              n
                              |
                              n
                              −
                              1
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                           
                              (
                              i
                              )
                           
                        
                        )
                        =
                        
                           
                              P
                           
                           
                              n
                              |
                              n
                              −
                              1
                           
                        
                      for 
                        i
                        =
                        1
                        ,
                        …
                        ,
                        N
                     , as observed in [29].

The mean of the filtered joint density 
                        E
                        [
                        
                           
                              x
                           
                           
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        ]
                      is the optimal estimator of (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        ,
                        
                           
                              θ
                           
                           
                              n
                           
                        
                     ). Given respective approximations in (19) and (20), the means of the marginal densities 
                        p
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      and 
                        p
                        (
                        
                           
                              x
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                        )
                      can be approximated
                        
                           (24)
                           
                              E
                              [
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              ]
                              ≈
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    W
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                        
                      and
                        
                           (25)
                           
                              E
                              [
                              
                                 
                                    x
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              ]
                              ≈
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    W
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              E
                              
                                 [
                                 
                                    
                                       
                                          x
                                       
                                       
                                          n
                                       
                                    
                                    |
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       n
                                    
                                 
                                 ]
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    W
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    n
                                    |
                                    n
                                 
                              
                              
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                                 )
                              
                              .
                           
                        
                     
                  

The marginal likelihood of 
                        
                           
                              y
                           
                           
                              1
                              :
                              J
                           
                        
                      is given as [24]
                     
                        
                           (26)
                           
                              ℓ
                              (
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    J
                                 
                              
                              |
                              λ
                              )
                              =
                              
                                 ∏
                                 
                                    n
                                    =
                                    1
                                 
                                 J
                              
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                    −
                                    1
                                 
                              
                              )
                           
                        
                      where, given approximation of the one-step ahead prediction 
                        
                           
                              p
                           
                           
                              ˆ
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        |
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                              −
                              1
                           
                        
                        )
                        =
                        
                           
                              ∑
                           
                           
                              i
                              =
                              1
                           
                           
                              N
                           
                        
                        
                           
                              W
                           
                           
                              n
                              −
                              1
                           
                           
                              (
                              i
                              )
                           
                        
                        
                           
                              δ
                           
                           
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                        
                        (
                        
                           
                              θ
                           
                           
                              n
                           
                        
                        )
                      
                     [25], the predictive likelihood can be estimated by
                        
                           (27)
                           
                              
                                 
                                    p
                                 
                                 
                                    ˆ
                                 
                              
                              (
                              
                                 
                                    y
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                    −
                                    1
                                 
                              
                              )
                              =
                              ∫
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                    −
                                    1
                                 
                              
                              )
                              p
                              (
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                    −
                                    1
                                 
                              
                              )
                              d
                              
                                 
                                    θ
                                 
                                 
                                    n
                                 
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    W
                                 
                                 
                                    n
                                    −
                                    1
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                              p
                              
                                 (
                                 
                                    
                                       
                                          y
                                       
                                       
                                          n
                                       
                                    
                                    |
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       n
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       :
                                       n
                                       −
                                       1
                                    
                                 
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 
                                    n
                                 
                                 
                                    (
                                    i
                                    )
                                 
                              
                           
                        
                     
                  

@&#EXPERIMENTAL RESULTS@&#

In this section, we evaluate the performance of the proposed method in tracking the dynamic changes of ERP parameters and in estimating the single-trials on a simulated and a real data set. We focus on a particular kind of ERPs i.e. the ABRs which comprise the early portion of auditory evoked potentials elicited by acoustic stimulus to the ear. ABR is composed of several waves or peaks labeled with roman numerals I–VII. This paper focuses on the study of waves III and V which are major peaks generated from auditory regions in caudal and rostral brainstem respectively. The ABR waveform characteristics such as the peak latencies and amplitudes provide useful information for objective assessment of hearing loss as well as pathologies affecting auditory brainstem pathways. Refer to [30] for further details. The ABR vary across trials, different subjects and stimulus intensities [31]. We focus on estimating the single-trial variability of ABRs and identifying the absence or presence of the wave V for objective diagnosis of hearing loss. We study the chirp-evoked ABRs which can induce stronger wave V [32].

We compare the performance of PO diffusion ERP models with OU and CIR latency process in estimating single-trial ABRs on a simulated data. The simulation analysis adopted here is based on [1] and [4]. Major waves III and V of ABR are simulated, sufficiently by using three Gaussian mixture components 
                           M
                           =
                           3
                         in model (4). The amplitude, latency and width parameters of the Gaussian components are set to 
                           a
                           =
                           
                              
                                 [
                                 0.65
                                 ,
                                 −
                                 0.4
                                 ,
                                 1
                                 ]
                              
                              
                                 T
                              
                           
                           ,
                           b
                           =
                           
                              
                                 [
                                 50
                                 ,
                                 120
                                 ,
                                 200
                                 ]
                              
                              
                                 T
                              
                           
                         and 
                           c
                           =
                           
                              
                                 [
                                 30
                                 ,
                                 30
                                 ,
                                 50
                                 ]
                              
                              
                                 T
                              
                           
                         samples respectively, which serve as constant baselines for the dynamic variations simulated as the following. The trial-to-trial variability of ABRs is simulated by artificially varying over trials their subcomponent parameters. To simulate abrupt parameter changes, the dynamic variations of amplitudes and latencies for the first two components are set to follow i.i.d. noises distributed respectively as 
                           U
                           [
                           −
                           0.2
                           ,
                           0.2
                           ]
                         and 
                           U
                           [
                           −
                           5
                           ,
                           5
                           ]
                        . 
                           U
                           [
                           a
                           ,
                           b
                           ]
                         denotes uniform distribution over interval [
                           a
                           ,
                           b
                        ]. To further illustrate the benefit of CIR models, we add a burst signal of magnitude 20 to the latency parameters, which exhibits more prominent abrupt transitions at both ends. To simulate the smooth changes, the amplitude and latency variations for the third component are represented as sinusoidal functions with respective magnitudes of 1 and 5 samples, plus uniformly distributed i.i.d. noise with smaller interval. In this simulation, the width parameters are assumed fixed with time and not estimated. The simulated clean ERPs constructed from the trial-varying parameters are artificially added with Gaussian white noise 
                           
                              
                                 v
                              
                              
                                 n
                              
                           
                           ∼
                           N
                           (
                           0
                           ,
                           
                              
                                 σ
                              
                              
                                 v
                              
                              
                                 2
                              
                           
                           I
                           )
                         with the log-variance modeled as in (14) with parameters 
                           
                              
                                 ϕ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       0
                                    
                                 
                              
                           
                           =
                           −
                           2.5
                         and 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       v
                                    
                                 
                              
                              
                                 2
                              
                           
                           =
                           5
                           ×
                           
                              
                                 10
                              
                              
                                 −
                                 4
                              
                           
                        , to generate noisy observations. Note that we use the nonlinear term 
                           
                              
                                 e
                              
                              
                                 −
                                 
                                    
                                       (
                                       t
                                       −
                                       
                                          
                                             b
                                          
                                          
                                             n
                                          
                                       
                                       (
                                       m
                                       )
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 /
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 m
                                 )
                                 )
                              
                           
                         in (4) as in [4] for this simulation.

The estimators of the ‘true’ ERP parameters, trend components and observation noise variance are obtained simultaneously from the mean of the filtering distribution of 
                           
                              
                                 z
                              
                              
                                 n
                              
                           
                         estimated by the RBPF. The estimated ERP parameters are then used to reconstruct the clean ERPs. The choice of model parameters Θ determines the performance of the estimators, which can be measured in term of estimation error from the true values. The behaviors of the ERP parameter estimators are determined by the noise variances of the diffusion processes (
                           
                              
                                 σ
                              
                              
                                 a
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 c
                              
                              
                                 2
                              
                           
                        ). Generally, larger values allow larger prediction to capture abrupt changes while small values enable to follow the smooth one. In this simulation, these parameters are set empirically to give sufficiently good estimates that are able to detect satisfactorily abrupt changes while with less noisy estimates for the smooth changes, which are measured by the mean square error (MSE) of the parameter estimates and guided by visual inspection. The average MSE of the parameter estimates for each ERP subcomponent is defined by
                           
                              (28)
                              
                                 
                                    MSE
                                 
                                 (
                                 m
                                 )
                                 =
                                 
                                    1
                                    
                                       R
                                       J
                                    
                                 
                                 
                                    ∑
                                    
                                       r
                                       =
                                       1
                                    
                                    R
                                 
                                 
                                    ∑
                                    
                                       n
                                       =
                                       1
                                    
                                    J
                                 
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             n
                                          
                                          
                                             r
                                          
                                       
                                       (
                                       m
                                       )
                                       −
                                       
                                          
                                             a
                                          
                                          
                                             n
                                          
                                       
                                       (
                                       m
                                       )
                                       )
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where 
                           
                              
                                 
                                    
                                       a
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 n
                              
                              
                                 r
                              
                           
                           (
                           m
                           )
                         is the estimator for a parameter of subcomponent m at trial 
                           n
                           
                           E
                           [
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                           (
                           m
                           )
                           |
                           
                              
                                 y
                              
                              
                                 1
                                 :
                                 n
                              
                           
                           ]
                         for replication r and 
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                           (
                           m
                           )
                         is the true value.


                        Table 2
                         shows the effect of the choice of the process variance 
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                         on MSEs for the OU and CIR modeling of latency parameters. The results for the latency parameters of the second and third Gaussian components (abrupt and smooth changes) are presented. Generally, for the second component, there is a steady improvement in MSE as 
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                         increases to capture faster the abrupt changes, until a point where further increase results in performance drops for the third component, probably due to spurious estimates on the smooth changes. We suggest 
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                           =
                           70
                         for the OU model and 
                           
                              
                                 σ
                              
                              
                                 b
                              
                           
                           =
                           1.15
                         for the CIR model as a compromise to satisfactorily detect both type of changes.

The initial distributions are assumed as 
                           
                              
                                 x
                              
                              
                                 0
                              
                           
                           ∼
                           N
                           (
                           0
                           ,
                           2
                           I
                           )
                         and 
                           
                              
                                 b
                              
                              
                                 0
                              
                           
                           =
                           
                              
                                 μ
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       0
                                    
                                 
                              
                           
                           ∼
                           N
                           (
                           
                              
                                 [
                                 50
                                 ,
                                 120
                                 ,
                                 200
                                 ]
                              
                              
                                 T
                              
                           
                           ,
                           5
                           
                              
                                 I
                              
                              
                                 M
                              
                           
                           )
                        . For the amplitude parameters, the variance of the OU model is set to 
                           
                              
                                 σ
                              
                              
                                 a
                              
                              
                                 2
                              
                           
                           =
                           10
                        . For the latency parameters, the process variances of the OU and CIR models are set respectively as 
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                           =
                           70
                         and 
                           
                              
                                 σ
                              
                              
                                 b
                              
                           
                           =
                           1.15
                        . Tuning of 
                           
                              
                                 σ
                              
                              
                                 u
                              
                              
                                 2
                              
                           
                         and 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       v
                                    
                                 
                              
                              
                                 2
                              
                           
                         which are only hyper-parameters for Bayesian estimation is less critical. For the random-walk models for the trend components, small noise variances 
                           (
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       u
                                    
                                    
                                       a
                                    
                                 
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       u
                                    
                                    
                                       b
                                    
                                 
                              
                              
                                 2
                              
                           
                           )
                           =
                           (
                           1
                           ×
                           
                              
                                 10
                              
                              
                                 −
                                 3
                              
                           
                           ,
                           1
                           ×
                           
                              
                                 10
                              
                              
                                 −
                                 3
                              
                           
                           )
                         are used to maintain the stability of 
                           μ
                        . All diffusion processes are discretized at interval 
                           Δ
                           t
                           =
                           1
                         and 
                           β
                           =
                           1
                         is set. We assume 
                           
                              
                                 ϕ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       0
                                    
                                 
                              
                           
                           ∼
                           U
                           [
                           −
                           2.5
                           ,
                           0
                           ]
                         and 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       v
                                    
                                 
                              
                              
                                 2
                              
                           
                           =
                           5
                           ×
                           
                              
                                 10
                              
                              
                                 −
                                 4
                              
                           
                         for the model of 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                              
                              
                                 2
                              
                           
                        . Number of particles 
                           N
                           =
                           1000
                         and re-sampling threshold 
                           
                              
                                 N
                              
                              
                                 T
                              
                           
                           =
                           N
                           /
                           4
                         are used throughout this paper.


                        Fig. 1
                         shows the ABR estimation results for one realization of simulation. The results are obtained by averaging over 10 independent replications of RBPF. The tracking of ABR subcomponent parameters and their trend components using the OU and CIR models of latency is shown in Fig. 1(a). Both models are able to track reasonably well the dynamic variability including abrupt and smooth changes in both amplitude and latency parameters, with higher accuracy observed for the amplitudes. Larger deviation from the true values can be seen for the latency estimates. The reason is that the estimator of latency 
                           E
                           [
                           
                              
                                 b
                              
                              
                                 n
                              
                           
                           |
                           
                              
                                 y
                              
                              
                                 1
                                 :
                                 n
                              
                           
                           ]
                         is approximated from simulation by PF and thus suffers estimation variance, in contrast to the amplitude estimates which are computed exactly by KF separately in the RBPF.

For the latency parameters with more abrupt changes, the use of non-linear CIR model exhibits faster tracking over the Gaussian OU model which suffers tracking lag. The Gaussian transition density of OU model performs better in tracking the smooth changes, however, cannot capture the abrupt ones. It can be seen that the CIR model estimates more accurately resemble the true values especially for the second component, as evident by the better tracking of the abrupt random fluctuations and the faster capturing of the sudden jumps at step transitions. This is due to its heavy-tailed transition density which can allow larger deviation to predict rare abrupt changes. It induces slightly noisier estimates on the smoothly changing sinusoid, which is however still acceptable. Fig. 1(a) also shows that the stationary trends for both parameters are estimated comparably well by both models. The estimates of the static trends are not affected by the abrupt step transitions. We can see that the estimated trends take the initial 15 trials of “burn in” period to converge from initial estimates to the constant actual values. Faster convergence is seen for the latency trends since their true values are assumed known a priori and are incorporated in the mean of initial distribution of 
                           
                              
                                 μ
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       0
                                    
                                 
                              
                           
                        .


                        Figs. 1(b) and 1(c) show the simulated noiseless ABRs and their noisy observations respectively. Fig. 1(d) shows the clean ABRs reconstructed from the parameters estimated by the CIR-latency model in Fig. 1(a). The simulated noise is clearly removed. Moreover, it can be seen that the underlying original ABR dynamics in Fig. 1(b) are accurately estimated, including the abrupt structural right-shift of the second component between the trials 40 and 60. The estimated trend is shown in Fig. 1(e). The underlying ABR trend is well estimated with the inter-trial variability obviously removed. A global waveform morphology is clearly revealed where each subcomponent is more easy to localize without being obscured by the inter-trial variability. The OU-latency model gives similar results which are hard to differentiate with the CIR by naked eye, except showing a more gradual transient during the shift. Fig. 2
                         shows the estimated 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       n
                                    
                                 
                              
                              
                                 2
                              
                           
                         by the CIR-latency model, which closely resemble the true volatilities of the simulated noise.

While MSE is used for the parameter tracking performance, the signal-to-noise ratio (SNR) is used as objective evaluation for the denoising of ERPs. The SNR for single-trial ERPs is defined as follows [33]
                        
                           
                              (29)
                              
                                 
                                    SNR
                                 
                                 =
                                 10
                                 
                                    
                                       log
                                    
                                    
                                       10
                                    
                                 
                                 ⁡
                                 
                                    
                                       σ
                                    
                                    
                                       S
                                    
                                    
                                       2
                                    
                                 
                                 /
                                 
                                    
                                       σ
                                    
                                    
                                       N
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where 
                           
                              
                                 σ
                              
                              
                                 N
                              
                              
                                 2
                              
                           
                         and 
                           
                              
                                 σ
                              
                              
                                 S
                              
                              
                                 2
                              
                           
                         are the noise and signal power estimated using averages over trials respectively as
                           
                              (30)
                              
                                 
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          N
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       1
                                       
                                          K
                                          (
                                          J
                                          −
                                          1
                                          )
                                       
                                    
                                    
                                       ∑
                                       
                                          n
                                          =
                                          1
                                       
                                       J
                                    
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       K
                                    
                                    
                                       
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                n
                                             
                                          
                                          (
                                          k
                                          )
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ¯
                                             
                                          
                                          (
                                          k
                                          )
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          S
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       1
                                       K
                                    
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       K
                                    
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    
                                       
                                          (
                                          k
                                          )
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   σ
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             N
                                          
                                          
                                             2
                                          
                                       
                                       /
                                       J
                                       )
                                    
                                 
                              
                           
                         where 
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                           (
                           k
                           )
                           =
                           (
                           1
                           /
                           J
                           )
                           
                              
                                 ∑
                              
                              
                                 n
                                 =
                                 1
                              
                              
                                 J
                              
                           
                           
                              
                                 y
                              
                              
                                 n
                              
                           
                           (
                           k
                           )
                         is the ensemble average. J and K are numbers of single-trial observations and measurement samples respectively.


                        Table 3
                         presents the evaluation results for the discretized continuous-time diffusion models with OU and CIR-latency processes with the discrete-time random-walk model (5) of [4] as baseline for comparison. For the random-walk model, we set the Gaussian state noise variances in (5) as 
                           (
                           
                              
                                 σ
                              
                              
                                 a
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 b
                              
                              
                                 2
                              
                           
                           )
                           =
                           (
                           5
                           ,
                           30
                           )
                         corresponding to that of the diffusion models and assume a constant observational noise variance fixed to 
                           log
                           ⁡
                           
                              
                                 σ
                              
                              
                                 v
                              
                              
                                 2
                              
                           
                           =
                           −
                           2.5
                        . It can be seen that both diffusion models, especially the CIR model, clearly outperform the discrete-time random-walk, as evident from significant reduction in MSE for both parameters of all components and improvement in SNR of the denoised single-trials. Lower MSEs are observed for the amplitude parameters compared to the latencies, suggesting more accurate estimation by the analytical KF. For the amplitudes, both models perform comparably with improvement by the CIR model for the last two Gaussian components. For the latencies, use of CIR model significantly outperforms the OU model in estimating abrupt changes, giving relative MSE reduction of 16.1% and 36.2% for the first and second components respectively, with only slightly poorer performance for the smooth changes in the third. This is consistent with the results shown in Fig. 1(a). The removal of simulated noise by both models yields substantial SNR improvements over the noisy ABR baseline with further gain for the trend estimates. Note that the SNR measure used here is ideal for evaluating the removal of observation noise but not the estimation of inter-trial variability which is treated indiscriminatively as noise, hence giving artificially low SNR. However, it is still applicable to the trend where this variability needs to be removed.

This section presents the evaluation of the proposed continuous-time diffusive ERP model for estimating real chirp-evoked single-trial ABRs. The data are obtained following the procedure in [32]. The chirp waveforms were computed for different intensity levels of sound pressure level (SPL) unit. Each stimulus was then calibrated by first calculating its peak-equivalent (pe) SPL, which was then measured by a sound level meter, via a microphone connected to an artificial ear. The artificial ear was simultaneously coupled to the headphones while producing the reference sinusoidal wave used to calculate the peSPL [31]. The ABRs were elicited by the chirps, presented at rate of 20 Hz through a headphone to the subjects. Single-trial ABRs from different subjects, under normal and pathological conditions with different stimulus intensities are studied, i.e. two subjects with normal hearing (60 dB and 50 dB SPL respectively) and a pathological subject with hearing impairment (60 dB SPL). The potentials were recorded using passive electrodes placed at positions A1, A2, Cz and the ground Fpz, at sampling frequency of 19.2 kHz. 2000 single-trials of ABR were obtained. The data was band-pass filtered with cutoffs 0.1 and 1.5 kHz and down-sampled to 14.4 kHz. We use only the first 500 trials segmented to fixed time frame where the waves III and V are located, which are further smoothed by moving–averaging every 10 trials.

As in the simulation, we use 
                           M
                           =
                           3
                         which is sufficient to model the major waves III and V. Model selection based on fitting Gaussian mixture curves with M varied from 1 to 6 to the segment of mean-ABR of subject 1 that contains waves III and V, also suggests 
                           M
                           =
                           3
                         with minimum root-MSE of 0.3154. For the parameter setting for the diffusion processes of ERP parameters, we assume initial distributions 
                           
                              
                                 x
                              
                              
                                 0
                              
                           
                           ∼
                           N
                           (
                           0
                           ,
                           2
                           I
                           )
                           ,
                           
                              
                                 b
                              
                              
                                 0
                              
                           
                           =
                           
                              
                                 μ
                              
                              
                                 
                                    
                                       b
                                    
                                    
                                       0
                                    
                                 
                              
                           
                           ∼
                           N
                           (
                           
                              
                                 [
                                 95
                                 ,
                                 135
                                 ,
                                 200
                                 ]
                              
                              
                                 T
                              
                           
                           ,
                           5
                           
                              
                                 I
                              
                              
                                 M
                              
                           
                           )
                         and 
                           
                              
                                 c
                              
                              
                                 0
                              
                           
                           =
                           
                              
                                 μ
                              
                              
                                 
                                    
                                       c
                                    
                                    
                                       0
                                    
                                 
                              
                           
                           ∼
                           N
                           (
                           
                              
                                 [
                                 20
                                 ,
                                 20
                                 ,
                                 20
                                 ]
                              
                              
                                 T
                              
                           
                           ,
                           5
                           
                              
                                 I
                              
                              
                                 M
                              
                           
                           )
                        , based on minimum prior information from the mean-ABR obtained by ensemble averaging and let the estimates adjust on their own towards the true values. Note that the units used for the latency and width parameters are in sample index. We set 
                           Δ
                           t
                           =
                           0.4
                            
                           s
                        , duration of 10 trials for time interval between two average-trials and 
                           β
                           =
                           1
                         for all diffusion processes. The noise variances of the CIR process for the widths are selected as 
                           
                              
                                 σ
                              
                              
                                 c
                              
                           
                           =
                           1.3
                        . The choice for noise variances of the OU amplitude process and CIR latency process will be further discussed in the next section. The noise variances of the trend models are fixed to 
                           (
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       u
                                    
                                    
                                       a
                                    
                                 
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       u
                                    
                                    
                                       b
                                    
                                 
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       u
                                    
                                    
                                       c
                                    
                                 
                              
                              
                                 2
                              
                           
                           )
                           =
                           (
                           1
                           ×
                           
                              
                                 10
                              
                              
                                 −
                                 5
                              
                           
                           ,
                           2.5
                           ,
                           0.025
                           )
                        . For the observational noise volatility process, we use 
                           
                              
                                 ϕ
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       0
                                    
                                 
                              
                           
                           ∼
                           U
                           [
                           0
                           ,
                           1.5
                           ]
                         and 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       v
                                    
                                 
                              
                              
                                 2
                              
                           
                           =
                           2.5
                           ×
                           
                              
                                 10
                              
                              
                                 −
                                 4
                              
                           
                        .

In this section, we shall investigate how the different choices of user-defined model parameters may affect the ERP estimation performance on real data, to provide a heuristic guideline for determining them in practice. We focus on the selection of the noise variances of the diffusive processes due to the sensitivity of the ERP parameter estimators to their variations, particularly those of the amplitude and latency processes i.e. 
                              
                                 
                                    σ
                                 
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                            and 
                              
                                 
                                    σ
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                           , which provide clinically more significant information on the hearing condition, compared to the widths. The selection for the noise variances of the static trend component models is also not as critical, as long as they are set sufficiently small to yield stable estimates, as suggested in [24]. The estimation performance can be assessed indirectly by the denoising performance in SNR or the model likelihood given the parameters which, however, still unable to precisely quantify the correctness of the estimators themselves on the real data where the ground-truth values are unknown. The parameter set that maximizes the likelihood and SNR is ideally considered as optimal and to be chosen. We use a parameter selection approach based on discrete grid search to determine the optimal parameters, based on these two criterions.


                           Table 4
                            shows the log-likelihoods and SNR performance for different combinations of 
                              
                                 
                                    σ
                                 
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                            and 
                              
                                 
                                    σ
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                            on the ABR data of the subject 1 with normal hearing. When 
                              
                                 
                                    σ
                                 
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                            and 
                              
                                 
                                    σ
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                            increase, the log-likelihoods increase implying a better fit to the data, however, the SNR of the denoised ABRs decreases indicating the presence of high level of noise. Thus, obtaining a parameter set that optimizes both criterions at the same time seems not possible, since it is mutually exclusive.


                           Fig. 3
                            and Fig. 4
                            show respectively the effect of varying 
                              
                                 
                                    σ
                                 
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                            with fixed 
                              
                                 
                                    σ
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                            on the amplitude estimators and of 
                              
                                 
                                    σ
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                            with fixed 
                              
                                 
                                    σ
                                 
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                            on the latency estimators, corresponding to the results in Table 4. The estimators for both parameters exhibit, within each ABR sub-component, similar dynamic patterns but with larger variations as the variances increase. It can be seen that the increase of noise variances can follow more closely the detailed variations, especially the abrupt changes of the underlying parameters that generate the observation data. However, too large a value tends to over-fitting, until to the non-neuronal, random components of noise and artifacts, and hence produces spurious jumps as shown in Fig. 3(c) and Fig. 4(c).


                           Fig. 5
                            shows the influence of increasing the variances on the reconstructed single-trial estimates. Use of small variance gives smooth estimates as seen in Fig. 5(a), however, might risk the loss of trial-to-trial details. In contrast, larger variances are capable of capturing the finer structure of the inter-trial dynamics (Fig. 5(b)), but if set overly large, will induce noisy estimates as in Fig. 5(c), which is correctly translated as the SNR performance drops in Table 4. Based on these results, we select 
                              
                                 
                                    σ
                                 
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                              =
                              2
                            and 
                              
                                 
                                    σ
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                              =
                              1.1
                            for this particular case to achieve an optimal balance between the goodness of fit and low level of noise.

We compare the estimation performance of the OU-CIR diffusion ERP model with the discrete-time random-walk model (5). For the diffusion model, we use the parameters pre-selected above. For the random-walk model, the time-invariant observational noise variance is fixed to 
                              log
                              ⁡
                              
                                 
                                    σ
                                 
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                              =
                              1.5
                            and the Gaussian state noise variances are set to 
                              (
                              
                                 
                                    σ
                                 
                                 
                                    a
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    σ
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    σ
                                 
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              =
                              (
                              0.2
                              ,
                              25
                              ,
                              0.3
                              )
                           . The comparison results for one realization of RBPF on the same subject used in previous section are shown in Fig. 6
                           . Fig. 6(a) shows the estimators of ABR subcomponent parameters and the corresponding trend components. The stationary OU and CIR models produce more stable parameter estimates oscillating within stationary distributions centered at the trends. The estimates by the non-stationary random-walk, however, drift away from the trends, as clearly seen for the amplitudes of first and second components and the width of second component, despite setting small variances to maintain its stability at the cost of tracking lag on inter-trial dynamics. This instability of the random-walk specification could also explain their poor MSE performance in Table 3. Besides, the non-linear CIR models can detect the abrupt changes. The underlying trend estimates are well located at the central path of the single-trial dynamics, and able to converge rapidly from the initials towards stable values representing the means of the ABR Gaussian subcomponents, without requirement of very careful setting of the prior distribution to the exact values.


                           Fig. 6(b) shows the noisy single-trial ABR measurement data of the subject with 
                              
                                 SNR
                              
                              =
                              −
                              7.79
                               
                              
                                 dB
                              
                           . The ensemble averaging of the noisy trials can reveal the existence of wave V expected for normal hearing subjects, as shown by epoch mean. However, the trace of wave V is barely seen from the single-trial epoch plot (bottom) and still vaguely observed in background noise from the image plot (top), despite the moving-average smoothing. The clean single-trial estimates reconstructed from the estimated parameters by the random-walk and diffusion model are shown in Fig. 6(c) and Fig. 6(d) respectively. The estimates for both models show significant reduction in noise and exhibit clearly the underlying inter-trial dynamics with more variability details captured by the diffusion model. Moreover, the trace of wave V is more pronounced. Fig. 6(e) presents the ABR stationary trend estimates, where the inter-trial variability is greatly reduced. The wave V trace, located around 28 ms, becomes almost static and much clearer. Besides, larger and smoother epoch mean is obtained for the denoised ABRs and even better for its trend, compared to that of noisy one. This result suggests that the proposed method can provide better visualization and detection of wave V for the assessment of hearing condition.


                           Table 5
                            presents the comparison of log-likelihoods fitting the data and SNR performance between the two models. The log-likelihoods of the diffusion model are higher than the random-walk, implying a better fit to the data. The denoising by both models gives significant SNR improvements of 71.2% and 74.1% respectively over the noisy ABRs, with better performance by the diffusion model. More substantial SNR improvements can be achieved by decreasing the diffusion variances, as already shown in Table 4. The lower SNR of the random-walk model is due to that the resulting single-trial subcomponents are found, in some realizations, diverted substantially from their means due to the non-stationary parameter estimates, as shown in Fig. 6(a). Other reason may be that the use of fixed variance fails to eliminate the highly non-stationary background noise.

We perform further evaluation on different subjects and stimulus intensities, and a pathological case to investigate the robustness of the proposed method for ERP estimation across varied subjects and conditions, and the portability of the pre-defined model parameters. The single-trial estimates for the second normal-hearing subject with 50 dB SPL using the parameters pre-selected above for the subject 1, are given in Fig. 7
                           . It is showed that the ABR morphology and the inter-trial dynamics, although different from that of the subject 1 e.g. smaller waveform amplitudes due to lower stimulus intensity, can still be well extracted. Fig. 8
                            shows the estimation results using the same parameter set for the subject with hearing impairment, which is correctly indicated by the substantial attenuation of the trace of wave V, clearly noticeable in the single-trial estimates (Fig. 8(b)) and even so in the trend estimates (Fig. 8(c)). This further suggests the usefulness of our method for hearing problem detection. These results also imply some degree of robustness of the user pre-defined model parameters for cross-subject or condition ERP estimation, which is possibly due to two reasons. First is the self-adjustability towards the true values, of the minimum mean-square time-varying estimators generated by the Bayesian RBPF. Second is the sharing of some common waveform characteristics and inter-trial dynamical behaviors within certain range, despite the variability across conditions.

We shall give further remarks on the issue of parameter determination. The primitive grid search considered here is only sub-optimal and computationally inefficient especially when the number of parameters to search through is large, which renders a re-estimation for different subjects and conditions expensive. Despite the somehow portability of the user pre-defined parameters, an automated, more accurate and efficient iterative algorithm for maximum likelihood (ML) estimation of the proposed model, should be considered. ML estimation of a linear-Gaussian dynamic model of ERPs using the iterative expectation-maximization (EM) algorithm has been studied in our earlier work [5], where the likelihood function can be evaluated analytically using the KF. However, the likelihood of the non-linear PO diffusion process considered here is not available in closed-form. Possible solution is to use simulation-based sequential Monte Carlo approximation for the ML estimation [34], which however is computationally expensive and mainly in the stage of simulation study. Improving these algorithms for practical usage in ERP estimation can be pursued in the future work.

We compare in further details the performance of our method with the traditional ensemble averaging technique in detecting the wave V in ABRs for diagnosis of hearing loss. Due to poor SNR condition, the conventional averaging requires large number of sweeps to cancel out random noise which, however, is time-consuming and causes much discomfort to the subject being tested especially the infants. Fast wave V detection using a small number of single-trials, yet obtaining a reliable result, is a challenging task. Fig. 9
                            shows the mean-ABRs averaged in a traditional way over the raw single-trials and after the denoising using the proposed diffusion model for the normal-hearing subject-1 and the hearing-impaired subject using a reduced number of only 10 trials, instead of 50 in the previous experiments. Even with a reduced sweeps, our method can better detect the presence of the wave V in ABRs of normal-hearing, as evident from a more prominent and smoother peak (as shown in Fig. 9(a)). Furthermore, it reflects accurately the suppression of the component expected in the ABRs of a hearing-impaired subject, compared to the conventional averaging which still produces spurious peaks around the wave V location (as shown in Fig. 9(b)), which are probably random noise unable to be eliminated with a small number of sweeps.

In this section, we shall compare the proposed continuous-time diffusion and the discrete-time random-walk ERP model in solving two cases of irregularly or variably spaced observation problem in single-trial ABR estimation: (1) variable sampling frequencies and (2) irregularly spaced single-trial with missing data. Fig. 10
                         shows the estimated parameters of the third subcomponent by the discrete- and continuous-time models on the single-trial ABR data from the normal-hearing subject 1, sampled at different inter-trial intervals of 1-trial (
                           Δ
                           t
                           =
                           0.4
                        ), 2-trial (
                           Δ
                           t
                           =
                           0.8
                        ) and 3-trial (
                           Δ
                           t
                           =
                           1.2
                        ), as shown in Fig. 11
                         (top). The parameter setting is the same as the previous section except that the values of Δt in the diffusion processes can be varied corresponding to the different sampling rates of the data (not necessarily related to the original 
                           (
                           Δ
                           t
                           =
                           0.4
                           )
                        ). We compute the mean-reversion and noise variance terms of the discretized OU process (10) corresponding to the different values of Δt in Table 6
                        . Note that the OU parameters, similarly for that of the CIR process, are adjustable according to Δt for modeling data with different sampling frequencies, instead of being fixed in the discrete-time random-walk model. The continuous model is in fact discretized into discrete models of different sampling rates.

From Fig. 11 (top), it can be seen that when the single-trial data are more sparsely sampled as Δt increases, the inter-trial changes become larger and more abrupt. The estimators of the continuous model can follow those marginal microstructure inter-trial movements of the parameters in the high-frequency data (as in Fig. 10(a)), and still be able to detect rapidly the increasingly abrupt changes in the lower-frequencies data (as in Fig. 10(b) and 10(c)). However, the discrete model with parameters pre-defined for the original sampling rate, can somehow follow the small dynamics thereby, but not the more abrupt, larger changes as Δt increases, which sees an increasingly large tracking lag compared to the continuous model. The superiority of the continuous model in capturing both small and abrupt changes is due to the adjustability of its parameter space according to the variable sampling rate of the data. Whereas, the noise variances of the discrete model pre-defined for the smoother changes in data with small Δt, unless being re-estimated, are fixed and too small for the abrupt changes when Δt is large. These results further substantiate the argument in [8] that the discrete-time models, at a specified sampling interval, are difficult in dealing with both quick and slow dynamics which, however, can be better captured by a continuous model estimated from rapidly sampled data, where the parameters are independent of the sampling rate. Besides, the estimators trajectories of the continuous model are more stable around the trends, due to the larger mean-reversion effect, as the exponentials 
                           
                              
                                 e
                              
                              
                                 −
                                 β
                                 Δ
                                 t
                              
                           
                         in (9) decreases.

The reconstructed single-trial estimates by the both models are shown in Fig. 11. It can be seen that the continuous model, while preserving the overall dynamic pattern despite the down-sampling, can retrieve well the abrupt single-trial dynamics with the increase of Δt (as shown in Fig. 11(middle)), which fail to be captured by the persistently smooth estimates of the discrete model (as shown in Fig. 11(bottom)). Moreover, the mean-reversion effect of the diffusions plays a role to maintain the stationarity of the growingly fluctuated single-trials around the trends, in contrast with the unsteady, constantly shifting estimates of the random-walk.


                        Fig. 12
                         compares the estimation performance between the models on the same ABR data with simulated missing observations. Three consecutive null trials are added at every 10 trials, creating an unevenly spaced data (Fig. 12(a)) which cannot be represented consistently by a discrete-time model with inherently constant sampling period. The RBPF is applied similarly, but with 
                           Δ
                           t
                           =
                           1.2
                         when null-segment is encountered for the continuous model, while at a trial-to-trial basis for the discrete model. Meanwhile, 
                           
                              
                                 μ
                              
                              
                                 
                                    
                                       t
                                    
                                    
                                       n
                                    
                                 
                                 −
                                 Δ
                                 t
                              
                           
                         is used for one-step-ahead prediction of 
                           
                              
                                 μ
                              
                              
                                 
                                    
                                       t
                                    
                                    
                                       n
                                    
                                 
                              
                           
                         for the trend component. From Fig. 12(b), the third subcomponents, after the zero-interval at trial 30 are incorrectly estimated using the discrete-time model, with the subsequent components diverted substantially from the right trend. Whereas, as shown in Fig. 12(c), the continuous-time model captures well the ERP dynamics including those at each interval, without being interrupted by the missing observations, and reasonably matching to that estimated on the full data in Fig. 11(a) (bottom).

@&#CONCLUSION@&#

We have presented a new modeling framework based on the continuous-time PO diffusion process for estimating single-trial ERP dynamics with application to analysis of ABRs. The underlying inter-trial changes of ERP parameters are assumed to follow continuous-time diffusion processes and are discretely observed in background noise. We consider the Gaussian OU process and further the non-linear CIR process with non-Gaussian transition density to capture both abrupt and gradual parameter changes. Further, we use mean-reverting variant for the diffusions to capture the trend of the dynamics and a stochastic volatility process to describe the changing-volatilities in observational noise. The proposed model formulated in a conditionally-linear Gaussian state-space form is estimated using RBPF. Results on simulated ABR data show that the CIR model gives better tracking of the non-Gaussian parameter changes. Evaluation on real data shows that the diffusive ERP model performs better in extracting the underlying inter-trial dynamics with SNR improvement, and produces more stable estimates than the random-walk models used in previous studies. We also demonstrate the robustness of the proposed method for estimation across different subjects, stimulus intensities and hearing conditions. Faster and more reliable detection of the wave V component of ABR by our method, compared to the conventional averaging technique, also suggests its use to improve the diagnosis of hearing loss. Use of continuous-time modeling for ERPs, instead of discrete-time models as in the previous works, is justified by its flexibility and efficiency in handling variably or irregularly sampled data. This has been illustrated through two situations in single-trial ERP estimation, where the continuous-time diffusive model, with adjustable parameter space independent of observation intervals, can capture more accurately both the small and abrupt changes due to variable sampling rates, as well as the interrupted dynamics by irregular intervals due to missing single-trials. Future work may consider extending the diffusion specification to the trend and noise components and incorporate other non-Gaussian non-linear diffusion models within the proposed framework. Besides, the proposed model can be applied to analyze other types of non-stationary bio-signals with hidden dynamics. Development of iterative algorithms for ML estimation in the proposed model can be also addressed in the future.

@&#ACKNOWLEDGEMENTS@&#

The authors would like to thank the reviewers for valuable comments. This work was supported by the Universiti Teknologi Malaysia (UTM) and the Ministry of Higher Education (MOHE) Malaysia under Research University Grant (GUP) Q.J130000.2545.04H21.

@&#REFERENCES@&#

