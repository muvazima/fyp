@&#MAIN-TITLE@&#Multiple-concept feature generative models for multi-label image classification

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Novel generative model representing fusion of multiple concepts in feature generation.


                        
                        
                           
                           Learning algorithms based on likelihood and margin maximization without line search.


                        
                        
                           
                           Performance improvement in several multi-label image classification tasks.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Probabilistic graphical models

Multi-label classification

Concept prediction

Image classification

@&#ABSTRACT@&#


               
               
                  We consider the problem of multi-label classification where a feature vector may belong to one of more different classes or concepts at the same time. Many existing approaches are devoted for solving the difficult estimation task of uncovering the relationship between features and active concepts, solely from data without taking into account any sensible functional structure. In this paper, we propose a novel probabilistic generative model that aims to describe the core generative process of how multiple active concepts can contribute to feature generation. Within our model, each concept is associated with multiple representative base feature vectors, which shares the central idea of sparse feature modeling with the popular dictionary learning. However, by dealing with the weight coefficients as exclusive latent random variables encoding contribution levels, we effectively frame the coefficient learning task as probabilistic inference. We introduce two parameter learning algorithms for the proposed model: one based on standard maximum likelihood learning via the expectation–maximization algorithm, the other focusing on maximally separating the margin of the true concept configuration away from the class boundary. In the latter we suggest an efficient approximate optimization method where each iteration admits closed-form update with no line search. For several benchmark datasets mostly from the multi-label image classification, we demonstrate that our generative model with proposed estimators can often yield superior prediction performance to existing methods.
               
            

@&#INTRODUCTION@&#

The multi-label classification is recognized as a very important problem in machine learning and visual pattern recognition. This is because it naturally arises in virtually any application area where data feature can be generated from, or related to, multiple different sources. The examples are, among others, the multi-label image classification where image consists of multiple concepts or objects of different categories therein. In the blind source separation task in signal processing, we aim to find a set of basic components that comprise the observed signal. In the text classification task, the documents often come from multiple different topics, and one wants to find the most relevant topics that are related to the given document.

Unlike the standard single-label classification, the multi-label classification deals with multiple class labels, and aims at finding all active classes that contribute to the observed data. A feature vector may belong to one of more classes at the same time, where the relevant classes can affect generation of the final feature vector in a rather complex way. The inherent difficulty lies in the exponential number of possible class configurations compared to the small number of training data available. Another notable aspect that makes the problem more challenging is that the class labels are often highly sparse, meaning that only a few of them are active for most samples.

In tackling the multi-label classification problem, recent approaches attempt to capture the central relationship between the feature space and the class label space [1,2] with consideration of the label co-occurrences [3,4] or exclusiveness [5] constraints. For detailed summary of the related work, please refer to Section 4. However, many approaches aim at solving the difficult estimation task of uncovering the relationship between features and active concepts, solely from data without taking into account any sensible functional structure. For instance, the latest method in [5] deals with a non-parametric model to find a linear representation that can be shared for both features and class labels. Such a blind estimation without any sensible structure can be difficult and often prone to overfitting.

In this paper, we propose a novel probabilistic generative model that aims to describe the core generative process of how multiple active concepts can contribute to feature generation. The main idea is to confine the model space by a sensible and plausible functional structure to compensate for relatively small number of sparse training data. To achieve this, we first consider to model each concept/class as a set of representative features which we call the base features. Once the active concepts are chosen, each active concept can select one of its base features, together with the significance level indicating its degree of contribution to the final feature vector. Then we form the observed feature as a significance-weighted sum of the selected base features, which can effectively mimic the complex process of multi-class fusion in the observed feature vector.

In this model each concept is associated with multiple representative base feature vectors, while the final feature vector is generated as a significance-weight linear combination of the base features. Similar in nature, this shares the central idea of sparse feature modeling with the popular sparse coding and dictionary learning [6–11]. However, by dealing with the weight coefficients as exclusive latent random variables, the sparsity, in terms of the number of chosen base features, can be enforced at each concept level (much like the exclusive group sparseness [12]), which can be more appealing in certain contexts. Furthermore, the coefficient learning can be effectively framed as a task of probabilistic inference.

In addition, we incorporate the label exclusive group constraints in parameter estimation, a sort of prior knowledge available from pre-inspection of data, whose usefulness was previously verified in several recent work in multi-label or multi-task learning [5,12]. From the observed data, it can be inferred that certain sets of concepts do not occur concurrently, e.g., book vs. truck. This can be learned from data using the recent Graph-Shift algorithm [13] which basically finds the modes of the graph defined with exclusive-labels edges.

There are latent Dirichlet allocation (LDA) like topic models that are also generative models for documents. As topic corresponds to a concept, these models can be used for multi-label classification naturally, where class prediction is done by inference on latent (observed in data in the multi-label setup) topic variables. However, as they model topic-wise multinomial distributions that generate words comprising a document, hence, the features are restricted to be a kind of histogram or any other form based on frequencies only. In our model, the features are not limited to histograms, but can be arbitrary as we can learn them in a way like dictionary learning. Also the contribution level of each active concept/topic is unable to be controlled in a principled way like ours.

We introduce two parameter learning algorithms for the proposed model: one based on standard maximum likelihood learning via the expectation–maximization algorithm, the other focusing on maximally separating the margin of the true concept configuration away from the class boundary. In the latter we suggest an efficient approximate optimization method where each iteration reduces to a convex quadratic problem that admits a closed-form update with no line search. In both learning algorithms, we resort to posterior distributions on the latent variables. Our model incorporates fully-connected pairwise random fields over the concept variables, and the probabilistic inference is performed approximately with the loopy belief propagation (LBP) algorithm [14,15].

The paper is organized as follows: In the subsequent section, we formally describe the problem and introduce the notations used in the paper. The proposed model is introduced in Section 2 where the parameter learning algorithms are described in Section 3. After reviewing some related prior work in Section 4, we provide the empirical evaluations on some benchmark image classification datasets in Section 5.

We denote by 
                           
                              x
                           
                         a d-dim feature vector, which for image data is typically formed by combining one or more popular image features like SIFT [16,17] and color information. Each feature vector 
                           
                              x
                           
                         is associated with multiple class labels (there are K classes in total), indicated by a K-dim 0/1 vector 
                           
                              c
                           
                         whose j-th concept 
                           
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              =
                              1
                              (
                              0
                              )
                           
                         implies the presence (absence) of the concept/class j in 
                           
                              x
                           
                         for 
                           
                              j
                              =
                              1
                              ,
                              …
                              ,
                              K
                           
                        .

Throughout the paper we consider a fully supervised setup, where one is given the n dyadic training samples 
                           
                              D
                              =
                              
                                 
                                    {
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    }
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    n
                                 
                              
                           
                        . The ultimate goal of the multi-label classification is to estimate the prediction function 
                           
                              c
                              =
                              f
                              (
                              x
                              )
                           
                         such that the predicted label vector 
                           
                              c
                           
                         for a new test feature 
                           
                              x
                           
                         is as close as possible to the true labels.

We propose a probabilistic generative model 
                        
                           P
                           (
                           c
                           ,
                           x
                           )
                        
                      that represents the core generative process of how multiple active concepts impact on the generation of a feature vector. To make a sensible model, we will introduce a set of latent random variables that are useful for modeling the generative process. In the below the major concept-feature generation process is described while the detailed formal description follows in Section 2.1.

Our main motivation is that each concept j (
                        
                           j
                           =
                           1
                           ,
                           …
                           ,
                           K
                        
                     ) is characterized by a set of representative feature vectors which we call the base features. Instead of having a single representative feature vector, we consider multiple base features per concept since a concept usually exhibits several different observations. In image classification, for instance, each object/concept can bear multiple different sub-categories, also with diverse appearances depending on view points and/or pose variations.

The base features of the concept j are denoted by
                        1
                        Although one can define different numbers of base features across concepts, we let all concepts have the same number of bases M, for simplicity.
                     
                     
                        1
                      
                     
                        
                           
                              
                                 B
                              
                              
                                 j
                              
                           
                           =
                           [
                           
                              
                                 b
                              
                              
                                 1
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 2
                              
                              
                                 j
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 b
                              
                              
                                 M
                              
                              
                                 j
                              
                           
                           ]
                        
                      where 
                        
                           
                              
                                 b
                              
                              
                                 i
                              
                              
                                 j
                              
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 d
                              
                           
                        
                     . Our modeling intention is that when the j-th concept is active, one of its base features is selected and contributed to form the feature 
                        
                           x
                        
                     . To indicate the index of the selected base feature, we hence introduce the hidden random variable, 
                        
                           
                              
                                 z
                              
                              
                                 j
                              
                           
                        
                     . The prior distribution 
                        
                           P
                           (
                           
                              
                                 z
                              
                              
                                 j
                              
                           
                           )
                        
                      is modeled as the multinomial over 
                        
                           
                              
                                 z
                              
                              
                                 j
                              
                           
                           ∈
                           {
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           M
                           }
                        
                     , where the parameters might be different across j, and can be learned from data. We often use the vector notation 
                        
                           z
                           =
                           
                              
                                 [
                                 
                                    
                                       z
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       K
                                    
                                 
                                 ]
                              
                              
                                 ⊤
                              
                           
                        
                      to refer to the selection across all K concepts.

The selected base features across the active concepts may have equal effects on the final feature vector. However, it is more reasonable to allow them to have different contributions to the feature generation. In image classification, for instance, certain objects may appear large in an image while others occupy only smaller portions. In such cases one can naturally observe larger impacts of the former features in the overall image descriptor than the latter. To account for it, we consider a 
                        
                           [
                           0
                           ,
                           1
                           ]
                        
                     -scaled significance value to indicate the level of contribution that each concept makes.

More formally, for each active concept j (
                        
                           
                              
                                 c
                              
                              
                                 j
                              
                           
                           =
                           1
                        
                     ), we decide its significance level 
                        
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                        
                     , a positive valued (bounded above by 1) latent random variable that encodes the amount of contribution the j-th concept makes in the final feature generation. To make the probabilistic inference computationally feasible, we confine 
                        
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                        
                      to be discrete, taking one of the S predefined values, 
                        
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           ∈
                           {
                           
                              
                                 a
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 a
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 a
                              
                              
                                 S
                              
                           
                           }
                        
                     , typically we choose 
                        
                           
                              
                                 a
                              
                              
                                 i
                              
                           
                           =
                           i
                           /
                           S
                        
                     . For instance, for 
                        
                           S
                           =
                           10
                        
                      different contribution levels, we get 
                        
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           ∈
                           {
                           0.1
                           ,
                           0.2
                           ,
                           …
                           ,
                           1.0
                           }
                        
                     . The conditional distribution 
                        
                           P
                           (
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           |
                           
                              
                                 c
                              
                              
                                 j
                              
                           
                           =
                           1
                           )
                        
                      can be modeled as the multinomial, whose parameters can be learned from data. We also need to deal with the case of inactive concepts, where a natural choice is to fix it as a delta function at 
                        
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           =
                           0
                        
                     , i.e., 
                        
                           P
                           (
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           =
                           0
                           |
                           
                              
                                 c
                              
                              
                                 j
                              
                           
                           =
                           0
                           )
                           =
                           1
                        
                     , since inactive concepts give zero contribution to the feature generation. Similarly, we use the vector notation 
                        
                           s
                           =
                           
                              
                                 [
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       K
                                    
                                 
                                 ]
                              
                              
                                 ⊤
                              
                           
                        
                     .

Given the selected base feature vectors 
                        
                           (
                           
                              
                                 b
                              
                              
                                 
                                    
                                       z
                                    
                                    
                                       1
                                    
                                 
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 
                                    
                                       z
                                    
                                    
                                       2
                                    
                                 
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 b
                              
                              
                                 
                                    
                                       z
                                    
                                    
                                       K
                                    
                                 
                              
                              
                                 K
                              
                           
                           )
                        
                      with the corresponding significance levels 
                        
                           (
                           
                              
                                 s
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 s
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 s
                              
                              
                                 K
                              
                           
                           )
                        
                     , the feature vector 
                        
                           x
                        
                      is considered to be generated as a significance-weighted sum over the K concepts, namely,
                        
                           (1)
                           
                              x
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       K
                                    
                                 
                              
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    b
                                 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              +
                              v
                              ,
                              
                              where
                              
                              v
                              ∼
                              N
                              (
                              0
                              ,
                              
                                 
                                    σ
                                 
                                 
                                    2
                                 
                              
                              I
                              )
                              .
                           
                        
                     Here we add Gaussian spherical noise in the emission process.

Therefore, the feature vector is basically formed by a linear combination of the base features, which has a close connection to the popular dictionary learning. In our model, however, each concept is composed of a group of base features, among which only one base feature is exclusively selected. This essentially has an effect of enforcing exclusive group sparsity, similar in nature to the exclusive group lasso [12], quite effective in certain application contexts. Furthermore the coefficients for the selected base features are generated in a probabilistic fashion as random variables of significance levels that can be estimated from observation by inference in the graphical model.

The top level of the generative model is the joint class prior model 
                        
                           P
                           (
                           c
                           )
                        
                      which is represented by a fully-connected pairwise undirected graphical model, Markov random field (MRF). The overall generative process is summarized below, while the graphical model representation is shown in Fig. 1
                     (Top).
                        
                           1.
                           The concept variables 
                                 
                                    
                                       
                                          {
                                          
                                             
                                                c
                                             
                                             
                                                j
                                             
                                          
                                          }
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          K
                                       
                                    
                                 
                               are generated from 
                                 
                                    P
                                    (
                                    c
                                    )
                                 
                              .

For each concept 
                                 
                                    j
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          j
                                       
                                    
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    M
                                    }
                                 
                               is selected from 
                                 
                                    P
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                              , determining the base feature selected for the concept, 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          
                                             
                                                z
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              .

For each concept 
                                 
                                    j
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          j
                                       
                                    
                                    ∈
                                    {
                                    
                                       
                                          a
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          a
                                       
                                       
                                          S
                                       
                                    
                                    }
                                 
                               is chosen from 
                                 
                                    P
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          j
                                       
                                    
                                    |
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                              , which indicates the contribution of the concept j to the observed feature.

Generate the final feature vector 
                                 
                                    x
                                 
                               from (1).

For ease of exposition, we combine two latent variables 
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                           
                         and 
                           
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                              
                           
                         into a new variable 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              =
                              (
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                              
                              )
                           
                        , and define 
                           
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    b
                                 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                           
                         that can be seen as a significance-weighted base feature. Thus the sole latent variables are 
                           
                              h
                              =
                              
                                 
                                    [
                                    
                                       
                                          h
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          h
                                       
                                       
                                          K
                                       
                                    
                                    ]
                                 
                                 
                                    ⊤
                                 
                              
                           
                        . This merging process can be precisely specified as the following construction. We first single out 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              =
                              0
                           
                         to indicate the zero vector, 
                           
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                                 
                                    j
                                 
                              
                              =
                              0
                           
                        . For non-zero significance (i.e., 
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    a
                                 
                                 
                                    l
                                 
                              
                           
                         for some 
                           
                              l
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              S
                              }
                           
                        ) we define 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              =
                              (
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                              
                              -
                              1
                              )
                              ·
                              S
                              +
                              l
                           
                         (hence 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              
                              ≠
                              
                              0
                           
                        ), and associate it with 
                           
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    b
                                 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                           
                        . In this way we have 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              ∈
                              {
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              
                                 
                                    H
                                 
                                 
                                    0
                                 
                              
                              }
                           
                         where 
                           
                              
                                 
                                    H
                                 
                                 
                                    0
                                 
                              
                              =
                              MS
                           
                        . We also let 
                           
                              H
                              =
                              
                                 
                                    H
                                 
                                 
                                    0
                                 
                              
                              +
                              1
                           
                        , the cardinality of 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                           
                        .

The induced base features for concept j, each associated with each value of 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                           
                        , can then be expressed as:
                           
                              (2)
                              
                                 
                                    
                                       F
                                    
                                    
                                       j
                                    
                                 
                                 ≔
                                 [
                                 0
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       1
                                    
                                    
                                       j
                                    
                                 
                                 ⊗
                                 A
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       2
                                    
                                    
                                       j
                                    
                                 
                                 ⊗
                                 A
                                 ,
                                 …
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       M
                                    
                                    
                                       j
                                    
                                 
                                 ⊗
                                 A
                                 ]
                                 ,
                              
                           
                        where 
                           
                              A
                              =
                              [
                              
                                 
                                    a
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    a
                                 
                                 
                                    S
                                 
                              
                              ]
                           
                        , and 
                           
                              ⊗
                           
                         is the Kronecker product. Note that 
                           
                              
                                 
                                    F
                                 
                                 
                                    j
                                 
                              
                           
                         is 
                           
                              (
                              d
                              ×
                              H
                              )
                           
                         matrix. For example, if 
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              ∈
                              A
                              =
                              
                                 
                                    
                                       
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       1
                                    
                                 
                              
                           
                         and 
                           
                              
                                 
                                    B
                                 
                                 
                                    j
                                 
                              
                              =
                              [
                              
                                 
                                    b
                                 
                                 
                                    1
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    b
                                 
                                 
                                    2
                                 
                                 
                                    j
                                 
                              
                              ]
                           
                        , then the induced base features for the concept j, corresponding to 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              ∈
                              {
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                              }
                           
                        , are: 
                           
                              
                                 
                                    F
                                 
                                 
                                    j
                                 
                              
                              =
                              [
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    3
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    4
                                 
                                 
                                    j
                                 
                              
                              ]
                           
                        , where 
                           
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                                 
                                    j
                                 
                              
                              =
                              0
                           
                        , 
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    b
                                 
                                 
                                    1
                                 
                                 
                                    j
                                 
                              
                           
                        , 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    b
                                 
                                 
                                    1
                                 
                                 
                                    j
                                 
                              
                           
                        , 
                           
                              
                                 
                                    f
                                 
                                 
                                    3
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    b
                                 
                                 
                                    2
                                 
                                 
                                    j
                                 
                              
                           
                        , 
                           
                              
                                 
                                    f
                                 
                                 
                                    4
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    b
                                 
                                 
                                    2
                                 
                                 
                                    j
                                 
                              
                           
                        . Here, 
                           
                              
                                 
                                    H
                                 
                                 
                                    0
                                 
                              
                              =
                              4
                           
                         and 
                           
                              H
                              =
                              5
                           
                        .

Being equipped with the combined latent variables 
                           
                              h
                           
                         and the significance-weighted base feature vectors 
                           
                              F
                              ≔
                              [
                              
                                 
                                    F
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    F
                                 
                                 
                                    K
                                 
                              
                              ]
                           
                         (of dimension 
                           
                              (
                              d
                              ×
                              KH
                              )
                           
                        ), the full joint model can be written as: 
                           
                              P
                              (
                              c
                              ,
                              h
                              ,
                              x
                              )
                              =
                              P
                              (
                              c
                              )
                              ·
                              P
                              (
                              h
                              |
                              c
                              )
                              ·
                              P
                              (
                              x
                              |
                              h
                              )
                           
                        . The overall graphical model is depicted in Fig. 1(Bottom). We describe each of the component models and the associated parameters in the below.

We utilize the Markov random field (i.e., undirected graphical model) for modeling 
                              
                                 P
                                 (
                                 c
                                 )
                              
                           . A fully connected pairwise MRF is considered, which can be written as:
                              
                                 (3)
                                 
                                    P
                                    (
                                    c
                                    )
                                    ∝
                                    
                                       
                                          
                                             ∏
                                          
                                          
                                             j
                                             ∈
                                             V
                                          
                                       
                                    
                                    
                                       
                                          Ψ
                                       
                                       
                                          j
                                       
                                       
                                          V
                                       
                                    
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    ·
                                    
                                       
                                          
                                             ∏
                                          
                                          
                                             e
                                             =
                                             (
                                             j
                                             ,
                                             l
                                             )
                                             ∈
                                             E
                                          
                                       
                                    
                                    
                                       
                                          Ψ
                                       
                                       
                                          e
                                       
                                       
                                          E
                                       
                                    
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    ,
                                 
                              
                           where the underlying graph 
                              
                                 G
                                 =
                                 (
                                 V
                                 ,
                                 E
                                 )
                              
                            is composed of the vertex set 
                              
                                 V
                                 =
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 K
                                 }
                              
                            and the edge set 
                              
                                 E
                                 =
                                 {
                                 (
                                 j
                                 ,
                                 l
                                 )
                                 |
                                 j
                                 <
                                 l
                                 ,
                                 j
                                 ,
                                 l
                                 ∈
                                 V
                                 }
                              
                           . Following the log-linear parameterization, we specifically define the node potential function as:
                              
                                 (4)
                                 
                                    
                                       
                                          Ψ
                                       
                                       
                                          j
                                       
                                       
                                          V
                                       
                                    
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          e
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                j
                                             
                                          
                                          ·
                                          I
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          1
                                          )
                                       
                                    
                                    ,
                                 
                              
                           with the node parameters 
                              
                                 
                                    
                                       {
                                       
                                          
                                             θ
                                          
                                          
                                             j
                                          
                                       
                                       }
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       K
                                    
                                 
                              
                           . Here 
                              
                                 I
                                 (
                                 x
                                 )
                              
                            is the indicator returning 1(0) if x is true (false). The edge potential at edge 
                              
                                 e
                                 =
                                 (
                                 j
                                 ,
                                 l
                                 )
                              
                            is defined to be:
                              
                                 (5)
                                 
                                    
                                       
                                          Ψ
                                       
                                       
                                          e
                                       
                                       
                                          E
                                       
                                    
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          e
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                e
                                             
                                             
                                                11
                                             
                                          
                                          ·
                                          I
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          1
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                l
                                             
                                          
                                          =
                                          1
                                          )
                                          +
                                          
                                             
                                                θ
                                             
                                             
                                                e
                                             
                                             
                                                01
                                             
                                          
                                          ·
                                          I
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          0
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                l
                                             
                                          
                                          =
                                          1
                                          )
                                          +
                                          
                                             
                                                θ
                                             
                                             
                                                e
                                             
                                             
                                                10
                                             
                                          
                                          ·
                                          I
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          1
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                l
                                             
                                          
                                          =
                                          0
                                          )
                                       
                                    
                                    ,
                                 
                              
                           with the edge parameters 
                              
                                 
                                    
                                       {
                                       
                                          
                                             θ
                                          
                                          
                                             e
                                          
                                       
                                       =
                                       
                                          
                                             [
                                             
                                                
                                                   θ
                                                
                                                
                                                   e
                                                
                                                
                                                   11
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                
                                                   e
                                                
                                                
                                                   01
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                
                                                   e
                                                
                                                
                                                   10
                                                
                                             
                                             ]
                                          
                                          
                                             ⊤
                                          
                                       
                                       }
                                    
                                    
                                       e
                                       ∈
                                       E
                                    
                                 
                              
                           . Concatenation of all the node and the edge parameters as a vector is denote by 
                              
                                 θ
                              
                            while we let 
                              
                                 ϕ
                                 (
                                 c
                                 )
                              
                            the indicators (statistics) stacked accordingly. In this way the class prior model can be written succinctly as:
                              
                                 (6)
                                 
                                    P
                                    (
                                    c
                                    )
                                    ∝
                                    exp
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ⊤
                                                
                                             
                                             ϕ
                                             (
                                             c
                                             )
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        

The base feature selection model is fully factorized over the concepts, 
                              
                                 P
                                 (
                                 h
                                 |
                                 c
                                 )
                                 =
                                 
                                    
                                       ∏
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       K
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 |
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                            where we model each 
                              
                                 
                                    
                                       P
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 |
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                            as a multinomial distribution. Depending on whether 
                              
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                              
                            is active or not, the base selection would conform to a different distribution. For 
                              
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 1
                              
                           , it is natural to assign zero probability to 
                              
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                              
                            (corresponding to 
                              
                                 
                                    
                                       f
                                    
                                    
                                       0
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                              
                           ) while non-negative probabilities to 
                              
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       H
                                    
                                    
                                       0
                                    
                                 
                              
                           . We denote the multinomial parameters for 
                              
                                 
                                    
                                       P
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 |
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 1
                                 )
                              
                            as 
                              
                                 
                                    
                                       η
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       0
                                       ,
                                       
                                          
                                             η
                                          
                                          
                                             1
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             η
                                          
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       ]
                                    
                                    
                                       ⊤
                                    
                                 
                              
                            which lies in the probability simplex. For 
                              
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                              
                           , on the other hand, the entire mass has to go to 
                              
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                              
                            (i.e., 
                              
                                 
                                    
                                       P
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                                 |
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                                 )
                                 =
                                 1
                              
                           ), and its multinomial parameters are denoted as 
                              
                                 
                                    
                                       
                                          
                                             η
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       1
                                       ,
                                       0
                                       ,
                                       …
                                       ,
                                       0
                                       ]
                                    
                                    
                                       ⊤
                                    
                                 
                              
                           . Unlike 
                              
                                 
                                    
                                       η
                                    
                                    
                                       j
                                    
                                 
                              
                           ’s that can be learned from data, no parameter learning is required for 
                              
                                 
                                    
                                       
                                          
                                             η
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                              
                           ’s since they are always fixed.

It is a simple Gaussian with additive mean of all features, essentially adding only the selected active base features:
                              
                                 (7)
                                 
                                    P
                                    (
                                    x
                                    |
                                    h
                                    )
                                    =
                                    N
                                    
                                       
                                          
                                             x
                                             ;
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                             
                                             
                                                
                                                   f
                                                
                                                
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             ,
                                             
                                                
                                                   σ
                                                
                                                
                                                   2
                                                
                                             
                                             I
                                          
                                       
                                    
                                    .
                                 
                              
                           This effectively accounts for all possible significances 
                              
                                 
                                    
                                       s
                                    
                                    
                                       j
                                    
                                 
                              
                           ’s.

With the proposed model, the ultimate task is to predict the concept labels of an unseen test feature 
                           
                              x
                           
                        . We consider to optimize the joint configuration 
                           
                              (
                              c
                              ,
                              h
                              )
                           
                         for the model 
                           
                              P
                              (
                              c
                              ,
                              h
                              |
                              x
                              )
                           
                        ,
                           
                              (8)
                              
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       ∗
                                    
                                 
                                 ,
                                 
                                    
                                       h
                                    
                                    
                                       ∗
                                    
                                 
                                 )
                                 =
                                 arg
                                 
                                    
                                       
                                          max
                                       
                                       
                                          (
                                          c
                                          ,
                                          h
                                          )
                                       
                                    
                                 
                                 P
                                 (
                                 c
                                 ,
                                 h
                                 |
                                 x
                                 )
                                 =
                                 arg
                                 
                                    
                                       
                                          max
                                       
                                       
                                          (
                                          c
                                          ,
                                          h
                                          )
                                       
                                    
                                 
                                 P
                                 (
                                 c
                                 ,
                                 h
                                 ,
                                 x
                                 )
                                 .
                              
                           
                        The approximate probabilistic inference can be done by max-product version of the loopy belief propagation (LBP) performed on the joint MRF model proportional to 
                           
                              P
                              (
                              c
                              ,
                              h
                              ,
                              x
                              )
                           
                        . The detailed description of constructing its node and edge potentials is provided in Appendix A.

Now we have the full joint model 
                        
                           P
                           (
                           c
                           ,
                           h
                           ,
                           x
                           )
                        
                      with the model parameters 
                        
                           Θ
                           =
                           {
                           θ
                           ,
                           η
                           ,
                           F
                           ,
                           
                              
                                 σ
                              
                              
                                 2
                              
                           
                           }
                        
                      where 
                        
                           η
                           =
                           
                              
                                 {
                                 
                                    
                                       η
                                    
                                    
                                       j
                                    
                                 
                                 }
                              
                              
                                 j
                                 =
                                 1
                              
                              
                                 K
                              
                           
                        
                      and 
                        
                           F
                           =
                           [
                           
                              
                                 F
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 F
                              
                              
                                 K
                              
                           
                           ]
                        
                     . Note here that 
                        
                           F
                        
                      are not free independent variables; they are rather structured as 
                        
                           
                              
                                 F
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 B
                              
                              
                                 j
                              
                           
                           
                              
                                 D
                              
                              
                                 0
                              
                           
                        
                      derived from the actual free parameters 
                        
                           B
                           ≔
                           [
                           
                              
                                 B
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 B
                              
                              
                                 K
                              
                           
                           ]
                        
                     . From (2), 
                        
                           
                              
                                 D
                              
                              
                                 0
                              
                           
                        
                      is a 
                        
                           (
                           M
                           ×
                           H
                           )
                        
                      matrix shown in Fig. 2
                     . Then we have the relationship:
                        
                           (9)
                           
                              F
                              =
                              BD
                              ,
                           
                        
                     where 
                        
                           D
                        
                      is a 
                        
                           (
                           MK
                           ×
                           HK
                           )
                        
                      matrix, comprised of 
                        
                           (
                           K
                           ×
                           K
                           )
                        
                      blocks with each block having size 
                        
                           (
                           M
                           ×
                           H
                           )
                        
                     . 
                        
                           D
                        
                      is filled with all zero blocks except the diagonal blocks all equal to 
                        
                           
                              
                                 D
                              
                              
                                 0
                              
                           
                        
                     . Our basic strategy in learning is as follows: we perform optimization with respect to 
                        
                           F
                        
                     , then use the structure (9) to find the optimal 
                        
                           B
                        
                     .

Given the training data 
                           
                              D
                              =
                              
                                 
                                    {
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    }
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    n
                                 
                              
                           
                        , the standard maximum likelihood (ML) learning aims at maximizing the data log-likelihood, namely 
                           
                              
                                 
                                    max
                                 
                                 
                                    Θ
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    n
                                 
                              
                              log
                              P
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        . Since the objective can be decomposed as 
                           
                              log
                              P
                              (
                              c
                              ,
                              x
                              )
                              =
                              log
                              P
                              (
                              c
                              )
                              +
                              log
                              P
                              (
                              x
                              |
                              c
                              )
                           
                         with each term involving separate parameters, we can perform two optimizations independently: (i) maximizing the class prior likelihood, 
                           
                              
                                 
                                    max
                                 
                                 
                                    θ
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                 
                              
                              log
                              P
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         and (ii) maximizing the class conditional, 
                           
                              
                                 
                                    max
                                 
                                 
                                    {
                                    η
                                    ,
                                    F
                                    ,
                                    
                                       
                                          σ
                                       
                                       
                                          2
                                       
                                    
                                    }
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                 
                              
                              log
                              P
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              |
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        .

The class prior likelihood maximization can be done by the standard MRF learning using gradient ascent where the objective value at 
                              
                                 θ
                              
                            and its gradient can be expressed as (for each training sample i):
                              
                                 (10)
                                 
                                    log
                                    P
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          θ
                                       
                                       
                                          ⊤
                                       
                                    
                                    ϕ
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    -
                                    log
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             c
                                          
                                       
                                    
                                    exp
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ⊤
                                                
                                             
                                             ϕ
                                             (
                                             c
                                             )
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (11)
                                 
                                    
                                       
                                          ∂
                                          log
                                          P
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       
                                          ∂
                                          θ
                                       
                                    
                                    =
                                    ϕ
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    -
                                    E
                                    [
                                    ϕ
                                    (
                                    c
                                    )
                                    ]
                                 
                              
                           where the expectation in (11) is performed with respect to 
                              
                                 P
                                 (
                                 c
                                 )
                              
                            at 
                              
                                 θ
                              
                           . Note that due to the fully connected dependency structure over 
                              
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                              
                           ’s in our model, the computation of log-partition function in (10) and the inference 
                              
                                 P
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       l
                                    
                                 
                                 )
                              
                            required in (11) cannot be done exactly. Rather, we use the approximate inference methods, typically the loopy belief propagation (LBP) [14,15].

While we follow the gradient ascent for optimizing 
                              
                                 θ
                              
                           , not all of its parameters are updated. We exploit the label exclusive group constraints, whose usefulness was previously verified in several recent work in multi-label learning [5,12]. The constraints are imposed in the learning stage. Specifically, by pre-inspecting data using the Graph-Shift algorithm [13], we obtain a set of groups, denoted by 
                              
                                 LEG
                                 =
                                 {
                                 
                                    
                                       g
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       g
                                    
                                    
                                       R
                                    
                                 
                                 }
                              
                           . The group 
                              
                                 
                                    
                                       g
                                    
                                    
                                       i
                                    
                                 
                              
                            is composed of nodes (concepts) that should not co-occur in any sample 
                              
                                 c
                              
                           .

Then for each 
                              
                                 
                                    
                                       g
                                    
                                    
                                       i
                                    
                                 
                              
                           , if 
                              
                                 e
                                 =
                                 (
                                 j
                                 ,
                                 l
                                 )
                                 ∈
                                 
                                    
                                       g
                                    
                                    
                                       i
                                    
                                 
                              
                           , meaning that it is infeasible to observe both 
                              
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 1
                              
                            and 
                              
                                 
                                    
                                       c
                                    
                                    
                                       l
                                    
                                 
                                 =
                                 1
                              
                           , then we impose 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       e
                                    
                                    
                                       11
                                    
                                 
                                 =
                                 -
                                 ∞
                              
                           . This has an effect of forcing any configuration 
                              
                                 c
                              
                            that has both 
                              
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 1
                              
                            and 
                              
                                 
                                    
                                       c
                                    
                                    
                                       l
                                    
                                 
                                 =
                                 1
                              
                            to be assigned 
                              
                                 P
                                 (
                                 c
                                 )
                                 =
                                 0
                              
                           , thus effectively discarding such configurations predicted in the decoding stage. So, in gradient ascent, we do not update the edge parameters 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       e
                                    
                                    
                                       11
                                    
                                 
                              
                            that belong to any group in 
                              
                                 LEG
                              
                           , and fix them as negative infinity from the outset.

The class conditional likelihood 
                              
                                 P
                                 (
                                 x
                                 |
                                 c
                                 )
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       h
                                    
                                 
                                 P
                                 (
                                 h
                                 |
                                 c
                                 )
                                 P
                                 (
                                 x
                                 |
                                 h
                                 )
                              
                            is associated with the parameters 
                              
                                 η
                                 ,
                                 σ
                              
                           , and 
                              
                                 F
                              
                            (later, we will exploit the structure of 
                              
                                 F
                              
                            in terms of 
                              
                                 B
                              
                            as in (9)), while entailing marginalization over the latent variables 
                              
                                 h
                              
                           . Following the conventional expectation maximization (EM) learning [18] for latent-variable models, we maximize the lower bound of the log-likelihood using the Jensen’s inequality. This amounts to alternating the following two steps until convergence:
                              
                                 1.
                                 
                                    E-step: Infer 
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          h
                                          )
                                          =
                                          P
                                          (
                                          h
                                          |
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                     for 
                                       
                                          i
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          n
                                       
                                    , with respect to the current model parameters 
                                       
                                          {
                                          η
                                          ,
                                          F
                                          ,
                                          σ
                                          }
                                       
                                     fixed.


                                    M-step: Maximize 
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                E
                                             
                                             
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      i
                                                   
                                                
                                                (
                                                h
                                                )
                                             
                                          
                                          [
                                          log
                                          P
                                          (
                                          h
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          |
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          ]
                                       
                                     with respect to 
                                       
                                          {
                                          η
                                          ,
                                          F
                                          ,
                                          σ
                                          }
                                       
                                     using 
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          h
                                          )
                                       
                                    ’s obtained from the E-step.

We first deal with the inference 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 h
                                 )
                              
                            in the E-step, which can be basically done by forming an MRF over 
                              
                                 h
                              
                            for each i. From the following derivation,
                              
                                 (12)
                                 
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    h
                                    )
                                    ∝
                                    P
                                    (
                                    h
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    P
                                    (
                                    h
                                    |
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    P
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    h
                                    )
                                 
                              
                           
                           
                              
                                 (13)
                                 
                                    
                                    
                                    =
                                    
                                       
                                          
                                             ∏
                                          
                                          
                                             j
                                          
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                    |
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ·
                                    N
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ;
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                
                                                   f
                                                
                                                
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             ,
                                             
                                                
                                                   σ
                                                
                                                
                                                   2
                                                
                                             
                                             I
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (14)
                                 
                                    
                                    
                                    ∝
                                    exp
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      I
                                                      (
                                                      
                                                         
                                                            c
                                                         
                                                         
                                                            j
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      1
                                                      )
                                                      ·
                                                      log
                                                      
                                                         
                                                            η
                                                         
                                                         
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      +
                                                      I
                                                      (
                                                      
                                                         
                                                            c
                                                         
                                                         
                                                            j
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      0
                                                      )
                                                      ·
                                                      log
                                                      
                                                         
                                                            
                                                               
                                                                  η
                                                               
                                                               
                                                                  ̃
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         -
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     j
                                                                  
                                                               
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           it is easy to see that 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 h
                                 )
                              
                            can be factorized into pairwise (and unary) potential functions of 
                              
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       h
                                    
                                    
                                       l
                                    
                                 
                              
                           . More specifically, the MRF corresponding to 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 h
                                 )
                              
                            can be defined as:
                              
                                 (15)
                                 
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    h
                                    )
                                    ∝
                                    exp
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                
                                                   φ
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   h
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      e
                                                      =
                                                      (
                                                      j
                                                      ,
                                                      l
                                                      )
                                                      ∈
                                                      E
                                                   
                                                
                                             
                                             
                                                
                                                   φ
                                                
                                                
                                                   e
                                                
                                             
                                             (
                                             
                                                
                                                   h
                                                
                                                
                                                   j
                                                
                                             
                                             ,
                                             
                                                
                                                   h
                                                
                                                
                                                   l
                                                
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                           with the complete edge set E, while the node (unary) and the edge (pairwise) log-potentials being:
                              
                                 (16)
                                 
                                    
                                       
                                          φ
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    =
                                    I
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    1
                                    )
                                    ·
                                    log
                                    
                                       
                                          η
                                       
                                       
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    I
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    0
                                    )
                                    ·
                                    log
                                    
                                       
                                          
                                             
                                                η
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                       
                                          ⊤
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    -
                                    
                                       
                                          1
                                       
                                       
                                          2
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    ‖
                                    
                                       
                                          f
                                       
                                       
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          ‖
                                       
                                       
                                          2
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                           
                              
                                 (17)
                                 
                                    
                                       
                                          φ
                                       
                                       
                                          e
                                       
                                    
                                    (
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                       
                                          h
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    =
                                    -
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                       
                                          ⊤
                                       
                                    
                                    
                                       
                                          f
                                       
                                       
                                          
                                             
                                                h
                                             
                                             
                                                l
                                             
                                          
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                           
                        

For this MRF, indeed all that is required in the M-step is the pairwise posterior distributions 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 
                                    
                                       h
                                    
                                    
                                       l
                                    
                                 
                                 )
                              
                            (and, of course, the unary 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                           ). This is because the quantity 
                              
                                 log
                                 P
                                 (
                                 h
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                            of which we take expectation is fully decomposed into unary and pairwise terms as shown in (12)–(14). To retrieve these pairwise posteriors, we perform approximate probabilistic inference (e.g., LBP) on each MRF 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 h
                                 )
                              
                           .

Having computed 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 
                                    
                                       h
                                    
                                    
                                       l
                                    
                                 
                                 )
                              
                            and 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                            for all 
                              
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                              
                           , we solve the M-step optimization. Utilizing the decomposition 
                              
                                 log
                                 P
                                 (
                                 h
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 log
                                 P
                                 (
                                 h
                                 |
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 +
                                 log
                                 P
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 h
                                 )
                              
                           , where the former involved in 
                              
                                 η
                              
                            and the latter 
                              
                                 F
                              
                            and 
                              
                                 
                                    
                                       σ
                                    
                                    
                                       2
                                    
                                 
                              
                           , the optimization can be done independently for each term.

In the first term, the expectation over q can be derived as:
                              
                                 (18)
                                 
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          h
                                          )
                                       
                                    
                                    [
                                    log
                                    P
                                    (
                                    h
                                    |
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ]
                                    ∼
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             K
                                          
                                       
                                    
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                    [
                                    I
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    1
                                    )
                                    ·
                                    log
                                    
                                       
                                          η
                                       
                                       
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    ]
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             K
                                          
                                       
                                    
                                    I
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    1
                                    )
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    log
                                    
                                       
                                          η
                                       
                                       
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                 
                              
                           where 
                              
                                 ∼
                              
                            indicates equivalence up to constant. The objective is the sum of (18) over 
                              
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                              
                           , which can be maximized independently with respect to each 
                              
                                 
                                    
                                       η
                                    
                                    
                                       j
                                    
                                 
                              
                            for 
                              
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 K
                              
                           . Setting up the gradient to be zero, and solving for 
                              
                                 
                                    
                                       η
                                    
                                    
                                       j
                                    
                                 
                              
                            while minding the simplex constraint yields the optimal estimate in a closed form,
                              
                                 (19)
                                 
                                    
                                       
                                          η
                                       
                                       
                                          r
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                n
                                             
                                          
                                          I
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                j
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          1
                                          )
                                          ·
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          r
                                          )
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                n
                                             
                                          
                                          I
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                j
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          1
                                          )
                                          ·
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                          
                                          ≠
                                          
                                          0
                                          )
                                       
                                    
                                    ,
                                    
                                    r
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          H
                                       
                                       
                                          0
                                       
                                    
                                    .
                                 
                              
                           
                        

The expectation of 
                              
                                 log
                                 P
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 h
                                 )
                              
                            for each i can be derived as:
                              
                                 (20)
                                 
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          h
                                          )
                                       
                                    
                                    [
                                    log
                                    P
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    h
                                    )
                                    ]
                                    ∼
                                    -
                                    
                                       
                                          d
                                       
                                       
                                          2
                                       
                                    
                                    log
                                    
                                       
                                          σ
                                       
                                       
                                          2
                                       
                                    
                                    -
                                    
                                       
                                          1
                                       
                                       
                                          2
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          h
                                          )
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         -
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     j
                                                                  
                                                               
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where the expectation in the second term becomes:
                              
                                 (21)
                                 
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          h
                                          )
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         -
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     j
                                                                  
                                                               
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    ∼
                                    -
                                    2
                                    
                                       
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       
                                          ⊤
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             K
                                          
                                       
                                    
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                    [
                                    
                                       
                                          f
                                       
                                       
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    ]
                                    +
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             [
                                             ‖
                                             
                                                
                                                   f
                                                
                                                
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             
                                                
                                                   ‖
                                                
                                                
                                                   2
                                                
                                                
                                                   2
                                                
                                             
                                             ]
                                             +
                                             2
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      <
                                                      l
                                                   
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                
                                             
                                             [
                                             
                                                
                                                   (
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   f
                                                
                                                
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                
                                                
                                                   l
                                                
                                             
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                        

To have succinct matrix–vector notation, we introduce, for each i, the 
                              
                                 (
                                 HK
                                 ×
                                 1
                                 )
                              
                            vector 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                              
                            and the 
                              
                                 (
                                 HK
                                 ×
                                 HK
                                 )
                              
                            matrix 
                              
                                 
                                    
                                       Q
                                    
                                    
                                       i
                                    
                                 
                              
                            that can be evaluated from the posterior distribution 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 h
                                 )
                              
                            as follows: Let 
                              
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                                 )
                                 ,
                                 …
                                 ,
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       H
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 ]
                              
                            for 
                              
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 K
                              
                           , then we define:
                              
                                 (22)
                                 
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ≔
                                    
                                       
                                          [
                                          
                                             
                                                q
                                             
                                             
                                                1
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                q
                                             
                                             
                                                K
                                             
                                             
                                                i
                                             
                                          
                                          ]
                                       
                                       
                                          ⊤
                                       
                                    
                                    .
                                 
                              
                           Also, we let 
                              
                                 
                                    
                                       Q
                                    
                                    
                                       i
                                    
                                 
                              
                            be composed of 
                              
                                 (
                                 K
                                 ×
                                 K
                                 )
                              
                            blocks where each block is of size 
                              
                                 (
                                 H
                                 ×
                                 H
                                 )
                              
                           . Denoting the 
                              
                                 (
                                 j
                                 ,
                                 l
                                 )
                              
                            block of 
                              
                                 
                                    
                                       Q
                                    
                                    
                                       i
                                    
                                 
                              
                            by 
                              
                                 
                                    
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       j
                                       ,
                                       l
                                    
                                 
                              
                            for 
                              
                                 j
                                 ,
                                 l
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 K
                              
                           , the blocks are defined as: (i) 
                              
                                 
                                    
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       j
                                       ,
                                       j
                                    
                                 
                                 ≔
                                 diag
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                            where 
                              
                                 diag
                                 (
                                 v
                                 )
                              
                            indicates the diagonal matrix formed from vector 
                              
                                 v
                              
                           , (ii) for 
                              
                                 j
                                 <
                                 l
                              
                           , we define:
                              
                                 (23)
                                 
                                    
                                       
                                          (
                                          
                                             
                                                Q
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       
                                          j
                                          ,
                                          l
                                       
                                    
                                    ≔
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      =
                                                      0
                                                      ,
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      =
                                                      0
                                                      )
                                                   
                                                   
                                                      ⋯
                                                   
                                                   
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      =
                                                      0
                                                      ,
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                   
                                                      ⋱
                                                   
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      =
                                                      0
                                                      )
                                                   
                                                   
                                                      ⋯
                                                   
                                                   
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           and (iii) 
                              
                                 
                                    
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       l
                                       ,
                                       j
                                    
                                 
                                 ≔
                                 
                                    
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       j
                                       ,
                                       l
                                    
                                    
                                       ⊤
                                    
                                 
                              
                            for 
                              
                                 j
                                 <
                                 l
                              
                           .

Then it is not difficult to see that the first term of (21) can be expressed as:
                              
                                 (24)
                                 
                                    -
                                    2
                                    
                                       
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       
                                          ⊤
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             K
                                          
                                       
                                    
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                    [
                                    
                                       
                                          f
                                       
                                       
                                          
                                             
                                                h
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    ]
                                    =
                                    -
                                    2
                                    
                                       
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       
                                          ⊤
                                       
                                    
                                    (
                                    
                                       
                                          Fq
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                 
                              
                           while the second term being:
                              
                                 (25)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                             
                                             [
                                             ‖
                                             
                                                
                                                   f
                                                
                                                
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             
                                                
                                                   ‖
                                                
                                                
                                                   2
                                                
                                                
                                                   2
                                                
                                             
                                             ]
                                             +
                                             2
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      <
                                                      l
                                                   
                                                
                                             
                                             
                                                
                                                   E
                                                
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  f
                                                               
                                                               
                                                                  
                                                                     
                                                                        h
                                                                     
                                                                     
                                                                        j
                                                                     
                                                                  
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            ⊤
                                                         
                                                      
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  l
                                                               
                                                            
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    =
                                    Tr
                                    (
                                    
                                       
                                          FQ
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          F
                                       
                                       
                                          ⊤
                                       
                                    
                                    )
                                    ,
                                 
                              
                           where 
                              
                                 Tr
                                 (
                                 ·
                                 )
                              
                            indicates the trace operator.

Hence, minimization of (21) (i.e., maximization of (20)) summed over i, with respect to 
                              
                                 F
                              
                           , amounts to convex quadratic optimization, which admits the closed-form solution,
                              
                                 (26)
                                 
                                    F
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      n
                                                   
                                                
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                       
                                          †
                                       
                                    
                                    ,
                                 
                              
                           where 
                              
                                 
                                    
                                       A
                                    
                                    
                                       †
                                    
                                 
                              
                            is the Moore–Penrose pseudoinverse of 
                              
                                 A
                              
                           . After (26), one may need to reset 
                              
                                 
                                    
                                       f
                                    
                                    
                                       0
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                              
                            for 
                              
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 K
                              
                            if necessary.

Furthermore, one can take into account the dependency of 
                              
                                 F
                              
                            on the actual base features 
                              
                                 B
                              
                           , i.e., (9). Replacing 
                              
                                 F
                              
                            with 
                              
                                 BD
                              
                            in (24) and (25) followed by solving the optimization with respect to 
                              
                                 B
                              
                            results in the following M-step optimum:
                              
                                 (27)
                                 
                                    B
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      n
                                                   
                                                
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   D
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                D
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                             
                                          
                                       
                                       
                                          †
                                       
                                    
                                    .
                                 
                              
                           Finally, the optimal 
                              
                                 σ
                              
                            can be obtained by maximizing (20) with the optimal 
                              
                                 F
                              
                            plugged in, which becomes:
                              
                                 (28)
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          nd
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          h
                                          )
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         -
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               
                                                                  
                                                                     h
                                                                  
                                                                  
                                                                     j
                                                                  
                                                               
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           The overall maximum likelihood learning algorithm is summarized in Algorithm 1.
                              Algorithm 1
                              Maximum Likelihood Learning. 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   Input: Training data 
                                                      
                                                         
                                                            
                                                               {
                                                               (
                                                               
                                                                  
                                                                     c
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               )
                                                               }
                                                            
                                                            
                                                               i
                                                               =
                                                               1
                                                            
                                                            
                                                               n
                                                            
                                                         
                                                      
                                                    and initial 
                                                      
                                                         Θ
                                                         =
                                                         {
                                                         θ
                                                         ,
                                                         η
                                                         ,
                                                         F
                                                         ,
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         }
                                                      
                                                   .
                                             
                                             
                                                
                                                   Output: Learned model parameters 
                                                      
                                                         Θ
                                                      
                                                   .
                                             
                                             
                                                Learn 
                                                      
                                                         θ
                                                      
                                                    by gradient ascent MRF 
                                                      
                                                         P
                                                         (
                                                         c
                                                         )
                                                      
                                                    training with LEG constraints.
                                             
                                             
                                                Alternate the following EM steps until convergence:
                                             
                                             
                                                
                                                   (E) For each 
                                                      
                                                         i
                                                         =
                                                         1
                                                         ,
                                                         …
                                                         ,
                                                         n
                                                      
                                                   , infer 
                                                      
                                                         
                                                            
                                                               q
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         (
                                                         h
                                                         )
                                                         =
                                                         P
                                                         (
                                                         h
                                                         |
                                                         
                                                            
                                                               c
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                    w.r.t. current 
                                                      
                                                         Θ
                                                      
                                                   .
                                             
                                             
                                                
                                                   (M) Solve 
                                                      
                                                         max
                                                      
                                                    
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               i
                                                               =
                                                               1
                                                            
                                                            
                                                               n
                                                            
                                                         
                                                         
                                                            
                                                               E
                                                            
                                                            
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               (
                                                               h
                                                               )
                                                            
                                                         
                                                         [
                                                         log
                                                         P
                                                         (
                                                         h
                                                         ,
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         |
                                                         
                                                            
                                                               c
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                         ]
                                                      
                                                    via (19), (26)–(28).
                                             
                                             
                                                Return the final 
                                                      
                                                         Θ
                                                      
                                                   .
                                             
                                          
                                       
                                    
                                 
                              

In the ML learning the main focus is on overall fitting of the model to data, hence not so discriminative that can result in suboptimal classification performance. As recently studied in the machine learning literature, the estimator that aims to explicitly separate (and enlarge) the margin at the class boundaries can yield superior performance to the traditional ML learning [19–23]. While the large-margin learning has been studied more on standard single-label classification,
                           2
                           Models for multi-label classification have been considered in some recent work [24,25]. Unlike our approach, however, these methods either focus on models with no latent variables, or approximates learning problems to quadratic energy optimization for tractable inference.
                        
                        
                           2
                         we extend it to our multi-concept generative model for the multi-label classification problem.

To formulate the maximum-margin learning, we consider the score function 
                           
                              s
                              (
                              c
                              ,
                              x
                              )
                           
                        , defined to be the log-likelihood under the joint class-feature distribution model, namely
                           
                              (29)
                              
                                 s
                                 (
                                 c
                                 ,
                                 x
                                 ;
                                 Θ
                                 )
                                 ≔
                                 log
                                 P
                                 (
                                 c
                                 ,
                                 x
                                 ;
                                 Θ
                                 )
                                 .
                              
                           
                        The score function can be seen as a negative energy function that assigns higher confidence value to the more likely class configuration 
                           
                              c
                           
                         given 
                           
                              x
                           
                        . We will often drop the dependency on 
                           
                              Θ
                           
                         in notation for simplicity.

For a training pair 
                           
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        , the margin between the true class vector 
                           
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                         and any other candidate 
                           
                              c
                              
                              ≠
                              
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                         can be defined as (or proportional to) their score difference, i.e., 
                           
                              s
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ;
                              Θ
                              )
                              -
                              -
                              s
                              (
                              c
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ;
                              Θ
                              )
                           
                        . Naturally, models that result in large positive margins for all 
                           
                              c
                              
                              ≠
                              
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                         are preferred to others. However, as is also observed in [22], instead of imposing equal importance across all 
                           
                              c
                              
                              ≠
                              
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                        , it is rather more reasonable to allow small margins for those 
                           
                              c
                           
                        ’s quite similar to 
                           
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                        , while strongly enforcing the candidates far more distant from 
                           
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                         to retain larger margins.

This idea can be represented as the following optimization with the large margin constraints (with the non-negative slack variables 
                           
                              
                                 
                                    ξ
                                 
                                 
                                    i
                                 
                              
                           
                        ’s introduced):
                           
                              (30)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   Θ
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                
                                             
                                          
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          +
                                          
                                             
                                                γ
                                             
                                             
                                                2
                                             
                                          
                                          ‖
                                          Θ
                                          
                                             
                                                ‖
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                       
                                       
                                          s
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          ;
                                          Θ
                                          )
                                          -
                                          s
                                          (
                                          c
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          ;
                                          Θ
                                          )
                                          ⩾
                                          l
                                          (
                                          c
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          -
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                       
                                          ∀
                                          c
                                          
                                          ≠
                                          
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          ⩾
                                          0
                                          ,
                                          
                                          i
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          n
                                          ,
                                       
                                    
                                 
                              
                           
                        where 
                           
                              l
                              (
                              c
                              ,
                              
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         is the distance (or discrepancy) between 
                           
                              c
                           
                         and 
                           
                              
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                           
                        , having small values if 
                           
                              c
                           
                         and 
                           
                              
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                           
                         are close to each other, and vice versa. A typical choice, also used throughout in our experiments, is the Hamming distance, 
                           
                              l
                              (
                              c
                              ,
                              
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              )
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    K
                                 
                              
                              I
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              
                              ≠
                              
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                        . Note that we also regularize the model smoothness in the objective (with the balancing constant 
                           
                              γ
                              ⩾
                              0
                           
                        ), which indeed applies only to the undirected model parameters (i.e., 
                           
                              θ
                           
                         in 
                           
                              P
                              (
                              c
                              )
                           
                        ).

In the constraints of (30), if we confine
                           3
                           It does not incur any loss of generality since one can always add a constant offset to 
                                 
                                    l
                                    (
                                    ·
                                    ,
                                    ·
                                    )
                                 
                               without affecting the optimal solution.
                        
                        
                           3
                         
                        
                           
                              l
                              (
                              c
                              ,
                              c
                              )
                              =
                              0
                           
                        , including the case 
                           
                              c
                              =
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                         simply reduces to 
                           
                              
                                 
                                    ξ
                                 
                                 
                                    i
                                 
                              
                              ⩾
                              0
                           
                        . Hence, including 
                           
                              c
                              =
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                         while removing the non-negativity constraints, does not alter the original problem. The rephrased constraints are as follows:
                           
                              (31)
                              
                                 s
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ;
                                 Θ
                                 )
                                 -
                                 s
                                 (
                                 c
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ;
                                 Θ
                                 )
                                 ⩾
                                 l
                                 (
                                 c
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 -
                                 
                                    
                                       ξ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                 ∀
                                 c
                                 ,
                                 
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                                 .
                              
                           
                        Furthermore, by focusing on the most violating case, (31) can be equivalently written as:
                           
                              (32)
                              
                                 s
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ;
                                 Θ
                                 )
                                 -
                                 
                                    
                                       
                                          max
                                       
                                       
                                          c
                                       
                                    
                                 
                                 
                                    
                                       
                                          s
                                          (
                                          c
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          ;
                                          Θ
                                          )
                                          +
                                          l
                                          (
                                          c
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ⩾
                                 -
                                 
                                    
                                       ξ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                                 .
                              
                           
                        As (32) essentially forms the lower bound for each 
                           
                              
                                 
                                    ξ
                                 
                                 
                                    i
                                 
                              
                           
                        , the original problem (30) can be equivalently expressed as:
                           
                              (33)
                              
                                 
                                    
                                       
                                          min
                                       
                                       
                                          Θ
                                       
                                    
                                 
                                 
                                 
                                    
                                       γ
                                    
                                    
                                       2
                                    
                                 
                                 ‖
                                 Θ
                                 
                                    
                                       ‖
                                    
                                    
                                       2
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   max
                                                
                                                
                                                   c
                                                
                                             
                                          
                                          
                                             
                                                
                                                   s
                                                   (
                                                   c
                                                   ,
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ;
                                                   Θ
                                                   )
                                                   +
                                                   l
                                                   (
                                                   c
                                                   ,
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          -
                                          s
                                          (
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          ;
                                          Θ
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

In optimizing (33), there are two computational issues: (i) evaluating the score function 
                           
                              s
                              (
                              c
                              ,
                              x
                              )
                           
                         is demanding since it requires marginalization over 
                           
                              h
                           
                         and (ii) maximization over 
                           
                              c
                           
                         in the objective requires to consider the exponential number of configurations. In both, the main difficulty lies in dealing with the exponential numbers of cases even for evaluating the objective, not alone its gradient.

To address these issues we propose a novel approximation strategy for faster optimization. The basic idea is to approximate the sum (or max) of the function values over a set of exponential cardinality by a single function value at its mode, while treating that mode point as constant. To retain accurate approximation, we confine the feasible model space to be a local neighborhood of the current model 
                           
                              Θ
                           
                         such that the mode of the function does not vary much along 
                           
                              Θ
                           
                        . Once we find the optimal model near the current one, we repeat the procedure (evaluate the mode points and have functions approximated at the modes treating them constant) on and on until convergence. The technical details are described in the following.

Since the score function on each training sample 
                           
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         in (33) is the soft-max function of 
                           
                              log
                              P
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              h
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         over 
                           
                              h
                           
                        , namely 
                           
                              s
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              log
                              
                                 
                                    ∑
                                 
                                 
                                    h
                                 
                              
                              
                                 
                                    e
                                 
                                 
                                    log
                                    P
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    h
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                           
                        , we first approximate it as the max function, that is, 
                           
                              
                                 
                                    max
                                 
                                 
                                    h
                                 
                              
                              log
                              P
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              h
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        . Letting 
                           
                              
                                 
                                    
                                       
                                          h
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              ≔
                              arg
                              
                                 
                                    max
                                 
                                 
                                    h
                                 
                              
                              P
                              (
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              h
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        , we can further approximate the score as:
                           
                              (34)
                              
                                 s
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 ≈
                                 log
                                 P
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             h
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 ,
                              
                           
                        with 
                           
                              
                                 
                                    
                                       
                                          h
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                           
                         fixed as constant during the optimization. Precisely, however, since 
                           
                              
                                 
                                    
                                       
                                          h
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                           
                         is dependent on 
                           
                              Θ
                           
                        , this approximation is valid only for the model parameters in the vicinity of the current iterate 
                           
                              Θ
                           
                        . Obtaining 
                           
                              
                                 
                                    
                                       
                                          h
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                           
                         can be done by running an approximate decoding algorithm (e.g., max-product version of the LBP) over the MRF model 
                           
                              P
                              (
                              h
                              |
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        , exactly the same model used in (15)–(17) constructed at the current model.

Next, to handle the max function in (33), 
                           
                              
                                 
                                    max
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    
                                       s
                                       (
                                       c
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       ;
                                       Θ
                                       )
                                       +
                                       l
                                       (
                                       c
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        , again we first replace the score function (soft-max) therein by the max over 
                           
                              h
                           
                        , namely
                           
                              (35)
                              
                                 
                                    
                                       
                                          max
                                       
                                       
                                          c
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   max
                                                
                                                
                                                   h
                                                
                                             
                                          
                                          log
                                          P
                                          (
                                          c
                                          ,
                                          h
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          +
                                          l
                                          (
                                          c
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          max
                                       
                                       
                                          c
                                          ,
                                          h
                                       
                                    
                                 
                                 
                                    
                                       
                                          log
                                          P
                                          (
                                          c
                                          ,
                                          h
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          +
                                          l
                                          (
                                          c
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        We denote the optimal pair of the joint maximization (35) by 
                           
                              (
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          h
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        . Finding the optimal pair can be done similarly by approximate decoding on the joint MRF model over 
                           
                              (
                              c
                              ,
                              h
                              )
                           
                        , where its potential functions are built from 
                           
                              P
                              (
                              c
                              ,
                              h
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         as well as the Hamming distance term incorporated in the node potentials. The details can be found in Appendix A. The score is then approximated as:
                           
                              (36)
                              
                                 
                                    
                                       
                                          max
                                       
                                       
                                          c
                                       
                                    
                                 
                                 
                                    
                                       
                                          s
                                          (
                                          c
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          ;
                                          Θ
                                          )
                                          +
                                          l
                                          (
                                          c
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ≈
                                 log
                                 P
                                 (
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             h
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 +
                                 l
                                 (
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 ,
                              
                           
                        with 
                           
                              (
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          h
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         assumed fixed as constant. Treating 
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                           
                         as constant (in the vicinity of the current model) renders the second term 
                           
                              l
                              (
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         independent of the model parameters, hence we drop it in the optimization.

Plugging the above approximates, we have the following optimization problem that approximates the original (33):
                           
                              (37)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   Θ
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                γ
                                             
                                             
                                                2
                                             
                                          
                                          ‖
                                          Θ
                                          
                                             
                                                ‖
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                
                                             
                                          
                                          
                                             
                                                
                                                   log
                                                   P
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               c
                                                            
                                                            
                                                               ∼
                                                            
                                                         
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               ∼
                                                            
                                                         
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   -
                                                   log
                                                   P
                                                   (
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               ^
                                                            
                                                         
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                       
                                       
                                          ‖
                                          Θ
                                          -
                                          
                                             
                                                Θ
                                             
                                             
                                                old
                                             
                                          
                                          
                                             
                                                ‖
                                             
                                             
                                                2
                                             
                                          
                                          ⩽
                                          ∊
                                          ,
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    Θ
                                 
                                 
                                    old
                                 
                              
                           
                         denotes the current model parameters for which all the mode points are evaluated, and 
                           
                              ∊
                           
                         is a small positive constant that defines the feasible space, the neighborhood around the current model. It is worth noting that our strategy of approximating the objective function in the vicinity of the current parameters is closely related to the trust-region methods [26]. Although we fixed the neighborhood size 
                           
                              ∊
                           
                         in our experiments, one can potentially extend it to be adjusted dynamically based on the quality of approximation, which is a well-known strategy in the trust region literature.

Instead of solving the constrained optimization problem of (37), we migrate the vicinity constraint into the objective in a penalized form, namely 
                           
                              
                                 
                                    λ
                                 
                                 
                                    2
                                 
                              
                              ‖
                              Θ
                              -
                              
                                 
                                    Θ
                                 
                                 
                                    old
                                 
                              
                              
                                 
                                    ‖
                                 
                                 
                                    2
                                 
                                 
                                    2
                                 
                              
                           
                        , yielding an unconstrained problem. Here 
                           
                              λ
                              (
                              ⩾
                              0
                              )
                           
                         is inversely related to 
                           
                              ∊
                           
                        , and can be properly chosen. Due to our log-linear parameterization of 
                           
                              P
                              (
                              c
                              )
                           
                         as well as the linear Gaussian feature emission modeling 
                           
                              P
                              (
                              x
                              |
                              h
                              )
                           
                        , the full joint log-likelihoods in (37) are quadratic functions of 
                           
                              F
                           
                         (or 
                           
                              B
                           
                        ), and linear in 
                           
                              θ
                           
                        . Note, however, that they are rather more involved with respect to 
                           
                              σ
                           
                         and 
                           
                              η
                           
                        . Hence we fix 
                           
                              σ
                           
                         and 
                           
                              η
                           
                         as those from the ML estimates for simplicity, and do optimization over 
                           
                              θ
                           
                         and 
                           
                              F
                           
                         (or 
                           
                              B
                           
                        ) only.

We introduce some more notations below. The difference of features in the MRF model 
                           
                              P
                              (
                              c
                              )
                           
                         is denoted as:
                           
                              (38)
                              
                                 Δ
                                 
                                    
                                       ϕ
                                    
                                    
                                       i
                                    
                                 
                                 ≔
                                 ϕ
                                 (
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 -
                                 ϕ
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 .
                              
                           
                        For a given 
                           
                              h
                           
                        , we define 
                           
                              q
                              (
                              h
                              )
                           
                         as the 
                           
                              (
                              HK
                              ×
                              1
                              )
                           
                         vector similarly structured as (22) except that the posterior function 
                           
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                              
                              (
                              ·
                              )
                           
                         replaced by the predicate 
                           
                              I
                              (
                              ·
                              )
                           
                        . Similarly, 
                           
                              Q
                              (
                              h
                              )
                           
                         is the 
                           
                              (
                              HK
                              ×
                              HK
                              )
                           
                         matrix of the form (23) with 
                           
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                              
                              (
                              ·
                              )
                           
                         replaced by 
                           
                              I
                              (
                              ·
                              )
                           
                        . Then we define the following differences:
                           
                              (39)
                              
                                 Δ
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ≔
                                 q
                                 (
                                 
                                    
                                       
                                          
                                             h
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 -
                                 q
                                 (
                                 
                                    
                                       
                                          
                                             h
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 ,
                                 
                                 Δ
                                 
                                    
                                       Q
                                    
                                    
                                       i
                                    
                                 
                                 ≔
                                 Q
                                 (
                                 
                                    
                                       
                                          
                                             h
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 -
                                 Q
                                 (
                                 
                                    
                                       
                                          
                                             h
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 .
                              
                           
                        
                     

Using these new notations, it is easy to see that the optimization problem (i.e., the unconstrained version of (37) with 
                           
                              σ
                              ,
                              η
                           
                         fixed) can be written as:
                           
                              (40)
                              
                                 
                                    
                                       
                                          min
                                       
                                       
                                          θ
                                          ,
                                          F
                                       
                                    
                                 
                                 
                                 
                                    
                                       
                                          
                                             
                                                γ
                                             
                                             
                                                2
                                             
                                          
                                          ‖
                                          θ
                                          
                                             
                                                ‖
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                λ
                                             
                                             
                                                2
                                             
                                          
                                          ‖
                                          θ
                                          -
                                          
                                             
                                                θ
                                             
                                             
                                                old
                                             
                                          
                                          
                                             
                                                ‖
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                λ
                                             
                                             
                                                2
                                             
                                          
                                          ‖
                                          F
                                          -
                                          
                                             
                                                F
                                             
                                             
                                                old
                                             
                                          
                                          
                                             
                                                ‖
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         ϕ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         2
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            Tr
                                                            (
                                                            F
                                                            Δ
                                                            
                                                               
                                                                  Q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            
                                                               
                                                                  F
                                                               
                                                               
                                                                  ⊤
                                                               
                                                            
                                                            )
                                                            -
                                                            2
                                                            
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                               
                                                                  ⊤
                                                               
                                                            
                                                            F
                                                            Δ
                                                            
                                                               
                                                                  q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        It is also straightforward to rewrite (40) in terms of 
                           
                              B
                           
                         using (9) in lieu of 
                           
                              F
                           
                        .

The problem thus becomes convex quadratic optimization (for 
                           
                              λ
                           
                         large enough), and the closed-form optima can be obtained, without resorting to time-consuming line search, as:
                           
                              (41)
                              
                                 θ
                                 =
                                 
                                    
                                       λ
                                    
                                    
                                       γ
                                       +
                                       λ
                                    
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       old
                                    
                                 
                                 -
                                 
                                    
                                       1
                                    
                                    
                                       γ
                                       +
                                       λ
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          n
                                       
                                    
                                 
                                 Δ
                                 
                                    
                                       ϕ
                                    
                                    
                                       i
                                    
                                 
                              
                           
                        
                        
                           
                              (42)
                              
                                 F
                                 =
                                 
                                    
                                       
                                          λ
                                          
                                             
                                                F
                                             
                                             
                                                old
                                             
                                          
                                          -
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                
                                             
                                          
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                (
                                                Δ
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                             
                                                ⊤
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             λ
                                             I
                                             -
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      n
                                                   
                                                
                                             
                                             Δ
                                             
                                                
                                                   Q
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                    
                                       †
                                    
                                 
                              
                           
                        
                        
                           
                              (43)
                              
                                 B
                                 =
                                 
                                    
                                       
                                          λ
                                          
                                             
                                                B
                                             
                                             
                                                old
                                             
                                          
                                          -
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                
                                             
                                          
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                (
                                                Δ
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                             
                                                ⊤
                                             
                                          
                                          
                                             
                                                D
                                             
                                             
                                                ⊤
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             λ
                                             I
                                             -
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             D
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      n
                                                   
                                                
                                             
                                             Δ
                                             
                                                
                                                   Q
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                
                                                   D
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                    
                                    
                                       †
                                    
                                 
                              
                           
                        Hence, the optimization can be done very fast as one-shot learning once the mode points 
                           
                              
                                 
                                    
                                       
                                          h
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          h
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                           
                         are decoded from probabilistic inference.
                           Algorithm 2
                           Max-Margin Learning 
                                 
                                    
                                       
                                       
                                          
                                             
                                                Input: Training data 
                                                   
                                                      
                                                         
                                                            {
                                                            (
                                                            
                                                               
                                                                  c
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            )
                                                            }
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            n
                                                         
                                                      
                                                   
                                                 and initial 
                                                   
                                                      Θ
                                                   
                                                 from the MLE.
                                          
                                          
                                             
                                                Output: Learned model parameters 
                                                   
                                                      Θ
                                                   
                                                .
                                          
                                          
                                             Repeat until convergence:
                                          
                                          
                                             
                                                Set 
                                                   
                                                      
                                                         
                                                            Θ
                                                         
                                                         
                                                            old
                                                         
                                                      
                                                      =
                                                      Θ
                                                   
                                                .
                                          
                                          
                                             
                                                Decode for each 
                                                   
                                                      i
                                                      =
                                                      1
                                                      ,
                                                      …
                                                      ,
                                                      n
                                                   
                                                ,
                                          
                                          
                                             
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      arg
                                                      
                                                         
                                                            max
                                                         
                                                         
                                                            h
                                                         
                                                      
                                                      P
                                                      (
                                                      
                                                         
                                                            c
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      h
                                                      ,
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ;
                                                      
                                                         
                                                            Θ
                                                         
                                                         
                                                            old
                                                         
                                                      
                                                      )
                                                   
                                                , and
                                          
                                          
                                             
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               
                                                                  c
                                                               
                                                               
                                                                  ∼
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            
                                                               
                                                                  h
                                                               
                                                               
                                                                  ∼
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      arg
                                                      
                                                         
                                                            max
                                                         
                                                         
                                                            c
                                                            ,
                                                            h
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               log
                                                               P
                                                               (
                                                               c
                                                               ,
                                                               h
                                                               ,
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ;
                                                               
                                                                  
                                                                     Θ
                                                                  
                                                                  
                                                                     old
                                                                  
                                                               
                                                               )
                                                               +
                                                               l
                                                               (
                                                               c
                                                               ,
                                                               
                                                                  
                                                                     c
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                .
                                          
                                          
                                             
                                                Update 
                                                   
                                                      Θ
                                                   
                                                 with 
                                                   
                                                      η
                                                   
                                                 and 
                                                   
                                                      F
                                                   
                                                 (or 
                                                   
                                                      B
                                                   
                                                ) using (41)–(43).
                                          
                                          
                                             Return the final 
                                                   
                                                      Θ
                                                   
                                                .
                                          
                                       
                                    
                                 
                              
                           

After we find the optimal model near the current one as above, we repeat the procedure (i.e., evaluate the mode points and approximate functions at the modes treating them constant) on and on, until convergence. The overall algorithm is summarized in Algorithm 2. The time complexity of the algorithm is identical to that of the EM learning, while in practice the MM learning is slower since the amount of updates in successive iterations is restricted to be no greater than the neighborhood radius 
                           
                              ∊
                           
                        .

@&#RELATED WORK@&#

The multi-label data classification has received significant attention in machine learning and computer vision for the last decades, due to the inherent generalization of the standard single-label classification, not alone its wide spectrum of applications including image and document classification. Although many different approaches to multi-label (image) classification have been proposed, they can broadly fall into the following three categories.

First, some approaches are based on the probabilistic models of class labels and features. For instance, the maximum entropy model was suggest to capture the label correlation [27]. In [3] a generative model was built to exploit the pairwise label correlation. In [28] a generative model of image features with text information is learned via EM to automatically annotate images with keywords. The Gaussian mixture models have been studied including the supervised multi-class labeling (SML) [29] and the multiple Bernoulli relevance model (MBRM) [30]. They differ in several aspects from our model: the SML forms a mixture with components for modeling local features, while the MBRM uses training images as components. The continuous-space relevance model (CRM) [31], similar in nature to the SML, aims to represent local regions aiming to model the association between concepts and features. Some other approaches are based on Bayesian latent topic models like LDA [32].

The other widely studied approaches are based on the distance metrics, where the class labels are predicted by nearest neighbor fashion, or more generally the so-called label propagation along the graph with the distance. Due to the diverse types of features, and distance metrics accordingly, how to combine multiple different distance measures into the most discriminative one becomes a critical problem. In [2] it was shown on several benchmark datasets that the simple equal weighting scheme can yield significant performance improvement. More sophisticated approaches like learning the weighted nearest neighbors (e.g., TagProp [1]) were shown to further improve the classification accuracy.

Recently, based on the idea of the dictionary learning, some non-parametric models have been proposed [5]. The methods, instead of learning a particular model or distance metrics, they regard the whole data as a pool of base features used to construct the novel features. Conforming to linear representation (LR), they basically enforce the weights across the data samples to be shared for the class label construction as well. Further considering the label exclusiveness constraints (LELR) and the label co-occurrence (LCLR) observed from data, they attained far more accurate prediction results.

Although all these existing approaches aim to capture the correlation between class labels and features, or estimate the overall distance metrics that can be used for concept propagation, our model is different in that we represent the core generative process of how the multiple active concepts are combined and fused into the observed features.

In this section we test the performance of the proposed multi-concept feature generative model estimated by two learning algorithms. We denote our methods as MCG-ML and MCG-MM, models learned by maximum-likelihood and maximum-margin, respectively. We mostly deal with the multi-label image classification problem, testing on several popular benchmark datasets. For each dataset, we provide comparison with some of the existing recent methods to demonstrate the effectiveness of the proposed approaches.

To highlight the effectiveness of the learning algorithms, we first consider a fairly simple synthetic data setup in this section. The underlying generative model is indeed quite similar to the proposed generative model. There are 
                           
                              K
                              =
                              10
                           
                         concepts where each concept j is associated with three base features, 
                           
                              {
                              
                                 
                                    b
                                 
                                 
                                    1
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    b
                                 
                                 
                                    2
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    b
                                 
                                 
                                    3
                                 
                                 
                                    j
                                 
                              
                              }
                           
                         which are randomly chosen from the 
                           
                              0
                           
                        -mean spherical Gaussian with unit variances. The feature dimension is 
                           
                              d
                              =
                              20
                           
                        . We generate 
                           
                              n
                              =
                              1000
                           
                         samples from the following process.

For each 
                           
                              i
                              =
                              1
                              ,
                              …
                              ,
                              n
                           
                        ,
                           
                              1.
                              Generate 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             i
                                          
                                       
                                    
                                  from the binary pairwise MRF where each node corresponds to each of K concepts. We partition the concepts into three groups, 
                                    
                                       
                                          
                                             g
                                          
                                          
                                             1
                                          
                                       
                                       =
                                       {
                                       1
                                       ,
                                       2
                                       ,
                                       3
                                       }
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             2
                                          
                                       
                                       =
                                       {
                                       4
                                       ,
                                       5
                                       ,
                                       6
                                       }
                                    
                                 , and 
                                    
                                       
                                          
                                             g
                                          
                                          
                                             3
                                          
                                       
                                       =
                                       {
                                       7
                                       ,
                                       8
                                       ,
                                       9
                                       ,
                                       10
                                       }
                                    
                                 , such that the concepts from different groups should not occur simultaneously. This can be attained by setting the parameters 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             e
                                          
                                          
                                             11
                                          
                                       
                                    
                                  of all inter-group edges as 
                                    
                                       -
                                       ∞
                                    
                                 . All the other parameters are independently chosen from the standard normal.

For each concept j, the base feature index 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             j
                                          
                                       
                                    
                                  is chosen from the multinomial distribution with parameter 
                                    
                                       [
                                       0.4
                                       
                                       0.3
                                       
                                       0.3
                                       ]
                                    
                                 , which is the same for all j.

For each active concept j (
                                    
                                       
                                          
                                             c
                                          
                                          
                                             j
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       1
                                    
                                 ), the significance level 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             j
                                          
                                       
                                    
                                  is chosen uniformly at random from 
                                    
                                       {
                                       0.1
                                       ,
                                       0.2
                                       ,
                                       …
                                       ,
                                       1.0
                                       }
                                    
                                 .

We then generate the feature 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                    
                                  from (1) with 
                                    
                                       σ
                                       =
                                       0.5
                                    
                                 .

The data samples are then randomly split into 70%/30% training/test sets. Note that only the class labels 
                           
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                         and features 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                           
                         are known to the competing methods.

In our MCG model, the significance level set is chosen as 
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              ∈
                              {
                              0.1
                              ,
                              0.2
                              ,
                              …
                              ,
                              1.0
                              }
                           
                         with the number of base features 
                           
                              M
                              =
                              3
                           
                        , thus the cardinality of 
                           
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                           
                         being 
                           
                              H
                              =
                              31
                           
                        . In the ML learning, the initial model parameters are chosen randomly, while we run the EM steps up to 20 iterations or until convergence. The procedure is repeated with several different initial parameters, then the one with the highest likelihood is selected. The MM learning starts with the ML estimate, where we use the smoothness regularization parameter 
                           
                              γ
                              =
                              10
                           
                         and the neighborhood regularizer 
                           
                              λ
                              =
                              10
                           
                        , which are jointly found from grid search on some held-out portion of the training data. We compute the empirical concept label counts from the training data, and feed them into the Graph-Shift algorithm [13] to retrieve the exclusive label groups LEG.

For the competing approaches, we first consider the fairly standard baseline method, which solves each single-label classification for each of the K concepts independently. We use the logistic regression classifier for learning the single-label predictors, and denote the method by LR-Ind. We also contrast with the recent chain classifiers (Chain) [33] which aim for exploiting the multi-label structure of the problem by building a chain of the labels, and learning/predicting each label using the covariates formed by the original feature vector and the previous labels in the chain. We used the logistic regression as the base classifiers for this model. The other approaches are the label-exclusive and the label co-occurrence linear representation (LELR and LCLR) methods [5], which recently exhibited superb performance in the multi-label learning tasks.

The average precision (AP) measure is computed for each keyword that computes the average precision for retrieved relevant images [34]. The mean AP (mAP) is the average of AP’s over entire keywords. The AP measure is suited for the multi-label classification task, while we also report the standard 0/1 accuracy measure. To compute the AP scores, the concept-wise confidence scores are required, and we use 
                           
                              P
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              |
                              
                                 
                                    h
                                 
                                 
                                    ∗
                                 
                              
                              ,
                              x
                              )
                           
                         where 
                           
                              
                                 
                                    h
                                 
                                 
                                    ∗
                                 
                              
                           
                         is the most-likely configuration decoded from (8).

The mAP scores and the 0/1 accuracies averaged over all concepts of the competing methods on test data are shown in Table 1
                        . The proposed generative model significantly outperforms the logistic regression model with independent single-label treatment for the multi-label data. The performance of the chain classifier is slightly worse than the independent label treatment, which can be possible and explained as: forming a chain-based prediction may accumulate the prediction errors along the classifier chain.

In addition the max-margin learning further improves the prediction accuracy over the ML estimate considerably. Although it is not rigorously analyzed why the non-parametric LCLR and LELR approaches had poor performance, it may be possibly attributed to the small number of data samples in estimating the reasonable weight distributions over training samples.

In this section and later sections, we test the proposed generative model on the multi-label image classification task for some real-world benchmark image datasets. The first dataset we deal with is the Corel-5K [35] which was widely used for testing methods for image retrieval and annotation. The dataset is comprised of 
                           
                              K
                              =
                              260
                           
                         concepts manually annotated for about 5000 images. The concept keywords are mostly the object category names. The dataset provides the fixed splits of training/test sets, roughly taking 90%/10% proportions of the entire samples.

We basically follow the experimental setups similar to those of [1,36]. For the image features, we extract the Gist features [37], the HSV color histograms, and the densely sampled local descriptors including the SIFT [16] and the Hue descriptors [38]. These features are then concatenated into a single feature vector. For our generative model, to reduce the computational overhead, we reduce the dimensionality to 500 taking the major principal coefficients.

For computational issue, we use 
                           
                              M
                              =
                              2
                           
                         base features per concept, and 
                           
                              S
                              =
                              5
                           
                         significance values. The hyperparameters chosen by cross validation in the MM estimation are 
                           
                              γ
                              =
                              10
                           
                         and 
                           
                              λ
                              =
                              100
                           
                        . The dataset was previously tested by several baseline approaches [2], and we contrast with their performances reported in the literature. They used the performance measures: mean precision (P), mean recall (R), and the mean AP. Following the method in [1], when computing P and R, we use the five most relevant keywords retrieved by the competing methods. Together with the previously reported results, the test performance is summarized in Table 2
                        .

In the table, JEC [2] is the equal weighting scheme over the distance metrics built for different features, JEC-15 is the equal weighting scheme combining distance metrics across 15 different features used in [1]. For the TagProp [1], we highlight the 
                           
                              σ
                           
                        -ML model which outperforms other variants oftentimes.

The dataset IAPR-TC12 [39] is comprised of about 20,000 images with 
                           
                              K
                              =
                              291
                           
                         auto-extracted concept keywords [2]. For the training/test set split with roughly 90%/10% proportion, the proposed MCG model is learned with the hyperparameters and optimization setups similar to those in the Corel-5K dataset. The hyperparameters were chosen by cross validation on the held-out portion of the training set The test performance of the competing approaches are shown in Table 3
                        .

The proposed approaches exhibit the best performance among others, comparable to the TagProp method. It emphasizes the effectiveness of capturing the active concept fusion in feature representation, compared to the methods simply resorting to the distance metric between features. Contrasting two learning algorithms, the improvement achieved by the max-margin estimator over the maximum-likelihood learning indicates the importance of the explicit separation of the decision boundary, together with overall fitting of a model to data.

We next test on the challenging image dataset called the PASCAL visual object classes (VOC) datasets [40,41]. It contains 9963 images (VOC-2007) and 21,738 images (VOC-2010) labeled with 
                           
                              K
                              =
                              20
                           
                         concepts including person, vehicle, dog, and so on. We follow the given split of training and test sets which take roughly equal proportions. We use the image features like densely sampled SIFT and HOG features similarly adopted in many other recent approaches, typically the two non-parametric linear representation approaches, LCLR and LELR [5].

In our MCG model, we use the 
                           
                              S
                              =
                              5
                           
                         significance levels as usual while the number of base features per concept is set to 
                           
                              M
                              =
                              3
                           
                         for both datasets. The hyperparameters of 
                           
                              γ
                           
                         and 
                           
                              λ
                           
                         in the max-margin learning are selected by grid search. In addition, for the VOC-2007 dataset, our approaches are contrasted with several other recent techniques whose performances were previously reported. They include the locality-constrained learning coding (LLC) [42], the INRIA genetic method (INRIA) [43], and the super vector coding approach (SVC) [34]. For the VOC-2010 dataset, our approaches are compared with the top-ranked linear algorithm called NUSPSL 
                        [44] as well as the LELR [5].

The average precision scores for individual concepts as well as the mean AP scores of the competing methods are shown in Tables 4 and 5
                        
                        . The proposed generative model approaches exhibit comparable performance to the LELR method. This can support the argument raised in [5] that it is important to take into account the label exclusive group constraints. Overall the considerable improvement in accuracy for our generative model can be resulted from the significance-weighted fusion of the base features, in conjunction with the principled probabilistic inference on the latent variables.

@&#CONCLUSION@&#

In this paper we have tackled the problem of multi-label classification using a novel probabilistic generative model that aims to represent the fusion of multiple active concepts in feature generation. We have associated concepts with multiple representative base feature vectors, and introduced exclusive latent random variables to encode the contribution levels, which framed the concept prediction task as probabilistic inference in a graphical model. Two parameter learning algorithms based on likelihood maximization and enlarging the margins at the class boundaries, have been shown to yield considerable performance improvement in several multi-label image classification tasks.

@&#ACKNOWLEDGMENT@&#

This study is supported by National Research Foundation of Korea (NRF-2013R1A1A1076101).

We describe in detail the joint MRF model 
                        
                           
                              
                                 P
                              
                              
                                 ∼
                              
                           
                           (
                           c
                           ,
                           h
                           )
                        
                      that is proportional to the following (non-negative) target function:
                        
                           (A.1)
                           
                              
                                 
                                    P
                                 
                                 
                                    ∼
                                 
                              
                              (
                              c
                              ,
                              h
                              )
                              ∝
                              exp
                              
                                 
                                    
                                       log
                                       P
                                       (
                                       c
                                       ,
                                       h
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       +
                                       κ
                                       ·
                                       l
                                       (
                                       c
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                 
                              
                              .
                           
                        
                     Two typical tasks that harness such an MRF are: (i) concept prediction for test data in (8) and (ii) the joint mode finding for discrepancy augmented joint likelihood in (35). The constant 
                        
                           κ
                           =
                           0
                        
                      for the former task, while 
                        
                           κ
                           =
                           1
                        
                      for the latter. We assume that 
                        
                           l
                           (
                           c
                           ,
                           
                              
                                 c
                              
                              
                                 i
                              
                           
                           )
                        
                      is fully decomposed, like say Hamming distance, 
                        
                           l
                           (
                           c
                           ,
                           
                              
                                 c
                              
                              
                                 i
                              
                           
                           )
                           =
                           
                              
                                 ∑
                              
                              
                                 j
                              
                           
                           I
                           (
                           
                              
                                 c
                              
                              
                                 j
                              
                           
                           
                           ≠
                           
                           
                              
                                 c
                              
                              
                                 j
                              
                              
                                 i
                              
                           
                           )
                        
                     .

Due to the independency structure of 
                        
                           P
                           (
                           c
                           ,
                           h
                           ,
                           x
                           )
                        
                      as shown in Fig. 1, the MRF can be decomposed into node potentials on the individual variables, and edge potentials on the pairs of 
                        
                           (
                           
                              
                                 c
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 c
                              
                              
                                 l
                              
                           
                           )
                           ,
                           (
                           
                              
                                 h
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 h
                              
                              
                                 l
                              
                           
                           )
                        
                     , and 
                        
                           (
                           
                              
                                 c
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 h
                              
                              
                                 j
                              
                           
                           )
                        
                      as follows:
                        
                           (A.2)
                           
                              
                                 
                                    P
                                 
                                 
                                    ∼
                                 
                              
                              (
                              c
                              ,
                              h
                              )
                              ∝
                              exp
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      c
                                                   
                                                
                                                (
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                +
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      h
                                                   
                                                
                                                (
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                +
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      ch
                                                   
                                                
                                                (
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                   
                                                
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                <
                                                l
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      cc
                                                   
                                                
                                                (
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                   
                                                
                                                ,
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                +
                                                
                                                   
                                                      μ
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      hh
                                                   
                                                
                                                (
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      j
                                                   
                                                
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     Arranging the exponent in (A.1) renders the node log-potentials for the variables 
                        
                           c
                        
                      and 
                        
                           h
                        
                      determined as:
                        
                           (A.3)
                           
                              
                                 
                                    μ
                                 
                                 
                                    j
                                 
                                 
                                    c
                                 
                              
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              )
                              =
                              
                                 
                                    θ
                                 
                                 
                                    j
                                 
                              
                              I
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              =
                              1
                              )
                              +
                              κ
                              I
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              
                              ≠
                              
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                                 
                                    i
                                 
                              
                              )
                              .
                           
                        
                     
                     
                        
                           (A.4)
                           
                              
                                 
                                    μ
                                 
                                 
                                    j
                                 
                                 
                                    h
                                 
                              
                              (
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                f
                                             
                                             
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 
                                    ⊤
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              -
                              
                                 
                                    1
                                 
                                 
                                    2
                                    
                                       
                                          σ
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              ‖
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    ‖
                                 
                                 
                                    2
                                 
                                 
                                    2
                                 
                              
                              .
                           
                        
                     Similarly, the edge log-potentials for 
                        
                           (
                           
                              
                                 c
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 h
                              
                              
                                 j
                              
                           
                           )
                        
                      for 
                        
                           j
                           =
                           1
                           ,
                           …
                           ,
                           K
                        
                      are:
                        
                           (A.5)
                           
                              
                                 
                                    μ
                                 
                                 
                                    j
                                 
                                 
                                    ch
                                 
                              
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              )
                              =
                              I
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              =
                              1
                              )
                              ·
                              log
                              
                                 
                                    η
                                 
                                 
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              +
                              I
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              =
                              0
                              )
                              ·
                              log
                              
                                 
                                    
                                       
                                          η
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    
                                       
                                          h
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              ,
                           
                        
                     and the remaining edge log-potentials for 
                        
                           e
                           =
                           (
                           j
                           ,
                           l
                           )
                        
                      with 
                        
                           j
                           <
                           l
                        
                      are:
                        
                           (A.6)
                           
                              
                                 
                                    μ
                                 
                                 
                                    e
                                 
                                 
                                    cc
                                 
                              
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    l
                                 
                              
                              )
                              =
                              
                                 
                                    θ
                                 
                                 
                                    e
                                 
                                 
                                    11
                                 
                              
                              ·
                              I
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              =
                              1
                              ,
                              
                                 
                                    c
                                 
                                 
                                    l
                                 
                              
                              =
                              1
                              )
                              +
                              
                                 
                                    θ
                                 
                                 
                                    e
                                 
                                 
                                    01
                                 
                              
                              ·
                              I
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              =
                              0
                              ,
                              
                                 
                                    c
                                 
                                 
                                    l
                                 
                              
                              =
                              1
                              )
                              +
                              
                                 
                                    θ
                                 
                                 
                                    e
                                 
                                 
                                    10
                                 
                              
                              ·
                              I
                              (
                              
                                 
                                    c
                                 
                                 
                                    j
                                 
                              
                              =
                              1
                              ,
                              
                                 
                                    c
                                 
                                 
                                    l
                                 
                              
                              =
                              0
                              )
                              .
                           
                        
                     
                     
                        
                           (A.7)
                           
                              
                                 
                                    μ
                                 
                                 
                                    e
                                 
                                 
                                    hh
                                 
                              
                              (
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    h
                                 
                                 
                                    l
                                 
                              
                              )
                              =
                              -
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                f
                                             
                                             
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 
                                    ⊤
                                 
                              
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          h
                                       
                                       
                                          l
                                       
                                    
                                 
                                 
                                    l
                                 
                              
                              .
                           
                        
                     
                  

@&#REFERENCES@&#

