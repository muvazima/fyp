@&#MAIN-TITLE@&#Switching regression metamodels in stochastic simulation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           How to collect data for switching metamodels (SWM) where several identified regimes.


                        
                        
                           
                           Procedure using replications to estimate regime probabilities and variances of SWM.


                        
                        
                           
                           Generalize WLSQ to mixtures of regimes (MWLSQ) based on clusterwise regression.


                        
                        
                           
                           Asymptotic normality and consistency of the MLE is established for MLE metamodels.


                        
                        
                           
                           Compare the precision of MWLSQ and MLE metamodels with a 4 regime example.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Simulation

Metamodel

Regression mixture

Maximum likelihood

@&#ABSTRACT@&#


               
               
                  Simulation models are frequently analyzed through a linear regression model that relates the input/output data behavior. However, in several situations, it happens that different data subsets may resemble different models. The purpose of this paper is to present a procedure for constructing switching regression metamodels in stochastic simulation, and to exemplify the practical use of statistical techniques of switching regression in the analysis of simulation results. The metamodel estimation is made using a mixture weighted least squares and the maximum likelihood method. The consistency and the asymptotic normality of the maximum likelihood estimator are establish. The proposed methods are applied in the construction of a switching regression metamodel. This paper gives special emphasis on the usefulness of constructing switching metamodels in simulation analysis.
               
            

@&#INTRODUCTION@&#

Linear regression analysis plays an important role in many fields. A regression metamodel may be used for interpreting the input/output of a simulation model and, consequently, for analysing the real world data. A simulation metamodel, usually a simple mathematical function, is an approximation of the input/output function that is defined by the underlying simulation model (Kleijnen, 2008). Kleijnen (1975) proposed some statistical tools for making the regression metamodels commonly usable, and the most popular methods for constructing simulation metamodels are the polynomial regression ones; see also (Biles, 1974). The construction and use of metamodels continues today and comprises several types of metamodels like, for example, linear regression metamodels (Kleijnen, 1992), nonlinear regression metamodels (Santos & Nova, 2006; Santos & Santos, 2008), Kriging metamodels (Kleijnen, 2009) among others. A metamodel may be used with different purposes; for example, it may be used as a surrogate of a simulation model or as a building block inside a simulation model (Santos & Santos, 2009).

However, in simulation practice sometimes we may obtain a poor fit when a single regression metamodel is used. It happens when simulation model behavior isn’t likely to follow one unique regime, and that different subsets of the input/output data may favor different submodels. A different approach may be using switching regression techniques for constructing metamodels in stochastic simulation. A switching regression model assumes that we have a random variable y such that E[y] is a linear function of explanatory variables with 
                        
                           y
                           ∼
                           
                              N
                           
                           (
                           
                              
                                 x
                              
                              T
                           
                           
                              
                                 θ
                              
                              s
                           
                           ,
                           
                              σ
                              s
                              2
                           
                           )
                        
                      with probability λs
                     , 
                        
                           s
                           =
                           1
                           ,
                           …
                           ,
                           S
                        
                     . So, there are a set of S regression models characterized by the parameters 
                        
                           (
                           
                              
                                 θ
                              
                              1
                           
                           ,
                           
                              σ
                              1
                              2
                           
                           )
                           ,
                           …
                        
                      , 
                        
                           (
                           
                              
                                 θ
                              
                              S
                           
                           ,
                           
                              σ
                              S
                              2
                           
                           )
                           ,
                        
                      and for each observation pair (yi
                     , x
                     
                        i
                     ) the indicator λsi
                      chooses one among several models to obtain yi
                     ; the unknown parameters 
                        θ
                     
                     1, 
                        
                           
                              σ
                              1
                              2
                           
                           ,
                           …
                        
                      , 
                        θ
                     
                     
                        S
                     , 
                        
                           σ
                           S
                           2
                        
                      are estimated from the data.

Switching regression models are dated to at least (Quandt, 1958), and find applications in a wide variety of areas such as economics (Chen, 2007; McKenzie & Takaoka, 2008), finance (Fukuda, 2009), and marketing (DeSarbo & Cron, 1988). Goldfeld and Quandt (1973) introduced the Markov-switching models, in which a latent state variable (instead of a fixed probability) following a Markov-chain controls regime shifts, meanwhile (Quandt, 1972) studies a mixture of normal linear regression models where the choice between regimes is based on fixed probabilities. In the clusterwise linear regression context, Späth (1979) considers the regression problem where the error sums of squares is computed over all regimes (referred by clusters) is minimized using an exchange algorithm. Lau, Leung, and Tse (1999) propose a programming procedure to estimate clusterwise linear regression models based on combinatorial optimization problems; see also Carbonneau, Caporossi, and Hansen (2011). Quandt (1972) proposed the maximum likelihood method for estimating switching regressions, and Kiefer (1978) studied the problem of data covering two regression regimes and maximum likelihood methods for unknown parameters estimation. In the maximum likelihood context, DeSarbo and Cron (1988) generalize the Quandt (1972) and Hosmer (1974) stochastic switching regression models to more than two regimes. This article extend these developments to the construction of simulation switching regressions metamodels, where the unknown variances are estimated using the replications available from a simulation experiment and the switching probabilities may vary with the experimental points, and are also estimated from de data.

This paper is organized as follows. A framework of the metamodel with relation to simulation metamodels and switching regression models is described in Section 2. In Section 3 the estimation procedure for constructing switching regression metamodels is presented. Section 4 describes an application example related to a simple manufacturing process. The conclusions are presented in Section 5.

A simulation model viewed as a black-box may be represented trough a mathematical function g(., .) as

                        
                           
                              
                                 y
                                 =
                                 g
                                 (
                                 d
                                 ,
                                 
                                    r
                                    0
                                 
                                 )
                              
                           
                        
                     where, y is a vector of simulation outputs, d is the vector of input factors of the simulation model and r
                     0 is a vector of pseudo-random seeds. Typically, one metamodel is constructed for each component of y, so we consider metamodels where y has one component

                        
                           
                              
                                 y
                                 =
                                 f
                                 (
                                 x
                                 ;
                                 
                                    θ
                                 
                                 )
                                 +
                                 ϵ
                              
                           
                        
                     where 
                        θ
                      is the unknown metamodel parameters, and x is a vector of metamodel inputs; for example, in the simulation of the M/M/1 system we may choose 
                        
                           
                              x
                              1
                           
                           =
                           
                              d
                              1
                           
                           /
                           
                              d
                              2
                           
                           =
                           λ
                           /
                           μ
                           ,
                        
                      where λ is the arrival rate and μ is the service rate. If f is a linear regression function, then a common set of regression parameters is enough for describing the input/output characteristics of the simulation program and, consequently, the simulation data may be described with only one regime. However, sometimes the input/output data exhibit some heterogeneity which produces the variation of the set of regression parameters over the data and, consequently, one regime may not be adequate for approximating the simulation input/output data. Switching regression metamodels (mixture of linear regressions) may help to overcome the lack-of-fit problem in these situations.

An illustrative example, where the usual regression leads to misleading results, is given in Table 1
                      and is depicted in Fig. 1
                     . The adjusted metamodel based on all data points is

                        
                           
                              
                                 
                                    y
                                    ^
                                 
                                 =
                                 0
                                 
                                 x
                                 +
                                 7.270
                              
                           
                        
                     and we may observe that this line poorly approximates the data. If the observations are split into two subsets then the following metamodel, which allows a good fit, is obtained

                        
                           
                              
                                 
                                    y
                                    ^
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                −
                                                1.06
                                                
                                                x
                                                +
                                                6.080
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   with
                                                
                                                
                                                
                                                   probability
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      λ
                                                      ^
                                                   
                                                   1
                                                
                                                =
                                                2
                                                /
                                                3
                                             
                                          
                                          
                                             
                                                (
                                                
                                                   subset
                                                
                                                
                                                1
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                0.53
                                                
                                                x
                                                +
                                                7.865
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   with
                                                
                                                
                                                
                                                   probability
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      λ
                                                      ^
                                                   
                                                   2
                                                
                                                =
                                                1
                                                /
                                                3
                                             
                                          
                                          
                                             
                                                (
                                                
                                                   subset
                                                
                                                
                                                2
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

Consider an experimental design consisting of n different design points, 
                        
                           {
                           
                              x
                              
                                 i
                                 l
                              
                           
                           :
                           i
                           =
                           1
                           ,
                           …
                           ,
                           n
                           ;
                           l
                           =
                           1
                           ,
                           …
                           ,
                           p
                           }
                           ,
                        
                      with p explanatory variables. For each design point i, r independent replications of the simulation model are carried out and the experiment yields 
                        
                           
                              Ω
                              
                                 i
                                 j
                              
                           
                           =
                           
                              {
                              
                                 
                                    z
                                    ˜
                                 
                                 
                                    i
                                    j
                                    k
                                 
                              
                              :
                              i
                              =
                              1
                              ,
                              …
                              ,
                              n
                              ,
                              j
                              =
                              1
                              ,
                              …
                              ,
                              r
                              ,
                              k
                              =
                              1
                              ,
                              …
                              ,
                              o
                              }
                           
                           ,
                        
                      where 
                        
                           z
                           ˜
                        
                      is the relevant system response, with o observations per replication. For each experimental point i and replicate j the observations 
                        
                           (
                           
                              
                                 z
                                 ˜
                              
                              
                                 i
                                 j
                                 1
                              
                           
                           ,
                           
                              
                                 z
                                 ˜
                              
                              
                                 i
                                 j
                                 2
                              
                           
                           ,
                           …
                           
                              
                                 z
                                 ˜
                              
                              
                                 i
                                 j
                                 o
                              
                           
                           )
                        
                      are split into S regimes sequentially ordered:


                     
                        
                           
                              
                              
                              
                                 
                                    regime 1:
                                    
                                       
                                          
                                             
                                                Ω
                                                
                                                   1
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                {
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                   
                                                
                                                }
                                             
                                          
                                       
                                    
                                 
                                 
                                    regime 2:
                                    
                                       
                                          
                                             
                                                Ω
                                                
                                                   2
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                {
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      2
                                                   
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            2
                                                            i
                                                            j
                                                         
                                                      
                                                   
                                                
                                                }
                                             
                                          
                                       
                                    
                                 
                                 
                                    regime 3:
                                    
                                       
                                          
                                             
                                                Ω
                                                
                                                   3
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                {
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            2
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            2
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      2
                                                   
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            2
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            3
                                                            i
                                                            j
                                                         
                                                      
                                                   
                                                
                                                }
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ⋮
                                       
                                    
                                    
                                       
                                          ⋮
                                       
                                    
                                 
                                 
                                    regime 
                                          S
                                       :
                                    
                                       
                                          
                                             
                                                Ω
                                                
                                                   S
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                {
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            2
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      ⋯
                                                      +
                                                      
                                                         t
                                                         
                                                            
                                                               i
                                                               j
                                                            
                                                            S
                                                            −
                                                            1
                                                         
                                                      
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            2
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      ⋯
                                                      +
                                                      
                                                         t
                                                         
                                                            
                                                               i
                                                               j
                                                            
                                                            S
                                                            −
                                                            1
                                                         
                                                      
                                                      +
                                                      2
                                                   
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   z
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ,
                                                      
                                                         t
                                                         
                                                            1
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            2
                                                            i
                                                            j
                                                         
                                                      
                                                      +
                                                      …
                                                      +
                                                      
                                                         t
                                                         
                                                            S
                                                            i
                                                            j
                                                         
                                                      
                                                   
                                                
                                                }
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

where

                        
                           
                              
                                 
                                    Ω
                                    
                                       i
                                       j
                                    
                                 
                                 =
                                 
                                    ⋃
                                    
                                       s
                                       =
                                       1
                                    
                                    S
                                 
                                 
                                    Ω
                                    
                                       s
                                       i
                                       j
                                    
                                 
                              
                           
                        
                     The probability associated with each set Ωsij
                      is estimated by

                        
                           (1)
                           
                              
                                 
                                    
                                       λ
                                       ^
                                    
                                    
                                       s
                                       i
                                       ·
                                    
                                 
                                 =
                                 
                                    1
                                    r
                                 
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    r
                                 
                                 
                                    
                                       λ
                                       ^
                                    
                                    
                                       s
                                       i
                                       j
                                    
                                 
                                 
                                 
                                    where
                                 
                                 
                                 
                                    
                                       λ
                                       ^
                                    
                                    
                                       s
                                       i
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       #
                                       
                                          Ω
                                          
                                             s
                                             i
                                             j
                                          
                                       
                                    
                                    
                                       #
                                       
                                          Ω
                                          
                                             i
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       t
                                       
                                          s
                                          i
                                          j
                                       
                                    
                                    o
                                 
                              
                           
                        
                     where 
                        
                           #
                           Ω
                        
                      represents the number of elements belonging to the set Ω.

If 
                        
                           
                              
                                 λ
                                 ^
                              
                              
                                 s
                                 i
                              
                           
                           ≈
                           1
                        
                      for some i and 
                        
                           s
                           =
                           1
                           ,
                           …
                           ,
                           S
                           ,
                        
                      then we may assume one regime only at experimental point i. Since λs
                      may depend on the experimental point, when predicting the response at x between x
                     
                        i
                      and 
                        
                           x
                           
                              i
                              +
                              1
                           
                        
                      the corresponding probabilities may be computed using, for example, interpolation of first degree. For a single input:

                        
                           
                              
                                 
                                    
                                       λ
                                       ^
                                    
                                    s
                                 
                                 
                                    (
                                    x
                                    )
                                 
                                 =
                                 
                                    
                                       λ
                                       ^
                                    
                                    
                                       s
                                       i
                                    
                                 
                                 +
                                 
                                    
                                       x
                                       −
                                       
                                          x
                                          i
                                       
                                    
                                    
                                       
                                          x
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          x
                                          i
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          λ
                                          ^
                                       
                                       
                                          s
                                          ,
                                          i
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          λ
                                          ^
                                       
                                       
                                          s
                                          ,
                                          i
                                       
                                    
                                    )
                                 
                              
                           
                        
                     
                  

For each regime 
                        
                           s
                           =
                           1
                           ,
                           …
                           ,
                           S
                           ,
                        
                      and replication j of each design point i a measure of interest ysij
                      is determined from z
                     
                        i, j, k
                     . For instance, the mean value for each regime is

                        
                           
                              
                                 
                                    y
                                    
                                       s
                                       i
                                       j
                                    
                                 
                                 =
                                 
                                    1
                                    
                                       t
                                       
                                          s
                                          i
                                          j
                                       
                                    
                                 
                                 
                                    ∑
                                    
                                       k
                                       =
                                       
                                          k
                                          
                                             1
                                             i
                                             j
                                          
                                       
                                    
                                    
                                       k
                                       
                                          2
                                          i
                                          j
                                       
                                    
                                 
                                 
                                    z
                                    
                                       i
                                       ,
                                       j
                                       ,
                                       k
                                    
                                 
                              
                           
                        
                     where

                        
                           
                              
                                 
                                    k
                                    
                                       1
                                       i
                                       j
                                    
                                 
                                 =
                                 1
                                 +
                                 
                                    ∑
                                    
                                       m
                                       =
                                       1
                                    
                                    
                                       s
                                       −
                                       1
                                    
                                 
                                 
                                    t
                                    
                                       m
                                       i
                                       j
                                    
                                 
                                 
                                 
                                    and
                                 
                                 
                                 
                                    k
                                    
                                       2
                                       i
                                       j
                                    
                                 
                                 =
                                 
                                    ∑
                                    
                                       m
                                       =
                                       1
                                    
                                    s
                                 
                                 
                                    t
                                    
                                       m
                                       i
                                       j
                                    
                                 
                              
                           
                        
                     For each experimental point i the mean and variance values of the measure of interest each regime can now be computed

                        
                           
                              
                                 
                                    
                                       y
                                       ¯
                                    
                                    
                                       s
                                       i
                                       ·
                                    
                                 
                                 =
                                 
                                    1
                                    r
                                 
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    r
                                 
                                 
                                    y
                                    
                                       s
                                       i
                                       j
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (2)
                           
                              
                                 
                                    
                                       σ
                                       ^
                                    
                                    
                                       s
                                       i
                                    
                                    2
                                 
                                 =
                                 
                                    1
                                    
                                       r
                                       −
                                       1
                                    
                                 
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    r
                                 
                                 
                                    
                                       (
                                       
                                          y
                                          
                                             s
                                             i
                                             j
                                          
                                       
                                       −
                                       
                                          
                                             y
                                             ¯
                                          
                                          
                                             s
                                             i
                                             ·
                                          
                                       
                                       )
                                    
                                    2
                                 
                              
                           
                        
                     To represent the simulation model, the following mixture of linear regressions is assumed

                        
                           (3)
                           
                              
                                 
                                    
                                       y
                                       ¯
                                    
                                    
                                       i
                                       .
                                    
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                   10
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      l
                                                      =
                                                      1
                                                   
                                                   p
                                                
                                                
                                                   θ
                                                   
                                                      1
                                                      l
                                                   
                                                
                                                
                                                   x
                                                   
                                                      l
                                                      i
                                                   
                                                
                                                +
                                                
                                                   
                                                      ϵ
                                                      ¯
                                                   
                                                   
                                                      1
                                                      i
                                                      .
                                                   
                                                
                                                ,
                                                
                                                
                                                   with
                                                
                                                
                                                
                                                   probability
                                                
                                                
                                                
                                                   λ
                                                   
                                                      1
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             
                                                
                                                   θ
                                                   
                                                      S
                                                      0
                                                   
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      l
                                                      =
                                                      1
                                                   
                                                   p
                                                
                                                
                                                   θ
                                                   
                                                      S
                                                      l
                                                   
                                                
                                                
                                                   x
                                                   
                                                      l
                                                      i
                                                   
                                                
                                                +
                                                
                                                   
                                                      ϵ
                                                      ¯
                                                   
                                                   
                                                      S
                                                      i
                                                      .
                                                   
                                                
                                                ,
                                                
                                                
                                                   with
                                                
                                                
                                                
                                                   probability
                                                
                                                
                                                
                                                   λ
                                                   
                                                      S
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              ϵ
                              ¯
                           
                           
                              s
                              i
                              .
                           
                        
                      are iid as N(
                        
                           0
                           ,
                           
                              σ
                              
                                 s
                                 i
                              
                              2
                           
                           /
                           r
                        
                     ), 
                        
                           i
                           =
                           1
                           ,
                           …
                           ,
                           n
                           ,
                        
                      represents the inaccuracy of the metamodel (σsi
                      > 0), 
                        
                           s
                           =
                           1
                           ,
                           …
                           ,
                           S
                        
                     . Assume that the mixing weights λsi
                     , 0 < λsi
                      < 1, and the regression parameters 
                        
                           
                              θ
                           
                           =
                           (
                           
                              θ
                              10
                           
                           ,
                           …
                           ,
                           
                              θ
                              
                                 1
                                 d
                              
                           
                           ,
                           …
                           ,
                           
                              θ
                              
                                 S
                                 0
                              
                           
                           ,
                           …
                           ,
                           
                              θ
                              
                                 S
                                 d
                              
                           
                           )
                        
                      are unknown, and

                        
                           
                              
                                 
                                    ∑
                                    
                                       s
                                       =
                                       1
                                    
                                    S
                                 
                                 
                                    λ
                                    
                                       s
                                       i
                                    
                                 
                                 =
                                 1
                                 
                                 i
                                 =
                                 1
                                 …
                                 n
                              
                           
                        
                     We assume λsi
                      ≠ 0 and λsi
                      ≠ 1 because if 
                        
                           
                              λ
                              
                                 s
                                 i
                              
                           
                           =
                           0
                        
                      or 
                        
                           
                              λ
                              
                                 s
                                 i
                              
                           
                           =
                           1
                           ,
                        
                      the parameters of some regime is not identified. If the regime’s probabilities are unknown, then they may be estimated by (1).

Consequently, 
                        
                           y
                           ¯
                        
                      has a finite mixture probability density function

                        
                           
                              
                                 f
                                 
                                    (
                                    
                                       
                                          y
                                          ¯
                                       
                                       .
                                    
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       s
                                       =
                                       1
                                    
                                    S
                                 
                                 
                                    
                                       λ
                                       s
                                    
                                    
                                       
                                          2
                                          π
                                          
                                             σ
                                             s
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                 
                                 exp
                                 
                                    [
                                    −
                                    
                                       1
                                       
                                          2
                                          
                                             σ
                                             s
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                y
                                                ¯
                                             
                                             .
                                          
                                          −
                                          
                                             θ
                                             
                                                s
                                                0
                                             
                                          
                                          −
                                          
                                             ∑
                                             
                                                l
                                                =
                                                1
                                             
                                             p
                                          
                                          
                                             θ
                                             
                                                s
                                                l
                                             
                                          
                                          
                                             x
                                             l
                                          
                                          )
                                       
                                       2
                                    
                                    ]
                                 
                              
                           
                        
                     
                  


                        Späth (1979) first introduced the term clusterwise regression as a separation technique when clustering data. Instead of a separation criterion given a set of previously known mathematical functions, the approach proposed in this paper estimates the function parameters from observations already clustered into different groups. Whereas in the traditional regression model the approximating function is the same for all subsets of the sample, that is, it assumes only one regime (
                           
                              
                                 θ
                                 
                                    s
                                    l
                                 
                              
                              =
                              
                                 θ
                                 l
                              
                              ,
                           
                         for all 
                           
                              s
                              =
                              1
                              ,
                              …
                              ,
                              S
                           
                         and 
                           
                              l
                              =
                              0
                              ,
                              …
                              ,
                              p
                           
                        ), the clusterwise model assumes a mixture of linear regressions like in (3). Späth presents an exchange algorithm to minimize the global problem

                           
                              
                                 
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       ∑
                                       
                                          s
                                          =
                                          1
                                       
                                       S
                                    
                                    
                                       
                                          (
                                          
                                             
                                                y
                                                ¯
                                             
                                             
                                                s
                                                i
                                                .
                                             
                                          
                                          −
                                          
                                             θ
                                             
                                                s
                                                0
                                             
                                          
                                          −
                                          
                                             ∑
                                             
                                                l
                                                =
                                                1
                                             
                                             p
                                          
                                          
                                             θ
                                             
                                                s
                                                l
                                             
                                          
                                          
                                             x
                                             
                                                l
                                                i
                                             
                                          
                                          )
                                       
                                       2
                                    
                                 
                              
                           
                        In this sense, the clusterwise linear regression is a regression problem where the error sums of squares computed over all clusters is minimized. In order to assure the existence of a solution, it is required that the number of observations is significantly larger than the number of unknown parameters (o ≫ dS).

In this paper, the following global estimated weighted error sum of squares used is

                           
                              
                                 
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       ∑
                                       
                                          s
                                          =
                                          1
                                       
                                       S
                                    
                                    
                                       
                                          
                                             λ
                                             ^
                                          
                                          
                                             s
                                             i
                                          
                                       
                                       
                                          
                                             
                                                σ
                                                ^
                                             
                                             
                                                s
                                                i
                                             
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                y
                                                ¯
                                             
                                             
                                                s
                                                i
                                                .
                                             
                                          
                                          −
                                          
                                             θ
                                             
                                                s
                                                0
                                             
                                          
                                          −
                                          
                                             ∑
                                             
                                                l
                                                =
                                                1
                                             
                                             p
                                          
                                          
                                             θ
                                             
                                                s
                                                l
                                             
                                          
                                          
                                             x
                                             
                                                l
                                                i
                                             
                                          
                                          )
                                       
                                       2
                                    
                                 
                              
                           
                        In mixture weighted least squares (MWLSQ), all regimes must be adjusted simultaneously, taking into account the relative estimated variances 
                           
                              
                                 σ
                                 ^
                              
                              
                                 s
                                 i
                              
                              2
                           
                         and the estimated regime probabilities 
                           
                              
                                 
                                    λ
                                    ^
                                 
                                 
                                    s
                                    i
                                 
                              
                              ,
                           
                         obtained from the previously clustered observations.

Initial values are computed using estimated separated weighted least squares (WSLQ) method for each regime.

                           
                              
                                 
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       1
                                       
                                          
                                             
                                                σ
                                                ^
                                             
                                             
                                                s
                                                i
                                             
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                y
                                                ¯
                                             
                                             
                                                s
                                                i
                                                .
                                             
                                          
                                          −
                                          
                                             θ
                                             
                                                s
                                                0
                                             
                                          
                                          −
                                          
                                             ∑
                                             
                                                l
                                                =
                                                1
                                             
                                             p
                                          
                                          
                                             θ
                                             
                                                s
                                                l
                                             
                                          
                                          
                                             x
                                             
                                                l
                                                i
                                             
                                          
                                          )
                                       
                                       2
                                    
                                 
                              
                           
                        Then an unconstrained nonlinear minimization is performed, using the previously determined initial values. The use of an initial value near the solution improves the robustness of the nonlinear search.

The log-likelihood function can be expressed as

                           
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             ln
                                             L
                                             (
                                             
                                                λ
                                             
                                             ,
                                             
                                                θ
                                             
                                             ,
                                             
                                                
                                                   σ
                                                
                                                2
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             =
                                             
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                n
                                             
                                             ln
                                             
                                                {
                                                
                                                   ∑
                                                   
                                                      s
                                                      =
                                                      1
                                                   
                                                   S
                                                
                                                
                                                   
                                                      λ
                                                      
                                                         s
                                                         i
                                                      
                                                   
                                                   
                                                      
                                                         2
                                                         π
                                                         
                                                            σ
                                                            
                                                               s
                                                               i
                                                            
                                                            2
                                                         
                                                         /
                                                         r
                                                      
                                                   
                                                
                                                exp
                                                
                                                   [
                                                   
                                                   −
                                                   
                                                      1
                                                      
                                                         2
                                                         
                                                            σ
                                                            
                                                               s
                                                               i
                                                            
                                                            2
                                                         
                                                         /
                                                         r
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               y
                                                               ¯
                                                            
                                                            
                                                               s
                                                               i
                                                               .
                                                            
                                                         
                                                         
                                                         −
                                                         
                                                         
                                                            θ
                                                            
                                                               s
                                                               0
                                                            
                                                         
                                                         
                                                         −
                                                         
                                                         
                                                            ∑
                                                            
                                                               l
                                                               =
                                                               1
                                                            
                                                            p
                                                         
                                                         
                                                            θ
                                                            
                                                               s
                                                               l
                                                            
                                                         
                                                         
                                                            x
                                                            
                                                               l
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                      2
                                                   
                                                   ]
                                                
                                                }
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 λ
                              
                              =
                              (
                              
                                 λ
                                 11
                              
                              ,
                              …
                              ,
                              
                                 λ
                                 
                                    1
                                    n
                                 
                              
                              ,
                              …
                              ,
                              
                                 λ
                                 
                                    S
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 λ
                                 
                                    S
                                    n
                                 
                              
                              )
                              ,
                           
                        
                        
                           
                              
                                 θ
                              
                              =
                              (
                              
                                 θ
                                 10
                              
                              ,
                              …
                              ,
                              
                                 θ
                                 
                                    1
                                    p
                                 
                              
                              ,
                              …
                              ,
                              
                                 θ
                                 
                                    S
                                    0
                                 
                              
                              ,
                              …
                              ,
                              
                                 θ
                                 
                                    S
                                    p
                                 
                              
                              )
                              ,
                           
                         and 
                           
                              
                                 
                                    σ
                                 
                                 2
                              
                              =
                              
                                 (
                                 
                                    σ
                                    
                                       11
                                    
                                    2
                                 
                                 ,
                                 …
                                 ,
                                 
                                    σ
                                    
                                       1
                                       n
                                    
                                    2
                                 
                                 ,
                                 …
                                 ,
                                 
                                    σ
                                    
                                       S
                                       1
                                    
                                    2
                                 
                                 ,
                                 …
                                 ,
                                 
                                    σ
                                    
                                       S
                                       n
                                    
                                    2
                                 
                                 )
                              
                           
                        .

Using (1) and (2), the maximum likelihood approach consists on maximizing the log-likelihood function with respect to 
                           θ
                        , that is, consists on solving the following system of equations:

                           
                              (4)
                              
                                 
                                    
                                       
                                          ∂
                                          ln
                                          L
                                          (
                                          
                                             
                                                λ
                                             
                                             ^
                                          
                                          ,
                                          
                                             θ
                                          
                                          ,
                                          
                                             
                                                
                                                   σ
                                                
                                                ^
                                             
                                             2
                                          
                                          )
                                       
                                       
                                          ∂
                                          
                                             θ
                                          
                                       
                                    
                                    =
                                    0
                                 
                              
                           
                        or equivalently,

                           
                              
                                 
                                    
                                       
                                          ∂
                                          ln
                                          L
                                          (
                                          
                                             
                                                λ
                                             
                                             ^
                                          
                                          ,
                                          
                                             θ
                                          
                                          ,
                                          
                                             
                                                
                                                   σ
                                                
                                                ^
                                             
                                             2
                                          
                                          )
                                       
                                       
                                          ∂
                                          
                                             θ
                                             
                                                s
                                                t
                                             
                                          
                                       
                                    
                                    =
                                    0
                                    ,
                                    
                                    s
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    S
                                    ,
                                    
                                    t
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    p
                                 
                              
                           
                        where,

                           
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                
                                                   ∂
                                                   ln
                                                   L
                                                   (
                                                   
                                                      
                                                         λ
                                                      
                                                      ^
                                                   
                                                   ,
                                                   
                                                      θ
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            σ
                                                         
                                                         ^
                                                      
                                                      2
                                                   
                                                   )
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         s
                                                         t
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             =
                                             
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                                1
                                                
                                                   V
                                                   i
                                                
                                             
                                             
                                                
                                                   
                                                      λ
                                                      ^
                                                   
                                                   
                                                      s
                                                      i
                                                   
                                                
                                                
                                                   
                                                      2
                                                      π
                                                      
                                                         
                                                            σ
                                                            ^
                                                         
                                                         
                                                            s
                                                            i
                                                         
                                                         2
                                                      
                                                      /
                                                      r
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      x
                                                      
                                                         t
                                                         i
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            y
                                                            ¯
                                                         
                                                         
                                                            s
                                                            i
                                                            .
                                                         
                                                      
                                                      −
                                                      
                                                         θ
                                                         
                                                            s
                                                            0
                                                         
                                                      
                                                      −
                                                      
                                                         ∑
                                                         
                                                            l
                                                            =
                                                            1
                                                         
                                                         p
                                                      
                                                      
                                                         θ
                                                         
                                                            s
                                                            l
                                                         
                                                      
                                                      
                                                         x
                                                         
                                                            l
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      
                                                         s
                                                         i
                                                      
                                                      2
                                                   
                                                   /
                                                   r
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             exp
                                             
                                                [
                                                −
                                                
                                                   1
                                                   
                                                      2
                                                      
                                                         
                                                            σ
                                                            ^
                                                         
                                                         
                                                            s
                                                            i
                                                         
                                                         2
                                                      
                                                      /
                                                      r
                                                   
                                                
                                                
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            y
                                                            ¯
                                                         
                                                         
                                                            s
                                                            i
                                                            .
                                                         
                                                      
                                                      −
                                                      
                                                         θ
                                                         
                                                            s
                                                            0
                                                         
                                                      
                                                      −
                                                      
                                                         ∑
                                                         
                                                            l
                                                            =
                                                            1
                                                         
                                                         p
                                                      
                                                      
                                                         θ
                                                         
                                                            s
                                                            l
                                                         
                                                      
                                                      
                                                         x
                                                         
                                                            l
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                   2
                                                
                                                ]
                                             
                                          
                                       
                                    
                                 
                              
                           
                        with

                           
                              
                                 
                                    
                                       V
                                       i
                                    
                                    =
                                    
                                       ∑
                                       
                                          s
                                          =
                                          1
                                       
                                       S
                                    
                                    
                                       
                                          
                                             λ
                                             ^
                                          
                                          
                                             s
                                             i
                                          
                                       
                                       
                                          
                                             2
                                             π
                                             
                                                
                                                   σ
                                                   ^
                                                
                                                
                                                   s
                                                   i
                                                
                                                2
                                             
                                             /
                                             r
                                          
                                       
                                    
                                    exp
                                    
                                       [
                                       −
                                       
                                          1
                                          
                                             2
                                             
                                                
                                                   σ
                                                   ^
                                                
                                                
                                                   s
                                                   i
                                                
                                                2
                                             
                                             /
                                             r
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   y
                                                   ¯
                                                
                                                
                                                   s
                                                   i
                                                   .
                                                
                                             
                                             −
                                             
                                                θ
                                                
                                                   s
                                                   0
                                                
                                             
                                             −
                                             
                                                ∑
                                                
                                                   l
                                                   =
                                                   1
                                                
                                                p
                                             
                                             
                                                θ
                                                
                                                   s
                                                   l
                                                
                                             
                                             
                                                x
                                                
                                                   l
                                                   i
                                                
                                             
                                             )
                                          
                                          2
                                       
                                       ]
                                    
                                 
                              
                           
                        
                     

In Proposition 1, the existence of a consistent root of the likelihood Eq. (4) is established; also, the asymptotic distribution of this consistent root is obtained (see the verification of these results in Appendix).

                           Proposition 1
                           
                              Let the random variable
                              
                                 
                                    
                                       y
                                       ¯
                                    
                                    
                                       s
                                       i
                                       .
                                    
                                 
                               
                              has probability density function
                              
                                 
                                    (5)
                                    
                                       
                                          f
                                          
                                             (
                                             
                                                
                                                   y
                                                   ¯
                                                
                                                
                                                   i
                                                   .
                                                
                                             
                                             ;
                                             
                                                θ
                                             
                                             )
                                          
                                          =
                                          
                                             ∑
                                             
                                                s
                                                =
                                                1
                                             
                                             S
                                          
                                          
                                             
                                                
                                                   λ
                                                   ^
                                                
                                                
                                                   s
                                                   i
                                                
                                             
                                             
                                                
                                                   2
                                                   π
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      
                                                         s
                                                         i
                                                      
                                                      2
                                                   
                                                   /
                                                   r
                                                
                                             
                                          
                                          exp
                                          
                                             [
                                             −
                                             
                                                1
                                                
                                                   2
                                                   
                                                      
                                                         σ
                                                         ^
                                                      
                                                      
                                                         s
                                                         i
                                                      
                                                      2
                                                   
                                                   /
                                                   r
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         y
                                                         ¯
                                                      
                                                      
                                                         i
                                                         .
                                                      
                                                   
                                                   −
                                                   
                                                      θ
                                                      
                                                         s
                                                         0
                                                      
                                                   
                                                   −
                                                   
                                                      ∑
                                                      
                                                         l
                                                         =
                                                         1
                                                      
                                                      p
                                                   
                                                   
                                                      θ
                                                      
                                                         s
                                                         l
                                                      
                                                   
                                                   
                                                      x
                                                      
                                                         l
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                2
                                             
                                             ]
                                          
                                       
                                    
                                 
                              
                              where
                              
                                 
                                    
                                       θ
                                    
                                    =
                                    (
                                    
                                       θ
                                       10
                                    
                                    ,
                                    …
                                    ,
                                    
                                       θ
                                       
                                          1
                                          p
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       θ
                                       
                                          S
                                          0
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       θ
                                       
                                          S
                                          p
                                       
                                    
                                    )
                                    ,
                                 
                               
                              with
                              
                                 
                                    
                                       θ
                                       
                                          s
                                          l
                                       
                                    
                                    ∈
                                    R
                                 
                              
                              . Then for n sufficiently large there exists an unique consistent root
                              
                                 
                                    
                                       θ
                                    
                                    ^
                                 
                               
                              of the likelihood 
                              
                                 Eq. (4)
                              , and the asymptotic distribution of
                              
                                 
                                    
                                       n
                                    
                                    
                                       (
                                       
                                          
                                             θ
                                          
                                          ^
                                       
                                       −
                                       
                                          
                                             θ
                                          
                                          *
                                       
                                       )
                                    
                                 
                               
                              is multivariate normal with zero mean vector and variance-covariance matrix given by
                              
                                 
                                    I
                                    
                                       
                                          (
                                          
                                             
                                                θ
                                             
                                             *
                                          
                                          )
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    ,
                                 
                               
                              where 
                              
                                 θ
                              
                              * 
                              represents the true value of the parameter 
                              
                                 θ
                               
                              and I(
                                 θ
                              
                              *) is the Fisher information matrix.
                           

The system of nonlinear Eq. (4) yields the maximum likelihood estimates (MLE). However, this system cannot be solved explicitly and, frequently, has non-unique solution. Consequently, numerical methods like, for example, Newton method or Neder–Mead may be used for obtaining maximum likelihood estimates. These methods may converge to a local solution instead of the global one, especially if the initial guess is not sufficiently near the exact solution. However, Proposition 1 assures the existence of a unique global solution but, if there is more than one solution, it does not provide any information about which solution is consistent. When conventional algorithms fail in detecting the global optimum, stochastic methods like e.g. Simulated Annealing might prove to be a good alternative. Although sometimes slower, they converge to the global optimum.

Several systems exhibit switching output regimes. Some of these systems include a feedback component. The depicted application example is a system with feedback that exhibits output regimes in certain range of inputs. The example is a simplification of a manufacturing process where items must be reprocessed if the result does not meet specifications.

The system used for depicting the construction of the proposed metamodels is a simple parts painting processing unit. The parts to be painted arrive at the unit according to a Poisson process. The mean time between arrivals is the decision variable x. The painting time is triangularly distributed between 2 and 10 minutes, with a mode of 5 minutes. However, 20 percent of the painting operations have to be repeated due to imperfections (see Fig. 2
                     ).

The paint process is repeated up to 3 times for each part, if the previous painting operation did not meet specifications, resulting in 4 regimes. The time in system grows during the day, but the growth rate varies with the interarrival time. The purpose of the simulation experiment is to express the time in the system, z, as a function of the mean time between arrivals of parts. The metamodels were built in MATLAB 7.10 with some custom made routines. The observations zijk
                      were gathered from 6 independent replications of 9 equally spaced design points in the [6, 6.8] experimental region. From each replication of 51000 observations, the first 1000 observations were removed to mitigate initialization transient and provide a good separation between regimes.

Every observation from each simulation run is grouped into one of four switching regimes. From each regime, a growth rate is determined by the slope of the line that is obtained by applying a least squares to the regime observations (see Fig. 3
                     ). The probability of each regime is computed from the relative number of observations of each regime. At each design point, a set of six replications are performed. The average values of six computed slopes 
                        
                           
                              y
                              ¯
                           
                           
                              s
                              i
                              .
                           
                        
                      (see Table 2
                     ) are determined (measure of interest), as well as their variances 
                        
                           
                              σ
                              
                                 s
                                 i
                              
                           
                           =
                           
                              
                                 σ
                                 ^
                              
                              
                                 s
                                 i
                              
                           
                        
                      (see Table 3
                     ) and the average probability of each regime 
                        
                           
                              
                                 λ
                                 ¯
                              
                              
                                 s
                                 i
                                 .
                              
                           
                           =
                           
                              
                                 λ
                                 ^
                              
                              
                                 s
                                 i
                              
                           
                        
                      (see Table 4
                     ).

The resulting metamodel relates the interarrival time with the growth rate (see Fig. 4
                     ). All four regimes must be adjusted simultaneously, taking into account the relative variances 
                        
                           
                              σ
                              ^
                           
                           
                              s
                              i
                           
                        
                      and the regime probability 
                        
                           
                              λ
                              ^
                           
                           
                              s
                              i
                           
                        
                     . In the first approach, a mixture weighted least squares method is used to compute the 
                        θ
                      values of the metamodel. In a second approach, a maximum likelihood method is applied.

The results of performing independent weighted least squares on each regime provide the initial 
                        θ
                      values for the mixture weighted least squares and maximum likelihood estimation (see Table 5
                     ). These 
                        θ
                      values are used as initial values for the minimization Neder–Mead simplex method (see Lagarias, Reeds, Wright, & Wright (1998)), implemented by fminsearch in Matlab, also depicted in Table 5.

The adjusted values through mixture weighted least squares and maximum likelihood methods produce indistinguishable lines in Fig. 4. However, the SSE values, depicted in Table 6
                     , provide an insight into the precision of the resulting metamodels

                        
                           
                              
                                 
                                    SSE
                                 
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    n
                                 
                                 
                                    ∑
                                    
                                       s
                                       =
                                       1
                                    
                                    S
                                 
                                 
                                    
                                       
                                          λ
                                          ^
                                       
                                       
                                          s
                                          i
                                       
                                    
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          
                                             s
                                             i
                                          
                                          2
                                       
                                       /
                                       r
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             y
                                             ¯
                                          
                                          
                                             s
                                             i
                                             ·
                                          
                                       
                                       −
                                       
                                          f
                                          s
                                       
                                       
                                          (
                                          
                                             x
                                             i
                                          
                                          ,
                                          
                                             
                                                
                                                   θ
                                                
                                                ^
                                             
                                             s
                                          
                                          )
                                       
                                       )
                                    
                                    2
                                 
                              
                           
                        
                     where 
                        
                           
                              
                                 
                                    θ
                                 
                                 ^
                              
                              s
                           
                           =
                           
                              (
                              
                                 
                                    θ
                                    ^
                                 
                                 
                                    s
                                    0
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    θ
                                    ^
                                 
                                 
                                    s
                                    p
                                 
                              
                              )
                           
                        
                     .

If all regimes are adjusted simultaneously, a better adjustment is achieved. The maximum likelihood method provides a slightly better fit.

@&#CONCLUSIONS@&#

Metamodels provide a simple representation of the input/output relationship of a simulation model. When the output data exhibits independent groups of data, the metamodel should reproduce that grouping if a good representation of the original simulation model is to be achieved. In order to reproduce those groups, the metamodel must switch between different regimes. Each regime is modeled by a different mathematical function and switch mechanism is activated, usually a probability. The probability at each design point can estimated using the relative frequencies of the observations. As the regimes result from the same output sequence, and are therefore dependent, they must be adjusted simultaneously. A number of simulation replications should be performed, if the variances of output are to be estimated. The metamodel construction processes the proposed fitting with a set of functions, one for each regime. Although each of the functions is usually linear, the resulting mixture is nonlinear. An unconstrained minimization algorithm is employed to estimate the metamodel parameters for the set of functions. The initial values for the minimization are obtained from the independent estimation of each regime to improve the performance of the algorithm, and consequently the precision of the estimated parameters. The example presented displays four regimes that are fitted with first degree polynomial functions. The metamodels are compared using the sum of squared errors and show that a global estimation improves the quality of the fitted metamodel. The maximum likelihood method provides slightly better fitting results and the resulting estimators are consistent.

The verification of Proposition 1 consists on applying the following Theorem stated by Chanda (1954) to switching regression.

                        Theorem 1
                        
                           Let (u
                           1, u
                           2, …, un) a random sample such that ui are independent and identically distributed with probability density function f(u; 
                              θ
                           ), where 
                           
                              θ
                            
                           is a vector of unknown parameters. If the following conditions hold
                           
                              
                                 1.
                                 
                                    For almost all u and for all
                                    
                                       
                                          
                                             θ
                                          
                                          ∈
                                          
                                             
                                                Ω
                                             
                                             ¯
                                          
                                          ⊂
                                          
                                             R
                                             k
                                          
                                       
                                    
                                    
                                       
                                          (A.1)
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      ln
                                                      f
                                                   
                                                   
                                                      ∂
                                                      
                                                         θ
                                                         r
                                                      
                                                   
                                                
                                                ,
                                                
                                                
                                                   
                                                      
                                                         ∂
                                                         2
                                                      
                                                      ln
                                                      f
                                                   
                                                   
                                                      ∂
                                                      
                                                         θ
                                                         r
                                                      
                                                      ∂
                                                      
                                                         θ
                                                         s
                                                      
                                                   
                                                
                                                ,
                                                
                                                
                                                   and
                                                
                                                
                                                
                                                   
                                                      
                                                         ∂
                                                         3
                                                      
                                                      ln
                                                      f
                                                   
                                                   
                                                      ∂
                                                      
                                                         θ
                                                         r
                                                      
                                                      ∂
                                                      
                                                         θ
                                                         s
                                                      
                                                      ∂
                                                      
                                                         θ
                                                         t
                                                      
                                                   
                                                
                                                ,
                                                
                                                r
                                                ,
                                                s
                                                ,
                                                t
                                                =
                                                1
                                                ,
                                                …
                                                ,
                                                k
                                                .
                                             
                                          
                                       
                                    
                                 


                                    For almost all u and for all
                                    
                                       
                                          
                                             θ
                                          
                                          ∈
                                          
                                             
                                                Ω
                                             
                                             ¯
                                          
                                          ⊂
                                          
                                             R
                                             k
                                          
                                       
                                    
                                    
                                       
                                          (A.2)
                                          
                                             
                                                
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            |
                                                            
                                                               
                                                                  ∂
                                                                  f
                                                               
                                                               
                                                                  ∂
                                                                  
                                                                     θ
                                                                     r
                                                                  
                                                               
                                                            
                                                            |
                                                         
                                                         <
                                                         
                                                            F
                                                            r
                                                         
                                                         
                                                            (
                                                            u
                                                            )
                                                         
                                                         ,
                                                         
                                                         
                                                            |
                                                            
                                                               
                                                                  
                                                                     ∂
                                                                     2
                                                                  
                                                                  f
                                                               
                                                               
                                                                  ∂
                                                                  
                                                                     θ
                                                                     r
                                                                  
                                                                  ∂
                                                                  
                                                                     θ
                                                                     s
                                                                  
                                                               
                                                            
                                                            |
                                                         
                                                         <
                                                         
                                                            F
                                                            
                                                               r
                                                               s
                                                            
                                                         
                                                         
                                                            (
                                                            u
                                                            )
                                                         
                                                         C
                                                         ,
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      
                                                         
                                                         
                                                            and
                                                         
                                                         
                                                         
                                                            |
                                                            
                                                               
                                                                  
                                                                     ∂
                                                                     3
                                                                  
                                                                  f
                                                               
                                                               
                                                                  ∂
                                                                  
                                                                     θ
                                                                     r
                                                                  
                                                                  ∂
                                                                  
                                                                     θ
                                                                     s
                                                                  
                                                                  ∂
                                                                  
                                                                     θ
                                                                     t
                                                                  
                                                               
                                                            
                                                            |
                                                         
                                                         <
                                                         
                                                            H
                                                            
                                                               r
                                                               s
                                                               t
                                                            
                                                         
                                                         
                                                            (
                                                            u
                                                            )
                                                         
                                                         ,
                                                         
                                                         r
                                                         ,
                                                         s
                                                         ,
                                                         t
                                                         =
                                                         1
                                                         ,
                                                         …
                                                         ,
                                                         k
                                                         .
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    where H is such that
                                    
                                       
                                          
                                             ∫
                                             
                                                −
                                                ∞
                                             
                                             ∞
                                          
                                          
                                             H
                                             
                                                r
                                                s
                                                t
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          f
                                          
                                             (
                                             u
                                             ;
                                             
                                                θ
                                             
                                             )
                                          
                                          d
                                          u
                                          ≤
                                          M
                                          <
                                          ∞
                                       
                                     
                                    and Fr
                                    (u) and Frs
                                    (u) are bounded for
                                    
                                       
                                          r
                                          ,
                                          s
                                          ,
                                          t
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          k
                                       
                                    
                                    .
                                 


                                    For all
                                    
                                       
                                          
                                             θ
                                          
                                          ∈
                                          
                                             
                                                Ω
                                             
                                             ¯
                                          
                                          ⊂
                                          
                                             R
                                             k
                                          
                                          ,
                                       
                                     
                                    the following matrix is positive definite:
                                    
                                       
                                          (A.3)
                                          
                                             
                                                I
                                                
                                                   (
                                                   
                                                      θ
                                                   
                                                   )
                                                
                                                =
                                                
                                                   ∫
                                                   
                                                      −
                                                      ∞
                                                   
                                                   ∞
                                                
                                                
                                                   (
                                                   
                                                      
                                                         ∂
                                                         ln
                                                         f
                                                         (
                                                         u
                                                         ;
                                                         
                                                            θ
                                                         
                                                         )
                                                      
                                                      
                                                         ∂
                                                         
                                                            θ
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            ∂
                                                            ln
                                                            f
                                                            (
                                                            u
                                                            ;
                                                            
                                                               θ
                                                            
                                                            )
                                                         
                                                         
                                                            ∂
                                                            
                                                               θ
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   T
                                                
                                                f
                                                
                                                   (
                                                   u
                                                   ;
                                                   
                                                      θ
                                                   
                                                   )
                                                
                                                d
                                                x
                                             
                                          
                                       
                                    
                                 


                           Then, there exists a unique consistent estimator
                           
                              
                                 
                                    θ
                                 
                                 ^
                              
                            
                           which is the solution of the likelihood equations
                           
                              
                                 
                                    
                                       
                                          
                                             ∂
                                             ln
                                             L
                                          
                                          
                                             ∂
                                             
                                                θ
                                                j
                                             
                                          
                                       
                                       =
                                       
                                          ∂
                                          
                                             ∂
                                             
                                                θ
                                                j
                                             
                                          
                                       
                                       
                                          (
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             n
                                          
                                          ln
                                          f
                                          
                                             (
                                             
                                                u
                                                i
                                             
                                             ;
                                             
                                                θ
                                             
                                             )
                                          
                                          )
                                       
                                       =
                                       0
                                       ,
                                       
                                       j
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       k
                                    
                                 
                              
                           
                           Moreover,
                           
                              
                                 
                                    n
                                 
                                 
                                    (
                                    
                                       
                                          θ
                                       
                                       ^
                                    
                                    −
                                    
                                       
                                          θ
                                       
                                       *
                                    
                                    )
                                 
                              
                            
                           is asymptotic normally distributed with mean zero and variance-covariance matrix
                           
                              
                                 I
                                 
                                    
                                       (
                                       
                                          
                                             θ
                                          
                                          *
                                       
                                       )
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 ,
                              
                            
                           where 
                           
                              θ
                           
                           * 
                           is the true value of 
                           
                              θ
                            
                           and I(
                              θ
                           
                           *) is the Fisher information matrix.
                        

Let the density probability function (5) written as

                        
                           
                              
                                 f
                                 
                                    (
                                    y
                                    ;
                                    
                                       θ
                                    
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    S
                                 
                                 
                                    f
                                    s
                                 
                              
                           
                        
                     where

                        
                           
                              
                                 
                                    f
                                    s
                                 
                                 =
                                 
                                    
                                       
                                          λ
                                          ^
                                       
                                       s
                                    
                                    
                                       
                                          2
                                          π
                                          
                                             
                                                σ
                                                ^
                                             
                                             s
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                 
                                 exp
                                 
                                    [
                                    −
                                    
                                       1
                                       
                                          2
                                          
                                             
                                                σ
                                                ^
                                             
                                             s
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                    
                                       
                                          (
                                          y
                                          −
                                          
                                             θ
                                             
                                                s
                                                0
                                             
                                          
                                          −
                                          
                                             ∑
                                             
                                                l
                                                =
                                                1
                                             
                                             p
                                          
                                          
                                             θ
                                             
                                                s
                                                l
                                             
                                          
                                          
                                             x
                                             l
                                          
                                          )
                                       
                                       2
                                    
                                    ]
                                 
                              
                           
                        
                     Then it may observed that the following derivatives exist

                        
                           
                              
                                 
                                    
                                       ∂
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                       
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             ∂
                                             
                                                f
                                                1
                                             
                                          
                                          
                                             ∂
                                             
                                                θ
                                                10
                                             
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             ∂
                                             
                                                f
                                                1
                                             
                                          
                                          
                                             ∂
                                             
                                                θ
                                                
                                                   1
                                                   p
                                                
                                             
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             ∂
                                             
                                                f
                                                S
                                             
                                          
                                          
                                             ∂
                                             
                                                θ
                                                
                                                   S
                                                   0
                                                
                                             
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             ∂
                                             
                                                f
                                                S
                                             
                                          
                                          
                                             ∂
                                             
                                                θ
                                                
                                                   S
                                                   p
                                                
                                             
                                          
                                       
                                       )
                                    
                                    T
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                       
                                       ∂
                                       
                                          
                                             θ
                                          
                                          T
                                       
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                   
                                                      f
                                                      1
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      10
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                   
                                                      f
                                                      1
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      10
                                                   
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         1
                                                         p
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             …
                                          
                                          
                                             0
                                          
                                          
                                             …
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                   
                                                      f
                                                      1
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         1
                                                         p
                                                      
                                                   
                                                   ∂
                                                   
                                                      θ
                                                      10
                                                   
                                                
                                             
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                   
                                                      f
                                                      1
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         1
                                                         p
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             …
                                          
                                          
                                             0
                                          
                                          
                                             …
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             …
                                          
                                          
                                             0
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                   
                                                      f
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         S
                                                         0
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                   
                                                      f
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         S
                                                         0
                                                      
                                                   
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         S
                                                         p
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             …
                                          
                                          
                                             0
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                   
                                                      f
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         S
                                                         p
                                                      
                                                   
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         S
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             …
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                   
                                                      f
                                                      S
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      θ
                                                      
                                                         S
                                                         p
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                              
                           
                        
                     Considering 
                        
                           w
                           =
                           
                              
                                 (
                                 1
                                 ,
                                 
                                    
                                       x
                                    
                                    T
                                 
                                 )
                              
                              T
                           
                           ,
                        
                      then, 
                        
                           
                              w
                              1
                           
                           =
                           1
                           ,
                        
                     
                     
                        
                           
                              w
                              2
                           
                           =
                           
                              x
                              1
                           
                           ,
                           …
                        
                      , 
                        
                           
                              w
                              
                                 p
                                 +
                                 1
                              
                           
                           =
                           
                              x
                              p
                           
                        
                      the following may be written.

                        
                           
                              
                                 
                                    
                                       ∂
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∂
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    f
                                    s
                                 
                                 
                                    
                                       w
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          s
                                          2
                                       
                                       /
                                       r
                                    
                                 
                                 
                                    (
                                    y
                                    −
                                    
                                       
                                          w
                                       
                                       T
                                    
                                    
                                       
                                          θ
                                       
                                       s
                                    
                                    )
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                          2
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                          2
                                       
                                    
                                 
                                 =
                                 
                                    
                                       w
                                       
                                          i
                                          +
                                          1
                                       
                                       2
                                    
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          s
                                          2
                                       
                                       /
                                       r
                                    
                                 
                                 
                                    [
                                    
                                       1
                                       
                                          
                                             
                                                σ
                                                ^
                                             
                                             s
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                    
                                       
                                          (
                                          y
                                          −
                                          
                                             
                                                w
                                             
                                             T
                                          
                                          
                                             
                                                θ
                                             
                                             s
                                          
                                          )
                                       
                                       2
                                    
                                    −
                                    1
                                    ]
                                 
                                 
                                    f
                                    s
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 0
                                 ,
                                 
                                 k
                                 ≠
                                 s
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          3
                                       
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             l
                                             t
                                          
                                       
                                    
                                 
                                 =
                                 0
                                 ,
                                 
                                 k
                                 ≠
                                 s
                                 
                                 
                                    or
                                 
                                 
                                 l
                                 ≠
                                 s
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          w
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       
                                          x
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             σ
                                             ^
                                          
                                          s
                                          2
                                       
                                       /
                                       r
                                    
                                 
                                 
                                    [
                                    
                                       1
                                       
                                          
                                             
                                                σ
                                                ^
                                             
                                             s
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                    
                                       
                                          (
                                          y
                                          −
                                          
                                             
                                                w
                                             
                                             T
                                          
                                          
                                             
                                                θ
                                             
                                             s
                                          
                                          )
                                       
                                       2
                                    
                                    −
                                    1
                                    ]
                                 
                                 
                                    f
                                    s
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          3
                                       
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             j
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             k
                                          
                                       
                                    
                                 
                                 
                                 =
                                 
                                 
                                    
                                       
                                          w
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       
                                          w
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          w
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                σ
                                                ^
                                             
                                             s
                                             2
                                          
                                          /
                                          r
                                          )
                                       
                                       2
                                    
                                 
                                 
                                    (
                                    y
                                    −
                                    
                                       
                                          w
                                       
                                       T
                                    
                                    
                                       
                                          θ
                                       
                                       s
                                    
                                    )
                                 
                                 
                                    [
                                    1
                                    
                                    +
                                    
                                    
                                       1
                                       
                                          
                                             
                                                σ
                                                ^
                                             
                                             s
                                             2
                                          
                                          /
                                          r
                                       
                                    
                                    
                                       
                                          (
                                          y
                                          −
                                          
                                             
                                                w
                                             
                                             T
                                          
                                          
                                             
                                                θ
                                             
                                             s
                                          
                                          )
                                       
                                       2
                                    
                                    ]
                                 
                                 
                                    f
                                    s
                                 
                              
                           
                        
                     
                  

Consequently, the following derivatives exits and the first condition (A.1) is verified:

                        
                           
                              
                                 
                                    
                                       ∂
                                       ln
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∂
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                    
                                 
                                 
                                    1
                                    f
                                 
                              
                           
                        
                     
                     
                        
                           (A.4)
                           
                              
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       ln
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    1
                                    f
                                 
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                                 −
                                 
                                    1
                                    
                                       f
                                       2
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          f
                                          k
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                              
                           
                        
                     If k ≠ s then

                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 0
                              
                           
                        
                     and, as a result,

                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          2
                                       
                                       ln
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 −
                                 
                                    1
                                    
                                       f
                                       2
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          f
                                          k
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                              
                           
                        
                     Using Eq. (A.4) the following third degree derivative may be written

                        
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                
                                                   ∂
                                                   3
                                                
                                                ln
                                                f
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      s
                                                      i
                                                   
                                                
                                                ∂
                                                
                                                   θ
                                                   
                                                      k
                                                      j
                                                   
                                                
                                                ∂
                                                
                                                   θ
                                                   
                                                      t
                                                      m
                                                   
                                                
                                             
                                          
                                          =
                                          2
                                          
                                             
                                                ∂
                                                
                                                   f
                                                   s
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      s
                                                      i
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∂
                                                
                                                   f
                                                   k
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      k
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∂
                                                
                                                   f
                                                   t
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      t
                                                      m
                                                   
                                                
                                             
                                          
                                          
                                             1
                                             
                                                f
                                                3
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   ∂
                                                   2
                                                
                                                
                                                   f
                                                   s
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      s
                                                      i
                                                   
                                                
                                                ∂
                                                
                                                   θ
                                                   
                                                      t
                                                      m
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∂
                                                
                                                   f
                                                   k
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      k
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             1
                                             
                                                f
                                                2
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                          −
                                          
                                          
                                             
                                                ∂
                                                
                                                   f
                                                   s
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      s
                                                      i
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   2
                                                
                                                
                                                   f
                                                   k
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      k
                                                      j
                                                   
                                                
                                                ∂
                                                
                                                   θ
                                                   
                                                      t
                                                      m
                                                   
                                                
                                             
                                          
                                          
                                             1
                                             
                                                f
                                                2
                                             
                                          
                                          −
                                          
                                             
                                                ∂
                                                
                                                   f
                                                   t
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      t
                                                      m
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   2
                                                
                                                
                                                   f
                                                   s
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      s
                                                      i
                                                   
                                                
                                                ∂
                                                
                                                   θ
                                                   
                                                      k
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             1
                                             
                                                f
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∂
                                                   3
                                                
                                                
                                                   f
                                                   s
                                                
                                             
                                             
                                                ∂
                                                
                                                   θ
                                                   
                                                      s
                                                      i
                                                   
                                                
                                                ∂
                                                
                                                   θ
                                                   
                                                      k
                                                      j
                                                   
                                                
                                                ∂
                                                
                                                   θ
                                                   
                                                      t
                                                      m
                                                   
                                                
                                             
                                          
                                          
                                             1
                                             f
                                          
                                       
                                    
                                 
                              
                           
                        
                     If k and t are both not equal to s then

                        
                           
                              
                                 
                                    
                                       
                                          ∂
                                          3
                                       
                                       ln
                                       f
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                       ∂
                                       
                                          θ
                                          
                                             t
                                             m
                                          
                                       
                                    
                                 
                                 =
                                 2
                                 
                                    
                                       ∂
                                       
                                          f
                                          s
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             s
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          f
                                          k
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             k
                                             j
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          f
                                          t
                                       
                                    
                                    
                                       ∂
                                       
                                          θ
                                          
                                             t
                                             m
                                          
                                       
                                    
                                 
                                 
                                    1
                                    
                                       f
                                       3
                                    
                                 
                              
                           
                        
                     
                  

The first and second derivatives of 
                        
                           f
                           (
                           
                              y
                              ¯
                           
                           ;
                           
                              θ
                           
                           )
                        
                      are continuous in both 
                        
                           y
                           ¯
                        
                      and 
                        θ
                     . Consequently, they are bounded for 
                        
                           
                              θ
                           
                           ∈
                           
                              
                                 Ω
                              
                              ¯
                           
                        
                      and 
                        
                           
                              y
                              ¯
                           
                           ∈
                           
                              [
                              a
                              ;
                              b
                              ]
                           
                           ⊂
                           R
                        
                     . If 
                        
                           y
                           ¯
                        
                      is arbitrarily large, the derivatives remain bounded because the largest of these derivatives is 
                        
                           O
                           =
                           (
                           
                              
                                 y
                                 ¯
                              
                              4
                           
                           exp
                           
                              (
                              −
                              
                                 
                                    y
                                    ¯
                                 
                                 2
                              
                              )
                           
                           )
                        
                     . Also, the largest value of the third derivatives of ln f is 
                        
                           O
                           (
                           
                              
                                 y
                                 ¯
                              
                              6
                           
                           )
                        
                     . Moreover, all the moments of f exist and they are finite for all 
                        
                           
                              θ
                           
                           ∈
                           
                              
                                 Ω
                              
                              ¯
                           
                           ,
                        
                      so we may choose a constant M such that the second condition (A.2) is satisfied.

The third condition (A.3) is also satisfied because I(
                        θ
                     ) is a variance-covariance matrix.

@&#REFERENCES@&#

