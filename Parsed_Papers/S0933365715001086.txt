@&#MAIN-TITLE@&#On local anomaly detection and analysis for clinical pathways

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We propose a method to discover anomalies in clinical pathways.


                        
                        
                           
                           Both global and local anomalies are detected from clinical event logs.


                        
                        
                           
                           Diagnostic information about anomalies are provided for root cause analysis.


                        
                        
                           
                           Evaluation is done using a real clinical dataset from a Chinese hospital.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Local anomaly detection

Probabilistic topicmodel

Clinical event log

Clinical pathway analysis

@&#ABSTRACT@&#


               
               
                  Objective
                  Anomaly detection, as an imperative task for clinical pathway (CP) analysis and improvement, can provide useful and actionable knowledge of interest to clinical experts to be potentially exploited. Existing studies mainly focused on the detection of global anomalous inpatient traces of CPs using the similarity measures in a structured manner, which brings order in the chaos of CPs, may decline the accuracy of similarity measure between inpatient traces, and may distort the efficiency of anomaly detection. In addition, local anomalies that exist in some subsegments of events or behaviors in inpatient traces are easily overlooked by existing approaches since they are designed for detecting global or large anomalies.
               
               
                  Method
                  In this study, we employ a probabilistic topic model to discover underlying treatment patterns, and assume any significant unexplainable deviations from the normal behaviors surmised by the derived patterns are strongly correlated with anomalous behaviours. In this way, we can figure out the detailed local abnormal behaviors and the associations between these anomalies such that diagnostic information on local anomalies can be provided.
               
               
                  Results
                  The proposed approach is evaluated via a clinical data-set, including 2954 unstable angina patient traces and 483,349 clinical events, extracted from a Chinese hospital. Using the proposed method, local anomalies are detected from the log. In addition, the identified associations between the detected local anomalies are derived from the log, which lead to clinical concern on the reason resulting in these anomalies in CPs. The correctness of the proposed approach has been evaluated by three experience cardiologists of the hospital. For four types of local anomalies (i.e., unexpected events, early events, delay events, and absent events), the proposed approach achieves 94%, 71% 77%, and 93.2% in terms of recall. This is quite remarkable as we do not use a prior knowledge.
               
               
                  Conclusion
                  Substantial experimental results show that the proposed approach can effectively detect local anomalies in CPs, and also provide diagnostic information on the detected anomalies in an informative manner.
               
            

@&#INTRODUCTION@&#

Clinical pathways (CPs) have been widely adopted by health-care organizations to standardize clinical workflow, normalize treatment behaviors, reduce variations, decrease costs and improve quality, etc. [1,2]. Unfortunately, patient traces, being affected by many factors and uncertainties, are unpredictable by nature and thus may not go well towards the expected direction, and they have deviations with the predefined CPs. In fact, the uncertainties, resulting from inter-observer variability, inaccurate evaluation of the patient and some deficiencies in grading scales [3,4], make the organization of clinical work corresponding challenging, and lead to breakdowns such as delays, waste of resources and cancelations on the day of surgery, etc. [1]. In such cases, anomalies happen inevitably.

As shown in Fig. 1
                     , there are two types of anomalies in CPs. An anomalous patient trace of CPs, which is largely deviated from normal ones, called global or large anomaly. The others are local anomalies, which exist in some subsegments of clinical events or treatment behaviors in patient traces of CPs [5]. Local anomalies provide feedback on patient traces that do not conform to the normative CPs and quantify any treatment behavioral deviation. In general, local anomalies are extraneous in the global anomalous patient traces but are consistently absent from the normal patient traces. They may occur occasionally in regular patient traces, although in which normal treatment behaviors are frequently and consistently present. For CP analysis, it is imperative to detect potential local anomalies and their causal dependencies from observations in a maximally-informative manner, to provide detailed feedback on non-compliance and support root cause analysis. Once these anomalies are detected, and their causal dependencies are derived, they can be leveraged as a base line to treatment compliance measurement for CPs, and a health-care organization can either update its CP specifications to cover the respective case, or it can improve new mechanisms to enforce best clinical practice execution. In this way, local anomaly detection and analysis are a central piece in the puzzle of advancing health-care organizations toward a higher degree of CP maturity.

To the best of our knowledge, most of existing studies are usually developed for detecting global anomalous patient traces in a structured manner, e.g., sequence alignment [6]. In clinical environments, the diversity of treatment behaviors in CPs is far higher than that of common business processes. CPs, as typical human-centric processes, always take place in a loosely structured manner. Bringing order in the chaos of CPs probably requires different anomaly detection strategies rather than existing methods. In addition, a patient trace may be quite long and complicated; however, anomalies usually occur in local subsegments. Therefore, it is understandable that local anomalies cannot be targeted by existing methods, which are designed for the whole patient trace, and may ignore the local anomalies existing in some subsegments of clinical events or treatment behaviors in CPs. To this end, we propose in this paper a probabilistic approach for anomaly detection and analysis in CPs. In detail, we employ a probabilistic topic model, i.e., clinical pathway model (CPM) [7], to disclose essential features of CPs from clinical event logs, and thus provide an accurate description of CPs by combining different classes of distributions. More specifically, the derived CPM recognizes patient traces as a probabilistic combination of underlying treatment patterns, and describes treatment patterns as a probabilistic combination of various clinical events [7], which aids to detect local anomalies. Furthermore, we present a diagnostic method to detect the causal dependencies between local anomalies so as to provide detailed feedback on anomalies and support root cause analysis in a maximally informative manner. The proposed approach is evaluated via a real-world data set collected from Chinese PLA General hospital.

The paper is structured as follows. A brief overview of relevant related works is provided in Section 2. Section 3 presents preliminaries for our investigations. In Section 4, we present our approach of local anomaly detection and analysis in CPs. In detail, we, firstly, introduce how to generate a CPM from the collected clinical event log. And then, we explain how the generated CPM can be used for local anomaly detection. Furthermore, we introduce an approach of deriving diagnostic information on detected anomalies. Section 5 presents findings from our validation, for which we implemented a prototype and tested it on a real-world clinical event log. Section 6 discusses contributions, limitations and possible extensions of our approach. Finally, Section 7 concludes the paper and identifies topics for future work.

@&#RELATED WORK@&#

Many efforts have been expended on the CP anomaly detection and analysis. CP anomalies are usually conceptualized in terms of clinical outcomes [8,9], and a well-defined body of knowledge has developed that takes this perspective [8,10,11]. In clinical practice, for example, length of stay (LOS), mortality, and infection rate, etc., are commonly used measures of CP anomalies [12–14]. As valuable as these measures are, they restrict the attention to the analysis of CP anomalies from the external perspective. In medical informatics, there is an emerging attention to use data mining and machine learning technologies to acquire insights into CPs. These techniques are also called process mining [15–17], which has been widely studied in the domain of business process management. Process mining techniques attempt to extract non-trivial and useful information from event logs. Based on process execution data, with its logic and reasoning ability, process mining guarantees integrity, objectivity and universality of the discovered process patterns and knowledge.

As a clearly important subject to the development of more efficient and effective business process management, recent researches in the process mining domain have been addressing the problem of identifying abnormal behaviors in business processes. For example, Aalst and Medeiros [18] present a α-algorithm-based anomaly detection method that has been implemented in a well-known process mining tool, i.e., ProM [19]. In [20], Bezerra and Wainer systematically present how ProM tool can support anomaly detection in event logs for business process management. In particular, they discussed four algorithms for detecting anomalies in logs of process aware systems [21], and validated their approach with a real case.

The idea of using process mining to detect and analyze CP anomalies is based on an assumption that we can collect clinical event logs from various hospital information systems, which regularly record normal and abnormal treatment behaviors in CPs [6]. The approaches of process mining-based CP anomaly detection usually first extract one or several consensus models taking place in patient traces, classify a new patient trace to one of the discovered CP models, and then automatically detect if it is anomalous with respect to the general characteristics of its membership model. For example, Bouarfa and Dankelman proposed a process mining algorithm to derive a consensus model from a clinical event log, based on which CP anomalies can be detected automatically and without prior knowledge from clinical experts [6].

Although most process mining algorithms can detect anomalous process traces in a structured manner [22,9], the assumption that the processes take place in a structured fashion is not valid for CPs. In clinical settings, the complexity and diversity of treatment behaviors in CPs are far higher than that of common business processes [17,23]. In fact, many treatment behaviors can occur arbitrarily without a particular order in clinical practice. Detecting local anomalies for loosely-structured CPs probably requires a different mining strategy rather than existing process mining algorithms.

Our approach for local CP anomaly detection and analysis is based on clinical event logs extracted from hospital information systems. First, we clarify some concepts and their data representation, including clinical event, patient trace, and clinical event log.


                     
                        Definition 1
                        Clinical event


                        Let A be the treatment activity domain, and T the time domain. A clinical event e is represented as e
                           =(a, t), where a is the clinical activity type of e(a
                           ∈
                           A), and t is the occurring time of e(t
                           ∈
                           T). For convenience, let e
                           .
                           a and e
                           .
                           t be the activity type and the occurring time stamp of e, respectively. A clinical event is a performed treatment activity at a particular time stamp.

For example, let e
                     =(Admission, 1) be a specific clinical event, which indicates that the patient is in admission at the time stamp 1, where e
                     .
                     a
                     =Admission is the activity type of e, and e
                     .
                     t
                     =1 is the observed time-stamp of e. For the sake of simplicity, the time stamps of these event examples are integer values. However, they could be presented in a date-format manner.


                     
                        Definition 2
                        Patient trace


                        
                           
                              1
                           
                           
                              1
                              When learning a model from a clinical event log, it is necessary to decide what constitute the beginning and the end of each patient trace. In the context of a hospitalization, this can be easily set to admission and discharge. This is not the case in a different setting.
                           
                        

A patient trace is represented by σ
                           =
                           id
                           :〈e
                           1, e
                           2, …, e
                           
                              n
                           〉, where id is the patient identifier, and 〈e
                           1, e
                           2, …, e
                           
                              n
                           〉 (n
                           ≥2) is a finite non-empty sequence of clinical events such that e
                           1
                           .
                           a
                           =admission, e
                           
                              n
                           
                           .
                           a
                           =discharged, and each event appears only once, and time is non-decreasing, i.e., for 1≤
                           i
                           ≤
                           j
                           ≤
                           n
                           :
                           e
                           
                              i
                           
                           ≠
                           e
                           
                              j
                            and e
                           
                              i
                           
                           .
                           t
                           ≤
                           e
                           
                              j
                           
                           .
                           t.

For example, Fig. 2
                     (A) shows an example patient trace (patient id: 476104-3) of the unstable angina CP in the hospital. The trace contains a set of clinical activities, and spread along the observed time period of the patient's length of stay. Table 1
                      lists the meaning of these activity types.


                     
                        Definition 3
                        Clinical event log


                        Let 
                              C
                            be the set of all possible patient traces. A clinical event log
                           
                              L
                            is a set of patient traces, i.e., 
                              L
                              ⊆
                              C
                           .

We want to explore a clinical event log to discover the various categories of anomalies taking place in a specific CP. The detected anomalies may reveal a certain share of abnormal treatment behaviors in patient traces. In the following, we formalize a method for anomaly detection and analysis from clinical event logs.

@&#METHODOLOGY@&#

In this study, we use an extension of latent Dirichlet allocation (LDA) to model patient traces, named clinical pathway model (CPM) that we presented in our previous work [7]. As shown in Fig. 2(B), using CPM, each patient trace is modeled as a multinomial distribution of treatment patterns, and each treatment pattern is modeled as a multinomial distribution of clinical events. CPM assumes a Dirichlet prior distribution on the treatment pattern mixture parameters θ, ϕ, and φ, to provide a complete generative model for patient traces. θ is an 
                           |
                           L
                           |
                           ×
                           K
                         matrix of patient trace-specific mixture weights for the K treatment patterns, each drawn from a Dirichlet (α) prior. ϕ is an A
                        ×
                        K matrix of clinical activity-specific mixture weights over A activity types for the K treatment patterns, each drawn from a Dirichlet (β) prior. φ is an T
                        ×
                        A
                        ×
                        K matrix of occurring time stamp-specific mixture weights over T time instants for V activity types and K treatment patterns, each drawn from a Dirichlet (γ) prior. Our notation is summarized in Table 2
                        . For a more detailed description of the learning process, please refer to [7].

As mentioned above, existing methods designed for whole traces only focus on the global variations of treatment behaviors in CPs and overlook the characteristics of local anomalies. In this subsection, a novel method is proposed to detect local anomalies in CPs.

The general idea is based on the hypothesis that a patient trace σ can be represented as a mixture of K treatment patterns. The likelihood of a particular clinical event e given a particular patient trace σ, i.e., P(e
                        ∣
                        σ), can be formalized as:


                        
                           
                              (1)
                              
                                 P
                                 (
                                 e
                                 ∣
                                 σ
                                 )
                                 =
                                 
                                    ∑
                                    
                                       z
                                       ∈
                                       K
                                    
                                 
                                 P
                                 (
                                 e
                                 ∣
                                 z
                                 )
                                 P
                                 (
                                 z
                                 ∣
                                 σ
                                 )
                                 =
                                 
                                    ∑
                                    
                                       z
                                       ∈
                                       K
                                    
                                 
                                 P
                                 (
                                 e
                                 .
                                 t
                                 ∣
                                 z
                                 ,
                                 e
                                 .
                                 a
                                 )
                                 P
                                 (
                                 e
                                 .
                                 a
                                 ∣
                                 z
                                 )
                                 P
                                 (
                                 z
                                 ∣
                                 σ
                                 )
                              
                           
                        where P(e
                        ∣
                        z) is the probability of e within the treatment pattern z, and P(z
                        ∣
                        σ) is the probability of performing a clinical event from z in the whole patient trace σ. Note that the number of latent treatment patterns K has to be defined in advance and allows to adjust the degree of specialization of the latent patterns. The derived CPM, as described in Section 4.1, estimates the pattern-event distribution P(e
                        ∣
                        z)=
                        P(e
                        .
                        t
                        ∣
                        z, e
                        .
                        a)P(e
                        .
                        a
                        ∣
                        z) and the trace-pattern distribution P(z
                        ∣
                        σ) from a clinical event log using Dirichlet priors for the distributions and a fixed number of treatment patterns [7]:


                        
                           
                              (2)
                              
                                 P
                                 (
                                 e
                                 ∣
                                 σ
                                 )
                                 =
                                 
                                    ∑
                                    
                                       z
                                       ∈
                                       K
                                    
                                 
                                 P
                                 (
                                 e
                                 .
                                 t
                                 ∣
                                 z
                                 ,
                                 e
                                 .
                                 a
                                 )
                                 P
                                 (
                                 e
                                 .
                                 a
                                 ∣
                                 z
                                 )
                                 P
                                 (
                                 z
                                 ∣
                                 σ
                                 )
                                 =
                                 
                                    φ
                                    
                                       e
                                       .
                                       t
                                       ,
                                       e
                                       .
                                       a
                                       ,
                                       z
                                    
                                 
                                 
                                    ϕ
                                    
                                       e
                                       .
                                       a
                                       ,
                                       z
                                    
                                 
                                 
                                    θ
                                    
                                       σ
                                       ,
                                       z
                                    
                                 
                              
                           
                        
                     

This likelihood can be used to detect whether a clinical event is normal or abnormal with respect to the host patient trace. To this end, we define the normality measure of a particular clinical event e given a particular patient trace σ as follows:


                        
                           
                              (3)
                              
                                 Ξ
                                 (
                                 e
                                 ,
                                 σ
                                 )
                                 =
                                 
                                    
                                       P
                                       (
                                       e
                                       ∣
                                       σ
                                       )
                                    
                                    
                                       
                                          max
                                          
                                             
                                                e
                                                ′
                                             
                                             ∈
                                             
                                                σ
                                                ′
                                             
                                             ,
                                             
                                                σ
                                                ′
                                             
                                             ∈
                                             L
                                          
                                       
                                       P
                                       (
                                       
                                          e
                                          ′
                                       
                                       ∣
                                       
                                          σ
                                          ′
                                       
                                       )
                                    
                                 
                              
                           
                        where e′ denotes the typical clinical event in the log
                        
                           L
                         which receives the largest probability given a particular patient trace σ′. Based on the normality measure Ξ(e, σ), a local CP anomaly can be classified as one of the four types: an unexpected event, an absent event, an early event, and a delay event, respectively. We give the formal definitions of these local CP anomalous types as follows:


                        
                           Definition 4
                           Unexpected event


                           Let σ be a particular patient trace, e be a particular clinical event, and a particular low threshold ν
                              
                                 low
                              (0≤
                              ν
                              
                                 low
                              
                              ≤1), we say e is an unexpected-occurred clinical event to σ, if:
                                 
                                    •
                                    
                                       e
                                       ∈
                                       σ,

Ξ(e, σ)<
                                       ν
                                       
                                          low
                                       , and

∄t
                                       ∈
                                       T, where t
                                       ≤max{e′.
                                       t
                                       ∣
                                       e′∈
                                       σ} and Ξ(〈e
                                       .
                                       a, t〉, σ)≥
                                       ν
                                       
                                          low
                                       .


                        
                           Definition 5
                           Absent event


                           Let σ be a particular patient trace, e be a particular clinical event, ν
                              
                                 low
                               be a particular low-threshold, and ν
                              
                                 up
                              (0≤
                              ν
                              
                                 up
                              
                              ≤1) be a particular up-threshold, we say e is an absent event to σ, if:
                                 
                                    •
                                    
                                       e
                                       ∉
                                       σ, and

Ξ(e, σ)>
                                       ν
                                       
                                          up
                                       .


                        
                           Definition 6
                           Early event


                           Let σ be a particular patient trace, e be a particular clinical event, and a particular low threshold ν
                              
                                 low
                               (0≤
                              ν
                              
                                 low
                              
                              ≤1), we say e is an early event to σ, if:
                                 
                                    •
                                    
                                       e
                                       ∈
                                       σ,

Ξ(e, σ)<
                                       ν
                                       
                                          low
                                       ,

∃T
                                       
                                          σ
                                       , T
                                       
                                          σ
                                       
                                       ⊆
                                       T and T
                                       
                                          σ
                                       ≠∅, where ∀t
                                       ∈
                                       T
                                       
                                          σ
                                        satisfying t
                                       ≤max{e′.
                                       t
                                       ∣
                                       e′∈
                                       σ} and Ξ(〈e
                                       .
                                       a, t〉, σ)≥
                                       ν
                                       
                                          low
                                       , and

∀t
                                       ∈
                                       T
                                       
                                          σ
                                       , e
                                       .
                                       t
                                       <
                                       t.


                        
                           Definition 7
                           Delay event


                           Let σ be a patient trace, e be a particular clinical event, and a particular low threshold ν
                              
                                 low
                              (0≤
                              ν
                              
                                 low
                              
                              ≤1), we say e is a delay event to σ, if:
                                 
                                    •
                                    
                                       e
                                       ∈
                                       σ,

Ξ(e, σ)<
                                       ν
                                       
                                          low
                                       ,

∃T
                                       
                                          σ
                                       , T
                                       
                                          σ
                                       
                                       ⊆
                                       T and T
                                       
                                          σ
                                       ≠∅, where ∀t
                                       ∈
                                       T
                                       
                                          σ
                                        satisfying t
                                       ≤max{e′.
                                       t
                                       ∣
                                       e′∈
                                       σ} and Ξ(〈e
                                       .
                                       a, t〉, σ)≥
                                       ν
                                       
                                          low
                                       , and

∀t
                                       ∈
                                       T
                                       
                                          σ
                                       , e
                                       .
                                       t
                                       >
                                       t.

It must mention that the normality of a clinical event e with a particular patient trace σ, Ξ(e, σ), can be objectively obtained. However, the concepts of local CP anomalies are subjective for each individual. Therefore, the thresholds ν
                        
                           low
                         and ν
                        
                           up
                         are proposed to judge whether a clinical event is clarified as a specific type of anomaly.

By applying the proposed approach to a clinical event log, we can detect local anomalies in CPs. For CP analysis, it is imperative to understand the detected anomalies in a maximally-informative manner. To this end, the frequency with which specific local anomalies are observed should be known in order to identify the reasons for anomaly processing in general. In addition, because a particular local anomaly may explicitly be caused by another local anomaly that happened before, it is necessary to investigate the dependencies between these local anomalies, which can provide valuable information on anomaly evaluation. For this purpose, we adapt the notions of support and confidence known from the field of association mining, which is to find out associations from a given database of transactions. These transactions consist of a set of items. Adapted to our setting, a transaction is represented by a single patient trace, while an item is a clinical activity-anomaly type pair that is observed, i.e., x
                        =(a, ω) where a
                        ∈
                        A and ω
                        ∈
                        Ω denotes the activity type and the anomaly type of x, respectively. For example, as shown in Fig. 2(A), there is a detected anomaly x
                        =〈A21, delay〉 to the patient trace whose pid is 476104-3, indicating that A21 is delay occurred in that patient trace. For convenience, let x
                        .
                        a and x
                        .
                        ω be the activity type and anomaly type of x, respectively. We define the support for a dedicated local anomaly as the number of cases in a clinical event log in which it can be observed.


                        
                           Definition 8
                           Support for local anomaly


                           Let 
                                 L
                               be a clinical event log, and x be a detected local anomalous item. The support for x in 
                                 L
                               is defined as
                                 
                                    (4)
                                    
                                       supp
                                       (
                                       x
                                       )
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               {
                                                               σ
                                                               ∈
                                                               L
                                                               ∣
                                                               ∃
                                                               e
                                                               ∈
                                                               σ
                                                               ,
                                                               e
                                                               .
                                                               a
                                                               ≡
                                                               x
                                                               .
                                                               a
                                                               ∧
                                                               ξ
                                                               (
                                                               e
                                                               ,
                                                               σ
                                                               )
                                                               ≡
                                                               x
                                                               .
                                                               ω
                                                               }
                                                            
                                                            
                                                               |
                                                               L
                                                               |
                                                            
                                                         
                                                      
                                                      
                                                         if
                                                         
                                                         x
                                                         .
                                                         ω
                                                         ∈
                                                         {
                                                         Unexpected
                                                         ,
                                                         
                                                         Early
                                                         ,
                                                         
                                                         Delay
                                                         }
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               {
                                                               σ
                                                               ∈
                                                               L
                                                               ∣
                                                               ∃
                                                               t
                                                               ∈
                                                               T
                                                               ,
                                                               1
                                                               ≤
                                                               t
                                                               ≤
                                                               max
                                                               {
                                                               
                                                                  e
                                                                  ′
                                                               
                                                               .
                                                               t
                                                               ∣
                                                               
                                                                  e
                                                                  ′
                                                               
                                                               ∈
                                                               σ
                                                               }
                                                               ,
                                                               ξ
                                                               (
                                                               〈
                                                               
                                                                  x
                                                                  .
                                                                  a
                                                                  ,
                                                                  t
                                                               
                                                               〉
                                                               ,
                                                               σ
                                                               )
                                                               ≡
                                                               x
                                                               .
                                                               ω
                                                               }
                                                            
                                                            
                                                               |
                                                               L
                                                               |
                                                            
                                                         
                                                      
                                                      
                                                         if
                                                         
                                                         x
                                                         .
                                                         ω
                                                         ≡
                                                         Absent
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

While the support for local anomalies helps to separate frequent and rare local anomalies, the analysis of these local anomalies is more effective if dependencies between local anomalies are taken into account. In fact, an abnormal treatment event in a patient trace might cause several subsequent violations in the execution of the patient trace. To detect these causal dependencies and focus on the actual cause of a series of local anomalies, we adapt the notion of confidence of association rules, which relates rules between items to their statistical significance and, therefore, reflects the strength of a rule. Adapted to our setting, a rule is an implication between two local anomalies for which we define confidence as follows:


                        
                           Definition 9
                           Confidence for association between local anomalies


                           Let 
                                 L
                               be a clinical event log. For two distinct CP anomalies x
                              1 and x
                              2, the confidence of the dependency rule from x
                              1 to x
                              2 is defined as


                              
                                 
                                    (5)
                                    
                                       conf
                                       (
                                       
                                          x
                                          1
                                       
                                       →
                                       
                                          x
                                          2
                                       
                                       )
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         if
                                                         
                                                         supp
                                                         (
                                                         
                                                            x
                                                            1
                                                         
                                                         )
                                                         =
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               supp
                                                               (
                                                               
                                                                  x
                                                                  1
                                                               
                                                               )
                                                               ⋃
                                                               supp
                                                               (
                                                               
                                                                  x
                                                                  2
                                                               
                                                               )
                                                            
                                                            
                                                               supp
                                                               (
                                                               
                                                                  x
                                                                  1
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         otherwise
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Although we restricted our discussion on rules between two detected local anomalies, the introduced concepts may be lifted to rules between more than two local anomalies in a straight-forward manner.

To evaluate the feasibility of the presented methods, we implemented all introduced concepts in a prototypical tool and applied it in a clinical case study in the cooperation with the cardiology department of Chinese PLA General hospital. The explanation of the experimental setups and obtained results are presented in the following.

@&#EXPERIMENTAL DESIGN@&#

The experimental log is collected from the cardiology department of Chinese PLA General hospital. The CP of unstable angina is selected in the case study. Unstable angina is a kind of chest discomfort or pain that occurs in a continuous and unpredictable way, and can result from the disruption of an atherosclerotic plaque in narrowed coronary vessels with lessened flexibility, embolization and vasospasm. Unstable angina lays its symptoms between exertional stable angina and acute myocardium infarction and a further sudden death. While the risk of unstable angina is high, the population of unstable angina is huge, especially for aged people and those with associated disease such as hypertension and diabetes [24]. Thus, the task of anomaly detection and analysis in the unstable angina CP will be of significant value and interest. The detected anomalies can provide clinicians explicit feedbacks of treatment actions to influence treatment behaviors in concern for the patient's benefit.

For the unstable angina CP, we collected 2934 patient traces from the electronic medical record system of the hospital. Each patient trace consists of a set of clinical events. Such an event has a clinical activity name, and the time-stamp marking the time of execution of the activity. Some statistics about the experimental log are shown in Table 3
                        , including the trace number, clinical event number, clinical activity number, the average length of stay (LOS), the minimum LOS, and the maximum LOS of the log, etc. Table 3 lists the names of part of activities contained in the log. We translated the Chinese names into English.

Although the unstable angina CP is standardized and documented, the treatment behaviors are manually carried out and variations always occur in CP execution, which are implicitly indicated by their LOS in the hospital. As shown in Table 3, the average LOS of unstable angina patients is 9 days, while the minimum LOS is 1 day, and the maximum LOS is 93 days in the hospital.

All experiments were performed on a Lenevo compatible PC with an Intel Pentium IV CPU 2.8GHz, 4G byte main memory running on Microsoft Windows 7. The algorithms were implemented using Microsoft C#. Prior approval was obtained from the data protection committee of the hospital to conduct the study. We state that the patient data was anonymized in this study and in this paper.

The first step is to learn a CPM from the collected unstable angina event log. CPM is an extension of LDA, and has already applied in CP pattern mining in our previous work [7]. In this step, we choose the Dirichlet prior α, β, and δ of CPM as 0.1, 0.01, and 0.01, respectively, which are common settings in literature. In addition, we applied Gibbs sampling to learn the CPM from the log. The number of iterations of the Markov chain for Gibbs sampling is set to 1000. Before generating CPM from the collected log, we first determine the number of topics (i.e., treatment patterns) using the perplexity score, which is a standard measure to evaluate the prediction power of a probabilistic model, and has been widely used to determine the number of topics (i.e., treatment patterns in this work) [22,7]:


                        
                           
                              (6)
                              
                                 Perplexity
                                 =
                                 exp
                                 
                                    
                                       
                                          −
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      σ
                                                      ∈
                                                      L
                                                   
                                                
                                                log
                                                P
                                                (
                                                
                                                   
                                                      
                                                         e
                                                      
                                                   
                                                   σ
                                                
                                                |
                                                M
                                                )
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      σ
                                                      ∈
                                                      L
                                                   
                                                
                                                |
                                                σ
                                                |
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           M
                         is the learned CPM, and e
                        
                           σ
                         are the set of unseen events in the patient trace σ.

We calculate the perplexity scores of the trained CPM over a held-out test data set with a different number of topics. Specifically, 10% samples from the collected log are randomly selected as the test. In general, the number of topics is set to the value resulting in the smallest perplexity score. However, we observe that the perplexity of CPM roughly drops with the increase of K in the experiments. If we only take into account the perplexity, we probably select the maximum K of a given range, which may make the learned model over-fitting. Thus, we balance the above-mentioned approach by a simple way; that is, if the reducing ratio of perplexity is less than τ, we do not select a larger K. In practice, we set τ to be 10% according to experiment analysis. In this study, we empirically choose the number of patterns K
                        =3 for the experimental log, where the perplexity seems to decrease rapidly and then appears to settle down.

In this subsection, we study the impact of ν
                        
                           up
                         and ν
                        
                           low
                         on the number of detected local anomalies from the experimental log, where ν
                        
                           up
                         and ν
                        
                           low
                         are up and low local normality threshold values. The detection of the absent-occurred anomalies is relevant with ν
                        
                           up
                        , while the detection of the other three types of local anomalies is impacted by ν
                        
                           low
                         and independent with ν
                        
                           up
                        . Fig. 3
                        (A) depicts the number of absent-occurred anomalies when different values of ν
                        
                           up
                         are applied. As shown in Fig. 3(A), when ν
                        
                           up
                         is larger than 0.93, there are no detected absent-occurred anomalies. With the further decreases of ν
                        
                           up
                        , the absent-occurred anomalies are detected from the experimental log. When ν
                        
                           up
                        
                        =0.9, there are 59 absent-occurred local anomalies detected from the log. Fig. 3(B) depicts the impact of ν
                        
                           low
                         on the number of detected local anomalies from the experimental log. As shown in Fig. 3(B), with the increase of ν
                        
                           low
                        , the curve of unexpected-occurred anomalies increases linearly, the curves of delay-occurred anomalies and early-occurred anomalies increase at first with the increase of ν
                        
                           low
                        , and then remain stable with the further increase of ν
                        
                           low
                        . When ν
                        
                           low
                         is set as 0.1, there are 40518 unexpected local anomaly, 1093 early-occurred local anomalies, and 14608 delay-occurred local anomalies detected from the experimental log. As we can see from Fig. 3, the unexpected-occurred anomalies and the delay-occurred anomalies occupy the main component in all detected local anomalies.

Based on the detected both global and local anomalies for all patient traces in the collected log, we investigate an overall anomaly occurring information. At first, we investigate how the detected local anomalies are distributed over both the log and the detected global anomalous traces. To this end, we employ a CPM-based approach to detect global anomalous patient traces from the experimental log [9]. In particular, we compare patient traces based on the generated CPM using the assumption that two patient traces are similar if the same treatment behavior distributions appear in them. Then, we evaluate whether a particular trace σ is abnormal or not based on its closeness to the other traces in the log. This is done with respect to the average closeness between other traces in the log. Specifically, we define a particular patient trace σ as normal if its’ average closeness between other patient traces is larger than a particular threshold μ(0≤
                        μ
                        ≤1). Otherwise, it is a globally anomalous patient trace.


                        Table 4
                         shows the impact of μ on the detected global anomalous patient traces and the corresponding precision value. When μ
                        =0.35, there are 196 global anomalies detected, and the precision is about 91.8% (i.e., 180 detected global anomalies are evaluated as true, and 16 detected global anomalies are evaluated as false by clinical experts). When μ reduces to a certain value, i.e., μ
                        ≤0.3, the curve ‘precision’ remains stable with the further decreases of μ, i.e., less than 107 detected anomalies and 100% precisions. Although the precision achieved is quite remarkable when μ
                        ≤0.3, there are at least 73 (180–107) global anomalies recognized by clinical experts are not detected by the proposed method. Clearly, when μ
                        =0.35, our approach can detect most of the anomalies from the log. Thus, as a conservative estimate, the default value for normality threshold value μ is set at 0.35.


                        Fig. 4
                         shows the number of detected local anomalies (within ν
                        
                           low
                        
                        =0.005 and ν
                        
                           up
                        
                        =0.9) and how they are distributed over both the log and the detected global anomalous traces. For each number of local anomalies, Fig. 4 depicts the number of patient traces in the log, and a corresponding number of anomalies. Nearly 1500 normal patient traces do not contain local anomalies, and almost 700 patient traces that we observe solely contain a single local anomaly. Further, at most 18 local anomalies are detected in a single patient trace. In addition, we observe from Fig. 4 that most patient traces, which contains a large number of local anomalies, are global anomalies. For example, when the number of local anomalies is 12, 10 out of 11 patient traces, which contain these local anomalies are global anomalies. Hence, we can conclude that local anomalies are extraneous in the global anomaly but are consistently absent from the regular patient traces.

Furthermore, we analyze the detected local anomaly types from the experimental log. Fig. 5
                         depicts the distributions of the detected local anomaly types (with ν
                        
                           low
                        
                        =0.005 and ν
                        
                           up
                        
                        =0.9) over both normal patient traces and the detected global anomalous traces (with μ
                        =0.35). In all, 79 local anomaly types are detected from the experimental log. As we can see from Fig. 5, the most frequently occurred local anomaly types are clinical examination or laboratory test-related activities, such as ‘CT examination: delay occurred’, ‘ECG monitoring and oxygen saturation monitoring: delay occurred’, ‘occult blood test: delay occurred’, and ‘body fluid bacterial culture and strain identification: unexpected occurred’, etc., which can be seen as common types of local anomalies in the unstable angina CP. For example, clinical activity ‘CT examination’ delay occurred in 46 patient traces, and clinical activity ‘body fluid bacterial culture and strain identification’ unexpected occurred in 52 patient traces. Based on these results, the necessity to deviate from the standard processing for ‘body fluid bacterial culture and strain identification’ and the potential to delay the execution of activity ‘CT examination’ under certain circumstances can be evaluated by clinicians. In addition, many of patient traces which contain these types of local anomalies are global anomalies. For example, the types of local anomalies ‘PCI: delay occurred’ happened frequently in the global anomalous traces (22 out of 24 patient traces), which can be seen as a typical feature for global anomalies. And it explicitly indicates our conclusion that most types of local anomalies are frequently and consistently present in global anomalous traces but are deficient from regular ones.

To evaluate the effectiveness of the proposed local anomaly detection mechanism, we fixed ν
                        
                           low
                        
                        =0.01 and ν
                        
                           up
                        
                        =0.9, and randomly selected 100 unexpected events, 100 early events, 100 delayed events, and 59 absent events from a total of 1735 unexpected events, 195 early events, 5914 delayed events, and 59 absent events detected from the experimental log, respectively. Then, the comparison between the detected anomalies of the proposed approach and the physician's decisions was done for each type of local anomalies. The result is given in Table 5
                        . The physician made the same decisions as the proposed approach in 94 (out of a total of 100) unexpected events (94%), 71 (out of a total of 100) early events (71%), and 77 (out of a total of 100) delayed events (77%), and 55 (out of a total of 59) absent events (93.2%), respectively. The proposed approach achieves the best precision on detecting unexpected and absent events. Although the prediction performance for detecting early events and delay events is not good enough, this is because that most of early events or delay events occurred in one day before or after the scheduled time stamps. The physicians think it is acceptable in CPs. However, our system detected these time stamp deviations of clinical events from the log.

Finally, the identified associations between the detected anomalies are visualized in Fig. 6
                        . In this graph, nodes depict CP anomalies with a support larger than 100 in the log (2954 traces), while edges represent association rules between the detected anomalies that have a confidence above the threshold of 0.75. The node size reflects the support values, and the edge strength correlates with the confidence value. As we can see, the anomalies, i.e., ‘A55 (promoting blood circulation for removing blood stasis): unexpected occurred’, ‘A50 (body fluid bacterial culture and strain identification): unexpected occurred’, ‘A49 (blood bacterial culture and strain identification): unexpected occurred’, and ‘A60 (critically ill): unexpected occurred’ imply various other anomalies, such as ‘A2 (discharge): delay occurred’, etc. It indicates that these anomalies are critical and many other CP anomalies are causally dependent. Thus, it leads to clinical concern on the reason resulting in the unexpected-occurrence of these clinical activities in patient care-flow. Further, the associations between these anomalies have high confidence values, i.e., they always occur together in patient traces.

We have implemented and tested the proposed approach using Microsoft C#. Fig. 7
                         depicts a screen-shot of our prototype. Based on the input clinical event log extracted from Chinese PLA General hospital, we can describe the details of the log, and each patient trace in the log. On the left part of Fig. 7, all patient traces with their IDs and all activity types existing in the log are listed. Each activity type is represented as a color dot to distinguish clearly. User could select the patient trace and the types of interest to display. On the right part of Fig. 7, it shows the time-lines of two selected patient traces with IDs 396588-5 and 284934-6, which distributes all the events upon the corresponding in-patient days. The detected anomalies (both global anomalous patient trace and local abnormal clinical events) are highlighted using a red rectangle. For example, patient trace with ID 396588-5, detected as a global anomaly, is composed of a lot of local abnormal events (e.g., 〈A1, 17〉, etc.).

@&#DISCUSSION@&#

In comparison with many process mining techniques that are designed for detecting global or large anomalies, this study provides a solution of how to detect local anomalies that might exist in some subsegments of patient traces, and are easily overlooked by most of the existing approaches. The previous section clearly showed that our approach can detect four types of abnormal treatment events, i.e., early event, delay event, unexpected event, and absent event. As a result, precisely diagnostic information about the critical local anomalies can be provided for further decision support and root cause analysis in order to assist clinical experts in CP analysis and optimization efforts. To this end, we argue that the developed methodology can provide the community with a novel approach of anomaly detection and analysis in CPs, which will remark the importance of the task in CP analysis, particularly vulnerable to fraudulent/undesirable treatment behavior detection and analysis.

In Section 4.3, we discussed how to derive causal dependencies between local anomalies in order to provide diagnostic information for root cause analysis of local anomalies. Note that local anomalies are infrequent clinical events in CPs. While traditional association mining algorithms can be used to discover the dependency rules between anomalies based on frequency, they are insufficient to determine the importance of a rule composed of items based only on their frequencies. In addition, traditional algorithms discover association rules by exploiting support and confidence requirements, and use a minimum support threshold to prune its combinatorial search space. If the minimum support is set too low, this may increase the workload significantly and may cause the traditional problem of algorithms suffering from extremely poor performance. In our setting, the detected local CP anomalies occur infrequently, and these anomalies appear simultaneously with other local anomalies in high proportions. Thus, the support of local anomalies is low and the level of confidence could be high. Note that we use support not to prune local anomalies but to evaluate them and discover the dependency between the detected anomalies. In fact, clinicians could be quite interested in the relationship of essential/critical local anomalies, in which case our methods could be very helpful.

Although our results have been encouraging to date, the proposed approach is suffered from the following limitations when applied to clinical event logs:
                        
                           •
                           In this study, anomalies are detected in a posterior fashion. Although it is beneficial to provide posterior analysis for answering the questions such that if an established CP model was adhered to at a period during the past, the main interest of clinicians lies in the future. Ideally, they envision having a continuous auditing service that gives them real time insights into anomalies of CPs.

Detected anomalies, conditioned on patient status, effectively reflect the real executing scenarios in CPs. It is, therefore, benefited to include patient conditions and outcomes in anomaly detection and analysis to address practical questions, such that, when is an anomaly in treatment result of an ‘anomalous’ patient? how to foster ‘good’ anomalies (that results in improved CP performance, for example), and how to limit ‘bad’ anomalies (that results in decreased patient satisfaction, for example)? Etc. This could be followed by more formal analysis of CPs in order to document and systematically measure the extent of anomalies and to explore the appropriateness of these anomalies w.r.t different patient individuals and in different clinical situations.

In this study, we base our local anomaly detection on a previously proposed probabilistic topic model, i.e., CPM, which has limitations to account for the dependencies between the first diagnosis and comorbidities. Note that a CP is generally designed for a single disease such that the treatments on the common comorbidities are easily neglected in the pathway design phrase. For example, there are more than 80 common comorbidities of the unstable angina patients, and many of them (e.g., kidney deficiency, etc.) which are not well explained in the unstable angina pathway specification afflict the execution of the pathway seriously, and incur local anomalies from the predefined CP specification. Therefore, it is increasingly important to study actual treatment behaviors between the first diagnosis and its common comorbidities to extract knowledge and information in CPs, and to help clinical analysts to redesign/refine more feasible CPs, and make better treatment strategies for the care of individual patients in CPs.

@&#CONCLUSION@&#

In this study, we propose a computational model for local CP anomaly detection. In particular, we learn a probabilistic topic model to describe the general characteristics of patient traces from a clinical event log generated by hospital information systems. Local anomalies can be detected via fitting the normal treatment behaviors depicted in the model. Our contribution comprises concepts that provide diagnostic information and enable effective root cause analysis for CP anomalies. The proposed approach has been implemented in a prototype and validated in a case study with the Chinese PLA General hospital.

We believe that anomaly detection and analysis are of serious importance for CP analysis and optimization. The detected anomalies are not the simple feedback about patient traces, but the practical guidance on clinical practice combined to the overall improvements of health-care organizations and CPs. As a generalized solution to CP anomaly detection and analysis, the proposed approach can be applied to not only the unstable angina but also many other diseases. To this end, we aim to study the merits of our approach in further clinical collaborations. More empirical studies to a wider range of diseases will be performed to obtain more tangible conclusions regarding the proposed approach. As well, we are working with developers on embedding this technique into EMR system of the hospital, which is supposed to provide practitioner reminders and alerts as well as availability of complete and accurate data for physicians, to achieve high quality of health services and prevent medical errors with an adaptive mechanism for CPs.

Although the main motivation behind our work is the forensic analysis of clinical event logs, the techniques presented herein can also be applied to business process management domain, in which event logs are commonly recorded by various information systems such that anomaly detection and analysis of business processes in specific application settings can be constructed using our methodology.

@&#ACKNOWLEDGEMENTS@&#

This work was supported by the National Nature Science Foundation of China under Grant No. 81101126 and 61562088, and the Fundamental Research Funds for the Central Universities under Grant No 2014QNA5014.

The authors would like to give special thanks to all experts who cooperated in the evaluation of the proposed method. In addition, the authors would like to thank the anonymous reviewers for their constructive comments on an earlier draft of this paper.

@&#REFERENCES@&#

