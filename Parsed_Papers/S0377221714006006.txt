@&#MAIN-TITLE@&#A hybrid stock trading system using genetic network programming and mean conditional value-at-risk

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We combine the advantages of evolutionary algorithms and statistical model.


                        
                        
                           
                           The system has generated effective trading strategies for different risk-attitudes.


                        
                        
                           
                           We propose a method to forecast the stock prices in two opposite environments.


                        
                        
                           
                           Model based on maximum Sharpe Ratio portfolio performs the best in bull market.


                        
                        
                           
                           Model based on the global minimum risk portfolio performs the best in bear market.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Evolutionary computations

Investment analysis

Risk management

Conditional Value-at-Risk

Portfolio optimization

@&#ABSTRACT@&#


               
               
                  This paper describes a hybrid stock trading system based on Genetic Network Programming (GNP) and Mean Conditional Value-at-Risk Model (GNP–CVaR). The proposed method, combining the advantages of evolutionary algorithms and statistical model, has provided useful tools to construct portfolios and generate effective stock trading strategies for investors with different risk-attitudes. Simulation results on five stock indices show that model based on GNP and maximum Sharpe Ratio portfolio performs the best in bull market, and that based on GNP and the global minimum risk portfolio performs the best in bear market. The portfolios constructed by Markowitz’s mean–variance model performs the same as mean-CVaR model. It is clarified that the proposed system significantly improves the function and efficiency of original GNP, which can help investors make profitable decisions.
               
            

@&#INTRODUCTION@&#

This paper describes an advanced stock trading strategy using Genetic Network Programming with Mean Conditional Value-at-Risk Model (GNP–CVaR), which combines the advantages of evolutionary algorithms and statistical models, i.e., mean–variance and mean-CVaR models, has made a good performance on the finance market. In the proposed system, technical indices and candlestick charts are used as judgment functions of GNP to decide buying and selling points, while mean-CVaR model is used to distribute the weight of capitals to different stock indices in the portfolio at each time point. Efficient frontier is used to verify the expected return and risk under different distributions of capital. Finally, the performances of the proposed model are compared with original GNP as well as buy-and-hold strategy.

The paper contributes to the existing finance and computing literatures in several ways. First of all, forecasting of stock prices has always been a hot topic, however, the hybrid research of evolutionary computation and statistical model is little. This is the first time to combine GNP with risk measurement models. Secondly, the weight distribution of capital in original GNP model is fixed and takes no consideration of risk, while the mean–variance and mean-CVaR models provide a measurement of risk and construct a variety of portfolios by allocating different capital to each asset. Thus, GNP–CVaR may trade off the expected return and risks in a special way. Thirdly, most methods evaluate the stock prices at one time period in the simple market environment, however, we propose a new method to forecast the stock prices in two opposite environments, i.e., bull market and bear market. At last, sliding window is used in the testing of model performances.

The rest of this paper is organized as follows. Section 2 provides background information and a literature review in this field. In Section 3, we explain the portfolio optimization algorithm and stock trading strategy. Section 4 presents experimental environments, conditions and simulation results. The proposed method is compared with some traditional methods, and its efficiency has been confirmed. Finally, Section 5 concludes this paper.

@&#BACKGROUND@&#

In recent years, stock has been a major investment due to its high returns. Generally speaking, there are two most often used analytical methods when one selects stocks to invest: fundamental analysis and technical analysis. On one hand, fundamental analysis mainly focuses on the listed company operations, conditions and financial status in an effort to determine the intrinsic value of a company’s stock and forecast the future profits. Since fundamental analysis can be an useful tool for stock market prediction, one can select stocks accordingly. On the other hand, technical analysis has played an important role in the stock market due to the fact that it offers a relative mixture of human, political, and economic events. Technical analysis studies historical data surrounding the price and volume movements of stocks by using charts as the primary tool to forecast future price movements. All these factors make technical analysis an important tool for stock market prediction (Huang, Chen, & Pan, 2011; Achelis, 2001; Samaras, Matsatsinis, & Zopounidis, 2008).

Technical analysis aims at more accurate results, calculations and better performance. The success enjoyed by technical analysis has allowed it to become broadly accepted among financial analysts and brokerage firms. Many major brokerage firms publish technical commentary on the market and individual securities, and various analysts publish newsletters based on technical analysis (Brock, Lakonishok, & LeBaron, 1992). Surveys also show that many investors use technical analysis to make decisions on buying and selling. This paper will focus more on the analytical nature of technical analysis, which was composed of various approaches that could be separated into statistical models and artificial intelligence (AI) models.

The statistical models are widely used to predict the returns of financial instruments based on the past time series data. For example, Box and Pierce (1970) firstly proposed the autoregressive moving average model (ARMA) for time series analysis. Bollerslev (1986); Engle (1982) and Nelson (1991) introduced the ARCH family models, including ARCH, GARCH and EGARCH models. Kung and Yu (2008) adopted the GM(1, 1) model to predict the rates of return of nine major index futures in the American and Eurasian markets, and revealed that the GARCH/TGARCH model performs better than the GM(1, 1), including the optimal α method, in terms of forecasting capabilities. All of these are very useful in capturing the volatility clustering of returns. Traditionally used tool to assess and control market risk is Markowitz’s mean–variance model (Markowitz, 1952), which assumes the portfolio returns to be normally distributed, and the mean and variance are used to balance the return and risk.

However, it is widely argued that the variance is not a good measurement for risk, because it cannot define the direction of volatility. Thus, a measure aimed at calculating the downside risk named Value-at-Risk (VaR) became popular and even achieved a high status of being written into the industry regulation (Morgan, 1995; Goh, Lim, Sim, & Zhang, 2012). VaR has been widely used in various applications, but it is inadequate for market risk evaluation since it is non-convex and discontinuous for discrete distributions, and is not a coherent risk measure. When the loss distributions are “sharp and heavy tail”, VaR would become unstable and difficult to work with numerically. Moreover, VaR does not account for properties of the distribution beyond the confidence level.

To overcome these shortages, a new model named Conditional Value-at-Risk (CVaR) is proposed by Rockafellar and Uryasev (2002), which is also called Mean Excess Loss, Mean Shortfall, or Tail VaR. CVaR is the expected loss given that the loss is greater than or equal to the VaR at a given confidence level. Pflug (2000) proved that CVaR is a coherent risk measure having the properties of sub-addictive, convex, monotonic w.r.t. stochastic dominance of order 1, and monotonic w.r.t. monotonic dominance of order 2. Furthermore, it may handle a large amount of instruments and scenarios, since it could be optimized using linear programming and non-smoothing optimization algorithms. A simple description of the approach for minimization of CVaR and its optimization problems could be found in the review paper by Rockafellar and Uryasev (2000).

Since econometric tests of the ARCH and GARCH family models clearly reject the hypothesis of constant volatility and find evidence of volatility clustering over time. In the financial literature, stochastic volatility (SV) models have been proposed to model these effects in a continuous-time setting (Hull & White, 1987; Scott, 1987; Wiggins, 1987). Pricing methods for options on a stock with a stochastic volatility process are widely available, both in the discrete-time and the continuous-time framework (Heston, 1993; Finucane & Tomas, 1996; Ritchken & Trevor, 1999). Schweizer (1991, 1995) has proposed methods to minimize the replication error of contingent claims in general incomplete markets, including stochastic volatility as a special case. Schweizer (1995) only considers trading strategies involving the riskless bond and the underlying stock itself. Since the bond and the underlying stock price are insensitive to changes of the volatility, these hedging schemes are considered to be inefficient compared to strategies involving traded option contracts on the underlying stock (Frey & Sin, 1999).

In particular, SV can be seen as an explanation of many well-known empirical findings, for example, the volatility smile and the volatility clustering implied by option prices. To study more practical financial market, Heston (1993) assumed that the volatility of the risky asset was driven by a Cox-Ingersoll-Ross (CIR) process, while this model has some computational and empirical advantages. Since then, numerous scholars have investigated the optimal portfolio choice for investors under Heston’s SV model. For instance, Liu and Pan (2003), Chacko and Viceira (2005), Kraft* (2005) and Liu (2007) considered the optimal investment problems under Heston’s SV model by adopting the stochastic dynamic programming approach. Viens (2002) and Kim and Viens (2012) focused on portfolio optimization problems under SV models with partially observed information using particle filter theory. Xu, Wu, and Li (2010) considered a robust equilibrium pricing model under Heston’s SV model.

On the other hand, Artificial Intelligence (AI) including Support Vector Machine (SVM), Artificial Neural Networks (ANNs), Genetic Algorithms (GA) and Genetic Programming (GP) et al. are widely used in the financial field (Kaucic, 2010). Among them GP has the advantages of systematic random search and derivative-free optimization, which was firstly introduced by Koza (1992). This method is an extension and substitution of GA, and both of them are typical evolutionary algorithms based on the biological evolution. These methods could perform a randomized global search in the solution space, where a candidate of population is associated with a fitness value correspondingly. By using the genetic operations of selection, crossover and mutation, the best candidate was reserved to the next generation and finally translated into the best solution. Kaboudan (2000) has used GA with the aim of stock price forecasting, and he showed that the price were predictable and proposed a profitable trading strategy. Nunez-Letamendia (2007) has studied the problem of how changes in the design of the GA have an effect on the results obtained in real-life applications. However, more common approaches focus on the use of GA or GP to take advantage of the market trends (Allan & Karjalainen, 1999). Researchers have used GP to discover profitable trading rules in different stock markets. El-Telbany (2005) uses GP to forecast the Egyptian Sock Market returns and achieves more accurate results than neural networks. Kaucic (2009) uses GA to select variables and detects outliers simultaneously in a dynamic linear model, so as to pursue excess returns on the MSCI European stock index. Miles and Smith (2010) apply GP to the trading of 24 stocks on the NYSE, and finds the trading rules evolved by GP, which do not outperform the simple buy-and-hold rule. Furthermore, Neely, Weller, and Dittmar (1997) use GP to find trading rules for the foreign exchange market. Using the daily frequency data for four currency pairs, the authors achieve consistent excess returns, even after considering the transaction costs. Sermpinis, Theofilatos, Karathanasopoulos, Georgopoulos, and Dunis (2013) have introduced a hybrid neural network architecture of Particle Swarm Optimization and Adaptive Radial Basis Function (ARBF-PSO), a time varying leverage trading strategy based on Glosten, Jagannathan and Runkle (GJR) volatility forecasts and a neural network fitness function for financial forecasting purposes.

As a new method in the AI field, rough set approach has been widely applied to the financial market. In the paper by Dimitras, Slowinski, Susmaga, and Zopounidis (1999), the rough set approach is used to provide a set of rules able to discriminate between healthy and failing firms in order to predict business failure. Greco, Matarazzo, and Słowiński (2013) have introduced a new way for the portfolio selection in a non-Markowitz way, involving uncertainty modeling in terms of a series of meaningful quantiles of probabilistic distributions. They propose an interactive multiobjective optimization method based on so-called Dominance-based Rough Set Approach (DRSA). Shyng, Shieh, Tzeng, and Hsieh (2010) propose a novel Forward Search and Backward Trace (FSBT) technique based on Rough Set Theory to improve data analysis and extend the scope of observations made from sample data to solve personal investment portfolio problems. Tay and Shen (2002) demonstrate that rough sets model is applicable to a wide range of practical problems pertaining to economic and financial prediction. The results show that the rough sets model is a promising alternative to the conventional methods for economic and financial prediction. In order to combine the advantages of rough sets theory (RST) and GA, Cheng, Chen, and Wei (2010) proposes a hybrid forecasting model to predict stock price trends. It provides efficient rules for forecasting, which are evolved from the extracted rules with high support value, by using the toolset based on RST.

Though there are many evolutionary algorithms applied to the stock markets, an extended method named Genetic Network Programming (GNP) was proposed by Katagiri, Hirasawa, and Hu (2000). The most distinguished point of GNP is the network structure that is composed of different types of plural nodes, which are connected with each other. GNP has a lot of advantages when comparing with other traditional evolutionary methods, for example, tree based GP generally starts form its root node and evaluates the leaf nodes one after another, however, as the number of nodes increase, the depth of tree grows to maintain the representation ability. The increase of depth would cause the exponential enlargement of the search space and the occupation of memory, which is called the bloating problem. However, GNP has non-hierarchical structure and has no such problem. Nodes of GNP are connected with each other and could be used repeatedly. It has been shown that GNP could outperform GP in a simulation environment of tileworld (Katagiri, Hirasawa, Hu, Murata, & Kosaka, 2002). Recently, GNP has been applied to different areas, such as association rule mining (Shimada, Hirasawa, & Hu, 2006), traffic prediction (Zhou, Mabu, Wei, Shimada, & Hirasawa, 2010), elevator supervisory control (Hirasawa et al., 2008) and stock forecasting (Izumi, Yamaguchi, Mabu, Hirasawa, & Hu, 2006). Mabu, Hirasawa, and Hu (2004) proposed a GNP-RL model by combining the Sarsa Learning algorithm with GNP, which has improved the search speed for solutions, and the GNP-RL model has been applied to generate the stock trading rules. Other extended models are proved to be able to get higher profits than buy-and-hold methods as well as the traditional GNP models in the stock markets (Chen, Mabu, Shimada, & Hirasawa, 2009; Gu, Mabu, Yang, & Hirasawa, 2011). Moreover, Mabu, Lian, Chen, and Hirasawa (2010) introduce a model named GNP-RA, which extracts and stores a large number of buying and selling rules separately, and the trading actions are determined by a special measurement of matching degree. The experimental results show that the rule-based trading model is able to get higher profits than the conventional individual-based GNP model. Furthermore, GNP has been applied to the portfolio optimization problem. Chen provides a decision-making model based on the time adapting GNP, which is able to create effective portfolio optimization strategy with real-time updating data windows (Chen, Mabu, & Hirasawa, 2010).

Generally speaking, statistical models always require lots of strict assumptions, give precise but unstable results, and cannot be optimized automatically. These may limit their functions in the applications when the model assumptions are violated, or when the environment variables are changing dynamically. However, AI methods have the advantages of optimization in the dynamic environments with little assumption, but their accuracy cannot be guaranteed. AI methods also require the professional knowledge to guide when solving specific problems. In order to solve these problems, this paper proposes a hybrid stock trading system based on Genetic Network Programming and Mean Conditional Value-at-Risk model (GNP–CVaR) for creating effective trading rules, which has combined the advantages of statistical models and artificial intelligence. CVaR measures the market risk and distributes the capital to each asset in the portfolio, while GNP decides the buying and selling strategy.

GNP consists of a start node, judgment nodes and processing nodes, and the connections among them constitute the basic structure of GNP. As shown in Fig. 1
                        , the start node is used to label the first node to be executed. Judgment nodes have conditional branches which could make decisions by if-then type functions. Processing nodes have no branches and are used to make decisions of buying and selling stocks. The genotype expression of GNP node is also shown in Fig. 1. Concretely speaking, 
                           
                              
                                 
                                    K
                                 
                                 
                                    i
                                 
                              
                           
                         represents the node type of Node i. 
                           
                              
                                 
                                    K
                                 
                                 
                                    i
                                 
                              
                              =
                              1
                           
                         means it is a start node, 
                           
                              
                                 
                                    K
                                 
                                 
                                    i
                                 
                              
                              =
                              2
                           
                         means it is a judgment node and 
                           
                              
                                 
                                    K
                                 
                                 
                                    i
                                 
                              
                              =
                              3
                           
                         means it is a processing node. 
                           
                              
                                 
                                    ID
                                 
                                 
                                    i
                                 
                              
                           
                         represents the identification number in each node type. 
                           
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                           
                         is the time delay of each node and its branches, 
                           
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              =
                              0
                           
                         is for branches, 
                           
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              =
                              1
                           
                         is for judgment nodes and 
                           
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              =
                              5
                           
                         is for processing nodes. 
                           
                              
                                 
                                    C
                                 
                                 
                                    i
                                 
                                 
                                    A
                                 
                              
                           
                         and 
                           
                              
                                 
                                    C
                                 
                                 
                                    i
                                 
                                 
                                    B
                                 
                              
                           
                         represent the next node A or node B from node i, and they can be only used in the judgment nodes.

The node transition of GNP starts from a start node and continues depending on the node connections and judgment results. Figs. 2 and 3
                        
                         show the node structures of judgment nodes and processing nodes. In the proposed method, it combines GNP with reinforcement learning, where each node has two sub-nodes in them and Q values are defined for sub-nodes, that is, the state is node and the action is to take one of the sub-nodes.
                           
                              (1)
                              Judgment node: When the current node i is a judgment node at time t, one Q value is firstly selected from 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             
                                                
                                                   im
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 , based on ∊-greedy policy. That is, a maximum Q value among 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             i
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             Q
                                          
                                          
                                             
                                                
                                                   im
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                  is selected with the probability of 
                                    
                                       1
                                       -
                                       ∊
                                    
                                 , or a random one is selected with the probability of ∊, where 
                                    
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                       
                                    
                                  is the number of sub-nodes of node i. Then, the corresponding function 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             ip
                                          
                                       
                                    
                                  is selected. When GNP executes the function 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             ip
                                          
                                       
                                    
                                 , it can get the reward 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             t
                                          
                                       
                                    
                                  and suppose the next node j becomes 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             ip
                                          
                                          
                                             A
                                          
                                       
                                    
                                 . In fact, a reinforcement learning algorithm called Sarsa learning is applied here to update the Q value, which estimates the sum of the discounted rewards obtained in the future. Since at time 
                                    
                                       t
                                       +
                                       1
                                    
                                 , GNP selects another Q value based on ∊-greedy policy, suppose that 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             
                                                
                                                   jp
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                  is selected, the Q value is updated as follows.
                                    
                                       (1)
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                ip
                                             
                                          
                                          ←
                                          
                                             
                                                Q
                                             
                                             
                                                ip
                                             
                                          
                                          +
                                          α
                                          [
                                          
                                             
                                                r
                                             
                                             
                                                t
                                             
                                          
                                          +
                                          γ
                                          
                                             
                                                Q
                                             
                                             
                                                
                                                   
                                                      jp
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                Q
                                             
                                             
                                                ip
                                             
                                          
                                          ]
                                       
                                    
                                 where α is a step size parameter, γ is a discount rate which determines the present value of future rewards: a reward received k times steps later is worth only 
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             k
                                             -
                                             1
                                          
                                       
                                    
                                  times of the reward supposed to receive at the current step.

The gene of 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             ip
                                          
                                       
                                    
                                  shows a technical index or a candlestick chart that GNP judges at sub-node ip of node i. Technical indices used in the judgment nodes include: Rate of Deviation from moving average (ROD), Relative Strength Index (RSI), Rate of Change (ROC), Volume Ratio (VR), Rank Correlation Index (RCI), Stochastics, Golden/Dead cross and Moving Average Convergence and Divergence (MACD). A brief introduction of candlestick chart and these indications can be found in Chen et al. (2009).

Since each technical index has its own range, e.g., ROC index generally changes from −6.5 to 6.5, whereas RSI could fluctuate between 0 and 100, Importance Index (IMX) is taken to standardize the different range of technical indexes, as shown in Figs. 4 and 5
                                 
                                 . Each technical index has its own IMX function, i.e., x axis shows the value of each technical index, and the sections of 
                                    
                                       A
                                       ,
                                       B
                                       ,
                                       C
                                       ,
                                       …
                                    
                                  correspond to the judgment results. Suppose 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             ip
                                          
                                       
                                    
                                  and the corresponding 
                                    
                                       
                                          
                                             ID
                                          
                                          
                                             ip
                                          
                                       
                                       =
                                       1
                                    
                                  (judgment node of RSI) are selected, and if the rate is equal to 50, which is just the middle level of the RSI index, the judgment result becomes B and the next node number becomes 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             ip
                                          
                                          
                                             B
                                          
                                       
                                    
                                 . y axis shows the output of the IMX function and it is used at a processing node. The IMX function could be defined as follows,
                                    
                                       (2)
                                       
                                          IMX
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            -
                                                            Q
                                                            1
                                                            )
                                                            /
                                                            (
                                                            Q
                                                            1
                                                            -
                                                            
                                                               min
                                                            
                                                            (
                                                            x
                                                            )
                                                            )
                                                            ,
                                                         
                                                         
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            <
                                                            Q
                                                            1
                                                            ;
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                            ,
                                                         
                                                         
                                                            Q
                                                            1
                                                            ⩽
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ⩽
                                                            Q
                                                            3
                                                            ;
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            -
                                                            Q
                                                            3
                                                            )
                                                            /
                                                            (
                                                            
                                                               max
                                                            
                                                            (
                                                            x
                                                            )
                                                            -
                                                            Q
                                                            3
                                                            )
                                                            ,
                                                         
                                                         
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            >
                                                            Q
                                                            3
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where x is the technical index selected by a judgment node, and 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                    
                                  is one of its observations. 
                                    
                                       Q
                                       1
                                    
                                  and 
                                    
                                       Q
                                       3
                                    
                                  are the first and third quartiles of x, respectively. After transforming to the IMX, all indexes are standardized between −1 and 1.

However, the IMX output of golden cross, dead cross and MACD could be 1, 0 or −1 based on the cross of the lines, and these values correspond to judgment results of 
                                    
                                       A
                                       ,
                                       B
                                       ,
                                       C
                                    
                                 , respectively. Concretely speaking, for three days after a golden cross appears, the IMX output becomes 1, and for three days after a dead cross appears, it becomes −1, otherwise 0. Furthermore, for three days after MACD passes through the signal from the lower side to the upper side, the IMX output becomes 1, and for three days after it does from the upper side to the lower side, the IMX output becomes −1, otherwise it becomes 0. Generally, golden cross indicates buying signals and dead cross indicates selling signals, therefore, buying signals become stronger when the IMX output is close to 1, and selling signals become stronger when it is close to −1.

In this paper, candlestick chart is used as one of the judgment functions. As we know, candlestick chart has been winning international recognition for its good indication of stock prices, and it has been widely used as the means of indicating the fluctuations of the stocks. The proposed model has judgment nodes which check the candlestick chart patterns. The judgment function of candlestick chart is executed as follows. When the selected sub-node has a judgment function of candlestick chart, GNP judges yesterday’s candlestick and the candlestick of the day before yesterday. There are eight patterns of candlestick charts as shown in Fig. 6
                                  according to two kinds of rules: (A) Judge whether there is a gap or not between yesterday’s lowest price and the highest price of the day before yesterday, or between yesterday’s highest price and the lowest price of the day before yesterday. (B) Judge whether or not yesterday’s closing price is higher than the opening price of the day before yesterday. Especially, when the opening price equals to the closing price, the case is treated as black body candlestick. As an example, when the candlestick pattern is 2, GNP selects the second branch to transfer to the next node. However, judgment nodes of candlestick chart do not have IMX function.

Processing node: When the current node is a processing node, the following steps will be carried out:
                                    
                                       (i) Firstly, 
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ip
                                                   
                                                
                                             
                                          , the corresponding 
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      ip
                                                   
                                                
                                             
                                           and 
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      ip
                                                   
                                                
                                             
                                           are selected based on the ∊-greedy policy. The selected 
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      ip
                                                   
                                                
                                             
                                           is a threshold for determining the timing of buying and selling stocks.

(ii) Calculate the average value of the IMXs obtained at the judgment nodes in the node transition from the previous processing node to the current processing node.
                                             
                                                (3)
                                                
                                                   
                                                      
                                                         A
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         |
                                                         
                                                            
                                                               I
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         |
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            
                                                               
                                                                  i
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            ∈
                                                            
                                                               
                                                                  I
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   IMX
                                                   (
                                                   
                                                      
                                                         i
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   .
                                                
                                             
                                          where 
                                             
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                           shows a set of suffixes of the judgment nodes executed in the node transition from the previous processing node to the current processing node. IMX(i′) shows the IMX output at node 
                                             
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ∈
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          . However, when the judgment node of the candlestick chart was executed or the IMX output is zero at judgment nodes of golden cross, dead cross and MACD, the node is excluded from 
                                             
                                                
                                                   
                                                      I
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                           for calculating 
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          .

(iii) Determine the timing of buying and selling actions:

In the case of buying (
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      ip
                                                   
                                                
                                                =
                                                0
                                             
                                          ): if 
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      t
                                                   
                                                
                                                ⩾
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      ip
                                                   
                                                
                                             
                                           and we do not have any stocks, GNP buys as much stocks as possible. Otherwise, GNP takes no action.

In the case of selling (
                                             
                                                
                                                   
                                                      ID
                                                   
                                                   
                                                      ip
                                                   
                                                
                                                =
                                                1
                                             
                                          ): if 
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      t
                                                   
                                                
                                                <
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      ip
                                                   
                                                
                                             
                                           and we have stocks, GNP sells all the stocks. Otherwise, GNP takes no action.

(iv) The current node is transferred to the next node. If sub-node ip is selected, the next node number becomes 
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      ip
                                                   
                                                
                                             
                                          .

Genetic operations: The genetic operations of GNP include crossover, mutation and selection from individuals in each generation. The fitness value in the proposed model is the profits earned in the training period, and the procedure is explained as follows:
                                    
                                       (i) Crossover

Crossover is performed between two parents who are selected by tournament selection, and each node of them is selected as a crossover node with the probability of 
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      c
                                                   
                                                
                                             
                                          . Two parents exchange the genes of the corresponding crossover nodes and generate two new individuals or offsprings.

(ii) Mutation

Mutation is executed in only one individual who is also selected by tournament selection. Three kinds of changes may occur with a certain probability of 
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      m
                                                   
                                                
                                             
                                           including connection mutation, parameter mutation and function mutation. New individuals of the next generation will be created by one of these changes.

(iii) Elite selection

At the end of each generation, an elite individual with the highest fitness value will be preserved to the next generation, while the rest individuals will be discarded and replaced by the new ones generated by crossover and mutations.

Let vector 
                           
                              x
                           
                         be a portfolio chosen from a set of available portfolios 
                           
                              X
                           
                         of 
                           
                              
                                 
                                    R
                                 
                                 
                                    n
                                 
                              
                           
                        , in other words, be the weights of each assets in the portfolio. The random vector 
                           
                              y
                           
                         in 
                           
                              
                                 
                                    R
                                 
                                 
                                    m
                                 
                              
                           
                         with underlying probability distribution is assumed for convenience to have density 
                           
                              p
                              (
                              y
                              )
                           
                        . We use bold face for the vectors to distinguish them from scalars. Let 
                           
                              f
                              (
                              x
                              ,
                              y
                              )
                           
                         be the loss function associated with 
                           
                              x
                           
                         and 
                           
                              y
                           
                        . The probability of 
                           
                              f
                              (
                              x
                              ,
                              y
                              )
                           
                         not exceeding threshold α is then given by
                           
                              (4)
                              
                                 Ψ
                                 (
                                 x
                                 ,
                                 α
                                 )
                                 =
                                 
                                    ∫
                                    
                                       f
                                       (
                                       x
                                       ,
                                       y
                                       )
                                       ⩽
                                       α
                                       (
                                       x
                                       ,
                                       β
                                       )
                                    
                                 
                                 p
                                 (
                                 y
                                 )
                                 d
                                 y
                                 .
                              
                           
                        The VaR function 
                           
                              α
                              (
                              x
                              ,
                              β
                              )
                           
                         is defined as follows
                           
                              (5)
                              
                                 α
                                 (
                                 x
                                 ,
                                 β
                                 )
                                 =
                                 
                                    min
                                 
                                 {
                                 α
                                 ∈
                                 R
                                 :
                                 Ψ
                                 (
                                 x
                                 ,
                                 α
                                 )
                                 ⩾
                                 β
                                 }
                                 .
                              
                           
                        VaR is a popular measure of financial risk which has achieved the high status of being written into the industry regulations (Jorion, 2007). The VaR at level α for a sample of returns is defined as the corresponding empirical quantile at β. That is, with the probability 
                           
                              1
                              -
                              α
                           
                        , the returns will be larger than the VaR, or the losses will be smaller than the dollar amount given by the VaR. Let us consider the 
                           
                              
                                 
                                    CVaR
                                 
                                 
                                    β
                                 
                              
                              (
                              x
                              )
                           
                         as a performance function 
                           
                              ϕ
                              (
                              x
                              )
                           
                        , which is the conditional expected value of the loss 
                           
                              f
                              (
                              x
                              ,
                              y
                              )
                           
                         under the condition that it exceeds the quantile 
                           
                              α
                              (
                              x
                              ,
                              β
                              )
                           
                        ,
                           
                              (6)
                              
                                 ϕ
                                 (
                                 x
                                 )
                                 =
                                 
                                    
                                       (
                                       1
                                       -
                                       β
                                       )
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 
                                    ∫
                                    
                                       f
                                       (
                                       x
                                       ,
                                       y
                                       )
                                       ⩾
                                       α
                                    
                                 
                                 f
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 p
                                 (
                                 y
                                 )
                                 d
                                 y
                                 .
                              
                           
                        It was shown by Rockafellar and Uryasev (2000) that the minimization of the excess loss function 
                           
                              ϕ
                              (
                              x
                              )
                           
                         can be reduced to the minimization of the function
                           
                              (7)
                              
                                 
                                    
                                       F
                                    
                                    
                                       β
                                    
                                 
                                 (
                                 x
                                 ,
                                 α
                                 )
                                 =
                                 α
                                 +
                                 
                                    
                                       (
                                       1
                                       -
                                       β
                                       )
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 
                                    ∫
                                    
                                       y
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             m
                                          
                                       
                                    
                                 
                                 
                                    
                                       (
                                       f
                                       (
                                       x
                                       ,
                                       y
                                       )
                                       -
                                       α
                                       )
                                    
                                    
                                       +
                                    
                                 
                                 p
                                 (
                                 y
                                 )
                                 d
                                 y
                                 .
                              
                           
                        On the set 
                           
                              X
                              ×
                              R
                              ,
                              
                                 
                                    b
                                 
                                 
                                    +
                                 
                              
                           
                         is the positive part of the number b, i.e., 
                           
                              
                                 
                                    b
                                 
                                 
                                    +
                                 
                              
                              =
                              max
                              {
                              0
                              ,
                              b
                              }
                           
                        . By minimizing the function 
                           
                              
                                 
                                    F
                                 
                                 
                                    β
                                 
                              
                              (
                              x
                              ,
                              α
                              )
                              ,
                              
                                 
                                    VaR
                                 
                                 
                                    β
                                 
                              
                              (
                              x
                              )
                           
                         and 
                           
                              
                                 
                                    CVaR
                                 
                                 
                                    β
                                 
                              
                              (
                              x
                              )
                           
                         could be found simultaneously, that is,
                           
                              (8)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   VaR
                                                
                                                
                                                   β
                                                
                                             
                                             (
                                             x
                                             )
                                             =
                                             
                                                
                                                   α
                                                
                                                
                                                   β
                                                
                                             
                                             (
                                             x
                                             )
                                             ∈
                                             
                                                
                                                   
                                                      arg
                                                      min
                                                   
                                                   
                                                      α
                                                      ∈
                                                      R
                                                   
                                                
                                             
                                             
                                                
                                                   F
                                                
                                                
                                                   β
                                                
                                             
                                             (
                                             x
                                             ,
                                             α
                                             )
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   CVaR
                                                
                                                
                                                   β
                                                
                                             
                                             (
                                             x
                                             )
                                             =
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   β
                                                
                                             
                                             (
                                             x
                                             )
                                             =
                                             
                                                
                                                   F
                                                
                                                
                                                   β
                                                
                                             
                                             (
                                             x
                                             ,
                                             
                                                
                                                   α
                                                
                                                
                                                   β
                                                
                                             
                                             (
                                             x
                                             )
                                             )
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Generally speaking, two kinds of portfolios could be constructed by Markowitz’s mean–variance model: global minimum variance (GMV) portfolio and maximum Sharpe Ratio (MSPR) portfolio. The former just represents the minimum risk point on the efficient frontier and the latter maximizes the Sharpe ratio (Sharpe, 1994), defined as the excess return per unit of standard deviation:
                           
                              (9)
                              
                                 
                                    
                                       S
                                    
                                    
                                       p
                                    
                                 
                                 (
                                 x
                                 )
                                 =
                                 
                                    
                                       E
                                       (
                                       r
                                       -
                                       
                                          
                                             r
                                          
                                          
                                             f
                                          
                                       
                                       )
                                    
                                    
                                       σ
                                       (
                                       x
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             T
                                          
                                       
                                       x
                                       -
                                       
                                          
                                             r
                                          
                                          
                                             f
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   Σ
                                                
                                                
                                                   ˆ
                                                
                                             
                                             x
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        where r and 
                           
                              
                                 
                                    r
                                 
                                 
                                    f
                                 
                              
                           
                         are the returns of the portfolio 
                           
                              x
                           
                         and risk free asset, 
                           
                              σ
                              (
                              x
                              )
                           
                         is the standard deviation of the portfolio 
                           
                              x
                           
                        , the vector 
                           
                              
                                 
                                    μ
                                 
                                 
                                    ˆ
                                 
                              
                           
                         and matrix 
                           
                              
                                 
                                    Σ
                                 
                                 
                                    ˆ
                                 
                              
                           
                         are estimations of the mean and covariance of the assets, respectively. The vector 
                           
                              x
                           
                         denotes the weights of each stock indices. The expected or target return 
                           
                              
                                 
                                    r
                                 
                                 
                                    ¯
                                 
                              
                           
                         is expressed by the condition 
                           
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    T
                                 
                              
                              x
                              =
                              
                                 
                                    r
                                 
                                 
                                    ¯
                                 
                              
                           
                        . Therefore, the GMV portfolio could be expressed mathematically as:
                           
                              (10)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   x
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   Σ
                                                
                                                
                                                   ˆ
                                                
                                             
                                             x
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             s.t.
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   μ
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             1
                                             =
                                             1
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ⩾
                                             0.05
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              1
                              =
                              
                                 
                                    (
                                    1
                                    ,
                                    1
                                    ,
                                    …
                                    ,
                                    1
                                    )
                                 
                                 
                                    T
                                 
                              
                           
                        , and the set of optimal weight 
                           
                              
                                 
                                    x
                                 
                                 
                                    ∗
                                 
                              
                           
                         could be solved as:
                           
                              (11)
                              
                                 
                                    
                                       x
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             Σ
                                          
                                          
                                             -
                                             1
                                          
                                       
                                       1
                                    
                                    
                                       
                                          
                                             1
                                          
                                          
                                             T
                                          
                                       
                                       
                                          
                                             Σ
                                          
                                          
                                             -
                                             1
                                          
                                       
                                       1
                                    
                                 
                                 .
                              
                           
                        while the MSPR portfolio could be defined as:
                           
                              (12)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   max
                                                
                                                
                                                   x
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   S
                                                
                                                
                                                   p
                                                
                                             
                                             (
                                             x
                                             )
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               μ
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   x
                                                   -
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         f
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         Σ
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                   x
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             s.t.
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   μ
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             1
                                             =
                                             1
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ⩾
                                             0.05
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        It can be shown that, if 
                           
                              
                                 
                                    Σ
                                 
                                 
                                    ˆ
                                 
                              
                           
                         is a positive definite matrix, the MSPR portfolio problem is a convex optimization problem, and could be solved by ”quadratic programming solver” provided by R software (Würtz, Chalabi, Chen, & Ellis, 2009).

Based on the mean-CVaR model, there are also two kinds of portfolios that could be constructed correspondingly: the global minimum CVaR (GMC) portfolio and the maximum Sortino Ratio (MSOR) portfolio. The former minimizes the CVaR given the level of returns and the latter maximizes the Sortino Ratio which is defined as:
                           
                              (13)
                              
                                 
                                    
                                       S
                                    
                                    
                                       r
                                    
                                 
                                 (
                                 x
                                 )
                                 =
                                 
                                    
                                       E
                                       (
                                       r
                                       -
                                       
                                          
                                             r
                                          
                                          
                                             f
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             CVaR
                                          
                                          
                                             β
                                          
                                       
                                       (
                                       x
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             T
                                          
                                       
                                       x
                                       -
                                       
                                          
                                             r
                                          
                                          
                                             f
                                          
                                       
                                    
                                    
                                       
                                          
                                             CVaR
                                          
                                          
                                             β
                                          
                                       
                                       (
                                       x
                                       )
                                    
                                 
                                 .
                              
                           
                        The GMC portfolio could be expressed mathematically as:
                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   x
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   CVaR
                                                
                                                
                                                   β
                                                
                                             
                                             (
                                             x
                                             )
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             s.t.
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   μ
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             1
                                             =
                                             1
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ⩾
                                             0.05
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        and the MSOR portfolio could be defined as:
                           
                              (15)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   max
                                                
                                                
                                                   x
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   S
                                                
                                                
                                                   r
                                                
                                             
                                             (
                                             x
                                             )
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               μ
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   x
                                                   -
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         f
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         CVaR
                                                      
                                                      
                                                         β
                                                      
                                                   
                                                   (
                                                   x
                                                   )
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             s.t.
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   μ
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             
                                                
                                                   r
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   T
                                                
                                             
                                             1
                                             =
                                             1
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ⩾
                                             0.05
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        It is an instance of the convex programming problem of Eq. (7) (Andersson, Mausser, Rosen, & Uryasev, 2001). Under general conditions, the function 
                           
                              
                                 
                                    F
                                 
                                 
                                    β
                                 
                              
                              (
                              x
                              ,
                              α
                              )
                           
                         is smooth (discussions of conditions of smooth can be found in Uryasev (1995)) and convex in α, while 
                           
                              
                                 
                                    F
                                 
                                 
                                    β
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         is also convex in 
                           
                              x
                           
                        . If the function 
                           
                              f
                              (
                              x
                              ,
                              y
                              )
                           
                         is convex in 
                           
                              x
                              ,
                              
                                 
                                    CVaR
                                 
                                 
                                    β
                                 
                              
                           
                         can be optimized via optimization of the function 
                           
                              
                                 
                                    F
                                 
                                 
                                    β
                                 
                              
                              (
                              x
                              ,
                              α
                              )
                           
                         by the nonlinear programming techniques. In this paper, we solve Eq. (7) using the “linear programming solver” (Rglp) and “linear and mixed integer programming solver” (Rglpk) provided by R software.


                        Fig. 7
                         shows the flowchart of GNP–CVaR. At first, portfolios are constructed by mean–variance model or mean-CVaR model introduced in Section 3.2, which can determine the initial investment provided for each asset. After that, the portfolio is further optimized and the stock trading actions are determined by GNP. For the first population, individuals are generated by assigning a set of assets in the portfolio, and then individuals are evolved for several generations using the training data. In this process, the genetic operations including crossover, mutation and selection will be executed to generate new population for the next generation. Finally, the evolution will be terminated in the last generation, and the best individual in the last generation will be selected and used for stock trading in testing period.

In the empirical application, we consider data for a collection of 5 stock market indices: the U.S. NASDAQ stock index (USA), the China Shanghai composite index (CHINA), the Hongkong Hang Seng index (HK), the German DAX stock index (EU) and the Japanese NIKKEI 225 stock index (JAPAN). This study covers the time period from January 7, 2005 to December 31, 2011, which is divided into four periods, and the source of opening price data is from yahoo (finance.yahoo.com).
                           
                              •
                              Period 1: Training: January 4, 2005 to December 28, 2007;
                                    
                                       Testing: January 4, 2008 to December 30, 2008.

Period 2: Training: January 4, 2006 to December 30, 2008;
                                    
                                       Testing: January 5, 2009 to December 30, 2009.

Period 3: Training: January 4, 2007 to December 31, 2009;
                                    
                                       Testing: January 4, 2010 to December 30, 2010.

Period 4: Training: January 4, 2008 to December 31, 2010;
                                    
                                       Testing: January 4, 2011 to December 30, 2011.

We suppose that the initial funds is 10,000,000 US dollar in each period, and we can buy and sell stocks with the opening price. For all the price series 
                           
                              
                                 
                                    p
                                 
                                 
                                    t
                                 
                              
                           
                        , weekly returns are defines as 
                           
                              
                                 
                                    r
                                 
                                 
                                    t
                                 
                              
                              =
                              
                                 
                                    p
                                 
                                 
                                    t
                                 
                              
                              /
                              
                                 
                                    p
                                 
                                 
                                    t
                                    -
                                    1
                                 
                              
                              -
                              1
                           
                        . In Table 1
                        , the descriptive statistics of each stock index are summarized. They share almost the same week means but the accumulated returns of them varies from −0.106 to 0.798, and the other statistics such as variance, skewness and kurtosis also indicate the different characteristics.

The mean–variance models and mean-CVaR models introduced in subSection 3.2 are tested based on these five data sets. We have constrained the portfolio optimization to a long-only portfolio with minimum weights of 5% in each stock index to avoid the creation of overly concentrated position. In this research, the balanced equal-weight portfolio (EW), which is the default setting of original GNP that fixes the weight of each index equally to 20%, is compared with other 4 portfolios including GMV, MSPR, GMC and MSOR. The confidence level of CVaR is set to β
                        =5%, and the weights of the five portfolios could be obtained by linear programming algorithms (Würtz et al., 2009). Results in the first period are shown in Table 2
                        .

Actually, the interest rate of 12months on LIBOR, SHIBO and HIBOR markets is used to set the risk free rate, which is equal to 1.80%. Since the price data of stock index futures used in this paper are daily prices, we use the daily rate as 
                           
                              
                                 
                                    r
                                 
                                 
                                    f
                                 
                              
                              =
                              1.80
                              %
                              /
                              360
                              =
                              0.005
                              %
                           
                        , and it is constant in the sample period for ease of calculation. According to the historical data of annual interest rate in different markets, Japan is 0.483–1.127%, USA is 0.720–4.823%, EURO is 1.225–5.514%, China (mainland) is 1.850–5.256%, and Hongkong is 0.50–6.75%. In the sample period from 2005 to 2011, the value of 1.80% per year could represent the average level of the 5 markets. Especially in the recent years, with the implementation of the Quantitative Easing Monetary Policy, the risk free rate remains below 2% over a long period of time in most countries.

The portfolio weights in the first 5 rows of Table 2 will be used as the initial budget of portfolio in GNP, and the values of mean, variance and CVaR of each asset are calculated and shown in the last 3 rows of the table. It is found from Table 1 that the Hongkong Hang Seng index, with the minimum median of 0.003 and the second highest standard deviation of 0.033, has the highest covariance risk budgets in EW portfolio and it is penalized in the other four portfolios with a minimum weight of 0.05. The China Shanghai composite index, with the highest median of 0.008 and highest standard deviation of 0.037, takes a large proportion in MSPR and MSOR portfolios, but it decreased in GMV and GMC portfolios. However, the U.S. NASDAQ stock index, with an average median of 0.004, minimum standard deviation of 0.026 and fat-tailed kurtosis of 15.126, is a good component to construct GMV and GMC portfolios, but a bad one to construct MSPR and MSOR portfolios with the minimum weight. The expected return is in proportion to the expected risk, no matter measured by variance or CVaR.


                        Table 3
                         shows the parameters of GNP. The number of judgment nodes is 22, and 8 processing functions are used to judge 8 basic types of candlestick charts. There are two kinds of processing functions for buying and selling actions, and the total number of processing nodes is 16. Additionally, 5 start nodes are assigned to 5 stock indices one by one. The initial connections between nodes are determined randomly in the first generation. In each generation, 179 new individuals are generated by mutation, 120 new individuals are generated by crossover, and one best individual is preserved in the last generation. Generation number is set at 300 in order to get a steady result.

The fitness function of GNP in the 
                           
                              n
                           
                        th generation is defined as follows:
                           
                              (16)
                              
                                 
                                    
                                       
                                       
                                          
                                             Fitness
                                             (
                                             n
                                             )
                                             =
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      5
                                                   
                                                
                                             
                                             Profit
                                             (
                                             i
                                             ,
                                             n
                                             )
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             Profit
                                             (
                                             i
                                             ,
                                             n
                                             )
                                             =
                                             selling
                                             
                                             price
                                             (
                                             i
                                             ,
                                             n
                                             )
                                             -
                                             buying
                                             
                                             price
                                             (
                                             i
                                             ,
                                             n
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              Profit
                              (
                              i
                              ,
                              n
                              )
                           
                         shows a capital gain or loss in one trading strategy of buying and selling actions on the 
                           
                              i
                           
                        th stock index in the 
                           
                              n
                           
                        th generation, and each portfolio is simulated for 30 times both in training and testing periods. Therefore, the results are the average values over 30 independent simulations. The 
                           
                              Profitability
                              (
                              i
                              ,
                              n
                              )
                           
                         is used as a measurement of efficiency.
                           
                              (17)
                              
                                 
                                    
                                       
                                       
                                          
                                             Initial
                                             
                                             Fund
                                             (
                                             i
                                             ,
                                             n
                                             )
                                             =
                                             Initial
                                             
                                             Investment
                                             ∗
                                             w
                                             (
                                             i
                                             )
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             Profitability
                                             (
                                             i
                                             ,
                                             n
                                             )
                                             =
                                             Profit
                                             (
                                             i
                                             ,
                                             n
                                             )
                                             /
                                             Initial
                                             
                                             Fund
                                             (
                                             i
                                             ,
                                             n
                                             )
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             Profitability
                                             (
                                             n
                                             )
                                             =
                                             Fitness
                                             (
                                             n
                                             )
                                             /
                                             Initial
                                             
                                             Investment
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              w
                              (
                              i
                              )
                           
                         is the weight of the 
                           
                              i
                           
                        th stock index for the initial fund, 
                           
                              Profitability
                              (
                              i
                              ,
                              n
                              )
                           
                         and 
                           
                              Profitability
                              (
                              n
                              )
                           
                         are the profitability of the 
                           
                              i
                           
                        th stock index in the 
                           
                              n
                           
                        th generation and the total profitability in the 
                           
                              n
                           
                        th generation. Fig. 8
                         shows the fitness curve of the best individual in each generation in the training period of one simulation.

Simulation results of period 1 are shown in Table 4
                        , as well as in the box-plot of Fig. 9
                        . Box-plot is a convenient tool for graphically depicting groups of numerical data through their quartiles.

In the training period, buy&hold method could be regarded as benchmark and its profitability reaches 1.12. All of the five portfolios get a larger mean value than buy&hold method, and these huge differences indicate the efficiency of GNP. Furthermore, GMV and GMC get higher profitability than that of EW, while MSPR and MSOR get the highest profitability, and the differences among these three groups are obvious and significant (
                           
                              F
                              =
                              16.81
                              ,
                              p
                              <
                              0.001
                           
                        ). In the testing period, the profitability of buy&hold method reaches −0.48 and it indicates a bear market environment. Although the MSPR and MSOR portfolios get a nearly −53% and −49% loses, respectively, the GMV and GMC portfolios outperform EW and buy&hold method.

As we can see from Table 4, the results of EW, GMV and GMC are closer to that of MSPR and MSOR, because all of them aim to minimize the global risk. Concretely speaking, EW controls the risk by a naive diversification strategy, i.e., it sets equally balanced weights to each stock index, whereas GMV and GMC are made by calculating the minimum risk of portfolios that could be available, consequently, the expected return is not large. However, MSPR and MSOR belong to a kind of “tangency” portfolios, and they aim to get the maximum reward-to-volatility ratio, i.e., to get a better trade-off between the return and risk. Therefore, they share more expected return as well as more expected risk. In the bull market with a market return of 112% in the first training period, MSPR and MSOR have a big chance to get higher profit compared with the buy&hold result. Whereas in the bear market, just like in the first testing period, it has a market return of −48%, which means MSPR and MSOR have to undertake much more risk. Results from the other 3 periods get similar conclusions. Generally speaking, the efficiency of the mean–variance model is equivalent to that of mean-CVaR model, and one reason for this may be that the stock index is a weighted average price of many stocks, and the portfolios constructed by which are blessed with elliptical distributions, working with CVaR or minimum variance (Rockafellar & Uryasev, 2000).

Except for the portfolio we have proposed, more scenarios could be chosen: The efficient frontier of mean–variance and mean-CVaR model is shown in Figs. 10 and 11
                        
                        , which is a set of black points on the top half of the curve. Regardless of the risk-free rate, the efficient frontier is a set of points that has the best possible expected level of return given its level of risk, and it is a useful tool to adjust a trade-off between the expected return and CVaR (or standard deviation).

However, when the possibility of buying Government Bonds (i.e. risk free asset) is considered, as in this paper we set the daily risk-free rate 
                           
                              
                                 
                                    r
                                 
                                 
                                    f
                                 
                              
                           
                         as 0.005%, the efficient frontier is no more the set of black points, but the Capital Market Line (CML), which is shown as the straight line in Figs. 10 and 11. CML is a useful tool for investors to measure the trade-off between risk-free and risky assets, and its slope is known as the “reward-to-variability ratio”, since the expected return increases continually with the increase of risk. Moreover, five stock indices are separated in different locations in Fig. 10, i.e., EW portfolio is so close to the GMV portfolio, and the MSPR is at the point of tangency of the curve and CML. Similar relationship among EW, GMC and MSOR could be found in Fig. 11.


                        Fig. 12
                         depicts the change of weights in different portfolio. The upper and bottom of the Figure are the target CVaR and target return of portfolios, respectively. The areas between them are filled with 5 colors, which represent the change of weights of five stock indices. In the left side, DAX stock index (EU) accounts for a relative high proportion, meanwhile, both the target CVaR and return of portfolio achieve the minimum. The weights change gradually from left to right, and finally, DAX stock index (EU) only takes up a small proportion while China Shanghai composite index (China) takes the majority. Moreover, the highest CVaR and return indicate an extremely radical portfolio.

@&#CONCLUSIONS@&#

This paper has proposed a new approach to improve the efficiency of traditional GNP, while portfolio optimization models are used to measure the risk and distribute the weights of capital to different stock indices within each portfolio. Compared with conventional GNP, the new method has a clear definition of risk and is able to construct different portfolios according to the market environment and traders’ preference to risk. We carry out the simulations by using stock indices from different countries or regions. Experimental results show that portfolios aimed to maximize the reward-to-volatility ratio can get more profit in the bull market, and they outperform the buy&hold method as well as other portfolios. However, in the bear market where more risk emerges, portfolios that aimed to minimize the global risk get better performance. In total, the differences between mean–variance model and mean-CVaR model are not significant in our research. The efficient frontier of mean-CVaR model is depicted and the weights distribution is changing with the increasing of expected return or CVaR.

There remain some further studies in the future. This includes, but not restricted to:
                        
                           •
                           First, one-step-forward forecasting CVaR could be used in the dynamic GNP.

Second, more technical indices, financial situations and macroeconomic variables that might effect the stock price could be deeply explored.

Third, the combination of GNP with time series methods might create a new method to predict the direction or fluctuate range of the stock price more accurately.

The last but not the least, the algorithm and structure of GNP could be further improved to evolve better individuals.

@&#ACKNOWLEDGEMENTS@&#

This research is supported by National Natural Science Foundation of China (Grant Nos. 71101083, 71271128 and 71331006); Innovation Program of Shanghai Municipal Education Commission (Grant No. 12ZZ072); Program for Changjiang Scholars and Innovative Research Team in SUFE (Grant No. IRT13077); Program for Innovative Research Team of Shanghai University of Finance and Economics.

@&#REFERENCES@&#

