@&#MAIN-TITLE@&#Formulations for a problem of petroleum transportation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We study tactical models for a crude oil transportation problem by tankers.


                        
                        
                           
                           We did our work on the top of a previous paper found in the literature.


                        
                        
                           
                           We use 50 instances from the literature and propose 25 new harder ones.


                        
                        
                           
                           We propose a column generation-based heuristic.


                        
                        
                           
                           We improve the literature results.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Mixed Integer Programming

Transportation problem

Column generation-based heuristic

@&#ABSTRACT@&#


               
               
                  Oil tankers play a fundamental role in every offshore petroleum supply chain and due to its high price, it is essential to optimize its use. Since this optimization requires handling detailed operational aspects, complete optimization models are typically intractable. Thus, a usual approach is to solve a tactical level model prior to optimize the operational details. In this case, it is desirable that tactical models are as precise as possible to avoid too severe adjustments in the next optimization level. In this paper, we study tactical models for a crude oil transportation problem by tankers. We did our work on the top of a previous paper found in the literature. The previous model considers inventory capacities and discrete lot sizes to be transported, aiming to meet given demands over a finite time horizon. We compare several formulations for this model using 50 instances from the literature and proposing 25 new harder ones. A column generation-based heuristic is also proposed to find good feasible solutions with less computational burden than the heuristics of the commercial solver used.
               
            

@&#INTRODUCTION@&#

Oil tankers play a fundamental role in every offshore petroleum supply chain. Its optimization is usually divided in three levels: strategic, tactical and operational. Strategic decisions deal with fleet sizing, facility location and capacity sizing. Tactical decisions deal with production and distribution planning, transportation mode selection, storage allocation and order picking strategies. Finally, operational decisions deal with shipment and vehicle dispatching (Ghiani, Laporte, & Musmanno, 2004). When dealing with a planning level, all decisions made in the previous levels are assumed to be known. Since each level considers more details than the previous ones, past decisions usually have to be adjusted. Hence, it is important to make both the strategic and tactical models as detailed as possible to guarantee low adjustments in the operational level.

In this paper, we study a tactical optimization model for crude oil distribution by tankers. The problem consists of scheduling the shipments through routes linking platforms (offshore production sites) and terminals (onshore consumer sites). The objective is to ship the products from the platforms to supply the terminals with minimum transportation cost for a finite planning horizon. For each site, the inventory levels must lie between a lower and an upper bound to avoid the lack or excess of product. Also, for each site, the demand or the production is given for the whole planning horizon. The products are shipped only by oil tankers and we assume that the global capacity of the fleet is unlimited. For each transportation, one has to decide the route, the lot size and the delivery day. This problem has already been addressed in Rocha (2010) and Rocha, Grossmann, and Poggi de Aragão (2011).

This paper has two aims. The first aim is to compare mathematical formulations for the transportation problem proposed in Rocha et al. (2011). Firstly, a basic formulation is given, where the inventory level for each day in each site is represented by a continuous variable and the shipments are represented by binary variables. This formulation is similar to many others found in the literature. We refer to Sawik (2011) for an overview of such papers. We also test several variations of the formulation proposed in Rocha et al. (2011), referred to as Knapsack Cascading. Lastly, we devise a new formulation that outperforms all previous ones when given to a Mixed Integer Programming (MIP) solver.

The second aim of this paper is to propose a column generation-based heuristic approach. We note that, for difficult instances, the commercial solver used is not capable of finding good feasible solutions at the beginning of the branch-and-bound algorithm tree. Finding a good feasible solution at the very beginning of the tree is crucial to reduce the search by cutting off nodes of such tree, increasing the probability of proving the optimality in a reasonable computational time.

We did our work on the top of a previous paper found in the literature (Rocha et al., 2011). The instances used to test the formulations are those proposed by Rocha et al. Our paper shows a clear evolution concerning the results as the formulations are improved, leading to the generation of new and harder instances (based on the existent ones) to evaluate the potential of such formulations.

@&#LITERATURE REVIEW@&#

Several models for optimizing the transportation of petroleum products are found in literature, considering different characteristics. In Colvin and Maravelias (2011), the authors consider task selection, scheduling, and resource planning decisions, exploring risk management methods, and develop a multi-stage stochastic programming model. To optimize such models, Mixed Integer Programming is the most used technique. In Magatão, Arruda, and Neves (2004) and Boschetto et al., 2010, MIP is applied to schedule the activities in a real oil pipeline network. The former uses illustrative instances with four products, while the latter uses large instances, where more than 14 oil derivatives and ethanol are transported. In Moro and Pinto (2004), MIP is used to optimize the short-term crude oil scheduling. The authors deal with the separation of brine from the oil, interface separation between different types of oil, and energy consumption in the crude distillation units. MIP is also used in a real-time approach to dispatch petroleum tank trucks (Brown & Graves, 1981) and to optimize the long-term oil derivative scheduling under uncertainty (MirHassani, 2008). Finally, in Banaszewski, Tacla, Pereira, Arruda, and Enembreck (2010) and Aizemberg et al. (2011), the authors deal with the medium-term planning of oil derivatives transportation in the Brazilian oil industry multimodal supply chain network. The former applied an auction based multiagent algorithm, while the latter applied MIP.

Column generation based heuristics (CGH) are found in literature to deal with many different problems: multi-item scheduling (Bahl, 1983), vehicle routing (Mourgaya & Vanderbeck, 2007), cutting stock (Furini, Malaguti, Durain, Persiani, & Toth, 2012), sensor placement (Yavuz, Aras, Kuban, & Ersoy, 2010), generalized assignment (Moccia, Cordeau, Monaco, & Sammarra, 2009) and many others. In general, such approaches share similar main characteristics. First, the linear programming relaxation is solved by column generation. Then, a feasible solution is constructed for the original problem using the obtained columns. For example, in Choi and Tcha (2007) the authors apply a column generation heuristic for the heterogeneous fleet vehicle routing problem which consists of three steps: (i) solve the continuous relaxation; (ii) set the variables of the final restricted master as binaries; and (iii) solve the resulting MIP problem. In Joncour, Michel, Sadykov, Sverdlov, and Vanderbeck (2010), the authors review generic classes of column generation-based heuristics.

The remainder of the paper is organized as follows. Section 2 presents the problem definitions and the mathematical formulations, including the Dantzig–Wolfe decomposition formulation used by the proposed heuristic. Section 3 shows the column generation-based heuristic procedure, including dynamic programming algorithm for the pricing subproblem. Section 4 discusses the obtained results. At last, Section 5 contains the conclusions of this work.

This section presents the mathematical formulations considered for the problem in study.

The optimization problem defined in Rocha et al. (2011) is the following. Let P be the set of platforms and T the set of terminals. The planning horizon consists of D days. A unique product should be shipped from platforms to terminals to satisfy given demands. The inventory levels of platforms and terminals are limited by a lower and an upper bound, i.e., the lack or surplus of the product is not allowed at any point of the network. Oil tankers are grouped in classes according to their capacities. Let C be the set of all tanker classes. It is assumed that only oil tankers with fulfilled capacities are used in the transportation. The objective is to minimize the total transportation costs.

The formulations described in the next subsections consider the following notation:

Indices:
                        
                           •
                           
                              p: Platform, 
                                 
                                    p
                                    ∈
                                    P
                                 
                              ;


                              t: Terminal, 
                                 
                                    t
                                    ∈
                                    T
                                 
                              ;


                              c: Class of tanker, 
                                 
                                    c
                                    ∈
                                    C
                                 
                              ;


                              d: day, 
                                 
                                    d
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    D
                                    }
                                 
                              .

Subsets:
                        
                           •
                           
                              
                                 
                                    T
                                    (
                                    p
                                    )
                                    ⊆
                                    T
                                 
                              : Terminals allowed to send tankers to a platform 
                                 
                                    p
                                    ∈
                                    P
                                 
                              ;


                              
                                 
                                    P
                                    (
                                    t
                                    )
                                    ⊆
                                    P
                                 
                              : Platforms allowed to receive tankers from a terminal 
                                 
                                    t
                                    ∈
                                    T
                                 
                              ;


                              
                                 
                                    C
                                    (
                                    p
                                    )
                                    ⊆
                                    C
                                 
                              : Classes of tankers allowed to pick up oil from platform 
                                 
                                    p
                                    ∈
                                    P
                                 
                              .

Input data:
                        
                           •
                           
                              
                                 
                                    
                                       
                                          e
                                       
                                       
                                          p
                                          ,
                                          0
                                       
                                    
                                 
                              : Initial inventory at platform 
                                 
                                    p
                                    ∈
                                    P
                                 
                              ;


                              
                                 
                                    
                                       
                                          e
                                       
                                       
                                          t
                                          ,
                                          0
                                       
                                    
                                 
                              : Initial inventory at terminal 
                                 
                                    t
                                    ∈
                                    T
                                 
                              ;


                              
                                 
                                    
                                       
                                          P
                                       
                                       
                                          p
                                          ,
                                          d
                                       
                                    
                                    ⩾
                                    0
                                 
                              : Production at platform 
                                 
                                    p
                                    ∈
                                    P
                                 
                              , in day d;


                              
                                 
                                    
                                       
                                          C
                                       
                                       
                                          t
                                          ,
                                          d
                                       
                                    
                                    ⩾
                                    0
                                 
                              : Consumption at terminal 
                                 
                                    t
                                    ∈
                                    T
                                 
                              , in day d;


                              
                                 
                                    
                                       
                                          CAP
                                       
                                       
                                          p
                                          ,
                                          d
                                       
                                    
                                 
                              : Maximum inventory capacity at platform 
                                 
                                    p
                                    ∈
                                    P
                                 
                              , in day d;


                              
                                 
                                    
                                       
                                          CAP
                                       
                                       
                                          t
                                          ,
                                          d
                                       
                                    
                                 
                              : Maximum inventory capacity at terminal 
                                 
                                    t
                                    ∈
                                    T
                                 
                              , in day d;


                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          c
                                       
                                    
                                 
                              : Capacity of a tanker of class 
                                 
                                    c
                                    ∈
                                    C
                                 
                              ;


                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          c
                                       
                                    
                                 
                              : Transportation cost per day for a tanker of class 
                                 
                                    c
                                    ∈
                                    C
                                 
                               (tankers must travel back from the platform to the terminal after each transportation);


                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                    
                                 
                              : Transportation time between a platform 
                                 
                                    p
                                    ∈
                                    P
                                 
                               and a terminal 
                                 
                                    t
                                    ∈
                                    T
                                 
                               in days.

Other definitions will be added as needed by each formulation.

For this model the decision variables are defined as follows. 
                           
                              
                                 
                                    z
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                                 
                                    c
                                    ,
                                    d
                                 
                              
                              ∈
                              {
                              0
                              ,
                              1
                              }
                           
                         is a binary variable indicating if a tanker of class 
                           
                              c
                              ∈
                              C
                           
                         is assigned to ship the product from platform 
                           
                              p
                              ∈
                              P
                           
                         to terminal 
                           
                              t
                              ∈
                              T
                           
                         at day d. The variables 
                           
                              
                                 
                                    e
                                 
                                 
                                    p
                                    ,
                                    d
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    +
                                 
                              
                           
                         and 
                           
                              
                                 
                                    e
                                 
                                 
                                    t
                                    ,
                                    d
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    +
                                 
                              
                           
                         represent the inventory levels at platform 
                           
                              p
                              ∈
                              P
                           
                         and terminal 
                           
                              t
                              ∈
                              T
                           
                         at day d, respectively. Thus, the natural formulation (
                           
                              NF
                           
                        ) is given by the following:
                           
                              (1)
                              
                                 (
                                 NF
                                 )
                                 
                                 
                                    min
                                 
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          d
                                          =
                                          1
                                       
                                       
                                          D
                                       
                                    
                                 
                                 2
                                 
                                    
                                       F
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (2)
                              
                                 subject to
                                 
                                 
                                    
                                       e
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       e
                                    
                                    
                                       p
                                       ,
                                       d
                                       -
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       P
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (3)
                              
                                 
                                    
                                       e
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       e
                                    
                                    
                                       t
                                       ,
                                       d
                                       -
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       C
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                          (
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (4)
                              
                                 0
                                 ⩽
                                 
                                    
                                       e
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       CAP
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (5)
                              
                                 0
                                 ⩽
                                 
                                    
                                       e
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       CAP
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (6)
                              
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 t
                                 ∈
                                 T
                                 (
                                 p
                                 )
                                 ,
                                 
                                 c
                                 ∈
                                 C
                                 (
                                 p
                                 )
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 .
                              
                           
                        
                     

The objective function (1) aims to minimize the total transportation costs. Constraints (2) calculate the inventory balance at each platform, while constraints (3) calculate the inventory balance at each terminal. Constraints (4) and (5) assure that inventory levels at each platform and terminal at each day will not be less than their minimum storage capacity nor greater than their maximum storage capacity.

Some of the problem assumptions deserve discussion:
                           
                              •
                              no more than one tanker of each class can be used in each route and day: this assumption is not realistic, we just followed the previous paper. But it is easy to drop this assumption, just setting the binary variables as integer;

unlimited number of tankers in each class: we believe this assumption is realistic because it is based on a real problem where the oil company rents the tankers;

the instances use no realistic transportation and (un)loading times: we could use realistic values, but this will not change the formulation performance.

The 
                           
                              NF
                           
                         is the starting point for a second formulation, which needs some additional definitions listed on the following. Define 
                           
                              
                                 
                                    L
                                 
                                 
                                    p
                                 
                              
                           
                         as the greatest common divisor (GCD) of all the shipping capacities of all classes of tankers that are allowed to pick up oil from platform p. Let 
                           
                              
                                 
                                    k
                                 
                                 
                                    min
                                 
                              
                              (
                              p
                              ,
                              d
                              )
                           
                         be minimum number of lots of size 
                           
                              
                                 
                                    L
                                 
                                 
                                    p
                                 
                              
                           
                         that should be shipped before day d from platform p to avoid its maximum inventory capacity to be exceeded. This number is given by the formula:
                           
                              
                                 
                                    
                                       k
                                    
                                    
                                       min
                                    
                                 
                                 (
                                 p
                                 ,
                                 d
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      AC
                                                   
                                                   
                                                      p
                                                      ,
                                                      d
                                                   
                                                
                                                -
                                                
                                                   
                                                      CAP
                                                   
                                                   
                                                      p
                                                      ,
                                                      d
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    AC
                                 
                                 
                                    p
                                    ,
                                    d
                                 
                              
                           
                         is the accumulated amount of product at platform p from day 0 to day d and is given by:
                           
                              
                                 
                                    
                                       AC
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       e
                                    
                                    
                                       p
                                       ,
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       p
                                       ,
                                       τ
                                    
                                 
                                 .
                              
                           
                        
                     

Also, let 
                           
                              
                                 
                                    k
                                 
                                 
                                    max
                                 
                              
                              (
                              p
                              ,
                              d
                              )
                           
                         be the maximum number of lots of size 
                           
                              
                                 
                                    L
                                 
                                 
                                    p
                                 
                              
                           
                         allowed to be shipped until day d from platform p avoiding its inventory level to be less than zero. Such number is calculated by:
                           
                              
                                 
                                    
                                       k
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 p
                                 ,
                                 d
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      AC
                                                   
                                                   
                                                      p
                                                      ,
                                                      d
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        
                     

With the definitions given above, constraints (4) are replaced with:
                           
                              (7)
                              
                                 
                                    
                                       AC
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       k
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 p
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       p
                                    
                                 
                                 ⩽
                                 
                                    
                                       e
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       AC
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       k
                                    
                                    
                                       min
                                    
                                 
                                 (
                                 p
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       p
                                    
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 .
                              
                           
                        
                     

Now, define 
                           
                              
                                 
                                    L
                                 
                                 
                                    t
                                 
                              
                           
                         as the GCD of all the shipping capacities of all classes of tankers that are allowed to supply terminal t. Let 
                           
                              
                                 
                                    k
                                 
                                 
                                    min
                                 
                              
                              (
                              t
                              ,
                              d
                              )
                           
                         be the minimum number of lots of size 
                           
                              
                                 
                                    L
                                 
                                 
                                    t
                                 
                              
                           
                         that must be received by terminal t until day d such that its inventory level is not negative. This number is given by:
                           
                              
                                 
                                    
                                       k
                                    
                                    
                                       min
                                    
                                 
                                 (
                                 t
                                 ,
                                 d
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                -
                                                
                                                   
                                                      AC
                                                   
                                                   
                                                      t
                                                      ,
                                                      d
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    AC
                                 
                                 
                                    t
                                    ,
                                    d
                                 
                              
                           
                         is the accumulated amount of product at terminal t from day 0 to day d and is given by:
                           
                              
                                 
                                    
                                       AC
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       e
                                    
                                    
                                       t
                                       ,
                                       0
                                    
                                 
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       C
                                    
                                    
                                       t
                                       ,
                                       τ
                                    
                                 
                                 .
                              
                           
                        
                     

Let 
                           
                              
                                 
                                    k
                                 
                                 
                                    max
                                 
                              
                              (
                              t
                              ,
                              d
                              )
                           
                         be the maximum number of lots of size 
                           
                              
                                 
                                    L
                                 
                                 
                                    t
                                 
                              
                           
                         allowed to be received by terminal t until day d without exceeding its inventory capacity. Such quantity is calculated by the following formula:
                           
                              
                                 
                                    
                                       k
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 t
                                 ,
                                 d
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      CAP
                                                   
                                                   
                                                      t
                                                      ,
                                                      d
                                                   
                                                
                                                -
                                                
                                                   
                                                      AC
                                                   
                                                   
                                                      t
                                                      ,
                                                      d
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        
                     

Given this, constraints (5) are replaced with:
                           
                              (8)
                              
                                 
                                    
                                       AC
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 +
                                 
                                    
                                       k
                                    
                                    
                                       min
                                    
                                 
                                 (
                                 t
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       t
                                    
                                 
                                 ⩽
                                 
                                    
                                       e
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       AC
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 +
                                 
                                    
                                       k
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 t
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       t
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 .
                              
                           
                        
                     

With the substitutions suggested above, the second formulation for the problem, which will be called Basic Formulation (
                           
                              BF
                           
                        ), is given by the objective function (1) subject to constraints (2), (3), (7), (8) and (6).

For this third formulation, which is adapted from Rocha et al. (2011), some of the previous definitions are considered plus others that follow.
                           
                              
                                 
                                    
                                       DA
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       AC
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       CAP
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       DA
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       CAP
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       AC
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 .
                              
                           
                        
                     

Thus, the Knapsack Cascading (
                           
                              KC
                           
                        ) formulation is given by:
                           
                              (9)
                              
                                 (
                                 KC
                                 )
                                 
                                 
                                    min
                                 
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          d
                                          =
                                          1
                                       
                                       
                                          D
                                       
                                    
                                 
                                 2
                                 
                                    
                                       F
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (10)
                              
                                 subject to
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       τ
                                    
                                 
                                 ⩽
                                 
                                    
                                       AC
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       τ
                                    
                                 
                                 ⩾
                                 
                                    
                                       DA
                                    
                                    
                                       p
                                       ,
                                       d
                                    
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                          (
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       τ
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 ⩾
                                 -
                                 
                                    
                                       AC
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                          (
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       τ
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 ⩽
                                 
                                    
                                       DA
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 t
                                 ∈
                                 T
                                 (
                                 p
                                 )
                                 ,
                                 c
                                 ∈
                                 C
                                 (
                                 p
                                 )
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 .
                              
                           
                        
                     

The objective function (9) minimizes the total transportation cost. Constraints (10) avoid the inventory levels at each platform to be less than the minimum capacity. Constraints (11) ensure that the inventory levels at each platform never exceed their maximum inventory capacity. Constraints (12) avoid the inventory levels at each terminal to be less than the minimum capacity and constraints (13) ensure that the inventory levels at each terminal never exceed their maximum inventory capacity. Finally, the z variables are defined by (14) as binaries.

From the 
                           
                              KC
                           
                         formulation, it is possible to derive a fourth formulation replacing constraints (10) and (11) by the new constraints (15) and (16) that follow:
                           
                              (15)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       τ
                                    
                                 
                                 ⩽
                                 
                                    
                                       k
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 p
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       p
                                    
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                              
                           
                        
                        
                           
                              (16)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       τ
                                    
                                 
                                 ⩾
                                 
                                    
                                       k
                                    
                                    
                                       min
                                    
                                 
                                 (
                                 p
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       p
                                    
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                              
                           
                        and substituting (12) and (13) by (17) and (18) below:
                           
                              (17)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                          (
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       τ
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 ⩽
                                 
                                    
                                       k
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 t
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       t
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                          (
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       τ
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 ⩾
                                 
                                    
                                       k
                                    
                                    
                                       min
                                    
                                 
                                 (
                                 t
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       t
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 .
                              
                           
                        
                     

The resulting formulation will be called Rounded Knapsack Cascading (
                           
                              RKC
                           
                        ) formulation.

The variables of this newly proposed formulation are defined as follows: 
                           
                              
                                 
                                    x
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                                 
                                    c
                                    ,
                                    d
                                 
                              
                           
                         is an integer variable representing the number of tankers of class 
                           
                              c
                              ∈
                              C
                              (
                              p
                              )
                           
                         leaving platform 
                           
                              p
                              ∈
                              P
                           
                         to terminal 
                           
                              t
                              ∈
                              T
                              (
                              p
                              )
                           
                         from day 1 to day d. The 
                           
                              
                                 
                                    z
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                                 
                                    c
                                    ,
                                    d
                                 
                              
                           
                         variables are also considered as previously defined. Let 
                           
                              
                                 
                                    x
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                                 
                                    c
                                    ,
                                    0
                                 
                              
                              =
                              0
                           
                        . The Accumulated Rounded Cascading (
                           
                              ARC
                           
                        ) formulation is given by:
                           
                              (19)
                              
                                 (
                                 ARC
                                 )
                                 
                                 
                                    min
                                 
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 2
                                 
                                    
                                       F
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       D
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (20)
                              
                                 subject to
                                 
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                       -
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 t
                                 ∈
                                 T
                                 (
                                 p
                                 )
                                 ,
                                 c
                                 ∈
                                 C
                                 (
                                 p
                                 )
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (21)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       k
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 p
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       p
                                    
                                 
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (22)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          t
                                          ∈
                                          T
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 ⩾
                                 
                                    
                                       k
                                    
                                    
                                       min
                                    
                                 
                                 (
                                 p
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       p
                                    
                                 
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (23)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                          (
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 ⩽
                                 
                                    
                                       k
                                    
                                    
                                       max
                                    
                                 
                                 (
                                 t
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       t
                                    
                                 
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (24)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                          (
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          c
                                          ∈
                                          C
                                          (
                                          p
                                          )
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 ⩾
                                 
                                    
                                       k
                                    
                                    
                                       min
                                    
                                 
                                 (
                                 t
                                 ,
                                 d
                                 )
                                 
                                    
                                       L
                                    
                                    
                                       t
                                    
                                 
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (25)
                              
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 ∈
                                 
                                    
                                       Z
                                    
                                    
                                       +
                                    
                                 
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 t
                                 ∈
                                 T
                                 (
                                 p
                                 )
                                 ,
                                 
                                 c
                                 ∈
                                 C
                                 (
                                 p
                                 )
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (26)
                              
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 or
                                 
                                 [
                                 0
                                 ,
                                 1
                                 ]
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 t
                                 ∈
                                 T
                                 (
                                 p
                                 )
                                 ,
                                 
                                 c
                                 ∈
                                 C
                                 (
                                 p
                                 )
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 .
                              
                           
                        
                     

The objective function (19) is to minimize the total transportation cost. Constraints (20) define the x variables in terms of the z variables. Constraints (21) and (22) ensure that the inventory level in each platform p at day d is not less than the minimum inventory capacity and does not exceed the maximum inventory capacity. Constraints (23) and (24) avoid the inventory level in each terminal t at day d to exceed the maximum inventory capacity and to be less than zero. At last, constraints (25) define the x variables as nonnegative integers and constraints (26) define the z variables as binaries or continuous variables in the range zero and one. Note that constraint (20) ensures the integrality of variables z regardless of their definitions.
                           Proposition 2.1
                           
                              
                                 
                                    BF
                                    ,
                                    
                                    RKC
                                 
                               
                              and 
                              
                                 
                                    ARC
                                 
                               
                              have the same linear relaxation.
                           

We will prove the proposition in two steps. First, we will show that 
                                 
                                    RKC
                                 
                               is obtained from 
                                 
                                    BF
                                 
                               without changing its linear relaxation solution set over the z variables. Second, we will show that 
                                 
                                    ARC
                                 
                               is obtained from 
                                 
                                    RKC
                                 
                               without changing its linear relaxation solution set over the z variables. Now, consider the 
                                 
                                    BF
                                 
                              . Given the constraints (2) and expanding 
                                 
                                    
                                       
                                          e
                                       
                                       
                                          p
                                          ,
                                          d
                                          -
                                          1
                                       
                                    
                                 
                              , we will have:
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             p
                                             ,
                                             d
                                          
                                       
                                       =
                                       
                                          
                                             AC
                                          
                                          
                                             p
                                             ,
                                             d
                                          
                                       
                                       -
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                t
                                                ∈
                                                T
                                                (
                                                p
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                =
                                                1
                                             
                                             
                                                d
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                c
                                                ∈
                                                C
                                                (
                                                p
                                                )
                                             
                                          
                                       
                                       
                                          
                                             V
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             z
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                          
                                             c
                                             ,
                                             τ
                                          
                                       
                                       
                                       
                                       ∀
                                       p
                                       ∈
                                       P
                                       ,
                                       
                                       d
                                       ∈
                                       {
                                       1
                                       ,
                                       …
                                       ,
                                       D
                                       }
                                    
                                 
                              
                           

From (7),
                                 
                                    
                                       
                                          
                                             AC
                                          
                                          
                                             p
                                             ,
                                             d
                                          
                                       
                                       -
                                       
                                          
                                             k
                                          
                                          
                                             max
                                          
                                       
                                       (
                                       p
                                       ,
                                       d
                                       )
                                       
                                          
                                             L
                                          
                                          
                                             p
                                          
                                       
                                       ⩽
                                       
                                          
                                             AC
                                          
                                          
                                             p
                                             ,
                                             d
                                          
                                       
                                       -
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                t
                                                ∈
                                                T
                                                (
                                                p
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                =
                                                1
                                             
                                             
                                                d
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                c
                                                ∈
                                                C
                                                (
                                                p
                                                )
                                             
                                          
                                       
                                       
                                          
                                             V
                                          
                                          
                                             c
                                          
                                       
                                       
                                          
                                             z
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                          
                                             c
                                             ,
                                             τ
                                          
                                       
                                       ⩽
                                       
                                          
                                             AC
                                          
                                          
                                             p
                                             ,
                                             d
                                          
                                       
                                       -
                                       
                                          
                                             k
                                          
                                          
                                             min
                                          
                                       
                                       (
                                       p
                                       ,
                                       d
                                       )
                                       
                                          
                                             L
                                          
                                          
                                             p
                                          
                                       
                                       
                                       
                                       ∀
                                       p
                                       ∈
                                       P
                                       ,
                                       
                                       d
                                       ∈
                                       {
                                       1
                                       ,
                                       …
                                       ,
                                       D
                                       }
                                    
                                 
                              which is equivalent to (15) and (16). The same procedure can be used to prove that (3) and (8) have the same linear relaxation solution set of (17) and (18) over the z variables. Thus, 
                                 
                                    RKC
                                 
                               has the same linear relaxation solution set over the z variables as 
                                 
                                    BF
                                 
                              . Now, consider the 
                                 
                                    RKC
                                 
                              . Define the x variables as follows:
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                          
                                             c
                                             ,
                                             d
                                          
                                       
                                       =
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                τ
                                                =
                                                1
                                             
                                             
                                                d
                                             
                                          
                                       
                                       
                                          
                                             z
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                          
                                             c
                                             ,
                                             τ
                                          
                                       
                                    
                                 
                              and replace the right-hand side of the previous equality by 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                       
                                          c
                                          ,
                                          d
                                       
                                    
                                 
                               in the 
                                 
                                    RKC
                                 
                              . Including the constraints (20), we obtain the 
                                 
                                    ARC
                                 
                               formulation, proving that it has the same linear relaxation solution set as the 
                                 
                                    RKC
                                 
                               over the z variables. □

The same proof can be applied for 
                           
                              NF
                              ,
                              
                              KC
                           
                         and 
                           
                              AC
                           
                        , where 
                           
                              AC
                           
                         is the accumulated cascading formulation without rounding, leading to the following proposition:
                           Proposition 2.2
                           
                              
                                 
                                    NF
                                    ,
                                    
                                    KC
                                 
                               
                              and 
                              
                                 
                                    AC
                                 
                               
                              have the same linear relaxation.
                           

Here, we present a Dantzig–Wolfe decomposition (
                           
                              DWD
                           
                        ) (Dantzig & Wolfe, 1960) for the problem using the (
                           
                              RKC
                           
                        ) formulation as starting point. The resulting reformulation is primarily used to derive improved lower bounds for the original problem via Column Generation (CG). The results obtained with this formulation are used as a benchmark to analyze the linear relaxation of the implemented formulations of this paper. Furthermore, we observe that the stronger linear relaxation provided by 
                           
                              DWD
                           
                         helps to select z variables that are suitable for building good feasible solutions. Motivated by this observation, we propose a CG based heuristic in Section 3 which demonstrates the importance of the 
                           
                              DWD
                           
                         formulation.

The following notation is considered for the reformulation: let 
                           
                              
                                 
                                    S
                                 
                                 
                                    p
                                 
                              
                           
                         be the set of all feasible solutions for a platform 
                           
                              p
                              ∈
                              P
                           
                        , let 
                           
                              
                                 
                                    V
                                 
                                 
                                    p
                                    ,
                                    s
                                 
                                 
                                    t
                                    ,
                                    d
                                 
                              
                           
                         be the amount of product shipped from a platform 
                           
                              p
                              ∈
                              P
                           
                         to terminal 
                           
                              t
                              ∈
                              T
                              (
                              p
                              )
                           
                         at a day d in a solution 
                           
                              s
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    p
                                 
                              
                           
                        , and let 
                           
                              
                                 
                                    C
                                 
                                 
                                    p
                                    ,
                                    s
                                 
                              
                           
                         be the cost of a solution 
                           
                              s
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    p
                                 
                              
                           
                         for a platform 
                           
                              p
                              ∈
                              P
                           
                        . Binary variables 
                           
                              
                                 
                                    λ
                                 
                                 
                                    p
                                    ,
                                    s
                                 
                              
                           
                         indicate if a solution 
                           
                              s
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    p
                                 
                              
                           
                         for a platform 
                           
                              p
                              ∈
                              P
                           
                         is used. The reformulation obtained after applying the Dantzig–Wolfe decomposition, the so called Dantzig–Wolfe Master 
                           
                              (
                              DWM
                              )
                           
                        , is the following:
                           
                              (27)
                              
                                 (
                                 DWM
                                 )
                                 
                                 
                                    min
                                 
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          s
                                          ∈
                                          
                                             
                                                S
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       C
                                    
                                    
                                       p
                                       ,
                                       s
                                    
                                 
                                 
                                    
                                       λ
                                    
                                    
                                       p
                                       ,
                                       s
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (28)
                              
                                 subject to
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          s
                                          ∈
                                          
                                             
                                                S
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       λ
                                    
                                    
                                       p
                                       ,
                                       s
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                              
                           
                        
                        
                           
                              (29)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          s
                                          ∈
                                          
                                             
                                                S
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       p
                                       ,
                                       s
                                    
                                    
                                       t
                                       ,
                                       τ
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 
                                    
                                       λ
                                    
                                    
                                       p
                                       ,
                                       s
                                    
                                 
                                 ⩾
                                 
                                    
                                       
                                          
                                             
                                                -
                                                
                                                   
                                                      AC
                                                   
                                                   
                                                      t
                                                      ,
                                                      d
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       L
                                    
                                    
                                       t
                                    
                                 
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (30)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          P
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          s
                                          ∈
                                          
                                             
                                                S
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          τ
                                          =
                                          1
                                       
                                       
                                          d
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       p
                                       ,
                                       s
                                    
                                    
                                       t
                                       ,
                                       τ
                                       -
                                       
                                          
                                             D
                                          
                                          
                                             p
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 
                                    
                                       λ
                                    
                                    
                                       p
                                       ,
                                       s
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      CAP
                                                   
                                                   
                                                      t
                                                   
                                                
                                                -
                                                
                                                   
                                                      AC
                                                   
                                                   
                                                      t
                                                      ,
                                                      d
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       L
                                    
                                    
                                       t
                                    
                                 
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 ,
                                 
                                 d
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 D
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (31)
                              
                                 
                                    
                                       λ
                                    
                                    
                                       p
                                       ,
                                       s
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 
                                 ∀
                                 p
                                 ∈
                                 P
                                 ,
                                 
                                 s
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       p
                                    
                                 
                                 .
                              
                           
                        
                     

The objective function (27) aims to minimize the sum of transportation costs. Constraints (28) ensure that exactly one solution 
                           
                              s
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    p
                                 
                              
                           
                         variable is chosen for each platform 
                           
                              p
                              ∈
                              P
                           
                        . Constraints (29) avoid the inventory level at each terminal to be less than zero. Constraints (30) ensure that the maximum inventory capacity of each terminal will not be exceeded. Finally, constraints (31) define the 
                           
                              λ
                           
                         variables as binaries.

Given the large number of variables in 
                              
                                 DWM
                              
                            formulation, its direct use is impractical for large instances. To overcome this issue, a Column Generation (GC) procedure is often used in order to solve the linear programming relaxation of 
                              
                                 DWM
                              
                           . This procedure is started by considering only a subset of its variables. The problem with such subset of variables is called the Restricted Master Problem (RMP). At each iteration of the CG procedure, the RMP is solved and the dual variables of its optimal solution are used to generate new 
                              
                                 λ
                              
                            variables by solving the Pricing Subproblem. A new 
                              
                                 λ
                              
                            variable is added to RMP if its reduced cost, given by the objective function value of the Pricing Subproblem, is negative. If, at a given iteration, it is no longer possible to generate a 
                              
                                 λ
                              
                            variable with negative reduced cost, the procedure is finished and the current solution for RMP is the optimal solution for the linear relaxation of 
                              
                                 DWM
                              
                           .

Let 
                              
                                 
                                    
                                       π
                                    
                                    
                                       p
                                    
                                 
                              
                            be the vector containing the dual variables associated to constraints (28), 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                              
                            be the vector containing the dual variables associated to constraints (29), and 
                              
                                 
                                    
                                       σ
                                    
                                    
                                       t
                                       ,
                                       d
                                    
                                 
                              
                            be the vector containing the dual variables associated to constraints (30). The binary variable 
                              
                                 
                                    
                                       z
                                    
                                    
                                       p
                                       ,
                                       t
                                    
                                    
                                       c
                                       ,
                                       d
                                    
                                 
                              
                            indicates if the platform p sends a tanker of class c to terminal t at day d. Thus, for each platform p, a Pricing Subproblem is defined as follows.
                              
                                 (32)
                                 
                                    (
                                    
                                       
                                          SP
                                       
                                       
                                          p
                                       
                                    
                                    )
                                    
                                    
                                       min
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                             (
                                             p
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             c
                                             ∈
                                             C
                                             (
                                             p
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             d
                                             =
                                             1
                                          
                                          
                                             D
                                          
                                       
                                    
                                    (
                                    2
                                    
                                       
                                          F
                                       
                                       
                                          c
                                       
                                    
                                    
                                       
                                          D
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                    
                                    -
                                    
                                       
                                          V
                                       
                                       
                                          c
                                       
                                    
                                    (
                                    
                                       
                                          θ
                                       
                                       
                                          t
                                          ,
                                          d
                                          +
                                          
                                             
                                                D
                                             
                                             
                                                p
                                                ,
                                                t
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          σ
                                       
                                       
                                          t
                                          ,
                                          d
                                          +
                                          
                                             
                                                D
                                             
                                             
                                                p
                                                ,
                                                t
                                             
                                          
                                       
                                    
                                    )
                                    )
                                    
                                       
                                          z
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                       
                                          c
                                          ,
                                          d
                                       
                                    
                                    -
                                    
                                       
                                          π
                                       
                                       
                                          p
                                       
                                    
                                    ,
                                 
                              
                           
                           
                              
                                 (33)
                                 
                                    subject to
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                             (
                                             p
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             τ
                                             =
                                             1
                                          
                                          
                                             d
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             c
                                             ∈
                                             C
                                             (
                                             p
                                             )
                                          
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                       
                                          c
                                          ,
                                          τ
                                       
                                    
                                    
                                       
                                          V
                                       
                                       
                                          c
                                       
                                    
                                    ⩽
                                    
                                       
                                          AC
                                       
                                       
                                          p
                                          ,
                                          d
                                       
                                    
                                    
                                    ∀
                                    d
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    D
                                    }
                                    ,
                                 
                              
                           
                           
                              
                                 (34)
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             T
                                             (
                                             p
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             τ
                                             =
                                             1
                                          
                                          
                                             d
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             c
                                             ∈
                                             C
                                             (
                                             p
                                             )
                                          
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                       
                                          c
                                          ,
                                          τ
                                       
                                    
                                    
                                       
                                          V
                                       
                                       
                                          c
                                       
                                    
                                    ⩾
                                    
                                       
                                          DA
                                       
                                       
                                          p
                                          ,
                                          d
                                       
                                    
                                    
                                    
                                    ∀
                                    d
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    D
                                    }
                                    ,
                                 
                              
                           
                           
                              
                                 (35)
                                 
                                    
                                       
                                          z
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                       
                                          c
                                          ,
                                          d
                                       
                                    
                                    ∈
                                    {
                                    0
                                    ,
                                    1
                                    }
                                    
                                    
                                    ∀
                                    t
                                    ∈
                                    T
                                    (
                                    p
                                    )
                                    ,
                                    
                                    c
                                    ∈
                                    C
                                    (
                                    p
                                    )
                                    ,
                                    
                                    d
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    D
                                    }
                                    .
                                 
                              
                           
                        

The purpose of the Pricing Subproblem is to generate a 
                              
                                 λ
                              
                            variable to be added to the RMP with the lowest reduced cost, which is represented by the objective function (32). Constraints (33) avoid the inventory level at each platform to be less than zero. Constraints (34) ensure that the maximum inventory capacity at each platform will not be exceeded. At last, z variables are defined as binary by (35). Even though the Pricing Subproblem is presented as an Integer Linear Program, it can be solved more efficiently by dynamic programming.

This section presents the column generation-based heuristic (CGH). First, we show the dynamic programming algorithm to solve the subproblems faster than the MIP of subSection 2.4.1. Next, we show the heuristic procedure.

In the following definitions we assume that the elements of the set C are arbitrarily numbered from 1 to 
                           
                              |
                              C
                              |
                           
                        . We define our dynamic programming cost table for platform p with 
                           
                              
                                 
                                    Cost
                                 
                                 
                                    p
                                 
                              
                              (
                              d
                              ,
                              c
                              ,
                              e
                              )
                           
                         being the smallest partial reduced cost from day d to the end of the time horizon, considering only the tanker classes 
                           
                              c
                              ,
                              …
                              ,
                              |
                              C
                              |
                           
                         at day d (and all classes for the next days), and inventory level e at the beginning of day d. Let 
                           
                              
                                 
                                    Cost
                                 
                                 
                                    p
                                 
                              
                              (
                              d
                              ,
                              c
                              ,
                              e
                              )
                              =
                              0
                           
                         for 
                           
                              d
                              =
                              D
                              +
                              1
                           
                        . The dynamic programming recursion is the following:
                           
                              
                                 
                                    
                                       Cost
                                    
                                    
                                       p
                                    
                                 
                                 (
                                 d
                                 ,
                                 c
                                 ,
                                 e
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            min
                                                         
                                                         
                                                            α
                                                            ∈
                                                            
                                                               
                                                                  P
                                                               
                                                               
                                                                  1
                                                                  ,
                                                                  p
                                                                  ,
                                                                  c
                                                                  ,
                                                                  d
                                                                  ,
                                                                  e
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  Cost
                                                               
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     d
                                                                     ,
                                                                     c
                                                                     +
                                                                     1
                                                                     ,
                                                                     e
                                                                     +
                                                                     
                                                                        
                                                                           P
                                                                        
                                                                        
                                                                           p
                                                                           ,
                                                                           d
                                                                        
                                                                     
                                                                     -
                                                                     
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              t
                                                                              ∈
                                                                              T
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           V
                                                                        
                                                                        
                                                                           c
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           α
                                                                        
                                                                        
                                                                           t
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  
                                                                     ∑
                                                                  
                                                                  
                                                                     t
                                                                     ∈
                                                                     T
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  C
                                                               
                                                               
                                                                  p
                                                                  ,
                                                                  t
                                                               
                                                               
                                                                  c
                                                                  ,
                                                                  d
                                                               
                                                            
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  t
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                   c
                                                   =
                                                   1
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            min
                                                         
                                                         
                                                            α
                                                            ∈
                                                            
                                                               
                                                                  P
                                                               
                                                               
                                                                  2
                                                                  ,
                                                                  p
                                                                  ,
                                                                  c
                                                                  ,
                                                                  d
                                                                  ,
                                                                  e
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  Cost
                                                               
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     d
                                                                     ,
                                                                     c
                                                                     +
                                                                     1
                                                                     ,
                                                                     e
                                                                     -
                                                                     
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              t
                                                                              ∈
                                                                              T
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           V
                                                                        
                                                                        
                                                                           c
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           α
                                                                        
                                                                        
                                                                           t
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  
                                                                     ∑
                                                                  
                                                                  
                                                                     t
                                                                     ∈
                                                                     T
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  C
                                                               
                                                               
                                                                  p
                                                                  ,
                                                                  t
                                                               
                                                               
                                                                  c
                                                                  ,
                                                                  d
                                                               
                                                            
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  t
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                   1
                                                   <
                                                   c
                                                   <
                                                   |
                                                   C
                                                   |
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            min
                                                         
                                                         
                                                            α
                                                            ∈
                                                            
                                                               
                                                                  P
                                                               
                                                               
                                                                  3
                                                                  ,
                                                                  p
                                                                  ,
                                                                  c
                                                                  ,
                                                                  d
                                                                  ,
                                                                  e
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  Cost
                                                               
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     d
                                                                     +
                                                                     1
                                                                     ,
                                                                     1
                                                                     ,
                                                                     e
                                                                     -
                                                                     
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              t
                                                                              ∈
                                                                              T
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           V
                                                                        
                                                                        
                                                                           c
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           α
                                                                        
                                                                        
                                                                           t
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  
                                                                     ∑
                                                                  
                                                                  
                                                                     t
                                                                     ∈
                                                                     T
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  C
                                                               
                                                               
                                                                  p
                                                                  ,
                                                                  t
                                                               
                                                               
                                                                  c
                                                                  ,
                                                                  d
                                                               
                                                            
                                                            
                                                               
                                                                  α
                                                               
                                                               
                                                                  t
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                   c
                                                   =
                                                   |
                                                   C
                                                   |
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   1
                                                   ,
                                                   p
                                                   ,
                                                   c
                                                   ,
                                                   d
                                                   ,
                                                   e
                                                
                                             
                                             =
                                             {
                                             α
                                             ∈
                                             
                                                
                                                   {
                                                   0
                                                   ,
                                                   1
                                                   }
                                                
                                                
                                                   |
                                                   T
                                                   |
                                                
                                             
                                             |
                                             0
                                             ⩽
                                             e
                                             +
                                             
                                                
                                                   P
                                                
                                                
                                                   p
                                                   ,
                                                   d
                                                
                                             
                                             -
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      t
                                                      ∈
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   c
                                                
                                             
                                             
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             }
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   2
                                                   ,
                                                   p
                                                   ,
                                                   c
                                                   ,
                                                   d
                                                   ,
                                                   e
                                                
                                             
                                             =
                                             {
                                             α
                                             ∈
                                             
                                                
                                                   {
                                                   0
                                                   ,
                                                   1
                                                   }
                                                
                                                
                                                   |
                                                   T
                                                   |
                                                
                                             
                                             |
                                             0
                                             ⩽
                                             e
                                             -
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      t
                                                      ∈
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   c
                                                
                                             
                                             
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             }
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   3
                                                   ,
                                                   p
                                                   ,
                                                   c
                                                   ,
                                                   d
                                                   ,
                                                   e
                                                
                                             
                                             =
                                             {
                                             α
                                             ∈
                                             
                                                
                                                   {
                                                   0
                                                   ,
                                                   1
                                                   }
                                                
                                                
                                                   |
                                                   T
                                                   |
                                                
                                             
                                             |
                                             0
                                             ⩽
                                             e
                                             -
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      t
                                                      ∈
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   V
                                                
                                                
                                                   c
                                                
                                             
                                             
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             ⩽
                                             
                                                
                                                   CAP
                                                
                                                
                                                   p
                                                
                                             
                                             }
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        and 
                           
                              
                                 
                                    C
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                                 
                                    c
                                    ,
                                    d
                                 
                              
                              =
                              2
                              
                                 
                                    F
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    D
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                              
                              -
                              
                                 
                                    V
                                 
                                 
                                    c
                                 
                              
                              (
                              
                                 
                                    θ
                                 
                                 
                                    t
                                    ,
                                    d
                                    +
                                    
                                       
                                          D
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    σ
                                 
                                 
                                    t
                                    ,
                                    d
                                    +
                                    
                                       
                                          D
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                    
                                 
                              
                              )
                           
                        . The optimal reduced cost for platform p is given by 
                           
                              
                                 
                                    Cost
                                 
                                 
                                    p
                                 
                              
                              (
                              1
                              ,
                              1
                              ,
                              
                                 
                                    e
                                 
                                 
                                    p
                                    ,
                                    0
                                 
                              
                              )
                           
                        .

The Dynamic Programming algorithm is pseudopolynomial. Its computational complexity depends on the maximum inventory capacity of the platforms. For the harder class of instances, its performance is quite superior to when a MIP is used. Fig. 1
                         shows an example with two lot sizes 
                           
                              (
                              C
                              =
                              {
                              1
                              ,
                              2
                              }
                              )
                           
                        . The daily production is always integer. There are two terminals with route to all platforms. Each lot size can be sent only once per day, for each terminal. In this example, the inventory capacity of the platform is 
                           
                              
                                 
                                    CAP
                                 
                                 
                                    p
                                 
                              
                              =
                              4
                           
                         units, the daily production is 
                           
                              
                                 
                                    P
                                 
                                 
                                    p
                                    ,
                                    d
                                 
                              
                              =
                              2
                           
                         units, 
                           
                              d
                              ∈
                              {
                              1
                              ,
                              2
                              ,
                              3
                              }
                           
                        , which is added between the first and the second lot size, and the initial inventory is 2 units. The first lot has size 
                           
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              =
                              1
                           
                         unit and costs 1.5. The second lot has size 
                           
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              =
                              2
                           
                         units and costs 2. Both can be sent to all terminals, with the same cost. If there are two or more terminals to send a lot size with different costs, the algorithm chooses always the cheapest one according to the reduced costs.

In Fig. 1, the costs for each inventory level, day and lot size are represented by the circles. At 
                           
                              d
                              =
                              1
                           
                         and 
                           
                              c
                              =
                              1
                           
                        , there is an initial inventory of 2 units and the lowest cost is 
                           
                              
                                 
                                    Cost
                                 
                                 
                                    p
                                 
                              
                              (
                              1
                              ,
                              1
                              ,
                              2
                              )
                              =
                              4
                           
                        , which is also the optimal cost. From 
                           
                              d
                              =
                              1
                           
                         and 
                           
                              c
                              =
                              1
                           
                         to 
                           
                              d
                              =
                              1
                           
                         and 
                           
                              c
                              =
                              2
                           
                        , there are three possibilities: (i) to send one lot (
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              =
                              1
                           
                        , for some t), resulting in inventory of 3 units and cost 
                           
                              3
                              +
                              1.5
                           
                        ; (ii) to send two lots (
                           
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              =
                              1
                              ,
                              ∀
                              t
                              ∈
                              T
                           
                        ), resulting in inventory of 2 units and cost 
                           
                              2
                              +
                              3
                           
                        ; or (ii) do not send a lot 
                           
                              (
                              
                                 
                                    α
                                 
                                 
                                    t
                                 
                              
                              =
                              0
                              ,
                              
                              ∀
                              t
                              ∈
                              T
                              )
                           
                        , resulting in inventory of 4 units and cost 4. The third option is chosen. From 
                           
                              d
                              =
                              1
                           
                         and 
                           
                              c
                              =
                              2
                           
                         to 
                           
                              d
                              =
                              2
                           
                         and 
                           
                              c
                              =
                              2
                           
                        , no lot is sent. Then, one lot is sent from 
                           
                              d
                              =
                              2
                           
                         and 
                           
                              c
                              =
                              2
                           
                         to 
                           
                              d
                              =
                              3
                           
                         and 
                           
                              c
                              =
                              1
                           
                        , and from 
                           
                              d
                              =
                              3
                           
                         and 
                           
                              c
                              =
                              2
                           
                        , resulting in an inventory of 4 units at the end of the time horizon.

The main advantage of the dynamic programming procedure is that the economy of scale on the lot sizes does not impact on the runtime, differently of the MIP formulation where we observe a major impact. This happens because the magnitude of the economy of scale only affects the reduced cost values, not the number of calculations made by the algorithm.

For the case where the daily production is fractional in at least one day, we need to do a preprocessing step. We accumulate the daily productions, and if the accumulated value is fractional, we decrease the inventory capacity by one unit to have space for the fractional part. The adjusted daily production is the integer part of the accumulated production, not added yet to the inventory. Table 1
                         shows an example with fractional production where the inventory capacity has 6 units. The first column shows the daily original production, which is fractional and equal 2.75 for all days. The second column shows the accumulated production. Note that there is only one integer value. Third column shows the original capacity, 6 units. Fourth column shows the adjusted capacity, which is equal the original capacity if the accumulated production is integer, or equal the original capacity minus one, if the accumulated capacity is fractional. The fifth column shows the adjusted production, which is equal the integer part of the accumulated production not yet added to the inventory.

The proposed heuristic uses the column generation procedure described in SubSection 2.4 with the pricing algorithm presented in the previous subsection to choose only some z variables of 
                           
                              ARC
                           
                         with good chance to appear in the optimal solution. This reduction in the number of variables allows the branch-and-bound algorithm to find fast a feasible solution, or prove that no solution can be found with these variables.

Such Column Generation-based heuristic is shown in Algorithm 1. First, the linear relaxation of the 
                           
                              DWM
                           
                         formulation is solved by column generation (line 1). Next, the reduced costs of all columns present in the final RMP are calculated using the values of the dual variables in the last iteration of the column generation algorithm (line 2). As these columns must have non-negative reduced costs, we then sort such columns in ascending order according to their reduced costs (line 3). The parameters min and max are initialized in line 4. In line 5, the parameter k is initialized. This parameter indicates that the kth first columns of the final RMP must be converted into variables of 
                           
                              ARC
                           
                        . At each iteration of the main loop (lines 6–16), the 
                           
                              ARC
                           
                         formulation is populated with only the z variables corresponding to the k columns with least positive reduced costs in the final RMP (line 7). The 
                           
                              ARC
                           
                         formulation run for up to five seconds (line 8). If a new feasible solution is obtained (line 9), we keep the solution if it improves the best found so far. If the branch-and-bound enumeration was not completed within the given five seconds (line 12), we finish the loop. Otherwise, we increase k by ten (line 15).

It may happen that some platform has no chosen z variable in the reduced 
                           
                              ARC
                           
                         formulation. If this is the case, the resulting MIP will be trivially infeasible and a larger value for k will be tried. When k is larger than the number of RMP columns with reduced cost zero, every platform will have at least one converted column.

The time limit used in line 8 has been chosen based on preliminary experiments where we observed that most best feasible solutions found by the algorithm were attained when solving a MIP exactly in less than five seconds. Thus, this time limit seems to give a good compromise between solution quality and runtime.
                           Algorithm 1
                           Column Generation based heuristic 
                                 
                                    
                                       
                                       
                                          
                                             1: Run column generation to solve linear relaxation of 
                                                   
                                                      DWM
                                                   
                                                
                                             
                                          
                                          
                                             2: Calculate the reduced cost of the columns using the dual variables of the last iteration
                                          
                                          
                                             3: Sort the columns according to their reduced costs
                                          
                                          
                                             4: 
                                                   
                                                      min
                                                      ←
                                                      30
                                                      ,
                                                      
                                                      max
                                                      ←
                                                      150
                                                   
                                                
                                             
                                          
                                          
                                             5: 
                                                   
                                                      k
                                                      ←
                                                      min
                                                   
                                                
                                             
                                          
                                          
                                             6: while 
                                                
                                                   
                                                      k
                                                      ⩽
                                                      max
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             7: Convert k columns of 
                                                   
                                                      DWM
                                                   
                                                 with least positive reduced costs into variables of 
                                                   
                                                      ARC
                                                   
                                                
                                             
                                          
                                          
                                             8: Run 
                                                   
                                                      ARC
                                                   
                                                 for up to five seconds
                                          
                                          
                                             9: 
                                                if feasible solution found then
                                             
                                          
                                          
                                             10: Keep the solution if the best found
                                          
                                          
                                             11: 
                                                end if
                                             
                                          
                                          
                                             12: 
                                                if enumeration incomplete within five seconds then
                                             
                                          
                                          
                                             13: Exit while
                                          
                                          
                                             14: 
                                                end if
                                             
                                          
                                          
                                             15: 
                                                
                                                   
                                                      k
                                                      ←
                                                      k
                                                      +
                                                      10
                                                   
                                                
                                             
                                          
                                          
                                             16: end while
                                             
                                          
                                       
                                    
                                 
                              
                           

In this section we show the results obtained by the described formulations using the instances proposed in Rocha et al. (2011) and a new set of harder instances. All the tests, including those for the formulation with the best performance proposed by Rocha et al. (2011) (HullRel), were run in a PC with an Intel Core 2 Quad Q8300 2.50gigahertz CPU, 2gigabytes RAM under Windows 7 OS using ILOG CPLEX 12.1. All instances have 9 platforms and 2 terminals, and are divided into 4 classes of 25 instances each with the following characteristics:
                        
                           •
                           only one lot size (easy);

one lot size per route (medium);

two lot sizes per route (hard);

five lot sizes per route and all platforms are allowed to send product to all terminals (harder new instances).

In this work, the results obtained for the first class of instances (easy) will not be reported, due to the fact that such instances are easily solved by 
                        
                           BF
                        
                      combined with a commercial solver. The results for each instance class are shown separately. The tables contain, for each formulation, the average results obtained. Among the results, two performance measures are shown, given by:
                        
                           (36)
                           
                              
                                 
                                    gap
                                 
                                 
                                    LB
                                 
                              
                              =
                              100
                              ×
                              
                                 
                                    
                                       
                                          UB
                                       
                                       
                                          b
                                       
                                    
                                    -
                                    
                                       
                                          LB
                                       
                                       
                                          f
                                       
                                    
                                 
                                 
                                    
                                       
                                          UB
                                       
                                       
                                          b
                                       
                                    
                                 
                              
                              ,
                           
                        
                     
                     
                        
                           (37)
                           
                              
                                 
                                    gap
                                 
                                 
                                    UB
                                 
                              
                              =
                              100
                              ×
                              
                                 
                                    
                                       
                                          UB
                                       
                                       
                                          f
                                       
                                    
                                    -
                                    
                                       
                                          UB
                                       
                                       
                                          b
                                       
                                    
                                 
                                 
                                    
                                       
                                          UB
                                       
                                       
                                          b
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           
                              
                                 UB
                              
                              
                                 b
                              
                           
                        
                      is the best integer feasible solution found among all formulations, 
                        
                           
                              
                                 LB
                              
                              
                                 f
                              
                           
                        
                      is the lower bound for a given formulation, and 
                        
                           
                              
                                 UB
                              
                              
                                 f
                              
                           
                        
                      is the best integer feasible solution found by a given formulation.

The results obtained for the medium and hard classes of instances are shown in Tables 2 and 3
                     
                     , respectively. In the tables, the column Formulation shows the formulations tested. The formulation 
                        
                           
                              
                                 ARC
                              
                              
                                 bin
                              
                           
                        
                      is the 
                        
                           ARC
                        
                      formulation with z variables as binaries, 
                        
                           
                              
                                 ARC
                              
                              
                                 cont
                              
                           
                        
                      is the 
                        
                           ARC
                        
                      formulation with z variables as continuous between 0 and 1 and 
                        
                           AC
                        
                      is the 
                        
                           ARC
                        
                      formulation without rounding the inventory. Column Time (seconds) shows the average execution time in seconds for each class of instances. For all tests performed, the maximum execution time allowed for each instance is 720seconds. Column 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      
                     
                        
                           
                              
                                 root
                              
                              
                                 lp
                              
                           
                        
                      (%) shows the average 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      at the root node before CPLEX cuts, calculated using the 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      of each instance given by (36) considering 
                        
                           
                              
                                 LB
                              
                              
                                 f
                              
                           
                        
                      as the lower bound at the root node before CPLEX cuts. Column 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      
                     root (%) shows the average 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      at the root node after CPLEX cuts, also calculated using the 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      of each instance given by (36) considering 
                        
                           
                              
                                 LB
                              
                              
                                 f
                              
                           
                        
                      as the lower bound at the root node after CPLEX cuts. Column 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      
                     final (%) contains the average 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      at the end of the execution time of each instance and it is also calculated by (36), where 
                        
                           
                              
                                 LB
                              
                              
                                 f
                              
                           
                        
                      is the lower bound at the end of the execution time of each instance. Column 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      
                     (%) shows the average 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      obtained at the end of executions and calculated by (37) for each instance. Column No. of nodes contains the average number of nodes solved at the branch-and-bound algorithm. Finally, column Inst. solved shows the number of instances of each class solved to optimality.

Concerning the 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      
                     
                        
                           
                              
                                 root
                              
                              
                                 lp
                              
                           
                        
                     , the results include the CPLEX preprocessing routines. If they were not used, 
                        
                           NF
                           ,
                           
                           KC
                        
                      and 
                        
                           AC
                        
                      (see Proposition 2.2) would provide the same relaxation at root node of the branch-and-bound tree, and the same would happen with 
                        
                           BF
                           ,
                           
                           RKC
                        
                      and 
                        
                           ARC
                        
                      (see Proposition 2.1). Indeed, for the medium and hard instance classes, the average values of the linear programming relaxation of the rounded formulations are 0.42 and 3.04, respectively, and for the formulations without rounding are 1.47 and 3.19. Without CPLEX preprocessing, 
                        
                           DWM
                        
                      would have the best 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      
                     
                        
                           
                              
                                 root
                              
                              
                                 lp
                              
                           
                        
                      for all instance classes. Yet, for the hard class of instances, 
                        
                           DWM
                        
                      found the best average 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      at the root node even when the CPLEX preprocessing routines and cuts are used for the other formulations.

In Tables 2 and 3 one can observe that the 
                        
                           NF
                        
                      and 
                        
                           BF
                        
                      have the worst performance in comparison with the others. The 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      of them is not shown because these formulations found few feasible solutions, so average value is not appropriate. The 
                        
                           BF
                        
                      was capable of solving only two instances to optimality, both of the medium class. This fact impacts in the average execution time for this formulation, which is close to the maximum allowed for each instance. For the hard class of instances, as this formulation was not able to solve any instance to optimality, the average time is exactly equal to the maximum allowed for each instance. The 
                        
                           NF
                        
                      did not solve any instance, so the average time is exactly 720 for both classes of instances. On the other hand, since these are more compact formulations with respect to the remaining ones in the sense that it has less nonzero coefficients in the matrix, a significantly larger number of nodes were solved at the branch-and-bound algorithm.

Comparing 
                        
                           KC
                        
                      with 
                        
                           RKC
                        
                      and 
                        
                           AC
                        
                      with 
                        
                           
                              
                                 ARC
                              
                              
                                 cont
                              
                           
                        
                     , the performance are similar. We can conclude that formulation 
                        
                           NF
                        
                      is dominated by 
                        
                           BF
                        
                      but the effect of the inventory rounding in 
                        
                           KC
                        
                      and 
                        
                           AC
                        
                      is not noticeable, even for GCD of lot sizes greater than one.

In comparison with 
                        
                           BF
                        
                     , the 
                        
                           RKC
                        
                      formulation achieved a better performance, being able to solve 13 out of 50 instances, where 11 instances belong to the medium class and 2 are hard instances. This occurs because in the 
                        
                           RKC
                        
                      formulation the constraints (10)–(13) are recognized by CPLEX as knapsack constraints (for (11) and (12) all binary variables are replaced with their complements to derive equivalent knapsack constraints). As a result, CPLEX is able to add specialized cuts, e.g. cover cuts. This effect can be observed by comparing the root lower bounds of 
                        
                           BF
                        
                      and 
                        
                           RKC
                        
                      in Tables 2 and 3.

The best performance was obtained by the 
                        
                           ARC
                        
                      formulation, outperforming the literature results reported in Rocha et al. (2011). This formulation was able to solve 24 instances of the medium class and 22 hard instances in a significantly small average execution time. For the 4 instances not solved by this formulation, it found 3 of the best known feasible solutions. For the 49 remaining instances, the 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      is equal to zero. Thus, the average 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      is equal to zero for the medium class of instances and close to zero for the hard instances.

The success of this formulation can be explained by three main reasons: (i) the number of nonzero coefficients in 
                        
                           ARC
                        
                      is much smaller than in 
                        
                           RKC
                        
                      (and comparable to that of 
                        
                           BF
                        
                     ) because each x variable in the constraints (21)–(24) replaces a sum of many z variables; (ii) as in the 
                        
                           RKC
                        
                     , CPLEX recognizes the constraints (21)–(24) as knapsack constraints; and (iii) the x variables are more suitable for branching. To explain the item (i), we observe that the number of nonzero coefficients of 
                        
                           NF
                           ,
                           
                           BF
                        
                      and 
                        
                           ARC
                        
                      is 
                        
                           O
                           (
                           |
                           P
                           ‖
                           T
                           ‖
                           C
                           |
                           D
                           )
                        
                      while for 
                        
                           KC
                        
                      and 
                        
                           RKC
                        
                      is 
                        
                           O
                           (
                           |
                           P
                           ‖
                           T
                           ‖
                           C
                           |
                           
                              
                                 D
                              
                              
                                 2
                              
                           
                           )
                        
                     . Table 4
                      compares the sizes of all formulations for an instance of the harder class. To explain the item (iii), we refer to Fig. 2
                     . The graph of Fig. 2(a) represents the z variables associated to one route for the whole time horizon: the arcs represent the variables, the first column of nodes represents the source platform and the second column of nodes represents the destination terminal. Now, assume that 
                        
                           
                              
                                 z
                              
                              
                                 15
                              
                           
                        
                      has a fractional value in a relaxed solution for the 
                        
                           RKC
                        
                      formulation. If 
                        
                           
                              
                                 z
                              
                              
                                 15
                              
                           
                        
                      is selected as a branching variable and forced to assume the value one, the relaxed solution will probably change significantly. However, when 
                        
                           
                              
                                 z
                              
                              
                                 15
                              
                           
                        
                      is forced to be zero, it is likely that the relaxation gives the same lower bound if there is sufficient slack in the inventories of both 
                        
                           
                              
                                 p
                              
                              
                                 1
                              
                           
                        
                      and 
                        
                           
                              
                                 t
                              
                              
                                 1
                              
                           
                        
                      to send the same amount of product one day latter, i.e. to set 
                        
                           
                              
                                 z
                              
                              
                                 16
                              
                           
                        
                      to the same value as 
                        
                           
                              
                                 z
                              
                              
                                 15
                              
                           
                        
                      had before branching. This observation is depicted in Fig. 2(b). This characteristic, when replicated in several parts of the solution, generates an undesirable symmetry that prevents finishing the branch-and-bound enumeration even in instances where the root gap is very small. As shown in Fig. 2(c), the use of x variables breaks this symmetry. Because of that, the 
                        
                           ARC
                        
                      formulation was tested in two ways: with the z variables as binaries (
                        
                           
                              
                                 ARC
                              
                              
                                 bin
                              
                           
                        
                     ), and with these variables as continuous between zero and one (
                        
                           
                              
                                 ARC
                              
                              
                                 cont
                              
                           
                        
                     ). Comparing both ways in Tables 2 and 3, one can see that the 
                        
                           
                              
                                 ARC
                              
                              
                                 cont
                              
                           
                        
                      formulation shows a slight improvement regarding the average 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      at the root node in medium and hard instances, and a little improvement concerning the average final 
                        
                           
                              
                                 gap
                              
                              
                                 LB
                              
                           
                        
                      in the hard instances. Thus, although the difference between the two assumptions for the z variables is not expressive, we consider that the 
                        
                           
                              
                                 ARC
                              
                              
                                 cont
                              
                           
                        
                      formulation obtained the best results for the instances of the medium and hard classes.

The results obtained for all formulation for the harder class of instances are shown in Table 5
                     . For this class of instances, we test the original 
                        
                           ARC
                        
                      and a modified version of this formulation. The modification consists of allowing both inventory shortages and maximum inventory capacities violations in the consumption sites, keeping the violation cost high enough to avoid changing the optimal solution. For this modification, we include two new sets of continuous variables:
                        
                           •
                           
                              
                                 
                                    
                                       
                                          viol
                                       
                                       
                                          t
                                          ,
                                          d
                                       
                                       
                                          max
                                       
                                    
                                 
                              : maximum capacity inventory violation at terminal t and day d,


                              
                                 
                                    
                                       
                                          viol
                                       
                                       
                                          t
                                          ,
                                          d
                                       
                                       
                                          min
                                       
                                    
                                 
                              : inventory shortage at terminal t and day d.

Let 
                        
                           
                              
                                 C
                              
                              
                                 viol
                              
                           
                        
                      be the cost of inventory violations. As we do not want to change the optimal solution, we use a large enough value. The new objective function will be as follows:
                        
                           (38)
                           
                              Min
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       ∈
                                       P
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       ∈
                                       T
                                       (
                                       p
                                       )
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       c
                                       ∈
                                       C
                                       (
                                       p
                                       )
                                    
                                 
                              
                              2
                              
                                 
                                    F
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    D
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                                 
                                    c
                                    ,
                                    D
                                 
                              
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       t
                                       ∈
                                       T
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       d
                                       =
                                       1
                                    
                                    
                                       D
                                    
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    viol
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             viol
                                          
                                          
                                             t
                                             ,
                                             d
                                          
                                          
                                             min
                                          
                                       
                                       +
                                       
                                          
                                             viol
                                          
                                          
                                             t
                                             ,
                                             d
                                          
                                          
                                             max
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

We also include the new variables 
                        
                           
                              
                                 viol
                              
                              
                                 t
                                 ,
                                 d
                              
                              
                                 max
                              
                           
                        
                      in the constraints (23) and 
                        
                           
                              
                                 viol
                              
                              
                                 t
                                 ,
                                 d
                              
                              
                                 min
                              
                           
                        
                      in the constraints (24), as follows:
                        
                           (39)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       ∈
                                       P
                                       (
                                       t
                                       )
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       c
                                       ∈
                                       C
                                       (
                                       p
                                       )
                                    
                                 
                              
                              
                                 
                                    V
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                                 
                                    c
                                    ,
                                    d
                                    -
                                    
                                       
                                          D
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                    
                                 
                              
                              -
                              
                                 
                                    viol
                                 
                                 
                                    t
                                    ,
                                    d
                                 
                                 
                                    max
                                 
                              
                              ⩽
                              
                                 
                                    k
                                 
                                 
                                    max
                                 
                              
                              (
                              t
                              ,
                              d
                              )
                              
                                 
                                    L
                                 
                                 
                                    t
                                 
                              
                              
                              
                              ∀
                              t
                              ∈
                              T
                              ,
                              
                              d
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              D
                              }
                           
                        
                     
                     
                        
                           (40)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       ∈
                                       P
                                       (
                                       t
                                       )
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       c
                                       ∈
                                       C
                                       (
                                       p
                                       )
                                    
                                 
                              
                              
                                 
                                    V
                                 
                                 
                                    c
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    p
                                    ,
                                    t
                                 
                                 
                                    c
                                    ,
                                    d
                                    -
                                    
                                       
                                          D
                                       
                                       
                                          p
                                          ,
                                          t
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    viol
                                 
                                 
                                    t
                                    ,
                                    d
                                 
                                 
                                    min
                                 
                              
                              ⩾
                              
                                 
                                    k
                                 
                                 
                                    min
                                 
                              
                              (
                              t
                              ,
                              d
                              )
                              
                                 
                                    L
                                 
                                 
                                    t
                                 
                              
                              
                              
                              ∀
                              t
                              ∈
                              T
                              ,
                              
                              d
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              D
                              }
                           
                        
                     
                  

For the harder class of instances, the GCD is always one. Rounding the inventory just drops the fractional part of the accumulating production or consumption. So, we show only the results of the rounding formulations. To find optimal or near optimal solutions for all instances of this class (to be used as the 
                        
                           
                              
                                 UB
                              
                              
                                 b
                              
                           
                        
                      value), we run each instance for many hours, using as initial feasible solution the best solution found in previous tests. Again the 
                        
                           ARC
                        
                      has the best performance. Comparing this formulation with and without violation, we can see a good improvement in the quality of the feasible solutions. This occurs because, when allowing violation, the number of feasible solutions increases, facilitating the CPLEX heuristic procedures to construct and improve feasible solutions. Only the knapsack cascading formulations find feasible solutions for all instances, but the average 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      of the 
                        
                           ARC
                        
                      is better because when this formulation finds a feasible solution for an instance, it usually improves the solution faster than the knapsack cascading formulations.

Concerning the 
                        
                           DWM
                        
                     , it obtained the best average root relaxation, even when the CPLEX preprocessing routines and cuts are considered for the other formulations. Without CPLEX preprocessing and cuts, the average value of the linear programming relaxation for all formulations is 8.82.

The results obtained for the column generation-based heuristic are shown in Table 6
                      for the harder class of instances. Column Feasible Found shows the number of instances where the heuristic finds a feasible solution, and column 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      (%) shows the average 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      for these solutions. We also test the heuristic including violation in the 
                        
                           ARC
                        
                     . Comparing the CGH with and without violation, we can see a good improvement when the violation is allowed. This occurs because the number of feasible solutions increases. The average 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      for both cases shows that, as expected, the heuristic finds good feasible solutions. For the instances where the heuristic finds feasible solutions, the 
                        
                           
                              
                                 gap
                              
                              
                                 UB
                              
                           
                        
                      of the 
                        
                           
                              
                                 ARC
                              
                              
                                 viol
                              
                           
                        
                      formulation is 0.69. Moreover, this formulation reaches feasibility for 6 out of the 9 instances where the heuristic fails to find feasible solutions. However, the average time to obtain a feasible solution in these cases is 245.9seconds. The average run time of both variants of the heuristic is low, with a minimum of 7seconds and a maximum of 16.78seconds.

One may think that, as the knapsack cascading formulation finds feasible solutions for all instances, the heuristic should be used with this formulation. But our tests show that the accumulated cascading formulation has a better performance. This happens because the heuristic decreases the variable set, so it is easier to find a feasible solution. Comparing both formulations, when 
                        
                           ARC
                        
                      finds a feasible solution, usually the solution is better than 
                        
                           RKC
                        
                     .

@&#CONCLUSIONS@&#

This work presented a modeling study for the oil transportation problem. Three classes of instances taken from the literature were used to test the formulations. Given the good results obtained, a new class was generated with harder instances.

Six formulations were devised: the Natural Formulation (
                        
                           NF
                        
                     ), the Basic Formulation (
                        
                           BF
                        
                     ), the Knapsack Cascading Formulation (
                        
                           KC
                        
                     ), the Rounded Knapsack Cascading Formulation (
                        
                           RKC
                        
                     ), the Accumulated Rounded Cascading Formulation (
                        
                           ARC
                        
                     ), and the Dantzig–Wolfe Master Formulation (
                        
                           DWM
                        
                     ). The first five formulations were tested with the CPLEX branch-and-cut algorithm, and the best results found used the 
                        
                           ARC
                        
                      formulation and its variants. Without the CPLEX cuts, the 
                        
                           DWM
                        
                      formulation achieved the best lower bounds, which motivated the development of a column generation-base heuristic.

In comparison with the results reported by Rocha et al. (2011), the results obtained in this work show a good improvement. This achievement is due only to a better understanding of the problem, incorporated in the mathematical formulation, reducing the computational effort.

Rounding the inventories improves the formulation only for 
                        
                           NF
                        
                     , not being noticeable when applied in 
                        
                           RKC
                        
                      and 
                        
                           ARC
                        
                     .

The harder class of instances has been used to evaluate the ability of the best formulations to find good feasible solutions when the optimality could not be proved. In this case, the 
                        
                           ARC
                        
                      formulation achieved the best performance when allowing inventory capacity violation in the demand sites, but keeping the violation cost high enough to ensure that the cost of the optimal solution will not change. The column generation-based heuristic used for the harder class of instances found good feasible solutions in a small computational time. We showed that it is also possible to improve the quality of the feasible solutions found by this heuristic allowing inventory capacity violations.

@&#REFERENCES@&#

