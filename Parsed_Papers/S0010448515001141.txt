@&#MAIN-TITLE@&#Generalizing bicubic splines for modeling and IGA with irregular layout

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Bi-3 tensor-product splines are complemented by bi-4 splines near irregular points.


                        
                        
                           
                           The vertices of the irregular quad mesh serve as spline-like control points.


                        
                        
                           
                           The resulting surfaces have a good distribution of highlight lines.


                        
                        
                           
                           The resulting surfaces have a increased smoothness and reproduction at irregular points.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Geometric continuity

Extraordinary point

Iso-geometric analysis

Guide surface

Biquartic

Spline surface

@&#ABSTRACT@&#


               
               
                  Quad meshes can be interpreted as tensor-product spline control meshes as long as they form a regular grid, locally. We present a new option for complementing bi-3 splines by bi-4 splines near irregularities in the mesh layout, where less or more than four quadrilaterals join. These new generalized surface and IGA (isogeometric analysis) elements have as their degrees of freedom the vertices of the irregular quad mesh. From a geometric design point of view, the new construction distinguishes itself from earlier work by a notably better distribution of highlight lines. From the IGA point of view, increased smoothness and reproduction at the irregular point yield fast convergence.
               
            

@&#INTRODUCTION@&#

A key task in extending tensor-product splines to more general control nets is building 
                        n
                     -sided multi-spline caps that smoothly glue together 
                        n
                      individual tensor-product splines. Such spline caps are central both for building geometrically smooth (
                        
                           
                              G
                           
                           
                              k
                           
                        
                     ) free-form surfaces with irregular points, where less or more than four tensor-product patches join together—and to define the physical domain and the analysis functions for iso-parametric  [1] or isogeometric analysis (IGA)  [2] in the presence of irregular points.

The contribution of this paper is a new 
                        
                           •
                           polynomial piecewise tensor-product cap construction of degree bi-4 that 
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                 
                               smoothly joins together bi-3 (bi-cubic) splines,

results in a good highlight line distribution, better for 
                                 n
                                 =
                                 3
                               and some higher 
                                 n
                               than the curvature continuous bi-7 caps of  [3] and

yields high-order convergent IGA elements, one per vertex of the input quad mesh, for solving higher-order partial differential equations, such as thin shell problems.

@&#RELATED WORK@&#

The literature offers a number of algorithms for complementing tensor-product splines. These range from Catmull–Clark surfaces  [4] to the sophisticated patch-based curvature continuous construction of degree bi-7  [3]. We compare our new construction to these canonical ones on a collection of challenging test data.

Older as well as most newer constructions of low polynomial degree, e.g.  [5–9], differ from the proposed construction in that they parametrically 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         extend the tensor-product patches into the cap. Recent progress in surface constructions  [10,11] has shown that, for low degree and few patches, immediate reparameterization of the boundary data is necessary to obtain good shape. We also include in the comparison  [12], an adaptation of Gregory’s construction  [13] that is formally rational of degree bi-3.

The new bi-4 construction also differs from the bi-4 constructions in  [6,7,9] in that it does not require solving equations for each new input to obtain the surface: evaluation and differentiation are explicit in terms of the vertices of the input quadrilateral (control-) net, a fact that comes in handy when constructing stiffness matrices for solving higher-order partial differential equations on manifolds. We compare the isogeometric elements based on the new construction in particular with the results in  [14].

The construction  [10] mentioned earlier shows that multi-sided holes in a bi-2 (bi-quadratic) spline complex can be smoothly filled using caps of 
                           n
                         spline patches that are of degree at most bi-4. However, the bi-2 degree of the underlying spline is crucial for the construction and  [10] cannot be applied to complete the more widely-used bi-cubic tensor-product spline complexes.

As a standard abstraction from the real-life complexity of blending trimmed surfaces, we consider a network of quadrilateral facets or quads that outline the final surface. Such a quad mesh might, for example, arise from Catmull–Clark subdivision. Interior mesh nodes where more or fewer than the regular number of four quads meet are called irregular nodes. They are 1–1 related to irregular points where three or more than four surface patches meet. We assume that each irregular node is surrounded by at least one layer of regular i.e. 4-valent nodes and apply one step of Catmull–Clark subdivision should this not be the case. A CC-net 
                     
                        
                           c
                        
                      is a submesh consisting of the irregular node and 
                        6
                        n
                      nodes that form two layers of quads surrounding it. (The second layer is allowed to have irregular nodes.) Fig. 1
                     (a) displays a CC-net and Fig. 1(c) displays an extended CC-net, i.e. CC-net plus one additional layer of quads. This additional layer is not used for the construction of the cap but provides a surface ring (green in Fig. 1(d)) surrounding the cap. This ring allows judging the transition from the spline complex into the cap, a transition that is as important as the internal quality of the cap itself. The nodes of a CC-net will act like the control points of a tensor-product spline.

A tensor-product patch 
                           
                              f
                           
                         of bi-degree 
                           d
                         is defined by its Bernstein–Bézier (BB) coefficients 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 i
                                 j
                              
                           
                         as 
                           
                              
                                 
                                    f
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 ≔
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       d
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       d
                                    
                                 
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                    
                                       d
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       B
                                    
                                    
                                       j
                                    
                                    
                                       d
                                    
                                 
                                 
                                    (
                                    v
                                    )
                                 
                                 ,
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 ∈
                                 □
                                 ≔
                                 
                                    
                                       
                                          [
                                          0
                                          .
                                          .
                                          1
                                          ]
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 B
                              
                              
                                 k
                              
                              
                                 d
                              
                           
                           
                              (
                              t
                              )
                           
                         is the 
                           k
                        th Bernstein–Bézier polynomial of degree 
                           d
                        . Since each 4×4 sub-grid of points of the network is interpreted as the B-spline control net of one bicubic piece of a tensor-product spline surface, the well-known formulas of a B-spline to Bernstein–Bézier (BB)-form conversion  [15,16] can be applied to the CC-net, except at the irregular node. This provides Hermite data in bi-degree 3 form (see Fig. 1(b), (d)) along the boundary of the cap. We refer to these Hermite data in the following as the tensor-border 
                        
                           
                              b
                           
                         (of depth 2 and degree 3). While our cap will only match the first derivatives defined by 
                           
                              b
                           
                         (after a change of variables), its second-order Hermite data will enter via samples of a bi-5 guide surface that propagates curvature from the boundary into the cap.

To explain the algorithmic steps, it will be convenient to capture position and derivatives at a corner point 
                           
                              s
                           
                         of a surface patch 
                           
                              f
                           
                        , 
                           
                              
                                 
                                    
                                       
                                          j
                                       
                                    
                                    
                                       
                                          s
                                       
                                       ,
                                       k
                                    
                                 
                                 
                                    f
                                 
                                 ≔
                                 
                                    
                                       
                                          [
                                          
                                             
                                                ∂
                                             
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                ∂
                                             
                                             
                                                v
                                             
                                             
                                                j
                                             
                                          
                                          
                                             f
                                          
                                          
                                          
                                             (
                                             
                                                s
                                             
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       i
                                       ,
                                       j
                                       ∈
                                       
                                          {
                                          0
                                          ,
                                          1
                                          ,
                                          …
                                          ,
                                          k
                                          }
                                       
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       ∂
                                    
                                    
                                       t
                                    
                                    
                                       l
                                    
                                 
                                 
                                    f
                                 
                                 ≔
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             l
                                          
                                       
                                       
                                          f
                                       
                                    
                                    
                                       
                                          
                                             
                                                (
                                                d
                                                t
                                                )
                                             
                                          
                                          
                                             l
                                          
                                       
                                    
                                 
                              
                           
                         in terms of its BB-coefficients 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 i
                                 j
                              
                           
                        . For 
                           k
                           ≤
                           d
                           +
                           1
                         and 
                           
                              s
                           
                           ≔
                           
                              f
                           
                           
                              (
                              0
                              ,
                              0
                              )
                           
                        , the 
                           k
                           ×
                           k
                         BB-sub-net 
                           
                              
                                 
                                    
                                       
                                          J
                                       
                                    
                                    
                                       
                                          s
                                       
                                       ,
                                       k
                                    
                                    
                                       d
                                    
                                 
                                 
                                    f
                                 
                                 ≔
                                 
                                    
                                       
                                          [
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       i
                                       ,
                                       j
                                       ∈
                                       
                                          {
                                          0
                                          ,
                                          1
                                          ,
                                          …
                                          ,
                                          k
                                          }
                                       
                                    
                                 
                              
                           
                         contains complete information about 
                           
                              
                                 
                                    j
                                 
                              
                              
                                 
                                    s
                                 
                                 ,
                                 k
                              
                           
                           
                              f
                           
                         at 
                           
                              s
                           
                        , expressed in BB-form of degree bi-
                           d
                        . For example, 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 00
                              
                           
                           ,
                           
                              
                                 
                                    f
                                 
                              
                              
                                 10
                              
                           
                           ,
                           
                              
                                 
                                    f
                                 
                              
                              
                                 01
                              
                           
                           ,
                           
                              
                                 
                                    f
                                 
                              
                              
                                 11
                              
                           
                         define 
                           
                              f
                           
                           
                              (
                              0
                              ,
                              0
                              )
                           
                           ,
                           
                              
                                 ∂
                              
                              
                                 u
                              
                           
                           
                              f
                           
                           
                              (
                              0
                              ,
                              0
                              )
                           
                           ,
                           
                              
                                 ∂
                              
                              
                                 v
                              
                           
                           
                              f
                           
                           
                              (
                              0
                              ,
                              0
                              )
                           
                         and 
                           
                              
                                 ∂
                              
                              
                                 u
                              
                           
                           
                              
                                 ∂
                              
                              
                                 v
                              
                           
                           
                              f
                           
                           
                              (
                              0
                              ,
                              0
                              )
                           
                        .

We enforce smoothness as matching of derivatives after change of variables where two surface pieces 
                           
                              f
                           
                         and 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 ̃
                              
                           
                         are glued together without overlap: 
                           
                              f
                           
                           
                              (
                              u
                              ,
                              0
                              )
                           
                           =
                           
                              
                                 
                                    f
                                 
                              
                              
                                 ̃
                              
                           
                           
                              (
                              u
                              ,
                              0
                              )
                           
                        . This yields the well-known 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         constraints 
                           
                              (1)
                              
                                 
                                    
                                       ∂
                                    
                                    
                                       v
                                    
                                 
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       ̃
                                    
                                 
                                 −
                                 a
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       ∂
                                    
                                    
                                       v
                                    
                                 
                                 
                                    f
                                 
                                 −
                                 b
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       ∂
                                    
                                    
                                       u
                                    
                                 
                                 
                                    f
                                 
                                 =
                                 0
                                 .
                              
                           
                        
                     

If the parameterization of a surface is as uniform as possible, i.e. the first fundamental form of a surface is close to the identity, then functionals such as 
                           
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          k
                                       
                                    
                                    f
                                    ≔
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          +
                                          j
                                          =
                                          k
                                          ,
                                          i
                                          ,
                                          j
                                          ≥
                                          0
                                       
                                    
                                    
                                       
                                          k
                                          !
                                       
                                       
                                          i
                                          !
                                          j
                                          !
                                       
                                    
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                
                                                
                                                   s
                                                
                                                
                                                   i
                                                
                                             
                                             f
                                             
                                                (
                                                s
                                                ,
                                                t
                                                )
                                             
                                             
                                                
                                                   ∂
                                                
                                                
                                                   t
                                                
                                                
                                                   j
                                                
                                             
                                             f
                                             
                                                (
                                                s
                                                ,
                                                t
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    d
                                    s
                                    d
                                    t
                                 
                              
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          k
                                       
                                       
                                          ∗
                                       
                                    
                                    f
                                    ≔
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                
                                                
                                                   s
                                                
                                                
                                                   k
                                                
                                             
                                             f
                                             
                                                (
                                                s
                                                ,
                                                t
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                
                                                
                                                   t
                                                
                                                
                                                   k
                                                
                                             
                                             f
                                             
                                                (
                                                s
                                                ,
                                                t
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    d
                                    s
                                    d
                                    t
                                 
                              
                           
                         that act on each coordinate of a surface independently, can be viewed as penalizing deviation from a surface of polynomial degree less than 
                           k
                        , see e.g.  [17–21,6], since polynomials of degree less than 
                           k
                         are annihilated by 
                           
                              
                                 F
                              
                              
                                 k
                              
                           
                         and polynomials of bi-degree less than 
                           k
                         are annihilated by 
                           
                              
                                 F
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                        .

Penalizing higher-order polynomial terms can be expected to reduce oscillations of the surface. Since our goal is to complete a bi-cubic (bi-3) patch complex by multi-sided caps and since the results of functionals in multi-sided configurations and for non-uniform parameterizations differ strongly from the regular case, it is natural to test and select functionals when the input is the control-net of the characteristic map 
                           χ
                         of Catmull–Clark subdivision  [22]. For these canonical boundary data, we searched the space with emphasis on the valencies 
                           n
                           =
                           5
                           ,
                           6
                        , first applying ‘pure’ functionals 
                           
                              
                                 F
                              
                              
                                 k
                              
                           
                         and 
                           
                              
                                 F
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           ,
                           k
                           =
                           2
                           ,
                           …
                           ,
                           4
                        , and then using linear combinations to optimize the uniformity of the layout of the BB-coefficients surrounding the irregular point. The best combination turned out to be 
                           
                              
                                 F
                              
                              
                                 2
                                 ,
                                 3
                              
                              
                                 3
                              
                           
                           ≔
                           
                              
                                 F
                              
                              
                                 2
                                 ,
                                 3
                              
                           
                           
                              (
                              
                                 
                                    
                                       J
                                    
                                 
                                 
                                    
                                       0
                                    
                                    ,
                                    3
                                 
                                 
                                    4
                                 
                              
                              
                                 f
                              
                              )
                           
                        , the restriction of the functional 
                           
                              
                                 F
                              
                              
                                 2
                                 ,
                                 3
                              
                           
                           ≔
                           
                              (
                              3
                              
                                 
                                    F
                                 
                                 
                                    2
                                 
                              
                              +
                              
                                 
                                    F
                                 
                                 
                                    3
                                 
                              
                              )
                           
                           /
                           4
                         to the 4×4 sub-net 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 
                                    0
                                 
                                 ,
                                 3
                              
                              
                                 4
                              
                           
                           
                              f
                           
                         of the BB-net of the bi-4 patch 
                           
                              f
                           
                        , interpreted as the BB-net of a bicubic patch (see the black 4×4 sub-nets in Fig. 2
                        ).

However, when working in 3-space and blending higher-order data from 
                           n
                           ≠
                           4
                        -sided neighborhood of an extraordinary point in a bi-cubic patch complex, the parameterization naturally changes towards that point. This change is all the more rapid when we keep the polynomial degree and the number of patches is low. This may explain why experiments consistently showed that, for setting degrees of freedom of our bi-4 surface cap in 3-space, even the best choice 
                           
                              
                                 F
                              
                              
                                 2
                                 ,
                                 3
                              
                              
                                 3
                              
                           
                         is ultimately worse than approximating a carefully crafted bi-5 guide cap 
                           
                              g
                           
                           [23] that exploits second-order data of the tensor-border 
                           
                              b
                           
                         for a gentle propagation of the curvature from the boundary into the cap. We will see evidence of this later in the paper, e.g. in Fig. 6(h), (i) and Fig. 8. Therefore 
                           
                              
                                 F
                              
                              
                                 2
                                 ,
                                 3
                              
                              
                                 3
                              
                           
                         will be used for reparameterizations whereas a guide surface will determine the geometric shape near the irregular point.

In deriving the construction, we first assure pairwise 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      connection of the 
                        n
                      patches into a cap, then connect the cap smoothly to the data, and finally optimize shape.

We consider two adjacent patches 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ̀
                              
                           
                           ≔
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                                 −
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ́
                              
                           
                           ≔
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                           ,
                           
                           k
                           =
                           0
                           ,
                           …
                           ,
                           n
                           −
                           1
                         (superscript modulo 
                           n
                        ) that join along their shared boundary curve 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ̀
                              
                           
                           
                              (
                              u
                              ,
                              0
                              )
                           
                           =
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ́
                              
                           
                           
                              (
                              u
                              ,
                              0
                              )
                           
                         (cf. Fig. 3
                        (a): locally, for two adjacent patches, it is convenient to index the coefficients symmetric with respect their shared curve rather than rotational symmetric with respect to the irregular point as is appropriate for the full cap in terms of 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                        ).

Symmetry of construction forces 
                           a
                           
                              (
                              u
                              )
                           
                           ≔
                           −
                           1
                        . Our choice of 
                           b
                           
                              (
                              u
                              )
                           
                         is 
                           
                              (2)
                              
                                 b
                                 
                                    (
                                    u
                                    )
                                 
                                 ≔
                                 2
                                 
                                    c
                                 
                                 
                                    (
                                    1
                                    −
                                    u
                                    )
                                 
                                 ,
                                 
                                 where  
                                 
                                    c
                                 
                                 ≔
                                 cos
                                 
                                    
                                       2
                                       π
                                    
                                    
                                       n
                                    
                                 
                                 .
                              
                           
                         Then (1) becomes 
                           
                              (
                                    
                                       
                                          G
                                       
                                       
                                          |
                                       
                                       
                                          1
                                       
                                    
                                 )
                              
                                 
                                    
                                       ∂
                                    
                                    
                                       v
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ̀
                                    
                                 
                                 +
                                 
                                    
                                       ∂
                                    
                                    
                                       v
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ́
                                    
                                 
                                 =
                                 2
                                 
                                    c
                                 
                                 
                                    (
                                    1
                                    −
                                    u
                                    )
                                 
                                 
                                    
                                       ∂
                                    
                                    
                                       u
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ́
                                    
                                 
                                 ,
                              
                           
                         and (
                              
                                 
                                    G
                                 
                                 
                                    |
                                 
                                 
                                    1
                                 
                              
                           ) is enforced between 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ̀
                              
                           
                         and 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ́
                              
                           
                         by setting the BB-coefficients (represented as unmarked points, hollow diamond and hollow square in Fig. 3(a)) to 
                           
                              
                                 (3)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ̀
                                             
                                          
                                       
                                       
                                          10
                                       
                                    
                                    ≔
                                    
                                       (
                                       1
                                       −
                                       
                                          
                                             1
                                          
                                          
                                             
                                                c
                                             
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ̀
                                             
                                          
                                       
                                       
                                          00
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      ̀
                                                   
                                                
                                             
                                             
                                                01
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      ́
                                                   
                                                
                                             
                                             
                                                01
                                             
                                          
                                       
                                       
                                          2
                                          
                                             c
                                          
                                       
                                    
                                    ;
                                 
                              
                              
                                 (4)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ̀
                                             
                                          
                                       
                                       
                                          20
                                       
                                    
                                    ≔
                                    
                                       
                                          
                                             (
                                             3
                                             
                                                c
                                             
                                             −
                                             4
                                             )
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      ̀
                                                   
                                                
                                             
                                             
                                                10
                                             
                                          
                                          +
                                          2
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         ̀
                                                      
                                                   
                                                
                                                
                                                   11
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         ́
                                                      
                                                   
                                                
                                                
                                                   11
                                                
                                             
                                             )
                                          
                                       
                                       
                                          3
                                          
                                             c
                                          
                                       
                                    
                                    ;
                                 
                              
                              
                                 (5)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ́
                                             
                                          
                                       
                                       
                                          21
                                       
                                    
                                    ≔
                                    
                                       (
                                       2
                                       −
                                       
                                          c
                                       
                                       )
                                    
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ̀
                                             
                                          
                                       
                                       
                                          20
                                       
                                    
                                    +
                                    
                                       c
                                    
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ̀
                                             
                                          
                                       
                                       
                                          30
                                       
                                    
                                    −
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ̀
                                             
                                          
                                       
                                       
                                          21
                                       
                                    
                                    ;
                                 
                              
                              
                                 (6)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ̀
                                             
                                          
                                       
                                       
                                          30
                                       
                                    
                                    ≔
                                    
                                       
                                          2
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         ̀
                                                      
                                                   
                                                
                                                
                                                   31
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         ́
                                                      
                                                   
                                                
                                                
                                                   31
                                                
                                             
                                             )
                                          
                                          −
                                          
                                             c
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      ̀
                                                   
                                                
                                             
                                             
                                                40
                                             
                                          
                                       
                                       
                                          4
                                          −
                                          
                                             c
                                          
                                       
                                    
                                    ;
                                 
                              
                              
                                 (7)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                ̀
                                             
                                          
                                       
                                       
                                          40
                                       
                                    
                                    ≔
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      ̀
                                                   
                                                
                                             
                                             
                                                41
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      ́
                                                   
                                                
                                             
                                             
                                                41
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    .
                                 
                              
                           
                         All the other BB-coefficients (marked as black disks and squares in Fig. 3(a)) remain unconstrained in this solution local to two adjacent patches. To obtain tangent continuity at the irregular point, we use (3) and re-express all but two of the tangent coefficients recursively as 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ́
                                    
                                 
                              
                              
                                 01
                              
                           
                           ≔
                           2
                           
                              (
                              1
                              −
                              
                                 c
                              
                              )
                           
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ̀
                                    
                                 
                              
                              
                                 00
                              
                           
                           +
                           2
                           
                              c
                           
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ̀
                                    
                                 
                              
                              
                                 10
                              
                           
                           −
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ̀
                                    
                                 
                              
                              
                                 01
                              
                           
                        .

Eq. (7) is due to the fact that the pieces of 
                           
                              b
                           
                         are smoothly connected splines. By contrast, (6) does not directly equate derivatives. The tensor-border 
                           
                              b
                           
                         of depth 1 (the green layers in Fig. 1(b)) needs to be reparameterized by a map 
                           β
                         in order to make these layers consistent with the 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                        -strip.

The reparameterization 
                           β
                           ≔
                           
                              (
                              u
                              +
                              b
                              
                                 (
                                 u
                                 )
                              
                              v
                              ,
                              a
                              
                                 (
                                 u
                                 )
                              
                              v
                              )
                           
                         (see Fig. 4
                        ) 
                           
                              (8)
                              
                                 a
                                 
                                    (
                                    u
                                    )
                                 
                                 ≔
                                 1
                                 −
                                 u
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       1
                                       −
                                       
                                          c
                                       
                                    
                                 
                                 u
                                 ,
                                 
                                 b
                                 
                                    (
                                    u
                                    )
                                 
                                 ≔
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       1
                                       −
                                       
                                          c
                                       
                                    
                                 
                                 
                                    (
                                    1
                                    −
                                    u
                                    )
                                 
                                 u
                                 .
                              
                           
                         is symmetric with respect to the diagonal 
                           u
                           =
                           v
                         and maps 
                           
                              
                                 β
                              
                              
                                 00
                              
                           
                         to 
                           
                              
                                 
                                    v
                                 
                              
                              
                                 k
                                 −
                                 1
                              
                           
                        . From (8) we get that the BB-coefficients 
                           
                              
                                 β
                              
                              
                                 i
                                 0
                              
                           
                           ,
                           
                           i
                           =
                           0
                           ,
                           1
                           ,
                           2
                        , of 
                           β
                         represent an identity map in degree-raised form and that 
                           
                              
                                 
                                    
                                       β
                                    
                                    
                                       11
                                    
                                 
                                 ≔
                                 
                                    (
                                    
                                       
                                          2
                                          −
                                          
                                             c
                                          
                                       
                                       
                                          4
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          2
                                          −
                                          
                                             c
                                          
                                       
                                       
                                          4
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 ,
                                 
                                 
                                    
                                       β
                                    
                                    
                                       21
                                    
                                 
                                 ≔
                                 
                                    (
                                    1
                                    ,
                                    
                                       
                                          1
                                       
                                       
                                          2
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         Since the boundary is the degree-raised input boundary, only the following formulas are required (cf.  Fig. 5
                        
                        ): 
                           
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          11
                                       
                                    
                                    ≔
                                    
                                       
                                          
                                             (
                                             1
                                             −
                                             7
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                00
                                             
                                          
                                          +
                                          3
                                          
                                             (
                                             
                                                
                                                   
                                                      b
                                                   
                                                
                                                
                                                   10
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      b
                                                   
                                                
                                                
                                                   01
                                                
                                             
                                             )
                                          
                                          +
                                          9
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                11
                                             
                                          
                                       
                                       
                                          16
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          21
                                       
                                    
                                    ≔
                                    
                                       
                                          
                                             (
                                             1
                                             −
                                             6
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                10
                                             
                                          
                                          +
                                          
                                             (
                                             1
                                             +
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                20
                                             
                                          
                                          +
                                          3
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                11
                                             
                                          
                                          +
                                          3
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                21
                                             
                                          
                                       
                                       
                                          8
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          31
                                       
                                    
                                    ≔
                                    
                                       
                                          
                                             (
                                             3
                                             −
                                             15
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                20
                                             
                                          
                                          +
                                          
                                             (
                                             1
                                             +
                                             2
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                30
                                             
                                          
                                          +
                                          9
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                21
                                             
                                          
                                          +
                                          3
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                31
                                             
                                          
                                       
                                       
                                          16
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          41
                                       
                                    
                                    ≔
                                    
                                       
                                          
                                             (
                                             1
                                             −
                                             4
                                             
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                30
                                             
                                          
                                          +
                                          3
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                31
                                             
                                          
                                       
                                       
                                          4
                                          
                                             (
                                             1
                                             −
                                             
                                                c
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                         where 
                           
                              
                                 
                                    b
                                 
                              
                              
                                 i
                                 j
                              
                           
                         are the BB-coefficients of input tensor-border 
                           
                              b
                           
                        .

The denominator term 
                           
                              (
                              1
                              −
                              
                                 c
                              
                              )
                           
                         in formula (8) hints at instability and distortion as the valence 
                           n
                         increases. Indeed, already for 
                           n
                           =
                           6
                        , Fig. 4(b) the reparameterization 
                           β
                         is quite non-uniform. Fig. 6(b), (d), (h) illustrate that bi-4 constructions that set the remaining 
                           2
                           +
                           3
                           n
                         coefficients by minimizing functionals, fail to yield good highlight lines, even when the irregular point is set to the central limit point of Catmull–Clark subdivision (if not, the results are worse). In particular, the standard functional 
                           
                              
                                 F
                              
                              
                                 2
                              
                              
                                 ∗
                              
                           
                         fares poorly.

We therefore stabilize the construction by approximating a reference surface. The cap construction 
                           
                              g
                           
                         of  [23] is 
                           
                              
                                 G
                              
                              
                                 2
                              
                           
                         at the irregular point and joins 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         with the tensor-border data, capturing also second-order data from the tensor-border. It generates consistently high-quality highlight lines. However, directly transferring jets of the bi-5 guide 
                           
                              g
                           
                         yields poor highlight lines: the bi-4 surface and the bi-5 reference surface must be carefully related. Let 
                           
                              
                                 σ
                              
                              
                                 4
                              
                           
                         be the map constructed in Section  2.3 (see Fig. 2(c)) and 
                           
                              
                                 σ
                              
                              
                                 5
                              
                           
                         the map constructed by  [23] when the characteristic map 
                           χ
                         of Catmull–Clark subdivision provides the tensor-border data. We generate an intermediate bi-4 patch 
                           
                              a
                           
                         from the jets at the corner points 
                           
                              s
                           
                         of the reparameterized construction 
                           
                              g
                           
                         (see Fig. 7
                        (c)) as
                           
                              (9)
                              
                                 
                                    
                                       
                                          J
                                       
                                    
                                    
                                       
                                          s
                                       
                                       ,
                                       2
                                    
                                    
                                       4
                                    
                                 
                                 
                                    a
                                 
                                 ≔
                                 
                                    
                                       
                                          J
                                       
                                    
                                    
                                       
                                          s
                                       
                                       ,
                                       2
                                    
                                    
                                       4
                                    
                                 
                                 
                                    (
                                    
                                       g
                                    
                                    ∘
                                    
                                       
                                          σ
                                       
                                       
                                          5
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    ∘
                                    
                                       
                                          σ
                                       
                                       
                                          4
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         Then, as indicated in Fig. 7(d), we average some coefficients that overlap. Let 
                           
                              q
                           
                         be the unique quadratic (expansion) at 
                           
                              s
                           
                           ≔
                           
                              
                                 
                                    p
                                 
                              
                              
                                 00
                              
                           
                        . Since the circled BB-coefficients of 
                           
                              g
                           
                         in Fig. 7(a) are part of 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 
                                    s
                                 
                                 ,
                                 2
                              
                              
                                 5
                              
                           
                           
                              (
                              
                                 q
                              
                              ∘
                              
                                 
                                    σ
                                 
                                 
                                    5
                                 
                              
                              )
                           
                        , 
                           
                              
                                 
                                    
                                       
                                          J
                                       
                                    
                                    
                                       
                                          s
                                       
                                       ,
                                       2
                                    
                                    
                                       4
                                    
                                 
                                 
                                    a
                                 
                                 =
                                 
                                    
                                       
                                          J
                                       
                                    
                                    
                                       
                                          s
                                       
                                       ,
                                       2
                                    
                                    
                                       4
                                    
                                 
                                 
                                    (
                                    
                                       (
                                       
                                          q
                                       
                                       ∘
                                       
                                          
                                             σ
                                          
                                          
                                             5
                                          
                                       
                                       )
                                    
                                    ∘
                                    
                                       
                                          σ
                                       
                                       
                                          5
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    ∘
                                    
                                       
                                          σ
                                       
                                       
                                          4
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          J
                                       
                                    
                                    
                                       
                                          s
                                       
                                       ,
                                       2
                                    
                                    
                                       4
                                    
                                 
                                 
                                    (
                                    
                                       q
                                    
                                    ∘
                                    
                                       
                                          σ
                                       
                                       
                                          4
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         That is, the coefficients marked as red disks in Fig. 7(d) stem from 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 
                                    s
                                 
                                 ,
                                 2
                              
                              
                                 4
                              
                           
                           
                              (
                              
                                 q
                              
                              ∘
                              
                                 
                                    σ
                                 
                                 
                                    4
                                 
                              
                              )
                           
                         and the bi-4 surface is curvature continuous at the irregular point! Since the BB-coefficients of 
                           
                              
                                 σ
                              
                              
                                 4
                              
                           
                         satisfy (3), (4) it is easy to check that so do the BB-coefficients of 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 
                                    s
                                 
                                 ,
                                 2
                              
                              
                                 4
                              
                           
                           
                              (
                              
                                 q
                              
                              ∘
                              
                                 
                                    σ
                                 
                                 
                                    4
                                 
                              
                              )
                           
                        . And since we retain the tensor-border (green disks in Fig. 7(d)) to guarantee the 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         join with the tensor-border, also (6) and (7) hold. Additionally enforcing (5) leaves unconstrained only the 
                           n
                         BB-coefficients 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ̀
                                    
                                 
                              
                              
                                 21
                              
                              
                                 k
                              
                           
                        . These points we fix by minimizing the sum of squared distances between coefficients of 
                           
                              a
                           
                         and 
                           
                              p
                           
                         (circled points in Fig. 3(b)): 
                           
                              (10)
                              
                                 
                                    
                                       min
                                    
                                    
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      ̀
                                                   
                                                
                                             
                                             
                                                21
                                             
                                             
                                                k
                                             
                                          
                                          }
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       0
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                i
                                                j
                                             
                                             
                                                k
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   a
                                                
                                             
                                             
                                                i
                                                j
                                             
                                             
                                                k
                                             
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                 i
                                 j
                                 ∈
                                 
                                    {
                                    12
                                    ,
                                    21
                                    }
                                 
                                 .
                              
                           
                         Now, thanks to referencing a high-quality, higher-degree surface, we obtain good bi-4 caps for 
                           n
                           =
                           6
                        , Fig. 8 and even for 
                           n
                           =
                           7
                        
                        Fig. 9
                        .

The construction via sampling a guide surface seems unduly cumbersome. However, due to the relatively short, explicit formulas (3)–(7) for the dependent BB-coefficients in terms of the independent BB-coefficients, most of the construction steps are simple and all are explicit and stable. The minimization (10) yields a linear system of size 
                           n
                           ×
                           n
                         that, since the guide is fixed, is solved for each unknown separately once and for all. For 5, 6, 7, we can therefore compute and tabulate the seven generating functions of the CC-net. The final surface cap is a linear combination of these tabulated generating functions, weighted by their CC-net points.

Specifically, since the algorithm works for each coordinate separately, it can be applied when all CC-net points 
                           
                              
                                 
                                    c
                                 
                              
                              
                                 m
                              
                           
                         have value 0, except for 
                           
                              
                                 
                                    c
                                 
                              
                              
                                 m
                              
                              
                                 0
                              
                           
                           =
                           1
                        , for one of 
                           m
                           =
                           1
                           ,
                           …
                           ,
                           7
                         (see Fig. 1(a)). This yields the scalar-valued bi-4 coefficients 
                           
                              
                                 
                                    
                                       h
                                    
                                    
                                       i
                                       j
                                    
                                    
                                       k
                                       ,
                                       m
                                    
                                 
                                 ∈
                                 R
                                 ,
                                 
                                 k
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 n
                                 −
                                 1
                                 ,
                                 
                                 m
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 7
                                 ,
                                 
                                 i
                                 ,
                                 j
                                 ∈
                                 
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    4
                                    }
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 h
                              
                              
                                 i
                                 j
                              
                              
                                 0
                                 ,
                                 7
                              
                           
                           =
                           ⋯
                           =
                           
                              
                                 h
                              
                              
                                 i
                                 j
                              
                              
                                 n
                                 −
                                 1
                                 ,
                                 7
                              
                           
                        . Then the BB-coefficients of the patch covering sector 
                           κ
                         are 
                           
                              (11)
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       i
                                       j
                                    
                                    
                                       κ
                                    
                                 
                                 ≔
                                 
                                    
                                       h
                                    
                                    
                                       i
                                       j
                                    
                                    
                                       0
                                       ,
                                       7
                                    
                                 
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       7
                                    
                                    
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       0
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       m
                                       =
                                       1
                                    
                                    
                                       6
                                    
                                 
                                 
                                    
                                       h
                                    
                                    
                                       i
                                       j
                                    
                                    
                                       k
                                       ,
                                       m
                                    
                                 
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       m
                                    
                                    
                                       κ
                                       −
                                       k
                                    
                                 
                                 ,
                              
                           
                         where the superscript of 
                           
                              
                                 
                                    c
                                 
                              
                              
                                 m
                              
                              
                                 κ
                                 −
                                 k
                              
                           
                         is interpreted modulo 
                           n
                        . Almost two thirds of the BB-coefficients of each patch is determined by the simple formulas of 
                           
                              b
                           
                           ∘
                           β
                         in Section  3.2. Only 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 
                                    0
                                 
                                 ,
                                 2
                              
                              
                                 4
                              
                           
                           
                              p
                           
                        , i.e. the 2×2 sub-nets at the irregular point, needs to be tabulated to construct a cap or to assemble IGA stiffness matrices.

To stress-test the construction, we concentrate on small CC-nets that challenge the constructions and reveal their flaws.


                        Fig. 9(c) shows that, even when 
                           n
                           =
                           7
                        , the highlight lines of the new bi-4 construction with curvature continuity at the irregular point are better distributed than those for the best functional 
                           
                              
                                 F
                              
                              
                                 2
                                 ,
                                 3
                              
                              
                                 3
                              
                           
                         that is everywhere only 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                        . By contrast, Fig. 10
                         shows failure of the standard functional 
                           
                              
                                 F
                              
                              
                                 2
                              
                              
                                 ∗
                              
                           
                         to generate satisfactory highlight lines already for 
                           n
                           =
                           5
                        .


                        Fig. 11
                         tests the convexity preservation of the bi-4 construction. Catmull–Clark subdivision, although 
                           
                              
                                 C
                              
                              
                                 2
                              
                           
                         everywhere apart the irregular point, shows poorer highlight lines than the new bi-4 construction. Typically Catmull–Clark subdivision does well across the border but pays the price near the irregular point: the surface oscillates in its vicinity. The effort of the new bi-4 construction in transitioning also yields better highlight lines than the Gregory patch construction  [12] (whose highlight lines at the irregular point are better distributed than those of Catmull–Clark subdivision). [12] allows quads to have more than one vertex is of valence 
                           n
                           ≠
                           4
                        , but typically to the detriment of shape.


                        Fig. 12
                         represents a design ensemble of basic primitive surfaces. The initial sketch Fig. 12(a) is re-approximated in (b) by a CC-net such that moving the primitives corresponds to moving blocks of B-spline control points. Even though the input is challenging, the mean curvature of the resulting 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         bi-4 surface is acceptable, e.g. without oscillations.

With the notation of Fig. 13
                     , we write (5) as 
                        
                           (12)
                           
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          ̀
                                       
                                    
                                 
                                 
                                    20
                                 
                              
                              ≔
                              
                                 
                                    2
                                 
                                 
                                    5
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ̀
                                          
                                       
                                    
                                    
                                       21
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ́
                                          
                                       
                                    
                                    
                                       21
                                    
                                 
                                 )
                              
                              +
                              
                                 
                                    1
                                 
                                 
                                    5
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          ̀
                                       
                                    
                                 
                                 
                                    30
                                 
                              
                              ,
                              
                              implying that   (4)   becomes
                              4
                              
                                 (
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ̀
                                          
                                       
                                    
                                    
                                       11
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ́
                                          
                                       
                                    
                                    
                                       11
                                    
                                 
                                 )
                              
                              −
                              11
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          ̀
                                       
                                    
                                 
                                 
                                    10
                                 
                              
                              +
                              3
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          ̀
                                       
                                    
                                 
                                 
                                    20
                                 
                              
                              =
                              0
                              .
                           
                        
                      The 3×3 system of linear equations of type (12) in the unknowns 
                        
                           
                              
                                 p
                              
                           
                           
                              11
                           
                           
                              k
                           
                        
                        ,
                        
                        k
                        =
                        0
                        ,
                        1
                        ,
                        2
                     , has a unique solution. With 
                        
                           
                              
                                 b
                              
                           
                           
                              i
                              j
                           
                        
                      the BB-coefficients of the input tensor-border 
                        
                           b
                        
                     , labeled as shown in Fig. 13(a), we derive, following the process laid out in  [23],


                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ̀
                                          
                                       
                                    
                                    
                                       21
                                    
                                 
                                 ≔
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       2
                                    
                                    
                                       3
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    
                                       
                                          b
                                       
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       22
                                    
                                 
                                 ≔
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    
                                       
                                          b
                                       
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       e
                                    
                                    
                                       20
                                    
                                 
                                 ≔
                                 
                                    
                                       13
                                    
                                    
                                       144
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       e
                                    
                                    
                                       30
                                    
                                 
                                 ≔
                                 −
                                 
                                    
                                       3
                                    
                                    
                                       40
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       e
                                    
                                    
                                       21
                                    
                                 
                                 ≔
                                 
                                    
                                       7
                                    
                                    
                                       12
                                    
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       e
                                    
                                    
                                       31
                                    
                                 
                                 ≔
                                 
                                    
                                       89
                                    
                                    
                                       720
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       e
                                    
                                    
                                       22
                                    
                                 
                                 ≔
                                 
                                    
                                       1
                                    
                                    
                                       6
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       e
                                    
                                    
                                       32
                                    
                                 
                                 ≔
                                 
                                    
                                       1
                                    
                                    
                                       9
                                    
                                 
                                 ;
                              
                           
                           
                              
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       00
                                    
                                 
                                 ≔
                                 
                                    
                                       7
                                    
                                    
                                       540
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       11
                                    
                                 
                                 ≔
                                 
                                    
                                       11
                                    
                                    
                                       18
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       22
                                    
                                 
                                 ≔
                                 
                                    
                                       1
                                    
                                    
                                       4
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       10
                                    
                                 
                                 ≔
                                 −
                                 
                                    
                                       4
                                    
                                    
                                       135
                                    
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       20
                                    
                                 
                                 ≔
                                 
                                    
                                       1
                                    
                                    
                                       108
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       21
                                    
                                 
                                 ≔
                                 
                                    
                                       1
                                    
                                    
                                       12
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       j
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             e
                                          
                                          
                                             ̇
                                          
                                       
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 .
                              
                           
                        
                      The BB-coefficient 
                        
                           
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    ́
                                 
                              
                           
                           
                              21
                           
                        
                      is defined symmetrically and the irregular point is defined as 
                        
                           
                              
                                 (
                                 1
                                 −
                                 3
                                 
                                    
                                       γ
                                    
                                    
                                       5
                                    
                                 
                                 −
                                 3
                                 
                                    
                                       γ
                                    
                                    
                                       6
                                    
                                 
                                 )
                              
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    7
                                 
                                 
                                    0
                                 
                              
                              +
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    0
                                 
                                 
                                    3
                                 
                              
                              
                                 (
                                 
                                    
                                       γ
                                    
                                    
                                       5
                                    
                                 
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       5
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 
                                    
                                       γ
                                    
                                    
                                       6
                                    
                                 
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       6
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              ,
                              
                              
                                 
                                    γ
                                 
                                 
                                    5
                                 
                              
                              ≔
                              
                                 
                                    5
                                 
                                 
                                    96
                                 
                              
                              ,
                              
                              
                                 
                                    γ
                                 
                                 
                                    6
                                 
                              
                              ≔
                              
                                 
                                    1
                                 
                                 
                                    6
                                 
                              
                              .
                           
                        
                      (the choice of such weights has been detailed in  [23]). The remaining two free points (black disks in Fig. 13(b)) are fixed by minimizing 
                        
                           
                              ∑
                           
                           
                              k
                              =
                              0
                           
                           
                              2
                           
                        
                        
                           
                              F
                           
                           
                              4
                           
                        
                        
                           
                              
                                 p
                              
                           
                           
                              k
                           
                        
                     .


                     Fig. 14
                      shows this solution to be of high quality, better than the 
                        
                           
                              G
                           
                           
                              2
                           
                        
                      scheme of degree bi-7 in  [3]: for 
                        n
                        =
                        3
                     , higher continuity everywhere does not seem necessary for good highlight lines or curvature distribution (the new cap is curvature continuous at the irregular point).

In practice, valences 
                        n
                        >
                        7
                      are uncommon and usually a construction for 
                        n
                        ∈
                        
                           {
                           3
                           ,
                           4
                           ,
                           5
                           ,
                           6
                           }
                        
                      suffices. For 
                        n
                        =
                        7
                     , the BB-net of the new bi-4 cap starts to be very non-uniformly distributed and for configurations such as Fig. 9(a), the surface quality deteriorates after one Catmull–Clark step. This is unusual since a single refinement step is typically beneficial as it softens transitions. Since we do not want to rule out valencies 
                        n
                        >
                        7
                     , we briefly develop 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      caps of good quality, consisting from 2×2 bi-4 macro-patches; and we also sketch an alternative construction that is ‘almost’ 
                        
                           
                              G
                           
                           
                              1
                           
                        
                     .

The 2×2 macro-patch construction, illustrated in Fig. 15
                        (a), (b), transitions 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         across the tensor-border 
                           
                              b
                           
                        . That is, the data are reparameterized immediately—as opposed to more classical constructions that connect 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         to the tensor-border data and 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         to innermost subpatches (see Fig. 15(c)). For low degree constructions such 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         prolongations are known to result in considerably poorer quality despite formally an equal set of degrees of freedom (the degrees of freedom can be counted in Fig. 15(b) vs. Fig. 15(c)).

We ensure 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         continuity between the central sub-patches 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ̀
                              
                           
                         and 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ́
                              
                           
                         by enforcing 
                           
                              (13)
                              
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ̀
                                          
                                       
                                    
                                    
                                       v
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ́
                                          
                                       
                                    
                                    
                                       v
                                    
                                 
                                 =
                                 
                                    (
                                    2
                                    
                                       (
                                       1
                                       −
                                       u
                                       )
                                    
                                    +
                                    γ
                                    u
                                    )
                                 
                                 
                                    c
                                 
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             ̀
                                          
                                       
                                    
                                    
                                       u
                                    
                                 
                                 ,
                                 
                                 
                                    c
                                 
                                 ≔
                                 cos
                                 
                                    
                                       2
                                       π
                                    
                                    
                                       n
                                    
                                 
                                 ,
                              
                           
                         and between border sub-patches 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ̀
                                    
                                 
                              
                              ¯
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ́
                                    
                                 
                              
                              ¯
                           
                         by enforcing 
                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   ̀
                                                
                                             
                                          
                                          ¯
                                       
                                    
                                    
                                       v
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   ́
                                                
                                             
                                          
                                          ¯
                                       
                                    
                                    
                                       v
                                    
                                 
                                 =
                                 γ
                                 
                                    (
                                    1
                                    −
                                    u
                                    )
                                 
                                 
                                    c
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   ̀
                                                
                                             
                                          
                                          ¯
                                       
                                    
                                    
                                       u
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       γ
                                    
                                    
                                       d
                                       e
                                       f
                                    
                                 
                                 ≔
                                 1.13
                                 −
                                 0.9
                                 
                                    c
                                 
                                 +
                                 0.36
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where the coefficients underlaid in gray in Fig. 15(b) are determined by 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                        -extension of 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ̀
                              
                           
                         and 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 ́
                              
                           
                        . The BB-coefficients unconstrained after enforcing the 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         constraints are marked as the black disks and black quads in Fig. 15(b). The part of the control net of the sub-patches 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ̀
                                    
                                 
                              
                              ¯
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       ́
                                    
                                 
                              
                              ¯
                           
                         rendered green in Fig. 15(a) matches the reparameterized and subsequently split tensor-border 
                           
                              b
                           
                        . The border reparameterization with functions 
                           
                              (15)
                              
                                 a
                                 
                                    (
                                    u
                                    )
                                 
                                 ≔
                                 
                                    
                                       1
                                       −
                                       γ
                                       
                                          c
                                       
                                       
                                          (
                                          1
                                          −
                                          u
                                          )
                                       
                                    
                                    
                                       1
                                       −
                                       γ
                                       
                                          c
                                       
                                    
                                 
                                 ,
                                 
                                 b
                                 
                                    (
                                    u
                                    )
                                 
                                 ≔
                                 
                                    
                                       γ
                                       
                                          c
                                       
                                       
                                          (
                                          1
                                          −
                                          u
                                          )
                                       
                                       u
                                    
                                    
                                       1
                                       −
                                       γ
                                       
                                          c
                                       
                                    
                                 
                                 ,
                              
                           
                         generalizes (8). (In (8), 
                           γ
                           ≔
                           1
                        .) Our choice 
                           
                              
                                 γ
                              
                              
                                 d
                                 e
                                 f
                              
                           
                         prevents the high distortion of reparameterized tensor-border 
                           
                              b
                           
                        , that limited the single-patch bi-4 construction to 
                           n
                           ≤
                           7
                        .

To set the remaining degrees of freedom is non-trivial: functionals failed even more egregiously than in the single-patch case. Numerous experiments confirm as a good strategy to reduce to degree 3 some layers of the bi-4 macro patches, by applying the constraint pattern 
                           
                              (16)
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ≔
                                 
                                    
                                       2
                                    
                                    
                                       3
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          3
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    
                                       1
                                    
                                    
                                       6
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          0
                                       
                                    
                                    +
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          4
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         For example, in Fig. 15(b), two circled markers are set by (16) implying that the third also satisfies (16). The remaining construction is analogous, but more complex than that of Section  3: the details of inheriting data from the guide map via a careful reparameterization are explained in the Appendix.


                        Figs. 16 and 17
                        
                         give an impression of the good highlight line distribution of the resulting 2×2 cap of degree bi-4. The data of Fig. 16(d) in particular, rule out fitting the neighborhood of the irregular point with a single polynomial of low degree as would be needed to deploy the low-degree (bi-6) versions of  [25–27].

As a structurally simpler alternative to the 2×2 construction, we sketch almost-
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         bi-4 caps with the same layout of 
                           n
                         patches as the main construction of Section  3. Here almost refers to small discontinuities of the normal across the tensor-border. Whereas deriving surfaces by leaving out smoothness constraints typically yields poor highlight lines, our almost-
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         caps are based on  [23]. The jets 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 
                                    s
                                 
                                 ,
                                 2
                              
                              
                                 5
                              
                           
                           
                              f
                           
                         of the construction  [23] (see Fig. 18
                        (a)) are converted to 
                           
                              
                                 
                                    J
                                 
                              
                              
                                 
                                    s
                                 
                                 ,
                                 2
                              
                              
                                 4
                              
                           
                           
                              f
                           
                         and averaged at some overlapping locations as shown in Fig. 18(b), yielding an auxiliary bi-4 cap 
                           
                              a
                           
                        . Arguments as in Section  3 show 
                           
                              a
                           
                         to be curvature continuous at the irregular point and prove that the bi-4 cap 
                           
                              a
                           
                         satisfies the 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         constraints (3), (4), (6), (7), but not necessarily (5).

The remaining BB-coefficients are fixed by minimizing (10). Given  [23], the derivation of the generating functions is considerably simpler than those of the 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                           
                           2
                           ×
                           2
                         cap. At runtime, working with the tabulated generating functions, there is little difference in the complexity.

The almost 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         bi-4 cap is internally 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                        -connected but formally only 
                           
                              
                                 G
                              
                              
                                 0
                              
                           
                        -connected to the degree 3 tensor-border. Experiments consistently show a deviation of the normal of less than 0.1° (see Fig. 19
                        ) so that the surfaces look smooth by industrial standards  [28]. Some challenging high-valence configurations violate the 0.1° bound and this is visible under scrutiny, e.g. in Fig. 20
                        (e). One Catmull–Clark refinement step typically enforces the angle bound so that the surface looks 
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                         with good highlight line distribution, even under magnification.

Analogous to the geometric obstacle course (see  [29] for data), we now test the new construction on a finite element obstacle course. That is, we test the new bi-4 construction as generalized IGA element on a set of standard problems: Poisson’s equation on the disk and Koiter’s thin-shell analysis a part of the shell obstacle course. Here both the physical domain 
                        X
                      and the analysis functions 
                        
                           
                              u
                           
                           
                              k
                           
                        
                      (e.g. measuring displacement) are represented as a linear combination of the 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      generating functions 
                        
                           
                              h
                           
                           
                              k
                              ,
                              m
                           
                        
                      of (11). We form 
                        N
                      generalized IGA elements 
                        
                           
                              u
                           
                           
                              k
                           
                        
                        ∘
                        
                           
                              
                                 x
                              
                           
                           
                              k
                           
                           
                              −
                              1
                           
                        
                        :
                        X
                        →
                        R
                        ,
                        k
                        =
                        1
                        ,
                        …
                        ,
                        N
                     , where 
                        N
                      is the number of CC-net control points 
                        
                           
                              
                                 c
                              
                           
                           
                              k
                           
                        
                      and the physical domain manifold 
                        X
                      is assembled as a superposition of maps 
                        
                           
                              
                                 x
                              
                           
                           
                              k
                           
                        
                      that are generating functions weighted by 
                        
                           
                              
                                 c
                              
                           
                           
                              k
                           
                        
                     . Since both 
                        
                           
                              u
                           
                           
                              k
                           
                        
                      and 
                        
                           
                              
                                 x
                              
                           
                           
                              k
                           
                        
                      are 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      with the same reparameterization, 
                        
                           
                              C
                           
                           
                              1
                           
                        
                      continuity of the generalized IGA elements across irregular points is guaranteed according to  [30].

Since the exact solution of Poisson’s Equation 
                        
                           (17)
                           
                              find  
                              u
                              :
                              X
                              →
                              R
                              :
                              
                                 {
                                 
                                    
                                       
                                          −
                                          
                                             Δ
                                          
                                          u
                                          =
                                          f
                                       
                                       
                                          in  
                                          X
                                          ,
                                       
                                    
                                    
                                       
                                          u
                                          =
                                          0
                                       
                                       
                                          on  
                                          ∂
                                          Ω
                                          ,
                                       
                                    
                                 
                              
                           
                        
                      is well-known, we can plot the error in the finite element approximations for various refinements of the input mesh (see Fig. 21
                      for two valences; the circular boundary is captured exactly as a rational quadratic). For the input mesh Fig. 21(a), the graphs Fig. 22
                      compare the error convergence of the generalized IGA element built from the single-patch-per-quad bi-4 construction of this paper, the bi-5 elements of  [14] and an element built from  [10] (see also Table 1
                     ). As expected, the increased degree of the bi-5 elements yields a lower error and the lower degree of the elements from  [10] a higher error than our new bi-4 elements. The 
                        
                           
                              L
                           
                           
                              2
                           
                        
                      convergence rate however, is comparable. In the same graph, but for the input mesh of valence 
                        n
                        =
                        7
                      of Fig. 21(b), we compare the single patch bi-4 construction to the 2×2 bi-4 construction. Again the more complex construction has a slightly lower overall error. In all cases the 
                        
                           
                              L
                           
                           
                              2
                           
                        
                      convergence is slightly higher than 
                        O
                        
                           (
                           
                              
                                 h
                              
                              
                                 3
                              
                           
                           )
                        
                      and the 
                        
                           
                              L
                           
                           
                              ∞
                           
                        
                      convergence is slightly higher than 
                        O
                        
                           (
                           
                              
                                 h
                              
                              
                                 2
                              
                           
                           )
                        
                      ([10] actually achieves a rate of 
                        O
                        
                           (
                           
                              
                                 h
                              
                              
                                 3
                              
                           
                           )
                        
                      but its 
                        
                           
                              L
                           
                           
                              ∞
                           
                        
                      error is higher overall). The 
                        
                           
                              L
                           
                           
                              ∞
                           
                        
                      error distribution at the first refinement is shown in Fig. 21(c), (d) and, again in Fig. 21(e), (f). Unsurprisingly, the error is maximal at the irregular points.

Next, we analyze two instances of Koiter’s shell model  [31] based on Kirchhoff–Love assumptions that lines normal to the ‘middle surface’ in the original configuration 
                        
                           
                              
                                 x
                              
                           
                           
                              ̄
                           
                        
                      remain normal to the middle surface in the deformed configuration 
                        
                           x
                        
                     , and that there is no transverse shear strain and stress. The displacement vector field 
                        
                           u
                        
                        
                           (
                           
                              
                                 θ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 θ
                              
                              
                                 2
                              
                           
                           )
                        
                        =
                        
                           x
                        
                        
                           (
                           
                              
                                 θ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 θ
                              
                              
                                 2
                              
                           
                           )
                        
                        −
                        
                           
                              
                                 x
                              
                           
                           
                              ̄
                           
                        
                        
                           (
                           
                              
                                 θ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 θ
                              
                              
                                 2
                              
                           
                           )
                        
                      of the thin shell is found by minimizing the total potential energy function 
                        
                           (18)
                           
                              Π
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                              =
                              
                                 
                                    ∫
                                 
                                 
                                    Ω
                                 
                              
                              
                                 (
                                 
                                    
                                       E
                                       h
                                    
                                    
                                       1
                                       −
                                       
                                          
                                             ν
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       α
                                    
                                    
                                       T
                                    
                                 
                                 
                                    H
                                 
                                 α
                                 +
                                 
                                    
                                       E
                                       
                                          
                                             h
                                          
                                          
                                             3
                                          
                                       
                                    
                                    
                                       12
                                       
                                          (
                                          1
                                          −
                                          
                                             
                                                ν
                                             
                                             
                                                2
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       β
                                    
                                    
                                       T
                                    
                                 
                                 
                                    H
                                 
                                 β
                                 )
                              
                              d
                              Ω
                              −
                              
                                 
                                    ∫
                                 
                                 
                                    Ω
                                 
                              
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 b
                              
                              d
                              Ω
                              −
                              
                                 
                                    ∫
                                 
                                 
                                    
                                       
                                          Γ
                                       
                                       
                                          t
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 t
                              
                              d
                              Γ
                              ,
                           
                        
                      where 
                        
                           b
                        
                      is the body force, 
                        
                           t
                        
                      is the traction on some parts 
                        
                           
                              Γ
                           
                           
                              t
                           
                        
                      of the shell, 
                        
                           
                              α
                           
                           
                              i
                              j
                           
                        
                        +
                        
                           
                              θ
                           
                           
                              3
                           
                        
                        
                           
                              β
                           
                           
                              i
                              j
                           
                        
                      is the Green–Lagrange strain tensor, 
                        
                           H
                        
                      is a 3×3 matrix incorporating the metric, and 
                        E
                      and 
                        ν
                      are the Young modulus and Poisson’s ratio, respectively.

Both the sphere-under-load and the Scordelis–Lo roof benchmark problem of the shell obstacle course  [32] are modeled as 
                        
                           (
                           a
                           
                              (
                              x
                              ,
                              y
                              )
                           
                           ,
                           b
                           
                              (
                              x
                              ,
                              y
                              )
                           
                           ,
                           c
                           
                              (
                              x
                              ,
                              y
                              )
                           
                           )
                        
                      where the map 
                        
                           (
                           x
                           ,
                           y
                           )
                        
                        :
                        
                           
                              R
                           
                           
                              2
                           
                        
                        →
                        
                           
                              R
                           
                           
                              2
                           
                        
                      is constructed by our algorithm while the maps 
                        a
                        ,
                        b
                        ,
                        c
                        :
                        
                           
                              R
                           
                           
                              2
                           
                        
                        →
                        R
                      are analytical functions.


                     Fig. 23
                      shows the result for one octant of the sphere under the axis-aligned loads at two corner points. The displacement along one axis is color-coded in Fig. 23(b). Fig. 23(c) compares the convergence of the new bi-4 scheme to two other generalized IGA elements, built from  [10] and from  [14].

For the Scordelis–Lo roof, we intentionally chose an irregular quad mesh for approximation as shown in Fig. 24
                     (a). The error is measured by tracking the maximum displacement of the midpoint on the edge aligned with the cylinder’s axis. We see that, despite the irregular layout, the value of this fourth-order differential equation converges to the benchmark value. In Fig. 24(c), the results of the analysis are compared to  [10,14], showing rapid convergence in all cases.

@&#DISCUSSION AND CONCLUSION@&#

We presented a surface cap construction of degree bi-4 that improves on the state of the art for layouts that include irregular points. The improvement has been validated as a good distribution of highlight lines on a collection of challenging test data and by using the caps for IGA computations. Remarkably both the exact 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      bi-4 construction (for 
                        n
                        <
                        8
                     ), and the 2×2 macro-patch bi-4 construction for higher valences yield highlight lines on par with more sophisticated exact 
                        
                           
                              G
                           
                           
                              2
                           
                        
                      constructions. The constructions display better highlight lines than the existing algorithms of equal or lower degree. A complex guiding surface construction is baked into the formulas of the new bi-4 construction, thereby transferring the guide’s good shape and approximation properties to the central point of the cap. The final formulas express the surface in terms of the B-spline-like quadrilateral control net with one generating function associated with each vertex of the control net.

The purely polynomial setup, of degree bi-4 means that evaluation and differentiation are cheap and generalized IGA is relatively easy to implement. It is convenient that the (isogeometric analysis) elements have as their degrees of freedom the vertices of the irregular quad mesh. As expected, the 
                        
                           
                              L
                           
                           
                              2
                           
                        
                      convergence rates are higher than those of linear elements. The rates are around 9–10 for Poisson’s equation on the disk, i.e. do not reach 24, the rate of Poisson’s equation on the square without irregular points.

@&#ACKNOWLEDGMENTS@&#

The work was supported in part by NSF Grant CCF-1117695. Charles Loop kindly provided the generating functions for the comparisons with  [3].

The symmetric planar map 
                        
                           
                              σ
                           
                           
                              4
                           
                        
                      consists now of 2×2 pieces and we may focus on one sector. We name 
                        
                           
                              σ
                           
                           
                              4
                           
                           
                              o
                           
                        
                      the piece touching the central point 
                        
                           0
                        
                      (see Fig. 25
                     ). We choose the border from 
                        χ
                     , the characteristic map of Catmull–Clark subdivision, extend the data by reparameterization and splitting to define the BB-net rendered in green in Fig. 25(c), (d), and resolve the 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      constraints symbolically. To make the control net as uniform as possible, we set additionally 
                        
                           
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    ̀
                                 
                              
                           
                           
                              20
                           
                        
                        ≔
                        2
                        
                           
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    ̀
                                 
                              
                           
                           
                              10
                           
                        
                      (where 
                        
                           
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    ̀
                                 
                              
                           
                           
                              00
                           
                        
                        ≔
                        
                           0
                        
                     ). This leaves five free parameters. The BB-coefficients of 
                        
                           
                              
                                 J
                              
                           
                           
                              
                                 s
                              
                              ,
                              1
                           
                           
                              4
                           
                        
                        
                           
                              σ
                           
                           
                              4
                           
                           
                              o
                           
                        
                     , where 
                        
                           s
                        
                      is the point common to the four subpatches provides another four free parameters. Applying the degree reduction (16), determines the BB-coefficients marked 
                        ∘
                        |
                        ,
                        
                           
                              ∘
                           
                           ¯
                        
                      and 
                        ×
                      (as the average of rules 
                        ∘
                        |
                      and 
                        
                           
                              ∘
                           
                           ¯
                        
                     ) in Fig. 25(c). The BB-net underlaid in gray is obtained by 
                        
                           
                              C
                           
                           
                              1
                           
                        
                      extension of 
                        
                           
                              σ
                           
                           
                              4
                           
                           
                              o
                           
                        
                     . This leaves 
                        γ
                      in (14) as the final tenth free parameter. Having eliminated dependent BB-coefficients symbolically so far, we set the ten parameters by minimizing numerically the functional 
                        
                           
                              F
                           
                           
                              2
                              ,
                              3
                           
                        
                      over all four sub-patches of 
                        
                           
                              σ
                           
                           
                              4
                           
                        
                     . In particular, this yields the formula for 
                        
                           
                              γ
                           
                           
                              d
                              e
                              f
                           
                        
                      in (14).

We calculate numerically 
                        
                           
                              σ
                           
                           
                              5
                           
                           
                              −
                              1
                           
                        
                        ∘
                        
                           
                              σ
                           
                           
                              ̃
                           
                        
                     , where 
                        
                           
                              σ
                           
                           
                              ̃
                           
                        
                        ≔
                        
                           
                              λ
                           
                           
                              −
                              1
                           
                        
                        
                           
                              σ
                           
                           
                              4
                           
                           
                              o
                           
                        
                      (see Fig. 25(a)), and 
                        λ
                      is the subdominant eigenvalue of Catmull–Clark subdivision. (Experiments show that if we set 
                        
                           
                              σ
                           
                           
                              ̃
                           
                        
                        ≔
                        
                           
                              σ
                           
                           
                              o
                           
                        
                      without the virtual Catmull–Clark step when applying the bi-5 guide, the shape is worse.) An intermediate bi-4 2×2 macro-patch 
                        
                           a
                        
                      is constructed as follows. We apply one Catmull–Clark subdivision step to the initial CC-net and sample the bi-5 guide surface 
                        
                           g
                        
                      using 
                        
                           
                              σ
                           
                           
                              5
                           
                           
                              −
                              1
                           
                        
                        ∘
                        
                           
                              σ
                           
                           
                              ̃
                           
                        
                     . The samples 
                        
                           
                              
                                 J
                              
                           
                           
                              
                                 s
                              
                              ,
                              2
                           
                           
                              4
                           
                        
                        
                           (
                           
                              g
                           
                           ∘
                           
                              
                                 σ
                              
                              
                                 5
                              
                              
                                 −
                                 1
                              
                           
                           ∘
                           
                              
                                 σ
                              
                              
                                 ̃
                              
                           
                           )
                        
                      are averaged at some overlapping locations as indicated in Fig. 25(b) to yield the central bi-4 patch 
                        
                           
                              
                                 a
                              
                           
                           
                              o
                           
                        
                     . Applying the strategy illustrated in Fig. 25(c) (including first the correction of the sampled patch 
                        
                           
                              
                                 a
                              
                           
                           
                              ∘
                           
                        
                      via the degree-reduction operations 
                        ∘
                        |
                     , 
                        
                           
                              ∘
                           
                           ¯
                        
                      and 
                        ×
                     ) yields the full macro-patch 
                        
                           a
                        
                     .

As in Section  3, the quadratic expansion at the central point 
                        
                           0
                        
                     , reparameterized by 
                        
                           
                              σ
                           
                           
                              4
                           
                           
                              k
                              ,
                              o
                           
                        
                     , is expressed in terms of the BB-coefficients (red disks in Fig. 5) closest to the irregular point. This leaves as degrees of freedom in the 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      strips the BB-net indicated by black disks in Fig. 25(d). The remaining BB-coefficients are pinned down by the 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      constraints and the degree reduction (16). The BB-net marked by black diamonds are free to choose, while the gray underlay indicates that we choose a 
                        
                           
                              C
                           
                           
                              2
                           
                        
                      extension to the adjacent subpatches. Overall this leaves 
                        13
                        n
                      free points. These are fixed by minimizing the functional 
                        
                           
                              F
                           
                           
                              4
                           
                        
                      over the differences between 
                        4
                        n
                      subpatches of 
                        
                           
                              
                                 p
                              
                           
                           
                              k
                           
                        
                      and 
                        
                           
                              
                                 a
                              
                           
                           
                              k
                           
                        
                     .

Note that, of the four pieces of the macro-patch, only the one closest to the irregular point needs to be tabulated since the other ones are defined by simple formulas of 
                        
                           
                              C
                           
                           
                              2
                           
                        
                     -extension at the junction of the four pieces, 
                        
                           
                              C
                           
                           
                              1
                           
                        
                     -extension between pieces of the 
                        
                           
                              G
                           
                           
                              1
                           
                        
                      strips, the 
                        
                           
                              G
                           
                           
                              1
                           
                        
                     -extension of the tensor-border data and pattern (16).

@&#REFERENCES@&#

