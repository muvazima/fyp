@&#MAIN-TITLE@&#Estimation of Purkinje trees from electro-anatomical mapping of the left ventricle using minimal cost geodesics

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Estimation of the Purkinje system of the left ventricle from patient specific data.


                        
                        
                           
                           Estimation of the Purkinje Myocardial Junctions using critical points.


                        
                        
                           
                           Successful recovery of the Local Activation times from estimated trees.


                        
                        
                           
                           Validation of the estimation methods on simplistic and realistic simulations.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Purkinje system

Minimal cost geodesic paths

Fast marching

Singular points

Electro-anatomical mapping

Cardiac arrhythmias

Fascicular ventricular tachycardia

@&#ABSTRACT@&#


               
               
                  The electrical activation of the heart is a complex physiological process that is essential for the understanding of several cardiac dysfunctions, such as ventricular tachycardia (VT). Nowadays, patient-specific activation times on ventricular chambers can be estimated from electro-anatomical maps, providing crucial information to clinicians for guiding cardiac radio-frequency ablation treatment. However, some relevant electrical pathways such as those of the Purkinje system are very difficult to interpret from these maps due to sparsity of data and the limited spatial resolution of the system. We present here a novel method to estimate these fast electrical pathways from the local activations maps (LATs) obtained from electro-anatomical maps. The location of Purkinje-myocardial junctions (PMJs) is estimated considering them as critical points of a distance map defined by the activation maps, and then minimal cost geodesic paths are computed on the ventricular surface between the detected junctions. Experiments to validate the proposed method have been carried out in simplified and realistic simulated data, showing good performance on recovering the main characteristics of simulated Purkinje networks (e.g. PMJs). A feasibility study with real cases of fascicular VT was also performed, showing promising results.
               
            

@&#INTRODUCTION@&#

Computational models of the heart and biophysical simulations are increasingly helping to understand clinical data and dissect the wide range of pathological mechanisms in the diseased heart (Boyle et al., 2013; Vigmond et al., 2009). An ongoing concern is to recognize which are the anatomical components required to realistically model ventricular arrhythmias (Bishop et al., 2010; Plank et al., 2009), identifying which ones can be tailored to a given patient using imaging information, and which ones rely on ex-vivo population experiments and observations. In cardiac electrophysiology, the cardiac conduction system (CCS) is a key component that meets both requirements. On the one side its presence is mandatory in several modeling applications since it is known to be involved in arrhythmia initiation and maintenance as well as in other diseases such as left bundle block or bundle branch re-entry VT and fascicular (PK-related) VT and their associated therapies (Li et al., 2002; Nogami, 2011). On the other side, its structure cannot be visualized in-vivo which have led to the construction of population-based computational models of the distal section of the CCS in the ventricles (Behradfar et al., 2014; Deo et al., 2010; Sebastian et al., 2013; Walton et al., 2014). Among the techniques that have been used to model the geometry of the CCS there are fractal models (Abboud et al., 1991), manually delineated models (Romero et al., 2010), models guided by ex-vivo electrical recordings (Pollard and Barr, 1990), models guided by histological information (Sebastian et al., 2013), and models guided by high-resolution images in animals (Vadakkumpadan et al., 2009). The reader is referred to Sebastian et al. (2013) for a review on different techniques commonly used to build computer models of the CCS. The personalization of such models with in vivo patient specific data has been discussed in the past. We presented recently one of the first computational methods to personalize the CCS from in-vivo EAM data (Cárdenes et al., 2014), which is extended and validated here. Very recently, Vergara et al. (2014) and Palamara et al. (2014) published an enhanced approach based on personalizing a generic model built with L-systems (Sebastian et al., 2011; 2013). In their method the initial location of Purkinje-myocardial junctions (PMJs) is subsequently altered by pruning and modifying a generic CCS to minimize differences with an electro-anatomical mapping (EAM) previously acquired.

One potential application where such PK models are crucial is the treatment of ventricular tachycardias (e.g. fascicular or substrate-related VTs) with radio-frequency ablation (RFA) where very limited patient-specific information on the CCS is used. The analysis of the CCS contribution is very complex since the only available information for electrophysiologists are a set of few scattered low-amplitude electrograms obtained from EAMs. Although these interventions have been notably improved in the last years by integrating patient-specific imaging data with EAM (Fernández-Armenta et al., 2013; Piers et al., 2013) to better targeting ablation sites, information on the CCS has never been included. This is particularly important in severe fascicular VTs where catheter ablation of the PMJs is recommended (Aliot et al., 2009; Stevenson and Soejima, 2007), although not always the key target (Boyle et al., 2013), and in substrate-related VTs to avoid partial ablation of the CCS. Besides RFA, biophysical models including PK could also help on testing hypothesis about the role of the CCS to optimize cardiac resynchronization therapy (CRT) in heart failure patients.
                  

In this paper we present a methodology based on differential geometry to partially estimate the anatomy of the functional segments of the CCS for a specific patient. The method estimates first the PMJs locations from local activation time (LAT) maps and then, weighted geodesic paths are computed to link the detected PMJs with the bundle of His, following the underlying LATs measured from the EAMs.

This method was verified on simulated simplified CCS and validated using detailed multi-scale biophysical electrophysiological models, in a realistic ventricular anatomy that includes different Purkinje networks. Finally, the proposed methodology was applied to three clinical datasets to evaluate the feasibility of the method with real data.

@&#METHODS@&#

In the following sections, the methodology to obtain realistic functional Purkinje trees (PKT) on the left ventricle (LV) is described. The same techniques could be directly applied to estimate right ventricular PKT. The software of the methods described here as well as some sample data will be available at the software section of the physense website. First, we present a summary about the physiology of the cardiac conduction system, which is required for justifying some stages in the methodology.

The cardiac conduction system (CCS) is a complex network of cells responsible for the distribution of the electrical signals that synchronizes the activation of remote areas in the ventricle, i.e., septal and lateral wall, in a short period of time for an efficient mechanical contraction. In the ventricular chambers, the CCS is composed of the His bundle (HB) and bundle branches (BB) that are connected to the most distal section, often referred to as the Purkinje (PK) system (Anderson et al., 2004). The PK system itself is connected to the myocardial tissue through Purkinje-myocardial junctions (PMJs, often referred to as end-terminals) (see Fig. 1(a)) and plays a key role in the synchronous activation of the ventricles since it dictates the electrical activation sequence (Durrer et al., 1970). The CCS cannot be visualized from in vivo images due to the small size of its structures. It is also difficult to differentiate it in ex vivo samples without a specific marker such as a staining due to its similarity to surrounding tissue. Unfortunately, there is a large intra-species variability in the CCS configuration, specially when comparing to the human heart (for instance, the PK system goes intramurally in pigs while it is mainly endocardial in humans). The reader is referred to Dobrzynski et al. (2013) for an extensive review on the CCS structure and function. Strong alterations or damage of the CCS potentially lead to pathological changes on the cardiac function that often leads to cardiac arrhythmias or dyssynchrony.

Let 
                           S
                         denote a Riemannian manifold in 
                           
                              R
                              3
                           
                        . Let ψ
                        
                           
                              z
                           
                         be a distance field defined on 
                           S
                         from an arbitrary point 
                           
                              z
                              ∈
                              S
                           
                         to any other point 
                           
                              x
                              ∈
                              S
                           
                        . Then, as introduced by Grove and Shiohama (1977), we define a critical point
                        
                           
                              y
                              ∈
                              S
                           
                         with respect to 
                           z
                        , if there exists a minimal cost (shortest) geodesic path (metric based on ψ
                        
                           
                              z
                           
                        ) from 
                           y
                         to 
                           z
                         with direction t, such that ∀ T
                        
                           
                              y
                           
                        : ⟨T
                        
                           
                              y
                           
                        , t⟩ is nonnegative, i.e., the angle between t and T
                        
                           
                              y
                           
                         is less than π/2. T
                        
                           
                              y
                           
                         denotes the set of vectors in the tangent plane at 
                           y
                        . In Fig. 1(c) this definition is illustrated in a cylindrical surface. The point 
                           y
                         (the point diametrically opposed to 
                           z
                        ) is critical w.r.t. 
                           z
                         since there are two different shortest geodesic paths in opposite directions at 
                           y
                        , that assure that the condition ⟨T
                        
                           
                              y
                           
                        , t⟩ ≥ 0, is satisfied for any T
                        
                           
                              y
                           
                         taking t as one of the two directions, t
                        1 or t
                        2, of the shortest geodesic paths. This condition is also satisfied for points lying on a vertical line on the surface passing through 
                           y
                         which is also known as the cut locus of 
                           S
                         from 
                           z
                         and ψ
                        
                           
                              z
                           
                        . The remaining points not meeting this condition (e.g. point 
                           p
                         in Fig 1(c)) are called regular points.

Note that, every local maximum and minimum of ψ
                        
                           
                              z
                           
                         is a critical point (Zamfirescu, 2006). Also, as pointed out in Itoh and Sakai (2007), critical points are not differentiable since they are singularity points of the distance field ψ
                        
                           
                              z
                           
                        , and 
                           z
                         will be itself a critical point (global minimum).

Applying these concepts to our particular case, let us consider the endocardial surface of the LV as the Riemannian manifold 
                           S
                        . Here we will generalize the single point distance field ψ
                        
                           
                              z
                           
                         to a multiple point distance field 
                           
                              
                                 ψ
                                 
                                    z
                                    i
                                 
                              
                              ,
                           
                         where initial points 
                           z
                        
                        
                           i
                         will represent the PMJs. Here, the distance field from 
                           z
                        
                        
                           i
                        , 
                           
                              
                                 ψ
                                 
                                    z
                                    i
                                 
                              
                              ,
                           
                         will be equivalent to the electrical activation (or LAT) map obtained from the PMJs, 
                           
                              L
                              A
                              T
                              =
                              
                                 ψ
                                 
                                    z
                                    i
                                 
                              
                              :
                              S
                              →
                              R
                           
                        .

Some distinctions between critical points are also considered. As shown in Fig. 1(b), the gradient field of a simulated LAT map, 
                           
                              
                                 ψ
                                 
                                    z
                                    i
                                 
                              
                              ,
                           
                         has points where the paths that follow the gradient field converge or diverge and therefore are not differentiable. These points correspond to critical points and, as noticed in the figure, there are two types of them: sink critical points (points A and C in Fig. 1(b)) where geodesics converge, and source critical points where geodesics diverge (points B and D in Fig. 1. Those points correspond to 
                           y
                        , i.e., local maxima of 
                           
                              
                                 ψ
                                 
                                    z
                                    i
                                 
                              
                              ,
                           
                         and to 
                           z
                        
                        
                           i
                        , i.e., local minima of 
                           
                              
                                 ψ
                                 
                                    z
                                    i
                                 
                              
                              ,
                           
                         respectively. A second distinction is made between isolated and non-isolated critical points. As shown in Fig. 1(c), critical points can form a segment on 
                           
                              S
                              ,
                           
                         (the cut locus) obtained when the distance field from zi
                         reaches the same value (local maximum) at the same location from different directions. This can also be seen as wavefronts propagating on the surface and colliding at a given segment. On the other hand, critical points can also appear isolated, forming pure sink or source points, where the wave propagation converges to or diverges from one single point. Fig. 1(b), also shows this distinction, A and B being isolated critical points while C and D are non-isolated ones. All these critical points can be detected directly from 
                           
                              ψ
                              
                                 z
                                 i
                              
                           
                         exploiting its non-differentiability (Itoh and Sakai, 2007). Also notice that a change in sign of the gradient field will switch from sink to source critical points and vice versa.

Subsequently, a point 
                           y
                         on a scalar map 
                           
                              ψ
                              
                                 z
                                 i
                              
                           
                         defined on the surface 
                           S
                         will be detected as a critical point if the gradient of the scalar map 
                           
                              ψ
                              
                                 z
                                 i
                              
                           
                         has a singularity at that particular point, or in other words, if the lateral derivatives of the gradient of the scalar map are different at a given principal direction of the tangential plane at 
                           y
                        , 
                           
                              
                                 u
                                 i
                              
                              =
                              
                                 {
                                 
                                    u
                                    x
                                 
                                 ,
                                 
                                    u
                                    y
                                 
                                 }
                              
                              ∈
                              
                                 T
                                 y
                              
                           
                        
                        
                           
                              (1)
                              
                                 
                                    
                                       D
                                       
                                          u
                                          i
                                       
                                       +
                                    
                                    −
                                    
                                       D
                                       
                                          u
                                          i
                                       
                                       −
                                    
                                    >
                                    0
                                    ,
                                 
                              
                           
                        where 
                           
                              D
                              
                                 u
                                 i
                              
                              +
                           
                         is the lateral derivative from the right of ∇ψ in the ui
                         direction
                           
                              (2)
                              
                                 
                                    
                                       D
                                       
                                          u
                                          i
                                       
                                       +
                                    
                                    =
                                    
                                       lim
                                       
                                          h
                                          →
                                          
                                             0
                                             +
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∇
                                             
                                                u
                                                i
                                             
                                          
                                          ψ
                                          
                                             (
                                             x
                                             )
                                          
                                          −
                                          
                                             ∇
                                             
                                                u
                                                i
                                             
                                          
                                          ψ
                                          
                                             (
                                             x
                                             −
                                             
                                                u
                                                i
                                             
                                             h
                                             )
                                          
                                       
                                       h
                                    
                                    ,
                                 
                              
                           
                        and similarly for the lateral derivative from the left, 
                           
                              D
                              
                                 u
                                 i
                              
                              −
                           
                        . In their discrete forms 
                           
                              D
                              
                                 u
                                 i
                              
                              +
                           
                         and 
                           
                              D
                              
                                 u
                                 i
                              
                              −
                           
                         will be computed as
                           
                              
                                 
                                    
                                       
                                          D
                                          ˜
                                       
                                       
                                          u
                                          i
                                       
                                       +
                                    
                                    =
                                    
                                       
                                          
                                             ∇
                                             
                                                u
                                                i
                                             
                                          
                                          ψ
                                          
                                             (
                                             x
                                             )
                                          
                                          −
                                          
                                             ∇
                                             
                                                u
                                                i
                                             
                                          
                                          ψ
                                          
                                             (
                                             x
                                             −
                                             
                                                u
                                                i
                                             
                                             ·
                                             Δ
                                             x
                                             )
                                          
                                       
                                       
                                          Δ
                                          x
                                       
                                    
                                 
                              
                           
                        with Δx the minimum spacing element. This discrete form, 
                           
                              
                                 
                                    D
                                    ˜
                                 
                                 
                                    u
                                    i
                                 
                                 +
                              
                              ,
                           
                         is a vector that will differ from its counterpart 
                           
                              
                                 
                                    D
                                    ˜
                                 
                                 
                                    u
                                    i
                                 
                                 −
                              
                              ,
                           
                         even when the studied point is not critical due to discretization effects. Therefore, the non-differentiability criteria from Eq. 1 is relaxed using a threshold associated to the discretization. In particular, we use the angle between lateral derivatives, adding the following condition in discrete form
                           
                              (3)
                              
                                 
                                    ∠
                                    (
                                    
                                       
                                          D
                                          ˜
                                       
                                       
                                          u
                                          i
                                       
                                       +
                                    
                                    ,
                                    
                                       
                                          D
                                          ˜
                                       
                                       
                                          u
                                          i
                                       
                                       −
                                    
                                    )
                                    >
                                    
                                       ɛ
                                    
                                    .
                                 
                              
                           
                        Notice that if this condition is only satisfied for one tangential plane direction ui
                        , the detected critical points are non-isolated critical points (such as points C and D in Fig. 1(b)). On the other hand, when this condition is met for every ui
                        , detected points will be isolated critical. As ε approaches zero, the condition is more relaxed and more points will be considered critical, therefore it has to be carefully selected. It will be measured in degrees and its optimal value will be studied in Section 5.1 and in the supplementary material. The detected points can be discriminated between source or sink critical points based on the change of sign of 
                           
                              
                                 ∇
                                 
                                    u
                                    i
                                 
                              
                              ψ
                           
                         along each tangential direction. A change from positive to negative sign gives sink critical points and source critical points otherwise.

The PMJs will correspond here to the source points of the activation map 
                           
                              
                                 ψ
                                 
                                    z
                                    i
                                 
                              
                              ,
                           
                         that will be equivalent to sink points of the negative map 
                           
                              −
                              
                                 ψ
                                 
                                    z
                                    i
                                 
                              
                           
                        .

Minimal cost geodesic path computation is a well-known problem that is usually solved by the Dijkstra algorithm (Dijkstra, 1959) in graphs. For 2D/3D images, the pixels/voxels are used as the nodes of the graph and the distances between them are the weights associated to the edges of the graph. Computation of geodesics on surfaces has a higher level of complexity that has been addressed by other authors (Kimmel and Sethian, 1998; Martínez et al., 2005) in the past.

In particular, given a surface 
                           S
                         with a weighted map ψ defined on it, 
                           
                              ψ
                              (
                              x
                              )
                              
                              ∀
                              x
                              ∈
                              S
                              ,
                           
                         and a surface point 
                           z
                         denoted as the end-point, the geodesic problem consists in finding the minimal cost (shortest) weighted path, 
                           
                              
                                 Γ
                                 
                                    ψ
                                    ,
                                    z
                                    ,
                                    y
                                 
                              
                              
                                 (
                                 s
                                 )
                              
                              :
                              
                                 [
                                 0
                                 ,
                                 1
                                 ]
                              
                              →
                              S
                              ,
                           
                         lying on the surface between any point on the surface, 
                           y
                        , and 
                           z
                        . More generally, we can extend this definition to multiple end-points, 
                           z
                        
                        
                           i
                        ,
                           
                              (4)
                              
                                 
                                    
                                       Γ
                                       
                                          ψ
                                          ,
                                          
                                             z
                                             i
                                          
                                          ,
                                          y
                                       
                                    
                                    =
                                    
                                       
                                          a
                                          r
                                          g
                                          m
                                          i
                                          n
                                       
                                       γ
                                    
                                    
                                       {
                                       
                                          L
                                          ψ
                                       
                                       
                                          (
                                          γ
                                          )
                                       
                                       :
                                       γ
                                       
                                          (
                                          0
                                          )
                                       
                                       =
                                       y
                                       ,
                                       
                                       γ
                                       
                                          (
                                          1
                                          )
                                       
                                       ∈
                                       
                                          {
                                          
                                             z
                                             i
                                          
                                          }
                                       
                                       }
                                    
                                    ,
                                 
                              
                           
                        where the curves are parameterized in the interval [0, 1] by the parameter s, and Lψ
                        (γ) is the weighted length of curve γ,
                           
                              
                                 
                                    
                                       L
                                       ψ
                                    
                                    
                                       (
                                       γ
                                       )
                                    
                                    =
                                    
                                       ∫
                                       0
                                       1
                                    
                                    ψ
                                    
                                       (
                                       γ
                                       
                                          (
                                          s
                                          )
                                       
                                       )
                                    
                                    
                                       ∥
                                       γ
                                       
                                          
                                             (
                                             s
                                             )
                                          
                                          ′
                                       
                                       ∥
                                    
                                    d
                                    s
                                    .
                                 
                              
                           
                        
                     

It is well known (Kimmel and Sethian, 1998; Mémoli and Sapiro, 2001) that a solution to this problem can be obtained using a Hamilton–Jacobi formulation, solving the Eikonal equation for ϕ(
                           x
                        ), that will define a distance map on the surface,
                           
                              (5)
                              
                                 
                                    ∥
                                    ∇
                                    ϕ
                                    (
                                    x
                                    )
                                    ∥
                                    =
                                    1
                                    /
                                    ψ
                                    (
                                    x
                                    )
                                    ,
                                    
                                    ∀
                                    
                                    x
                                    ∈
                                    S
                                    ,
                                 
                              
                           
                        starting from points 
                           z
                        
                        
                           i
                        , with initial condition 
                           
                              ϕ
                              (
                              
                                 z
                                 i
                              
                              )
                              =
                              0
                           
                        . The solution to this equation is optimally computed using the Fast marching algorithm (Sethian, 1996). Once ϕ is computed, the computation of the geodesic path can be reformulated as a backtracking procedure following the gradient of ϕ. In other words, 
                           
                              Γ
                              
                                 ψ
                                 ,
                                 
                                    z
                                    i
                                 
                                 ,
                                 y
                              
                           
                         is the set of surface points that satisfy the following ordinary differential equation, which is often denoted as the backtracking equation (Kimmel and Sethian, 1998),
                           
                              (6)
                              
                                 
                                    
                                       d
                                       
                                          d
                                          s
                                       
                                    
                                    
                                       Γ
                                       
                                          ψ
                                          ,
                                          
                                             z
                                             i
                                          
                                          ,
                                          y
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    =
                                    
                                       ∇
                                       S
                                    
                                    ϕ
                                    
                                       (
                                       x
                                       )
                                    
                                    ,
                                 
                              
                           
                        with Dirichlet boundary conditions 
                           
                              
                                 Γ
                                 
                                    ψ
                                    ,
                                    
                                       z
                                       i
                                    
                                    ,
                                    y
                                 
                              
                              
                                 (
                                 0
                                 )
                              
                              =
                              y
                              ,
                           
                        
                        
                           
                              
                                 Γ
                                 
                                    ψ
                                    ,
                                    
                                       z
                                       i
                                    
                                    ,
                                    y
                                 
                              
                              
                                 (
                                 1
                                 )
                              
                              =
                              z
                              ,
                           
                         where 
                           z
                         is the closest point to 
                           y
                         among all 
                           z
                        
                        
                           i
                        , and where 
                           
                              
                                 ∇
                                 S
                              
                              ϕ
                           
                         denotes the gradient of ϕ intrinsic to the surface (i.e. the gradient computed on the surface points). This means that starting from any point 
                           
                              y
                              ∈
                              S
                              ,
                           
                         the geodesic on the surface induced by ψ is obtained following the gradient of ϕ.

Two considerations have to be taken into account. First, the surface 
                           S
                         has to be smooth enough to allow computing its gradient (i.e. being close to a Riemannian manifold). Second, the intermediate points of the geodesic paths are computed on regular points, where ϕ is differentiable, i.e. where 
                           
                              
                                 ∇
                                 S
                              
                              ϕ
                           
                         is defined. Therefore, critical points, such as sink or source points, will only be starting or end points of the geodesic paths. Notice that if the weighted map ψ is constant, we are in the Euclidean case.

It is however interesting to use non-constant maps to obtain geodesics with lower costs on regions closer to points with real measurements or those estimated in previous steps, such as PMJs. In this context, we define weighting maps using a parameter α that weights the influence of these points in their neighborhood. A good choice of the weighting maps is given by a decreasing exponential function of a reference map, that we will denote as ψ
                        ref, where this reference map increases with the distance to some reference points, decreasing the weight rapidly as we go far from them, similarly to (Hassouna and Farag, 2009).
                           
                              (7)
                              
                                 
                                    
                                       ψ
                                       α
                                    
                                    
                                       (
                                       x
                                       )
                                    
                                    =
                                    
                                       e
                                       
                                          −
                                          
                                             α
                                             
                                                ψ
                                                ref
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        To illustrate this, in Fig. 2
                         minimum cost geodesic paths on a constant weighted map (top left) are compared using different weighted maps ψα
                         parameterized by α, using ψ
                        ref as the distance map normalized in the interval [0, 1] from a set of reference points γ
                        ref marked in the figure in red
                           
                              
                                 
                                    
                                       ψ
                                       ref
                                    
                                    
                                       (
                                       x
                                       )
                                    
                                    =
                                    min
                                    
                                       {
                                       d
                                       
                                          (
                                          x
                                          ,
                                          p
                                          )
                                       
                                       /
                                       H
                                       ,
                                       
                                       ∀
                                       
                                       p
                                       ∈
                                       
                                          γ
                                          ref
                                       
                                       }
                                    
                                    ,
                                    
                                    x
                                    ∈
                                    S
                                    .
                                 
                              
                           
                        Here, d(
                           x, p
                        ) denotes the Euclidean distance between 
                           x
                         and 
                           p
                         on the manifold 
                           S
                         and H is the maximum value reached by 
                           
                              d
                              
                                 (
                                 x
                                 ,
                                 p
                                 )
                              
                              
                              ∀
                              
                              x
                              ∈
                              S
                              ,
                              p
                              ∈
                              
                                 γ
                                 ref
                              
                           
                        . When 
                           
                              α
                              =
                              0
                           
                         a constant map is obtained and the shortest geodesic paths are obtained in the Euclidean sense. The set of starting points (
                           y
                        
                        
                           i
                        ) and ending point (
                           z
                        ) of the geodesics are kept constant in all the examples. The weighting maps are taken as a function of the distance from γ
                        ref, being equal to one at the points of this reference path, and decreasing exponentially as this distance increases, as in Eq. 7. In this figure (from left to right) it is shown how the geodesics are attracted towards the zone of influence defined by the reference points γ
                        ref (blue color regions), and how this effect is increased, reducing the influence zone and attracting more heavily the geodesics, as the parameter α is increased.

In our particular case, ψ
                        ref is given directly from the inverted LAT map normalized in the interval [0,1]
                           
                              (8)
                              
                                 
                                    
                                       ψ
                                       ref
                                    
                                    
                                       (
                                       x
                                       )
                                    
                                    =
                                    1
                                    −
                                    
                                       
                                          LAT
                                          (
                                          x
                                          )
                                       
                                       
                                          m
                                          a
                                          x
                                          (
                                          LAT
                                          )
                                       
                                    
                                    .
                                 
                              
                           
                        This means that the zones of higher influence, i.e. regions where the geodesics will be attracted, will be those where the LAT is locally low. The reason for this criterion is that the LAT will be relatively small along the CCS since it is the natural electrical trigger of the whole endocardium. Note also that the local minima will be found at the locations of the PMJs.

These maps ψα
                         will be used to generate the corresponding ϕα
                         maps using Eq. 5 and associated boundary conditions, which then will be applied in Eq. 6 (i.e. backtracking step), to create each branch of the PKT. The basic boundary condition is the inclusion of an initial target point 
                           z
                         at the location of the His Bundle. Then, geodesics are computed from latest to earliest LATs, thus using the negative of the gradient field, 
                           
                              −
                              
                                 ∇
                                 S
                              
                              ϕ
                           
                        . Here, the Fast Marching implementation will follow the description given in Mémoli and Sapiro (2001), where the computations are performed on implicit surfaces (embedded in a regular grid) instead of on triangular meshes. The solution to Fast Marching is equally accurate and computationally comparable in triangular meshes or in a regular grid. However, the implementation proposed here has the advantage of being directly and easily applicable to volumetric domains.

The PKT estimation algorithm is described in detail in Algorithm 1
                        . The developed approach generates a PKT joining the detected PMJs from the LAT maps to the His Bundle initial point, which location is manually defined at the beginning of the process. The tree generation process in Algorithm 1 uses the LV surface, the detected PMJs, the His point and the LAT map as inputs. In step 1, the PMJs are ordered according to their LAT on the electrical map. Then, the His point is included in the PKT (step 2). After that, the ψref
                         and ψα
                         maps to be used for the minimum cost path computations are obtained from the LAT map in steps 3 and 4. Then, the connection between the PMJs to the His point is performed in sequential order from the earliest to the latest activated PMJs. A connected tree is constructed by successively joining each PMJ with the closest point on the constructed tree. Each of the connections is created following a minimal cost geodesic path on the LAT map constrained to the LV surface, as described in Section 2.3. The Fast Marching computation at Step 6 of Algorithm 1 stops when the propagation front reaches the PMJ point 
                           r
                        
                        
                           i
                         that is being connected to the tree.
                        
                     

For validation, our methods were tested on detailed biophysical simulations generated with realistic Purkinje networks. A set of five different detailed Purkinje networks were constructed using the L-system based generation algorithm described in Sebastian et al. (2013). The construction of the PK network was divided into three consecutive stages, which subsequently developed the CCS from proximal to distal sections. Each stage is governed by a set of independent user parameters together with anatomical and physiological constraints to direct the generation process and adhere to the structural observations derived from histological studies. Several properties of the tree are defined using statistical distributions to introduce stochastic variability in the models.

For the verification of the method, a simulation study was conducted using anatomically simplified PKTs and electrical wave propagation algorithms. With such simplified models, we tested our methods varying parameters such as the density of PMJs used, the algorithm parameters ε and α, and we studied the influence of LAT noise and EAM measurement inaccuracies. The results of these experiments shown a good behavior of the algorithms recovering the simulated PMJs and PKT trees. The optimal value for ε was found to be 63° regardless the PMJs density, but higher values are better for low realistic PMJs densities. Regarding α, a good parameter was found to be 15, where higher values led to numerical instabilities in our computations. The choice of this parameter was not critical, as very little differences were found for lower alpha values. Regarding the influence of noise in the LAT maps, we found that with moderate amount of noise (up to 30%) the detected PMJs differ in average from the reference 0.44 cm and the detected PKTs differ in average 0.32 cm from the reference, showing that our methods are stable in the presence of noise. Similarly, we also show robustness with respect to inaccuracies in the location of the EAMs. The details of these experiments can be found in the supplementary materials.

The proposed methods for PMJ detection and PKT estimation were validated on the maps generated from the simulations described in Section 3. Three experiments were carried out to analyze the effect of ε, α and the number of virtual electrical recordings available, on the performance of the methods. Finally, the method was tested on different CCS configurations on the same LV geometry, showing errors between the reference LATs and LATs obtained from the estimated PKTs.

In this section, the quantitative comparisons performed between the detected and the reference PMJs and PKTs point locations were performed by computing distances between both point sets. To avoid under or overestimation of this distance due to different number of points in both datasets, two distances are computed and averaged, the average distance from each reference point to its nearest detected point and vice versa
                        
                           (9)
                           
                              
                                 
                                    d
                                    
                                       a
                                       v
                                       g
                                    
                                 
                                 =
                                 
                                    1
                                    2
                                 
                                 
                                    (
                                    
                                       1
                                       
                                          N
                                          1
                                       
                                    
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          N
                                          1
                                       
                                    
                                    
                                       d
                                       
                                          m
                                          i
                                          n
                                       
                                    
                                    
                                       (
                                       
                                          q
                                          i
                                       
                                       ,
                                       P
                                       )
                                    
                                    +
                                    
                                       1
                                       
                                          N
                                          2
                                       
                                    
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          N
                                          2
                                       
                                    
                                    
                                       d
                                       
                                          m
                                          i
                                          n
                                       
                                    
                                    
                                       (
                                       
                                          p
                                          j
                                       
                                       ,
                                       Q
                                       )
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     where 
                        q
                     
                     
                        i
                      ∈ Q are the reference points, 
                        p
                     
                     
                        j
                      ∈ P are the detected points, and dmin
                     (
                        x
                     , Y) denotes the minimum among all possible geodesic distances between the point 
                        x
                      (
                        q
                     
                     
                        i
                      or 
                        p
                     
                     
                        j
                     ) to any point in the point set Y (P or Q).

PMJ detection achieved with the method described in Section 2.2 was performed using several values of the threshold parameter ε. Fig. 3 (top) shows the average distances obtained using Eq. 9 between detected and reference PMJs, for a range of threshold values (
                           
                              
                                 ɛ
                              
                              =
                              [
                              
                                 18
                                 ∘
                              
                              ,
                              103
                              .
                              
                                 5
                                 ∘
                              
                              ]
                           
                        ) in five simulation cases with different PKT configurations. The lower average distances were reached for values between 60° and 80°. According to this experiment, a value of 
                           
                              
                                 ɛ
                              
                              =
                              
                                 72
                                 ∘
                              
                           
                         was selected for subsequent experiments to get optimal results. The detected PMJs using 
                           
                              
                                 ɛ
                              
                              =
                              {
                              
                                 54
                                 ∘
                              
                              ,
                              
                                 63
                                 ∘
                              
                              ,
                              
                                 72
                                 ∘
                              
                              }
                           
                         for the simulated Case 0 are represented in Fig. 4 (top row, second to fourth columns, white dots). Simulated cases 1–4 correspond to activation maps performed in a different ventricular geometry with different PKTs (see Fig. 5
                         for cases 2 and 3).

The number of electrical recordings acquired on the LV endocardium in clinical practice is much lower than the number of points with electrical information available in a simulated model. For instance, while in the experiments with simulated data described above, the LV endocardium model consists in a surface of 124k points with electrical information for each of them, an EAM acquired during a typical VT intervention usually stays below 900 points with the current EP systems. To test the influence of the number of electrical data points available in the detection of PMJs, we subsampled the LV endocardium of the model at M equally distributed points using 
                           
                              M
                              =
                              [
                              400
                              ,
                              3000
                              ]
                           
                         in steps of 200 points. Subsequently, linear interpolation was applied to obtain LATs for the remaining points. The PMJs were detected in the interpolated maps using the optimal threshold value described above: 
                           
                              
                                 ɛ
                              
                              =
                              
                                 72
                                 ∘
                              
                           
                        . The distance averages computed between the reference and the detected PMJs of each interpolated map are shown in Fig. 3 (bottom), showing a better behavior of the proposed algorithm when more endocardial points are available.

A third experiment was carried out to evaluate the performance of the PKT construction method as a function of the weight given to earlier LATs. Using the PMJs detected with the non-interpolated map and a threshold value of 
                           
                              
                                 ɛ
                              
                              =
                              
                                 72
                                 ∘
                              
                              ,
                           
                         the PKTs were constructed using 
                           
                              α
                              =
                              {
                              0
                              ,
                              5
                              ,
                              10
                              ,
                              15
                              }
                              ,
                           
                         as can be observed in Fig. 4 (bottom row, in white). From this figure, it can be noticed that there are small differences between the reconstructed trees which are shown by the white arrows.

Four realistic biophysical simulations were generated on the same LV geometry using different PKT configurations to test our methods. Using a single LV geometry ensured that the LV geometrical factors do not influence the conclusions. Fig. 5 illustrates some results of the proposed methodology on two of them. Properties (number of branches and PMJs) of those models are described in Table 1
                        
                        . The reference PMJs and PKTs (at columns labeled as Reference) are shown in comparison to the PMJs and PKTs obtained using the methods presented here (labeled as Estimation) in two different views (septal and lateral). It can be observed from the figure that the estimated PKTs follow the main branches and patterns of the reference ones.

Finally, activation times produced by the estimated PKTs on the LV were quantitatively analyzed. We coupled the estimated PKTs into the ventricular model and produced new biophysical simulations keeping the same ionic models and parameters as in the reference simulations. The obtained results are shown in Fig. 5 (labeled as Estimation) and are summarized in Table 1. Total activation time (TAT) differences were small, in the range of 1–15 ms. Differences between reference and estimated LATs were locally compared for each point in the endocardium and epicardium of the model (a total of 323388 nodes). Mean absolute errors were within the range of 5.12–7.44 ms, which indicates a high spatial correlation between reference and estimated LAT maps. Fig. 5 (labeled as Error epi) shows the differences between the reference simulated LAT maps and the ones generated from the estimated trees on the endocardium and epicardium surfaces. In the same figure, the histogram of those LAT map differences is also shown. Negative and positive differences correspond to regions activated first in the estimated model or the reference model, respectively. As can be observed in Fig. 5, differences are below 10 ms in most LV regions (greenish regions), and only in localized small regions of the LV (mainly the basal epicardium) differences are 10 ms or greater. To demonstrate this numerically, the percentage of points with LAT errors lying in the ranges 0–5 ms, 5–10 ms and > 10  ms, are also presented in Table 1, where we can see that for most of the points (85.7% averaging over all cases) those differences are below 10 ms.

We had access to clinical data of three cases of fascicular VT, where the CCS is thought to play a relevant role (Aliot et al., 2009; Li et al., 2002; Nogami, 2011; Stevenson and Soejima, 2007). EAM data (CARTO, Biosense Webster) were acquired for the three cases to guide the radio-frequency ablation intervention. The system provided intra-cardiac electrical information (voltage amplitude, LAT) in a discrete set of points on the LV endocardium during approximately three cardiac cycles. In one of the three cases (first case) a pre-operative CT image was also available and then was used to extract a mesh representation of the LV endocardial geometry with around 50k nodes.

Subsequently CARTO-based LAT maps of the three cases were mapped onto the equivalent LV endocardial surface for comparison purposes. The LAT maps were composed of 231, 185 and 285 points for the first, second and third cases, respectively. This mapping was based on establishing an homeomorphism between both surfaces using a common parameterization computed by mesh flattening (see details in Soto-Iglesias et al. (2013)). Fig. 6 (columns labeled as LAT measured) shows two different views of the LV geometry color-coded with the LAT maps measured with CARTO for the three real cases, together with the PKTs estimated with the proposed methodology. PMJs were automatically obtained using the optimal threshold value found in the realistic biophysical simulations, 
                        
                           
                              ɛ
                           
                           =
                           
                              72
                              ∘
                           
                           ,
                        
                      and PKTs were reconstructed from the estimated PMJs using 
                        
                           α
                           =
                           15
                        
                     . To test the feasibility of the PMJs and PKTs estimated with our method, the LAT maps were simulated using the PKTs estimated. To do that, first, the activation time values of the PMJs were computed by propagating a fast signal from the His on the estimated PKT with velocity vPK
                     . Then, the LAT map was calculated by Fast Marching on the LV surface from the estimated PMJs with propagation velocity vCM
                     , similarly as performed in the simplified experiment. The velocities vPK
                      and vCM
                      were selected to match the time range of the actual data over the PMJs and over the total LV surface respectively. The estimated LAT maps are shown in Fig. 6 (columns labeled as LAT estimated) for the sake of comparison. Table 2
                      shows the averaged differences in milliseconds between the estimated and the measured LAT maps, as well as the Purkinje and cardiac muscle velocities used. Conduction velocities (except for Case 1) were in the physiological range for Purkinje and for the myocardial tissue, which can be used as a validation of the PKTs estimated. As for the biophysical simulations, the percentage of points with LAT errors in the ranges 0–5 ms, 5–10 ms and > 10 ms are also reported in Table 2, showing that the majority of points (86.0%) differs in less than 10 ms with respect to the measured LAT.

@&#DISCUSSION@&#

We have therefore shown that given a set of discrete measurements of activation times on the LV, it is possible to obtain a model of the CCS that provides a realistic activation map on the LV, and that agrees with the initial measurements.

We have analyzed the sensitivity of the two main parameters in the proposed methodology, α and ε in simplified and realistic simulations. In the simplified simulations the optimal ε value varies with the density of PMJs, with best results between 30° and 80°, and optimal value of 63° regardless the PMJ density. When realistic models were used, the optimal value was found to be 72°. Regarding α, higher values consistently provided better results on the reconstruction of PKTs on simplified simulated data, although it does not substantially alter the final results. Therefore, the maximum value of α was considered for biophysical experiments, thus increasing the influence of points with earlier LATs on the reconstruction of the PKTs.

PKTs are estimated purely from information of the electrical propagation on the muscle. That means that we can estimate many different PKTs and PMJs configurations that will produce the same resulting propagation pattern. For these reasons, the estimated PKTs differ when compared to realistic biophysical simulations, notably when analyzing at the sub-branches level. However the estimated PKTs are functionally similar to the simulated ones, providing LAT maps that were similar to the reference LATs, and differing in the order of 6 ms.

One important limitation of the proposed methodology is the non-uniqueness of the solution when estimating a PKT from the EAM data since it is a typical ill-conditioned inverse problem. This is partially alleviated because the solution is constrained penalizing branches running on regions with large LATs. In addition, experiments were performed to reduce the range of the relevant parameters used. Despite these modeling constraints, the reconstructed PKTs are incomplete (and non-unique) since they do not consider possible re-entrant circuits making use of non-functional PMJs and non-physiological sequences of activations. Nevertheless, the main limitation to solve this non-uniqueness in clinical cases is the typically low number of measurements (M) available. In addition, measurement density is quite case-dependent in RF ablation. For instance, in substrate-related VT ablations we could reach up to 900 measurements, while for the fascicular VTs there are around 200 EAM points. This lack of measurements complicates the detection of critical points. The influence of M was also presented in Fig. 3, bottom, where we saw that to detect PMJs in interpolated maps with discrepancies similar to non-interpolated maps, the number of measurements required should be around 3000. These discrepancies are still acceptable for M around 1500 points, but they rapidly increase when reducing M. This limitation on the number of available measurements seems to be not too far to overcome in future clinical practice, in particular using recent multi-polar catheters that allow the simultaneous acquisition of up to 20–25 EAM points, thus substantially increasing the number of available measurements and reducing the set of possible solutions of the estimation problem.

Results obtained on different PKT configurations, (Fig. 5 for two cases, and Table 1), demonstrate that the proposed methodology can handle normal variability of human CCS, constructing PKTs that adapt well visually and quantitatively to the reference PKTs that originated the LAT maps.

The results obtained for the three clinical cases show a good correspondence between the isochrones on acquired and estimated data. In all cases, the PKTs show a simple structure due to the lack of gradient information found in the data, which results from the interpolation performed on the scattered set of measurements. Large areas with similar activation time in the acquired maps such as the earliest activated area in real case 1 (see Fig. 6 first row (top)) are probably triggered by a large number of PMJs, which allow a synchronous activation of a large patch. For that particular example the four PMJs recovered are not enough to reproduce faithfully the isochrones, introducing a delay locally.

In the literature, the electrical impulse through the CCS has been reported to be between 2–4 m/s whereas in the myocardial tissue is in the range of 0.4–0.8 m/s (Desplantez et al., 2007; Durrer et al., 1970). The conduction velocities for the Purkinje and myocardial tissue that optimized the difference between acquired and estimated LAT maps were in the order of empirical measurements, with a ratio of around 1 : 3, confirming that the estimated PKTs could be feasible. For Case 1 conduction velocities are very high. These estimated conduction velocities might suffer from several limitations of the proposed pipeline such as the reduced number of EAM points, or underestimation of PMJs. The PMJ propagation delay was considered deterministic and instantaneous, since no patient-specific information was available about range delays.

It is also important to highlight that our methodology estimates trees as solutions of the Purkinje system. The PK system shows an overall network structure at macroscopic and microscopic level (Atkinson et al., 2011) (see Fig. 1). If one overlooks false tendons and similar structures, the loops formed by the PK system at different scales are local, and therefore they can be functionally simplified by a tree-like structure. Although introducing loops would improve the results, the low number of measurements available prevent a correct estimation of the missing branches of the PK network. However, we have shown that using trees, the obtained recovered LAT maps are similar in both simulations and real cases. In addition, our study with biophysical simulations helped us to characterize errors in identifying PMJs and PKT, before using EAM data from patients. Other authors have also recently developed personalization strategies based on EAM data for the localization of PMJs starting from a generic PKT structure (Vergara et al., 2014). They reported errors ranging from 4.9 ± 4.1 ms to 7.4 ± 6.6 ms, which were only estimated at a few locations, not at all the endocardial surface. The errors obtained with our method ranged, in average, from 3.3 ms to 8 ms. Given a conduction velocity in cardiac tissue of 0.6 m/s, the worst case (8 ms) will correspond to an average error of 4.8 mm, and the best case (3.3 ms to 1.8 mm (close to the resolution error of an EAM). It is important to note that errors in remote areas (mainly basal) far from PMJs show local errors of up to 20 ms, and therefore information in those regions should be carefully interpreted. An improvement of the Vergara et al. method (Vergara et al., 2014) method by Palamara et al. (Palamara et al., 2014) included the information from the antidromic (retrograde) activation to model pathological sequences of activation, with errors ranging from 14.06 ± 15.52 ms to 7.16 ± 6.47 ms.

The proposed methodology could directly help clinical interventions such as RFA and CRT. For instance, in the ablation of the PMJs that is the therapy of choice for fascicular VTs. In substrate-related VTs, radio-frequency ablation of potential targets should be ideally performed while minimizing the harm to the CCS. Our methodology could provide valuable information for the planning of ablation sites to avoid secondary circuits triggering VTs due to partial ablation of the CCS. The PMJ and PKT estimation approaches presented here could be easily adapted to incorporate non-invasive electrophysiological data provided by promising recent electrocardiographic mapping systems and better plan CRT in Heart failure patients (Jia et al., 2006; Ploux et al., 2013). The translation of the proposed technique into a clinical environment would not be straightforward. However, it will fit with time constraints in the clinic due to its low computational cost: around 2  s for PMJ estimation and between 3 and 5 min with a non-optimized C++ code in a single 2.3 GHz processor computer (easily reaching 1 min after optimization).

@&#CONCLUSIONS@&#

In this paper we have proposed a methodology that automatically detects the PMJs of the CCS from LAT maps on a LV surface, assuming that there are critical points on a Riemannian surface defined by the LV and its LAT map and making use of their non-differentiability characteristics. From these PMJs we have proposed a method that generates a simplified estimation of the PK network that is modeled as a tree by computing weighted minimal cost geodesics on the LV surface to join the detected PMJs. To our knowledge, this is one of the first computational attempts to reconstruct the PK network from in vivo electrical human measurements, together with our preliminary work (Cárdenes et al., 2014) and recent developments of Vergara et al. (2014) and Palamara et al. (2014). We have shown in simplified and realistic simulation scenarios that detection of PMJs is feasible and that estimation of PKTs provides solutions that are functionally similar to realistic simulations. The discrepancies between the LAT maps derived from our estimated tress and the reference realistic LATs were lower than 10 ms in 80% of the points. We also showed that the methods were stable in the presence of noise.

The proposed methodology has also been applied to a limited set of clinical data, providing reasonable results. However, the PKTs generated in those cases have to be carefully interpreted since LAT maps were reconstructed using a low number of initial points to generate the interpolated activation maps. The application of differential geometry concepts on EAM data presented in this paper opens up the possibility for better visualization and interpretation of this type of data in other clinical scenarios where abnormal electrical pathways are important such as in substrate-related VTs. Furthermore we also plan as future work to combine the proposed methodology with advanced signal processing methods, similar to the ones we recently published (Alcaine et al., 2014), applied directly to 1D electrograms from EAM data to automatically detect PMJs, thus complementing information obtained from LAT maps. Finally, to extend the current validation, a full 3D torso model could be used to obtain the virtual electrogram by solving the forward problem of electrophysiology and then compare it to a measured ECG. However, additional uncertainties will have to be taken into account to fully validate the method.

@&#ACKNOWLEDGMENTS@&#

This work is partially funded by the Sub-programa de Proyectos de Investigación en Salud Instituto de Salud Carlos III, Spain (FIS - PI11/01709), by Spanish Ministry of Economy and Competitiveness (TIN2011-28067 and TIN2012-35874), and by eTorso project (GV/2013/094) from Generalitat Valenciana. The authors thank specially Dr. Bart Bijnens for its comments and suggestions, and Dr. David Andreu and Dr. Juan Fernandez-Armenta for their assistance in the clinical data collection.

Supplementary material associated with this article can be found, in the online version, at 10.1016/j.media.2015.05.007
                  


                     
                        
                           
                        
                     
                  

@&#REFERENCES@&#

Ashikaga, H., Arevalo, H., Vadakkumpadan, F., Blake 3rd, R.C., Bayer, J.D., Nazarian, S., Muz Zviman, M., Tandri, H., Berger, R.D., Calkins, H., Herzka, D.A., Trayanova, N.A., Halperin, H.R., 2013. Feasibility of image-based simulation to estimate ablation target in human ventricular arrhythmia. Heart Rhythm 10 (8), 1109–1116.

Romero, D., Sachse, F., Sebastian, R., Frangi, A., 2011. Towards high resolution computational models of the cardiac conduction system: a pipeline for characterization of purkinje-ventricular-junctions. In: Proceedings of the International Conference on Functional Imaging and Modeling of the Heart (FIMH'11), LNCS 6666, Vol. LNCS 6666, pp. 28–35.

Sebastian, R., Zimmerman, V., Sukno, F., Bijnens, B., Frangi, A., 2009. Cardiac modelling for pathophysiology research and clinical applications. the need for an automated pipeline. World Congress on Medical Physics and Biomedical Engineering, Vol. 25/4. Springer Berlin Heidelberg, Munich, Germany, pp. 2207–2210.

Stephenson, R., Boyett, M., Hart, G., Nikolaidou, T., Cai, X., Corno, A.F., Alphonso, N., Jeffery, N., Jarvis, J., 2012. Contrast enhanced micro-computed tomography resolves the 3-dimensional morphology of the cardiac conduction system in mammalian hearts. PLoS ONE 7 (4), e35299.

Trayanova, N.A., 2011. Whole-heart modeling: applications to cardiac electrophysiology and electromechanics. Circ. Res. 108 (1), 113–128.

Trayanova, N.A., 2014. Virtual 3d heart models to aid pacemaker implantation in children. Future Cardiol. 10 (1), 5–8.

