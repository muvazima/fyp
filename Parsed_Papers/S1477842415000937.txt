@&#MAIN-TITLE@&#Automatic synthesis of k-inductive piecewise quadratic invariants for switched affine control programs

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We analyze the boundedness of piecewise affine control programs.


                        
                        
                           
                           We synthesize piecewise quadratic invariants, sublevel set of Lyapunov function.


                        
                        
                           
                           Invariants are computed of paths of k-switches, through SDP solving.


                        
                        
                           
                           Method implemented in Matlab with great performance on a large set of examples.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Formal verification

Static analysis

Piecewise affine systems

Piecewise quadratic Lyapunov functions

@&#ABSTRACT@&#


               
               
                  Among the various critical systems that are worth to be formally analyzed, a wide set consists of controllers for dynamical systems. Those programs typically execute an infinite loop in which simple computations update internal states and produce commands to update the system state. Those systems are yet hardly analyzable by available static analysis method, since, even if performing mainly linear computations, the computation of a safe set of reachable states often requires quadratic invariants.
                  In this paper we consider the general setting of a piecewise affine program; that is a program performing different affine updates on the system depending on some conditions. This typically encompasses linear controllers with saturations or controllers with different behaviors and performances activated on some safety conditions.
                  Our analysis is inspired by works performed a decade ago by Johansson et al., and Morari et al., in the control community. We adapted their method focused on the analysis of stability in continuous-time or discrete-time settings to fit the static analysis paradigm and the computation of invariants, that is over-approximation of reachable sets using piecewise quadratic Lyapunov functions.
                  This approach has been further extended to consider k-inductive properties of reachable traces (trajectories) of systems.
                  The analysis has been implemented in Matlab and shown very good experimental results on a very large set of synthesized problems.
               
            

@&#INTRODUCTION@&#

With the success of Astrée [4], static analysis in general and abstract interpretation in particular are now seriously considered by industrials from the critical embedded system community, and more specifically by the engineers developing and validating controllers. The certification norms concerning the V&V of those software have also evolved and now enable the use of such methods in the development process.

These controller software are meant to perform an infinite loop in which values of sensors are read, a function of inputs and internal states is computed, and the value of the result is sent to actuators. In general, in the most critical applications, the controllers used are based on a simple linear update with minor non-linearities such as saturations, i.e. enforcing bounds, or specific behaviors when some conditions are met. The controlled systems range from aircraft flight commands, guidance algorithms, engine control from any kind of device optimizing performance or fuel efficiency, control of railway infrastructure, fan control in tunnels, etc.

It is therefore of utmost importance to provide suitable analyses to verify these controllers. One of the approaches is to rely on quadratic invariants, such as the digital filters abstract domain of Feret [10], since, according to Lyapunov׳s theorem, any globally asymptotically stable linear system admits a quadratic Lyapunov function. Unfortunately, this theorem does not hold in the presence of disjunction, such as saturation. Moreover checking stability of piecewise systems is undecidable [25].

In static analysis, dealing with disjunction is an import concern. When the join of two abstract element is imprecise, one can consider the disjunctive completion of the domain [11]. This process enriches the set of abstract elements with new ones, but the cost, i.e. the number of new elements, could be exponential in the number of initial elements. Concerning relation abstract domains, one should mention the tropical polyhedra of Allamigeon [2] in which an abstract element characterizes a finite disjunction of zones [21]. However concerning quadratic properties, no static analysis actually performs the automatic computation of disjunctive quadratic invariants.

The goal of this paper is to propose such a computation: produce a disjunctive quadratic invariant as a sub-level of a piecewise quadratic Lyapunov function. Because of the undecidability of the problem, this search is heuristic, but shown to perform well in our experiments.

@&#RELATED WORKS@&#

Most relational abstractions used in the static analysis community rely on a linear representation of relationship between variables, e.g. polyhedra [7], octagons [22], zonotopes [12] are not join-complete. Integrating constraints in invariants generation was developed in [9] but for computing linear invariants. As mentioned above, the tropical polyhedra domain [2] admits some disjunctions since it characterizes a family of properties encoded as finite disjunction of zones.

Concerning non-linear properties, the need for quadratic invariant was addressed a decade ago with ellipsoidal abstract domains for simple linear filters [10] and more recently for non-linear template domains [8] and policy iteration based static analysis [13].

More recently, techniques used in the control community have been used to synthesize appropriate quadratic templates using SDP solvers and Lyapunov functions [28].

The proposed technique addresses a family of systems well beyond the ones handled by the mentioned methods. In general, a global quadratic invariant is not enough to bound the reachable value of the considered systems, hence none of these could succeed.

On the control community side, Lyapunov based analysis is typically used to show the good behavior of a controlled system: it is globally asymptotically stable (GAS), i.e. when time goes to infinity the trajectories of the system goes to 0. Since about a decade SDP solvers, i.e. convex optimization algorithms for semi-definite programming, have reached a level of maturity that enable their use to compute quadratic Lyapunov functions. On the theory side, variants of quadratic Lyapunov functions such as the papers motivating our work – Johansson and Rantzer [27,15] as well as Mignone, Ferrari-Trecate and Morari [20] – addressed the study of piecewise linear systems for proving the GAS property.

Another related approach is the line of works supported by Lee and Dullerud [19,17,18] in which the problem is the ability to synthesize a stable controller for a piecewise system. Their approach relies on the computation of a piecewise quadratic Lyapunov for a subset of feasible transitions of the system, considering a bounded fixed number of switches between system behaviors.

In general, computing a safe superset of reachable states, as needed when performing static analysis, is not a common question for control theorist. They would rather address the related notions of controllability or stability under perturbations. In most cases, either the property considered or the technique used relies on the existence of such a bound over reachable state; which we aim to compute in static analysis.

Our contribution is threefold and based on the method of Johansson and Mignone used to prove the GAS property of a piecewise linear system:
                           
                              •
                              we detailed the method in the discrete setting, computing a piecewise quadratic Lyapunov function of a discrete-time system;

we adapted it to compute an invariant over reachable states of the analyzed system;

we showed the applicability of the proposed method to a wide set of generated examples.

This paper is an extended version of [1] considering the expression of relationships between quadratic invariants along program traces as inspired by Lee and Dullerud. This approach proposed can be considered as a lift of previous method to k-induction [29,16].

The paper is structured as follows. Section 2 introduces the kind of programs considered. Section 3 introduces the notion of piecewise quadratic Lyapunov function. Section 4 presents the expression of conditions, such as guards in the program, as quadratic constraints. This is required to generate the constraints presented in Section 5, computing a quadratic Lyapunov function per behavior of the piecewise program. Section 6 develops the lift of the previous method to a k-induction setting: considering sequences of up to k transitions when searching for quadratic invariants. Last, Section 7 presents the experimentations while Section 8 concludes and opens future direction of research.

The programs we consider here are composed of a single loop with possibly a complicated switch-case type loop body. Our switch-case loop body is supposed to be written as a nested sequence of ite statements, or as a switch: 
                        
                           
                              
                                 
                                    
                                 
                              
                           
                        
                     
                  

Moreover, we suppose that the analyzed programs are written in affine arithmetic. Consequently, the programs analyzed here can be interpreted as constrained piecewise affine discrete-time systems. Finally, we reduce the problem to compute automatically an overapproximation of the reachable states of a piecewise affine discrete-time system. The term piecewise affine means that there exists a polyhedral partition 
                        {
                        
                           
                              X
                           
                           
                              i
                           
                        
                        ,
                        i
                        ∈
                        I
                        }
                      of the state-input space 
                        X
                        ⊆
                        
                           
                              R
                           
                           
                              d
                              +
                              m
                           
                        
                      such that for all 
                        i
                        ∈
                        I
                     , the dynamic of the system is affine and the system is represented by the following relation:
                        
                           (1)
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    u
                                 
                                 
                                    0
                                 
                              
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    0
                                 
                              
                              
                              and
                              
                              ∀
                              
                              k
                              ∈
                              N
                              ,
                              
                              
                                 
                                    x
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                              =
                              
                                 
                                    A
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                              +
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    u
                                 
                                 
                                    k
                                 
                              
                              +
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              if
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    u
                                 
                                 
                                    k
                                 
                              
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ,
                           
                        
                     where 
                        
                           
                              X
                           
                           
                              0
                           
                        
                        ⊆
                        
                           
                              R
                           
                           
                              d
                              +
                              m
                           
                        
                      is the compact convex polyhedron of possible initial conditions, A
                     
                        i
                      is a 
                        d
                        ×
                        d
                      matrix, B
                     
                        i
                      a 
                        d
                        ×
                        m
                      matrix and b
                     
                        i
                      a vector of 
                        
                           
                              R
                           
                           
                              d
                           
                        
                     . The variable 
                        x
                        ∈
                        
                           
                              R
                           
                           
                              d
                           
                        
                      refers to the state variable and 
                        u
                        ∈
                        
                           
                              R
                           
                           
                              m
                           
                        
                      refers to some input variable.

For us, a polyhedral partition is a family of convex polyhedra which partitions the state-input space i.e. 
                        X
                        =
                        
                           
                              ⋃
                           
                           
                              i
                              ∈
                              I
                           
                        
                        
                           
                              X
                           
                           
                              i
                           
                        
                        ⊆
                        
                           
                              R
                           
                           
                              d
                              +
                              m
                           
                        
                      such that 
                        
                           
                              X
                           
                           
                              i
                           
                        
                        ∩
                        
                           
                              X
                           
                           
                              j
                           
                        
                        =
                        ∅
                      for all 
                        i
                        ,
                        j
                        ∈
                        I
                     , 
                        i
                        ≠
                        j
                     . From now on, we call X
                     
                        i
                      
                     cells. Cells 
                        
                           
                              {
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              }
                           
                           
                              i
                              ∈
                              I
                           
                        
                      are convex polyhedra which can contain both strict and weak inequalities. Cells can be represented by a 
                        
                           
                              n
                           
                           
                              i
                           
                        
                        ×
                        (
                        d
                        +
                        m
                        )
                      matrix T
                     
                        i
                      and c
                     
                        i
                      a vector of 
                        
                           
                              R
                           
                           
                              i
                           
                           
                              n
                           
                        
                     . We denote by 
                        
                           
                              I
                           
                           
                              i
                           
                           
                              s
                           
                        
                      the set of indices which represent strict inequalities for the cell X
                     
                        i
                     , denote by T
                     
                        s
                     
                     
                        i
                      and c
                     
                        s
                     
                     
                        i
                      the parts of T
                     
                        i
                      and c
                     
                        i
                      corresponding to strict inequalities and by T
                     
                        w
                     
                     
                        i
                      and c
                     
                        w
                     
                     
                        i
                      the one corresponding to weak inequalities. Finally, we have the matrix representation given by the following formula:
                        
                           (2)
                           
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              =
                              {
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       d
                                       +
                                       m
                                    
                                 
                                 |
                                 
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             
                                                u
                                             
                                          
                                       
                                    
                                    )
                                    ⪡
                                    
                                       
                                          c
                                       
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          T
                                       
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             
                                                u
                                             
                                          
                                       
                                    
                                    )
                                    ≤
                                    
                                       
                                          c
                                       
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                 
                                 }
                              
                           
                        
                     We use the following notation: 
                        y
                        ⪡
                        z
                      means that for all coordinates l, 
                        
                           
                              y
                           
                           
                              l
                           
                        
                        <
                        
                           
                              z
                           
                           
                              l
                           
                        
                      and 
                        y
                        ≤
                        z
                      means that for all coordinates l, 
                        
                           
                              y
                           
                           
                              l
                           
                        
                        ≤
                        
                           
                              z
                           
                           
                              l
                           
                        
                     .

While the approach we propose can consider arbitrary partitioning of the system dynamics into cells, we infer automatically the cell׳s definition using the guards of the switch case constructs.

In order to simplify the following analysis, it is easier to consider a linear system rather than an affine one. Therefore we define an homogeneous flavor of the system dynamics: instead of considering a system state in 
                        
                           
                              R
                           
                           
                              d
                           
                        
                      with inputs in 
                        
                           
                              R
                           
                           
                              m
                           
                        
                     , we manipulate system states in 
                        
                           
                              R
                           
                           
                              1
                              +
                              d
                              +
                              m
                           
                        
                     . Thus we introduce the 
                        (
                        1
                        +
                        d
                        +
                        m
                        )
                        ×
                        (
                        1
                        +
                        d
                        +
                        m
                        )
                      matrices F
                     
                        i
                      defined as follows:
                        
                           (3)
                           
                              
                                 
                                    F
                                 
                                 
                                    i
                                 
                              
                              =
                              (
                              
                                 
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                0
                                             
                                             
                                                1
                                                ×
                                                d
                                             
                                          
                                       
                                       
                                          
                                             
                                                0
                                             
                                             
                                                1
                                                ×
                                                m
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                b
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          
                                             
                                                A
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                    
                                       
                                          0
                                       
                                       
                                          
                                             
                                                0
                                             
                                             
                                                m
                                                ×
                                                d
                                             
                                          
                                       
                                       
                                          
                                             
                                                Id
                                             
                                             
                                                m
                                                ×
                                                m
                                             
                                          
                                       
                                    
                                 
                              
                              )
                           
                        
                     The system defined in Eq. (1) can be rewritten as 
                        
                           
                              (
                              1
                              ,
                              
                                 
                                    x
                                 
                                 
                                    k
                                    +
                                    1
                                 
                                 
                                    ⊤
                                 
                              
                              ,
                              
                                 
                                    u
                                 
                                 
                                    k
                                    +
                                    1
                                 
                                 
                                    ⊤
                                 
                              
                              )
                           
                           
                              ⊤
                           
                        
                        =
                        
                           
                              F
                           
                           
                              i
                           
                        
                        
                           
                              (
                              1
                              ,
                              
                                 
                                    x
                                 
                                 
                                    k
                                    +
                                    1
                                 
                                 
                                    ⊤
                                 
                              
                              ,
                              
                                 
                                    u
                                 
                                 
                                    k
                                 
                                 
                                    ⊤
                                 
                              
                              )
                           
                           
                              ⊤
                           
                        
                     . Note that we introduce a “virtual” dynamic law 
                        
                           
                              u
                           
                           
                              k
                              +
                              1
                           
                        
                        =
                        
                           
                              u
                           
                           
                              k
                           
                        
                      on the input variable in Eq. (3). In the point of view of set invariance computation, we will see that it remains to consider such dynamic law. Indeed we suppose that the input is bounded and we write 
                        
                           
                              u
                           
                           
                              k
                           
                        
                        ∈
                        U
                      for all 
                        k
                        ∈
                        N
                      with 
                        U
                      being a nonempty compact convex polyhedra (convex polytope). We make the following assumption:
                        
                           (4)
                           
                              
                                 
                                    X
                                 
                                 
                                    0
                                 
                              
                              =
                              {
                              x
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    d
                                 
                              
                              ∣
                              ∃
                              u
                              ∈
                              U
                              
                              s
                              .
                              t
                              .
                              
                              (
                              x
                              ,
                              u
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    0
                                 
                              
                              }
                              ×
                              U
                              .
                           
                        
                     It means that X
                     0 is actually composed of initial conditions on the state variable x and the part of initial conditions on u is given by 
                        U
                     .

We are interested in proving that the reachable states 
                        R
                      are bounded and a proof of this statement can be expressed by directly computing it. Recalling that 
                        R
                      is the smallest set C satisfying 
                        F
                        (
                        C
                        )
                        ⊆
                        C
                      where F is the mapping on subsets of 
                        
                           
                              R
                           
                           
                              d
                           
                        
                      defined for all 
                        C
                        ⊂
                        
                           
                              R
                           
                           
                              d
                           
                        
                      by: 
                        
                           
                              
                                 
                                    
                                       F
                                       (
                                       C
                                       )
                                       =
                                       {
                                       y
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             d
                                          
                                       
                                       ∣
                                       ∃
                                       i
                                       ∈
                                       I
                                       ,
                                       
                                       ∃
                                       (
                                       x
                                       ,
                                       u
                                       )
                                       ∈
                                       (
                                       C
                                       ×
                                       U
                                       )
                                       ∩
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       
                                       s
                                       .
                                       t
                                       .
                                       
                                       y
                                       =
                                       
                                          
                                             A
                                          
                                          
                                             i
                                          
                                       
                                       x
                                       +
                                       
                                          
                                             B
                                          
                                          
                                             i
                                          
                                       
                                       u
                                       +
                                       
                                          
                                             b
                                          
                                          
                                             i
                                          
                                       
                                       }
                                       ∪
                                       {
                                       x
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             d
                                          
                                       
                                       ∣
                                       ∃
                                       u
                                       ∈
                                       U
                                       
                                       s
                                       .
                                       t
                                       .
                                       
                                       (
                                       x
                                       ,
                                       u
                                       )
                                       ∈
                                       
                                          
                                             X
                                          
                                          
                                             0
                                          
                                       
                                       }
                                    
                                 
                              
                           
                        
                     and prove that this set is bounded. We can also compute an overapproximation of 
                        R
                      from a set 
                        S
                        ⊆
                        
                           
                              R
                           
                           
                              d
                              +
                              m
                           
                        
                      such that 
                        (
                        
                           
                              x
                           
                           
                              0
                           
                        
                        ,
                        
                           
                              u
                           
                           
                              0
                           
                        
                        )
                        ∈
                        S
                     , 
                        R
                        ×
                        U
                        ⊆
                        S
                      and 
                        S
                      is an inductive invariant in the sense of, for all 
                        i
                        ∈
                        I
                     : 
                        
                           
                              (
                              x
                              ,
                              u
                              )
                              ∈
                              S
                              ∩
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ⇒
                              (
                              
                                 
                                    A
                                 
                                 
                                    i
                                 
                              
                              x
                              +
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                              u
                              +
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              ,
                              u
                              )
                              ∈
                              S
                              .
                           
                        
                     Indeed, by induction since X
                     0 is included in 
                        S
                     , then 
                        (
                        
                           
                              x
                           
                           
                              k
                           
                        
                        ,
                        
                           
                              u
                           
                           
                              k
                           
                        
                        )
                        ∈
                        S
                      for all 
                        k
                        ∈
                        N
                     . Since every image of the dynamic of the system stays in 
                        S
                     , a reachable state (y,u) belongs to 
                        S
                     . Finally, if we prove that 
                        S
                      is bounded then 
                        R
                      is also bounded.

Working directly on sets can be difficult and usually invariant sets are computed as a sublevel of some function to find. For (convergent) discrete-time linear systems, it is classical in the control community to compute ellipsoidal overapproximation of reachable states. Indeed, sublevel sets of Lyapunov functions are invariant sets for the analyzed linear system. Furthermore computing such an ellipsoid containing the initial states provides an overapproximation of reachable states. Initially, Lyapunov functions are used to prove quadratic asymptotic stability. In this paper, we use an analogue of Lyapunov functions for piecewise affine systems to compute directly an overapproximation of reachable states.
                        Example 2.1
                        Running example


                        Let us consider the following program. It is constituted by a single while loop with two nested conditional branches in the loop body. 
                              
                                 
                                    
                                       
                                          
                                       
                                    
                                 
                              
                           
                        

The initial condition of the piecewise affine systems is 
                              (
                              x
                              ,
                              y
                              )
                              ∈
                              [
                              −
                              9
                              ,
                              9
                              ]
                              ×
                              [
                              −
                              9
                              ,
                              9
                              ]
                            and the polytope where the input variable u lives is 
                              U
                              =
                              [
                              −
                              3
                              ,
                              3
                              ]
                           .

We can rewrite this program as a piecewise affine discrete-time dynamical systems using our notations. We give details on the matrices T
                           
                              s
                           
                           
                              i
                            and T
                           
                              w
                           
                           
                              i
                            and vectors c
                           
                              s
                           
                           
                              i
                            and c
                           
                              w
                           
                           
                              i
                            (see Eq. (2)) which characterize the cells and on the matrices F
                           
                              i
                            representing the homogeneous version (see Eq. (3)) of affine laws in the cell X
                           
                              i
                           :
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0.4217
                                             
                                             
                                                0.1077
                                             
                                             
                                                0.5661
                                             
                                          
                                          
                                             
                                                −
                                                1
                                             
                                             
                                                0.1162
                                             
                                             
                                                0.2785
                                             
                                             
                                                0.2235
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    )
                                    ,
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                (
                                                
                                                   
                                                      
                                                         
                                                            −
                                                            9
                                                         
                                                         
                                                            7
                                                         
                                                         
                                                            6
                                                         
                                                      
                                                      
                                                         
                                                            −
                                                            4
                                                         
                                                         
                                                            8
                                                         
                                                         
                                                            −
                                                            8
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                
                                                   
                                                      (
                                                      5
                                                      
                                                      4
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                    
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                (
                                                
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                
                                                   
                                                      (
                                                      3
                                                      
                                                      3
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          F
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0.4763
                                             
                                             
                                                0.0145
                                             
                                             
                                                0.9033
                                             
                                          
                                          
                                             
                                                9
                                             
                                             
                                                0.1315
                                             
                                             
                                                0.3291
                                             
                                             
                                                0.1459
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    )
                                    ,
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      2
                                                   
                                                
                                                =
                                                (
                                                
                                                   −
                                                   9
                                                   
                                                   7
                                                   
                                                   6
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      2
                                                   
                                                
                                                =
                                                5
                                             
                                          
                                       
                                    
                                    ,
                                    
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      2
                                                   
                                                
                                                =
                                                (
                                                
                                                   
                                                      
                                                         
                                                            4
                                                         
                                                         
                                                            −
                                                            8
                                                         
                                                         
                                                            8
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      2
                                                   
                                                
                                                =
                                                
                                                   
                                                      (
                                                      −
                                                      4
                                                      
                                                      3
                                                      
                                                      3
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          F
                                       
                                       
                                          3
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                −
                                                4
                                             
                                             
                                                0.2618
                                             
                                             
                                                0.1177
                                             
                                             
                                                0.0868
                                             
                                          
                                          
                                             
                                                4
                                             
                                             
                                                0.4014
                                             
                                             
                                                0.4161
                                             
                                             
                                                0.6320
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    )
                                    ,
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      3
                                                   
                                                
                                                =
                                                (
                                                
                                                   −
                                                   4
                                                   
                                                   8
                                                   
                                                   −
                                                   8
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      3
                                                   
                                                
                                                =
                                                4
                                             
                                          
                                       
                                    
                                    ,
                                    
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      3
                                                   
                                                
                                                =
                                                (
                                                
                                                   
                                                      
                                                         
                                                            9
                                                         
                                                         
                                                            −
                                                            7
                                                         
                                                         
                                                            −
                                                            6
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      2
                                                   
                                                
                                                =
                                                
                                                   
                                                      (
                                                      −
                                                      5
                                                      
                                                      3
                                                      
                                                      3
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          F
                                       
                                       
                                          4
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                10
                                             
                                             
                                                0.3874
                                             
                                             
                                                0.0771
                                             
                                             
                                                0.5153
                                             
                                          
                                          
                                             
                                                7
                                             
                                             
                                                0.2430
                                             
                                             
                                                0.4028
                                             
                                             
                                                0.4790
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    )
                                    ,
                                    
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      4
                                                   
                                                
                                                =
                                                (
                                                
                                                   
                                                      
                                                         
                                                            9
                                                         
                                                         
                                                            −
                                                            7
                                                         
                                                         
                                                            −
                                                            6
                                                         
                                                      
                                                      
                                                         
                                                            4
                                                         
                                                         
                                                            −
                                                            8
                                                         
                                                         
                                                            8
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      4
                                                   
                                                
                                                =
                                                
                                                   
                                                      (
                                                      −
                                                      5
                                                      
                                                      −
                                                      4
                                                      
                                                      3
                                                      
                                                      3
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

In [15,20], the authors proposed a method to prove stability of piecewise affine dynamical discrete-time systems. The method is a generalization of Lyapunov stability equations in the case where affine laws defining the system depend on the current state. Let A be a 
                        d
                        ×
                        d
                      matrix and let 
                        
                           
                              x
                           
                           
                              k
                              +
                              1
                           
                        
                        =
                        
                           
                              Ax
                           
                           
                              k
                           
                        
                        ,
                        
                        k
                        ∈
                        N
                        ,
                        
                        
                           
                              x
                           
                           
                              0
                           
                        
                        ∈
                        
                           
                              R
                           
                           
                              d
                           
                        
                      be a linear dynamical system.


                     Quadratic Lyapunov functions: We recall that V is a quadratic Lyapunov function iff there exists a 
                        d
                        ×
                        d
                      symmetric matrix P such that 
                        V
                        (
                        x
                        )
                        =
                        
                           
                              x
                           
                           
                              ⊤
                           
                        
                        Px
                      for all 
                        x
                        ∈
                        
                           
                              R
                           
                           
                              d
                           
                        
                      and 
                        P
                        ≻
                        0
                      and 
                        P
                        −
                        
                           
                              A
                           
                           
                              ⊤
                           
                        
                        PA
                        ≻
                        0
                     . The notation 
                        P
                        ≻
                        0
                      means that P is positive definite i.e. 
                        
                           
                              x
                           
                           
                              ⊤
                           
                        
                        Px
                        >
                        0
                      for all 
                        x
                        ∈
                        
                           
                              R
                           
                           
                              d
                           
                        
                        ,
                        
                        x
                        ≠
                        0
                      and 0 for x=0. We will denote by 
                        Q
                        ≽
                        0
                      when Q is positive semidefinite i.e. 
                        
                           
                              x
                           
                           
                              ⊤
                           
                        
                        Px
                        ≥
                        0
                      for all 
                        x
                        ∈
                        
                           
                              R
                           
                           
                              d
                           
                        
                     . Positive definite matrices characterize square of norm on 
                        
                           
                              R
                           
                           
                              d
                           
                        
                     .

A Lyapunov function allows us to prove the stability by the latter fact: the norm (associated to the Lyapunov function) of the states x
                     
                        k
                      decreases along the time. In switched system, similar to the classical case, we exhibited a positive definite matrix (square norm) to prove that the trajectories decrease along the time. The main difficulty in the switched case is the fact that we change the laws and we must decrease whenever a transition from one cell to other is fired. Moreover, we only require the norm to be local i.e. positive only where the law is used.

Therefore, our main goal is to synthesize a Lyapunov function 
                        V
                        (
                        x
                        ,
                        u
                        )
                      and an associated bound α characterizing the invariant of reachable states as a sublevel-set S
                     
                        α
                     , such that
                        
                           (5)
                           
                              ∀
                              i
                              ∈
                              I
                              ,
                              
                              ∀
                              (
                              x
                              ,
                              u
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              V
                              (
                              x
                              ,
                              u
                              )
                              ≤
                              α
                           
                        
                     
                     
                        
                           (6)
                           
                              ∀
                              i
                              ,
                              j
                              ∈
                              I
                              ,
                              
                              ∀
                              (
                              x
                              ,
                              u
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              ∀
                              (
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    u
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                              s
                              .
                              t
                              .
                              
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              =
                              
                                 
                                    A
                                 
                                 
                                    i
                                 
                              
                              x
                              +
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                              u
                              +
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              V
                              (
                              x
                              ,
                              u
                              )
                              ≥
                              V
                              (
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    u
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                        
                     
                  

In Sections 5 and 6 we will develop different approaches to synthesize such V functions based on a piecewise characterization using quadratic Lyapunov functions. The next section focuses first in the expression of conditions.

In Eqs. (5) and (6), the inequalities on V are local on cells. In (6), the function has to decrease only on feasible transitions from cell X
                     
                        i
                      to cell X
                     
                        j
                     .

In the following we will synthesize piecewise Lyapunov function using SDP solvers. Encoding local constraints requires to be able to express the positivity of a quadratic form over a polyhedron as a semidefinite constraint.

This is performed through multiple transformations: first the implication is rewritten as a copositive constraint. This copositive constraint is further relaxed as quadratic computation with a matrix with nonnegative entries. This is the quadratization of constraints.

We recall that for us local means that true on a cell and thus true on a polyhedron. Using the homogeneous version of a cell, we can define local positiveness on a polyhedral cone. Let Q be a 
                           d
                           ×
                           d
                         symmetric matrix and M be a 
                           n
                           ×
                           d
                         matrix. Local positivity in our case means that 
                           My
                           ≥
                           0
                           ⇒
                           
                              
                                 y
                              
                              
                                 ⊤
                              
                           
                           Qy
                           ≥
                           0
                        . The problem will be to write the local positivity as a constraint without implication. The problem is not new (e.g. the survey paper [14]). The paper [23] proves that local positivity is equivalent, when M has a full row rank, to 
                           Q
                           −
                           
                              
                                 M
                              
                              
                                 ⊤
                              
                           
                           CM
                           ≽
                           0
                         where C is a copositive matrix i.e. 
                           
                              
                                 x
                              
                              
                                 ⊤
                              
                           
                           Cx
                           ≥
                           0
                         if 
                           x
                           ≥
                           0
                        . First in general (when the rank of M is not necessarily equal to its number of rows), note that if 
                           Q
                           −
                           
                              
                                 M
                              
                              
                                 ⊤
                              
                           
                           CM
                           ≽
                           0
                         for some copositive matrix C then Q satisfies 
                           My
                           ≥
                           0
                           ⇒
                           
                              
                                 y
                              
                              
                                 ⊤
                              
                           
                           Qy
                           ≥
                           0
                        . Secondly every matrix C with nonnegative entries is copositive. Since copositivity seems to be as difficult as local positivity to handle, we will restrict copositive matrices to be matrices with nonnegative entries. The idea is instead of using cells as polyhedral cones, we use a quadratization of cells by introducing nonnegative entries and we will define the quadratization of a cell X
                        
                           i
                         by:
                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 {
                                 
                                    (
                                    x
                                    ,
                                    u
                                    )
                                    ∈
                                    
                                       
                                          R
                                       
                                       
                                          d
                                          +
                                          m
                                       
                                    
                                    |
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          
                                             ⊤
                                          
                                       
                                       
                                          
                                             
                                                
                                                   E
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             ⊤
                                          
                                       
                                       
                                          
                                             W
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             E
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                       ≥
                                       0
                                    
                                    }
                                 
                              
                           
                        where W
                        
                           i
                         is a 
                           (
                           1
                           +
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                           )
                           ×
                           (
                           1
                           +
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                           )
                         symmetric matrix with nonnegative entries and 
                           
                              
                                 E
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 
                                    
                                       
                                          E
                                       
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       
                                          E
                                       
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                           
                           )
                         with 
                           
                              
                                 E
                              
                              
                                 s
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                              
                                 
                                    
                                       
                                          0
                                       
                                       
                                          1
                                          ×
                                          (
                                          d
                                          +
                                          m
                                          )
                                       
                                    
                                 
                                 
                                    −
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                           
                           )
                         and 
                           
                              
                                 E
                              
                              
                                 w
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 
                                    c
                                 
                                 
                                    w
                                 
                                 
                                    i
                                 
                              
                              
                              −
                              
                                 
                                    T
                                 
                                 
                                    w
                                 
                                 
                                    i
                                 
                              
                           
                           )
                        . Recall that n
                        
                           i
                         is the number of rows of T
                        
                           i
                        . The matrix E
                        
                           i
                         is thus of the size 
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                           +
                           1
                           ×
                           (
                           1
                           +
                           d
                           +
                           m
                           )
                        . The goal of adding the row 
                           (
                           1
                           ,
                           
                              
                                 0
                              
                              
                                 1
                                 ×
                                 (
                                 d
                                 +
                                 m
                                 )
                              
                           
                           )
                         is to avoid to add the opposite of a vector of X
                        
                           i
                         in 
                           
                              
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 ¯
                              
                           
                        . Indeed without this latter vector 
                           
                              
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 ¯
                              
                           
                         would be symmetric. We illustrate this fact at Example 4.1. Note that during optimization process, matrices W
                        
                           i
                         will be decision variables. 
                           Example 4.1
                           The reason of adding the row 
                                 (
                                 1
                                 ,
                                 
                                    
                                       0
                                    
                                    
                                       1
                                       ×
                                       (
                                       d
                                       +
                                       m
                                       )
                                    
                                 
                                 )
                              
                           


                           Let us take the polyhedra 
                                 X
                                 =
                                 {
                                 x
                                 ∈
                                 R
                                 ∣
                                 x
                                 ≤
                                 1
                                 }
                              . Using our notations, we have 
                                 X
                                 =
                                 {
                                 x
                                 ∣
                                 M
                                 
                                    
                                       (
                                       1
                                       
                                       x
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 ≥
                                 0
                                 }
                               with 
                                 M
                                 =
                                 (
                                 1
                                 
                                 −
                                 1
                                 )
                              . Let us consider two cases, the first one without adding the row and the second one using it.

Without any modification, the quadratization of X relative to a nonnegative real W is 
                                 
                                    
                                       X
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 {
                                 x
                                 ∣
                                 (
                                 1
                                 
                                 x
                                 )
                                 
                                    
                                       M
                                    
                                    
                                       ⊤
                                    
                                 
                                 WM
                                 
                                    
                                       (
                                       1
                                       
                                       x
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 ≥
                                 0
                                 }
                              . But 
                                 (
                                 1
                                 
                                 x
                                 )
                                 
                                    
                                       M
                                    
                                    
                                       ⊤
                                    
                                 
                                 WM
                                 
                                    
                                       (
                                       1
                                       
                                       x
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 =
                                 W
                                 (
                                 1
                                 
                                 x
                                 )
                                 
                                    
                                       (
                                       1
                                       
                                       −
                                       1
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 1
                                 
                                 −
                                 1
                                 )
                                 
                                    
                                       (
                                       1
                                       
                                       x
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 =
                                 2
                                 W
                                 
                                    
                                       (
                                       1
                                       −
                                       x
                                       )
                                    
                                    
                                       2
                                    
                                 
                              . Hence 
                                 
                                    
                                       X
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 R
                               for all nonnegative real W.

Now let us take 
                                 E
                                 =
                                 (
                                 
                                    
                                       
                                          1
                                       
                                       
                                          1
                                       
                                    
                                    
                                    
                                       
                                          0
                                       
                                       
                                          −
                                          1
                                       
                                    
                                 
                                 )
                              . The quadratization as defined by Eq. (7) relative to a 2×2 symmetric matrix W with nonnegative coefficients is 
                                 
                                    
                                       X
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 {
                                 x
                                 ∣
                                 (
                                 1
                                 
                                 x
                                 )
                                 
                                    
                                       E
                                    
                                    
                                       ⊤
                                    
                                 
                                 WE
                                 
                                    
                                       (
                                       1
                                       
                                       x
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 ≥
                                 0
                                 }
                              . We have: 
                                 
                                    
                                       (
                                       1
                                       
                                       x
                                       )
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       )
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   0
                                                
                                             
                                             
                                                
                                                   1
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                       
                                          
                                             (
                                             1
                                             
                                             x
                                             )
                                          
                                          
                                             ⊤
                                          
                                       
                                       =
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       2
                                       
                                          
                                             w
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       1
                                       −
                                       x
                                       )
                                       +
                                       
                                          
                                             w
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             (
                                             1
                                             −
                                             x
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       .
                                    
                                 
                              To take a matrix W such that 
                                 
                                    
                                       w
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 0
                               and 
                                 
                                    
                                       w
                                    
                                    
                                       3
                                    
                                 
                                 >
                                 0
                               implies that 
                                 
                                    
                                       X
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 X
                              .

Now we introduce an example of the quadratization of the cell X
                        1 for our running example.
                           Example 4.2
                           Let us consider the running example and the cell X
                              1. We recall that X
                              1 is characterized by the matrices and vectors: 
                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   =
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               −
                                                               9
                                                            
                                                            
                                                               7
                                                            
                                                            
                                                               6
                                                            
                                                         
                                                         
                                                            
                                                               −
                                                               4
                                                            
                                                            
                                                               8
                                                            
                                                            
                                                               −
                                                               8
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         (
                                                         5
                                                         
                                                         4
                                                         )
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ,
                                       
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         w
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   =
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               0
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               0
                                                            
                                                            
                                                               −
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         w
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         (
                                                         3
                                                         
                                                         3
                                                         )
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              and 
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             1
                                          
                                       
                                       =
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                             
                                             
                                                
                                                   5
                                                
                                                
                                                   9
                                                
                                                
                                                   −
                                                   7
                                                
                                                
                                                   −
                                                   6
                                                
                                             
                                             
                                                
                                                   4
                                                
                                                
                                                   4
                                                
                                                
                                                   −
                                                   8
                                                
                                                
                                                   8
                                                
                                             
                                             
                                                
                                                   3
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   3
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           

As suggested we have added the row 
                                 (
                                 1
                                 ,
                                 
                                    
                                       0
                                    
                                    
                                       1
                                       ×
                                       3
                                    
                                 
                                 )
                              . Take for example the matrix: 
                                 
                                    
                                       
                                          
                                             W
                                          
                                          
                                             1
                                          
                                       
                                       =
                                       (
                                       
                                          
                                             
                                                
                                                   63.0218
                                                
                                                
                                                   0.0163
                                                
                                                
                                                   0.0217
                                                
                                                
                                                   12.1557
                                                
                                                
                                                   8.8835
                                                
                                             
                                             
                                                
                                                   0.0163
                                                
                                                
                                                   0.0000
                                                
                                                
                                                   0.0000
                                                
                                                
                                                   0.0267
                                                
                                                
                                                   0.0031
                                                
                                             
                                             
                                                
                                                   0.0217
                                                
                                                
                                                   0.0000
                                                
                                                
                                                   0.0000
                                                
                                                
                                                   0.0094
                                                
                                                
                                                   0.0061
                                                
                                             
                                             
                                                
                                                   12.1557
                                                
                                                
                                                   0.0267
                                                
                                                
                                                   0.0094
                                                
                                                
                                                   4.2011
                                                
                                                
                                                   59.5733
                                                
                                             
                                             
                                                
                                                   8.8835
                                                
                                                
                                                   0.0031
                                                
                                                
                                                   0.0061
                                                
                                                
                                                   59.5733
                                                
                                                
                                                   3.0416
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              We have 
                                 
                                    
                                       
                                          
                                             X
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 {
                                 (
                                 x
                                 ,
                                 y
                                 ,
                                 u
                                 )
                                 ∣
                                 (
                                 1
                                 ,
                                 x
                                 ,
                                 y
                                 ,
                                 u
                                 )
                                 
                                    
                                       E
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       W
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       (
                                       1
                                       ,
                                       x
                                       ,
                                       y
                                       ,
                                       u
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 ≥
                                 0
                                 }
                                 ⊇
                                 
                                    
                                       X
                                    
                                    
                                       1
                                    
                                 
                              . In Section 7, we will come back on the generation of W
                              1.

Local positivity of quadratic forms will also be used when a transition from a cell to an other is fired. For the moment, we are interested in the set of (x,u) such that 
                           (
                           x
                           ,
                           u
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                         and whose the image is in X
                        
                           j
                         and we denote by X
                        
                           ij
                         the set: 
                           
                              
                                 {
                                 
                                    (
                                    x
                                    ,
                                    u
                                    )
                                    ∈
                                    
                                       
                                          R
                                       
                                       
                                          d
                                          +
                                          m
                                       
                                    
                                    |
                                    
                                       (
                                       x
                                       ,
                                       u
                                       )
                                       ∈
                                       
                                          
                                             X
                                          
                                          
                                             i
                                          
                                       
                                       
                                       and
                                       
                                       (
                                       
                                          
                                             A
                                          
                                          
                                             i
                                          
                                       
                                       x
                                       +
                                       
                                          
                                             B
                                          
                                          
                                             i
                                          
                                       
                                       u
                                       +
                                       
                                          
                                             b
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       u
                                       )
                                       ∈
                                       
                                          
                                             X
                                          
                                          
                                             j
                                          
                                       
                                    
                                    }
                                 
                              
                           
                        for all pairs 
                           i
                           ,
                           j
                           ∈
                           I
                        . We will discuss in Section 4.2 the computation or a reduction to possible switches using linear programming as suggested in [5]. To construct a quadratization of X
                        
                           ij
                        , we use the same approach as before by introducing a 
                           (
                           1
                           +
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                           +
                           
                              
                                 n
                              
                              
                                 j
                              
                           
                           )
                           ×
                           (
                           1
                           +
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                           +
                           
                              
                                 n
                              
                              
                                 j
                              
                           
                           )
                         symmetric matrix U
                        
                           ij
                         with nonnegative entries to get a set 
                           
                              
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                 
                              
                              
                                 ¯
                              
                           
                         defined as:
                           
                              (8)
                              
                                 
                                    
                                       
                                          
                                             X
                                          
                                          
                                             ij
                                          
                                       
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 {
                                 
                                    (
                                    x
                                    ,
                                    u
                                    )
                                    ∈
                                    
                                       
                                          R
                                       
                                       
                                          d
                                          +
                                          m
                                       
                                    
                                    |
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          
                                             ⊤
                                          
                                       
                                       
                                          
                                             
                                                
                                                   E
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                          
                                             ⊤
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             ij
                                          
                                       
                                       
                                          
                                             E
                                          
                                          
                                             ij
                                          
                                       
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                       ≥
                                       0
                                    
                                    }
                                 
                              
                           
                        where 
                           
                              
                                 E
                              
                              
                                 ij
                              
                           
                           =
                           (
                           
                              
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             s
                                          
                                          
                                             ij
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             w
                                          
                                          
                                             ij
                                          
                                       
                                    
                                 
                              
                           
                           )
                         with 
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       s
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                   ×
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   s
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   s
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   s
                                                
                                                
                                                   j
                                                
                                             
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   s
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   s
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               A
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               B
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               d
                                                               ×
                                                               m
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               Id
                                                            
                                                            
                                                               m
                                                               ×
                                                               m
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        and
                           
                              (9)
                              
                                 
                                    
                                       E
                                    
                                    
                                       w
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   w
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   w
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   w
                                                
                                                
                                                   j
                                                
                                             
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   w
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   w
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               A
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               B
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               d
                                                               ×
                                                               m
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               Id
                                                            
                                                            
                                                               m
                                                               ×
                                                               m
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        
                     

We have to manage another constraint which comes from the cell switches. After applying the available law in cell X
                        
                           i
                        , we have to specify the reachable cells i.e. the cells X
                        
                           j
                         such that there exists (x,u) satisfying: 
                           
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 
                                 and
                                 
                                 (
                                 
                                    
                                       A
                                    
                                    
                                       i
                                    
                                 
                                 x
                                 +
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 u
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        We say that a switch from i to j is fireable iff:
                           
                              (10)
                              
                                 {
                                 
                                    (
                                    x
                                    ,
                                    u
                                    )
                                    ∈
                                    
                                       
                                          R
                                       
                                       
                                          d
                                          +
                                          m
                                       
                                    
                                    |
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      (
                                                      x
                                                      ,
                                                      u
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                                ⪡
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      j
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            A
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      x
                                                      +
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      u
                                                      +
                                                      
                                                         
                                                            b
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      u
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                                ⪡
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      (
                                                      x
                                                      ,
                                                      u
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                                ≤
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      j
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            A
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      x
                                                      +
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      u
                                                      +
                                                      
                                                         
                                                            b
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      u
                                                      )
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                                ≤
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      w
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                    
                                    }
                                 
                                 ≠
                                 ∅
                              
                           
                        We will denote by 
                           i
                           →
                           j
                         if the switch from i to j is fireable and we denote by Sw the set of fireable switches i.e. 
                           Sw
                           =
                           {
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           
                              
                                 I
                              
                              
                                 2
                              
                           
                           ∣
                           i
                           →
                           j
                           }
                        . Recall that the symbol 
                           <
                         means that we can deal with both strict inequalities and inequalities. To check whether 
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           Sw
                         is a linear programming feasibility problem with both strict and weak inequalities. However, we only check whether the system is solvable and we can detect infeasibility by using Motzkin transposition theorem [24]. Motzkin׳s theorem is an alternative type theorem: it considers two alternative linear systems such that exactly one of them is feasible. To describe the alternative system, we have to separate strict and weak inequalities and use the matrices E
                        
                           s
                        
                        
                           ij
                         and E
                        
                           w
                        
                        
                           ij
                         defined at Eq. (9). Then 
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           Sw
                         is equivalent to check whether the set 
                           {
                           y
                           ∈
                           
                              
                                 R
                              
                              
                                 1
                                 +
                                 d
                                 +
                                 m
                              
                           
                           ∣
                           
                              
                                 E
                              
                              
                                 w
                              
                              
                                 ij
                              
                           
                           y
                           ≥
                           0
                           ,
                           
                           
                              
                                 E
                              
                              
                                 s
                              
                              
                                 ij
                              
                           
                           y
                           ⪢
                           0
                           }
                         is empty or not. To detect feasibility we test the infeasibility of the alternative system defined by:
                           
                              (11)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         ij
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   p
                                                
                                                
                                                   s
                                                
                                             
                                             +
                                             
                                                
                                                   (
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         w
                                                      
                                                      
                                                         ij
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   p
                                                
                                                
                                                   w
                                                
                                             
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                      ∈
                                                      
                                                         
                                                            I
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            s
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   p
                                                
                                                
                                                   k
                                                
                                                
                                                   s
                                                
                                             
                                             =
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   p
                                                
                                                
                                                   k
                                                
                                                
                                                   s
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                             ∀
                                             k
                                             ∈
                                             
                                                
                                                   I
                                                
                                                
                                                   i
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   p
                                                
                                                
                                                   k
                                                
                                                
                                                   w
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                             ∀
                                             k
                                             ∉
                                             
                                                
                                                   I
                                                
                                                
                                                   i
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        From Motzkin׳s transposition theorem [24], we get the following proposition. 
                           Proposition 4.1
                           
                              The pair 
                              
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 Sw
                               
                              iff Problem 
                              (11) 
                              is not feasible.

However reasoning directly on the matrices can allow unfireable switches. For certain initial conditions, for all 
                           k
                           ∈
                           N
                        , the condition 
                           (
                           
                              
                                 x
                              
                              
                                 k
                              
                           
                           ,
                           
                              
                                 u
                              
                              
                                 k
                              
                           
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           
                           and
                           
                           (
                           
                              
                                 A
                              
                              
                                 i
                              
                           
                           
                              
                                 x
                              
                              
                                 k
                              
                           
                           +
                           
                              
                                 B
                              
                              
                                 i
                              
                           
                           u
                           +
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ,
                           u
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                         does not hold whereas 
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           Sw
                        . To avoid it, we must know all the possible trajectories of the system (which we want to compute) and remove all inactivated switches. A sound way to underapproximate unfireable transitions is to identify unsatisfiable sets of linear constraints.
                           Example 4.3
                           We continue to detail our running example. More precisely, we consider the possible switches. We take for example the cell X
                              2. To switch from cell X
                              2 to cell X
                              1 is possible if the following system of linear inequalities has a solution:
                                 
                                    (12)
                                    
                                       −
                                       9
                                       x
                                       +
                                       7
                                       y
                                       +
                                       6
                                       u
                                       <
                                       5
                                       −
                                       0.8532
                                       x
                                       +
                                       2.5748
                                       y
                                       −
                                       10.4460
                                       <
                                       −
                                       68
                                       −
                                       3.3662
                                       x
                                       +
                                       2.1732
                                       y
                                       −
                                       1.1084
                                       u
                                       <
                                       −
                                       58
                                       
                                          
                                       
                                       4
                                       x
                                       −
                                       8
                                       y
                                       +
                                       8
                                       u
                                       ≤
                                       −
                                       4
                                       
                                       u
                                       ≤
                                       3
                                       −
                                       u
                                       ≤
                                       3
                                    
                                 
                              The two first consists in constraining the image of 
                                 (
                                 x
                                 ,
                                 y
                                 ,
                                 u
                                 )
                               to belong to X
                              1 and the four last constraints correspond to the definition of X
                              2. The representation of these two sets (X
                              2 and the preimage of X
                              1 by the law defined in X
                              2) is given at Fig. 1
                              . We see in Fig. 1 that the system of inequalities defined at Eq. (12) seems to not have solutions. We check that using Eq. (11) and Proposition 4.1. The matrices E
                              
                                 s
                              
                              
                                 ij
                               and E
                              
                                 w
                              
                              
                                 ij
                               of Eq. (11) are in this example: 
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             s
                                          
                                          
                                             21
                                          
                                       
                                       =
                                       (
                                       
                                          
                                             
                                                
                                                   5
                                                
                                                
                                                   9
                                                
                                                
                                                   −
                                                   7
                                                
                                                
                                                   −
                                                   6
                                                
                                             
                                             
                                                
                                                   −
                                                   68
                                                
                                                
                                                   0.8532
                                                
                                                
                                                   −
                                                   2.5748
                                                
                                                
                                                   10.446
                                                
                                             
                                             
                                                
                                                   −
                                                   58
                                                
                                                
                                                   3.3662
                                                
                                                
                                                   −
                                                   2.1732
                                                
                                                
                                                   1.1084
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              and 
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             w
                                          
                                          
                                             21
                                          
                                       
                                       =
                                       (
                                       
                                          
                                             
                                                
                                                   −
                                                   4
                                                
                                                
                                                   −
                                                   4
                                                
                                                
                                                   8
                                                
                                                
                                                   −
                                                   8
                                                
                                             
                                             
                                                
                                                   3
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   3
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              We thus solve the linear program defined in Eq. (11) (with Matlab and Linprog) and we found that 
                                 p
                                 =
                                 
                                    
                                       (
                                       0.8735
                                       ,
                                       0.0983
                                       ,
                                       0.0282
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                               and 
                                 q
                                 =
                                 
                                    
                                       (
                                       0.3325
                                       ,
                                       14.2500
                                       ,
                                       7.8461
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                              . This means that the alternative system is feasible and consequently the initial is not from Proposition 4.1. Finally the transition from X
                              2 to X
                              1 is not possible.

Now we adapt the work of Rantzer and Johansson [15] and the work of Mignone et al. [20] to compute an invariant set for switched systems i.e. a subset 
                        S
                      such that 
                        (
                        
                           
                              x
                           
                           
                              k
                           
                        
                        ,
                        u
                        )
                        ∈
                        S
                      implies 
                        (
                        
                           
                              x
                           
                           
                              k
                              +
                              1
                           
                        
                        ,
                        u
                        )
                        ∈
                        S
                     . These works are instead focused on deciding whether a piecewise affine system is global asymptotic convergent (GAS) or not. Even if the GAS problem is undecidable [3] the latter authors prove a stronger property on the system: there exists a piecewise Lyapunov functions for the piecewise affine systems. Rantzer and Johansson [15] and Mignone et al. [20] suggest to compute a piecewise quadratic function as Lyapunov function in the case of discrete-time piecewise affine systems to prove GAS property. Recall that a piecewise quadratic function on 
                        
                           
                              R
                           
                           
                              d
                           
                        
                      is a function defined on a polyhedric partition of 
                        
                           
                              R
                           
                           
                              d
                           
                        
                      which is quadratic on each polyhedron of the partition. In this paper, we propose to compute a (weaker) piecewise Lyapunov function to characterize an invariant set for our piecewise affine systems. In this section, we will denote by V this function. The pieces are given by the cells of the piecewise affine system and thus V is defined as:
                        
                           
                              V
                              (
                              x
                              ,
                              u
                              )
                              =
                              
                                 
                                    V
                                 
                                 
                                    i
                                 
                              
                              (
                              x
                              ,
                              u
                              )
                              ,
                              
                              if
                              
                              (
                              x
                              ,
                              u
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    (
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             
                                                u
                                             
                                          
                                       
                                    
                                    )
                                 
                                 
                                    ⊤
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       
                                          u
                                       
                                    
                                 
                              
                              )
                              +
                              2
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    ⊤
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       
                                          u
                                       
                                    
                                 
                              
                              )
                              ,
                              
                              if
                              
                              (
                              x
                              ,
                              u
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                           
                        
                     The function V
                     
                        i
                      is thus a local function only defined on X
                     
                        i
                     .

A sublevel set 
                        
                           
                              S
                           
                           
                              α
                           
                        
                      of V of level 
                        α
                        ∈
                        R
                      is represented as: 
                        
                           
                              
                                 
                                    S
                                 
                                 
                                    α
                                 
                              
                              =
                              
                                 
                                    
                                       ⋃
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              
                                 
                                    S
                                 
                                 
                                    i
                                    ,
                                    α
                                 
                              
                              =
                              
                                 
                                    
                                       ⋃
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              {
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ∣
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 2
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 x
                                 ≤
                                 α
                              
                              }
                              =
                              
                                 
                                    
                                       ⋃
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              {
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ∣
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             −
                                             α
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                       
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 )
                                 ≤
                                 0
                              
                              }
                              .
                           
                        
                     The set 
                        
                           
                              S
                           
                           
                              i
                              ,
                              α
                           
                        
                      is thus the local sublevel set of V
                     
                        i
                      associated to the level α.

So we are looking a family of pairs of a matrix and a vector 
                        
                           
                              {
                              (
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                              
                              )
                              }
                           
                           
                              i
                              ∈
                              I
                           
                        
                      and a real 
                        α
                        ∈
                        R
                      such that 
                        
                           
                              S
                           
                           
                              α
                           
                        
                      is invariant by the piecewise affine system. To obtain invariance property, we have to constraint 
                        
                           
                              S
                           
                           
                              α
                           
                        
                      to contain initial conditions of the system. Finally, to prove that the reachable set is bounded, we have to constraint 
                        
                           
                              S
                           
                           
                              α
                           
                        
                      to be bounded.

Before deriving the semi-definite constraints, let us first state a useful result in Proposition 5.1. This result allows us to encode implications into semi-definite constraint in a safe way. The implication must involve quadratic inequalities on both sides. 
                        Proposition 5.1
                        
                           Let 
                           
                              A
                              ,
                              B
                              ,
                              C
                            
                           be 
                           
                              d
                              ×
                              d
                            
                           matrices. Then 
                           
                              C
                              +
                              A
                              +
                              B
                              ≽
                              0
                            
                           holds implies that the implication 
                           
                              (
                              
                                 
                                    y
                                 
                                 
                                    ⊤
                                 
                              
                              Ay
                              ≤
                              0
                              ∧
                              
                                 
                                    y
                                 
                                 
                                    ⊤
                                 
                              
                              
                              By
                              ≤
                              0
                              )
                              ⇒
                              
                                 
                                    y
                                 
                                 
                                    ⊤
                                 
                              
                              Cy
                              ≥
                              0
                            
                           holds.

Suppose that 
                              C
                              +
                              A
                              +
                              B
                              ≽
                              0
                           . It is equivalent to say 
                              
                                 
                                    y
                                 
                                 
                                    ⊤
                                 
                              
                              (
                              C
                              +
                              A
                              +
                              B
                              )
                              y
                              ≥
                              0
                            for all 
                              y
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    d
                                 
                              
                           . Now pick 
                              z
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    d
                                 
                              
                            such that 
                              
                                 
                                    z
                                 
                                 
                                    ⊤
                                 
                              
                              Az
                              ≤
                              0
                            and 
                              
                                 
                                    z
                                 
                                 
                                    ⊤
                                 
                              
                              Bz
                              ≤
                              0
                           . Since 
                              
                                 
                                    z
                                 
                                 
                                    ⊤
                                 
                              
                              Cz
                              ≥
                              −
                              
                                 
                                    z
                                 
                                 
                                    ⊤
                                 
                              
                              Az
                              −
                              
                                 
                                    z
                                 
                                 
                                    ⊤
                                 
                              
                              Bz
                           , we conclude that 
                              
                                 
                                    z
                                 
                                 
                                    ⊤
                                 
                              
                              Cz
                              ≥
                              0
                            and the implication is true.□

We assume that 
                           (
                           x
                           ,
                           u
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           ∩
                           
                              
                                 S
                              
                              
                                 i
                                 ,
                                 α
                              
                           
                         (this index i is unique). Invariance means that if we apply the available law to (x,u) and suppose that the image of (x,u) belongs to some cell X
                        
                           j
                         (notation 
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           Sw
                        ), then the image of (x,u) belongs to 
                           
                              
                                 S
                              
                              
                                 j
                                 ,
                                 α
                              
                           
                        . Note that 
                           (
                           x
                           ,
                           u
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                         and its image is supposed to be in X
                        
                           j
                         then 
                           (
                           x
                           ,
                           u
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 ij
                              
                           
                        . Let 
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           Sw
                        , invariance translated in inequalities and implication gives:
                           
                              (13)
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                 
                                 ∧
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       i
                                       ,
                                       α
                                    
                                 
                                 ⇒
                                 (
                                 
                                    
                                       A
                                    
                                    
                                       i
                                    
                                 
                                 x
                                 +
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 u
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       j
                                       ,
                                       α
                                    
                                 
                              
                           
                        We can use the relaxation of Section 4.1 as representation of cells and use matrix variables W
                        
                           i
                         and U
                        
                           ij
                         to encode their quadratization. We get:
                           
                              (14)
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             ij
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       ij
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                       
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 )
                                 ≥
                                 0
                                 ∧
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             −
                                             α
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                       
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 )
                                 ≤
                                 0
                                 ⇒
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             
                                                F
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          ⊤
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                −
                                                α
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                   
                                                      ⊤
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                    
                                    )
                                    
                                       
                                          F
                                       
                                       
                                          i
                                       
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                       
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 )
                                 ≤
                                 0
                              
                           
                        where E
                        
                           ij
                         is the matrix defined at Eq. (8) and F
                        
                           i
                         is defined at Eq. (3).

Finally, we obtain a stronger condition by considering semi-definite constraint such as the following equation:
                           
                              (15)
                              
                                 −
                                 
                                    
                                       
                                          
                                             F
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 
                                    
                                       F
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 −
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             ij
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       ij
                                    
                                 
                                 ≽
                                 0
                                 .
                              
                           
                        Note that the symbol 
                           −
                           α
                         is canceled during the computation.


                        Proposition 5.1 proves that if 
                           (
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 P
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 U
                              
                              
                                 ij
                              
                           
                           )
                         is a solution of Eq. (15) then 
                           (
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 P
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 U
                              
                              
                                 ij
                              
                           
                           )
                         satisfies Eq. (14).

Inductive invariants require both inductiveness and initial conditions. We address here the additional constraint for our computed invariant to contain initial states. Recall that possible initial conditions belong to some compact polyhedron 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           =
                           {
                           (
                           x
                           ,
                           u
                           )
                           ∈
                           
                              
                                 R
                              
                              
                                 d
                                 +
                                 m
                              
                           
                           ∣
                           
                              
                                 T
                              
                              
                                 w
                              
                              
                                 0
                              
                           
                           (
                           x
                           ,
                           u
                           )
                           ≤
                           
                              
                                 c
                              
                              
                                 w
                              
                              
                                 0
                              
                           
                           ,
                           
                           
                              
                                 T
                              
                              
                                 s
                              
                              
                                 0
                              
                           
                           (
                           x
                           ,
                           u
                           )
                           ⪡
                           
                              
                                 c
                              
                              
                                 s
                              
                              
                                 0
                              
                           
                           }
                        . We must have 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ⊆
                           
                              
                                 S
                              
                              
                                 α
                              
                           
                        . Since 
                           {
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           ,
                           i
                           ∈
                           I
                           }
                         defines a partition of 
                           
                              
                                 R
                              
                              
                                 d
                                 +
                                 m
                              
                           
                        , X
                        0 is the union over 
                           i
                           ∈
                           I
                         of the sets 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                        . If, for all 
                           i
                           ∈
                           I
                        , the set 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                         is contained in 
                           
                              
                                 S
                              
                              
                                 i
                                 ,
                                 α
                              
                           
                         then 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ⊆
                           
                              
                                 S
                              
                              
                                 α
                              
                           
                        . Let us denote by Init the set of indices whose the cell meets X
                        0 i.e. 
                           Init
                           =
                           {
                           i
                           ∈
                           I
                           ∣
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           ≠
                           ∅
                           }
                        . We can use the same method as before to express that for all 
                           i
                           ∈
                           Init
                        , 
                           
                              
                                 S
                              
                              
                                 i
                                 ,
                                 α
                              
                           
                         must contain 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                        . Now let us take 
                           i
                           ∈
                           Init
                        . In term of implications, 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           ⊆
                           
                              
                                 S
                              
                              
                                 i
                                 ,
                                 α
                              
                           
                         can be rewritten as:
                           
                              (16)
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       0
                                    
                                 
                                 ∩
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ⇒
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 
                                    
                                       P
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       (
                                       x
                                       ,
                                       u
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 +
                                 2
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ≤
                                 α
                              
                           
                        Since 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                         is a polyhedra, it admits some quadratization that is: 
                           
                              
                                 
                                    
                                       X
                                    
                                    
                                       0
                                    
                                 
                                 ∩
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 ¯
                              
                           
                           =
                           {
                           (
                           x
                           ,
                           u
                           )
                           ∈
                           
                              
                                 R
                              
                              
                                 d
                                 +
                                 m
                              
                           
                           ∣
                           (
                           1
                           ,
                           x
                           ,
                           u
                           )
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       0
                                       i
                                    
                                 
                              
                              
                                 ⊤
                              
                           
                           
                              
                                 Z
                              
                              
                                 i
                              
                           
                           
                              
                                 E
                              
                              
                                 0
                                 i
                              
                           
                           
                              
                                 (
                                 1
                                 ,
                                 x
                                 ,
                                 u
                                 )
                              
                              
                                 ⊤
                              
                           
                           ≥
                           0
                           }
                         where 
                           
                              
                                 E
                              
                              
                                 0
                                 i
                              
                           
                           =
                           (
                           
                              
                                 
                                    
                                       
                                          E
                                       
                                       
                                          s
                                       
                                       
                                          0
                                          i
                                       
                                    
                                 
                                 
                                    
                                       
                                          E
                                       
                                       
                                          w
                                       
                                       
                                          0
                                          i
                                       
                                    
                                 
                              
                           
                           )
                         with: 
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       w
                                    
                                    
                                       0
                                       i
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   w
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   w
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   w
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   w
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 
                                 and
                                 
                                 
                                    
                                       E
                                    
                                    
                                       s
                                    
                                    
                                       0
                                       i
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                   ×
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   s
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   s
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   s
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   T
                                                
                                                
                                                   s
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        and Z
                        
                           i
                         is some symmetric matrix whose coefficients are nonnegative.

Then, we obtain a stronger notion by introducing semi-definite constraints:
                           
                              (17)
                              
                                 −
                                 (
                                 
                                    
                                       
                                          
                                             −
                                             α
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 −
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             0
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       Z
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       0
                                       i
                                    
                                 
                                 ≽
                                 0
                              
                           
                        
                        Proposition 5.1 proves that if 
                           (
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 Z
                              
                              
                                 i
                              
                           
                           )
                         is a solution of Eq. (17) then 
                           (
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           )
                         satisfies Eq. (16).

Note since 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                         is a polyhedron then its emptiness can be decided by checking the feasibility of the linear problem (18) and by using of the same argument than Proposition 4.1
                        
                           
                              (18)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         0
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   p
                                                
                                                
                                                   s
                                                
                                             
                                             +
                                             
                                                
                                                   (
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         w
                                                      
                                                      
                                                         0
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                
                                                   ⊤
                                                
                                             
                                             
                                                
                                                   p
                                                
                                                
                                                   w
                                                
                                             
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                      ∈
                                                      
                                                         
                                                            I
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            s
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   p
                                                
                                                
                                                   k
                                                
                                                
                                                   s
                                                
                                             
                                             =
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   p
                                                
                                                
                                                   k
                                                
                                                
                                                   s
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                             ∀
                                             k
                                             ∈
                                             
                                                
                                                   I
                                                
                                                
                                                   i
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   p
                                                
                                                
                                                   i
                                                
                                                
                                                   w
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                             ∀
                                             k
                                             ∉
                                             
                                                
                                                   I
                                                
                                                
                                                   i
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Linear program (18) is feasible iff 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           =
                           ∅
                         (notation 
                           i
                           ∈
                           Init
                        ).

The sublevel 
                           
                              
                                 S
                              
                              
                                 α
                              
                           
                         is bounded if and only if for all 
                           i
                           ∈
                           I
                        , the sublevel 
                           
                              
                                 S
                              
                              
                                 i
                                 ,
                                 α
                              
                           
                         is bounded. The boundedness constraint in term of implications is, for all 
                           i
                           ∈
                           I
                        , there exists 
                           β
                           ≥
                           0
                        :
                           
                              (19)
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ∧
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       i
                                       ,
                                       α
                                    
                                 
                                 ⇒
                                 ∥
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 
                                    
                                       ∥
                                    
                                    
                                       2
                                    
                                    
                                       2
                                    
                                 
                                 ≤
                                 β
                              
                           
                        where 
                           ∥
                           ·
                           
                              
                                 ∥
                              
                              
                                 2
                              
                           
                         denotes the Euclidian norm of 
                           
                              
                                 R
                              
                              
                                 d
                                 +
                                 m
                              
                           
                        .

As invariance, we use the quadratization of X
                        
                           i
                         and the definition of 
                           
                              
                                 S
                              
                              
                                 i
                                 ,
                                 α
                              
                           
                        . We use the fact that 
                           ∥
                           (
                           x
                           ,
                           u
                           )
                           
                              
                                 ∥
                              
                              
                                 2
                              
                              
                                 2
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       
                                          x
                                       
                                       
                                          u
                                       
                                    
                                 
                                 )
                              
                              
                                 ⊤
                              
                           
                           
                              
                                 Id
                              
                              
                                 (
                                 d
                                 +
                                 m
                                 )
                                 ×
                                 (
                                 d
                                 +
                                 m
                                 )
                              
                           
                           (
                           
                              
                                 
                                    x
                                 
                                 
                                    u
                                 
                              
                           
                           )
                         and we get for all 
                           i
                           ∈
                           I
                        :
                           
                              (20)
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       W
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                       
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 )
                                 ≥
                                 0
                                 
                                 and
                                 
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             −
                                             α
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                       
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 )
                                 ≤
                                 0
                                 ⇒
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   u
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             −
                                             β
                                          
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                   ×
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                   ×
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                
                                                   Id
                                                
                                                
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                   ×
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       
                                          
                                             1
                                          
                                       
                                       
                                          
                                             x
                                          
                                       
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 )
                                 ≤
                                 0
                              
                           
                        where E
                        
                           i
                         is defined in Eq. (7).

Finally, as invariance we obtain a stronger condition by considering semi-definite constraint such as Eq. (21). Proposition 5.1 proves that 
                           (
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 W
                              
                              
                                 i
                              
                           
                           )
                         is a solution of Eq. (21) then 
                           (
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 W
                              
                              
                                 i
                              
                           
                           )
                         satisfies Eq. (20). For all 
                           i
                           ∈
                           I
                        :
                           
                              (21)
                              
                                 −
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       W
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       
                                          
                                             −
                                             α
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 (
                                 
                                    
                                       
                                          
                                             β
                                          
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                   ×
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                   ×
                                                   1
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   Id
                                                
                                                
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                   ×
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 ≽
                                 0
                              
                           
                        
                     


                        Algorithm 1 aims to prove the boundedness of the reachable values set of systems of the form (1). 
                           Algorithm 1
                           
                              
                                 
                                    1.
                                    Define the real variables 
                                          α
                                          ,
                                          β
                                       ;

For 
                                          i
                                          ∈
                                          I
                                       , compute the matrix E
                                       
                                          i
                                        of Eq. (7); define the variable P
                                       
                                          i
                                        as a symmetric matrix of size 
                                          (
                                          d
                                          +
                                          m
                                          )
                                          ×
                                          (
                                          d
                                          +
                                          m
                                          )
                                       , the variable matrix W
                                       
                                          i
                                        with nonnegative coefficients of size 
                                          (
                                          ♯
                                          
                                          lines
                                          
                                          of
                                          
                                          
                                             
                                                E
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          ×
                                          (
                                          ♯
                                          lines
                                          
                                          of
                                          
                                          
                                             
                                                E
                                             
                                             
                                                i
                                             
                                          
                                          )
                                        and add the constraint (21). If 
                                          i
                                          ∈
                                          Init
                                       , define a the variable matrix Z
                                       
                                          i
                                        with nonnegative coefficients of size 
                                          (
                                          ♯
                                          lines
                                          
                                          of
                                          
                                          
                                             
                                                E
                                             
                                             
                                                0
                                                i
                                             
                                          
                                          )
                                          ×
                                          (
                                          ♯
                                          lines
                                          
                                          of
                                          
                                          
                                             
                                                E
                                             
                                             
                                                0
                                                i
                                             
                                          
                                          )
                                        and add Constraint (17);

For all 
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          Sw
                                       , construct the matrix E
                                       
                                          ij
                                        defined by Eq. (8) and define the symmetric matrix variable 
                                          
                                             
                                                U
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                        of the size 
                                          (
                                          ♯
                                          lines
                                          
                                          of
                                          
                                          
                                             
                                                E
                                             
                                             
                                                ij
                                             
                                          
                                          )
                                          ×
                                          (
                                          ♯
                                          lines
                                          
                                          of
                                          
                                          
                                             
                                                E
                                             
                                             
                                                ij
                                             
                                          
                                          )
                                        with nonnegative coefficients and add the constraint (15);

Add as linear objective function the sum of α and β to minimize;

Solve the semi-definite program.


                              Let 
                              
                                 R
                               
                              be the reachable values set of a given piecewise affine system of the form 
                              (1) 
                              and 
                              
                                 U
                               
                              be the bounded compact convex polyhedron where the control variable u lives. Assume that the SDP problem solved at 
                              
                                 Algorithm 1 
                              has a solution 
                              
                                 (
                                 
                                    {
                                    
                                       
                                          P
                                       
                                       
                                          opt
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          q
                                       
                                       
                                          opt
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    i
                                    ∈
                                    I
                                    }
                                    ,
                                    {
                                    
                                       
                                          Z
                                       
                                       
                                          opt
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    i
                                    ∈
                                    In
                                    }
                                    ,
                                    {
                                    
                                       
                                          U
                                       
                                       
                                          opt
                                       
                                       
                                          ij
                                       
                                    
                                    ,
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∈
                                    Sw
                                    }
                                    ,
                                    
                                       
                                          α
                                       
                                       
                                          opt
                                       
                                    
                                    ,
                                    
                                       
                                          β
                                       
                                       
                                          opt
                                       
                                    
                                 
                                 )
                              . Then:
                                 
                                    1.
                                    
                                       The set 
                                       
                                          
                                             
                                                S
                                             
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      opt
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                ⋃
                                             
                                             
                                                i
                                                ∈
                                                I
                                             
                                          
                                          {
                                          (
                                          x
                                          ,
                                          u
                                          )
                                          ∈
                                          
                                             
                                                X
                                             
                                             
                                                i
                                             
                                          
                                          ∣
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                      
                                                      
                                                         
                                                            u
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                             
                                                ⊤
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                opt
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                
                                                   
                                                      u
                                                   
                                                
                                             
                                          
                                          )
                                          +
                                          2
                                          
                                             
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      opt
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                             
                                                ⊤
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                
                                                   
                                                      u
                                                   
                                                
                                             
                                          
                                          )
                                          ≤
                                          
                                             
                                                α
                                             
                                             
                                                opt
                                             
                                          
                                          }
                                        
                                       is bounded and 
                                       
                                          R
                                          ×
                                          U
                                          ⊆
                                          
                                             
                                                S
                                             
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      opt
                                                   
                                                
                                             
                                          
                                       .


                                       For all 
                                       
                                          (
                                          x
                                          ,
                                          u
                                          )
                                          ∈
                                          R
                                          ×
                                          U
                                       , 
                                          ∥
                                          (
                                          x
                                          ,
                                          u
                                          )
                                          
                                             
                                                ∥
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                          ≤
                                          
                                             
                                                β
                                             
                                             
                                                opt
                                             
                                          
                                       .

For the first assertion, since from Assumption (4), 
                                 R
                                 ×
                                 U
                                 =
                                 
                                    
                                       ∪
                                    
                                    
                                       k
                                       ∈
                                       N
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       0
                                    
                                 
                                 )
                               where 
                                 T
                                 :
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ↦
                                 (
                                 
                                    
                                       A
                                    
                                    
                                       i
                                    
                                 
                                 x
                                 +
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 u
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 u
                                 )
                               if 
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                              , we can use an induction. To prove the initialization of the induction, the property holds from the fact that if Eq. (17) holds then by Proposition 5.1, Eq. (16) holds. The induction holds from the fact that if Eq. (15) holds then by Proposition 5.1, Eq. (13). The second assertion follows readily from the fact if Eq. (21) holds then by Proposition 5.1, Eq. (19).□

The method is implemented in Matlab and the solution is given by a semi-definite programming solver in Matlab. For our running example, Matlab returns the following the values:
                           
                              
                                 
                                    
                                       α
                                    
                                    
                                       opt
                                    
                                 
                                 =
                                 242.0155
                                 
                                    
                                       β
                                    
                                    
                                       opt
                                    
                                 
                                 =
                                 2173.8501
                              
                           
                        This means that 
                           ∥
                           (
                           x
                           ,
                           y
                           ,
                           u
                           )
                           
                              
                                 ∥
                              
                              
                                 2
                              
                              
                                 2
                              
                           
                           =
                           
                              
                                 x
                              
                              
                                 2
                              
                           
                           +
                           
                              
                                 y
                              
                              
                                 2
                              
                           
                           +
                           
                              
                                 u
                              
                              
                                 2
                              
                           
                           ≤
                           
                              
                                 β
                              
                              
                                 opt
                              
                           
                        . We can conclude, for example, that the values taken by the variables x are between 
                           [
                           −
                           46.6154
                           ,
                           46.6154
                           ]
                        . The value α
                        
                           opt
                         gives the level of the invariant sublevel of our piecewise quadratic Lyapunov function where the local quadratic functions are characterized by the following matrices and vectors: 
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             1.0181
                                          
                                          
                                             −
                                             0.0040
                                          
                                          
                                             −
                                             1.1332
                                          
                                       
                                       
                                          
                                             −
                                             0.0040
                                          
                                          
                                             1.0268
                                          
                                          
                                             −
                                             0.5340
                                          
                                       
                                       
                                          
                                             −
                                             1.1332
                                          
                                          
                                             −
                                             0.5340
                                          
                                          
                                             −
                                             13.7623
                                          
                                       
                                    
                                 
                                 )
                                 
                                 and
                                 
                                 
                                    
                                       q
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       0.1252
                                       ,
                                       1.3836
                                       ,
                                       −
                                       29.6791
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             9.1540
                                          
                                          
                                             −
                                             7.0159
                                          
                                          
                                             −
                                             2.6659
                                          
                                       
                                       
                                          
                                             −
                                             7.0159
                                          
                                          
                                             9.5054
                                          
                                          
                                             −
                                             2.4016
                                          
                                       
                                       
                                          
                                             −
                                             2.6659
                                          
                                          
                                             −
                                             2.4016
                                          
                                          
                                             −
                                             8.9741
                                          
                                       
                                    
                                 
                                 )
                                 
                                 and
                                 
                                 
                                    
                                       q
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       −
                                       21.3830
                                       ,
                                       −
                                       44.6291
                                       ,
                                       114.2984
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       3
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             1.1555
                                          
                                          
                                             −
                                             0.3599
                                          
                                          
                                             −
                                             2.6224
                                          
                                       
                                       
                                          
                                             −
                                             0.3599
                                          
                                          
                                             2.4558
                                          
                                          
                                             −
                                             2.8236
                                          
                                       
                                       
                                          
                                             −
                                             2.6224
                                          
                                          
                                             −
                                             2.8236
                                          
                                          
                                             −
                                             2.3852
                                          
                                       
                                    
                                 
                                 )
                                 
                                 and
                                 
                                 
                                    
                                       q
                                    
                                    
                                       3
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       −
                                       5.3138
                                       ,
                                       6.7894
                                       ,
                                       −
                                       40.5537
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       4
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             3.7314
                                          
                                          
                                             −
                                             3.4179
                                          
                                          
                                             −
                                             3.1427
                                          
                                       
                                       
                                          
                                             −
                                             3.4179
                                          
                                          
                                             6.1955
                                          
                                          
                                             0.9499
                                          
                                       
                                       
                                          
                                             −
                                             3.1427
                                          
                                          
                                             0.9499
                                          
                                          
                                             −
                                             10.6767
                                          
                                       
                                    
                                 
                                 )
                                 
                                 and
                                 
                                 
                                    
                                       q
                                    
                                    
                                       4
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       28.5011
                                       ,
                                       −
                                       73.5421
                                       ,
                                       48.2153
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                              
                           
                        Finally, for conciseness reason, we only give the matrix certificates for the cell X
                        1. First we give the matrix W
                        1 which encodes the quadratization of the guard X
                        1. Recall that this matrix ensures that 
                           (
                           x
                           ,
                           y
                           ,
                           u
                           )
                           ↦
                           α
                           −
                           (
                           x
                           ,
                           y
                           ,
                           u
                           )
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           
                              
                                 (
                                 x
                                 ,
                                 y
                                 ,
                                 u
                                 )
                              
                              
                                 ⊤
                              
                           
                           −
                           2
                           (
                           x
                           ,
                           y
                           ,
                           u
                           )
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                         is nonnegative on X
                        1: 
                           
                              
                                 
                                    
                                       W
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             63.0218
                                          
                                          
                                             0.0163
                                          
                                          
                                             0.0217
                                          
                                          
                                             12.1557
                                          
                                          
                                             8.8835
                                          
                                       
                                       
                                          
                                             0.0163
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0267
                                          
                                          
                                             0.0031
                                          
                                       
                                       
                                          
                                             0.0217
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0094
                                          
                                          
                                             0.0061
                                          
                                       
                                       
                                          
                                             12.1557
                                          
                                          
                                             0.0267
                                          
                                          
                                             0.0094
                                          
                                          
                                             4.2011
                                          
                                          
                                             59.5733
                                          
                                       
                                       
                                          
                                             8.8835
                                          
                                          
                                             0.0031
                                          
                                          
                                             0.0061
                                          
                                          
                                             59.5733
                                          
                                          
                                             3.0416
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        Secondly, we give the matrices U
                        1j
                         which encodes the quadratization of polyhedron X
                        1j
                        . Recall that those matrices ensure that the image of 
                           (
                           1
                           ,
                           x
                           ,
                           y
                           ,
                           u
                           )
                         by F
                        1 belongs to the set 
                           
                              
                                 S
                              
                              
                                 j
                                 ,
                                 α
                              
                           
                         for all 
                           (
                           1
                           ,
                           x
                           ,
                           y
                           ,
                           u
                           )
                         such that 
                           
                              
                                 F
                              
                              
                                 1
                              
                           
                           (
                           1
                           ,
                           x
                           ,
                           y
                           ,
                           u
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                        : 
                           
                              
                                 
                                    
                                       U
                                    
                                    
                                       11
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             0.0004
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0001
                                          
                                       
                                       
                                          
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                       
                                       
                                          
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                       
                                       
                                          
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                       
                                       
                                          
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                       
                                       
                                          
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                       
                                       
                                          
                                             0.0001
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             −
                                             0.0000
                                          
                                          
                                             0.0000
                                          
                                          
                                             0.0001
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       U
                                    
                                    
                                       12
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             2.1068
                                          
                                          
                                             0.4134
                                          
                                          
                                             0.0545
                                          
                                          
                                             1.4664
                                          
                                          
                                             0.1882
                                          
                                          
                                             2.3955
                                          
                                          
                                             2.4132
                                          
                                       
                                       
                                          
                                             0.4134
                                          
                                          
                                             0.0008
                                          
                                          
                                             0.0047
                                          
                                          
                                             0.0009
                                          
                                          
                                             0.0819
                                          
                                          
                                             0.5474
                                          
                                          
                                             0.0484
                                          
                                       
                                       
                                          
                                             0.0545
                                          
                                          
                                             0.0047
                                          
                                          
                                             0.0050
                                          
                                          
                                             0.0147
                                          
                                          
                                             0.0097
                                          
                                          
                                             0.1442
                                          
                                          
                                             0.2316
                                          
                                       
                                       
                                          
                                             1.4664
                                          
                                          
                                             0.0009
                                          
                                          
                                             0.0147
                                          
                                          
                                             0.0041
                                          
                                          
                                             0.3383
                                          
                                          
                                             0.8776
                                          
                                          
                                             0.0999
                                          
                                       
                                       
                                          
                                             0.1882
                                          
                                          
                                             0.0819
                                          
                                          
                                             0.0097
                                          
                                          
                                             0.3383
                                          
                                          
                                             0.0675
                                          
                                          
                                             0.4405
                                          
                                          
                                             0.4172
                                          
                                       
                                       
                                          
                                             2.3955
                                          
                                          
                                             0.5474
                                          
                                          
                                             0.1442
                                          
                                          
                                             0.8776
                                          
                                          
                                             0.4405
                                          
                                          
                                             8.1215
                                          
                                          
                                             9.6346
                                          
                                       
                                       
                                          
                                             2.4132
                                          
                                          
                                             0.0484
                                          
                                          
                                             0.2316
                                          
                                          
                                             0.0999
                                          
                                          
                                             0.4172
                                          
                                          
                                             9.6346
                                          
                                          
                                             0.9532
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       U
                                    
                                    
                                       13
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             0.3570
                                          
                                          
                                             0.2243
                                          
                                          
                                             0.0031
                                          
                                          
                                             0.0050
                                          
                                          
                                             0.1431
                                          
                                          
                                             0.0388
                                          
                                          
                                             0.7675
                                          
                                       
                                       
                                          
                                             0.2243
                                          
                                          
                                             0.0201
                                          
                                          
                                             0.0023
                                          
                                          
                                             0.0050
                                          
                                          
                                             0.1730
                                          
                                          
                                             0.0494
                                          
                                          
                                             0.1577
                                          
                                       
                                       
                                          
                                             0.0031
                                          
                                          
                                             0.0023
                                          
                                          
                                             0.0001
                                          
                                          
                                             0.0001
                                          
                                          
                                             0.0071
                                          
                                          
                                             0.0006
                                          
                                          
                                             0.0088
                                          
                                       
                                       
                                          
                                             0.0050
                                          
                                          
                                             0.0050
                                          
                                          
                                             0.0001
                                          
                                          
                                             0.0002
                                          
                                          
                                             0.3563
                                          
                                          
                                             0.0009
                                          
                                          
                                             0.0168
                                          
                                       
                                       
                                          
                                             0.1431
                                          
                                          
                                             0.1730
                                          
                                          
                                             0.0071
                                          
                                          
                                             0.3563
                                          
                                          
                                             0.0527
                                          
                                          
                                             0.2689
                                          
                                          
                                             0.8979
                                          
                                       
                                       
                                          
                                             0.0388
                                          
                                          
                                             0.0494
                                          
                                          
                                             0.0006
                                          
                                          
                                             0.0009
                                          
                                          
                                             0.2689
                                          
                                          
                                             0.0137
                                          
                                          
                                             0.1542
                                          
                                       
                                       
                                          
                                             0.7675
                                          
                                          
                                             0.1577
                                          
                                          
                                             0.0088
                                          
                                          
                                             0.0168
                                          
                                          
                                             0.8979
                                          
                                          
                                             0.1542
                                          
                                          
                                             0.2747
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       U
                                    
                                    
                                       14
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             1.3530
                                          
                                          
                                             0.1912
                                          
                                          
                                             0.0280
                                          
                                          
                                             0.1178
                                          
                                          
                                             2.9171
                                          
                                          
                                             0.7079
                                          
                                          
                                             1.4104
                                          
                                       
                                       
                                          
                                             0.1912
                                          
                                          
                                             0.0512
                                          
                                          
                                             0.0068
                                          
                                          
                                             0.0326
                                          
                                          
                                             1.7179
                                          
                                          
                                             0.3764
                                          
                                          
                                             0.6045
                                          
                                       
                                       
                                          
                                             0.0280
                                          
                                          
                                             0.0068
                                          
                                          
                                             0.0022
                                          
                                          
                                             0.0048
                                          
                                          
                                             0.1396
                                          
                                          
                                             0.0264
                                          
                                          
                                             0.0679
                                          
                                       
                                       
                                          
                                             0.1178
                                          
                                          
                                             0.0326
                                          
                                          
                                             0.0048
                                          
                                          
                                             0.0409
                                          
                                          
                                             0.5231
                                          
                                          
                                             0.1204
                                          
                                          
                                             0.2390
                                          
                                       
                                       
                                          
                                             2.9171
                                          
                                          
                                             1.7179
                                          
                                          
                                             0.1396
                                          
                                          
                                             0.5231
                                          
                                          
                                             15.0992
                                          
                                          
                                             5.1148
                                          
                                          
                                             14.3581
                                          
                                       
                                       
                                          
                                             0.7079
                                          
                                          
                                             0.3764
                                          
                                          
                                             0.0264
                                          
                                          
                                             0.1204
                                          
                                          
                                             5.1148
                                          
                                          
                                             0.5102
                                          
                                          
                                             1.6230
                                          
                                       
                                       
                                          
                                             1.4104
                                          
                                          
                                             0.6045
                                          
                                          
                                             0.0679
                                          
                                          
                                             0.2390
                                          
                                          
                                             14.3581
                                          
                                          
                                             1.6230
                                          
                                          
                                             1.2985
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        We remark that U
                        11 has negative coefficients whereas in our method, we are looking for a nonnegative coefficients matrix. It is due to the interior point method which is used to solve the semi-definite programming problems. Interior point methods return ϵ-optimal solution i.e. a solution which belongs to the ball of radius ϵ centered at an optimal solution. Hence, the solution furnished by the solver can slightly violate the constraints of the semi-definite program. We are aware of that and the projection of the returned solution on the feasible set should be studied as a future work.

Another approach by Lee and Dullerud [17–19] uses a similar principle to check the stability of a piecewise dynamical system. Instead of assigning a quadratic function to each cell, they rather consider bounded paths in the graph of possible switches. Their setting is different: they do not intend to prove stability of an existing system or bound its reachable states but rather want to study the subset of possible switches that can make the system controllable. Their algorithm starts from paths of length 1 and, in case of failure, increments the considered path length.

We extend here this idea applied to our search of a piecewise quadratic invariant bounding reachable states of affine systems with switches of the form (1). Instead of considering only paths of length exactly k, we rather map this idea to the k-induction principle [29,16]. 
                        Definition 6.1
                        
                           k-induction


                        Let 
                              (
                              Σ
                              ,
                              In
                              ,
                              T
                              )
                            be a transition system over states Σ with initial states 
                              In
                              ⊆
                              Σ
                            and transition relation 
                              T
                              ⊆
                              Σ
                              ×
                              Σ
                           . A safety property 
                              Prop
                              ⊆
                              Σ
                            is said k-inductive with respect to the transition system iff:
                              
                                 •
                                 for all system traces of length less than k, all reachable states verify Prop: 
                                       
                                          
                                             ∀
                                             j
                                             ≤
                                             k
                                             ∈
                                             N
                                             ,
                                             
                                             ∀
                                             
                                                
                                                   x
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   x
                                                
                                                
                                                   j
                                                
                                             
                                             ∈
                                             Σ
                                             ,
                                             
                                                
                                                   x
                                                
                                                
                                                   0
                                                
                                             
                                             ∈
                                             In
                                             ∧
                                             
                                                
                                                   
                                                      ⋀
                                                   
                                                   
                                                      i
                                                      ∈
                                                      [
                                                      0
                                                      ,
                                                      j
                                                      −
                                                      1
                                                      ]
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ∈
                                             T
                                             ⇒
                                             
                                                
                                                   x
                                                
                                                
                                                   j
                                                
                                             
                                             ∈
                                             Prop
                                          
                                       
                                    
                                 

for all system subtraces of length k satisfying Prop then the next state satisfies Prop as well 
                                       
                                          
                                             ∀
                                             
                                                
                                                   x
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   x
                                                
                                                
                                                   k
                                                
                                             
                                             ∈
                                             Σ
                                             ,
                                             
                                             
                                                
                                                   
                                                      ⋀
                                                   
                                                   
                                                      i
                                                      ∈
                                                      [
                                                      0
                                                      ,
                                                      k
                                                      −
                                                      1
                                                      ]
                                                   
                                                
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             Prop
                                             ∧
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ∈
                                             T
                                             ⇒
                                             
                                                
                                                   x
                                                
                                                
                                                   k
                                                
                                             
                                             ∈
                                             Prop
                                          
                                       
                                    
                                 

When proving a property by k-induction, one have to consider all the real transitions, i.e. actual traces of the system, starting from an initial state, up to k transitions. Then prove the inductive case, considering any prefix of length k. Since the systems we are considering are piecewise, it is possible to split to proof search into subcases and consider all transitions from one specific cell to another.

We recall that we consider a system of the form (1) composed of cells X
                     
                        i
                      indexed by a set I of partition labels. Then to apply the k-induction principle, we take 
                        Σ
                        =
                        
                           
                              R
                           
                           
                              d
                              +
                              m
                           
                        
                        =
                        
                           
                              ⋃
                           
                           
                              i
                              ∈
                              I
                           
                        
                        
                           
                              X
                           
                           
                              i
                           
                        
                     , 
                        In
                        =
                        
                           
                              X
                           
                           
                              0
                           
                        
                      and we define the transition relation T as a piecewise transition relation 
                        f
                        =
                        {
                        
                           
                              f
                           
                           
                              i
                           
                        
                        ,
                        
                           
                              f
                           
                           
                              i
                           
                        
                        
                        defined
                        
                        on
                        
                        
                           
                              X
                           
                           
                              i
                           
                        
                        }
                      defined as follows: 
                        (
                        x
                        ,
                        y
                        )
                        ∈
                        
                           
                              f
                           
                           
                              i
                           
                        
                      iff 
                        
                           
                              (
                              1
                              ,
                              
                                 
                                    y
                                 
                                 
                                    ⊤
                                 
                              
                              )
                           
                           
                              ⊤
                           
                        
                        =
                        
                           
                              F
                           
                           
                              i
                           
                        
                        
                           
                              (
                              1
                              ,
                              
                                 
                                    x
                                 
                                 
                                    ⊤
                                 
                              
                              )
                           
                           
                              ⊤
                           
                        
                      (where F
                     
                        i
                      is defined at Eq. (3)). The k-inductive property Prop denotes here a boundedness property represented by 
                        
                           
                              S
                           
                           
                              ′
                           
                        
                     . Then, a k-induction proof amounts to find this set S that satisfies:
                        
                           (22)
                           
                              ∀
                              j
                              <
                              k
                              ∈
                              N
                              ,
                              
                              ∀
                              
                                 
                                    i
                                 
                                 
                                    0
                                 
                              
                              ,
                              …
                              
                                 
                                    i
                                 
                                 
                                    j
                                 
                              
                              ∈
                              I
                              ,
                              
                              ∀
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                              
                              ∈
                              Σ
                              ,
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    0
                                 
                              
                              ∧
                              
                                 
                                    
                                       ⋀
                                    
                                    
                                       l
                                       ∈
                                       [
                                       0
                                       ,
                                       j
                                       −
                                       1
                                       ]
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              ∧
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    l
                                    +
                                    1
                                 
                              
                              )
                              ∈
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              ⇒
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                              
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                           
                        
                     
                     
                        
                           (23)
                           
                              ∀
                              
                                 
                                    i
                                 
                                 
                                    0
                                 
                              
                              ,
                              …
                              
                                 
                                    i
                                 
                                 
                                    k
                                 
                              
                              ∈
                              I
                              ,
                              
                              ∀
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                              ∈
                              Σ
                              ,
                              
                                 
                                    ⋀
                                 
                                 
                                    l
                                    ∈
                                    [
                                    0
                                    ,
                                    k
                                    −
                                    1
                                    ]
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              ∈
                              (
                              
                                 
                                    X
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              ∩
                              
                                 
                                    S
                                 
                                 
                                    α
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∧
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    l
                                    +
                                    1
                                 
                              
                              )
                              ∈
                              
                                 
                                    f
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              ⇒
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                           
                        
                     
                  

Let I
                     ⁎ be the set of finite words of the letters in I, and 
                        
                           
                              I
                           
                           
                              k
                           
                           
                              ⁎
                           
                        
                      its restriction to words of length exactly k. In the following, we denote by 
                        |
                        w
                        |
                      the length of word w, by 
                        a
                        ·
                        b
                      the concatenation of the words a and b into ab and by tl(w) the tail of a non-empty word w, i.e. w without its first letter. For example 
                        tl
                        (
                        i
                        ·
                        w
                        )
                        =
                        w
                     .

Following Lee and Dullerud approach, we reinforce Eqs. (22) and (23) to gather the states which share the same path w (sequence of switches) in a same set 
                        
                           
                              S
                           
                           
                              w
                              ,
                              α
                           
                        
                     . To consider a finite number of possible paths we bound these paths by k i.e. w is a non-empty sequence of switches of length at most k. We obtain the new (stronger) system of implications:
                        
                           (24)
                           
                              ∀
                              w
                              ∈
                              
                                 
                                    I
                                 
                                 
                                    1
                                 
                                 
                                    ⁎
                                 
                              
                              ,
                              
                              ∀
                              x
                              ∈
                              Σ
                              ,
                              
                              x
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    0
                                 
                              
                              ∩
                              
                                 
                                    X
                                 
                                 
                                    w
                                 
                              
                              ⇒
                              x
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    w
                                 
                                 
                                    ′
                                 
                              
                              ∀
                              1
                              ≤
                              j
                              <
                              k
                              ,
                              
                              ∀
                              w
                              ·
                              i
                              ∈
                              
                                 
                                    I
                                 
                                 
                                    j
                                 
                                 
                                    ⁎
                                 
                              
                              ,
                              
                              ∀
                              x
                              ,
                              y
                              ∈
                              Σ
                              ,
                              
                              ∃
                              l
                              ∈
                              I
                              ,
                           
                        
                     
                     
                        
                           (25)
                           
                              (
                              x
                              ,
                              y
                              )
                              ∈
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                              
                              ∧
                              x
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    w
                                    ·
                                    i
                                 
                                 
                                    ′
                                 
                              
                              ∧
                              y
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    l
                                 
                              
                              ⇒
                              y
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    w
                                    ·
                                    i
                                    ·
                                    l
                                 
                                 
                                    ′
                                 
                              
                              ∀
                              w
                              ·
                              i
                              ∈
                              
                                 
                                    I
                                 
                                 
                                    k
                                 
                                 
                                    ⁎
                                 
                              
                              ,
                              
                              ∀
                              x
                              ,
                              y
                              ∈
                              Σ
                              ,
                              
                              ∃
                              l
                              ∈
                              I
                              ,
                           
                        
                     
                     
                        
                           (26)
                           
                              (
                              x
                              ,
                              y
                              )
                              ∈
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                              
                              ∧
                              x
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    w
                                    ·
                                    i
                                 
                                 
                                    ′
                                 
                              
                              ∧
                              y
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    l
                                 
                              
                              ⇒
                              y
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    tl
                                    (
                                    w
                                    ·
                                    i
                                    )
                                    ·
                                    l
                                 
                                 
                                    ′
                                 
                              
                           
                        
                     
                     
                        Proposition 6.1
                        
                           Suppose that the system of Eqs. (24)–(26) 
                           has a solution 
                           
                              {
                              
                                 
                                    S
                                 
                                 
                                    w
                                 
                                 
                                    ′
                                 
                              
                              |
                              ∀
                              1
                              ≤
                              j
                              ≤
                              k
                              ,
                              w
                              ∈
                              
                                 
                                    I
                                 
                                 
                                    j
                                 
                                 
                                    ⁎
                                 
                              
                              }
                           . Let us define the set S that satisfies: 
                              
                                 
                                    
                                       
                                          S
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ⋃
                                          
                                          
                                             i
                                             ∈
                                             I
                                          
                                       
                                    
                                    
                                       
                                          
                                             ⋃
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         w
                                                         ∈
                                                         
                                                            
                                                               I
                                                            
                                                            
                                                               j
                                                            
                                                            
                                                               ⁎
                                                            
                                                         
                                                         ,
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                         ≤
                                                         j
                                                         ≤
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          w
                                          ·
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        

It suffices to prove that 
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                            satisfies Eqs. (22) and (23). The first equation follows from 
                              
                                 
                                    i
                                 
                                 
                                    0
                                 
                              
                              ·
                              …
                              ·
                              
                                 
                                    i
                                 
                                 
                                    k
                                    −
                                    1
                                 
                              
                              =
                              w
                            is a word, 
                              
                                 
                                    X
                                 
                                 
                                    0
                                 
                              
                              ∩
                              
                                 
                                    X
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          0
                                       
                                    
                                 
                              
                              ⊆
                              
                                 
                                    S
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          0
                                       
                                    
                                 
                                 
                                    ′
                                 
                              
                            (Eq. (24)) and by using k times Eq. (25), we conclude that Eq. (23) holds with 
                              
                                 
                                    S
                                 
                                 
                                    w
                                    ·
                                    
                                       
                                          i
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    ′
                                 
                              
                              ⊆
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                           . Now for Eq. (23), 
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                            then for some word w, 
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    w
                                    ·
                                    
                                       
                                          i
                                       
                                       
                                          0
                                       
                                    
                                 
                                 
                                    ′
                                 
                              
                            using k times either Eq. (25) or Eq. (26) (depending on the path length), we conclude that 
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                           .□

To turn the sets equations in term of sublevel sets equations, we introduce the family of quadratic functions parameterized by words of length at most k. For 
                        w
                        ∈
                        
                           
                              I
                           
                           
                              j
                           
                           
                              ⁎
                           
                        
                      with 
                        1
                        ≤
                        j
                        ≤
                        k
                      we define for all 
                        (
                        x
                        ,
                        u
                        )
                        ∈
                        
                           
                              R
                           
                           
                              d
                              +
                              m
                           
                        
                     : 
                        
                           
                              
                                 
                                    V
                                 
                                 
                                    w
                                 
                              
                              (
                              x
                              ,
                              u
                              )
                              =
                              
                                 
                                    (
                                    
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             
                                                u
                                             
                                          
                                       
                                    
                                    )
                                 
                                 
                                    ⊤
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    w
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       
                                          u
                                       
                                    
                                 
                              
                              )
                              +
                              2
                              
                                 
                                    q
                                 
                                 
                                    w
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       
                                          u
                                       
                                    
                                 
                              
                              )
                              ,
                           
                        
                     for some 
                        (
                        d
                        +
                        m
                        )
                        ×
                        (
                        d
                        +
                        m
                        )
                      symmetric matrix P
                     
                        w
                      and some 
                        d
                        +
                        m
                     -vector q
                     
                        w
                     . Then we can also define: 
                        
                           
                              
                                 
                                    V
                                 
                                 
                                    ′
                                 
                              
                              (
                              x
                              ,
                              u
                              )
                              =
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ′
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              (
                              x
                              ,
                              u
                              )
                              
                              if
                              
                              (
                              x
                              ,
                              u
                              )
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                              
                              
                              where
                              
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ′
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       min
                                    
                                    
                                       
                                          
                                             w
                                          
                                          
                                             ′
                                          
                                       
                                       ∈
                                       
                                          
                                             I
                                          
                                          
                                             j
                                          
                                          
                                             ⁎
                                          
                                       
                                       ,
                                       
                                       0
                                       ≤
                                       j
                                       ≤
                                       k
                                       −
                                       1
                                    
                                 
                              
                              
                              
                                 
                                    V
                                 
                                 
                                    w
                                    ·
                                    i
                                 
                              
                              (
                              x
                              ,
                              u
                              )
                              .
                           
                        
                     Finally, a sublevel solution of systems of equations consists in: 
                        
                           
                              
                                 
                                    S
                                 
                                 
                                    α
                                 
                                 
                                    ′
                                 
                              
                              =
                              {
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       d
                                       +
                                       m
                                    
                                 
                                 ∣
                                 
                                    
                                       V
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ≤
                                 α
                              
                              }
                              =
                              
                                 
                                    
                                       ⋃
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              {
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ∣
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ′
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ≤
                                 α
                              
                              }
                              .
                           
                        
                     In the next, we will need the family of auxiliary ellipsoidal sets parameterized by words w of length at most k: 
                        
                           
                              
                                 
                                    S
                                 
                                 
                                    w
                                    ,
                                    α
                                 
                                 
                                    ′
                                 
                              
                              =
                              {
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       d
                                       +
                                       m
                                    
                                 
                                 ∣
                                 
                                    
                                       V
                                    
                                    
                                       w
                                    
                                 
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ≤
                                 α
                              
                              }
                              .
                           
                        
                     By introducing quadratic functions, we will reinforce Eqs. (24), (25) and (26) from Proposition 5.1 as semidefinite constraints. In the next, we will adapt the semi-definite constraints of previous section to satisfy the k-inductive based constraints. While it is possible to target directly the synthesis of a k-inductive piecewise quadratic sublevel set, the approach typically starts from k=1 and increase to k+1 in case of failure to find a minimal k-inductive piecewise quadratic invariant.

As a first step, we compute the set of possible paths of given length up to k. First a graph 
                           G
                           =
                           (
                           I
                           ,
                           Init
                           ,
                           Sw
                           )
                         denoting possible switches between cells 
                           i
                           ∈
                           I
                         is computed using the approach presented in Section 4.2.

Recall that Init denotes the subset of cells 
                           i
                           ∈
                           I
                         that verify the initial conditions i.e. 
                           Init
                           =
                           {
                           i
                           ∈
                           I
                           |
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           ≠
                           ∅
                           }
                        . In this graph context, these indices are used to label the vertices I. Recall also that Sw is the set of possible switches i.e. 
                           Sw
                           =
                           {
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           
                              
                                 I
                              
                              
                                 2
                              
                           
                           ∣
                           ∃
                           (
                           x
                           ,
                           u
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           
                           s
                           .
                           t
                           .
                           
                           (
                           
                              
                                 A
                              
                              
                                 i
                              
                           
                           x
                           +
                           
                              
                                 B
                              
                              
                                 i
                              
                           
                           u
                           +
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           ,
                           u
                           )
                           ∈
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                           }
                        . In this graph context, it represents the edges. Recall that Init and Sw are computed using the method presented in Section 4.1.

We then enumerate the possible paths in the graph using classical graph algorithms. Let Paths
                        
                           k
                         be such set of paths of length up to k. 
                           Example 6.1
                           
                              Fig. 2
                               presents the possible transitions as over-approximated by our method presented in Section 4.2. Depending on the target length the following paths are generated: 
                                 
                                    
                                       
                                       
                                       
                                          
                                             length
                                             
                                          
                                          
                                             1
                                             1,2,3,4
                                          
                                          
                                             2
                                             11, 12, 13, 14, 22, 24, 31, 33, 34, 41, 42, 43, 44
                                          
                                          
                                             3
                                             111, 112, 113, 114, 122, 124, 131, 133, 134, 141, 142, 143, 144, 222, 224, 241, 242, 243, 244, 311, 312, 313, 314, 331, 333, 334, 341, 342, 343, 344, 411, 412, 413, 414, 422, 424, 431, 433, 434, 441, 442, 443, 444
                                          
                                          
                                             4
                                             …
                                          
                                       
                                    
                                 
                              
                           

The initial condition only applies for the quadratic sublevel associated to initial cells. Let Init be the set of cells admitting initial elements, as defined in the graph construction.

By construction of the set of paths Paths
                        
                           k
                        , it contains the single letter words denoting initial cells 
                           {
                           i
                           |
                           i
                           ∈
                           Init
                           }
                           ⊆
                           
                              
                                 Paths
                              
                              
                                 k
                              
                           
                        . The set of initial constraints only apply for these one letter word satisfying the initial condition:
                           
                              (27)
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       0
                                    
                                 
                                 ∩
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ⇒
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 
                                    
                                       P
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       (
                                       x
                                       ,
                                       u
                                       )
                                    
                                    
                                       ⊤
                                    
                                 
                                 +
                                 2
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ≤
                                 α
                              
                           
                        
                     

We can rely on the same stronger encoding as a semi-definite constraint, using the quadratization of the condition 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           ∩
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                         as the matrix E
                        0i
                        :
                           
                              (28)
                              
                                 −
                                 (
                                 
                                    
                                       
                                          
                                             −
                                             α
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 −
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             0
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       Z
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       0
                                       i
                                    
                                 
                                 ≽
                                 0
                              
                           
                        
                     

Note that, independently of the value of k, a system with n cells is parametrized by at most n Z
                        
                           i
                         variables.

Eqs. (25) and (26) denoting a transition X
                        
                           ij
                         from cell X
                        
                           i
                         to cell X
                        
                           j
                         can be defined as:
                           
                              (29)
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                 
                                 ∧
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       w
                                       ·
                                       i
                                       ,
                                       α
                                    
                                 
                                 ⇒
                                 (
                                 
                                    
                                       A
                                    
                                    
                                       i
                                    
                                 
                                 x
                                 +
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 u
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       w
                                       ·
                                       i
                                       ·
                                       j
                                       ,
                                       α
                                    
                                 
                              
                           
                        
                        
                           
                              (30)
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                 
                                 ∧
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       w
                                       ·
                                       i
                                       ,
                                       α
                                    
                                 
                                 ∧
                                 |
                                 w
                                 ·
                                 i
                                 |
                                 =
                                 k
                                 ⇒
                                 (
                                 
                                    
                                       A
                                    
                                    
                                       i
                                    
                                 
                                 x
                                 +
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 u
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       tl
                                       (
                                       w
                                       ·
                                       i
                                       )
                                       ·
                                       j
                                       ,
                                       α
                                    
                                 
                              
                           
                        
                     

As before, these constraints are first relaxed with the use of quadratization of cell transitions E
                        
                           ij
                        , and then expressed as semi-definition constraints using Proposition 5.1.

when 
                           |
                           w
                           ·
                           i
                           |
                           =
                           k
                        :
                           
                              (31)
                              
                                 −
                                 
                                    
                                       
                                          
                                             F
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         tl
                                                         (
                                                         w
                                                         ·
                                                         i
                                                         )
                                                         ·
                                                         j
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   tl
                                                   (
                                                   w
                                                   ·
                                                   i
                                                   )
                                                   ·
                                                   j
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   tl
                                                   (
                                                   w
                                                   ·
                                                   i
                                                   )
                                                   ·
                                                   j
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 
                                    
                                       F
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         w
                                                         ·
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   w
                                                   ·
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   w
                                                   ·
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 −
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             ij
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       w
                                       ·
                                       i
                                       ,
                                       j
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       ij
                                    
                                 
                                 ≽
                                 0
                                 .
                              
                           
                        when 
                           |
                           w
                           ·
                           i
                           |
                           <
                           k
                        :
                           
                              (32)
                              
                                 −
                                 
                                    
                                       
                                          
                                             F
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         w
                                                         ·
                                                         i
                                                         ·
                                                         j
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   w
                                                   ·
                                                   i
                                                   ·
                                                   j
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   w
                                                   ·
                                                   i
                                                   ·
                                                   j
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 
                                    
                                       F
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         w
                                                         ·
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   w
                                                   ·
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   w
                                                   ·
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 −
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             ij
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       U
                                    
                                    
                                       w
                                       ·
                                       i
                                       ,
                                       j
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       ij
                                    
                                 
                                 ≽
                                 0
                                 .
                              
                           
                        
                     

Note that we have 
                           |
                           
                              
                                 Paths
                              
                              
                                 k
                              
                           
                           |
                         variables q
                        
                           w
                        , P
                        
                           w
                         and 
                           |
                           
                              
                                 Paths
                              
                              
                                 k
                              
                           
                           |
                           ×
                           |
                           I
                           |
                         variables 
                           
                              
                                 U
                              
                              
                                 w
                                 ,
                                 j
                              
                           
                        .

The boundedness constraint expressed as a semi-definite constraint is straightforward. We require that all path-associated quadratic sublevel is bounded by the same scalar β.

For all 
                           w
                           ·
                           i
                           ∈
                           
                              
                                 Paths
                              
                              
                                 k
                              
                           
                        , there exists 
                           β
                           ≥
                           0
                        :
                           
                              (33)
                              
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 ∧
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       w
                                       ·
                                       i
                                       ,
                                       α
                                    
                                 
                                 ⇒
                                 ∥
                                 (
                                 x
                                 ,
                                 u
                                 )
                                 
                                    
                                       ∥
                                    
                                    
                                       2
                                    
                                    
                                       2
                                    
                                 
                                 ≤
                                 β
                              
                           
                        
                     

The associated semi-definite constraints is:
                           
                              (34)
                              
                                 −
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ⊤
                                    
                                 
                                 
                                    
                                       W
                                    
                                    
                                       w
                                       ·
                                       i
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       
                                          
                                             −
                                             α
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         w
                                                         ·
                                                         i
                                                      
                                                   
                                                
                                                
                                                   ⊤
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   w
                                                   ·
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   w
                                                   ·
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 +
                                 (
                                 
                                    
                                       
                                          
                                             β
                                          
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                   ×
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                   ×
                                                   1
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   Id
                                                
                                                
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                   ×
                                                   (
                                                   d
                                                   +
                                                   m
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 ≽
                                 0
                              
                           
                        
                     

We have here 
                           |
                           
                              
                                 Paths
                              
                              
                                 k
                              
                           
                           |
                         variables W
                        
                           w
                        .

The invariant computation is performed iteratively, increasing the length of the paths considered, using similar steps as the algorithm presented in Section 5.4. This new method is presented at Algorithm 2. 
                           Algorithm 2
                           
                              
                                 
                                    1.
                                    Precompute unfeasible transitions and synthesize the matrix L of fireable switches

Start with a path of length l=1 and increase until timeout or success:
                                          
                                             (a)
                                             Generate from matrix L all feasible paths w of length up to l, including paths of length 1.

Define real variables α and β
                                             

For each path w, introduce variables P
                                                
                                                   w
                                                , q
                                                
                                                   w
                                                , W
                                                
                                                   w
                                                , and for each cell index 
                                                   i
                                                   ∈
                                                   I
                                                , the variables 
                                                   
                                                      
                                                         U
                                                      
                                                      
                                                         w
                                                         ·
                                                         i
                                                      
                                                   
                                                 and Z
                                                
                                                   i
                                                .

Depending on the system definition and the quadratization of guards, characterize the matrices 
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         0
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         ij
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                , for all 
                                                   i
                                                   ,
                                                   j
                                                   ∈
                                                   I
                                                .

Solve the semi-definite program defined by the constraints (28), (31), (32), and (34) on such variables and constants.

If there exist a solution, then return the solution 
                                                   {
                                                   (
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         w
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         U
                                                      
                                                      
                                                         w
                                                         ·
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         Z
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         opt
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         β
                                                      
                                                      
                                                         opt
                                                      
                                                   
                                                   )
                                                   ,
                                                   i
                                                   ∈
                                                   I
                                                   ,
                                                   w
                                                   ∈
                                                   |
                                                   
                                                      
                                                         Paths
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   |
                                                   }
                                                . Otherwise, increase the path length l and go to (a).


                              Let 
                              
                                 R
                               
                              be the reachable values set of a given piecewise affine system of the form 
                              (1) 
                              and 
                              
                                 U
                               
                              be the bounded compact convex polyhedron where the control variable u lives. Assume that 
                              
                                 Algorithm 2 
                              stops at some 
                              
                                 l
                                 ∈
                                 
                                    
                                       N
                                    
                                    
                                       ⁎
                                    
                                 
                               
                              with the solution 
                              
                                 {
                                 (
                                 
                                    
                                       P
                                    
                                    
                                       w
                                    
                                 
                                 ,
                                 
                                    
                                       q
                                    
                                    
                                       w
                                    
                                 
                                 ,
                                 
                                    
                                       W
                                    
                                    
                                       w
                                    
                                 
                                 ,
                                 
                                    
                                       U
                                    
                                    
                                       w
                                       ·
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       Z
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       α
                                    
                                    
                                       opt
                                    
                                 
                                 ,
                                 
                                    
                                       β
                                    
                                    
                                       opt
                                    
                                 
                                 )
                                 ,
                                 i
                                 ∈
                                 I
                                 ,
                                 w
                                 ∈
                                 |
                                 
                                    
                                       Paths
                                    
                                    
                                       l
                                    
                                 
                                 |
                                 }
                              . Then:
                                 
                                    1.
                                    
                                       The set: 
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            opt
                                                         
                                                      
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                =
                                                
                                                   
                                                      
                                                         ⋃
                                                      
                                                      
                                                         i
                                                         ∈
                                                         I
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ⋃
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     w
                                                                     ∈
                                                                     
                                                                        
                                                                           I
                                                                        
                                                                        
                                                                           j
                                                                        
                                                                        
                                                                           ⁎
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     0
                                                                     ≤
                                                                     j
                                                                     ≤
                                                                     l
                                                                     −
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                {
                                                
                                                   (
                                                   x
                                                   ,
                                                   u
                                                   )
                                                   ∈
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∣
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                               
                                                               
                                                                  
                                                                     u
                                                                  
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         opt
                                                      
                                                      
                                                         w
                                                         ·
                                                         i
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                         
                                                         
                                                            
                                                               u
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                   +
                                                   2
                                                   
                                                      
                                                         
                                                            
                                                               q
                                                            
                                                            
                                                               opt
                                                            
                                                            
                                                               w
                                                               ·
                                                               i
                                                            
                                                         
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                         
                                                         
                                                            
                                                               u
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                   ≤
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         opt
                                                      
                                                   
                                                
                                                }
                                             
                                          
                                       
                                       is bounded and 
                                       
                                          R
                                          ×
                                          U
                                          ⊆
                                          
                                             
                                                S
                                             
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      opt
                                                   
                                                
                                             
                                             
                                                ′
                                             
                                          
                                       .


                                       For all 
                                       
                                          (
                                          x
                                          ,
                                          u
                                          )
                                          ∈
                                          R
                                          ×
                                          U
                                       , 
                                          ∥
                                          (
                                          x
                                          ,
                                          u
                                          )
                                          
                                             
                                                ∥
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                          ≤
                                          
                                             
                                                β
                                             
                                             
                                                opt
                                             
                                          
                                       .

Apply the same method of the proof of Theorem 5.1.□

When one considers Eqs. (28), (31), (32), and (34) with the set of paths Paths
                        1 of length up to 1, we obtain exactly Eqs. (17), (15), and (21). In that case, Eq. (32) does not hold since no non-empty word of length strictly less than 1 exists.

The analysis of the running example with increased length generates the following results: 
                           
                              
                                 
                                 
                                 
                                 
                                 
                                    
                                       Length
                                       
                                          
                                             β
                                             (
                                             
                                                
                                                   β
                                                
                                             
                                             )
                                          
                                       
                                       
                                          α
                                       
                                       
                                          
                                             |
                                             
                                                
                                                   Paths
                                                
                                                
                                                   k
                                                
                                             
                                             |
                                          
                                       
                                    
                                 
                                 
                                    
                                       1
                                       2173 (46.6154)
                                       242.0155
                                       4
                                    
                                    
                                       2
                                       2133 (46.1844)
                                       233.0847
                                       17
                                    
                                    
                                       3
                                       1652 (40.6448)
                                       220.8596
                                       73
                                    
                                    
                                       4
                                       1574 (39.6737)
                                       228.5051
                                       314
                                    
                                 
                              
                           
                        
                     

Note that the bound α on the piecewise quadratic sublevel applies on different sets of such local Lyapunov function. Their comparison is meaningless.

To illustrate the applicability of our method to a wide set of examples, we generated about a thousand (1030) of dynamical systems with at most 16 partition cells, 5 state variables and a single input.

In [3], the authors show (Theorem 2) that to determine the stability a piecewise affine dynamical system is undecidable. In order to generate more stable examples, we restricted the class of program generated. Each partition cell affine semantics would be (i) generated with small coefficients, since big coefficients are usually avoided in controllers and, (ii) enforced locally stable when needed by updating the values of the coefficients using the spectral radius.

Our example synthesis still does not guarantee to obtain globally stable system, but, with these required properties of local stability and small coefficients, it is more likely that switching from one cell to the other would not break stability and therefore boundedness of the reachable states. The intuition behind is that when we pass from a cell to another cell, we multiply a vector by a small number then all the coordinates of the vector image are strictly smaller than the ones of initial vector.

As illustrated in Fig. 3
                      about 561 of such 1030 examples are automatically shown to be bounded using our technique while this class of program considered is unlikely to be analyzable with other static analysis tools the author are aware of, including the previous analyzes proposed [26]. For the sake of comparison we also evaluated the existence of a simpler Common Lyapunov function (CLF) which existed in 298 cases. A typical run of the analysis is about 20s for a path of length 1, a minute for a length 2. In order to avoid long run of the analysis, we did not compute the piecewise invariants in a case of a system and a path length generating more than a thousand paths.


                     Fig. 4
                      analyzes the obtained results with respect to the relative precision and the path length.

All the computation have been performed within Matlab, including the synthesis of the examples. The source code of the analysis as well a document summarizing the examples and their analysis is available at https://cavale.enseeiht.fr/piecewisequadratic/.

@&#CONCLUSION@&#

The presented approach is able, considering a piecewise affine system, to compute a piecewise quadratic invariant able to bound the set of reachable state.

The technique extends the classical quadratic Lyapunov function synthesis using SDP solvers by formulating a more complex set of constraints to the SDP solver. This new formulation accounts the definition of the partitioning and encodes within the SDP constraints the relationship between partitions.

In practice our technique has been applied to a wide set of generated examples and was able to bound their reachable state space while a global quadratic invariant was proven not computable.

Our future work will consider the combination of this technique with other formal methods. A first direction will rely on the computed piecewise quadratic form as a template domain, bounding its value on some code using either Kleene iterations [6] or policy iteration [13]. This will require to extend the existing algorithms to fit this piecewise description of the template.

A second direction is to ease the applicability of the method and to integrate the technique in a more common analysis framework. A requirement for the presented work is to obtain a global representation of the program, as matrix updates and conditions. Existing static analysis [26] used for policy iteration extracts such a graph with the appropriate representation. We plan to integrate the two frameworks to ease the applicability on more realistic programs in an automated fashion.

@&#ACKNOWLEDGMENTS@&#

We thank Mario Sigalotti for introducing us to Lee and Dullerud approach during a seminar organized by the working group GT Shy of the Labex DigiCosme in Paris. And we own deep gratitude to Xavier Thirioux for serious brainstorming about the k-induction proofs.

@&#REFERENCES@&#

