@&#MAIN-TITLE@&#WASI-2D: A software tool for regionally optimized analysis of imaging spectrometer data from deep and shallow waters

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Free image processing software for multi- and hyperspectral data.


                        
                        
                           
                           Deep and shallow waters.


                        
                        
                           
                           Wavelength dependent sun and sky glint correction.


                        
                        
                           
                           Easy adaptation to different environments and sensors.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Remote sensing

Water

Inversion

Bio-optical models

Hyperspectral

@&#ABSTRACT@&#


               Graphical abstract
               
                  
                     
                        
                           
                        
                     
                  
               
            

@&#INTRODUCTION@&#

The water colour, or more precisely the water leaving spectral radiance, bears much information about the water body and possibly the bottom. Extraction of this information in optically complex waters, in which two or more components affect the colour, requires sensors that provide well-calibrated radiance spectra and so-called bio-optical models capable of simulating these spectra for all expected conditions. Data analysis is based on inversion of the bio-optical model, i.e. a number of model parameters are tuned such that the simulated spectra match the measured ones as good as possible. The derived model parameters are usually the concentrations of phytoplankton, dissolved organic matter and suspended sediments; in shallow waters additionally the water depth and coverage factors of bottom types like sand, macrophytes and phytobenthos.

Although many algorithms for inverse modelling of water leaving radiance and reflectance exist (IOCCG, 2006; Dekker et al., 2011), no publicly available software was available for long time that can be regionally optimized by the user. The first software of this kind, BOMBER, was developed only recently (Giardino et al., 2012). It implements the remote sensing reflectance model of Lee et al. (1998, 1999) to generate maps of water constituents and, in case of shallow waters, maps of bottom depth and three substrate classes. A similar tool is presented in this paper, WASI-2D. It is based on the Water Colour Simulator WASI (Gege, 2004; Gege and Albert, 2006), which has been developed to simulate and analyse different types of spectral measurements of instruments disposed above the water surface and submerged in the water. An overview of the model options and software features, and a comparison with BOMBER, is given in 
                     Table 1.

Both tools were originally developed for application in lakes, but due to their general design they can be used in other aquatic environments as well, e.g. the open ocean, coastal zones or estuaries. While BOMBER is based entirely on a model of remote sensing reflectance, WASI-2D includes also a model of downwelling irradiance. It enables WASI-2D to correct the wavelength dependent reflections of the sun disk and the sky at the water surface (sun glint, sky glint), and it allows to process, besides reflectance, also upwelling radiance data. As WASI-2D can handle mixtures of up to 6 classes of phytoplankton, it can be used for phytoplankton classification, which is not feasible with BOMBER. WASI-2D is operated under Microsoft Windows as standalone program, while BOMBER is an add-on to the commercial ENVI image processing software, which requires fee-based licenses of IDL and ENVI. WASI-2D provides more options than BOMBER to fine-tune the inversion algorithm, e.g. calculation of standard deviation of selected image areas to determine the information-bearing bands, and wavelength-dependent weighting at residual calculation.

WASI-2D has been implemented as a new module into WASI. It can make use of all its spectrum types and bio-optical models and extends its functionality towards image processing. For remote sensing, upwelling radiance and remote sensing reflectance are the most relevant spectrum types. WASI includes a number of bio-optical models found in literature. The most general one is that of Albert (2004), Albert and Mobley (2003), Albert and Gege (2006), which can be applied to both optically deep and shallow waters. In Section 2 the equations of this model are recalled for the standard settings; a complete documentation of all implemented models and options is given in the user manual. The program features of WASI are described in Gege (2004, 2012), Gege and Albert (2006) and in the user manual. Useful capabilities of WASI for optimizing the operation of WASI-2D are the following. The forward mode can be used to determine the information bearing wavelength ranges by simulating measurements for the expected parameter ranges. The single spectrum inverse mode can be applied to in situ measurements of reflectance, irradiance, absorption or attenuation to determine optical properties and concentrations of water constituents, bottom reflectance and parameters of the atmosphere. The reconstruction mode allows sensitivity analysis and can be helpful to determine which parameters to fit and which to keep constant during inverse modelling.

The quantity measured by an imaging sensor on board a satellite or aircraft is the at-sensor spectral radiance. It originates only partly from the water; a large portion comes from the atmosphere. WASI-2D does not model the influence of the atmosphere, thus the sensor data need to be corrected first for the atmospheric influences using a suitable software like ATCOR (Richter et al., 2006) or 6S (Vermote et al., 1997). Since the output of such software can be in units of spectral reflectance or spectral radiance, WASI-2D supports reflectance as well as radiance data. Conversion makes use of the relationship
                        
                           (1)
                           
                              
                                 
                                    L
                                 
                                 
                                    u
                                 
                              
                              (
                              λ
                              )
                              =
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                              
                              (
                              λ
                              )
                              ×
                              
                                 
                                    E
                                 
                                 
                                    d
                                 
                              
                              (
                              λ
                              )
                              .
                           
                        
                     
                  

This equation defines the remote sensing reflectance, R
                     
                        rs
                     , as the ratio of upwelling radiance, L
                     
                        u
                     , and downwelling irradiance, E
                     
                        d
                     . λ denotes wavelength. E
                     
                        d
                     (λ) is calculated just above or below the water surface using the model of Gregg and Carder (1990); for details of the E
                     
                        d
                      model and its implementation in WASI see Gege (2012).

In the general case of optically shallow waters, L
                     
                        u
                      and R
                     
                        rs
                      are a sum of the contributions from the water surface, the water body and the bottom. Optically shallow means that L
                     
                        u
                      and R
                     
                        rs
                      are significantly affected by the bottom. A perfectly plane water surface acts like a mirror and reflects a well-defined section of the upper hemisphere, defined by the sky radiance L
                     
                        s
                     , into the sensor. The reflectance factor for L
                     
                        s
                     , ρ
                     
                        Ls
                     , is calculated as a function of the viewing angle, θ
                     
                        v
                     , using the Fresnel equation for unpolarized light (Jerlov, 1976):
                        
                           (2)
                           
                              
                                 
                                    ρ
                                 
                                 
                                    L
                                    s
                                 
                              
                              =
                              
                                 1
                                 2
                              
                              
                                 |
                                 
                                    
                                       
                                          
                                             
                                                sin
                                             
                                             2
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                v
                                             
                                          
                                          −
                                          
                                             
                                                θ
                                             
                                             
                                                v
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                       
                                          
                                             
                                                sin
                                             
                                             2
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                v
                                             
                                          
                                          +
                                          
                                             
                                                θ
                                             
                                             
                                                v
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                tan
                                             
                                             2
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                v
                                             
                                          
                                          −
                                          
                                             
                                                θ
                                             
                                             
                                                v
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                       
                                          
                                             
                                                tan
                                             
                                             2
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                v
                                             
                                          
                                          +
                                          
                                             
                                                θ
                                             
                                             
                                                v
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                 
                                 |
                              
                              .
                           
                        
                     
                     
                        
                           
                              θ
                              ′
                           
                           
                              v
                           
                        
                      is the angle of refraction, which is related to θ
                     
                        v
                      by Snell′s law n
                     
                        W
                      sin
                        
                           
                              θ
                              ′
                           
                           
                              v
                           
                        
                     =sinθ
                     
                        v
                     , where n
                     
                        W
                     ≈1.33 is the refractive index of water. For viewing angles near nadir, ρ
                     
                        Ls
                     ≈0.02.

The water surface is almost never perfectly flat. Waves, ripples and foam create a complex surface structure, hence the reflected L
                     
                        s
                      is composed of radiation originating from different unknown locations of the sky, depending on the orientation of the wave facets within the pixels′ field of view. For this reason WASI models L
                     
                        s
                      as a weighted sum of three light sources of known spectral irradiance:
                        
                           (3)
                           
                              
                                 L
                                 s
                              
                              (
                              λ
                              )
                              =
                              
                                 g
                                 
                                    d
                                    d
                                 
                              
                              ×
                              
                                 E
                                 
                                    d
                                    d
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 g
                                 
                                    d
                                    s
                                    r
                                 
                              
                              ×
                              
                                 E
                                 
                                    d
                                    s
                                    r
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 g
                                 
                                    d
                                    s
                                    a
                                 
                              
                              ×
                              
                                 E
                                 
                                    d
                                    s
                                    a
                                 
                              
                              (
                              λ
                              )
                              .
                           
                        
                     
                     E
                     
                        dd
                     (λ) represents the sun disk, E
                     
                        dsr
                     (λ) Rayleigh scattering, and E
                     
                        dsa
                     (λ) aerosol scattering. Their parameterization, which is adopted from the model of Gregg and Carder (1990), is described in Gege (2012). The weights g
                     
                        dd
                     , g
                     
                        dsr
                      and g
                     
                        dsa
                      represent the actual intensity of each light source for an image pixel and can be treated as fit parameters during data analysis. The remote sensing reflectance of the water surface is given by:
                        
                           (4)
                           
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                                 
                                    s
                                    u
                                    r
                                    f
                                 
                              
                              (
                              λ
                              )
                              =
                              
                                 
                                    ρ
                                 
                                 
                                    L
                                    s
                                 
                              
                              ×
                              
                                 
                                    
                                       
                                          L
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                                 
                                    
                                       
                                          E
                                       
                                       
                                          d
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                              
                              .
                           
                        
                     
                  

The contributions of the water body and the bottom to the reflected radiance are calculated for a hypothetical underwater sensor using the model of Albert and Mobley (2003), Albert (2004):
                        
                           (5)
                           
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                                 
                                    s
                                    h
                                    −
                                 
                              
                              (
                              λ
                              )
                              =
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                                 
                                    d
                                    e
                                    e
                                    p
                                    −
                                 
                              
                              (
                              λ
                              )
                              ×
                              [
                              1
                              −
                              
                                 
                                    A
                                 
                                 
                                    r
                                    s
                                    ,
                                    1
                                 
                              
                              ×
                              exp
                              {
                              −
                              (
                              
                                 
                                    K
                                 
                                 
                                    d
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 
                                    k
                                 
                                 
                                    u
                                    W
                                 
                              
                              (
                              λ
                              )
                              )
                              ×
                              
                                 
                                    z
                                 
                                 
                                    B
                                 
                              
                              }
                              ]
                              +
                              
                                 
                                    A
                                 
                                 
                                    r
                                    s
                                    ,
                                    2
                                 
                              
                              ×
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                                 
                                    b
                                 
                              
                              (
                              λ
                              )
                              ×
                              exp
                              {
                              −
                              (
                              
                                 
                                    K
                                 
                                 
                                    d
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 
                                    k
                                 
                                 
                                    u
                                    B
                                 
                              
                              (
                              λ
                              )
                              )
                              ×
                              
                                 
                                    z
                                 
                                 
                                    B
                                 
                              
                              }
                              .
                           
                        
                     
                  

The superscript sh indicates shallow water, deep deep water, b bottom, and the ‘−’symbol a measurement just below the water surface. The first term on the right-hand side is the contribution of a water layer of thickness z
                     
                        B
                     , the second term of the bottom. The reflected light has passed the water column twice. The corresponding extinction is described by the attenuation coefficients K
                     
                        d
                      for downwelling irradiance, k
                     
                        uW
                      for upwelling radiance originating from the water layer, and k
                     
                        uB
                      for upwelling radiance from the bottom. The radiative transfer program Hydrolight (Mobley et al., 1993) has been used to determine the empirical constants A
                     
                        rs,1=1.1576±0.0038 and A
                     
                        rs,2=1.0389±0.0014 by altering the water constituents concentrations over two orders of magnitude (Albert and Mobley, 2003). The low uncertainties of A
                     
                        rs,1 and A
                     
                        rs,2 indicate that Eq. (5) is applicable to a wide variety of water types.

The remote sensing reflectance above the water surface is related to that below through the following equation:
                        
                           (6)
                           
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                                 
                                    s
                                    h
                                 
                              
                              (
                              λ
                              )
                              =
                              
                                 
                                    (
                                    1
                                    −
                                    
                                       
                                          ρ
                                       
                                       
                                          E
                                          d
                                       
                                    
                                    )
                                    (
                                    1
                                    −
                                    
                                       
                                          ρ
                                       
                                       
                                          L
                                          u
                                          −
                                       
                                    
                                    )
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          w
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              ×
                              
                                 
                                    
                                       
                                          R
                                       
                                       
                                          r
                                          s
                                       
                                       
                                          s
                                          h
                                          −
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                                 
                                    1
                                    −
                                    
                                       
                                          ρ
                                       
                                       
                                          E
                                          u
                                          −
                                       
                                    
                                    ×
                                    Q
                                    ×
                                    
                                       
                                          R
                                       
                                       
                                          r
                                          s
                                       
                                       
                                          s
                                          h
                                          −
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                              
                              +
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                                 
                                    s
                                    u
                                    r
                                    f
                                 
                              
                              (
                              λ
                              )
                              .
                           
                        
                     
                     ρ
                     
                        Ed
                     , ρ
                     
                        Eu− and ρ
                     
                        Lu− are the reflection factors of E
                     
                        d
                     , E
                     
                        u
                     
                     
                        −
                      and L
                     
                        u
                     
                     
                        −
                      at the water surface, respectively, and Q=E
                     
                        u
                     
                     −/L
                     
                        u
                     
                     − is the anisotropy factor of upwelling radiance. They depend on geometry parameters like sun zenith angle, cloud distribution and scattering phase functions of aerosols and suspended matter. The defaults in WASI are ρ
                     
                        Ed
                     =0.03 (Jerlov, 1976), ρ
                     
                        Lu−=0.02 (from Fresnel Eq. (2)), ρ
                     
                        Eu−=0.54 (Jerome et al., 1990), and Q=5sr (Kirk, 1983).

The remote sensing reflectance of deep water is calculated as follows:
                        
                           (7)
                           
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                                 
                                    d
                                    e
                                    e
                                    p
                                    −
                                 
                              
                              (
                              λ
                              )
                              =
                              
                                 
                                    f
                                 
                                 
                                    r
                                    s
                                 
                              
                              (
                              λ
                              )
                              ×
                              u
                              (
                              λ
                              )
                              .
                           
                        
                     
                  

In this equation, the factor f
                     
                        rs
                      parameterises the viewing and illumination geometry in terms of the viewing angle in water, 
                        
                           
                              θ
                              ′
                           
                           
                              v
                           
                        
                     , and the sun zenith angle in water, 
                        
                           
                              θ
                              ′
                           
                           
                              s
                              u
                              n
                           
                        
                     :
                        
                           (8)
                           
                              
                                 
                                    f
                                 
                                 
                                    r
                                    s
                                 
                              
                              (
                              λ
                              )
                              =
                              0.0512
                              ×
                              (
                              1
                              +
                              4.6659
                              ×
                              u
                              (
                              λ
                              )
                              −
                              7.8387
                              ×
                              u
                              
                                 
                                    (
                                    λ
                                    )
                                 
                                 2
                              
                              +
                              5.4571
                              ×
                              u
                              
                                 
                                    (
                                    λ
                                    )
                                 
                                 3
                              
                              )
                              ×
                              
                                 (
                                 
                                    1
                                    +
                                    
                                       
                                          0.1098
                                       
                                       
                                          cos
                                          
                                             
                                                θ
                                                ′
                                             
                                             
                                                s
                                                u
                                                n
                                             
                                          
                                       
                                    
                                 
                                 )
                              
                              ×
                              
                                 (
                                 
                                    1
                                    +
                                    
                                       
                                          0.4021
                                       
                                       
                                          cos
                                          
                                             
                                                θ
                                                ′
                                             
                                             
                                                v
                                             
                                          
                                       
                                    
                                 
                                 )
                              
                              .
                           
                        
                     
                  

The empirical coefficients have been determined using 177472 Hydrolight simulations by altering 
                        
                           
                              θ
                              ′
                           
                           
                              s
                              u
                              n
                           
                        
                      and 
                        
                           
                              θ
                              ′
                           
                           
                              v
                           
                        
                      from 0 to 45°, chlorophyll concentration from 0.5 to 100mgm−3, suspended matter concentration from 0.5 to 50gm−3, gelbstoff absorption at 440nm from 0.05 to 5m−1, and wind speed from 0 to 30ms−1 (Albert and Mobley, 2003). The function u(λ) comprises the inherent optical properties (IOPs) of the water body:
                        
                           (9)
                           
                              u
                              (
                              λ
                              )
                              =
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          b
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                                 
                                    a
                                    (
                                    λ
                                    )
                                    +
                                    
                                       
                                          b
                                       
                                       
                                          b
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                              
                              .
                           
                        
                     
                  

The IOPs of the water body are calculated as follows:
                        
                           (10)
                           
                              a
                              (
                              λ
                              )
                              =
                              
                                 
                                    a
                                 
                                 
                                    W
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 
                                    a
                                 
                                 
                                    p
                                    h
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 
                                    a
                                 
                                 
                                    Y
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 
                                    a
                                 
                                 
                                    d
                                 
                              
                              (
                              λ
                              )
                              ,
                           
                        
                     
                     
                        
                           (11)
                           
                              
                                 
                                    b
                                 
                                 
                                    b
                                 
                              
                              (
                              λ
                              )
                              =
                              
                                 
                                    b
                                 
                                 
                                    b
                                    ,
                                    W
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 
                                    b
                                 
                                 
                                    b
                                    ,
                                    X
                                 
                              
                              (
                              λ
                              )
                              .
                           
                        
                     
                     a
                     
                        W
                     (λ) and b
                     
                        b,W
                     (λ) are the absorption and backscattering coefficients of pure water, respectively. The default spectrum a
                     
                        W
                     (λ) is a combination from different sources: 350–390nm, interpolation between Quickenden and Irvin (1980) and Buiteveld et al. (1994); 391–787nm, Buiteveld et al. (1994); 788–874nm, own unpublished measurements on UV-treated pure water; 875–1000nm, Palmer and Williams (1974). For b
                     
                        b,W
                     (λ) the relation of Morel (1997) is used: b
                     
                        b,W
                     (λ)=b
                     1(λ⧸500)−4.32 (λ in nm) with b
                     1=0.00111m−1 for fresh water and b
                     1=0.00144m−1 for oceanic water with a salinity of 35–38‰.

Four types of water constituents are considered: phytoplankton, gelbstoff, detritus and suspended particles. The first three are parameterized by their spectral absorption coefficients a
                     
                        ph
                     (λ), a
                     
                        Y
                     (λ) and a
                     
                        d
                     (λ), respectively; suspended particles by their spectral backscattering coefficient, b
                     
                        b,X
                     (λ). Backscattering by phytoplankton is included in b
                     
                        b,X
                     (λ).

Phytoplankton concentration is expressed as mass of the pigments chlorophyll-a plus phaeophytin-a per water volume (mgm−3); its specific absorption coefficient is species dependent. Frequently, a mixture of several phytoplankton species is present in the water. The resulting phytoplankton absorption coefficient is the sum of the individual contributions:
                        
                           (12)
                           
                              
                                 a
                                 
                                    p
                                    h
                                 
                              
                              (
                              λ
                              )
                              =
                              ∑
                              
                                 C
                                 i
                              
                              ×
                              
                                 a
                                 i
                                 ⁎
                              
                              (
                              λ
                              )
                              .
                           
                        
                     
                     C
                     
                        i
                      is the concentration of phytoplankton class number i, a
                     
                        i
                     
                     ⁎(λ) is the specific absorption coefficient of that class. The WASI database provides 6 spectra a
                     
                        i
                     
                     ⁎(λ) representing the phytoplankton in lake Bodensee (Gege, 1998; Heege, 2000). Spectrum #0 represents a typical phytoplankton mixture in that lake, #1 cryptophyta with low concentration of the pigment phycoerythrin, #2 cryptophyta with high phycoerythrin concentration, #3 diatoms, #4 dinoflagellates, and #5 green algae.

Gelbstoff (yellow substance) is the coloured dissolved organic matter (CDOM) in the water and composed of a huge variety of organic molecules. Its absorption coefficient is calculated as a
                     
                        Y
                     (λ)=Ya
                     
                        Y
                     
                     ⁎(λ), where a
                     
                        Y
                     
                     ⁎(λ) is the specific absorption spectrum, normalized at a reference wavelength λ
                     0, and Y=a
                     
                        Y
                     (λ
                     0) is the absorption coefficient at λ
                     0. The spectrum a
                     
                        Y
                     
                     ⁎(λ) can either be imported from file, or it can be modelled by the frequently used approximation exp[−S(λ−λ
                     0)]. For the exponential approximation, λ
                     0=440nm and S=0.014nm−1 are set by default, which is representative of a great variety of water types (Bricaud et al., 1981; Carder et al., 1989).

Detritus (also known as tripton (Gitelson et al., 2008) or bleached particles (Doerffer and Schiller, 2007)) is the collective name for all absorbing non-algal particles in the water. Its absorption spectrum is parameterized as a
                     
                        d
                     (λ)=Da
                     
                        d
                     
                     ⁎(λ), with a
                     
                        d
                     
                     ⁎(λ) denoting specific absorption, normalized at the same wavelength λ
                     0 as Gelbstoff, and D=a
                     
                        d
                     (λ
                     0) describing the absorption coefficient at λ
                     0. The spectrum a
                     
                        d
                     
                     ⁎(λ) is imported from file.

Suspended particle concentration is expressed as dry mass per water volume (gm−3). Its backscattering coefficient is calculated as
                        
                           (13)
                           
                              
                                 
                                    b
                                 
                                 
                                    b
                                    ,
                                    X
                                 
                              
                              (
                              λ
                              )
                              =
                              X
                              ×
                              
                                 
                                    b
                                 
                                 
                                    b
                                    ,
                                    
                                       
                                          X
                                          ⁎
                                       
                                    
                                 
                              
                              ×
                              
                                 
                                    b
                                 
                                 
                                    X
                                 
                              
                              (
                              λ
                              )
                              +
                              
                                 
                                    C
                                 
                                 
                                    M
                                    i
                                    e
                                 
                              
                              ×
                              
                                 
                                    b
                                 
                                 
                                    b
                                    ,
                                    M
                                    i
                                    
                                       e
                                       ⁎
                                    
                                 
                              
                              ×
                              
                                 
                                    (
                                    λ
                                    /
                                    
                                       
                                          λ
                                       
                                       
                                          S
                                       
                                    
                                    )
                                 
                                 n
                              
                           
                        
                     
                  

This equation allows to model mixtures of two spectrally different types of suspended matter. Type I is defined by a scattering coefficient with arbitrary wavelength dependency, b
                     
                        X
                     (λ), which is imported from file. X is the concentration and b
                     
                        b,X
                     
                     ⁎ the specific backscattering coefficient. b
                     
                        b,X
                     
                     ⁎ can be treated as constant or as dependent on concentration, b
                     
                        b,X
                     
                     ⁎=AX
                     
                        B
                     . Such non-linear dependency with A=0.0006m2
                     g−1 and B=−0.37 was observed for open ocean waters, in which the concentrations of suspended matter and phytoplankton are highly correlated (Morel, 1980; Sathyendranath et al., 1989). For such waters, X=C
                     0 can be set in WASI, with C
                     0 denoting the concentration of phytoplankton class no. 0. Type II is defined by the normalized scattering coefficient (λ⧸λ
                     
                        S
                     )
                        n
                     , where the Angström exponent n is related to the particle size distribution. C
                     
                        Mie
                      is the concentration and b
                     
                        b,Mie
                     
                     ⁎ the specific backscattering coefficient. Default values are b
                     
                        b,X
                     
                     ⁎=0.0086m2
                     g−1, b
                     
                        X
                     (λ)=1, b
                     
                        b,Mie
                     
                     ⁎=0.0042m2
                     g−1, λ
                     
                        S
                     =500nm, n=−1, which are representative for lake Bodensee (Heege, 2000).

The attenuation coefficients are calculated as follows Albert (2004), Albert and Gege (2006):
                        
                           (14)
                           
                              
                                 
                                    K
                                 
                                 
                                    d
                                 
                              
                              (
                              λ
                              )
                              =
                              1.0546
                              ×
                              
                                 
                                    a
                                    (
                                    λ
                                    )
                                    +
                                    
                                       
                                          b
                                       
                                       
                                          b
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                                 
                                    cos
                                    
                                       
                                          θ
                                          ′
                                       
                                       
                                          s
                                          u
                                          n
                                       
                                    
                                 
                              
                              ,
                           
                        
                     
                     
                        
                           (15)
                           
                              
                                 
                                    k
                                 
                                 
                                    u
                                    W
                                 
                              
                              (
                              λ
                              )
                              =
                              
                                 
                                    a
                                    (
                                    λ
                                    )
                                    +
                                    
                                       
                                          b
                                       
                                       
                                          b
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                                 
                                    cos
                                    
                                       
                                          θ
                                          ′
                                       
                                       
                                          v
                                       
                                    
                                 
                              
                              ×
                              
                                 
                                    [
                                    1
                                    +
                                    u
                                    (
                                    λ
                                    )
                                    ]
                                 
                                 
                                    3.5421
                                 
                              
                              ×
                              
                                 [
                                 
                                    1
                                    −
                                    
                                       
                                          0.2786
                                       
                                       
                                          cos
                                          
                                             
                                                θ
                                                ′
                                             
                                             
                                                s
                                                u
                                                n
                                             
                                          
                                       
                                    
                                 
                                 ]
                              
                              ,
                           
                        
                     
                     
                        
                           (16)
                           
                              
                                 
                                    k
                                 
                                 
                                    u
                                    B
                                 
                              
                              (
                              λ
                              )
                              =
                              
                                 
                                    a
                                    (
                                    λ
                                    )
                                    +
                                    
                                       
                                          b
                                       
                                       
                                          b
                                       
                                    
                                    (
                                    λ
                                    )
                                 
                                 
                                    cos
                                    
                                       
                                          θ
                                          ′
                                       
                                       
                                          v
                                       
                                    
                                 
                              
                              ×
                              
                                 
                                    [
                                    1
                                    +
                                    u
                                    (
                                    λ
                                    )
                                    ]
                                 
                                 
                                    2.2658
                                 
                              
                              ×
                              
                                 [
                                 
                                    1
                                    +
                                    
                                       
                                          0.0577
                                       
                                       
                                          cos
                                          
                                             
                                                θ
                                                ′
                                             
                                             
                                                s
                                                u
                                                n
                                             
                                          
                                       
                                    
                                 
                                 ]
                              
                              .
                           
                        
                     
                  

Bottom reflectance is implemented for mixtures of up to six substrate types as
                        
                           (17)
                           
                              
                                 
                                    R
                                 
                                 
                                    r
                                    s
                                 
                                 
                                    b
                                 
                              
                              (
                              λ
                              )
                              =
                              ∑
                              
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                 
                                 ×
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 ×
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                    
                                       b
                                    
                                 
                                 (
                                 λ
                                 )
                              
                              .
                           
                        
                     
                  

Each substrate type is characterized by an irradiance reflectance spectrum 
                        
                           
                              R
                           
                           
                              i
                           
                           
                              b
                           
                        
                     (λ). B
                     
                        i
                      is the fraction of radiation that is reflected in sensor direction if the bottom is covered to 100% by substrate type i; B
                     
                        i
                     =1/π=0.318sr−1 represents a Lambertian surface with isotropic reflection. f
                     
                        i
                      is the areal fraction of substrate type i within an image pixel; it is Σf
                     
                        i
                     =1. The WASI database provides 6 spectra R
                     
                        i
                     
                     
                        b
                     (λ) from the German lakes Bodensee and Starnberger See (Pinnel, 2007). Spectrum #0 represents constant reflectance, #1 sand, #2 fine-grained sediment, #3 the green macrophyte Chara contraria, #4 the green macrophyte Potamogeton perfoliatus, and #5 the green macrophyte Potamogeton pectinatus.

WASI has been developed using Borland Delphi 7.0 for the operating system Microsoft Windows. The executable program including user manual can be downloaded from the IOCCG website (IOCCG, 2013a), the source code can be obtained from the author on request. The numerous model and program options are described in Gege (2004, 2012), Gege and Albert (2006) and in more detail in the manual. Here, mainly the new features relevant for processing of image data are described. The term ‘WASI’ is used for the complete software, while ‘WASI-2D’ refers specifically to the image processing module.

To illustrate the graphical user interface (GUI), a screenshot is presented in 
                        Fig. 1 which was made during inverse modelling of a hyperspectral image. The GUI consists in this case of two elements: an image preview window (Panel A), and the main WASI window known from the previous versions (Gege, 2004; Gege and Albert, 2006) (Panel B).

The image preview window opens automatically upon loading a hyperspectral image. It displays an RGB representation of the image using 3 selectable bands (3) and eventually a mask (4). During data analysis processed pixels get marked (2).

The components of the main WASI window are designated in the legend of Fig. 1. A major component is the parameter list (9). It comprises the potential fit parameters of all models implemented in WASI. Parameters irrelevant for the selected model are disabled, i.e. the corresponding symbol and value is displayed in grey, and the value cannot be edited. Checked parameters are treated as fit parameters during inverse modelling, the others as constants. The image specific settings are made in the popup window shown in 
                        Fig. 2, which is accessed from the menu bar (12) via ‘Options—2D’ .

To visualize a hyperspectral image, three bands are selected in the ‘Preview image’ panel which define the screen brightness for red, green and blue. Their radiometric dynamics is adjusted to the 8-bit screen resolution by multiplying each signal with 256C/M, where C is the contrast and M the maximum signal of the unmasked pixels. If ‘Scale bands together’ is unchecked, M is calculated individually for the red, green and blue bands; otherwise, M is the maximum of the three bands.

A mask defines the pixels which are ignored during processing. It is selected in the popup window shown in Fig. 2 using the ‘Mask’ settings. Water is in general darker than land or clouds at wavelengths above 700nm; hence an infrared band can be taken to define the mask.

The image is imported by selecting in the menu bar ‘File—Load image’. The user can visualize the spectrum of any pixel by clicking with the mouse on the pixel of interest. By using the arrow keys to move the mouse pointer, the pixel-by-pixel variability can be studied. Mean and standard deviation of an area can be visualized by drawing with the mouse a rectangle. The extracted spectra are displayed in the plot window (no. 6 in Fig. 1) and can be saved as ASCII file. Inverse modelling can be applied to each spectrum extracted in this way. This feature is useful to determine initial values of fit parameters or to analyse selected pixels for which field data are available.

The format parameters relevant for hyperspectral image data are summarized in 
                        Table 2. They are specified in the ‘Hyperspectral image’ panel of the popup window shown in Fig. 2. WASI can alternately import the image parameters from an ENVI header file (ENVI, 2005), which is widely used as file format descriptor in the remote sensing community. The ENVI header file must be located in the same directory as the image and have the filename of the image with the extension ‘.hdr’.

WASI-2D supports as input five data types (8-bit byte, 16-bit unsigned integer, 16-bit signed integer, 32-bit signed long integer, 32-bit floating point) and two interleave types (BIL=band interleaved per line, BSQ=band sequential); output is 32-bit floating point BIL or BSQ. Wavelengths are expressed in units of nm. If the ENVI header file uses other units for wavelength, the ‘wavelength scale factor’ specifies the conversion factor (e.g. 1000 if the units are µm). The ‘intensity scale factor’ can be used to re-scale all data by division with the specified value; when set to 1, no re-scaling is performed. Band dependent scaling is not supported.

The data files provided with WASI cover the spectral range from 350 to 1000nm and have a spectral sampling interval of 1nm. The user can exchange the files without limitations concerning range and sampling interval, but the number of data points is limited to 1300. To adjust the model curves to the sensor bands, the input data can be spectrally resampled to the centre wavelengths using Gaussian functions as weights. If this option is not used, the values closest to the centre wavelengths are taken for calculation. It is suggested to activate resampling unless the sensor bandwidth is less than 2 times the spectral library′s data interval.

Inverse modelling of a measurement M(λ) aims to determine the values of unknown model parameters p=(p
                        1, p
                        2, …), called fit parameters. The parameters of the described bio-optical model are listed in 
                        Table 3. The values of the unknown parameters are determined iteratively for each image pixel as follows. In the first iteration, a simulated spectrum S(λ) is calculated for initial values p
                        0=(p
                        1
                        0, p
                        2
                        0, …) of the fit parameters. If the image is in units of remote sensing reflectance, S(λ) corresponds to 
                           
                              
                                 R
                              
                              
                                 r
                                 s
                              
                              
                                 s
                                 h
                              
                           
                        (λ) and modelling is done using Eq. (6); if the units are radiance, S(λ) corresponds to L
                        
                           u
                        (λ) and Eq. (1) is used for simulation. The simulated spectrum is compared with the measurement through the residual R=B
                        −1 [Σ
                           b
                         
                        g(λ
                        
                           b
                        ) |S(λ
                        
                           b
                        )−M(λ
                        
                           b
                        )|2]1/2 as a measure of correspondence. The coefficients g(λ
                        
                           b
                        ) allow for wavelength dependent weighting; the summation index b denotes the band number and B the number of bands. Then, in the further iterations, the p values are altered using the Downhill Simplex algorithm (Nelder and Mead, 1965; Caceci and Cacheris, 1984), resulting in altered model curves and altered residuals. The procedure is stopped when the calculated and the measured spectrum agree as good as possible, which corresponds to the minimum of R. The p values of the final step after N iterations, p
                        
                           N
                        =(p
                        1
                        
                           N
                        , p
                        2
                        
                           N
                        , …), are the fit results.

A number of model parameters can change regionally or seasonally, in particular the inherent optical properties of water constituents [a
                        
                           i
                        
                        ⁎(λ), a
                        
                           Y
                        
                        ⁎(λ), a
                        
                           D
                        
                        ⁎(λ), b
                        
                           X
                        (λ), b
                        
                           b,X
                        
                        ⁎, b
                        
                           b,Mie
                        
                        ⁎] and the apparent optical properties of the bottom [R
                        
                           i
                        
                        
                           b
                        (λ), B
                        
                           i
                        ] and the atmosphere. The database provided with WASI has been derived from in-situ measurements from lakes in Southern Germany (Gege, 1998; Heege, 2000; Pinnel, 2007). If no site-specific information is available, it can be used as a first approximation for other ecosystems as well. The variability within an ecosystem can be as large as between different ecosystem, i.e. ecosystem-specific sets of optical properties do not exist. However, region or season specific information should be used whenever available. Ideally, the optical properties should be measured at the test site close to the airplane or satellite overpass. This is however not always possible. A valuable source of information is the IOCCG webpage (IOCCG, 2013b). It maintains a list of links to publicly available data sets, for example the IOCCG (2006) data bank, the NASA bio-Optical Marine Algorithm Data set (NOMAD) and the SeaWiFS Bio-Optical Archive and Storage System (SeaBASS).

Declaring a parameter as fit parameter or as constant is a critical step in data processing. The more parameters are fitted, the higher is the risk of failure due to ambiguous model curves. Furthermore, computation time increases with the number of fit parameters. Thus, the number of fit parameters should be chosen as low as justified by the variability within the scene. The more a parameter influences the spectral radiance or reflectance, the more important is an accurate estimate, and the more it should be considered as fit parameter in case it changes within the scene. Parameters with hardly changeable influence should be treated as constants.

The parameter list (9) of Fig. 1 summarizes all possible fit parameters of WASI. Most of them are usually treated as constants, and only a small fraction as fit parameters. A general rule cannot be given which parameters to fit and which to keep constant. An experience based suggestion is provided in Table 3 (column ‘Fit?’). However, it cannot guarantee optimum results for each test site and at all conditions. If the results of data analysis are unsatisfactory, site-specific sensitivity analyses can be helpful to determine the appropriate fit parameters. The reconstruction mode of WASI has been developed for that purpose (Gege, 2004; Gege and Albert, 2006). It combines forward and inverse modelling and allows to introduce well-defined errors.

The success of inverse modelling depends on appropriate initialization of the fit parameters and their ranges. The start values are set in the parameter list of the main window (no. 9 in Fig. 1), the ranges in ‘Options – Inverse calculation – Fit parameters’. Since the inversion algorithm sets the step sizes relative to the parameter values, the start value should not be set equal to zero to avoid trapping the parameter at zero.

In shallow waters, the influence of the bottom is modelled using Eq. (17) as a weighted sum of reflectance spectra R
                        
                           i
                        
                        
                           b
                        (λ) representing the different substrate types within a pixel. The weights are the products of two parameters, f
                        
                           i
                         and B
                        
                           i
                        . f
                        
                           i
                         corresponds to the areal fraction of substrate no. i and can be determined during inverse modelling if it is fit parameter. The ‘BRDF parameter’ B
                        
                           i
                         is the fraction of radiation that is reflected in sensor direction for f
                        
                           i
                        =1. Reflection is angle dependent for many substrate types, thus B
                        
                           i
                         can depend on the sun zenith angle, viewing direction and slope of the sea floor. As B
                        
                           i
                         is usually not well known and inverse modelling cannot distinguish between B
                        
                           i
                         and f
                        
                           i
                        , the identity Σf
                        
                           i
                        =1 is often not useful. Thus, WASI assigns a lower and an upper limit to Σf
                        
                           i
                        , representing in fact the range of π·Σf
                        
                           i
                        
                        B
                        
                           i
                        . The range is set by default to 0.5–2.

Inverse modelling of remote sensing data from water has frequently no unique solution since very different sets of model parameters can yield quite similar radiance and reflectance spectra (Defoin-Platel and Chami, 2007). Furthermore, sensor noise and inaccurate sensor calibration may cause wavelength-dependent errors of the measurements; atmosphere correction can introduce errors in the calculated water leaving radiance and reflectance spectra; the optical properties of the water constituents and the bottom substrates are usually not accurately known; the ever changing geometry of the water surface makes the reflections of the sun, the sky and of clouds unpredictable for pixel sizes in the order of tens of meters and below. Thus, automated algorithms cannot provide optimal results for all conditions.

For this reason WASI provides a number of options which enable users to fine-tune the inversion algorithm to known peculiarities of their dataset and to optimize processing for certain parameters of interest. The settings are made in a popup window (not shown) which is accessed from the menu bar via ‘Options – Inverse calculation – Fit tuning’. A complete documentation is given in the user manual. Important settings are wavelength range and data interval of the calculated spectra, and the allowed maximum R
                        
                           max
                         of the residuum. The Downhill Simplex algorithm converges always towards a (local) minimum, but it can happen that no parameter set exists which produces a conveniently matching fit curve with a residuum smaller than R
                        
                           max
                        . To prevent the inversion algorithm from being trapped in an endless loop, an upper limit N
                        
                           max
                         of iterations is set; the default is N
                        
                           max
                        =1000. If data processing requires frequently N
                        
                           max
                         steps, the model parameters and R
                        
                           max
                         should be checked. The coefficients g(λ
                        
                           b
                        ), which are used for wavelength dependent weighting of the difference between measured and fit curve during residual calculation, are imported from file. The default file EINS.TXT, representing g(λ
                        
                           b
                        )=1, corresponds to the classical least squares fit.

After the optical properties have been adapted to the test area, fit parameters have been chosen and initialized, and fit tuning options have been defined, data processing is started by pressing the ‘Start’ button (no. 11 in Fig. 1). A dialog requests to enter a filename for the fit results. The default extension of the output image is ‘fit’. Processing starts with the first non-masked pixel top left and ends bottom right. The correspondence between model curves and measured spectra can be checked continuously in the plot window (no. 6 in Fig. 1), which displays both curves for each nth processed pixel. The interval n can be changed in the popup window shown in Fig. 2 (‘Update spectrum after n pixels’). The progress can be tracked in the image preview window: processed pixels change their colour to grey. The shade of grey represents the result of a fit parameter as specified in the ‘Preview during inverse modelling’ box of the popup window shown in Fig. 2. Both features enable a first quality control already during data processing. The fit results are saved continuously to file during data processing, thus stopping processing (using the ‘Pause’ button) conserves the results obtained so far.

The result of inverse modelling is a multi-band image in which the preceding bands correspond to the fit parameters and the last two to the residual (R) and the number of iterations (N), respectively. All program settings are documented automatically as ASCII file, and the image properties as ENVI header file to facilitate import by other software.

@&#SUMMARY@&#

WASI-2D is a new image processing software for multi- and hyperspectral data from deep and shallow waters. It has been developed for inverse modelling of atmospherically corrected data from airborne sensors and satellite instruments and supports radiance as well as reflectance spectra. The executable program including user manual can be downloaded from the IOCCG website (IOCCG, 2013a), the source code can be obtained from the author on request. As WASI has been designed for accurate analysis of regional data by experienced users, but not for automated processing of large datasets covering a wide variety of optical properties, it is intended primarily for research and educational purposes, but not for commercial applications.

@&#REFERENCES@&#

