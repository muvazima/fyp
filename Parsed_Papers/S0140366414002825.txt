@&#MAIN-TITLE@&#Privacy-friendly load scheduling of deferrable and interruptible domestic appliances in Smart Grids

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We design a protocol for scheduling appliances when renewable energy is available.


                        
                        
                           
                           User identities and appliance consumption patterns are not exposed to the schedulers.


                        
                        
                           
                           We provide formal proofs of the security guarantees of the proposed protocol.


                        
                        
                           
                           The privacy-friendly scheduler yields a scheduling delay similar to the optimal one.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Load scheduling

Shamir Secret Sharing

Smart Grid

@&#ABSTRACT@&#


               
               
                  The massive integration of renewable energy sources in the power grid ecosystem with the aim of reducing carbon emissions must cope with their intrinsically intermittent and unpredictable nature. Therefore, the grid must improve its capability of controlling the energy demand by adapting the power consumption curve to match the trend of green energy generation. This could be done by scheduling the activities of deferrable and/or interruptible electrical appliances. However, communicating the users’ needs about the usage of their appliances also leaks sensitive information about their habits and lifestyles, thus arising privacy concerns.
                  This paper proposes a framework to allow the coordination of energy consumption without compromising the privacy of the users: the service requests generated by the domestic appliances are divided into crypto-shares using Shamir Secret Sharing scheme and collected through an anonymous routing protocol by a set of schedulers, which schedule the requests by directly operating on the shares. We discuss the security guarantees provided by our proposed infrastructure and evaluate its performance, comparing it with the optimal scheduling obtained by means of an Integer Linear Programming formulation.
               
            

@&#INTRODUCTION@&#

One of the most relevant goals in the design of the future energy grid is the massive introduction of power plants exploiting Renewable Energy Sources (RES, e.g. wind, solar and geothermal energy) to reduce carbon emission and shift towards a more sustainable power usage. However, due to the intrinsic unpredictability in the production of “green” power caused by the intermittent nature of renewables, the new Smart Grid scenario will cope with numerous issues related to the balancing of energy generation and consumption within the grid, in order to satisfy the energy demand while avoiding power waste. In addition, the energy market will experience more uncertain conditions, which could possibly affect the dynamics of energy pricing [1].

In order to increase the flexibility of the energy utilization, three complementary approaches have been proposed. The first is to equip the grid with high capacity storage banks, capable of storing energy surpluses and to release them in case of energy production deficits [2]. However, today’s state-of-the-art technology is still immature to allow a widespread introduction of storage plants, which would require tremendous installation and maintenance costs. A second possibility is to induce some modifications in the user’s energy utilization behavior by designing time-variable tariffs or introducing incentives to shift the use of some appliances to off-peak hours [3]. Unfortunately, this approach does not provide any form of direct control on the load conditions of the grid. Finally, the third alternative relies on load scheduling approaches operating at single household level or at neighborhood/microgrid level with the aim of shaping the energy demand profile in order to meet the production trend. Such mechanisms work according to the following principle: delay-tolerant and/or interruptible operations can be scheduled and initiated only when the green energy production conditions are favorable, while in case of power shortage the starting time can be postponed or the service can be momentarily interrupted. Moreover, a wide category of appliances (e.g. refrigerators, air conditioning, cooling/heating systems) can tune (up to a certain extent) their power consumption according to the grid state.

The drawback of the load scheduling approach is that it requires the users to communicate to the scheduler their preferences about the time of use and the energy consumption profile of the appliances to be scheduled, which makes the system prone to appliance load monitoring attacks (e.g. Non Intrusive Load Monitoring (NILM), load disaggregation algorithms, and transient analysis). In fact, it has been widely proved that, by analyzing the power consumption trend of an individual household, very detailed information about the personal habits of the occupants can be inferred [4,5], making it possible even to identify the specific electrical appliances working in a given time period. Therefore, designing a load scheduling system capable of preserving the privacy of the users is still an open issue.

In this paper, we propose a privacy-friendly infrastructure to perform appliance load scheduling within a neighborhood, which directly exposes neither the time of use and the energy consumption pattern of the single appliances, nor the identity of the users specifying the scheduling requests. Our solution relies on a set of schedulers which collaboratively perform the load planning by means of a MultiParty Computation (MPC) protocol based on Shamir Secret Sharing scheme. The proposed architecture is in line with the recent proposals by regulation bodies: for example, the California Public Utilities Commission [6] fosters the realization of Energy Data Centers aimed at the collection and elaboration of energy consumption data and run by governmental or public entities. While such Data Centers are assumed to be honest, our proposed architecture ensures no violation of the customers’ privacy even in presence of collectors behaving according to the “honest but curious” model.

The remainder of the paper is structured as follows: Section 2 provides a short overview of the related literature, while Section 3 recalls some background notions. Section 4 describes the privacy-preserving scheduling architecture. The attacker model and the security analysis of our proposed infrastructure are discussed in Section 5. In Section 6, the scheduling problem is formulated as an Integer Linear Program (ILP), which is used as a benchmark for the complexity and performance assessment provided in Section 7. Conclusions are drawn in the final section.

@&#RELATED WORK@&#

Various models for energy load management systems have been recently proposed by the research community: in [7], an optimal and automatic residential energy consumption scheduling framework is described, which attempts to strike a balance between minimizing the electricity payment and minimizing the waiting time for the operation of each appliance in the household, in presence of time-variable tariffs. The problem is modeled by means of a linear programming formulation and a weighted average price prediction filter is used to estimate the future trend of the energy tariff. A real-time residential load management model and algorithm is also discussed in [8], which differentiates the scheduling policy according to the type of electrical appliances to be served (interruptible, non interruptible and must-run). However, in both cases the system is designed for a single household, while our scheduling framework is aimed at controlling multiple residential buildings. The authors of [9] propose a neighborhood scheduler that divides the energy requests in queues according to their shape and priority and optimizes the service time of deferrable individual appliances (e.g. washing machines, dishwashers, cloth dryers, and electric vehicles recharge). In case the electrical appliances are assumed to have rectangular energy consumption profile, the scheduling problem can be treated as a rectangle/strip packing problem, which has been thoroughly investigated, for example in [10–12], and consists in optimally placing a set of rectangles of different dimensions in a two-dimensional space of given width and infinite height.

In our framework, differently from [7], the optimization goal is to shape the cumulative energy consumption of a set of appliances according to the availability of energy generated by renewable energy sources. We deal with the same scenario and appliance category of [9], but with respect to [9] we also consider must-run and interruptible appliances. Conversely, [12] proposes an online power strip packing algorithm for malleable energy demands with rectangular shape, providing performance guarantees in terms of upper bounds with respect to the optimal solution. Apart from the different appliance category, though our solution does not provide any guarantee on the quality of service experienced by the users, it deals with appliances having a generic energy consumption curve.

Though the problem of securely managing the energy consumption data has been widely studied in the context of the Automatic Metering Infrastructure (AMI) of Smart Grid, to the best of our knowledge this is the one of the first studies specifically dealing with data security in a load scheduling framework. Moreover, the security assumptions modeling the adversarial entities which attempt to access users’ data are quite various and most often too loose with respect to realistic attack scenarios. Paper [13] proposes a distributed architecture in which multiple Home Energy Management (HEM) units collaborate with each other in order to keep the demand and supply balanced in their neighborhood by solving a multi-stage stochastic optimization problem. The proposed system hides the users’ individual information to any external entity (e.g., energy provider or grid manager) but requires the customers to communicate their power schedules to their neighbors. Conversely, paper [14] avoids data exchange among households, but assumes a trusted energy utility to collect the individual power consumption curves and to broadcast price information which are updated at every game iteration. Our solution does not require any end-to-end communication among the households: neighboring meters acts exclusively as relays running the Crowds protocol to transmit messages which are ciphered by means of an hybrid encryption algorithm. Furthermore, our framework assumes a pool of possibly colluding honest-but-curious schedulers, ensuring that no information leaks occurs in case at least one scheduler is not colluded. Papers [15,16] assume that exchanging aggregated power consumption data at household level (e.g., on hourly basis) is sufficient to hide the usage patterns of single electric appliances to untrustworthy neighbors. However, several studies on Non-Intrusive Load Monitoring (see, e.g., [17,18]) prove that the power consumption patterns of individual appliances can easily be inferred from house-aggregated measurements. To defy such kind of attacks, our proposed protocol hides the energy consumption patterns of individual appliances to both schedulers and neighboring meters by means of Shamir Secret Sharing scheme: the only information disclosed to the schedulers is the appliance category (must-run, deferrable, interruptible) and the feasible starting times.

Among the techniques proposed to securely collect meter readings, paper [19] describes a wavelet-based data perturbation method to allow multiple entities to access the data generated by a meter with different levels of detail, according to their needs and access rights. Alternative techniques rely on data perturbation [20–22], pseudonymization [23–25], or on data aggregation by means of MultiParty Computation [26–28]. Our proposed privacy-preserving scheduling infrastructure is inspired by the one originally presented in [29] and adapted to the Smart Grid context in [28], and is based on the same homomorphic encryption scheme, named Shamir Secret Sharing. However, with respect to [28], which deals with the secure collection of meter readings in AMI, in this paper we cope with an inherently different problem, characterized by peculiar privacy requirements that must be addressed by means of specifically designed security solutions.

@&#BACKGROUND@&#

Shamir Secret Sharing (SSS) scheme [30] belongs to the family of cryptographic threshold schemes, which are designed to allow the collaborative reconstruction of a secret. In a 
                           
                              (
                              w
                              ,
                              t
                              )
                           
                        -threshold scheme, the secret is divided in w parts called shares, which are distributed among the protocol participants and can be reconstructed if at least 
                           
                              t
                              ⩽
                              w
                           
                         participants cooperate.

The SSS scheme works as follows: let 
                           
                              m
                              ∈
                              
                                 
                                    Z
                                 
                                 
                                    q
                                 
                              
                           
                         be the secret, where q is a prime number, greater than w and than all the possible secrets. To split the secret in w shares, chose 
                           
                              t
                              -
                              1
                           
                         integer random numbers 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    ρ
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    ρ
                                 
                                 
                                    t
                                    -
                                    1
                                 
                              
                           
                         with uniform distribution in 
                           
                              [
                              0
                              ,
                              q
                              -
                              1
                              ]
                           
                         and calculate the sth share of the secret 
                           
                              m
                              ,
                              (
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    s
                                 
                              
                              )
                           
                         for 
                           
                              1
                              ⩽
                              s
                              ⩽
                              w
                           
                        , where 
                           
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                           
                         are distinct integer numbers and 
                           
                              
                                 
                                    y
                                 
                                 
                                    s
                                 
                              
                              =
                              m
                              +
                              
                                 
                                    ρ
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                              +
                              
                                 
                                    ρ
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                                 
                                    2
                                 
                              
                              +
                              ⋯
                              +
                              
                                 
                                    ρ
                                 
                                 
                                    t
                                    -
                                    1
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                                 
                                    t
                                    -
                                    1
                                 
                              
                              
                              mod
                              
                              q
                           
                        . The secret can be recovered in presence of at least t shares by using the Lagrange interpolation method. The SSS scheme is fully homomorphic, meaning that both addition and multiplication can be performed directly on the shares, leading to the same result that would be obtained by computing the same operation on the plaintext. More in detail, the sum of two secrets can be locally computed by each participant by summing the corresponding shares. Conversely, multiplication requires a collaborative procedure, such as the one described in [31]. Therefore, any function that can be expressed in terms of additions and multiplications can be computed by operating on the shares, albeit with different complexity. In particular, several collaborative methods to perform the comparison of two secrets have been proposed (see e.g. [32,33]). In the remainder of the paper, we will adopt the procedure first introduced in [34] and described in [33], which works as follows: each party holding the sth shares 
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    s
                                 
                              
                              )
                              ,
                              (
                              
                                 
                                    x
                                 
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         of the secrets m and 
                           
                              
                                 
                                    m
                                 
                                 
                                    ′
                                 
                              
                           
                         to be compared selects two big random numbers 
                           
                              
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                           
                        , which can multiplicatively hide 
                           
                              m
                              -
                              
                                 
                                    m
                                 
                                 
                                    ′
                                 
                              
                           
                        , and a random bit 
                           
                              
                                 
                                    b
                                 
                                 
                                    s
                                 
                              
                              ∈
                              {
                              0
                              ,
                              1
                              }
                           
                        . The collaborative protocol enables each party to obtain a share of the quantity 
                           
                              c
                              =
                              (
                              m
                              -
                              
                                 
                                    m
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    ∏
                                 
                                 
                                    s
                                    =
                                    1
                                 
                                 
                                    t
                                 
                              
                              
                                 
                                    (
                                    -
                                    1
                                    )
                                 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                              
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                              -
                              
                                 
                                    ∑
                                 
                                 
                                    s
                                    =
                                    1
                                 
                                 
                                    t
                                 
                              
                              
                                 
                                    (
                                    -
                                    1
                                    )
                                 
                                 
                                    1
                                    -
                                    
                                       
                                          b
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                              
                                 
                                    r
                                 
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                           
                        . The result of the comparison can be computed by retrieving c, setting a bit e either to 0 in case 
                           
                              c
                              >
                              0
                           
                         or to 1 otherwise,
                           1
                           Note that in a modulo n field negative numbers are represented by the upper half of the range 
                                 
                                    [
                                    0
                                    ,
                                    n
                                    -
                                    1
                                    ]
                                 
                              .
                        
                        
                           1
                         and calculating the result of the XOR operation 
                           
                              ξ
                              =
                              e
                              ⊕
                              
                                 
                                    b
                                 
                                 
                                    1
                                 
                              
                              ⊕
                              ⋯
                              ⊕
                              
                                 
                                    b
                                 
                                 
                                    t
                                 
                              
                           
                        . 
                           
                              ξ
                              =
                              0
                           
                         indicates that 
                           
                              m
                              >
                              
                                 
                                    m
                                 
                                 
                                    ′
                                 
                              
                           
                        , while 
                           
                              ξ
                              =
                              1
                           
                         indicates that 
                           
                              m
                              ⩽
                              
                                 
                                    m
                                 
                                 
                                    ′
                                 
                              
                           
                        . The reader is referred to [33] for additional details about the collaborative procedure and the proof of the correctness of the comparison protocol.

Crowds is an anonymous routing protocol originally proposed in [35] to hide the true sender of a message by routing it randomly within a large group of users (the crowd). The protocol assumes the presence of a central node called blender, which is responsible of providing each node with the list of active crowd members and of updating it periodically, and that the communications between any two members of the crowd are encrypted using a symmetric key encryption scheme. Upon receipt of a message, each crowd member P behaves as follows: with probability 
                           
                              p
                              >
                              0.5
                           
                        , it forwards the message to a randomly chosen node within the crowd (possibly itself), otherwise it sends the node to the final addressee (see Algorithm 1). The most important anonymization property of Crowds is that the entity to which the messages are sent is equally likely to receive the message from any crowd member independently of the original sender, i.e.
                           
                              (1)
                              
                                 P
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       ∼
                                    
                                 
                                 =
                                 x
                                 |
                                 G
                                 =
                                 g
                                 )
                                 =
                                 P
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       ∼
                                    
                                 
                                 =
                                 x
                                 )
                              
                           
                        where 
                           
                              
                                 
                                    G
                                 
                                 
                                    ∼
                                 
                              
                           
                         is the random variable indicating the last hop of the message and G is the random variable indicating the original source of the message. For a proof of this statement and a detailed security analysis of the protocol, the reader is referred to [35].

It is worth noting that our privacy-preservation protocol can be built upon other anonymous routing protocols, provided that they guarantee security properties similar to (1). We think Crowds is particularly well suited for the Neighborhood Area Networks of Smart Grids, which may comprise only a limited number of nodes, because its security properties do not depend on the size of the network.
                           Algorithm 1
                           Crowds routine executed by each crowd member P
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                if 
                                                P is the sender of message M and M has never been forwarded then
                                             
                                          
                                          
                                             
                                                Select a uniformly random node within the crowd and forward M to it
                                          
                                          
                                             
                                                else
                                             
                                          
                                          
                                             
                                                Receive the pair (Node P′, Message M)
                                          
                                          
                                             
                                                Flip a biased coin such that (Pr(Heads)=
                                                p)
                                          
                                          
                                             
                                                
                                                if 
                                                Heads 
                                                then
                                             
                                          
                                          
                                             
                                                
                                                Select a uniformly random node within the crowd and forward M to it
                                          
                                          
                                             
                                                
                                                else
                                             
                                          
                                          
                                             
                                                
                                                Forward M to destination
                                          
                                          
                                             
                                                
                                                end if
                                             
                                          
                                          
                                             
                                                end if
                                             
                                          
                                       
                                    
                                 
                              
                           

As depicted in Fig. 1
                     , our proposed architecture comprises a set of Appliances, 
                        
                           A
                        
                     , each one generating its own load scheduling requests, and a set of Schedulers, 
                        
                           S
                        
                     , which collaboratively define the starting delay of the service requests received from the Appliances. Note that, as in [9], we consider deferrable Appliances without providing any guarantee on the maximum delay imposed by the scheduling algorithm on their starting times. However, with respect to [9] we also include must-run and interruptible Appliances in our analysis: service requests generated by must-run devices must be served upon arrival without delays nor interruptions, while interruptible appliances tolerate not only an initial service delay but also intermediate interruptions.

The architecture also includes a Smart Gateway in each household, which is equipped with secure communication capabilities (e.g. as the one proposed by the German Federal Office for Information Security in [36]) and is responsible of gathering the service requests generated by the Appliances inside the building and to convey them to the Schedulers. In the following we will indicate as 
                        
                           G
                        
                      the set of Gateways. We also assume that:
                        
                           1.
                           The parties agree on a hybrid encryption algorithm 
                                 
                                    E
                                    (
                                    
                                       
                                          K
                                       
                                       
                                          e
                                       
                                    
                                    ,
                                    ·
                                    )
                                 
                               and a corresponding decryption algorithm 
                                 
                                    D
                                    (
                                    
                                       
                                          K
                                       
                                       
                                          d
                                       
                                    
                                    ,
                                    ·
                                    )
                                 
                              . The hybrid scheme is assumed to be IND-CPA secure for equally sized messages [37] (i.e. it ensures message indistinguishability under chosen plaintext attack) and uses state-of-the art secure public key and symmetric cryptography to transmit messages of any size.

Each Scheduler 
                                 
                                    s
                                    ∈
                                    S
                                 
                               (
                                 
                                    1
                                    ⩽
                                    s
                                    ⩽
                                    w
                                 
                              ) has its own pair of public/private keys (
                                 
                                    
                                       
                                          K
                                       
                                       
                                          e
                                       
                                       
                                          s
                                       
                                    
                                    ,
                                    
                                       
                                          K
                                       
                                       
                                          d
                                       
                                       
                                          s
                                       
                                    
                                 
                              ) and all the Gateways know the public keys of the Schedulers.

All the communication channels among the nodes of the architecture are confidential and authenticated hop-by-hop.

A Configurator node acts as a blender for the Crowds routing protocol.

The scheduling horizon is divided in 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                               time slots.

The design goal is to make the Schedulers define the starting times of the load scheduling requests generated by the Appliances without learning their energy consumption curve nor their owner. In order to hide the energy consumption pattern of the devices, the Gateways generate multiple delayed versions of the energy consumption curve of the local Appliances (possibly interleaved by interruptions), and encrypt each of them with the SSS scheme. The shares obtained from such data must be anonymously distributed among the Schedulers in a randomized order: to do so, each set of shares (one for each sample of the curve) is conveyed to the respective Scheduler by means of the anonymous routing protocol Crowds.

Once all the Schedulers have received their shares, they verify the feasibility of each delayed curve by checking whether the total power load of the Appliances already scheduled does not exceed the expected amount of energy generated by the RESes. We assume that such expected supply curve 
                        
                           T
                           (
                           i
                           )
                        
                      (
                        
                           i
                           ⩽
                           1
                           ⩽
                           
                              
                                 T
                              
                              
                                 ∼
                              
                           
                        
                     ) is public and known to all the Schedulers. Such procedure is performed by means of a collaborative protocol based on the one proposed in [33], which enables the Schedulers to make comparisons by operating directly on the shares. Then, the Schedulers communicate to the local Gateway the feasibility of each delayed curve. The protocol guarantees that the Schedulers know neither the shape or shift of each consumption curve, nor whether, for a given shift, the corresponding shifted curve is feasible. The local Gateway schedules the lowest feasible starting time (and possible intermediate interruptions) and instructs the Appliance accordingly. Finally, the shares of the shifted curve corresponding to the delay scheduled by the Gateway are sent to the Schedulers, which use them to update their information about the overall energy consumption within the neighborhood by operating again directly on the shares.


                     Fig. 2
                      provides a pictorial view of the messages exchanged during execution of the protocol.

Let 
                        
                           
                              
                                 D
                              
                              
                                 a
                              
                           
                           (
                           i
                           )
                        
                      be a sequence of samples of the load profile curve of the Appliance 
                        
                           a
                           ∈
                           A
                        
                      (with 
                        
                           1
                           ⩽
                           i
                           ⩽
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 a
                              
                           
                        
                     , where 
                        
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 a
                              
                           
                        
                      is the sequence length). The sampling rate is set to one sample per slot. If a initiates a new service request at slot 
                        
                           τ
                        
                      (
                        
                           1
                           ⩽
                           τ
                           <
                           
                              
                                 T
                              
                              
                                 ∼
                              
                           
                           -
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 a
                              
                           
                        
                     ), it sends 
                        
                           
                              
                                 D
                              
                              
                                 a
                              
                           
                           (
                           i
                           )
                        
                      to the local Gateway g. Let 
                        
                           
                              
                                 Γ
                              
                              
                                 a
                              
                           
                        
                      be the chosen starting time of a and 
                        
                           
                              
                                 B
                              
                              
                                 a
                              
                           
                        
                      be the set of the chosen intermediate interruptions while serving a. According to the appliance type 
                        
                           
                              
                                 AT
                              
                              
                                 a
                              
                           
                        
                      (must-run, deferrable, or deferrable and interruptible), the Gateway g operates as follows:
                        
                           •
                           if a is a must-run Appliance, g computes a sequence 
                                 
                                    V
                                    
                                       
                                          (
                                          i
                                          )
                                       
                                       
                                          a
                                       
                                    
                                 
                               of length 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                              , where:
                                 
                                    
                                       V
                                       
                                          
                                             (
                                             i
                                             )
                                          
                                          
                                             a
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                            
                                                            
                                                               a
                                                            
                                                         
                                                         (
                                                         i
                                                         -
                                                         τ
                                                         )
                                                      
                                                      
                                                         if
                                                         
                                                         τ
                                                         <
                                                         i
                                                         ⩽
                                                         τ
                                                         +
                                                         
                                                            
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  
                                                                     ∼
                                                                  
                                                               
                                                            
                                                            
                                                               a
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         otherwise
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              which corresponds to setting the Appliance starting time 
                                 
                                    
                                       
                                          Γ
                                       
                                       
                                          a
                                       
                                    
                                 
                               to the following time slot (i.e. 
                                 
                                    
                                       
                                          Γ
                                       
                                       
                                          a
                                       
                                    
                                    =
                                    τ
                                    +
                                    1
                                 
                              ), without any intermediate interruption (i.e. 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          a
                                       
                                    
                                    =
                                    ø
                                 
                              ). Each sample 
                                 
                                    
                                       
                                          V
                                       
                                       
                                          a
                                       
                                    
                                    (
                                    i
                                    )
                                 
                               is divided in w shares 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          i
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          i
                                       
                                    
                                    )
                                 
                              , where 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          s
                                       
                                    
                                 
                               is the ID of Scheduler s. Note that the random coefficients 
                                 
                                    
                                       
                                          ρ
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          ρ
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          ρ
                                       
                                       
                                          t
                                          -
                                          1
                                       
                                    
                                 
                               used by the SSS scheme are refreshed for each sample. Then, g generates an ephemeral encryption/decryption keypair 
                                 
                                    (
                                    
                                       
                                          K
                                       
                                       
                                          e
                                       
                                       
                                          g
                                       
                                    
                                    ,
                                    
                                       
                                          K
                                       
                                       
                                          d
                                       
                                       
                                          g
                                       
                                    
                                    )
                                 
                               for the hybrid encryption scheme, a nonce 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          a
                                       
                                    
                                 
                              , which is used as a tag associated to the service request generated by the ath Appliance, and sends the message:
                                 
                                    (2)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             s
                                          
                                       
                                       =
                                       E
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             g
                                          
                                       
                                       ‖
                                       
                                          
                                             AT
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       
                                          
                                             r
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             1
                                          
                                       
                                       ‖
                                       ⋯
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              to the sth Scheduler
                                 2
                                 For the sake of easiness, in this paper we set as SSS threshold 
                                       
                                          t
                                          =
                                          w
                                       
                                    , meaning that all the Schedulers must collaborate to perform the scheduling procedure. However, to improve resiliency to faults and malfunctions, t could be lower than w. For a discussion on the correct dimensioning of t and w to improve resiliency, the reader is referred to [28].
                              
                              
                                 2
                               by means of the anonymous routing protocol Crowds with forwarding probability p.

if a is a deferrable Appliance, g computes 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                 
                               sequences 
                                 
                                    V
                                    
                                       
                                          (
                                          i
                                          )
                                       
                                       
                                          a
                                       
                                       
                                          j
                                       
                                    
                                 
                               (
                                 
                                    0
                                    ⩽
                                    j
                                    ⩽
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                    -
                                    1
                                 
                              ) of length 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                              , where:
                                 
                                    
                                       V
                                       
                                          
                                             (
                                             i
                                             )
                                          
                                          
                                             a
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                            
                                                            
                                                               a
                                                            
                                                         
                                                         (
                                                         i
                                                         -
                                                         j
                                                         -
                                                         τ
                                                         )
                                                      
                                                      
                                                         if
                                                         
                                                         τ
                                                         +
                                                         j
                                                         <
                                                         i
                                                         ⩽
                                                         τ
                                                         +
                                                         j
                                                         +
                                                         
                                                            
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  
                                                                     ∼
                                                                  
                                                               
                                                            
                                                            
                                                               a
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         otherwise
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Such sequences correspond to different starting times, ranging from 
                                 
                                    
                                       
                                          Γ
                                       
                                       
                                          a
                                       
                                    
                                    =
                                    τ
                                    +
                                    1
                                 
                               to 
                                 
                                    
                                       
                                          Γ
                                       
                                       
                                          a
                                       
                                    
                                    =
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                 
                              , without any intermediate interruption (i.e. 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          a
                                       
                                    
                                    =
                                    ø
                                 
                              ). Then, g divides every sample of each sequence in w shares using SSS scheme, thus obtaining 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    (
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                    )
                                 
                               sets of w shares 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                              , generates 
                                 
                                    (
                                    
                                       
                                          K
                                       
                                       
                                          e
                                       
                                       
                                          g
                                       
                                    
                                    ,
                                    
                                       
                                          K
                                       
                                       
                                          d
                                       
                                       
                                          g
                                       
                                    
                                    )
                                 
                               and 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          a
                                       
                                    
                                 
                              , and sends to the sth Scheduler the message:
                                 
                                    (3)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             s
                                          
                                       
                                       =
                                       E
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             g
                                          
                                       
                                       ‖
                                       
                                          
                                             AT
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       
                                          
                                             r
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       
                                          
                                             P
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             1
                                             ,
                                             j
                                          
                                       
                                       ‖
                                       ⋯
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ̃
                                                
                                             
                                             ,
                                             j
                                          
                                       
                                       )
                                       )
                                    
                                 
                              where 
                                 
                                    
                                       
                                          P
                                       
                                       
                                          j
                                       
                                    
                                 
                               indicates a random permutation of the sequences 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          1
                                          ,
                                          j
                                       
                                    
                                    ‖
                                    ⋯
                                    ‖
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          
                                             
                                                T
                                             
                                             
                                                ∼
                                             
                                          
                                          ,
                                          j
                                       
                                    
                                 
                               over the possible values j of the shift.

if a is a deferrable and interruptible Appliance, g computes 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                ∼
                                             
                                          
                                          -
                                          τ
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                               sequences 
                                 
                                    V
                                    
                                       
                                          (
                                          i
                                          )
                                       
                                       
                                          a
                                       
                                       
                                          j
                                          ,
                                          z
                                       
                                    
                                 
                               (
                                 
                                    0
                                    ⩽
                                    j
                                    ⩽
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                    -
                                    1
                                    ,
                                    0
                                    ⩽
                                    z
                                    ⩽
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                    -
                                    1
                                 
                              ) of length 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                              , where:
                                 
                                    
                                       V
                                       
                                          
                                             (
                                             i
                                             )
                                          
                                          
                                             a
                                          
                                          
                                             j
                                             ,
                                             z
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                            
                                                            
                                                               a
                                                            
                                                         
                                                         (
                                                         i
                                                         -
                                                         j
                                                         -
                                                         τ
                                                         )
                                                      
                                                      
                                                         if
                                                         
                                                         τ
                                                         +
                                                         j
                                                         <
                                                         i
                                                         ⩽
                                                         τ
                                                         +
                                                         j
                                                         +
                                                         
                                                            
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  
                                                                     ∼
                                                                  
                                                               
                                                            
                                                            
                                                               a
                                                            
                                                         
                                                         ∧
                                                         i
                                                         -
                                                         j
                                                         -
                                                         τ
                                                         =
                                                         z
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         otherwise
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Such sequences correspond to all the possible delays experienced by each single sample of the energy consumption curve of a, within the scheduling time span. Note that each sample is delayed regardless to the delays of the preceding and successive samples, since excluding the vectors which do not respect the correct sample ordering would impact on the length of 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          s
                                       
                                    
                                 
                              , which may leak information about the curve length 
                                 
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                 
                              . Then, g generates 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                ∼
                                             
                                          
                                          -
                                          τ
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                               sets of w shares 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          i
                                          ,
                                          j
                                          ,
                                          z
                                       
                                    
                                 
                               (w shares for each sample of the 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                ∼
                                             
                                          
                                          -
                                          τ
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                               sequences of length 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                              ), 
                                 
                                    (
                                    
                                       
                                          K
                                       
                                       
                                          e
                                       
                                       
                                          g
                                       
                                    
                                    ,
                                    
                                       
                                          K
                                       
                                       
                                          d
                                       
                                       
                                          g
                                       
                                    
                                    )
                                 
                               and 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          a
                                       
                                    
                                 
                              , and sends to the sth Scheduler the message:
                                 
                                    (4)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             s
                                          
                                       
                                       =
                                       E
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             g
                                          
                                       
                                       ‖
                                       
                                          
                                             AT
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       
                                          
                                             r
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       
                                          
                                             P
                                          
                                          
                                             j
                                             ,
                                             z
                                          
                                       
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             1
                                             ,
                                             j
                                             ,
                                             z
                                          
                                       
                                       ‖
                                       ⋯
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ̃
                                                
                                             
                                             ,
                                             j
                                             ,
                                             z
                                          
                                       
                                       )
                                       )
                                    
                                 
                              
                           

The expected daily energy production by RESes is expressed by the sequence 
                        
                           T
                           (
                           i
                           )
                        
                      (
                        
                           1
                           ⩽
                           i
                           ⩽
                           
                              
                                 T
                              
                              
                                 ∼
                              
                           
                        
                     ), which is known to each Scheduler. Moreover, every Scheduler locally stores the shares of a sequence 
                        
                           P
                           (
                           i
                           )
                        
                      which records the overall power load experienced by the grid, computed as the sum of the energy consumption curves of all the appliances already scheduled. Such shares are initialized as 
                        
                           
                              
                                 P
                              
                              
                                 s
                              
                           
                           (
                           i
                           )
                           =
                           0
                        
                      for 
                        
                           1
                           ⩽
                           i
                           ⩽
                           
                              
                                 T
                              
                              
                                 ∼
                              
                           
                           ,
                           1
                           ⩽
                           s
                           ⩽
                           w
                        
                      at the beginning of the scheduling horizon.

Upon reception of a new message 
                        
                           
                              
                                 M
                              
                              
                                 s
                              
                           
                        
                      at slot 
                        
                           τ
                        
                     , the sth Scheduler operates as follows:
                        
                           1.
                           It decrypts 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          s
                                       
                                    
                                 
                               using its decryption key 
                                 
                                    
                                       
                                          K
                                       
                                       
                                          d
                                       
                                       
                                          s
                                       
                                    
                                 
                               and reads the application type 
                                 
                                    
                                       
                                          AT
                                       
                                       
                                          a
                                       
                                    
                                 
                              .

If a is a must-run Appliance, it assumes that the starting time of a is scheduled for the slot 
                                 
                                    τ
                                    +
                                    1
                                 
                              , and updates 
                                 
                                    
                                       
                                          P
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    i
                                    )
                                    =
                                    
                                       
                                          P
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    i
                                    )
                                    +
                                    
                                       
                                          y
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          i
                                       
                                    
                                 
                               for 
                                 
                                    1
                                    ⩽
                                    i
                                    ⩽
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                              , regardless to the value of 
                                 
                                    T
                                    (
                                    i
                                    )
                                 
                              . Note that, thanks to the homomorphic properties of SSS with respect to addition, increasing the actual load curve with the contribution of the new appliance can be done by operating directly on the shares.

If a is a deferrable (but non-interruptible) Appliance, for every sample i of each sequence j, it computes 
                                 
                                    
                                       
                                          P
                                       
                                       
                                          s
                                       
                                       
                                          ′
                                       
                                    
                                    (
                                    i
                                    )
                                    =
                                    
                                       
                                          P
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    i
                                    )
                                    +
                                    
                                       
                                          y
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                              , collaboratively compares 
                                 
                                    
                                       
                                          P
                                       
                                       
                                          ′
                                       
                                    
                                    (
                                    i
                                    )
                                 
                               to 
                                 
                                    T
                                    (
                                    i
                                    )
                                 
                               with the other Schedulers according to the protocol defined in [33], and stores the sth share 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                    (
                                    c
                                    )
                                 
                               of the comparison output 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                               and the associated random bit 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          s
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                              . Then, it generates the message:
                                 
                                    (5)
                                    
                                       
                                          
                                             O
                                          
                                          
                                             s
                                          
                                       
                                       =
                                       
                                          
                                             r
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       E
                                       
                                          
                                             
                                                
                                                   
                                                      K
                                                   
                                                   
                                                      e
                                                   
                                                   
                                                      g
                                                   
                                                
                                                ,
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      a
                                                      ,
                                                      1
                                                   
                                                
                                                ‖
                                                ⋯
                                                ‖
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      j
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               s
                                                            
                                                            
                                                               1
                                                               ,
                                                               j
                                                            
                                                         
                                                         (
                                                         c
                                                         )
                                                         ‖
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               s
                                                            
                                                            
                                                               1
                                                               ,
                                                               j
                                                            
                                                         
                                                         ‖
                                                         ⋯
                                                         ‖
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               s
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     ̃
                                                                  
                                                               
                                                               ,
                                                               j
                                                            
                                                         
                                                         (
                                                         c
                                                         )
                                                         ‖
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               s
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     ̃
                                                                  
                                                               
                                                               ,
                                                               j
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              and broadcasts it to every Gateway 
                                 
                                    g
                                    ∈
                                    G
                                 
                               (note that broadcasting the message is necessary, since the identity of the sender of the load request is unknown to the Schedulers due to the usage of the Crowds protocol). Upon reception of the w messages 
                                 
                                    
                                       
                                          O
                                       
                                       
                                          s
                                       
                                    
                                 
                               (one from each of the w Schedulers), each Gateway compares the tags associated to the requests generated by the local Appliances to 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          a
                                       
                                    
                                 
                              . In case of matching, for every sample i of each sequence j, it recovers 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                               by means of the w collected shares 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                    (
                                    c
                                    )
                                 
                               and computes the final comparison result 
                                 
                                    
                                       
                                          ξ
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                               according to [33]. Then, for each sequence 
                                 
                                    j
                                    ,
                                    g
                                 
                               calculates 
                                 
                                    
                                       
                                          Ξ
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          ξ
                                       
                                       
                                          1
                                          ,
                                          j
                                       
                                    
                                    ∧
                                    ⋯
                                    ∧
                                    
                                       
                                          ξ
                                       
                                       
                                          
                                             
                                                T
                                             
                                             
                                                ∼
                                             
                                          
                                          ,
                                          j
                                       
                                    
                                 
                              . Finally, g schedules 
                                 
                                    
                                       
                                          Γ
                                       
                                       
                                          a
                                       
                                    
                                    =
                                    τ
                                    +
                                    1
                                    +
                                    
                                       
                                          j
                                       
                                       
                                          ¯
                                       
                                    
                                 
                              , where 
                                 
                                    
                                       
                                          j
                                       
                                       
                                          ¯
                                       
                                    
                                    =
                                    
                                       
                                          min
                                       
                                       
                                          {
                                          j
                                          :
                                          
                                             
                                                Ξ
                                             
                                             
                                                j
                                             
                                          
                                          =
                                          1
                                          }
                                       
                                    
                                    j
                                 
                              , communicates the pair 
                                 
                                    
                                       
                                          Γ
                                       
                                       
                                          a
                                       
                                    
                                    ,
                                    
                                       
                                          B
                                       
                                       
                                          a
                                       
                                    
                                 
                               to a, and anonymously sends to each Scheduler the shares of the 
                                 
                                    
                                       
                                          j
                                       
                                       
                                          ¯
                                       
                                    
                                 
                              th sequence by means of the Crowds protocol:
                                 
                                    (6)
                                    
                                       
                                          
                                             F
                                          
                                          
                                             s
                                          
                                       
                                       =
                                       E
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             1
                                             ,
                                             
                                                
                                                   j
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       ‖
                                       ⋯
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ̃
                                                
                                             
                                             ,
                                             
                                                
                                                   j
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              In turn, each Scheduler s replaces 
                                 
                                    
                                       
                                          P
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    i
                                    )
                                 
                               with 
                                 
                                    
                                       
                                          P
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    i
                                    )
                                    +
                                    
                                       
                                          y
                                       
                                       
                                          s
                                       
                                       
                                          a
                                          ,
                                          i
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                    
                                 
                               (
                                 
                                    1
                                    ⩽
                                    i
                                    ⩽
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                              ). In case 
                                 
                                    {
                                    j
                                    :
                                    
                                       
                                          Ξ
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    1
                                    }
                                    =
                                    ø
                                 
                              , an error message is returned and the local household must decide whether to serve the Appliance with non RES energy or not to run the Appliance at all. A discussion on the service policies to be applied to ensure fairness in case of RES-energy shortage is left for future investigation.

If a is a deferrable and interruptible Appliance, the same procedure described in 2.b is performed for every sample i of each sequence identified by the pair 
                                 
                                    (
                                    j
                                    ,
                                    z
                                    )
                                 
                              . Then, each Scheduler s broadcasts the message:
                                 
                                    (7)
                                    
                                       
                                          
                                             O
                                          
                                          
                                             s
                                          
                                       
                                       =
                                       
                                          
                                             r
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       E
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             g
                                          
                                       
                                       ,
                                       
                                          
                                             P
                                          
                                          
                                             j
                                             ,
                                             z
                                          
                                       
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             1
                                             ,
                                             j
                                             ,
                                             z
                                          
                                       
                                       (
                                       c
                                       )
                                       ‖
                                       
                                          
                                             b
                                          
                                          
                                             s
                                          
                                          
                                             1
                                             ,
                                             j
                                             ,
                                             z
                                          
                                       
                                       ‖
                                       ⋯
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   T
                                                
                                                
                                                   ̃
                                                
                                             
                                             ,
                                             j
                                             ,
                                             z
                                          
                                       
                                       (
                                       c
                                       )
                                       ‖
                                       
                                          
                                             b
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   T
                                                
                                                
                                                   ̃
                                                
                                             
                                             ,
                                             j
                                             ,
                                             z
                                          
                                       
                                       )
                                       )
                                    
                                 
                              The Gateway locally connected to the Appliance a obtains the final comparison result 
                                 
                                    
                                       
                                          ξ
                                       
                                       
                                          i
                                          ,
                                          j
                                          ,
                                          z
                                       
                                    
                                 
                               for each of the 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                ∼
                                             
                                          
                                          -
                                          τ
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                               samples, then for each sequence it calculates 
                                 
                                    
                                       
                                          Ξ
                                       
                                       
                                          j
                                          ,
                                          z
                                       
                                    
                                    =
                                    
                                       
                                          ξ
                                       
                                       
                                          1
                                          ,
                                          j
                                          ,
                                          z
                                       
                                    
                                    ∧
                                    ⋯
                                    ∧
                                    
                                       
                                          ξ
                                       
                                       
                                          
                                             
                                                T
                                             
                                             
                                                ̃
                                             
                                          
                                          ,
                                          j
                                          ,
                                          z
                                       
                                    
                                 
                              . Finally, it computes 
                                 
                                    
                                       
                                          Γ
                                       
                                       
                                          a
                                       
                                    
                                 
                               and 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          a
                                       
                                    
                                 
                               according to Algorithm 2, conveys them to a and anonymously forwards the algorithm output message 
                                 
                                    
                                       
                                          F
                                       
                                       
                                          s
                                       
                                    
                                 
                               to the Schedulers, which update 
                                 
                                    P
                                    (
                                    i
                                    )
                                 
                               as described at step 2.b.

Computation of starting time and intermediate interruptions of deferrable and interruptible Appliances 
                              
                                 
                                    
                                    
                                       
                                          Initialize 
                                                
                                                   
                                                      
                                                         Γ
                                                      
                                                      
                                                         a
                                                      
                                                   
                                                   ←
                                                   0
                                                   ,
                                                   
                                                   B
                                                   ←
                                                   ø
                                                
                                             
                                          
                                       
                                       
                                          Initialize 
                                                
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   (
                                                   z
                                                   )
                                                   ←
                                                   0
                                                   
                                                   ∀
                                                   z
                                                   :
                                                   0
                                                   ≤
                                                   z
                                                   ≤
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                            
                                                            
                                                               ̃
                                                            
                                                         
                                                      
                                                      
                                                         a
                                                      
                                                   
                                                   -
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          Initialize 
                                                
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         a
                                                         ,
                                                         i
                                                      
                                                   
                                                   ←
                                                   0
                                                   
                                                   ∀
                                                   s
                                                   :
                                                   1
                                                   ≤
                                                   s
                                                   ≤
                                                   w
                                                   ,
                                                   
                                                   i
                                                   :
                                                   1
                                                   ≤
                                                   i
                                                   ≤
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         ̃
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             for all 
                                             
                                                
                                                   z
                                                   =
                                                   0
                                                
                                              to 
                                                
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                            
                                                            
                                                               ̃
                                                            
                                                         
                                                      
                                                      
                                                         a
                                                      
                                                   
                                                   -
                                                   1
                                                
                                              
                                             do
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   J
                                                   ←
                                                   {
                                                   j
                                                   :
                                                   
                                                      
                                                         Ξ
                                                      
                                                      
                                                         j
                                                         ,
                                                         z
                                                      
                                                   
                                                   =
                                                   1
                                                   ∧
                                                   j
                                                   >
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   (
                                                   z
                                                   -
                                                   1
                                                   )
                                                   }
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             if 
                                             
                                                
                                                   J
                                                   =
                                                   ø
                                                
                                              
                                             then
                                          
                                       
                                       
                                          
                                             
                                             
                                             return warning message
                                       
                                       
                                          
                                             
                                             else
                                          
                                       
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   (
                                                   z
                                                   )
                                                   ←
                                                   
                                                      
                                                         min
                                                      
                                                      
                                                         j
                                                         ∈
                                                         J
                                                      
                                                   
                                                   j
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             
                                             if 
                                             
                                                
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   (
                                                   z
                                                   )
                                                   >
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   (
                                                   z
                                                   -
                                                   1
                                                   )
                                                   +
                                                   1
                                                
                                              
                                             then
                                          
                                       
                                       
                                          
                                             
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         a
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         a
                                                      
                                                   
                                                   ∪
                                                   {
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   (
                                                   z
                                                   -
                                                   1
                                                   )
                                                   +
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   (
                                                   z
                                                   )
                                                   -
                                                   1
                                                   }
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             
                                             end if
                                          
                                       
                                       
                                          
                                             
                                             end if
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         Γ
                                                      
                                                      
                                                         a
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   (
                                                   0
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             for all 
                                             
                                                
                                                   s
                                                   =
                                                   1
                                                   :
                                                   w
                                                   ,
                                                   i
                                                   =
                                                   1
                                                   :
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         ̃
                                                      
                                                   
                                                
                                              
                                             do
                                          
                                       
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         a
                                                         ,
                                                         i
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         a
                                                         ,
                                                         i
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         a
                                                         ,
                                                         i
                                                         ,
                                                         
                                                            
                                                               j
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                         ,
                                                         z
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             end for
                                          
                                       
                                       
                                          
                                             end for
                                          
                                       
                                       
                                          
                                             return 
                                             
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   =
                                                   (
                                                   
                                                      
                                                         K
                                                      
                                                      
                                                         e
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   ,
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         a
                                                         ,
                                                         1
                                                      
                                                   
                                                   )
                                                   ,
                                                   …
                                                   ,
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         a
                                                         ,
                                                         
                                                            
                                                               T
                                                            
                                                            
                                                               ̃
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                   )
                                                   
                                                   ∀
                                                   s
                                                   :
                                                   1
                                                   ≤
                                                   s
                                                   ≤
                                                   w
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

For the sake of easiness, we do not discuss the case of multiple requests arriving in a short time interval: we assume that the Schedulers are able to process multiple requests without ambiguities.

We assume a scenario where both Gateways and Schedulers behave according to the honest-but-curious attacker model: they obey to the protocol rules but try to infer the identities of the owners of active electrical appliances and the type of appliance being used. The first objective can be achieved by associating the service requests to the identifier of the Gateway initiating them e.g. through a linking attack, while the second implies the application of appliance load monitoring techniques. Conversely, we assume that the time of use of the appliances does not represent, by itself, a sensitive information, as long as it cannot be linked to the owner nor to the type of the electrical appliance. However, it is worth noting that the probability of success of such kind of linking attacks, which fall into the field of traffic analysis, decreases when the number of protocol participants increase, and can therefore be lowered by properly setting the size of the set 
                           
                              A
                           
                        . A possible countermeasure to linking attacks is to introduce random scheduling delays for each appliance to be scheduled. Unfortunately, such approach would lead to a strong degradation of the protocol performance in terms of the average delay experienced by the users, which would be intolerable in real scenarios. Moreover, the discussion of the impact of timing attacks on both the Crowds routing and scheduling protocol is out of the scope of this paper.

Though in this paper we do not discuss the case of dishonest users, it is worth noting that the protocol discourages selfish users from declaring their appliances to be must-run, regardless to their real type, in order to eliminate their experienced scheduling delay: since the protocol aims at adapting the overall power load to the energy production by RESes, a large fraction of must-run appliances would greatly reduce the flexibility of the aggregate load. In case of economic incentives for the usage of renewables (e.g. lower energy price), a schedule which does not take advantage of the availability of RESes would in turn cause an increase in the energy price, thus affecting the energy bill of all the users (including the cheaters).

Moreover, a wide category of intrusive attacks aimed at Denial of Service (DoS), can be mitigated by imposing a threshold on the maximum number of daily scheduling requests (e.g. a few tens per day), which avoids the generation of fake service requests by dishonest Gateways. Such fake requests would inevitably increase the delay experienced by the Appliances run by honest users. Conversely, the effect of malicious Gateways deviating from the standard Crowds message forwarding routine (e.g. dropping messages instead of relaying them, thus preventing the requests generated by honest users from being processed), can be alleviated by lowering the SSS threshold t, which ensures the correct execution of collaborative comparison procedure even in case of up to 
                           
                              w
                              -
                              t
                           
                         missing shares.


                        Obliviousness. Similarly to [28], we define the architecture as oblivious if a collusion of any number of Gateways cannot obtain information about the power consumption pattern of the scheduled electrical appliances of the same type, except for the ones belonging to the local household. More formally, we define the Obliv experiment, which involves a challenger 
                           
                              C
                           
                         and a probabilistic polynomial-time adversary 
                           
                              D
                           
                         controlling the whole set of Gateways:
                           
                              1.
                              At a given time slot 
                                    
                                       τ
                                    
                                  
                                 
                                    
                                       D
                                    
                                  selects two Appliances 
                                    
                                       
                                          
                                             a
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             a
                                          
                                          
                                             1
                                          
                                       
                                       ∈
                                       A
                                    
                                  and communicates to 
                                    
                                       C
                                    
                                  the appliance types 
                                    
                                       
                                          
                                             AT
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             AT
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 , the tags 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 , the Gateway encryption key 
                                    
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             g
                                          
                                       
                                    
                                  the consumption profiles 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                    
                                  for 
                                    
                                       1
                                       ⩽
                                       i
                                       ⩽
                                       
                                          
                                             T
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                 , and the random numbers 
                                    
                                       
                                          
                                             ρ
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             ρ
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             ρ
                                          
                                          
                                             t
                                             -
                                             1
                                          
                                       
                                    
                                  to be used to divide each sample of 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                    
                                  and 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                    
                                  in shares.


                                 
                                    
                                       C
                                    
                                  selects a random bit 
                                    
                                       b
                                       =
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                 , generates 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             b
                                          
                                       
                                       =
                                       {
                                       E
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             g
                                          
                                       
                                       ‖
                                       
                                          
                                             AT
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   b
                                                
                                             
                                          
                                       
                                       ‖
                                       
                                          
                                             r
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   b
                                                
                                             
                                          
                                       
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   b
                                                
                                             
                                             ,
                                             1
                                          
                                       
                                       ‖
                                       ⋯
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   b
                                                
                                             
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                       
                                       )
                                       
                                       ∀
                                       s
                                       ∈
                                       S
                                       }
                                    
                                  and communicates it to 
                                    
                                       D
                                    
                                 .


                                 
                                    
                                       D
                                    
                                  outputs a bit 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 .

The architecture provides obliviousness if:
                           
                              
                                 P
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 b
                                 |
                                 
                                    
                                       V
                                    
                                    
                                       b
                                    
                                 
                                 )
                                 =
                                 P
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 b
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     


                        Blindness. Moreover, we say that the architecture is t-blind if a collusion of less than t Schedulers cannot learn anything about the energy consumption trend of the appliances to be scheduled, except their type. To formalize this property, we define the Blind experiment, involving a challenger 
                           
                              C
                           
                         and an adversary 
                           
                              D
                           
                         controlling a set of Schedulers 
                           
                              
                                 
                                    S
                                 
                                 
                                    ∼
                                 
                              
                              :
                              |
                              
                                 
                                    S
                                 
                                 
                                    ∼
                                 
                              
                              |
                              <
                              t
                           
                        :
                           
                              1.
                              At a given time slot 
                                    
                                       τ
                                       ,
                                       D
                                    
                                  selects two Appliances 
                                    
                                       
                                          
                                             a
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             a
                                          
                                          
                                             1
                                          
                                       
                                       ∈
                                       A
                                    
                                  and the energy production profile by RESes 
                                    
                                       T
                                       (
                                       i
                                       )
                                    
                                 , and communicates 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                       ,
                                       T
                                       (
                                       i
                                       )
                                    
                                  for 
                                    
                                       1
                                       ⩽
                                       i
                                       ⩽
                                       
                                          
                                             T
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                  to 
                                    
                                       C
                                    
                                 , together with an arbitrarily chosen overall energy consumption curve of the Appliances already scheduled.


                                 
                                    
                                       C
                                    
                                  selects a random bit 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                       =
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                  and generates 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       =
                                       {
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                       
                                       )
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                       }
                                    
                                 . Moreover, 
                                    
                                       C
                                    
                                  generates the shares 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             s
                                          
                                       
                                       (
                                       i
                                       )
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                  of the overall energy consumption curve provided by 
                                    
                                       D
                                    
                                 , runs the comparison protocol described in [33], stores a list 
                                    
                                       
                                          
                                             I
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                  of the messages received/sent by each Scheduler 
                                    
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                  during the protocol execution, obtains the comparison outputs 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       =
                                       {
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             1
                                          
                                       
                                       (
                                       c
                                       )
                                       ,
                                       …
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                       
                                       (
                                       c
                                       )
                                       ,
                                       
                                          
                                             b
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             b
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                       
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                       }
                                    
                                 , and communicates 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             I
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                       =
                                       {
                                       
                                          
                                             I
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                       }
                                       ,
                                       
                                          
                                             O
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                       
                                    
                                  to 
                                    
                                       D
                                    
                                 .


                                 
                                    
                                       D
                                    
                                  outputs a bit 
                                    
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 .


                        Sender Anonymity. Finally, according to the definition in [38], the architecture provides sender anonymity if a collusion of any number of Schedulers cannot associate a request to the identity of the user whose Appliance generated it. Adopting the same formalization of [35], we define the following experiment, named S-Anon, which assumes a challenger 
                           
                              C
                           
                         and an adversary 
                           
                              D
                           
                         controlling the whole set of Schedulers 
                           
                              S
                           
                        :
                           
                              1.
                              
                                 
                                    
                                       D
                                    
                                  selects an Appliance 
                                    
                                       a
                                       ∈
                                       A
                                    
                                  and communicates 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             a
                                          
                                       
                                       (
                                       i
                                       )
                                    
                                  for 
                                    
                                       1
                                       ⩽
                                       i
                                       ⩽
                                       
                                          
                                             T
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                  to 
                                    
                                       C
                                    
                                 .


                                 
                                    
                                       C
                                    
                                  generates the set of encrypted measurements 
                                    
                                       V
                                       =
                                       {
                                       E
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             K
                                          
                                          
                                             e
                                          
                                          
                                             g
                                          
                                       
                                       ‖
                                       
                                          
                                             AT
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       
                                          
                                             r
                                          
                                          
                                             a
                                          
                                       
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             1
                                          
                                       
                                       ‖
                                       ⋯
                                       ‖
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             a
                                             ,
                                             
                                                
                                                   T
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                       
                                       )
                                       
                                       ∀
                                       s
                                       ∈
                                       S
                                       }
                                    
                                  and forwards each of them to the addressed Scheduler s by means of the Crowds routine until they reach the addressee.


                                 
                                    
                                       D
                                    
                                  outputs the guess 
                                    
                                       
                                          
                                             g
                                          
                                          
                                             ′
                                          
                                       
                                    
                                  of the identifier g of the Gateway locally connected to a.

We now discuss how the security properties defined in Section 5.1 are satisfied by our proposed infrastructure, also providing formal proofs.
                           Theorem 1
                           
                              Under the assumption that the cryptosystem 
                              
                                 
                                    E
                                    (
                                    
                                       
                                          K
                                       
                                       
                                          e
                                       
                                    
                                    ,
                                    ·
                                    )
                                 
                               
                              ensures message indistinguishability, the privacy-preserving load scheduling infrastructure provides 
                              
                                 obliviousness
                               
                              for Appliances of the same type.
                           

By contradiction, let us assume that the adversary 
                                 
                                    D
                                 
                               has more than negligible advantage in the Obliv experiment. Since in Obliv the adversary 
                                 
                                    A
                                 
                               arbitrarily chooses all the parameters to construct the plaintext messages 
                                 
                                    
                                       
                                          K
                                       
                                       
                                          e
                                       
                                       
                                          g
                                       
                                    
                                    ‖
                                    
                                       
                                          AT
                                       
                                       
                                          
                                             
                                                a
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                    ‖
                                    
                                       
                                          r
                                       
                                       
                                          
                                             
                                                a
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                    ‖
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          
                                             
                                                a
                                             
                                             
                                                b
                                             
                                          
                                          ,
                                          1
                                       
                                    
                                    ‖
                                    ⋯
                                    ‖
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          
                                             
                                                a
                                             
                                             
                                                b
                                             
                                          
                                          ,
                                          
                                             
                                                V
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                    
                                    
                                    ∀
                                    s
                                    ∈
                                    S
                                 
                               and the messages are equally sized if the two Appliances are of the same type, the Obliv is constructed analogously to the IND-CPA experiment [37]. It follows that, if 
                                 
                                    D
                                 
                               has more than negligible advantage over randomness to guess b in the Obliv experiment, it also has a non-negligible advantage in the IND-CPA experiment, which violates the assumption of message indistinguishability under chosen plaintext. Therefore, even if a collusion of Gateways collects all the w encrypted measurements of a given service request, it cannot obtain any information on the encrypted data.□


                              Assuming the usage of a 
                              
                                 
                                    (
                                    w
                                    ,
                                    t
                                    )
                                 
                              
                              -SSS scheme (
                              
                                 
                                    t
                                    ⩽
                                    w
                                 
                              
                              ), the privacy-preserving load scheduling infrastructure provides t-
                              
                                 blindness
                               
                              for Appliances of the same type.
                           

The proof is a consequence of the property of perfect secrecy of the SSS scheme [39] and shows that the contents of all the input/output messages received/sent by the collusion 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          ∼
                                       
                                    
                                 
                               during the scheduling procedure leak no information about 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          ¯
                                       
                                    
                                 
                              . For the single SSS-encrypted ith sample, the proof is similar to the one provided in [40, Theorem 3]: let 
                                 
                                    
                                       
                                          A
                                       
                                       
                                          0
                                       
                                    
                                    ,
                                    
                                       
                                          A
                                       
                                       
                                          1
                                       
                                    
                                 
                               be the random variables indicating the ith sample of Appliances 
                                 
                                    
                                       
                                          a
                                       
                                       
                                          0
                                       
                                    
                                    ,
                                    
                                       
                                          a
                                       
                                       
                                          1
                                       
                                    
                                 
                              . Since the value of 
                                 
                                    
                                       
                                          A
                                       
                                       
                                          0
                                       
                                    
                                 
                               is completely determined by knowledge of 
                                 
                                    
                                       
                                          A
                                       
                                       
                                          1
                                       
                                    
                                 
                              , it follows that:
                                 
                                    
                                       P
                                       (
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                       =
                                       0
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             I
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       (
                                       c
                                       )
                                       ,
                                       
                                          
                                             b
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                       )
                                       =
                                       P
                                       (
                                       
                                          
                                             A
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                       ,
                                       
                                          
                                             A
                                          
                                          
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             I
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       (
                                       c
                                       )
                                       ,
                                       
                                          
                                             b
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                       )
                                       =
                                       P
                                       (
                                       
                                          
                                             A
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             I
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       (
                                       c
                                       )
                                       ,
                                       
                                          
                                             b
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                       )
                                    
                                 
                              Since the random polynomials used to calculate each share belonging to 
                                 
                                    
                                       
                                          V
                                       
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          I
                                       
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          O
                                       
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                    
                                 
                               are independently generated, the knowledge of 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          
                                             
                                                a
                                             
                                             
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                          ,
                                          i
                                       
                                    
                                 
                               gives no information about 
                                 
                                    
                                       
                                          A
                                       
                                       
                                          1
                                          -
                                          
                                             
                                                b
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                    
                                 
                              . Further, we note that 
                                 
                                    
                                       
                                          b
                                       
                                       
                                          s
                                       
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ¯
                                             
                                          
                                          ,
                                          i
                                       
                                    
                                 
                               are random bits independently chosen w.r.t. the secrets, and that the messages listed in 
                                 
                                    
                                       
                                          I
                                       
                                       
                                          s
                                       
                                       
                                          
                                             
                                                a
                                             
                                             
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                          ,
                                          i
                                       
                                    
                                 
                               are either shares of functions of the random numbers 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          s
                                       
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ¯
                                             
                                          
                                          ,
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          s
                                       
                                       
                                          ′
                                          
                                             
                                                b
                                             
                                             
                                                ¯
                                             
                                          
                                          ,
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          b
                                       
                                       
                                          s
                                       
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ¯
                                             
                                          
                                          ,
                                          i
                                       
                                    
                                 
                               (see Section 3.1), or of intermediate results for the collaborative computation of 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          s
                                       
                                       
                                          
                                             
                                                a
                                             
                                             
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                          
                                          ,
                                          i
                                       
                                    
                                    (
                                    c
                                    )
                                 
                              , in which each share is in turn divided in w shares according to the procedure described in [31]. Therefore, by exploiting the perfect secrecy property of SSS (which states that the knowledge of less than t shares does not leak any information about the secret), we can write:
                                 
                                    
                                       P
                                       (
                                       
                                          
                                             A
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       (
                                       c
                                       )
                                       ,
                                       
                                          
                                             I
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             b
                                          
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                             i
                                          
                                       
                                       
                                       ∀
                                       s
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             ∼
                                          
                                       
                                       )
                                       =
                                       P
                                       (
                                       
                                          
                                             A
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       
                                          
                                             V
                                          
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       (
                                       i
                                       )
                                       )
                                       =
                                       P
                                       (
                                       
                                          
                                             b
                                          
                                          
                                             ¯
                                          
                                       
                                       =
                                       0
                                       )
                                       =
                                       
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              The extension to a set of 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                               measurements is straightforward. Note that for Appliances of the same type, the overall number of samples in a message is the same, thus the message length does not provide any additional information. □

Since in this paper we assume 
                           
                              t
                              =
                              w
                           
                        , information leakages can occur only in case all the w Schedulers are compromised and the infrastructure is w-blind.
                           Theorem 3
                           
                              Under assumption that the Crowds message forwarding routine follows 
                              
                                 Algorithm 1
                              , the privacy-friendly load scheduling architecture provides 
                              
                                 sender anonymity
                              
                              .
                           

Let 
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ∼
                                       
                                    
                                 
                               be the random variable indicating the set of Gateways from which the set of Schedulers 
                                 
                                    S
                                 
                               receive the w encrypted shares. Since each share is routed independently, then
                                 
                                    
                                       P
                                       (
                                       
                                          
                                             G
                                          
                                          
                                             ∼
                                          
                                       
                                       =
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             w
                                          
                                       
                                       )
                                       |
                                       G
                                       =
                                       g
                                       )
                                       =
                                       P
                                       
                                          
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   ∼
                                                
                                             
                                             =
                                             x
                                             |
                                             G
                                             =
                                             g
                                             )
                                          
                                          
                                             w
                                          
                                       
                                    
                                 
                              Using (1) we have,
                                 
                                    
                                       P
                                       
                                          
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   ∼
                                                
                                             
                                             =
                                             x
                                             |
                                             G
                                             =
                                             g
                                             )
                                          
                                          
                                             w
                                          
                                       
                                       =
                                       P
                                       
                                          
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   ∼
                                                
                                             
                                             =
                                             x
                                             )
                                          
                                          
                                             w
                                          
                                       
                                       =
                                       P
                                       (
                                       
                                          
                                             G
                                          
                                          
                                             ∼
                                          
                                       
                                       =
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             w
                                          
                                       
                                       )
                                       )
                                    
                                 
                              
                           

Therefore, 
                                 
                                    D
                                 
                               obtains no additional information about the identifier of the local Gateway g, from which it follows that the S-Anon experiment has no advantage with respect to randomness.□

In order to evaluate the performance of our privacy-preserving scheduling approach, we propose as benchmark the following ILP model. It assumes to receive as input the time of arrival of each service request and the corresponding appliance load profile, within the time span considered for the allocation of the energy requests. Conversely, our scheduling infrastructure performs the allocation in real-time without having access to the individual energy consumption profile of the electrical appliances.


                     Sets
                     
                        
                           •
                           
                              
                                 
                                    A
                                 
                              : set of deferrable and interruptible Appliances.


                              
                                 
                                    I
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                              : set of discretized time slots within the optimization time span.


                              
                                 
                                    T
                                    =
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          max
                                       
                                       
                                          a
                                       
                                    
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                    }
                                 
                              : set of discretized time slots within the runtime of the Appliances (
                                 
                                    
                                       
                                          max
                                       
                                       
                                          a
                                          ∈
                                          A
                                       
                                    
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                    <
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                 
                              ).


                     Parameters
                     
                        
                           •
                           
                              
                                 
                                    
                                       
                                          e
                                       
                                       
                                          i
                                       
                                    
                                 
                              : amount of RES-supplied energy at time 
                                 
                                    i
                                    ∈
                                    I
                                 
                              ,


                              
                                 
                                    
                                       
                                          m
                                       
                                       
                                          i
                                       
                                    
                                 
                              : aggregated energy consumption profile of must-run Appliances,


                              
                                 
                                    
                                       
                                          t
                                       
                                       
                                          a
                                       
                                    
                                 
                              : time of arrival of the service request generated by Appliance 
                                 
                                    a
                                    ∈
                                    A
                                 
                              ,


                              
                                 
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                 
                              : runtime of Appliance 
                                 
                                    a
                                    ∈
                                    A
                                 
                              ,


                              
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ai
                                       
                                    
                                 
                              : it is 1 if 
                                 
                                    i
                                    ⩾
                                    
                                       
                                          t
                                       
                                       
                                          a
                                       
                                    
                                 
                              , 0 otherwise,


                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          at
                                       
                                    
                                 
                              : load profile of Appliance 
                                 
                                    a
                                    ∈
                                    A
                                 
                               at time 
                                 
                                    t
                                    ∈
                                    T
                                 
                              .


                     Variables
                     
                        
                           •
                           
                              
                                 
                                    
                                       
                                          z
                                       
                                       
                                          ait
                                       
                                    
                                 
                              : binary variable, it is 1 if the tth sample of appliance 
                                 
                                    a
                                    ∈
                                    A
                                 
                               is scheduled at slot i, 0 otherwise


                     Objective function
                     
                        
                           (8)
                           
                              
                                 min
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         ∈
                                                         I
                                                      
                                                   
                                                
                                                
                                                   
                                                      iz
                                                   
                                                   
                                                      ai
                                                      
                                                         
                                                            
                                                               
                                                                  D
                                                               
                                                               
                                                                  ∼
                                                               
                                                            
                                                         
                                                         
                                                            a
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       -
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             a
                                          
                                       
                                       -
                                       1
                                       )
                                       -
                                       
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             a
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  


                     Constraints
                     
                        
                           (9)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       a
                                       ∈
                                       A
                                       ,
                                       t
                                       ∈
                                       T
                                       :
                                       t
                                       ⩽
                                       
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             a
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    c
                                 
                                 
                                    at
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    ait
                                 
                              
                              ⩽
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                             
                                                if
                                                
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      i
                                                   
                                                
                                                >
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                otherwise
                                             
                                          
                                       
                                       
                                       ∀
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (10)
                           
                              
                                 
                                    z
                                 
                                 
                                    ait
                                 
                              
                              ⩽
                              
                                 
                                    k
                                 
                                 
                                    ai
                                 
                              
                              
                              ∀
                              a
                              ∈
                              A
                              ,
                              
                              i
                              ∈
                              I
                              ,
                              
                              t
                              ∈
                              T
                              :
                              t
                              ⩽
                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    a
                                 
                              
                           
                        
                     
                     
                        
                           (11)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    ait
                                 
                              
                              =
                              1
                              
                              ∀
                              a
                              ∈
                              A
                              ,
                              
                              t
                              ∈
                              T
                              :
                              t
                              ⩽
                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    a
                                 
                              
                           
                        
                     
                     
                        
                           (12)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ∈
                                       I
                                       :
                                       j
                                       <
                                       i
                                    
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    aj
                                    (
                                    t
                                    -
                                    1
                                    )
                                 
                              
                              ⩾
                              
                                 
                                    z
                                 
                                 
                                    ait
                                 
                              
                              
                              ∀
                              a
                              ∈
                              A
                              ,
                              
                              i
                              ∈
                              I
                              ,
                              
                              t
                              ∈
                              T
                              :
                              t
                              ⩽
                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    a
                                 
                              
                           
                        
                     The objective function (8) minimizes the sum of the delays experienced by the Appliances. Constraint (9) imposes that, in case the amount of energy required by the must-run Appliances does not exceed the energy provided by RESes, the overall energy consumption due to both must-run and deferrable/interruptible Appliances does not go over the RES-provided energy level. Conversely, if the amount of energy required by must-run Appliances exceeds the energy production by RESes, no deferrable/interruptible Appliance is scheduled. Constraint (10) ensures that the Appliances’ starting times are scheduled after the arrivals of the corresponding service requests, while Constraint (11) imposes that every (non-null) sample of each Appliance is scheduled exactly once. Finally, Constraint (12) ensures that the samples of each Appliance are scheduled sequentially (possibly interleaved by interruptions).

In order to adapt the above discussed model to deferrable non-interruptible Appliances, the following constraint has to be included in the formulation to impose that no intermediate service interruptions occur:
                        
                           (13)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              
                                 
                                    iz
                                 
                                 
                                    ai
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                 
                              
                              -
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ∈
                                       I
                                    
                                 
                              
                              
                                 
                                    iz
                                 
                                 
                                    ai
                                    1
                                 
                              
                              +
                              1
                              =
                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    a
                                 
                              
                              
                              ∀
                              a
                              ∈
                              A
                           
                        
                     
                  

@&#PERFORMANCE EVALUATION@&#

In this section, we evaluate the performance of our proposed scheduling mechanism in terms of computational complexity, message number and length. Moreover, we compare the achieved average service delay to the optimal results obtained by means of the ILP formulation presented in Section 6. In our implementation, the hybrid cryptosystem used for the share encryption is the RSA-KEM Key Transport Algorithm [41], which uses the RSA public key cryptosystem modulo n, the KDF2 key derivation function (based on SHA-1) and the AES-Wrap-k key-wrapping scheme (where k is the AES key size) to communicate an ephemeral k-bit-long key used to encrypt the samples 
                        
                           V
                           (
                           i
                           )
                        
                      by means of the standard AES scheme operating in Cipher Block Chaining mode (CBC).

We start discussing the asymptotic number of incoming/outgoing messages for each node and scheduling phase. As shown in 
                        Table 2
                        , the number of messages exchanged by the Gateways exhibits a linear dependence on w, while for the Schedulers it depends linearly on 
                           
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                           
                         and superlinearly on w (the logarithmic factor is due to the collaborative comparison procedure discussed in [33]). However, since the total number of shares w is expected to be limited, the time horizon 
                           
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                           
                         is the only tunable parameters significantly influencing the number of messages.


                        Table 3
                         reports the type and number of operations performed by each node for the scheduling of a single service request. The computational cost of each operation is detailed in Table 4
                         based on [31,33]. Assuming a few Schedulers (e.g. less than 5) and the usage of optimized hardware for fast modular multiplication,
                           3
                           We estimated timings of tens of nanoseconds per single 64-bit modular Montgomery multiplication on a 2.5GHz Intel Core i5 processor.
                        
                        
                           3
                         at the Gateways the most demanding operation is the RSA-AES hybrid encryption, with timings in the order of milliseconds for must-run appliances, of hundreds of milliseconds for deferrable non-interruptible appliances, and of tens of seconds for deferrable interruptible appliances (results obtained based on the data provided in [42,43]). At the Schedulers, the computational time of the share collaborative comparison performed in multiple rounds depending on w is comparable to the running time of the hybrid encryption/decryption.

Note that Table 3 does not report the operations performed by the Crowds forwarding routine: for a detailed a discussion on the impact of 
                           
                              |
                              G
                              |
                           
                         and p on the message latency, expected path length and number of appearances of a given Gateway on all paths, the reader is referred to [35].

Finally, it is worth discussing the message length. Let 
                           
                              L
                              [
                              x
                              ]
                           
                         indicate the length of message x in bits, and let 
                           
                              Pad
                              [
                              x
                              ]
                           
                         indicate the length in bits of the message of size x after PKCS1.5 cryptographic padding and concatenation to a 128-bit-long initialization vector, as required by the AES specifications. Each service request generated/forwarded by the Gateways and received by a Scheduler is an RSA-KEM encrypted message 
                           
                              
                                 
                                    M
                                 
                                 
                                    s
                                 
                              
                           
                         of 
                           
                              L
                              [
                              n
                              ]
                              +
                              k
                              +
                              64
                              +
                              Pad
                              [
                              k
                              +
                              L
                              [
                              
                                 
                                    AT
                                 
                                 
                                    a
                                 
                              
                              ]
                              +
                              L
                              [
                              
                                 
                                    r
                                 
                                 
                                    a
                                 
                              
                              ]
                              +
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              L
                              [
                              q
                              ]
                              ]
                           
                         bits in case of must-run Appliance (where 
                           
                              k
                              +
                              64
                           
                         bits is the output length of the AES-Wrap-k key-wrapping scheme), of 
                           
                              L
                              [
                              n
                              ]
                              +
                              k
                              +
                              64
                              +
                              Pad
                              [
                              k
                              +
                              L
                              [
                              
                                 
                                    AT
                                 
                                 
                                    a
                                 
                              
                              ]
                              +
                              L
                              [
                              
                                 
                                    r
                                 
                                 
                                    a
                                 
                              
                              ]
                              +
                              (
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              -
                              τ
                              )
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              L
                              [
                              q
                              ]
                              ]
                           
                         bits in case of deferrable non-interruptible Appliance, and of 
                           
                              L
                              [
                              n
                              ]
                              +
                              k
                              +
                              64
                              +
                              Pad
                              [
                              k
                              +
                              L
                              [
                              
                                 
                                    AT
                                 
                                 
                                    a
                                 
                              
                              ]
                              +
                              L
                              [
                              
                                 
                                    r
                                 
                                 
                                    a
                                 
                              
                              ]
                              +
                              
                                 
                                    (
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                    )
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              L
                              [
                              q
                              ]
                              ]
                           
                         bits in case of deferrable and interruptible Appliance. During the share comparison procedure, each share received by a Scheduler is in turn divided in w shares, which are redistributed among the Schedulers. In case of deferrable non-interruptible (resp. deferrable and interruptible) Appliances, to perform 
                           
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              (
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              -
                              τ
                              )
                           
                         (resp. 
                           
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                    )
                                 
                                 
                                    2
                                 
                              
                           
                        ) comparisons per round each Scheduler sends/receives 
                           
                              w
                              -
                              1
                           
                         messages per round of 
                           
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              (
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              -
                              τ
                              )
                              L
                              [
                              q
                              ]
                           
                         (resp. 
                           
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                    )
                                 
                                 
                                    2
                                 
                              
                              L
                              [
                              q
                              ]
                           
                        ) bits each (see [33] for further details). The comparison output 
                           
                              
                                 
                                    O
                                 
                                 
                                    s
                                 
                              
                           
                         broadcasted by each Scheduler to every Gateway consists of w messages of 
                           
                              L
                              [
                              
                                 
                                    r
                                 
                                 
                                    a
                                 
                              
                              ]
                              +
                              Pad
                              [
                              (
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              -
                              τ
                              )
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              (
                              L
                              [
                              q
                              ]
                              +
                              1
                              )
                              ]
                           
                         (resp. 
                           
                              L
                              [
                              
                                 
                                    r
                                 
                                 
                                    a
                                 
                              
                              ]
                              +
                              Pad
                              [
                              
                                 
                                    (
                                    
                                       
                                          T
                                       
                                       
                                          ∼
                                       
                                    
                                    -
                                    τ
                                    )
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              (
                              L
                              [
                              q
                              ]
                              +
                              1
                              )
                           
                        ). Finally, the Gateway sends to each Scheduler the selected consumption curve through the message 
                           
                              
                                 
                                    F
                                 
                                 
                                    s
                                 
                              
                           
                         of length 
                           
                              L
                              [
                              n
                              ]
                              +
                              k
                              +
                              64
                              +
                              Pad
                              [
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              L
                              [
                              q
                              ]
                              ]
                           
                        .

Possible choices of the system parameters are: 1024-bit-long modulo n for the RSA cryptosystem, key length 
                           
                              k
                              =
                           
                        128 bits for the AES cryptosystem and 64-bit-long modulo q for the SSS scheme. The appliance tag 
                           
                              
                                 
                                    AT
                                 
                                 
                                    a
                                 
                              
                           
                         and the random number 
                           
                              
                                 
                                    r
                                 
                                 
                                    a
                                 
                              
                           
                         can be assumed to have length of 2 bits and 32 bits respectively. The assumed scheduling horizon can be a 24h period, divided in time slot duration is 5min, which corresponds to 
                           
                              
                                 
                                    T
                                 
                                 
                                    ∼
                                 
                              
                              =
                           
                        288 samples. The message lengths obtained with these parameters are summarized in Table 1 for the worst case of 
                           
                              τ
                              =
                              1
                           
                        . Since in case of deferrable and interruptible Appliances the message size of 
                           
                              
                                 
                                    M
                                 
                                 
                                    s
                                 
                              
                           
                         and 
                           
                              
                                 
                                    O
                                 
                                 
                                    s
                                 
                              
                           
                         is in the order of Gb, a trade-off between the duration of the scheduling horizon and of the single time slots must be found (e.g. 12h with slots of 15min would result in lengths of tens of Mb).

To compare the service delay introduced by our first-fit scheduling approach to the minimum delay obtainable through an optimization procedure, we extracted several load profiles of dishwashers (peak consumption of 1500W), washing machines (peak consumption of 750W), and dryers (peak consumption 6000W) from the SMART* dataset [44] and resampled them with a rate of one sample every 5min. As renewable energy supplying profile, we considered a windfarm with peak production of 50MW: the normalized hourly production (available at [45]) has been linearly interpolated to obtain a 5min sampling period. We considered a scenario with 20 households equipped with one dishwasher, one washing machine and one dryer each, for a total amount of 60 appliances. Each of them generates a service request with uniform distribution within a period of 24h, and 365 instances, corresponding to 1year of wind energy production data. Each household is also equipped with a set of must-run appliances including lights, oven, fridge, and heater (see [44] for the comprehensive list), with a peak overall consumption of 5000W.

For each instance, both the scheduling approach proposed in Section 4 and the ILP formulation described in Section 6 have been applied, first under the assumption that the 60 appliances are deferrable non-interruptible, then assuming them as deferrable and interruptible. Since the time horizon of each instance is one day, in case the scheduling delay of an Appliance exceeds 24h, the scheduling is considered to be infeasible. Table 5
                         reports the respective probabilities of finding a feasible solution to the scheduling problem. For non-interruptible Appliances, in approximately 15.1% of the considered instances, both approaches do not provide a feasible result: this happens when the overall daily energy production is not sufficient to satisfy all the service requests. Therefore, in those cases, the Appliances must be served using non-renewable energy sources, which are assumed to be unlimited and thus do not introduce any scheduling delay.
                           4
                           We do not investigate a mixed RES/non-RES approach, which would introduce unfairness in the service policy, since the fraction of Appliances powered with RES energy would possibly experience a scheduling delay, while the ones powered with traditional energy sources would be served immediately.
                        
                        
                           4
                         Such percentage reduces to 13.2% in case of interruptible appliances. In a borderline scenario, where the amount of wind energy is only slightly greater than the total energy demand, it may happen that our proposed scheduling approach fails in providing a feasible schedule, while the ILP formulation succeeds. However, we incurred in such condition only for the 0.8% of the considered instances in case of non-interruptible Appliances and for 1.9% in case of interruptible Appliances. Finally, in around 84% of cases, both approaches provide feasible solutions to the scheduling problem either for interruptible and non-interruptible Appliances: the average delay between service request and starting time experienced by a single appliance is in the range of 37–42min, with an average increase of 1.8% of the suboptimal scheduling (maximum gap of 32.7% for interruptible Appliances and of 40.1% for non-interruptible Appliances) of our proposed infrastructure with respect to the optimal solutions obtained through the ILP model. With both approaches, in case of interruptible Appliances the scheduling delay is slightly reduced (2min per Appliance on average) with respect to the non-interruptible case. Therefore, our scheduling mechanisms protects users’ privacy without significantly affecting the service delays experienced by the Appliances.

@&#CONCLUSIONS@&#

This paper proposes a privacy-preserving framework for the scheduling of power consumption requests generated by electrical Appliances in a Smart Grid scenario. To the best of our knowledge, this is the first attempt to address the problem of securely handling user data to provide a load scheduling service. The energy consumption requests generated by the smart Appliances located in the users’ households within a neighborhood are anonymously conveyed to a set of Schedulers by means of a Crowds-based routing protocol. The Schedulers collaboratively define the schedule of the requests using a Multiparty Computation mechanism based on Shamir Secret Sharing scheme. We evaluate the security guarantees provided by our proposed infrastructure assuming an honest-but-curious attacker model and show through numerical results that the additional delay is modest with respect to the optimal solutions obtained by means of an Integer Linear Programming formulation.

@&#ACKNOWLEDGEMENT@&#

The work in this paper has been partially funded by Regione Lombardia under grant no. 40545387 Smart Campus as Urban Open LAbs (SCUOLA).

@&#REFERENCES@&#

