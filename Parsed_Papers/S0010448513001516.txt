@&#MAIN-TITLE@&#Efficient energy evaluations for active B-Spline/NURBS surfaces

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Efficient Active B-Spline/NURBS energy evaluations based on an Analytic Solution.


                        
                        
                           
                           Efficient algorithm for computing the stiffness of an Active B-Spline/NURBS Surface.


                        
                        
                           
                           Accurate and stable algorithms for computing integrals of B-Spline Basis Functions.


                        
                        
                           
                           Detailed analysis of computational efficiency, accuracy and stability.


                        
                        
                           
                           Up to four times faster than standard Gaussian Quadrature for practical cases.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

B-Splines

NURBS

Surface deformation

Deformable model

@&#ABSTRACT@&#


               
               
                  The construction of the stiffness matrix associated with an Active B-Spline/NURBS surface is one of the most important but time consuming operations performed in CAD/CAM/CAE. This paper aims to address this problem and presents a novel, computationally efficient, generalised mathematical framework and accompanying algorithms based on an analytic solution to the problem. The approach is shown to extend seamlessly to the problem of computing mass, damping and forcing matrices, and importantly, can handle variable mass, damping, and stiffness coefficients. The capabilities of the algorithms are illustrated and their respective performances verified through detailed analysis of the computational efficiency, accuracy and stability in several practical case studies. The main benefit of the proposed approach is a reduction in computation times required for the evaluation of the stiffness matrix by up to a factor of 4, over the standard Gaussian Quadrature approach, for the practical cases considered, while preserving a high degree of accuracy and stability. Additionally, no assumptions regarding the problem complexity, degree, or regularity of the knot vector are imposed upon the solution in order to achieve the computational saving.
               
            

@&#INTRODUCTION@&#

The use of techniques based on energy minimisation for the implementation of physically aware deformable models is widespread across the domains of Computer Aided Design, Computer Graphics, and Computer Vision. Due primarily to the myriad of applications, the study of deformable models is one of the most active research topics in computer graphics.

The key component to imparting physical properties on a geometric model is the construction of the stiffness matrix. The generation of the stiffness matrix is one of the more time-consuming operations in computer-based modelling applications. For interactive applications such as virtual sculpting or prototyping, performance is key and waiting long periods of time for models to respond to changes made is highly undesirable. George Allen, Chief Technologist and Technical Fellow at Siemens PLM Software, recently addressed the academic research community, where he talked about what he saw as the big geometric modelling problems in industrial CAD/CAM/CAE software  [1]. Allen cited performance as one of the key issues stating that ‘Lack of real-time response makes some exploratory functions unusable, and this impairs user creativity’.

In CAD/CAM/CAE, computationally efficient bi-parametric B-Spline representations, particularly NURBS (Non-Uniform Rational B-Splines), are the dominant technology. While the study of efficient techniques for the construction of the stiffness matrix has been an active area of research since the introduction of computer based deformable models in the early 1980s, the recent popularity gain experienced by Isogeometric Analysis has instigated a spurt of new research activity for the specific problem of minimising the energy of an Active B-Spline/NURBS Surface [2–4]. There are several popular approaches ranging from indirect approaches that operate on the geometry rather than the controls to approaches that target the controls directly. Irrespective of the approach adopted, numerical methods  [5] are often favoured for their ‘black-box’ solution with universal applicability. A disadvantage of such generic numerical approaches is that they typically surrender a-priori knowledge of the system. Consequently, to achieve the levels of accuracy often deemed necessary, large numbers of discrete data points must be processed resulting in computationally expensive algorithms. Analytic solutions, where possible, can offer significant computational savings  [2].

This paper aims to address this problem and presents a novel, generalised analytic mathematical framework complete with accompanying algorithms for the computationally efficient generation of the stiffness matrix associated with an Active B-Spline surface model. The approach is shown to generalise to the problems of computing mass, damping, and forcing matrices. It is also demonstrated that the approach can cope with variable mass, damping, and stiffness coefficients. Further to this is its extension for the important special case of an Active NURBS surface using the approximation properties of B-Splines  [4,6]. No assumptions regarding the problem complexity, degree, or regularity of the knot vector are imposed on the solution. To illustrate the capabilities of the algorithms and verify their respective performances, several case studies are presented and detailed analysis of the computational efficiency, accuracy and stability is undertaken.

@&#RELATED WORK@&#

Various approaches are employed to evaluate the stiffness matrix in the context of minimising the energy of an Active B-Spline Surface. Indirect approaches work with points on the B-Spline surface, while more direct approaches target the minimisation of the actual degrees of freedom of the model, i.e., the control points. In either approach, numerical methods are typically used to evaluate the integrals and derivatives involved.

Where the surface is discretised so that discrete surface points are to be optimised, variational methods can be employed to simplify the energy equation to one involving derivatives only. The energy is minimised by finding the surface, 
                        S
                        
                           (
                           u
                           ,
                           v
                           )
                        
                     , that satisfies the corresponding Euler–Lagrange equation. Introduced to the domain of computer vision by Kass et al.  [7] and generalised to the 3D case for computer graphics applications by Terzopoulos and Fleischer  [8], this technique is prolific in the literature and has been adopted by the computer-aided design communities in the area of B-Spline surface design  [9,10]. Recent studies have examined analytic solutions to the partial differential equation for B-Splines  [2]. However, numerical approaches such as finite differences and finite elements remain the most popular choice in solving for the minimum surface point configuration  [2,11].

A similar discrete approach involves representing the surface using a mass spring damper model  [12]. Linear springs are attached between the discrete data points such that the minimal surface configuration can be found by evolving the data points under the influence of mass spring damper model forces. Typically, a B-Spline description is sought as the final representation of the deformed model and a new B-Spline surface is fitted to the new data points using a global interpolation scheme  [13,14].

Unlike the indirect approaches described above, more direct approaches involve employing the continuous description of the B-Spline Surface representation to specify the geometry in the energy equations. In such cases, the control point positions are directly optimised and the Euler–Lagrange approach cannot be used to eliminate the integral. Numerical integration approaches are thus employed to solve for the minimal energy configuration.

A wide range of numerical approaches are available with varying degrees of accuracy. For B-Spline surfaces, given their polynomial nature, Gaussian Quadrature with Gauss–Legendre calculated weights and abscissas is typically cited as the appropriate choice [4,6,15]. In general, Gaussian Quadrature evaluates the integral exactly with 
                        N
                      weights and abscissas for polynomials of degree 
                        2
                        N
                        −
                        1
                     .

From the literature, Gaussian Quadrature is the ‘state of the art’ technique for dealing with the energy minimisation of Active B-spline surfaces  [4,16,17]. However, where the number of points in a deformable model is large, integrating the energy equations using Gaussian Quadrature is a computationally intensive process. With the growing popularity of Isogeometric Analysis as an alternative to Finite Element Analysis, the study of direct approaches has regained momentum and has become an important research area as there is a growing need for more efficient solutions  [4]. To this end, much research has been devoted to designing efficient quadrature rules for B-Spline representations  [17,4,3]. Approaches adopted to alleviate the computational costs typically involve taking advantage of simplifications where the B-Spline functions have a high degree of regularity or are defined over a uniform knot vector. In the latter case, the majority of the B-Spline basis functions are translated versions of a single function. Taking such simplifications into account, more efficient quadrature rules can be devised  [4], or ‘look-up tables’ can be employed storing only the unique results [18]. This paper examines the more general case.

A B-Spline curve is a continuous parametric curve formed with polynomial sections. The curve is represented by a set of control points which are used to weight a linear sum of associated basis functions. The basis functions ensure that the curve satisfies specified continuity conditions at the boundaries of each section. The parametric curve 
                           C
                           
                              (
                              u
                              )
                           
                         is defined by 
                           
                              (1)
                              
                                 C
                                 
                                    (
                                    u
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       P
                                    
                                    
                                       i
                                    
                                 
                              
                           
                         where 
                           P
                         represents the set of 
                           n
                           +
                           1
                         control points and 
                           
                              
                                 N
                              
                              
                                 i
                                 ,
                                 p
                              
                           
                           
                              (
                              u
                              )
                           
                         are the basis functions.

For a B-Spline curve, the basis functions are defined by 
                           
                              
                                 
                                    
                                       
                                          N
                                       
                                       
                                          i
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    =
                                    
                                       
                                          u
                                          −
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          
                                             
                                                u
                                             
                                             
                                                i
                                                +
                                                p
                                             
                                          
                                          −
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                          ,
                                          p
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    +
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                i
                                                +
                                                p
                                                +
                                                1
                                             
                                          
                                          −
                                          u
                                       
                                       
                                          
                                             
                                                u
                                             
                                             
                                                i
                                                +
                                                p
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                u
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                          +
                                          1
                                          ,
                                          p
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                 
                              
                              
                                 (2)
                                 
                                    
                                       
                                          N
                                       
                                       
                                          i
                                          ,
                                          0
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                1
                                             
                                             
                                                if  
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ≤
                                                u
                                                <
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                otherwise .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 N
                              
                              
                                 i
                                 ,
                                 p
                              
                           
                           
                              (
                              u
                              )
                           
                         is a basis function of degree 
                           p
                         in the 
                           u
                         parametric direction, defined over the knot vector 
                           U
                         given by 
                           
                              (3)
                              
                                 U
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                0
                                                ,
                                                …
                                                ,
                                                0
                                             
                                             ︸
                                          
                                       
                                       
                                          p
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          u
                                       
                                       
                                          p
                                          +
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          u
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                1
                                                ,
                                                …
                                                ,
                                                1
                                             
                                             ︸
                                          
                                       
                                       
                                          p
                                          +
                                          1
                                       
                                    
                                    }
                                 
                                 .
                              
                           
                         By convention, knots at the ends of the B-Spline are repeated 
                           p
                           +
                           1
                         times so that a B-Spline curve with 
                           r
                           +
                           1
                         knots will have 
                           n
                           +
                           1
                         control points where 
                           r
                           +
                           1
                           =
                           
                              (
                              n
                              +
                              1
                              )
                           
                           +
                           p
                           +
                           1
                        , and the range of 
                           u
                         is limited to 
                           
                              
                                 u
                              
                              
                                 p
                              
                           
                           ≤
                           u
                           ≤
                           
                              
                                 u
                              
                              
                                 r
                                 −
                                 p
                              
                           
                        .

These equations can be generalised for higher dimensions. A surface model, 
                           S
                           
                              (
                              u
                              ,
                              v
                              )
                           
                        , can be represented by


                        
                           
                              (4)
                              
                                 S
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       q
                                    
                                 
                                 
                                    (
                                    v
                                    )
                                 
                                 
                                    
                                       P
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                              
                           
                        
                     

A B-Spline surface can be made ‘active’, whereby it responds in a natural and intuitive way to applied forces, by associating with it an energy function governing its properties and behaviours. The traditional energy equilibrium equation considers internal forces that resist stretching and bending  [9]. The internal energy equation can be described as 
                           
                              (5)
                              
                                 E
                                 
                                    (
                                    S
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       σ
                                    
                                 
                                 
                                    
                                       α
                                    
                                    
                                       11
                                    
                                 
                                 
                                    
                                       
                                          |
                                          
                                             
                                                ∂
                                                S
                                             
                                             
                                                ∂
                                                u
                                             
                                          
                                          |
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 2
                                 
                                    
                                       α
                                    
                                    
                                       12
                                    
                                 
                                 
                                    
                                       ∂
                                       S
                                    
                                    
                                       ∂
                                       u
                                    
                                 
                                 •
                                 
                                    
                                       ∂
                                       S
                                    
                                    
                                       ∂
                                       v
                                    
                                 
                                 +
                                 
                                    
                                       α
                                    
                                    
                                       22
                                    
                                 
                                 
                                    
                                       
                                          |
                                          
                                             
                                                ∂
                                                S
                                             
                                             
                                                ∂
                                                v
                                             
                                          
                                          |
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       11
                                    
                                 
                                 
                                    
                                       
                                          |
                                          
                                             
                                                
                                                   
                                                      ∂
                                                   
                                                   
                                                      2
                                                   
                                                
                                                S
                                             
                                             
                                                ∂
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          |
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 2
                                 
                                    
                                       β
                                    
                                    
                                       12
                                    
                                 
                                 
                                    
                                       
                                          |
                                          
                                             
                                                
                                                   
                                                      ∂
                                                   
                                                   
                                                      2
                                                   
                                                
                                                S
                                             
                                             
                                                ∂
                                                u
                                                ∂
                                                v
                                             
                                          
                                          |
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       22
                                    
                                 
                                 
                                    
                                       
                                          |
                                          
                                             
                                                
                                                   
                                                      ∂
                                                   
                                                   
                                                      2
                                                   
                                                
                                                S
                                             
                                             
                                                ∂
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          |
                                       
                                    
                                    
                                       2
                                    
                                 
                                 d
                                 u
                                 d
                                 v
                              
                           
                         where 
                           σ
                         represents the domain of the integration, or adopting more compact notation in  [19] as


                        
                           
                              (6)
                              
                                 E
                                 
                                    (
                                    S
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       σ
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       T
                                    
                                 
                                 
                                 
                                    
                                       Φ
                                    
                                    
                                       s
                                    
                                    
                                       T
                                    
                                 
                                 
                                 
                                    
                                       α
                                    
                                    ¯
                                 
                                 
                                 
                                    
                                       Φ
                                    
                                    
                                       s
                                    
                                 
                                 P
                                 
                                 +
                                 
                                    
                                       P
                                    
                                    
                                       T
                                    
                                 
                                 
                                 
                                    
                                       Φ
                                    
                                    
                                       b
                                    
                                    
                                       T
                                    
                                 
                                 
                                 
                                    
                                       β
                                    
                                    ¯
                                 
                                 
                                 
                                    
                                       Φ
                                    
                                    
                                       b
                                    
                                 
                                 
                                 P
                                 
                                 d
                                 u
                                 d
                                 v
                              
                           
                         where 
                           
                              
                                 
                                    
                                       
                                          P
                                       
                                       
                                          T
                                       
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             P
                                          
                                          
                                             0
                                             ,
                                             0
                                          
                                       
                                       
                                       ⋯
                                       
                                       
                                          
                                             P
                                          
                                          
                                             m
                                             ,
                                             n
                                          
                                       
                                       ]
                                    
                                    Φ
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      0
                                                      ,
                                                      p
                                                   
                                                
                                                
                                                   (
                                                   u
                                                   )
                                                
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      0
                                                      ,
                                                      q
                                                   
                                                
                                                
                                                   (
                                                   v
                                                   )
                                                
                                                
                                                ⋯
                                                
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      m
                                                      ,
                                                      p
                                                   
                                                
                                                
                                                   (
                                                   u
                                                   )
                                                
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      n
                                                      ,
                                                      q
                                                   
                                                
                                                
                                                   (
                                                   v
                                                   )
                                                
                                             
                                          
                                       
                                       ]
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          Φ
                                       
                                       
                                          s
                                       
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      Φ
                                                   
                                                   
                                                      u
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      Φ
                                                   
                                                   
                                                      v
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    
                                    
                                       
                                          Φ
                                       
                                       
                                          b
                                       
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      Φ
                                                   
                                                   
                                                      u
                                                      u
                                                   
                                                
                                             
                                          
                                          
                                             
                                                2
                                                
                                                   
                                                      Φ
                                                   
                                                   
                                                      u
                                                      v
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      Φ
                                                   
                                                   
                                                      v
                                                      v
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          α
                                       
                                       ¯
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      11
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      12
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      12
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      22
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    
                                    
                                       
                                          β
                                       
                                       ¯
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      β
                                                   
                                                   
                                                      11
                                                   
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      β
                                                   
                                                   
                                                      12
                                                   
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      β
                                                   
                                                   
                                                      22
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    .
                                 
                              
                           
                         This can be written as


                        
                           
                              (7)
                              
                                 E
                                 
                                    (
                                    S
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       P
                                    
                                    
                                       T
                                    
                                 
                                 
                                 
                                    
                                       K
                                    
                                    
                                       σ
                                    
                                 
                                 
                                 P
                              
                           
                         where


                        
                           
                              (8)
                              
                                 
                                    
                                       K
                                    
                                    
                                       σ
                                    
                                 
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       σ
                                    
                                 
                                 
                                    
                                       Φ
                                    
                                    
                                       s
                                    
                                    
                                       T
                                    
                                 
                                 
                                 
                                    
                                       α
                                    
                                    ¯
                                 
                                 
                                 
                                    
                                       Φ
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 
                                 
                                    
                                       Φ
                                    
                                    
                                       b
                                    
                                    
                                       T
                                    
                                 
                                 
                                 
                                    
                                       β
                                    
                                    ¯
                                 
                                 
                                 
                                    
                                       Φ
                                    
                                    
                                       b
                                    
                                 
                                 
                                 d
                                 u
                                 d
                                 v
                              
                           
                         where 
                           
                              
                                 K
                              
                              
                                 σ
                              
                           
                         is an 
                           
                              (
                              m
                              ×
                              n
                              )
                           
                           ×
                           
                              (
                              m
                              ×
                              n
                              )
                           
                         matrix known as the stiffness matrix.

The assembly of the stiffness matrix, 
                        
                           
                              K
                           
                           
                              σ
                           
                        
                     , involves the summation of integral terms representing different properties of the active surface. This can be seen by expanding Eq. (8). The tensor product construction of the B-Spline surface means that each integral can be decomposed into its constituent parametric elements such that each can be treated separately for the purpose of evaluating the integrals before being recombined in the overall stiffness matrix [18,4]. The overall problem reduces to the calculation of integrals of the form


                     
                        
                           
                              (9)
                              
                                 ∫
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                              
                           
                           
                              (10)
                              
                                 ∫
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                              
                           
                           
                              (11)
                              
                                 ∫
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          2
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          2
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                              
                           
                           
                              (12)
                              
                                 ∫
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                                 .
                              
                           
                        
                     
                  

Eqs. (9)–(12), represent four distinct terms that must be computed for each possible combination of 
                        i
                      and 
                        j
                      in both the 
                        u
                      and 
                        v
                      parametric directions. The superscript in each case denotes the grade of the derivative required. In linear algebra, the resulting matrices that need to be calculated are known as Gramian matrices  [6].

Gaussian Quadrature facilitates the approximation of a definite integral of a function through a weighted sum of values at specified points within the domain of the integration. Gauss–Legendre quadrature is a special case appropriate for dealing with polynomial data. By carefully choosing 
                           N
                         weights and abscissae, an exact solution can be obtained where the function 
                           f
                           
                              (
                              x
                              )
                           
                         is a polynomial of degree 
                           <
                           2
                           N
                        . Thus, to achieve an exact result, 
                           N
                         must be chosen such that the degree of the integrand does not exceed 
                           2
                           N
                           −
                           1
                        . The number of points needed to achieve an exact result for a polynomial of degree 
                           p
                         is given by


                        
                           
                              (13)
                              
                                 N
                                 =
                                 
                                    ⌈
                                    
                                    
                                       
                                          p
                                          +
                                          1
                                       
                                       
                                          2
                                       
                                    
                                    ⌉
                                 
                              
                           
                         where 
                           
                              ⌈
                              
                              ⌉
                           
                         represents the ceiling value of the enclosed function.

The integration is typically defined on the interval 
                           
                              [
                              −
                              1
                              ,
                              1
                              ]
                           
                         such that the Gauss–Legendre quadrature rule becomes


                        
                           
                              (14)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       −
                                       1
                                    
                                    
                                       1
                                    
                                 
                                 f
                                 
                                    (
                                    x
                                    )
                                 
                                 ≈
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                                 f
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         Any integral range can be mapped onto this same interval by a linear transformation of variables


                        
                           
                              (15)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       a
                                    
                                    
                                       b
                                    
                                 
                                 f
                                 
                                    (
                                    x
                                    )
                                 
                                 
                                 d
                                 x
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       −
                                       1
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       b
                                       −
                                       a
                                    
                                    
                                       2
                                    
                                 
                                 f
                                 
                                    (
                                    
                                       
                                          
                                             (
                                             b
                                             −
                                             a
                                             )
                                          
                                          x
                                          +
                                          
                                             (
                                             b
                                             +
                                             a
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 
                                 d
                                 x
                                 .
                              
                           
                         The generic Gauss–Legendre quadrature rule then becomes


                        
                           
                              (16)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       a
                                    
                                    
                                       b
                                    
                                 
                                 f
                                 
                                    (
                                    x
                                    )
                                 
                                 
                                 d
                                 x
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       0
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       b
                                       −
                                       a
                                    
                                    
                                       2
                                    
                                 
                                 f
                                 
                                    (
                                    
                                       
                                          
                                             (
                                             b
                                             −
                                             a
                                             )
                                          
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          +
                                          
                                             (
                                             b
                                             +
                                             a
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         Further detail on Gaussian Quadrature, including how the weights and abscissas are calculated, can be found in most numerical analysis textbooks, e.g.,   [20,5].

As B-Spline basis functions are piecewise polynomial, to utilise the Gaussian Quadrature approach, the technique must be applied to each polynomial section of each product separately. Fig. 1
                         shows the 
                           p
                           +
                           1
                         polynomial sections over 
                           p
                           +
                           1
                         knot spans for the problem 
                           ∫
                           
                              
                                 N
                              
                              
                                 4
                                 ,
                                 3
                              
                           
                           
                           
                              
                                 N
                              
                              
                                 4
                                 ,
                                 3
                              
                           
                           
                           d
                           u
                        , where 
                           
                              
                                 N
                              
                              
                                 4
                                 ,
                                 3
                              
                           
                         is the cubic basis function of index 4 on the knot vector 
                           U
                           =
                           
                              {
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                              ,
                              5
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              }
                           
                         (see Fig. 2
                        ). Here, the Gaussian abscissae have been linearly transformed to lie between the end points of each knot span. The integral of the function over each span is the weighted summation of the function evaluations at the transformed Gaussian abscissae as outlined in Eq. (16).

Recent research by Hughes et al.  [4] and Auricchio et al.  [16] has shown that by taking into account a-priori knowledge of the continuity of a B-Spline/NURBS curve across each knot, the number of Gaussian samples required per span can be reduced. It is likely that this approach will replace existing Gaussian Quadrature rules as the state of the art Gaussian Quadrature approach in time. The bench-marking implications of this research are further discussed in Section  8.

In mathematical analysis, Integration by Parts is a technique frequently used in an effort to simplify integrals involving products of functions. The relevant formula is given by


                     
                        
                           (17)
                           
                              ∫
                              u
                              
                                 (
                                 x
                                 )
                              
                              
                                 
                                    v
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 x
                                 )
                              
                              
                              d
                              x
                              =
                              u
                              
                                 (
                                 x
                                 )
                              
                              v
                              
                                 (
                                 x
                                 )
                              
                              −
                              ∫
                              
                                 
                                    u
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 x
                                 )
                              
                              v
                              
                                 (
                                 x
                                 )
                              
                              
                              d
                              x
                              .
                           
                        
                      To derive an analytic solution to the Gramian Matrix problem, Integration by Parts is applied to each matrix element to simplify integral terms.

For dealing with the Active B-Spline surface equations, the notation 
                        g
                        
                           (
                           x
                           )
                        
                      and 
                        h
                        
                           (
                           x
                           )
                        
                      is adopted to replace the more traditional notation, 
                        u
                        
                           (
                           x
                           )
                        
                      and 
                        v
                        
                           (
                           x
                           )
                        
                     , to avoid confusion with the parametric variables 
                        u
                      and 
                        v
                     . Thus, applying Integration by Parts to the integral 
                        ∫
                        
                           
                              N
                           
                           
                              i
                              ,
                              p
                           
                        
                        
                           (
                           u
                           )
                        
                        
                           
                              N
                           
                           
                              j
                              ,
                              p
                           
                        
                        
                           (
                           u
                           )
                        
                        
                        d
                        u
                     :

Let 
                        g
                        =
                        
                           
                              N
                           
                           
                              i
                              ,
                              p
                           
                        
                        
                           (
                           u
                           )
                        
                      and 
                        d
                        h
                        =
                        
                           
                              N
                           
                           
                              j
                              ,
                              p
                           
                        
                        
                           (
                           u
                           )
                        
                        
                        d
                        u
                     
                  


                     
                        
                           (18)
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              ∫
                              
                                 
                                    N
                                 
                                 
                                    j
                                    ,
                                    p
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              u
                              −
                              ∫
                              
                                 (
                                 ∫
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                                 )
                              
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                                 
                                    
                                       (
                                       1
                                       )
                                    
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              u
                              .
                           
                        
                      Repeating the process for each new integral term generated by each application of Integration by Parts,

Let 
                        g
                        =
                        
                           
                              N
                           
                           
                              i
                              ,
                              p
                           
                           
                              
                                 (
                                 1
                                 )
                              
                           
                        
                        
                           (
                           u
                           )
                        
                      and 
                        d
                        h
                        =
                        ∫
                        
                           
                              N
                           
                           
                              j
                              ,
                              p
                           
                        
                        
                           (
                           u
                           )
                        
                        
                        d
                        u
                     
                  


                     
                        
                           (19)
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                                 
                                    
                                       (
                                       1
                                       )
                                    
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              ∬
                              
                                 
                                    N
                                 
                                 
                                    j
                                    ,
                                    p
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              
                                 
                                    u
                                 
                                 
                                    2
                                 
                              
                              −
                              ∫
                              
                                 (
                                 ∬
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 
                                    
                                       u
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                                 
                                    
                                       (
                                       2
                                       )
                                    
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              u
                              .
                           
                        
                      Let 
                        g
                        =
                        
                           
                              N
                           
                           
                              i
                              ,
                              p
                           
                           
                              
                                 (
                                 2
                                 )
                              
                           
                        
                        
                           (
                           u
                           )
                        
                      and 
                        d
                        h
                        =
                        ∬
                        
                           
                              N
                           
                           
                              j
                              ,
                              p
                           
                        
                        
                           (
                           u
                           )
                        
                        
                        d
                        
                           
                              u
                           
                           
                              2
                           
                        
                     
                  


                     
                        
                           (20)
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                                 
                                    
                                       (
                                       2
                                       )
                                    
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              ∭
                              
                                 
                                    N
                                 
                                 
                                    j
                                    ,
                                    p
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              
                                 
                                    u
                                 
                                 
                                    3
                                 
                              
                              −
                              ∫
                              
                                 (
                                 ∭
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 
                                    
                                       u
                                    
                                    
                                       3
                                    
                                 
                                 )
                              
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                                 
                                    
                                       (
                                       3
                                       )
                                    
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              u
                              .
                           
                        
                      Let 
                        g
                        =
                        
                           
                              N
                           
                           
                              i
                              ,
                              p
                           
                           
                              
                                 (
                                 3
                                 )
                              
                           
                        
                        
                           (
                           u
                           )
                        
                      and 
                        d
                        h
                        =
                        ∭
                        
                           
                              N
                           
                           
                              j
                              ,
                              p
                           
                        
                        
                           (
                           u
                           )
                        
                        
                        d
                        
                           
                              u
                           
                           
                              3
                           
                        
                     
                  


                     
                        
                           (21)
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                                 
                                    
                                       (
                                       3
                                       )
                                    
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              ⨌
                              
                                 
                                    N
                                 
                                 
                                    j
                                    ,
                                    p
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              
                                 
                                    u
                                 
                                 
                                    4
                                 
                              
                              −
                              ∫
                              
                                 (
                                 ⨌
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 
                                    
                                       u
                                    
                                    
                                       4
                                    
                                 
                                 )
                              
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                                 
                                    
                                       (
                                       4
                                       )
                                    
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              u
                              .
                           
                        
                      The iteration must be repeated such that the final iteration results in a product of basis functions that includes the 
                        
                           (
                           p
                           +
                           1
                           )
                        
                     th derivative. As before, we assume cubic basis functions such that the fourth derivative is required. Expanding Eq. (9) with the partial expressions from the repeated Integration by Parts, and applying the limits of integration for the parameter domain, e.g.,  
                        
                           [
                           0
                           ,
                           1
                           ]
                        
                     , gives


                     
                        
                           (22)
                           
                              
                                 
                                    ∫
                                 
                                 
                                    0
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                                 
                                    N
                                 
                                 
                                    j
                                    ,
                                    p
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              u
                              =
                              
                                 
                                    
                                       [
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             j
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                       d
                                       u
                                       ]
                                    
                                 
                                 
                                    0
                                 
                                 
                                    1
                                 
                              
                              −
                              
                                 
                                    
                                       [
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                          
                                          
                                             
                                                (
                                                1
                                                )
                                             
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             j
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                       d
                                       
                                          
                                             u
                                          
                                          
                                             2
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    0
                                 
                                 
                                    1
                                 
                              
                              +
                              
                                 
                                    
                                       [
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                          
                                          
                                             
                                                (
                                                2
                                                )
                                             
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             j
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                       d
                                       
                                          
                                             u
                                          
                                          
                                             3
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    0
                                 
                                 
                                    1
                                 
                              
                              −
                              
                                 
                                    
                                       [
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                          
                                          
                                             
                                                (
                                                3
                                                )
                                             
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             ∫
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             j
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                       d
                                       
                                          
                                             u
                                          
                                          
                                             4
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    0
                                 
                                 
                                    1
                                 
                              
                              +
                              
                                 
                                    ∫
                                 
                                 
                                    0
                                 
                                 
                                    1
                                 
                              
                              
                                 (
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 
                                    
                                       u
                                    
                                    
                                       4
                                    
                                 
                                 )
                              
                              
                              
                                 
                                    N
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                                 
                                    
                                       (
                                       4
                                       )
                                    
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              
                              d
                              u
                              .
                           
                        
                     
                  

Similarly, Eqs. (10) through to (12) become


                     
                        
                           
                              (23)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                                 =
                                 
                                    
                                       
                                          [
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                             
                                                N
                                             
                                             
                                                j
                                                ,
                                                p
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       
                                          [
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   2
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                             
                                                ∫
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                N
                                             
                                             
                                                j
                                                ,
                                                p
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          u
                                          ]
                                       
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       
                                          [
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   3
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                             
                                                ∫
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                ∫
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                N
                                             
                                             
                                                j
                                                ,
                                                p
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          
                                             
                                                u
                                             
                                             
                                                2
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                    d
                                    
                                       
                                          u
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          4
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                              
                           
                           
                              (24)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          2
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          2
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                                 =
                                 
                                    
                                       
                                          [
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   2
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                             
                                                N
                                             
                                             
                                                j
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       
                                          [
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   3
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                             
                                                N
                                             
                                             
                                                j
                                                ,
                                                p
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          4
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                              
                           
                           
                              (25)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                                 =
                                 
                                    
                                       
                                          [
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          ∫
                                          
                                             
                                                N
                                             
                                             
                                                j
                                                ,
                                                p
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          u
                                          ]
                                       
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       
                                          [
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   2
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                             
                                                ∫
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                ∫
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                N
                                             
                                             
                                                j
                                                ,
                                                p
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          
                                             
                                                u
                                             
                                             
                                                2
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       
                                          [
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   3
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                             
                                                ∫
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                ∫
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                ∫
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                N
                                             
                                             
                                                j
                                                ,
                                                p
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          
                                             
                                                u
                                             
                                             
                                                3
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                    d
                                    
                                       
                                          u
                                       
                                       
                                          3
                                       
                                    
                                    )
                                 
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          4
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                                 .
                              
                           
                        
                     
                  

At first it may not appear as though Integration by Parts has simplified the problem. However, the majority of the constant terms in the equations are 0, with the exception of those involving the basis functions at either end of the knot vector. Additionally, the 
                        
                           (
                           p
                           +
                           1
                           )
                        
                     th derivative of the 
                        p
                     th degree curve presents an interesting special case that results in a simplification of the problem that will be dealt with in the next section.

Basis functions are generally treated as only existing over a finite region of the knot vector, i.e.,  
                           
                              
                                 N
                              
                              
                                 i
                                 ,
                                 p
                              
                           
                         exists only where 
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                           ≤
                           u
                           <
                           
                              
                                 u
                              
                              
                                 i
                                 +
                                 p
                                 +
                                 1
                              
                           
                        . The piecewise nature of the equations means that separate equations define the basis functions over each knot span 
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                           ≤
                           u
                           <
                           
                              
                                 u
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        . In the literature, the equations provided typically deal with defining values for basis functions within the limits of each span, e.g., Piegl and Tiller  [21] state that 
                           k
                         in Eq. (28) should not exceed 
                           p
                         as all higher derivatives are zero. If the basis functions are viewed as existing over the full range of the knot vector with zero value outside the range 
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                           ≤
                           u
                           <
                           
                              
                                 u
                              
                              
                                 i
                                 +
                                 p
                                 +
                                 1
                              
                           
                        , an interesting case develops at the junction of each span, i.e., the knots.


                        Fig. 2 shows cubic basis functions defined over the knot vector 
                           U
                           =
                           
                              {
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                              ,
                              5
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              }
                           
                        . Repeated differentiation of the basis functions leads to piecewise quadratic curves, linear curves, and as can be seen, if the full range of 
                           u
                        , spanning the entire knot vector, is considered, the 
                           p
                        th derivative of each basis function becomes a sum of weighted and shifted Heaviside/Step functions.

The Heaviside function is the basic building block for functions with a discontinuity  [22] and is defined as


                        
                           
                              (26)
                              
                                 H
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             0
                                          
                                          
                                             when  
                                             t
                                             <
                                             0
                                             ,
                                          
                                       
                                       
                                          
                                             1
                                          
                                          
                                             when  
                                             t
                                             ≥
                                             0
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The Heaviside function can be shifted so that it can represent a discontinuity at the critical point.


                        
                           
                              (27)
                              
                                 H
                                 
                                    (
                                    t
                                    −
                                    
                                       
                                          t
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             0
                                          
                                          
                                             when  
                                             t
                                             <
                                             
                                                
                                                   t
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             1
                                          
                                          
                                             when  
                                             t
                                             ≥
                                             
                                                
                                                   t
                                                
                                                
                                                   0
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                         The Heaviside function is shown in Fig. 3
                        .

The analytic solution to the energy minimisation problem described in the previous section requires the evaluation of the 
                           
                              (
                              p
                              +
                              1
                              )
                           
                        th derivative. As described in  [21], the first 
                           p
                         derivatives of the basis functions can be calculated using


                        
                           
                              (28)
                              
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          k
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 =
                                 
                                    
                                       p
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             i
                                             +
                                             p
                                          
                                       
                                       −
                                       
                                          
                                             u
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                       −
                                       1
                                    
                                    
                                       
                                          (
                                          k
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 −
                                 
                                    
                                       p
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             i
                                             +
                                             p
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             u
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       +
                                       1
                                       ,
                                       p
                                       −
                                       1
                                    
                                    
                                       
                                          (
                                          k
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 .
                              
                           
                         The 
                           
                              (
                              p
                              +
                              1
                              )
                           
                        th derivatives then amount to finding the derivative of each sum of weighted and shifted Heaviside/Step functions.

The Dirac delta function, 
                           δ
                           
                              (
                              t
                              )
                           
                        , shown in Fig. 4
                        , can be regarded formally as the derivative of the unit function 
                           H
                           
                              (
                              t
                              )
                           
                           [22]. The relationship between the Heaviside function and Dirac delta function is given in Eqs. (29) and (30).


                        
                           
                              
                                 (29)
                                 
                                    
                                       
                                          d
                                          H
                                          
                                             (
                                             t
                                             )
                                          
                                       
                                       
                                          d
                                          t
                                       
                                    
                                    =
                                    δ
                                    
                                       (
                                       t
                                       )
                                    
                                 
                              
                              
                                 (30)
                                 
                                    H
                                    
                                       (
                                       t
                                       )
                                    
                                    =
                                    
                                       
                                          ∫
                                       
                                       
                                          −
                                          ∞
                                       
                                       
                                          t
                                       
                                    
                                    δ
                                    
                                       (
                                       t
                                       )
                                    
                                    d
                                    t
                                    .
                                 
                              
                           
                        
                     

The derivative of a sum of weighted and shifted Heaviside functions equates to a sum of weighted and shifted Dirac delta functions. This situation is depicted for the example case in Fig. 2.

The ‘sifting’ property of the Dirac delta, described by Eq. (31), facilitates the evaluation of the special case referred to in the previous section.


                        
                           
                              (31)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       a
                                    
                                    
                                       b
                                    
                                 
                                 f
                                 
                                    (
                                    t
                                    )
                                 
                                 δ
                                 
                                    (
                                    t
                                    −
                                    
                                       
                                          t
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                                 d
                                 t
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             f
                                             
                                                (
                                                t
                                                )
                                             
                                          
                                          
                                             for  
                                             a
                                             ≤
                                             
                                                
                                                   t
                                                
                                                
                                                   0
                                                
                                             
                                             <
                                             b
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             otherwise .
                                          
                                       
                                    
                                 
                              
                           
                         Using the sifting property, the equation


                        
                           
                              (32)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          ∫
                                       
                                       
                                          0
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                    d
                                    
                                       
                                          u
                                       
                                       
                                          4
                                       
                                    
                                    )
                                 
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                    
                                       
                                          (
                                          4
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                 d
                                 u
                              
                           
                         results in a sum of weighted and shifted Dirac delta functions, weighted by the magnitudes of the associated Heaviside changes, that sample the values of 
                           
                              
                                 ∫
                              
                              
                                 0
                              
                              
                                 1
                              
                           
                           
                              
                                 ∫
                              
                              
                                 0
                              
                              
                                 1
                              
                           
                           
                              
                                 ∫
                              
                              
                                 0
                              
                              
                                 1
                              
                           
                           
                              
                                 ∫
                              
                              
                                 0
                              
                              
                                 1
                              
                           
                           
                              
                                 N
                              
                              
                                 j
                                 ,
                                 p
                              
                           
                           
                              (
                              u
                              )
                           
                           
                           d
                           
                              
                                 u
                              
                              
                                 4
                              
                           
                         at the sites of the relevant Dirac deltas, i.e., the knots.

To calculate the magnitude of the Dirac delta weights, the 
                           p
                        th derivatives at either side of the site of the Dirac delta can be differenced. The direction of the Dirac delta is given by the sign of the weight.

Using these mathematical tools, an analytic solution to the stiffness matrix problem can be found.


                        Fig. 5
                         shows a graphical interpretation of the Analytic approach. From the diagram, it is clear that if the functions 
                           u
                        , 
                           v
                        , and 
                           ∫
                           v
                           
                           d
                           u
                         can all be evaluated, then so too can 
                           ∫
                           u
                           
                           d
                           v
                        . The premise therefore of Integration by Parts is to express 
                           ∫
                           u
                           
                           d
                           v
                         in terms of the related functions 
                           u
                        , 
                           v
                        , and an ideally simpler integral, 
                           ∫
                           v
                           
                           d
                           u
                         that can be evaluated.

In the case of the energy minimisation problem, the graphical representation of each curve produced by the repeated Integration by Parts for each of the four terms is shown by Figs. 6–13
                        
                        
                        
                        
                        
                        
                        
                        . For each case, the product of the relevant terms is shown together with its integral curve. As can be seen, the repeated Integration by Parts systematically reduces the products to the special case depicted in Fig. 14
                        . The Dirac delta functions are scaled here to reflect the weight introduced as a result of the magnitude of the related Heaviside functions produced by repeated differentiation of the basis function. Fig. 15
                         shows the basis function and its 
                           p
                         repeated derivatives that bring about the Heaviside functions.

Treatment of the integral of a B-Spline basis function does not appear to be standard in the literature  [21,23–25]. Integrals are briefly discussed by Deboor  [26] and by Schumaker  [6] and Kazinnik and Elber  [27]. In this section an analytic formula for evaluating the integrals and repeated integrals is derived directly from the basis function and derivative formulae provided in  [21] (A similar derivation can be found in Kazinnik and Elber  [27]). This results in the 
                           i
                        th basis function equating to a weighted sum of higher degree basis functions from 
                           i
                         to 
                           m
                        , the final knot, evaluated over the same knot vector. Any additional knots necessary to support the higher order functions can be achieved by extending the 
                           p
                           +
                           1
                         multiple knots at the end of the knot vector. 
                           
                              (33)
                              
                                 ∫
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             u
                                          
                                          
                                             i
                                             +
                                             p
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             u
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       p
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       i
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 .
                              
                           
                        
                     


                        
                           Proof
                           Starting with the recursive solution for finding the derivative of a b-spline basis function 
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                          
                                          
                                             
                                                (
                                                1
                                                )
                                             
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       =
                                       
                                          
                                             p
                                          
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                   +
                                                   p
                                                
                                             
                                             −
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       −
                                       
                                          
                                             p
                                          
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                   +
                                                   p
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             +
                                             1
                                             ,
                                             p
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       .
                                    
                                 
                               Rearranging and integrating gives 
                                 
                                    
                                       ∫
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                       d
                                       u
                                       =
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                   +
                                                   p
                                                
                                             
                                             −
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             p
                                          
                                       
                                       
                                          (
                                          ∫
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          u
                                          +
                                          
                                             
                                                p
                                             
                                             
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                      +
                                                      p
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          ∫
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                +
                                                1
                                                ,
                                                p
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          u
                                          )
                                       
                                       .
                                    
                                 
                               Repeating this process for remaining integral term yields 
                                 
                                    
                                       ∫
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             +
                                             1
                                             ,
                                             p
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                       d
                                       u
                                       =
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                   +
                                                   p
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             p
                                          
                                       
                                       
                                          (
                                          ∫
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                +
                                                1
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          u
                                          +
                                          
                                             
                                                p
                                             
                                             
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                      +
                                                      p
                                                      +
                                                      2
                                                   
                                                
                                                −
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                      +
                                                      2
                                                   
                                                
                                             
                                          
                                          ∫
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                +
                                                2
                                                ,
                                                p
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          u
                                          )
                                       
                                       .
                                    
                                 
                               Substituting for the second term 
                                 
                                    
                                       ∫
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                       d
                                       u
                                       =
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                   +
                                                   p
                                                
                                             
                                             −
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             p
                                          
                                       
                                       
                                          (
                                          ∫
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                             
                                             
                                                
                                                   (
                                                   1
                                                   )
                                                
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          
                                          d
                                          u
                                          +
                                          
                                             
                                                p
                                             
                                             
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                      +
                                                      p
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         i
                                                         +
                                                         p
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                
                                                
                                                   p
                                                
                                             
                                             
                                                (
                                                ∫
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                      ,
                                                      p
                                                   
                                                   
                                                      
                                                         (
                                                         1
                                                         )
                                                      
                                                   
                                                
                                                
                                                   (
                                                   u
                                                   )
                                                
                                                
                                                d
                                                u
                                                +
                                                
                                                   
                                                      p
                                                   
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            i
                                                            +
                                                            p
                                                            +
                                                            2
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            i
                                                            +
                                                            2
                                                         
                                                      
                                                   
                                                
                                                ∫
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      i
                                                      +
                                                      2
                                                      ,
                                                      p
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   u
                                                   )
                                                
                                                
                                                d
                                                u
                                                )
                                             
                                             )
                                          
                                          )
                                       
                                       .
                                    
                                 
                              
                           

As can be seen, the additional constant multipliers cancel each other out. Repeating this process, all additional constant multipliers cancel out. Rearranging the indices completes the proof.
                                 
                                    
                                       ∫
                                       
                                          
                                             N
                                          
                                          
                                             i
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                       d
                                       u
                                       =
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                   +
                                                   p
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             p
                                             +
                                             1
                                          
                                       
                                       
                                          (
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                ,
                                                p
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          +
                                          
                                             
                                                N
                                             
                                             
                                                i
                                                +
                                                1
                                                ,
                                                p
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          +
                                          ⋯
                                          +
                                          
                                             
                                                N
                                             
                                             
                                                m
                                                ,
                                                p
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             u
                                             )
                                          
                                          )
                                       
                                       .
                                    
                                 
                              
                           


                        Fig. 16
                         depicts the calculation of the integral of basis function 
                           
                              
                                 N
                              
                              
                                 4
                                 ,
                                 3
                              
                           
                         on knot vector 
                           U
                           =
                           
                              {
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                              ,
                              5
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              }
                           
                        . As can be seen the summation of the higher order basis functions on the same knot vector equates to the integral of the curve. Fig. 17
                         shows the integrals for all of the cubic basis functions on the knot vector 
                           U
                           =
                           
                              {
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                              ,
                              5
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              }
                           
                        .

Repeated integrals can be calculated by repeated application of the integral formula as seen in Fig. 18
                        .

This section builds on the mathematical framework presented in the previous section and develops an efficient algorithm for the computation of the four Gramian matrices required for the assembly of the stiffness matrix.

The main difficulty in computing the Gramian Matrices analytically lies in the evaluation of the weighted sums of integrals. Efficient algorithms for the computation of the integral and repeated integrals which form the backbone of the stiffness matrix algorithm are developed. To exemplify the overall approach, the technique is demonstrated for the calculation of the Gramian matrices associated with the cubic basis functions shown in Fig. 2.

Due to the reuse of values possible, it is efficient to address the Gramian matrix generation knot by knot, rather than matrix by matrix or element by element within each matrix. The pyramid structure in Fig. 19
                         illustrates how the 
                           p
                           +
                           1
                         non-zero basis functions at any value on span 
                           i
                         are built up from the 
                           0
                        th degree basis function 
                           
                              
                                 N
                              
                              
                                 i
                                 ,
                                 0
                              
                           
                         at that value. Calculation of the derivatives involves reverse traversal of the pyramid. Computing all the necessary basis function values and derivatives simultaneously in this way avoids repeated calculations of key values.

Taking the first non-zero length knot span for the cubic case in Fig. 2 as an example, there are four non-zero basis functions, namely, 
                           
                              
                                 N
                              
                              
                                 0
                                 ,
                                 3
                              
                           
                        , 
                           
                              
                                 N
                              
                              
                                 1
                                 ,
                                 3
                              
                           
                        , 
                           
                              
                                 N
                              
                              
                                 2
                                 ,
                                 3
                              
                           
                         and 
                           
                              
                                 N
                              
                              
                                 3
                                 ,
                                 3
                              
                           
                        , that will contribute to several elements of the four Gramian matrices. The grids of product combinations exhibit symmetry such that there are 
                           
                              (
                              
                                 
                                    p
                                    +
                                    1
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         unique terms to be evaluated at each knot. The ten unique values for the example case are illustrated in Fig. 20
                        . The process is repeated at each knot until the Gramian matrices have been filled. In this way the 
                           
                              (
                              p
                              +
                              1
                              )
                           
                           
                           ×
                           
                           
                              (
                              p
                              +
                              1
                              )
                           
                         grid can be thought of as a stencil or template for each knot. This idea is illustrated in Fig. 21
                        .

In order to evaluate the integrals, support must be provided for the necessary higher order basis functions. This can be achieved by appending the necessary number of extra repeated knots to the end of the knot vector. For the computation of Eqs. (22)–(25), the 
                           
                              (
                              p
                              +
                              1
                              )
                           
                        th integral is the highest order of integral required. The knot vector is therefore extended by 
                           p
                           +
                           1
                         knots to 
                           U
                           =
                           
                              {
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                              ,
                              5
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              ,
                              6
                              }
                           
                        .


                        Fig. 22
                         depicts the cubic basis functions and the related higher order basis functions of degree 4 distributed over the same knot vector. It is clear from the diagram, that over each span there are 
                           p
                           +
                           1
                         non-zero basis functions and that each basis function spans only 
                           p
                           +
                           1
                         knots. The integral of the basis function will be 0 on its incident knot.

At the knot spans of interest, where the integrals of all of the basis functions will have non-zero values, there is a maximum of 
                           p
                           +
                           1
                         non-zero higher order basis functions that can contribute to the integral samples of the 
                           p
                           +
                           1
                         cubic basis functions non-zero on the span. A sample at the terminating knot of a basis function will include 
                           p
                           +
                           1
                         higher order basis function contributions, while the knots internal to a basis function will require 1, 2, and up to 
                           p
                         contributions. The number of contributions is independent of the degree of the contributing higher order basis functions, and thus the conditions do not change with the grade of integral being calculated.

The trapezoidal bounding-box of Fig. 19 illustrates the independence of the number of contributions. While there are more than 
                           p
                           +
                           1
                         non-zero higher order basis functions on span 
                           i
                        , only a maximum of 
                           p
                           +
                           1
                         terms contribute to a given basis function integral evaluation. As the values outside the trapezoid are not needed for either the forward traversal evaluation of the basis functions or the reverse traversal evaluation of the derivatives, only the values inside the trapezoid need be calculated. Note that the extra repeated knots required for the higher order basis functions are omitted as they are simply an extension of the last 
                           p
                           +
                           1
                         knots and no basis function values over the extra zero length knot spans are required.

The basis function values and derivatives are calculated using algorithms based on those presented in  [21]. The algorithms were optimised to account for the computational savings identified in Fig. 19, i.e., only the highlighted parts of the pyramids are calculated. For computing the necessary integral samples on a given knot span, it is computationally efficient to compute the single basis function and iteratively add one basis function at a time until all necessary sums for a given span have been computed. Each of the highlighted columns in Fig. 19, and the terms therein, contribute to a summation.

Once the basis function summations have been computed, the weights must be evaluated. The generation of the weights produces an ‘
                           n
                        -ary’ tree. An example of this tree for the case of computing the necessary integrals of a single cubic basis function is depicted in Fig. 23
                        . Each level of the tree represents a level of integration while each branch represents the necessary summation of basis functions that is to be weighted and summed to produce the integral. Fig. 24
                         compactly depicts the set of trees (one exists for each grade of integral) required for computing the individual integrals and includes the relevant summation terms.

The weight-tree and thus the integrals can be generated recursively. Algorithm 1 outlines a recursive algorithm that generates the necessary weights and summations to return the integral of a specified basis function at a given parameter value. All of the integrals can be calculated simultaneously by the algorithm by including the appropriate summation at the appropriate level. For simplicity, only the most complex 
                           
                              (
                              p
                              +
                              1
                              )
                           
                        th integral is shown in the algorithm. In the algorithm, 
                           b
                           a
                           s
                           i
                           s
                           I
                           n
                           d
                           e
                           x
                         is the index of the basis function being integrated. The first integral is captured by the initial weight, 
                           s
                           t
                           a
                           r
                           t
                           W
                           e
                           i
                           g
                           h
                           t
                        , and therefore we start the recursion at 
                           g
                           r
                           a
                           d
                           e
                           I
                           n
                           d
                           e
                           x
                           =
                           2
                        , where 
                           g
                           r
                           a
                           d
                           e
                         is the grade of integration sought.


                        
                           
                              
                           
                        
                     

Although the recursive algorithm generates each unique product term required for the integral at the cost of a single multiplication for the generation of each new term, and offers an intuitive approach that gives a valuable insight to the integral problem, it is more efficient to take a more direct ‘depth-first’ approach and traverse the tree structure in reverse. By taking this approach, the distributive law can be applied so that the necessary summations can be grouped before applying the weights. Not only does this minimise the number of multiplications that are required at each level, it also means that only the very first branch of the tree need be considered as there is a large degree of repetition in the lower branches of the tree. Employing the same iterative technique for the addition of the basis functions to generate the 
                           p
                           +
                           1
                         summations needed, summations of weighted basis function sums can be evaluated. This cycle can be repeated iteratively so that only 
                           p
                           +
                           1
                         multiplications and 
                           p
                           +
                           1
                         additions are needed at each level. The process is graphically illustrated for the fourth integral required for the cubic case in Fig. 25
                        .

The integral value, 
                           
                              
                                 I
                              
                              
                                 i
                                 ,
                                 g
                                 r
                                 a
                                 d
                                 e
                              
                           
                        , where 
                           i
                         is the basis function index and 
                           g
                           r
                           a
                           d
                           e
                         is the grade of integral, is initialised with the appropriate sum term of higher order basis functions before passing through the iterative cycle of product summations, as depicted. Additional integrals can be calculated in the same fashion by starting the cycle at the appropriate level of the tree with an initial seed holding the sum corresponding higher order basis functions. An additional benefit of this approach is that all non-zero integral samples on the knot can be calculated simultaneously by simply choosing the appropriate weighting term at the last step of the algorithm 
                           w
                           
                              (
                              i
                              ,
                              1
                              )
                           
                         to 
                           w
                           
                              (
                              i
                              +
                              p
                              ,
                              1
                              )
                           
                        . The overall algorithm, calculating each integral term up to a specified maximum, is summarised in Algorithm 2. As in Algorithm 1, 
                           g
                           r
                           a
                           d
                           e
                           I
                           n
                           d
                           e
                           x
                         iterates over the necessary integrations up to a maximum of 
                           g
                           r
                           a
                           d
                           e
                        . 
                           t
                           e
                           r
                           m
                           I
                           n
                           d
                           e
                           x
                         indexes the output integral terms being calculated and determines the initial sum of basis functions needed to initiate the algorithm. 
                           
                              
                           
                        
                     

Once the integrals have been sampled at each of the knots, they must be scaled by the weight introduced by the magnitude of the step change that lead to the formation of the Dirac delta at the knot. The Dirac delta weight can be calculated by differencing the step functions on either side of the knot. The direction of the step change gives the sign of the weight. This process can be seen in Figs. 14 and 2.

The remaining terms to be evaluated at either end of the knot vector (see Eqs. (22)–(25)) are typically of 0 value for the majority of basis functions as they are most often composed of terms involving a product of a basis function integral and derivative, one of which is typically 0 at either end of the knot vector. Only the first and last 
                           p
                           +
                           1
                         basis functions need special consideration. The values can be calculated using the algorithms already described.

The analytic algorithm to compute all four Gramian matrices is summarised in Algorithm 3. As before, the Gramian matrices are labelled according to their respective derivative components as follows 
                           G
                           00
                        , 
                           G
                           11
                        , 
                           G
                           22
                        , and 
                           G
                           10
                        , while 
                           I
                           00
                         and 
                           D
                           00
                         represent the respective integrals and derivatives. The 
                           s
                           p
                           a
                           n
                           I
                           n
                           d
                           e
                           x
                         is the span on the knot vector being addressed, and finally, the 
                           b
                           a
                           s
                           i
                           s
                           I
                           n
                           d
                           e
                           x
                         indexes the non-zero basis functions on the given span.


                        
                           
                              
                           
                        
                     

Section  5 presents an analytic solution and efficient algorithm for the evaluation of the Gramian matrices that make up the stiffness matrix of an Active B-Spline Surface. This section demonstrates the generality of our approach. We show that the approach can be extended to cope with varying material properties; mass, damping and forcing matrices; and also to cope with volumes and higher dimensions.

For many applications, such as Isogeometric Analysis  [4], it is important to facilitate the evaluation of the problem where the material properties, i.e.  
                           α
                         and 
                           β
                         are varying over the domain of integration, i.e.  
                           α
                           
                              (
                              u
                              ,
                              v
                              )
                           
                        , 
                           β
                           
                              (
                              u
                              ,
                              v
                              )
                           
                        . The mathematical mechanics of the problem are essentially unchanged, however, the integration by parts formula must be extended to handle the extra term. This can be done by integrating the product rule for three terms such that 
                           
                              (34)
                              
                                 ∫
                                 u
                                 
                                    (
                                    x
                                    )
                                 
                                 v
                                 
                                    (
                                    x
                                    )
                                 
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    x
                                    )
                                 
                                 d
                                 x
                                 =
                                 u
                                 
                                    (
                                    x
                                    )
                                 
                                 v
                                 
                                    (
                                    x
                                    )
                                 
                                 w
                                 
                                    (
                                    x
                                    )
                                 
                                 −
                                 ∫
                                 u
                                 
                                    (
                                    x
                                    )
                                 
                                 w
                                 
                                    (
                                    x
                                    )
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    x
                                    )
                                 
                                 d
                                 x
                                 −
                                 ∫
                                 v
                                 
                                    (
                                    x
                                    )
                                 
                                 w
                                 
                                    (
                                    x
                                    )
                                 
                                 
                                    
                                       u
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    x
                                    )
                                 
                                 d
                                 x
                                 .
                              
                           
                         Applying this to 
                           
                              (35)
                              
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 α
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       i
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 
                                    
                                       N
                                    
                                    
                                       j
                                       ,
                                       p
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 d
                                 u
                              
                           
                         means as long as the function is either differentiable or integrable to the point of achieving the Dirac delta condition with the derivatives of either of the basis functions, an analytic solution is possible.

Active B-Spline/NURBS surfaces are used to model the response, and often the dynamics, of a surface under the influence of applied forces according to the following equation  [28].


                        
                           
                              (36)
                              
                                 M
                                 
                                    
                                       p
                                    
                                    
                                       ̈
                                    
                                 
                                 +
                                 D
                                 
                                    
                                       p
                                    
                                    
                                       ̇
                                    
                                 
                                 +
                                 K
                                 p
                                 =
                                 F
                              
                           
                         where 
                           M
                        , 
                           D
                        , and 
                           F
                         are the mass, damping and forcing matrices respectively, and are given by


                        
                           
                              
                                 (37)
                                 
                                    F
                                    =
                                    
                                       
                                          ∫
                                       
                                       
                                          σ
                                       
                                    
                                    
                                       
                                          Φ
                                       
                                       
                                          T
                                       
                                    
                                    f
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                    
                                    d
                                    u
                                    d
                                    v
                                 
                              
                              
                                 (38)
                                 
                                    M
                                    =
                                    
                                       
                                          ∫
                                       
                                       
                                          σ
                                       
                                    
                                    μ
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                    
                                    
                                       
                                          Φ
                                       
                                       
                                          T
                                       
                                    
                                    Φ
                                    
                                    d
                                    u
                                    d
                                    v
                                 
                              
                              
                                 (39)
                                 
                                    D
                                    =
                                    
                                       
                                          ∫
                                       
                                       
                                          σ
                                       
                                    
                                    γ
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                    
                                    
                                       
                                          Φ
                                       
                                       
                                          T
                                       
                                    
                                    Φ
                                    
                                    d
                                    u
                                    d
                                    v
                                    .
                                 
                              
                           
                        
                     

The forcing function that describes the external forces applied to the Active B-Spline Surface must be transformed such that the forces are mapped to the control points. This is achieved by a mapping that involves the product with the B-Spline basis functions. Thus, the forcing function can be handled in the same way as the varying material properties as outlined above. Equally, if mass and damping properties of the surface are to be considered, their distributions can be accommodated in a similar fashion  [28].

Our approach also extends to higher dimensions. As an example, take the energy of an Active B-Spline Volume  [29], typically given by 
                           
                              (40)
                              
                                 E
                                 
                                    (
                                    S
                                    
                                       (
                                       u
                                       ,
                                       v
                                       ,
                                       w
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       Ω
                                    
                                 
                                 α
                                 
                                    (
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   ∂
                                                   S
                                                
                                                
                                                   ∂
                                                   u
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   ∂
                                                   S
                                                
                                                
                                                   ∂
                                                   v
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   ∂
                                                   S
                                                
                                                
                                                   ∂
                                                   w
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 +
                                 β
                                 
                                    (
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   S
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    2
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   S
                                                
                                                
                                                   ∂
                                                   u
                                                   ∂
                                                   v
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   S
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    2
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   S
                                                
                                                
                                                   ∂
                                                   u
                                                   ∂
                                                   w
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   S
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    2
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   S
                                                
                                                
                                                   ∂
                                                   v
                                                   ∂
                                                   w
                                                
                                             
                                             |
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 d
                                 u
                                 d
                                 v
                                 d
                                 w
                                 .
                              
                           
                        
                     

It is clear that the equation is separable in the same way as the B-Spline Surface and that each parameter can be handled in the same way for the calculation of the corresponding Gramian matrices. The technique can also be generalised for higher dimensions.

Although the B-Spline representation discussed so far facilitates the modelling of a wide range of shapes, there are a number of curve and surface types that cannot be exactly represented using polynomials alone, e.g., circles, ellipses, hyperbolas, cylinders, cones, spheres etc. These conics can however be represented using rational functions of polynomials. NURBS are the rational version of B-Spline representations that facilitate the precise representation of all the conics.

A NURBS curve can be thought of as a projection onto 
                        n
                     -dimensional space of a B-Spline curve defined in 
                        
                           (
                           n
                           +
                           1
                           )
                        
                     -dimensional homogeneous co-ordinate space. The definition of a NURBS curve is much the same as that of the non-rational B-Spline curve outlined in Section  3.1. However, in the case of NURBS, the basis functions are rational such that a NURBS basis function is defined by 
                        
                           (41)
                           
                              
                                 
                                    R
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                              =
                              
                                 
                                    
                                       
                                          N
                                       
                                       
                                          i
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          n
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

Analogously to the B-Spline equations developed in Section  3.1, the basis functions for a parametric NURBS surface are defined as


                     
                        
                           (42)
                           
                              
                                 
                                    R
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                                 
                                    p
                                    ,
                                    q
                                 
                              
                              
                                 (
                                 u
                                 ,
                                 v
                                 )
                              
                              =
                              
                                 
                                    
                                       
                                          N
                                       
                                       
                                          i
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                          ,
                                          q
                                       
                                    
                                    
                                       (
                                       v
                                       )
                                    
                                    
                                       
                                          w
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          m
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          n
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          i
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                       
                                          N
                                       
                                       
                                          j
                                          ,
                                          q
                                       
                                    
                                    
                                       (
                                       v
                                       )
                                    
                                    
                                       
                                          w
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                              
                              .
                           
                        
                      Further information on NURBS can be found in [21].

Much like B-Splines, Gaussian Quadrature is typically used to integrate energy functions associated with NURBS curves and surfaces [15]. However, such schemes typically offer only approximations of the integral of rational functions as the technique can handle only polynomials exactly  [3]. As discussed in Section  2, for the non-rational case, simplifications are often made where the B-Spline is defined over a uniform knot vector. Such approximations are equally applicable to the rational case.

An analytic solution for the integral of a NURBS product is currently unavailable. However, our approach can be applied to the NURBS problem if the following approximation is made.

Over the domain of integration, the denominator of the NURBS basis functions changes slowly when compared to the polynomial numerator. It is common practice to select quadrature rules that give exact integration when the denominator is constant  [16,4,17]. In this case the NURBS integrals reduce to a weighted version of those integrals presented for B-Splines (see Eqs. (9)–(12)) and the analytic solution presented here can be employed.

@&#RESULTS@&#

This section presents a detailed analysis of the algorithms presented and a comparison of results with the Gaussian Quadrature approach outlined in Section  4.1 in terms of performance, accuracy and robustness.

This section compares the computational performance of the analytic approach against the Gaussian Quadrature approach both theoretically and practically using real results.

The Gaussian Quadrature implementation used as a benchmark in our tests was developed to handle evaluations of basis functions and derivatives on a sample by sample basis in the same fashion as outlined for the analytic approach. Discussions thus far have developed mathematical and algorithmic efficiencies without regard to programming efficiencies. A significant programming efficiency stems from the data structures used in both the Gaussian Quadrature implementation and the Analytic equivalent. These data structures are primarily symmetric in their nature and should be stored as such. This makes indexing and memory allocation efficient and also facilitates the representation of much larger data models. The algorithms presented were implemented in Java for proof of concept and all experiments were run on a Dell Inspiron 6000 Laptop with a single core centrino processor.

This section presents theoretical analysis of the computational complexity of the Analytic approach presented in the paper compared with that of Gaussian Quadrature. Unless otherwise stated, where plots are shown for varying numbers of control points, the degree is fixed for the cubic case and where the degree varies, the number of control points is fixed at 100. The figures shown are the computations required for the generation of all four Gramian matrices in each case.


                           Fig. 26
                            shows the number of samples of each basis function that must be computed per span as the degree of basis function is increased. As can be seen from the graph, using the Analytic approach, only one sample point is required per span regardless of the degree of the curve employed. As the product of two 
                              p
                            degree curves is under consideration in each case, Gaussian Quadrature requires 
                              
                                 ⌈
                                 
                                    (
                                    p
                                    +
                                    p
                                    +
                                    1
                                    )
                                 
                                 /
                                 2
                                 ⌉
                              
                            samples per span.


                           Figs. 27 and 28
                           
                            show the total number of basis function evaluations required for both Gaussian Quadrature and the Analytic approach varying over increasing number of points and increasing degree respectively. As could be expected from Fig. 26, the Analytic approach requires significantly less basis function evaluations. The relationship between the number of basis function calculations and the number of points is 
                              O
                              
                                 (
                                 p
                                 )
                              
                            or linear for both approaches as could be expected. The relationship between the number of basis function evaluations and the degree is 
                              O
                              
                                 (
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                            or quadratic for Gaussian Quadrature whereas it is 
                              O
                              
                                 (
                                 p
                                 )
                              
                            or linear for the analytic approach. This is because the calculation is based on the number of samples required per span, the number of spans per basis function and the total number of basis functions. In the Gaussian Quadrature case the first two of the terms are proportional to 
                              p
                           , while for the analytic case only the second term is proportional to 
                              p
                           .


                           Figs. 29 and 30
                           
                            show the number of basis function evaluations required for both approaches when the pyramid structure presented in Fig. 19 is used to simultaneously calculate the required basis functions and repeated derivatives for all four Gramian matrices in an ‘all-in-one’ fashion. As can be seen this approach drastically reduces the number of computations required.

This evaluation of the computational complexity does not complete the analysis however, as the comparisons do not take into account that for the analytic approach, higher order basis functions must be calculated at greater computational expense than the lower order basis functions required to satisfy the Gaussian Quadrature approach. The preceding figures showed the number of basis function evaluations needed. Figs. 31 and 32
                           
                            indicate the relative number of operations involved in these evaluations. The plots depict the number of iterations of the relevant recursions necessary for both approaches. In both cases, the relationship between the total number of operations required for the evaluations and the degree is 
                              O
                              
                                 (
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           . As can be seen from the graphs, the analytic approach still offers a much less computationally intensive solution.

For clarity, Fig. 33
                            shows the same results presented in Fig. 32 over a more practical range of degrees, 
                              
                                 [
                                 0
                                 ,
                                 5
                                 ]
                              
                           . As can be seen, the savings increase with higher degree and significant savings are achieved over the most commonly used lower degree curves.


                           Figs. 34 and 35
                           
                            show total mathematical operation counts, i.e., subtractions, additions, multiplications and divisions, for both approaches in computing all four Gramian matrices.

Finally, Fig. 36
                            shows a theoretical 3D plot depicting the relative computational complexity of the Gaussian Quadrature and Analytic approaches over both varying points and degree.

This section presents real averaged computation times as determined from the Java implementation of both the Analytic approach presented and Gaussian Quadrature. Figs. 37–39
                           
                           
                            show the average total computation time required to compute all four Gramian matrices using both the Gaussian Quadrature and Analytic approaches.

The computation times reflect the theoretical results deduced in the previous section. There is an improvement in the expected performance with respect to the increasing number of points and this is mainly down to the nature of the computations for each case. The Gaussian Quadrature approach suffers from a significant increase in the number of multiplication operations with increasing number of points which impact on its performance.


                           Fig. 40
                            shows the overall improvement in computation times with varying degree and varying number of points. The percentage improvement is effectively constant for increasing number of points. The slight variation that can be observed at the lower range of points is due to the special case conditions at the last 
                              p
                              +
                              1
                            knots at either end. Where there are very small numbers of points, these special conditions dominate the overall calculations and thus impact on the overall percentage improvement. The impact of these special cases becomes negligible for increasing numbers of points.

The percentage improvement/reduction in time can be seen to increase with increasing degree. The overall improvements range from 63% to 77% over the range of degrees presented. This means that the Analytic solution ranges from being 2.7 times faster than Gaussian Quadrature to 4.3 times faster. The practical relevance of these improvements is further discussed in Section  8.3.

This section analyses and compares the accuracy of the Gaussian Quadrature and Analytic approaches. Exact results obtained symbolically are also presented for comparison. Schumaker  [6] tests the numerical accuracy of Gaussian Quadrature against Divided Differences for the computation of the integral of a product of two B-Spline curves by testing the algorithms over an increasingly small knot span. Their experiment is adapted and extended here for examining the robustness of the proposed approach in computing all four Gramian matrices associated with the Stiffness matrix of an Active B-Spline Surface. In each experiment a knot vector is chosen that includes 
                           p
                           +
                           1
                         repeated knots at either end of an otherwise even knot spacing but for a single span that is iteratively reduced from 1 to 
                           0.1
                         to 
                           1
                           
                              
                                 0
                              
                              
                                 −
                                 r
                              
                           
                        . Results for an element of each Gramian matrix that includes a basis function supported by the span are presented for comparison.

The results are organised as follows:


                        
                           
                              •
                              
                                 Table 1
                                  shows results for 
                                    ∫
                                    
                                       
                                          N
                                       
                                       
                                          8
                                          ,
                                          3
                                       
                                    
                                    
                                       
                                          N
                                       
                                       
                                          8
                                          ,
                                          3
                                       
                                    
                                  on knot vector 
                                    U
                                    =
                                    
                                       {
                                       0
                                       ,
                                       0
                                       ,
                                       0
                                       ,
                                       0
                                       ,
                                       1
                                       ,
                                       2
                                       ,
                                       3
                                       ,
                                       4
                                       ,
                                       5
                                       ,
                                       6
                                       ,
                                       6
                                       +
                                       1
                                       
                                          
                                             0
                                          
                                          
                                             −
                                             r
                                          
                                       
                                       ,
                                       7
                                       ,
                                       8
                                       ,
                                       9
                                       ,
                                       10
                                       ,
                                       11
                                       ,
                                       12
                                       ,
                                       13
                                       ,
                                       13
                                       ,
                                       13
                                       ,
                                       13
                                       }
                                    
                                 . Similarly Tables 2–4
                                 
                                 
                                  show results for the same product for the remaining Gramian Matrices.


                                 Tables 5–8
                                 
                                 
                                 
                                  show results for a degree 4 curve.


                                 Tables 9–12
                                 
                                 
                                 
                                  show results for the degree 5 curve.


                        Fig. 41
                         depicts the percentage error introduced by the Analytic approach for the 
                           G
                           00
                         term. Note that as the scale is logarithmic, 0 values cannot be represented. Therefore the plot shows only the non-zero error. As can be seen for the cubic case the percentage error incurred ranges from 0% to 10−4% over the range of knot spacing from regular to extreme respectively. The magnitude of the error reduces with increasing degree. The figure also demonstrates the stability of the approach.


                        Fig. 42
                         depicts the percentage error introduced by the analytic approach for the 
                           G
                           00
                        , 
                           G
                           11
                        , and 
                           G
                           22
                         terms. As can be seen from the figure, the error incurred increases slightly for the terms involving the derivatives of the basis functions. For the cubic case (the case with the greatest error), the percentage error incurred by all terms is captured by the range 0%–10−4% over the range of knot spacing from regular to extreme respectively, and the magnitude of the error reduces with increasing degree.

While the Gaussian Quadrature approach exhibits some rounding errors in the least significant digit, the approach does not accumulate error as the ratios of knot spacings become more extreme. For this reason error plots are of little value and have been omitted. The error plot for the 
                           G
                           10
                         term was also omitted as while both approaches exhibit error in their significant digits, the magnitude of the exponent makes this error less consequential.

From the experiments conducted, the Gaussian Quadrature approach presented is more accurate than the Analytic Approach. The mathematical approach adopted is exact, therefore, the error is introduced by numerical problems introduced during computation as a result of the floating-point arithmetic operations. This section investigates the root cause of the error introduced.

It is well documented that the Cox–deBoor recursion (see Eq. (1)) used to calculate the basis functions for both the Gaussian Quadrature approach and the Analytic Approach is numerically stable and highly accurate [26]. The basis function and derivative algorithms employed in this paper are largely based on the algorithms presented in  [21] that are directly derived from the Cox–deBoor recursion. Piegl and Tiller  [21] do not comment on the stability or accuracy of their algorithms. As part of this research the algorithms were tested and proved, with the exception of rounding error in the least significant digit, to match symbolic results to machine precision for each of the basis function and derivative evaluations performed for the cases presented in Tables 1–12.

In Section  5, formulae and algorithms for the computation of the integral and repeated integrals are derived and developed directly from the Cox–deBoor recursion. These algorithms were tested and proven to match symbolic results to machine precision for each of the integrals required for the tests presented in Tables 1–12. Table 13
                            exemplifies the results and shows the fourth integral of the cubic curve, as required by the analytic approach, at the two extremes of the knot spacing tested, namely 
                              r
                              =
                              0
                            and 
                              r
                              =
                              10
                           . As can be seen, the results shown match those obtained symbolically to machine precision.

While the derivative and integral algorithms are more prone to round off errors than the basis function algorithm due to the higher ratios of orders of magnitudes involved in the calculations, the error incurred in each experiment did not propagate beyond the least significant digit. As each of the component algorithms employed in the computation of the Gramian matrices individually produce results accurate to machine precision, it is concluded that the assembly of the terms into the Gramian matrices results in the loss of accuracy as the knot spacing ratios become extreme.

The key component in assembling the Gramian matrices, using the Analytic approach, is the summation of integral values sampled at the knots scaled by the corresponding Dirac weight. Adopting the same testing approach as the preceding section, a knot vector of type 
                              U
                              =
                              
                                 {
                                 …
                                 5
                                 ,
                                 6
                                 ,
                                 6
                                 +
                                 1
                                 
                                    
                                       0
                                    
                                    
                                       −
                                       r
                                    
                                 
                                 ,
                                 8
                                 ,
                                 9
                                 ,
                                 …
                                 }
                              
                            is considered. Fig. 43
                            illustrates the effect of varying ratios of knot spacing on the affected values.

First the values of the Dirac weights are considered. Increasing the value of 
                              r
                            results in an anomalous knot span, whereby the ratio of its size in relation to its neighbours becomes extreme. As a result, the derivative values over the affected span become very large relative to those of neighbouring spans. The calculation of the weight associated with the Dirac delta function relies on the differencing of the 
                              p
                           th derivatives of the affected span with those of its two neighbouring spans. The large derivative introduced by the anomalous knot dominates the difference in both cases as 
                              r
                            increases in value. This results in the Dirac weights at either side of the span being very large and very similar in magnitude. Fig. 43 shows the absolute value of the Dirac weights at the knots left and right of the affected span for curves of degrees 3, 6, and 10. The figure shows the increase in magnitude of the Dirac weight with decreasing knot spacing. More importantly, the figure also shows that the magnitudes, as dominated by the same anomalous knot span, are all but indistinguishable. Note that the direction and thus the sign of the Dirac delta alternates from one side to the other, however the absolute value is shown here to illustrate the similarity in magnitudes.

The magnitudes of the integral values over the anomalous knot span, as shown in Fig. 43, decrease rapidly as the knot spacing decreases. This is especially the case for the higher order curves whose area is spread out over an increased number of spans. A result of this is that the integral values at the knots on either side of the anomalous span become more and more similar.

Finally, the products of the Dirac weight and integral values at the knots are presented in Fig. 43. As it is the case for both the integrals and Dirac weights, that their magnitudes are similar at either side of the anomalous knot, so too are their products. More importantly, the Dirac weights at either side are opposite in sign. To compute the overall term for the Gramian matrices, the values must be summed. Because the magnitudes of the product values on either side of the affected knot span are so similar, the resulting difference between them leads to a cancellation of significant digits. This gives consequence to the otherwise insignificant roundoff errors stored in the least significant digits of the product. To exacerbate the problem, as the magnitude of the Dirac weights is so large relative to those at the neighbouring knots, the least significant digits of the products at either side of the affected span can be of similar order to the most significant digits of the products at the neighbouring knots. This means that the overall contribution of these error-prone digits to the overall answer grows in size with decreasing knot span.

Fortunately, the integral values are so small over the affected span, they act to offset the significance of the error incurred. Fig. 43 shows how the integral values decrease with decreasing knot spacing. It is also evident from the graph that the integral values decrease rapidly with increasing order of curve, further offsetting the impact of the inaccuracy.

To further illustrate the problem, Table 14
                            shows the relevant numerical values. The problematic values are highlighted. It is clear from the table that for the degree 10 curve, the integral is so small that it offsets the values of the derivatives to such an extent that the erroneous values produced by the differencing of similar terms are reduced to insignificance in the final answer.

While the Gaussian Quadrature approach suffers from the same numerical rounding and precision errors associated with floating-point arithmetic, the error is not as prevalent. This is because the approach does not incur the differencing effect described above as a result of the anomalous knot. For the Gaussian Quadrature approach the summations include several values over a span that are of the same sign and similar orders of magnitude, and as such they do not give consequence to erroneous data present in digits of lower significance.

An excellent resource on the difficulties that can be incurred when dealing with floating-point arithmetic can be found in [30].

@&#DISCUSSION@&#

The Analytic approach presented in this paper is more than 3 times faster than the Gaussian Quadrature approach for the most practical cases discussed and achieves very high levels of accuracy. Additionally, both the accuracy and performance times improve with increasing degree.

While Gaussian Quadrature is more accurate than the Analytic approach presented, for equally spaced knots, it can be seen that the Analytic approach performs to the same degree of precision as Gaussian Quadrature up to 15 significant digits. For reasonably spaced knots, the approach continues to perform very well and provides accuracy up to 8 decimal places for even the most extreme case considered. Additionally, the accuracy of the approach improves with increasing degree and as demonstrated in the previous section, for a degree 10 curve the error is all but eliminated.

It is important to note that the numerical differencing problem described above only becomes an issue where a very small knot spacing occurs between two larger ones such that the derivative over the anomalous knot span dominates the associated difference terms on both sides. In practice, cases typically involve cubic curves with reasonably regular knot vectors. Where anomalous knots do occur, they are typically in the form of repeated knots to manipulate curve continuity, or several knots are drawn closer together to achieve directional effects in a curve.

Equally, it is important to note that while the error of the Analytic approach is all but removed for curves of high degree, in practice, cubic curves are the most commonly used curves. Higher order curves (degree 5 or greater) are used in industry for the design of highly smooth aesthetic surfaces such as those used for car body design, but cubic curves are the most prevalent for general design purposes. Autodesk’s Maya supports curves up to degree 7 [31] but notes that the inclusion of the higher degrees is predominantly to facilitate data exchange with other CAD packages.

Tolerance levels in industry are typically of the order of 0.0001 mm–1 mm and as models are typically composed of multiple patches, the error incurred using the Analytic approach would typically fall well inside these tolerances. Where greater accuracy is required for the most extreme cases, there are several numerical techniques for handling summations and differences that can reduce the impact of numerical error [5,30]. Such techniques range from those of relatively small additional computational expense, e.g., normalisation to those of significant expense, e.g., higher precision data. There are various number formats available in the different programming languages that can accommodate higher precision. However, use of such techniques may impact on the speed of the computations. There are also several algorithms that act to actively compensate for numerical error as it is introduced, e.g., the Kahan Summation Algorithm  [32].

In Section  4.1, it was noted that recent research by Hughes et al.  [4] has presented reduced quadrature rules for Gaussian Quadrature that take advantage of a-priori knowledge of the continuity of a B-Spline/NURBS curve across each knot. The impact of the approach improves with increasing numbers of control points. For the cases presented in this paper, for the best case scenario using the reduced quadrature rules, as the number of points tends towards infinity the number of sample points required tends asymptotically towards half those required using the standard Gaussian Quadrature approach presented in this paper. It is likely that this approach will replace existing Gaussian Quadrature rules as the state of the art Gaussian Quadrature approach in time. However, the Analytic approach presented in this paper still outperforms the approach of Hughes et al.  [4] on computational complexity. Additionally, no assumptions are made about the continuity of the Active Surface in the proposed Analytic approach.

@&#CONCLUSIONS@&#

This paper presents a novel direct Analytic approach, and accompanying algorithm to address the problem of efficiently computing the stiffness matrix associated with an Active B-Spline/NURBS Surface. The proposed approach is shown by experiment to significantly outperform the Gaussian Quadrature approach in terms of computational efficiency, while preserving high levels of accuracy and stability. Additionally, unlike existing approaches, no assumptions about the regularity of the Active Surface are made in order to achieve the computational savings. The approach is shown to generalise to the problems of computing mass, damping, and forcing matrices. It is also demonstrated that the approach can cope with variable mass, damping, and stiffness coefficients. Further to this, an extension to the important case of NURBS is presented and while a direct analytic solution is unavailable for NURBS, it is demonstrated how the Analytic approach for a non-rational B-Spline can be modified to approximate a solution.

As part of the development of the Analytic approach, theory relating to the integral and repeated integral of a B-Spline basis function is derived, and efficient algorithms for computing such integrals are developed and shown to be highly accurate and stable. An important special case relating to the repeated differentiation of a B-Spline basis function is identified and algorithms for dealing with the special case are provided.

While the Analytic algorithm does not perform as accurately as Gaussian Quadrature in extreme cases, due to the propagation of floating-point errors, the algorithm is shown to achieve very high levels of accuracy up to and beyond most practical cases. Additionally, for interactive CAD prototyping or virtual sculpting applications, compromises on accuracy are often made in practice to achieve acceptable levels of interaction. An analysis of the small numerical error incurred by the Analytic approach identifies the root cause of the error and suggestions are offered as to ways of achieving greater accuracy.

Overall, the experiments show that the proposed Analytic approach presented in this paper offers computational savings from 63% to 77%, making the algorithm up to 4.3 times faster for the cases presented, while achieving accuracy to within 0%–10−4% from regular to extreme cases of knot spacing respectively.

@&#REFERENCES@&#

