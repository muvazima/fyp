@&#MAIN-TITLE@&#A new level set method for inhomogeneous image segmentation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We constructed a new region-based pressure force (RBPF) function.


                        
                        
                           
                           We proposed a novel level set based model for inhomogeneous image segmentation.


                        
                        
                           
                           We combine the local and global intensity information adaptively.


                        
                        
                           
                           The local image information can significantly increase image contrast.


                        
                        
                           
                           We apply a fast and simple level set method to implement the curve evolution.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Level set method

Inhomogeneous image segmentation

Local image information

Global image information

@&#ABSTRACT@&#


               
               
                  Intensity inhomogeneity often appears in medical images, such as X-ray tomography and magnetic resonance (MR) images, due to technical limitations or artifacts introduced by the object being imaged. It is difficult to segment such images by traditional level set based segmentation models. In this paper, we propose a new level set method integrating local and global intensity information adaptively to segment inhomogeneous images. The local image information is associated with the intensity difference between the average of local intensity distribution and the original image, which can significantly increase the contrast between foreground and background. Thus, the images with intensity inhomogeneity can be efficiently segmented. What is more, to avoid the re-initialization of the level set function and shorten the computational time, a simple and fast level set evolution formulation is used in the numerical implementation. Experimental results on synthetic images as well as real medical images are shown in the paper to demonstrate the efficiency and robustness of the proposed method.
               
            

@&#INTRODUCTION@&#

Image segmentation is a fundamental problem in both image processing and computer vision. The objective is to partition an image into several subregions with homogeneous properties (color, texture, etc.) which will hopefully correspond to objects to be segmented. The challenging aspect of this problem is how to design effective methods for identifying such properties.

Up to now, a wide variety of algorithms have been proposed to solve image segmentation problems. The best known and most influential approaches are active contour models. They basically fall into three categories: edge-based, region-based and hybrid active contour models. The edge-based active contour models mainly use the edge information such as image gradient to stop the contour evolution. For example, geodesic active contour (GAC) [1], developed from snakes model [2], identifies objects by a gradient based edge detector function. However, the defects of the gradient based active contours are that they are not only very sensitive to noise but also difficult to detect weak edges. Moreover, the segmentation results are heavily dependent on the location of the initial curve. Instead of the gradient information, the region-based models utilize the image statistical information to detect objects. They basically overcome the disadvantages of edge-based active contour models. They are insensitive to noise and can satisfactorily segment the objects with weak boundaries. One of the most popular region based active contour models is active contours without edges (ACWE) model/C-V model proposed by Chan and Vese [3], which is the piecewise constant case of the famous Mumford–Shah (MS) segmentation model [4]. It is based on the assumption that the intensity within each subregion is homogenous or roughly constant. So it is only effective for piecewise constant images. MS model has wider applications because it assumes that images are piecewise smooth separately in the areas of objects and backgrounds. However, it is difficult to apply the gradient descent method to solve this model because of the non-differentiability with respect to the image boundary. Later, Ambrosi and Tortorelli (AT) [5] proposed an elliptic approximation method to easily solve this problem. It is worth mentioning the AT-L1 model [6], a modified version of the elliptic approximated MS model. It utilizes L1 norm as the data fidelity and TV norm as the regularization, hence, preserves the sharp discontinuities of images. Unfortunately, all of them have limited ability to segment complex images such as images with intensity inhomogeneity, which is just the objective of our study in this paper. As a matter of fact, intensity inhomogeneity is a common phenomenon in medical images. Recently, hybrid methods have been widely used in segmenting complex images, and one can refer to the literature [7–12]. They may combine the edge and region information or the local and global information according to specific segmentation tasks. In this paper, we shall make use of the hybrid idea combining the local and global information to segment inhomogeneous images.

According to our knowledge, there are two main approaches to segment images with intensity inhomogeneity. The first one is the bias correction based methods. The basic assumption of such methods is that the intensity inhomogeneity is resulted from a slowly varying field known as the bias field. Actually, the existence of bias field can cause serious misclassifications when intensity-based segmentation algorithms are used. So bias correction or removing the bias field is the main train of thought for this method. Bias correction has been extensively studied in the past two decades [13–20]. Among these methods, segmentation based methods [13,14,16–20] are more attractive, as they unify segmentation and bias correction within a single framework, and the segmentation and bias correction can benefit from each other to improve themselves. For instance, in [18–20], based on the observations that intensities in a relatively small local region are separable and the bias field is smooth across the whole image domain, the authors proposed a variational framework for joint intensity-based segmentation and bias correction. By their method, the segmentation accuracy is improved by the estimated bias field and the bias field is better estimated by forcing the intensity to be constant in the segmented subregion. What is more, the bias field is intrinsically ensured to be smooth by the convolution with a truncated Gaussian kernel without any other additional operations. The second approach we want to mention is directly related with the use of local intensity information [8–12,21]. In [21], Li et al. proposed an efficient region-based level set method to segment inhomogeneous images by introducing a local binary fitting (LBF) energy with a kernel function. It uses the intensity of the current pixel to approximate those of its neighboring pixels. The LBF model has attracted extensive attentions for its good segmentation performance. However, it usually needs to do four convolution operations at each iteration, which greatly increases the computational complexity. In addition, it is also sensitive to the selection of governing parameters and the initialization. Recently, some hybrid models combining the local and global intensity fitting energies were proposed [8–12] to improve the performance of the LBF model. In [8,9], the authors defined an energy functional (LGIF model) with a local intensity fitting term used in LBF model and an auxiliary global intensity fitting term used in C-V model. By combining the local and global intensity information, the LGIF model can avoid trapping into a local minimum. But the segmentation result is still slightly dependent on the location of the initial contour, because the weight between the local term and the global term is a fixed positive constant. Later, Yu et al. [10] gave a method to dynamically adjust the weight of the auxiliary global fitting term by using local contrast of the image, which reduced the dependence on the initial contour.

Next we will introduce two main works which motivate our method. The first one is a hybrid level set method, proposed by Wang et al. [11,12], involving the global and local intensity information. Their energy functional in the variational level set framework is described as follows
                        
                           (1)
                           
                              
                                 E
                                 
                                    
                                       c
                                       1
                                    
                                    
                                       c
                                       2
                                    
                                    
                                       m
                                       1
                                    
                                    
                                       m
                                       2
                                    
                                    ϕ
                                 
                                 =
                                 α
                                 
                                    E
                                    G
                                 
                                 
                                    
                                       c
                                       1
                                    
                                    
                                       c
                                       2
                                    
                                    ϕ
                                 
                                 +
                                 β
                                 
                                    E
                                    L
                                 
                                 
                                    
                                       m
                                       1
                                    
                                    
                                       m
                                       2
                                    
                                    ϕ
                                 
                                 +
                                 
                                    E
                                    R
                                 
                                 
                                    ϕ
                                 
                                 ,
                              
                           
                        
                     where ϕ is a level set function, and α and β are two fixed positive constants. The global energy E
                     
                        G
                     , the local energy E
                     
                        L
                      and the regularization term E
                     
                        R
                      in Eq. (1) are respectively defined by
                        
                           (2)
                           
                              
                                 
                                    E
                                    G
                                 
                                 
                                    
                                       c
                                       1
                                    
                                    
                                       c
                                       2
                                    
                                    ϕ
                                 
                                 =
                                 
                                    
                                       ∫
                                       Ω
                                    
                                 
                                 
                                    
                                       
                                          I
                                          
                                             x
                                          
                                          −
                                          
                                             c
                                             1
                                          
                                       
                                    
                                    2
                                 
                                 H
                                 
                                    
                                       ϕ
                                       
                                          x
                                       
                                    
                                 
                                 d
                                 x
                                 +
                                 
                                    
                                       ∫
                                       Ω
                                    
                                 
                                 
                                    
                                       
                                          I
                                          
                                             x
                                          
                                          −
                                          
                                             c
                                             2
                                          
                                       
                                    
                                    2
                                 
                                 (
                                 1
                                 −
                                 H
                                 
                                    
                                       ϕ
                                       
                                          x
                                       
                                    
                                 
                                 d
                                 x
                                 ,
                              
                           
                        
                     
                     
                        
                           (3)
                           
                              
                                 
                                    
                                       
                                          E
                                          L
                                       
                                       
                                          
                                             m
                                             1
                                          
                                          
                                             m
                                             2
                                          
                                          ϕ
                                       
                                       =
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            G
                                                            k
                                                         
                                                         ∗
                                                         I
                                                         
                                                            x
                                                         
                                                         −
                                                         I
                                                         
                                                            x
                                                         
                                                         −
                                                         
                                                            m
                                                            1
                                                         
                                                      
                                                   
                                                   2
                                                
                                                H
                                                
                                                   
                                                      ϕ
                                                      
                                                         x
                                                      
                                                   
                                                
                                                d
                                                x
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       +
                                       
                                          
                                             ∫
                                             Ω
                                          
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                   k
                                                
                                                ∗
                                                I
                                                
                                                   x
                                                
                                                −
                                                I
                                                
                                                   x
                                                
                                                −
                                                
                                                   m
                                                   2
                                                
                                             
                                          
                                          2
                                       
                                       
                                          
                                             1
                                             −
                                             H
                                             (
                                             ϕ
                                             
                                                x
                                             
                                          
                                       
                                       d
                                       x
                                       ,
                                    
                                 
                              
                           
                        
                     and
                        
                           (4)
                           
                              
                                 
                                    E
                                    R
                                 
                                 
                                    ϕ
                                 
                                 =
                                 γ
                                 
                                    
                                       ∫
                                       Ω
                                    
                                 
                                 
                                 
                                    
                                       ∇
                                       H
                                       
                                          ϕ
                                       
                                    
                                 
                                 d
                                 x
                                 +
                                 
                                    δ
                                    2
                                 
                                 
                                    
                                       ∫
                                       Ω
                                    
                                 
                                 
                                 
                                    
                                       
                                          
                                             
                                                ∇
                                                ϕ
                                             
                                          
                                          −
                                          1
                                       
                                    
                                    2
                                 
                                 d
                                 x
                                 .
                              
                           
                        
                     Here I denotes the image to be segmented, Ω represents the image domain and G
                     
                        k
                      is an averaging convolution operator. The global term E
                     
                        G
                      is exactly the region term in C-V model. The regularization term E
                     
                        R
                      can force the contour to be smooth and the level set function to be close to a signed distance function. It is worth noticing that the local term E
                     
                        L
                      is designed by finding the best constant approximation of the difference between the averaging filtered image G
                     
                        k
                     
                     ∗
                     I(x) and the original image I inside and outside of the contour. By subtracting the original image from the local average image, the contrast of the resulted image will be enhanced and the intensity inhomogeneity will be lightened (see the Experimental results section), which are indeed favorable to segment inhomogeneous images. In our paper, we shall use the intensity difference between averaging filtered image and original image to construct our local region term. Actually, in [22], the authors also employed a normalized convolution but different from the averaging convolution in [11,12] to quickly compute localized statistics. The distance between the image intensity and the local Gaussian averaging inside each subregion was minimized, which yielded results similar to piecewise smooth segmentation.

The other related work is proposed by Zhang et al. [7]. In their work, they presented a region-based pressure force (RBPF) function, i.e.,
                        
                           (5)
                           
                              
                                 E
                                 
                                    ϕ
                                 
                                 =
                                 −
                                 
                                    
                                       ∫
                                       Ω
                                    
                                 
                                 
                                 H
                                 
                                    ϕ
                                 
                                 
                                    
                                       I
                                       
                                          x
                                       
                                       −
                                       μ
                                    
                                 
                                 d
                                 x
                                 ,
                              
                           
                        
                     where μ is a predefined parameter indicating the lower bound of the gray-levels of the target object. Thus, minimizing this term can encourage the contour to enclose the regions with gray-levels greater than μ, which just corresponds to the object. Furthermore, from the corresponding curve evolution equation
                        
                           (6)
                           
                              
                                 
                                    
                                       ∂
                                       C
                                    
                                    
                                       ∂
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       I
                                       −
                                       μ
                                    
                                 
                                 
                                    N
                                    →
                                 
                                 ,
                              
                           
                        
                     where 
                        
                           N
                           →
                        
                      is the outward unit normal vector of the curve, we can see that it is able to control the correct direction of curve evolution when the target object has higher gray-levels than the background. Inside the target object, I
                     −
                     μ
                     >0, the region force can make the curve expand for the parts inside the target object; on the other hand, inside the background, I
                     −
                     μ
                     <0, the region force can make the curve contract for parts outside the target object. As a result, the curve finally reaches the boundary of the object. However, this method is only suitable for use in the case that the intensities inside and outside the object are homogeneous and the foreground is brighter than the background. To be able to segment other more images, we shall generalize this idea so that our model is effective not only for the case they considered but also for the case that the background is brighter than the foreground. Most important of all, the proposed method will have ability to deal with inhomogeneous images.

The main contributions of this paper are as follows. In this work, we construct a new RBPF function without estimating the lower bound of the gray-levels of targets. We only need to compute the mean values of intensities inside and outside of the contour, which are very easy to obtain. The new RBPF function will force the parts of the curve inside the target object to move outwards and the parts of outside to move inwards regardless of the brightness of object and background. Furthermore, the new constructed function can be also applied to the above mentioned difference image so that it can greatly help segment inhomogeneous images. The whole energy of the proposed active contour model consists of three parts: a global term, a local term and a regularization term. The global term and the local term are designed by the new constructed RBPF function, and the integral domains of the two terms are only associated with the inside region of the curve, which will simplify the computation without loss of good performance. The regularization term aims at smoothing the active contour. Also, we give an adaptive weight to adjust the actions of the global term and the local term automatically. When the curve is located in inhomogeneous regions, the local term dominates the whole energy; and when the curve is located in homogeneous regions, the global term dominates the whole energy. So the adaptive weight will make the segmentation results be less dependent on the location of the initial contour.

Besides, in this paper, we adopt a simple level set method, which only requires computing a Gaussian convolution after each iteration as used in [23–26], to implement the proposed hybrid active contour model. Following the literature [25], we call it Binary and Gaussian Filtering Regularized Level Set (BGFRLS) method. In fact, the intrinsic idea of the active contour is to iteratively evolve an initial curve towards the boundaries of target objects driven by the combination of internal forces determined by the geometry of the evolving curve and the external forces induced from the image. Consequently, all of the active contour models will finally need to solve a curve evolution problem. In recent years, the level set methods have become extremely popular in image segmentation especially in solving active contour models, because it is very easy to handle interface evolution, or the deformation of a contour, and we may refer to the literature [3,27–34]. But whether the traditional level set method [29] or the variational level set method [31] requires the level set function to be a signed distance function, which means the level set function must be re-initialized during iterations. To avoid re-initialization, Li et al. [34] proposed a variational level set formulation with a penalty term like the second term in Eq. (4) that automatically forces the level set function to be close to a signed distance function. This method has been successfully applied in many variational active contour models. Unfortunately, it still requires solving a nonlinear partial differential equation (PDE), in which the nonlinearity is mainly caused by the mean curvature of the level set function. Due to the CFL condition that the time step △
                     t should be proportional to the regularization parameter, we have to choose a small time step for obtaining an accurate result. Moreover, the penalization parameter δ of the penalty term must satisfy δ
                     △
                     t
                     <0.25 for stability. Therefore, for preventing the numerical instability, the time step also should not be too large, which leads to many iterative steps to reach the steady state. Thus, the computational speed will be relatively slow. The BGFRLS method approximately solves the mean curvature motion by alternating the Gaussian convolution with the thresholding, and avoids the calculation of the signed distance function or the complicated procedure of the re-initialization, so it saves much computational time. In addition, by using the BGFRLS method, the evolution equation of the level set function becomes linear, which is easier for implementation in practice.

The rest of this paper is organized as follows. In Section 2, we propose our new hybrid model and interpret the function of this model. The level set formulation and the specific algorithm corresponding to our model are introduced in Section 3. In Section 4, numerical experiments are given to show the effectiveness of the proposed model and high speed of computation. Finally, a brief conclusion is presented in the last section.

Before introducing our model, we first give some conventions about the level set function. Let 
                        C
                      denote an active contour which partitions an image domain Ω into different parts, and the zero level set function ϕ is used to represent the active contour, i.e., 
                        
                           C
                           =
                           
                              
                                 x
                                 ∈
                                 Ω
                                 |
                                 ϕ
                                 
                                    x
                                 
                                 =
                                 0
                              
                           
                        
                     . The inside and outside of the active contour are represented by Ω
                     1
                     ={x
                     ∈
                     Ω|ϕ(x)>0} and Ω
                     2
                     ={x
                     ∈
                     Ω|ϕ(x)<0}. The direction of the curve normal 
                        
                           N
                           →
                        
                      is defined to point outward the curve. Then using the defined level set function, the outward unit normal can be rewritten as
                        
                           
                              
                                 
                                    N
                                    →
                                 
                                 =
                                 −
                                 
                                    
                                       ∇
                                       ϕ
                                    
                                    
                                       
                                          ∇
                                          ϕ
                                       
                                    
                                 
                                 .
                              
                           
                        
                     
                  

Similar to [11,12], our proposed functional to be minimized is also composed of a global term, a local term and a regularization term. But the global and local terms are integrated by an adaptive weight so that they play different roles in different regions.

We first introduce the global term of the whole energy, i.e., the new RBPF function, aiming at partitioning piecewise constant images into different regions. The proposed global functional to be minimized is defined as
                           
                              (7)
                              
                                 
                                    
                                       E
                                       g
                                    
                                    
                                       C
                                    
                                    =
                                    −
                                    
                                       
                                          ∫
                                          
                                             Ω
                                             1
                                          
                                       
                                    
                                    
                                    
                                       
                                          I
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      c
                                                      1
                                                   
                                                   +
                                                   
                                                      c
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             c
                                             1
                                          
                                          −
                                          
                                             c
                                             2
                                          
                                       
                                    
                                    d
                                    x
                                    ,
                                 
                              
                           
                        where I is the image to be segmented that is supposed to be piecewise constant, c
                        1 and c
                        2 are the mean values of the intensities inside and outside of the active contour 
                           C
                        .

It can be seen that this term encourages the contour to enclose the region with gray-level greater than 
                           
                              
                                 
                                    
                                       c
                                       1
                                    
                                    +
                                    
                                       c
                                       2
                                    
                                 
                                 2
                              
                           
                         if the value of c
                        1 is bigger than that of c
                        2, and enclose the region with gray-level smaller than 
                           
                              
                                 
                                    
                                       c
                                       1
                                    
                                    +
                                    
                                       c
                                       2
                                    
                                 
                                 2
                              
                           
                         if the value of c
                        1 is smaller than that of c
                        2. That is to say, if c
                        1
                        >
                        c
                        2, minimizing this term forces the intensities inside the curve to approximate to c
                        1 because of the inequality 
                           
                              
                                 c
                                 2
                              
                              <
                              
                                 
                                    
                                       
                                          c
                                          1
                                       
                                       +
                                       
                                          c
                                          2
                                       
                                    
                                    2
                                 
                              
                              <
                              
                                 c
                                 1
                              
                           
                        . Otherwise, if c
                        1
                        <
                        c
                        2, then minimizing this term also forces the intensities inside the curve to approximate to c
                        1 since 
                           
                              
                                 c
                                 1
                              
                              <
                              
                                 
                                    
                                       
                                          c
                                          1
                                       
                                       +
                                       
                                          c
                                          2
                                       
                                    
                                    2
                                 
                              
                              <
                              
                                 c
                                 2
                              
                           
                        . Consequently, the curve can enclose the region with intensity value of c
                        1. More precisely, if the intensity of the object is c
                        1, then the curve will enclose the object; and if the intensity of the background is c
                        1, then the curve will enclose the background. The function of this term is similar to that of C-V model, i.e., approximating intensities of the region inside the active contour to its average intensity. However, our proposed model only considers the inside of the curve but not the outside, which is easier to implement. Moreover, in this term, the denominator c
                        1
                        −
                        c
                        2 is not only for determining the sign but also for normalization so that the local term (defined later) and the global term do not have great difference in values. It is worth noting that the denominator c
                        1
                        −
                        c
                        2 can not be zero. Once it is zero, we assume the region force is zero and the curve will contract only by the internal forces induced from the regularization term until c
                        1 and c
                        2 are not equal again. Besides, if in the whole image domain c
                        1
                        =
                        c
                        2, then the curve will contract until it vanishes. It is reasonable, because when c
                        1
                        =
                        c
                        2 in that case, the regions inside and outside of the contour are the same one.

The level set method is an effective way to handle contour deformation. It can easily deal with topological changes such as merging, splitting and forming sharp corners. In addition, effective and efficient numerical schemes can be implemented on fixed regular grids. Using the variational level set method, we obtain the new energy about the level set function ϕ
                        
                           
                              (8)
                              
                                 
                                    
                                       E
                                       g
                                    
                                    
                                       ϕ
                                    
                                    =
                                    −
                                    
                                       
                                          ∫
                                          Ω
                                       
                                    
                                    
                                    
                                       
                                          I
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      c
                                                      1
                                                   
                                                   +
                                                   
                                                      c
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             c
                                             1
                                          
                                          −
                                          
                                             c
                                             2
                                          
                                       
                                    
                                    H
                                    
                                       ϕ
                                    
                                    d
                                    x
                                    ,
                                 
                              
                           
                        where H(ϕ) is a Heaviside function
                           
                              
                                 
                                    H
                                    
                                       ϕ
                                    
                                    =
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                if
                                                
                                                ϕ
                                                >
                                                0
                                                ,
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                otherwise
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Minimizing the energy (Eq. (8)) with respect to the level set function ϕ, we get the gradient descent flow
                           
                              (9)
                              
                                 
                                    
                                       
                                          ∂
                                          ϕ
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    =
                                    
                                       
                                          I
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      c
                                                      1
                                                   
                                                   +
                                                   
                                                      c
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             c
                                             1
                                          
                                          −
                                          
                                             c
                                             2
                                          
                                       
                                    
                                    δ
                                    
                                       ϕ
                                    
                                    ,
                                 
                              
                           
                        where δ(ϕ)=
                        H′(ϕ). In fact, δ(ϕ) can be replaced by |∇
                        ϕ| [35], then the steady state of the above evolution is equivalent to the steady state of the following evolution equation
                           
                              (10)
                              
                                 
                                    
                                       
                                          ∂
                                          ϕ
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    =
                                    
                                       
                                          I
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      c
                                                      1
                                                   
                                                   +
                                                   
                                                      c
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             c
                                             1
                                          
                                          −
                                          
                                             c
                                             2
                                          
                                       
                                    
                                    
                                       
                                          ∇
                                          ϕ
                                       
                                    
                                    ,
                                 
                              
                           
                        which means that the evolution of the curve follows the equation
                           
                              (11)
                              
                                 
                                    
                                       
                                          ∂
                                          C
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    =
                                    
                                       
                                          I
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      c
                                                      1
                                                   
                                                   +
                                                   
                                                      c
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             c
                                             1
                                          
                                          −
                                          
                                             c
                                             2
                                          
                                       
                                    
                                    
                                       N
                                       →
                                    
                                    ,
                                 
                              
                           
                        because the PDE in the form of 
                           
                              
                                 C
                                 t
                              
                              =
                              F
                              
                                 N
                                 →
                              
                           
                         describes the same curve evolution as ϕ
                        
                           t
                        
                        =
                        F|∇
                        ϕ| [29]. Here 
                           
                              N
                              →
                           
                         is the outward unit normal of the curve 
                           C
                        . We suppose that the object has the mean value of c
                        1 (>
                        c
                        2). Then, as illustrated in Fig. 1
                        , Eq. (11) describes an expansion movement for the parts of the curve inside the target object and a contraction movement for the parts outside. In other words, it is able to control the direction of curve evolution and is a new pressure force. Thus it can finally find the accurate location of the target object for piecewise constant images. But it is not good for inhomogeneous images.

To be able to segment images with inhomogeneous intensity, the local intensity information will be very useful, because the local image regions are more likely to have approximately homogeneous intensity. The smaller the local region is, the more homogeneous the intensities are. Based on this observation and the idea of the works [11,12], we employ the information of the averaging filtered image G
                        
                           k
                        
                        ∗
                        I. Here G
                        
                           k
                         is an averaging convolution operator with k
                        ×
                        k size window. The intensity of the filtered image at each pixel is the local average of the original image in its k
                        ×
                        k size window. It makes the original image blurred and approximately estimates the varying intensity field that causes the intensity inhomogeneity. Let I
                        0 denote the difference between the filtered image and the original image, i.e., I
                        0
                        =
                        G
                        
                           k
                        
                        ∗
                        I
                        −
                        I. By subtracting the original image from the averaging filtered image, the contrast between foreground intensities and background intensities can be significantly enhanced, and the intensity inhomogeneity can be lightened in the region far away from the edges (see the Experimental results section), which is favorable to detect the true boundaries of the object because the intensity inhomogeneity mainly influences the non-edge pixels.

Following the idea of our global term and using the difference image I
                        0, the proposed local functional to be minimized is given by
                           
                              (12)
                              
                                 
                                    
                                       E
                                       l
                                    
                                    
                                       C
                                    
                                    =
                                    −
                                    
                                       
                                          ∫
                                          
                                             Ω
                                             1
                                          
                                       
                                    
                                    
                                    
                                       
                                          
                                             I
                                             0
                                          
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      m
                                                      1
                                                   
                                                   +
                                                   
                                                      m
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             m
                                             1
                                          
                                          −
                                          
                                             m
                                             2
                                          
                                       
                                    
                                    d
                                    x
                                    ,
                                 
                              
                           
                        where m
                        1 and m
                        2 are the mean values of the intensities of the difference image I
                        0 inside and outside of the active contour 
                           C
                        , respectively. Note that in the above functional, we suppose that m
                        1
                        −
                        m
                        2 is not zero. Otherwise, we handle it similarly to the global term, i.e., the local region force is assumed to be zero.

With the same derivation as in the Section 2.1, we get the evolution equation of the level set function
                           
                              (13)
                              
                                 
                                    
                                       
                                          ∂
                                          ϕ
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    =
                                    
                                       
                                          
                                             I
                                             0
                                          
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      m
                                                      1
                                                   
                                                   +
                                                   
                                                      m
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             m
                                             1
                                          
                                          −
                                          
                                             m
                                             2
                                          
                                       
                                    
                                    
                                       
                                          ∇
                                          ϕ
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Since the contrast between foreground and background has been enhanced and the intensities far away from edges are more homogeneous in the difference image, Eq. (13) has the ability to handle inhomogeneous images.

However, it should be noted that the size of the averaging convolution operator k will affect the function of the local term. To alleviate the sensitivity to noise and increase the contrast, the neighborhood size should be selected at a larger scale. But at a larger size, the difference image may contain some detailed information that is redundant for the accurate segmentation. So except for choosing an appropriate scale for the image to be segmented, we need to combine the global term to solve this problem.

To strengthen their respective functions of the proposed global and local terms, we integrate them into the following energy
                           
                              (14)
                              
                                 
                                    
                                       
                                          E
                                          
                                             C
                                          
                                          =
                                          w
                                          
                                             x
                                          
                                          
                                             E
                                             g
                                          
                                          
                                             C
                                          
                                          +
                                          
                                             
                                                1
                                                −
                                                w
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             E
                                             l
                                          
                                          
                                             C
                                          
                                          +
                                          λLength
                                          
                                             C
                                          
                                       
                                    
                                    
                                       
                                          =
                                          −
                                          
                                             
                                                ∫
                                                
                                                   Ω
                                                   1
                                                
                                             
                                          
                                          
                                          w
                                          
                                             x
                                          
                                          
                                             
                                                I
                                                
                                                   x
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            c
                                                            1
                                                         
                                                         +
                                                         
                                                            c
                                                            2
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   c
                                                   1
                                                
                                                −
                                                
                                                   c
                                                   2
                                                
                                             
                                          
                                          d
                                          x
                                          −
                                          
                                             
                                                ∫
                                                
                                                   Ω
                                                   1
                                                
                                             
                                          
                                          
                                          
                                             
                                                1
                                                −
                                                w
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             
                                                
                                                   I
                                                   0
                                                
                                                
                                                   x
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            m
                                                            1
                                                         
                                                         +
                                                         
                                                            m
                                                            2
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   m
                                                   1
                                                
                                                −
                                                
                                                   m
                                                   2
                                                
                                             
                                          
                                          d
                                          x
                                       
                                    
                                    
                                       
                                          +
                                          λ
                                          
                                             
                                                ∫
                                                C
                                             
                                          
                                          
                                          ds
                                          ,
                                       
                                    
                                 
                              
                           
                        where λ
                        >0 is a constant weight, and w(x) is a weighted function that automatically determines which region term will play a crucial role in partitioning an inhomogeneous image.

Next we analyze when the global or local term should play a dominant role. In the regions far away from the desired boundary of the object and the intensities vary slowly, due to improper window size of the averaging convolution operator, some small details with very low contrast may be seen in the difference image, then the local term will identify them but they should not be the main parts of the target object, so we need to increase the weight of the global term in such regions. In the regions close to the desired boundary of the object and where the intensities are inhomogeneous, c
                        1 and c
                        2 got from the original image may be far away from the true intensities of the foreground or background, which will affect the accuracy of the segmentation; however, the difference image with enhanced contrast is less influenced by the intensity inhomogeneity in such regions, so we need to increase the weight of the local term. In conclusion, we hope the global term would dominate in the regions with homogeneous intensities and the local term would be more important in the inhomogeneous area. Consequently, the problem becomes how to determine the regions with homogeneous and inhomogeneous intensities.

Following the work in [10], we adopt the adaptive weight
                           
                              (15)
                              
                                 
                                    w
                                    
                                       x
                                    
                                    =
                                    ρ
                                    ⋅
                                    average
                                    
                                       
                                          C
                                          N
                                       
                                    
                                    ⋅
                                    
                                       
                                          1
                                          −
                                          
                                             C
                                             N
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where ρ is a fixed positive parameter and C
                        
                           N
                         is a local contrast ratio of an image defined as
                           
                              
                                 
                                    
                                       C
                                       N
                                    
                                    
                                       x
                                    
                                    =
                                    
                                       
                                          
                                             M
                                             max
                                          
                                          −
                                          
                                             M
                                             min
                                          
                                       
                                       
                                          M
                                          g
                                       
                                    
                                    ,
                                 
                              
                           
                        where N defines the size of the local window centered at x, M
                        
                           max
                         and M
                        
                           min
                         are the maximum and minimum of intensities within this local window respectively, and M
                        
                           g
                         denotes the maximal intensity level of the entire image. Obviously, C
                        
                           N
                         varies between 0 and 1, so the weight functions w(x) and 1−
                        w(x) are always positive. It should be noted that the average value of C
                        
                           N
                         over the whole image average(C
                        
                           N
                        ) represents the overall contrast information of the image.

Now we explain the global and local terms how to selectively work in different regions by the weight function (15). When the intensity is inhomogeneous, i.e., the local intensity varies greatly, there will be a big difference between M
                        
                           max
                         and M
                        
                           min
                        , and then the value of C
                        
                           N
                         is large. Thus, the weight function w(x) is small. Therefore, the local term dominates the whole energy in inhomogeneous area. On the contrary, when the intensity is homogeneous, i.e., the local intensity varies slowly, the value of C
                        
                           N
                         is small, and thereby the weight w(x) will be large, so the global term dominates the whole energy in homogenous area.

Using the variational level set method, the total energy E(C) can be minimized by solving the following equation of the level set function ϕ
                        
                           
                              (16)
                              
                                 
                                    
                                       
                                          
                                             
                                                ∂
                                                ϕ
                                             
                                             
                                                ∂
                                                t
                                             
                                          
                                          =
                                          
                                             
                                                w
                                                
                                                   x
                                                
                                                
                                                   
                                                      I
                                                      
                                                         x
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               
                                                                  c
                                                                  1
                                                               
                                                               +
                                                               
                                                                  c
                                                                  2
                                                               
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         c
                                                         1
                                                      
                                                      −
                                                      
                                                         c
                                                         2
                                                      
                                                   
                                                
                                                +
                                                
                                                   
                                                      1
                                                      −
                                                      w
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         I
                                                         0
                                                      
                                                      
                                                         x
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               
                                                                  m
                                                                  1
                                                               
                                                               +
                                                               
                                                                  m
                                                                  2
                                                               
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         m
                                                         1
                                                      
                                                      −
                                                      
                                                         m
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          +
                                          λdiv
                                          
                                             
                                                
                                                   
                                                      ∇
                                                      ϕ
                                                   
                                                   
                                                      
                                                         ∇
                                                         ϕ
                                                      
                                                   
                                                
                                             
                                          
                                          δ
                                          
                                             ϕ
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        where
                           
                              (17)
                              
                                 
                                    
                                       c
                                       1
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          IH
                                          
                                             ϕ
                                          
                                          d
                                          x
                                       
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          H
                                          
                                             ϕ
                                          
                                          d
                                          x
                                       
                                    
                                    ,
                                    
                                       c
                                       2
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          I
                                          
                                             
                                                1
                                                −
                                                H
                                                
                                                   ϕ
                                                
                                             
                                          
                                          d
                                          x
                                       
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          
                                             
                                                1
                                                −
                                                H
                                                
                                                   ϕ
                                                
                                             
                                          
                                          d
                                          x
                                       
                                    
                                    ;
                                 
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    
                                       m
                                       1
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          
                                             I
                                             0
                                          
                                          H
                                          
                                             ϕ
                                          
                                          d
                                          x
                                       
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          
                                             H
                                             (
                                          
                                          ϕ
                                          )
                                          d
                                          x
                                       
                                    
                                    ,
                                    
                                       m
                                       2
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          
                                             I
                                             0
                                          
                                          
                                             
                                                1
                                                −
                                                H
                                                
                                                   ϕ
                                                
                                             
                                          
                                          d
                                          x
                                       
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          
                                             
                                                1
                                                −
                                                H
                                                
                                                   ϕ
                                                
                                             
                                          
                                          d
                                          x
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Because the evolution equations ϕ
                        
                           t
                        
                        =
                        Fδ(ϕ) and ϕ
                        
                           t
                        
                        =
                        F|∇
                        ϕ| have the same steady states, we draw upon the following equation for the level set evolution
                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             
                                                ∂
                                                ϕ
                                             
                                             
                                                ∂
                                                t
                                             
                                          
                                          =
                                          
                                             
                                                w
                                                
                                                   x
                                                
                                                
                                                   
                                                      I
                                                      
                                                         x
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               
                                                                  c
                                                                  1
                                                               
                                                               +
                                                               
                                                                  c
                                                                  2
                                                               
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         c
                                                         1
                                                      
                                                      −
                                                      
                                                         c
                                                         2
                                                      
                                                   
                                                
                                                +
                                                
                                                   
                                                      1
                                                      −
                                                      w
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         I
                                                         0
                                                      
                                                      
                                                         x
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               
                                                                  m
                                                                  1
                                                               
                                                               +
                                                               
                                                                  m
                                                                  2
                                                               
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         m
                                                         1
                                                      
                                                      −
                                                      
                                                         m
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          +
                                          λ
                                          div
                                          
                                             
                                                
                                                   
                                                      ∇
                                                      ϕ
                                                   
                                                   
                                                      
                                                         ∇
                                                         ϕ
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∇
                                                ϕ
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     

However, the computations of nonlinear PDEs (16) and (19) are all time-consuming due to the divergence term, which is the mean curvature of the curve represented by the level set function. To avoid the denominator in the divergence term to be zero, |∇
                        ϕ| always needs to be regularized, i.e., 
                           
                              |
                              ∇
                              ϕ
                              |
                              ≈
                              
                                 
                                    |
                                    ∇
                                    ϕ
                                    
                                       |
                                       2
                                    
                                    +
                                    ε
                                 
                              
                           
                        . Experimental experience tells us that the regularization parameter ε must be small enough to get a more accurate solution. But it may take longer computational time because of the CFL condition, which requires the time-step to be proportional to the regularization parameter ε. In practice, ε is often set to be 1 although it affects the accuracy a little. Thus, the time step can be large relatively, usually varying from 0.01 to 0.1. Of course, the additive operator splitting (AOS) scheme is a good choice to compute the Eq. (19); nevertheless the implementation is rather complicate.

On the other hand, to avoid the level set function to be too steep or flat near its interface, re-initialization is often required during the evolution. However, it is a very time-consuming process. Furthermore, it is still a problem to decide when and how to apply the re-initialization. Based on the observation that the level set function must keep being a signed distance function during the evolution in order to prevent it from being too steep or flat near its interface, that is to say, it must satisfy the condition |∇
                        ϕ|=1, then together with this condition, Eq. (19) can be simplified as
                           
                              (20)
                              
                                 
                                    
                                       
                                          ∂
                                          ϕ
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    =
                                    w
                                    
                                       x
                                    
                                    
                                       
                                          I
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      c
                                                      1
                                                   
                                                   +
                                                   
                                                      c
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             c
                                             1
                                          
                                          −
                                          
                                             c
                                             2
                                          
                                       
                                    
                                    +
                                    
                                       
                                          1
                                          −
                                          w
                                          
                                             x
                                          
                                       
                                    
                                    
                                       
                                          
                                             I
                                             0
                                          
                                          
                                             x
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      m
                                                      1
                                                   
                                                   +
                                                   
                                                      m
                                                      2
                                                   
                                                
                                                2
                                             
                                          
                                       
                                       
                                          
                                             m
                                             1
                                          
                                          −
                                          
                                             m
                                             2
                                          
                                       
                                    
                                    +
                                    λ
                                    Δϕ
                                    ,
                                 
                              
                           
                        or equivalently,
                           
                              (21)
                              
                                 
                                    
                                       
                                          ∂
                                          ϕ
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    =
                                    
                                       1
                                       λ
                                    
                                    
                                       
                                          w
                                          
                                             x
                                          
                                          
                                             
                                                I
                                                
                                                   x
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            c
                                                            1
                                                         
                                                         +
                                                         
                                                            c
                                                            2
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   c
                                                   1
                                                
                                                −
                                                
                                                   c
                                                   2
                                                
                                             
                                          
                                          +
                                          
                                             
                                                1
                                                −
                                                w
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             
                                                
                                                   I
                                                   0
                                                
                                                
                                                   x
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            m
                                                            1
                                                         
                                                         +
                                                         
                                                            m
                                                            2
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   m
                                                   1
                                                
                                                −
                                                
                                                   m
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    +
                                    Δϕ
                                    ,
                                 
                              
                           
                        which is a linear equation. The AOS scheme is also suitable for use. Here, we split the evolution Eq. (21) into two parts similarly to the methods in [37,7] (“time-splitting” method): the first one is
                           
                              (22)
                              
                                 
                                    
                                       
                                          ∂
                                          ϕ
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    =
                                    
                                       1
                                       λ
                                    
                                    
                                       
                                          w
                                          
                                             x
                                          
                                          
                                             
                                                I
                                                
                                                   x
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            c
                                                            1
                                                         
                                                         +
                                                         
                                                            c
                                                            2
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   c
                                                   1
                                                
                                                −
                                                
                                                   c
                                                   2
                                                
                                             
                                          
                                          +
                                          
                                             
                                                1
                                                −
                                                w
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             
                                                
                                                   I
                                                   0
                                                
                                                
                                                   x
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            m
                                                            1
                                                         
                                                         +
                                                         
                                                            m
                                                            2
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   m
                                                   1
                                                
                                                −
                                                
                                                   m
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        in which the right hand is independent of ϕ, so we can choose the relatively large step size to solve it; and the second one is
                           
                              (23)
                              
                                 
                                    
                                       
                                          ∂
                                          ϕ
                                       
                                       
                                          ∂
                                          t
                                       
                                    
                                    =
                                    Δϕ
                                    ,
                                 
                              
                           
                        then, we use a simpler implemental step to solve the Laplacian, which is the Gaussian filtering process as used in [25]. But now the condition |∇
                        ϕ|=1 has to be considered in the implementation. In fact, we can ignore the constraint from the point view of the Merriman, Bence and Osher (MBO) scheme [36].

Note that the divergence term is just the mean curvature of the curve represented by its level set function. The basic idea of the MBO scheme is that evolving a curve by its mean curvature can be approximated by solving a heat equation with respect to the level set function, and then taking threshold for the resulted solution. So we can solve (23) and then take threshold to approximate the divergence term 
                           
                              div
                              
                                 
                                    
                                       
                                          ∇
                                          ϕ
                                       
                                       
                                          
                                             ∇
                                             ϕ
                                          
                                       
                                    
                                 
                              
                              .
                           
                         The MBO scheme can be also interpreted by another well known technique for approximating mean curvature motion, namely the “time-splitting” scheme for Allen–Cahn equation or phase field method [37]. Here, we just replace the original potential function ϕ
                        2(1−
                        ϕ)2 with (1+
                        ϕ)2(1−
                        ϕ)2/2, so the thresholding step will be handled by letting ϕ
                        =1 if ϕ
                        ≥0; otherwise, ϕ
                        =−1. But the two step operations still approximate the mean curvature motion, which has been reported in [38,39]. Thus, the Heaviside function can be replaced by 
                           
                              H
                              
                                 ϕ
                              
                              =
                              
                                 
                                    
                                       1
                                       +
                                       ϕ
                                    
                                    2
                                 
                              
                           
                        , hence, the region force still can be written as the form of Eq. (22). Because we adopt the binary level set function and use the Gaussian filter to implement the heat equation, following [25], we call it BGFRLS method.

@&#IMPLEMENTATION@&#

According to above analysis, the detailed numerical schemes are summarized as follows
                           
                              1.
                              Initialize the level set function ϕ as
                                    
                                       
                                          
                                             ϕ
                                             =
                                             
                                                
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         if
                                                         
                                                         x
                                                         ∈
                                                         
                                                            Ω
                                                            1
                                                         
                                                         ,
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         if
                                                         
                                                         x
                                                         ∈
                                                         C
                                                         ,
                                                      
                                                   
                                                   
                                                      
                                                         −
                                                         1
                                                      
                                                      
                                                         if
                                                         
                                                         x
                                                         ∈
                                                         
                                                            Ω
                                                            2
                                                         
                                                         .
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Update c
                                 1, c
                                 2, m
                                 1 and m
                                 2 by Eqs. (17) and (18).

Evolve the level set function ϕ by the Eq. (22).

Regularize the resulted level set function with a Gaussian filter, i.e., ϕ
                                 1
                                 =
                                 G
                                 
                                    σ
                                 
                                 ∗
                                 ϕ, where G
                                 
                                    σ
                                  is a Gaussian kernel, and the parameter σ controls the smoothness of the contour.

Let ϕ
                                 =1 if ϕ
                                 1
                                 ≥0; otherwise, ϕ
                                 =−1.

Check whether the evolution of the level set function has converged. If not, return to step 2.

In this method, the traditional level set function is substituted by a binary level set function. Furthermore, the level set function only needs to be simply initialized to constants, which have different signs inside and outside of the contour. It is very simple to implement in practice.

In our experiments, we employ a stopping criterion recently proposed in [12] for image segmentation. The iteration will be stopped automatically when the change of the curve length keeps smaller than a prescribed threshold η, i.e., if the following criterion
                           
                              (24)
                              
                                 
                                    
                                       
                                          Length
                                          
                                             
                                                C
                                                
                                                   n
                                                   +
                                                   1
                                                
                                             
                                          
                                          −
                                          Length
                                          
                                             
                                                C
                                                n
                                             
                                          
                                       
                                    
                                    <
                                    η
                                    ,
                                 
                              
                           
                        or the approximate level set form
                           
                              (25)
                              
                                 
                                    
                                       
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          δ
                                          
                                             
                                                ϕ
                                                
                                                   n
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                ∇
                                                
                                                   ϕ
                                                   
                                                      n
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          d
                                          x
                                          −
                                          
                                             
                                                ∫
                                                Ω
                                             
                                          
                                          
                                          δ
                                          
                                             
                                                ϕ
                                                n
                                             
                                          
                                          
                                             
                                                ∇
                                                
                                                   ϕ
                                                   n
                                                
                                             
                                          
                                          d
                                          x
                                       
                                    
                                    <
                                    η
                                 
                              
                           
                        is satisfied, the iteration will be stopped. Here n denotes the iteration number and δ(ϕ)=
                        H′(ϕ).

@&#EXPERIMENTAL RESULTS@&#

In this section, we shall give some experimental results to validate the effectiveness of the proposed model and algorithm. We also compare our results with the ones got from C-V model, LGIF model [8,9], Piovano's method [22], AT-L1 model [6] and Yu's method [10], especially Wang's method [11,12], i.e., Eq. (1).

All algorithms are implemented in Matlab 7.1 on a 1.66-GHz PC. For our method, we fix the window size of the averaging convolution operator k
                     =25, and the local window size of the local contrast ratio N
                     =5. The Gaussian kernel size σ determines how smooth the curve is, specifically, the larger σ makes the curve more smooth, so it should be selected according to the segmented images. In addition, the time step in our method can be chosen as large enough as pointed out in [37], where the authors have verified that large time step made their time splitting scheme converge very quickly. In the following experiments, the time steps are uniformly set to be 1 for our method. However, for the variational level set method without re-initialization [34] used in other active contour models we want to compare, the time step size needs to satisfy the constraint δ
                     △
                     t
                     <0.25. The penalty parameter δ is usually set to be 1, so the time steps should not be large. For Wang's method [11,12], beside the time step, the regularization weight γ should also be chosen by trial and error method, and they can not be fixed and are usually different in view of different images to be segmented.

For evaluating the computational speed, we adopt the automatic stopping criterion (25) in all experiments. For all methods, we use a uniform prescribed threshold η
                     =10−1. Meanwhile, the iteration will be stopped when it achieves the given maximum iteration M
                     =200.

We first check the functions of our global term E
                        
                           g
                         and local term E
                        
                           l
                         respectively using a synthetic piecewise constant image and a synthetic piecewise linear image. For the piecewise constant image (Fig. 2(a)), we can fast obtain the correct segmentation only by the global term in 2 iterations. The global energy decreases dramatically as shown in Fig. 2(k). It shows that the global term is so effective for piecewise constant images. Then, we explain the functions of the difference image I
                        0 and the local term E
                        
                           l
                         by the piecewise linear image (Fig. 2(c)). As shown in Fig. 2(d)–(g), the difference image I
                        0 can alleviate the inhomogeneity of the original image. With the increasing of the window size of the averaging kernel G
                        
                           k
                        , the difference images become more and more inhomogeneous. However, near the edge, the contrast was enhanced. Fig. 2(h) is the segmentation result using the local term with k
                        =5, and Fig. 2(l) displays the change of the local energy with the iterations. So the local term is beneficial to segment inhomogeneous images. However, for large scales such as k
                        =25, we can not correctly get the edge only by the local term. The weak edge in the difference image, which is not the actual edge of the original image, was obtained in Fig. 2(i). So the local information must be integrated with the global information to get the desired result. Fig. 3(j) is the accurate segmentation of our whole model. Fig. 3(m) presents the values of the global term, local term and the whole region term with the iterations. Although the iteration is just 2 iterations, the global and local terms have almost the same values. It indicates that the two terms have no great difference in values as explained in Section 2.1. In the later experiments, this point still can be demonstrated.

We next test the robustness of our model to the noise with a homogeneous noisy image. Fig. 3 shows the segmentation results of a homogeneous image with noise. It is obvious that the image can be segmented by C-V model, Wang's method, our method with w
                        =1 and adaptive weight w(x). Moreover, our method is robust to noise as the other two methods. But the advantage of our method is that the iterations are fewer. It can be seen from the last row of Fig. 3, in which we compared the needed iterations of four methods when they satisfied the given stopping criterion (i.e., the length error 
                           
                              
                                 
                                    Length
                                    
                                       
                                          C
                                          
                                             n
                                             +
                                             1
                                          
                                       
                                    
                                    −
                                    Length
                                    
                                       
                                          C
                                          n
                                       
                                    
                                 
                              
                              <
                              1
                              e
                              −
                              1
                           
                        ). Furthermore, the computational time, which is shown in Table 1
                        , is also less than Wang's method. From the results of our method with w
                        =1 in the fourth row of Fig. 3, it further shows that our new constructed RBPF indeed can segment homogeneous images even if there exists noise. Besides, from the shape difference images (the last images in each row) between the segmented shape of our method and the ground truth, we can see that the segmentation results by our method and Wang's method are rather accurate. Of course, the C-V model and our global energy can also well segment out the three shapes of the image as long as appropriate parameters are chosen, but the accuracy is a little lower than ours. Note that the notations α and β denote the same meanings as those in [12], i.e., α and β are the weights of their global term and local term, respectively.

The following experiments (Figs. 4–5
                        
                        ) are to illustrate the importance of the adaptive weight and the local term in our method. From Fig. 4, we first observe that the segmentation result of our method (Fig. 4(g)) is more desirable than that of Wang's method (Fig. 4(c)). But if we try some different weight parameters between the global term and the local term, the segmentation results are very different, which have been shown in Fig. 4(d)–(f). The larger the weight of the local region term is, the better the region with low contrast can be segmented out. On the contrary, the larger the weight of the global term is, the better the region with relatively homogeneous intensity can be segmented out. So combing the local term and the global term automatically by the adaptive weight, we can obtain the better result as shown in Fig. 4(g). Then, with different weights, we test a synthetic image with inhomogeneous intensity using Wang's method and our method. Fig. 5(a)–(b) are the original image and the difference image I
                        0. Clearly, the contrast in the difference image is higher than the original image. And the most important thing is that the intensity inhomogeneity in the difference image has been alleviated to a certain degree, which is beneficial to the segmentation of the inhomogeneous image. Fig. 5(c)–(d) displays the segmentation results of Wang's method with different weight parameters. As suggested in [12], let α
                        =0.1 and β
                        =1, we get an undesirable result as shown in Fig. 5(c), which illustrates that the parameters need to be further adjusted. We try to choose α
                        =0.01 and β
                        =1 and finally obtain a satisfactory result (Fig. 5(d)). Fig. 5(e)–(h) presents the results of our method with different weights. It is clear to see that only in the case of w
                        =1 our method can not distinguish the object, that is to say, when the local term does not play a part in the whole evolution, our model fails. These results illuminate that the local term in our model indeed plays a crucial role in segmenting images with intensity inhomogeneity. Fig. 5(i) displays the desirable result obtained by the adaptive weight.

From the above two experiments, it can be concluded that the local term is indeed a vital term, and with the adaptive weight we can not only segment images automatically but also get better results.

The following experiments will focus on real medical images with intensity inhomogeneity. Figs. 6–7
                        
                         display the segmentation results for two inhomogeneous medical images.

Firstly, for a blood vessel image in Fig. 6, both Wang's method and our method gave satisfactory segmentations, and the needed iterations of them are very close (Fig. 6(m)). However, the computational speed of our method is almost double faster than that of Wang's method, which can be seen in Table 1. Besides, from the middle iterations and Fig. 6(m), it can be concluded that our method can reach the steady state faster, that is to say, our method converges more easily than Wang's method. This is mainly due to the use of the BGFRLS method. In order to further illustrate the efficiency of the BGFRLS method, we also compared the segmentation results and the corresponding computational time using the same time step for the two methods. Let the time step △
                        t
                        =0.1 as used in Wang's method, we still obtain a competitive result (see Fig. 6(l)). As listed in Table 1, the iteration numbers are more, but the total computational time is still less than Wang's method. So the new BGFRLS method favors speeding up the computation.

Secondly, using another blood vessel image (Fig. 7(a)), we will show that the proposed method is robust to different initial contours. We first see from the original image that the intensity is very inhomogeneous, specifically, the intensity on the left top is higher than that on the bottom. However, the inhomogeneity is reduced by computing the difference image I
                        0 (Fig. 7(b)), moreover, the contrast is also greatly enhanced, especially near the edges. This will be favorable to detect the vessel. We now examine the influence of different initial contours on the segmentation results. In the second row of Fig. 7, we present four initial contours located in different places of the original image. Using our method, we obtain the same results, which well validates that our method is insensitive to the initialization. But by Wang's method, the results are different, so they are affected by the location of initial contours. Besides, to get those relatively satisfying results, the parameters in Wang's method must be adjusted and each of them can not be fixed to one same value. So compared with our method, Wang's method is more sensitive to initial contours and parameters.

The purpose of the last experiments is to show the effectiveness of our model by comparing with C-V model, LGIF model, Wang's method, Piovano's method, AT-L1 model and Yu's method in view of vision and computational speed.


                        Fig. 8
                         displays the segmentation results of the four methods, i.e., C-V model, LGIF model, Wang's method and our method for a blurred image. Obviously, the C-V model can not accurately discriminate the little blurred numbers from background, and the LGIF model also can not well partition the digital 9. Wang's method and our method are able to get satisfactory segmentation results. But the needed iterations of Wang's method are much more than those of our method, which can be seen from Fig. 8(g) and Table 1. From Fig. 8(g), we also find that the iterations of C-V model and LGIF model are more than those of our method. It is mainly due to the use of the new level set method, i.e., BGFRLS method, which saves much time compared to the level set without re-initialization method [34].


                        Fig. 9
                         compares Piovano's method, Wang's method with our method in view of vision and computational speed for an inhomogeneous brain image. From the zoom in areas, we can see that our method can better distinguish the white matter from other parts. What is more, the needed iterations of our method are only 10 iterations, but Wang's method needs 30 iterations. So the computational time of our method is much less than that of Wang's method as presented in Table 1. Although the Piovano's method also uses 10 iterations to get the result (see Fig. 9(k)), our method can fast get the steady state within 3 iterations whether seen from the changes of the length error or the whole region term.

Finally, we compare the AT-L1 model, Yu's method with our model using a real X-ray image. From the experimental results shown in Fig. 10
                        , we can see that our model obtained better segmentation than others. AT-L1 method can get the denoised image u and the edge image v, but the fingers' edges are not sharp enough, particularly at the digital joints in v. Yu's method is not only time-consuming but also can not perform well. From Fig. 10(h) and (i), we see that our method can quickly get the steady state. However, Yu's method requires more than 130 iterations, mainly because the variational level set method without re-initialization used in [10] converges slower than the BGFRLS method used in our model. Besides, unlike Yu's method, our global term and local term even with their respective weight functions still have no great difference in values.

@&#CONCLUSION@&#

In this paper, by constructing a new RBPF function, we proposed a novel segmentation model integrating the local and global intensity information adaptively in a level set framework. The novel model is especially good for the segmentation of inhomogeneous images due to the use of the local intensity information. The local intensity information is related with the difference between the average of the local intensity distribution and the original image, which can significantly increase the contrast between foreground and background intensities. However, only the local information can not accurately segment some images well. We combined the global intensity information with it by an adaptive weight. In different regions, the local term and the global term would alternatively dominate the whole energy, and thus played different roles in homogeneous and inhomogeneous regions. For the implementation, we drew upon a fast and simple level set method only requiring to compute a Gaussian convolution after each iteration. Experimental results showed that our method can fast and accurately segment images with both homogenous intensity and inhomogeneous intensity.

@&#ACKNOWLEDGMENTS@&#

This work is supported by the National Natural Science Foundation of China (Grant Nos. 11101365 and 11001239).

@&#REFERENCES@&#

