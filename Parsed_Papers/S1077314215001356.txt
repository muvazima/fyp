@&#MAIN-TITLE@&#Rotation and translation covariant match kernels for image retrieval

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a geometric aware aggregated representation for image retrieval.


                        
                        
                           
                           The covariant property is offered by jointly encoding angle/location and SIFT.


                        
                        
                           
                           Efficient matching for multiple transformations via a trigonometric polynomial.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Image retrieval

Geometry aware aggregation

Match kernels

Monomial embedding

@&#ABSTRACT@&#


               
               
                  Most image encodings achieve orientation invariance by aligning the patches to their dominant orientations and translation invariance by completely ignoring patch position or by max-pooling. Albeit successful, such choices introduce too much invariance because they do not guarantee that the patches are rotated or translated consistently. In this paper, we propose a geometric-aware aggregation strategy, which jointly encodes the local descriptors together with their patch dominant angle or location. The geometric attributes are encoded in a continuous manner by leveraging explicit feature maps. Our technique is compatible with generic match kernel formulation and can be employed along with several popular encoding methods, in particular Bag-of-Words, VLAD and the Fisher vector. The method is further combined with an efficient monomial embedding to provide a codebook-free method aggregating local descriptors into a single vector representation. Invariance is achieved by efficient similarity estimation of multiple rotations or translations, offered by a simple trigonometric polynomial. This strategy is effective for image search, as shown by experiments performed on standard benchmarks for image and particular object retrieval, namely Holidays and Oxford buildings.
               
            

@&#INTRODUCTION@&#

This paper considers the problem of particular image or particular object retrieval. This subject has received a sustained attention over the last decade. Many of the recent works employ local descriptors such as SIFT [1] or variants [2,3] for the low-level description of the images. In particular, approaches derived from the Bag-of-Words framework [4] are especially successful to solve problems like recognizing buildings. They are typically combined with spatial verification [5,6] or other re-ranking strategies such as query expansion [7,8].

Our objective is to improve the quality of the first retrieval stage, before any re-ranking is performed. This is critical when considering large datasets, as re-ranking methods depend on the quality of the initial short-list, which typically consists of a few hundred images. The initial stage is improved by better matching rules, for instance with Hamming embedding [9], by learning a fine vocabulary [10], or weighting the distances [11,12]. Moreover, it is useful to employ some geometrical information associated with the region of interest [9]. All these approaches rely on matching individual descriptors and therefore store some data on a per descriptor basis. Moreover, the quantization of the query’s descriptors on a large vocabulary causes delays.

Recently, very short yet effective representations have been proposed based on alternative encoding strategies, such as local linear coding [13], the Fisher vector [14] or VLAD [15]. Most of these representations have been proposed first for image classification, yet also offer very effective properties in the context of extremely large-scale image search. A feature of utmost importance is that they offer vector representations compatible with cosine similarity. The representation can then be effectively binarized [16] with cosine sketches, such as those proposed by Charikar [17] (also known as LSH), or aggressively compressed to very short vectors with principal component dimensionality reduction (PCA). Product quantization [18] is another example achieving a very compact representation of a few dozens to hundreds of bytes as well as an efficient search because the comparison is done in the compressed domain.

This paper focuses on such short- and mid-sized vector representations of images. Our objective is to exploit some geometrical information associated with the regions of interest. A popular work in this context is the spatial pyramid kernel [19], which is widely adopted for image classification. However, it is ineffective for particular image retrieval as the grid is too rigid and the resulting representation is not invariant enough, as shown by Douze et al. [20].

Here, we aim at incorporating some relative angle information to ensure that the patches are consistently rotated. In other terms, we want to achieve a covariant property similar to that offered by Weak Geometry Consistency (WGC) [9], but directly implemented into the coding stage of image vector representations like Fisher, or VLAD. We achieve that by jointly encoding the local descriptor with the dominant angle in a continuous way. Some recent works in classification [21] and image search [22] consider a similar objective and proceed by rotation quantization. Encoding of such a rough approximation is not straightforwardly compatible with generic match kernels.

In contrast, we achieve the covariant property for any method provided that it can be written as a match kernel. This holds for the Fisher vector, LLC, Bag-of-Words and efficient match kernels listed in [23]. Our method initially assumes aligned objects and image similarity is computed efficiently for multiple rotations thanks to simple trigonometric identities. Finally, the same methodology yields a continuous alternative to spatial pyramid match kernel by encoding patch positions.

This work is the continuation of our previous work [24]. The new contribution consists of the extension to the translation covariant match kernel and the exploitation of a trigonometric polynomial for efficient similarity computation. The latter was only discussed in our previous work, but not exploited.

This paper is organized as follows. Section 2 discusses related works, while Section 3 introduces notation for generic match kernels. Our approach is presented in Section 4 and Section 5 describes the extension to position-translation. Evaluation is presented in Section 6 on several popular benchmarks for image search, namely Oxford5k [5], Oxford105k and Inria Holidays [25]. These experiments show that our approach gives a significant improvement over the state of the art on image search with vector representations. Interestingly, we further achieve competitive results by combining our approach with monomial embeddings, i.e., with a codebook-free approach, as opposed to coding approaches like VLAD.
                        1
                     
                     
                        1
                        Code is available online at: https://gforge.inria.fr/frs/download.php/latestzip/4895/PkgAngularmodulation-latest.zip
.
                     
                  

@&#RELATED WORK@&#

Our method is inspired by the kernel descriptor of Bo et al. [26] but it departs from this in several ways. First, we are interested in aggregating local descriptors to produce a vector image representation, whereas they construct new local descriptors. Our objective is not to encode the pixel gradient orientation but to achieve the property that the patch representation is covariant. Therefore, we encode the dominant orientation or the spatial coordinates of the region of interest jointly with the corresponding SIFT descriptor. Finally, we rely on explicit feature maps [27] to encode the angle, which provides a much better approximation than efficient match kernel [23] for a given number of components.

The well known aggregated representations, such as Bag-of-Words, VLAD and Fisher vectors, only encode appearance and completely discard spatial information. The most popular attempt surpassing this limitation is the spatial pyramid match [19] (SPM). Patch position is quantized and used as a pooling variable. In this fashion, invariance to any geometric transformation is lost, and only a restricted amount of tolerance is attained.

Regarding position encoding, Arandjelovic and Zisserman [28] extract multiple VLAD descriptors per image from horizontal and vertical tiles, aiming at localizing the searched object in the image. This approach is effective for retrieving small objects, but does not solve the aforementioned shortcomings of image level aggregated descriptors. Recent works in image classification [29–31] provide lower-dimensional alternatives for SPM via different encodings of spatial information. Krapac et al. [29] define a Fisher Kernel integrating location prior. Both appearance and spatial layout of patches are encoded. Spatial Coordinate Coding [30] augments the SIFT descriptors with the corresponding spatial coordinates. Quantization, encoding and pooling take place in the augmented feature space. In a similar work [31], feature scale is encoded in addition to position, leading to encouraging results on PASCAL VOC and ImageNet fine-grained classification benchmarks [32].

The hierarchical kernel descriptor of Bo et al. [33] encodes position information at multiple levels. Patch location proximity is evaluated via a Gaussian kernel. In order to keep the representation compact, the positions are expressed as projections on 25 basis vectors uniformly sampled from a 5 × 5 grid. In contrast, we encode positions in a continuous manner, leading to a richer representation and to reduced quantization artifacts.

Following a similar principle to that of SPM but at a single level, the dominant angle is quantized and considered as a pooling variable in recent works [21,22]. CVLAD [22] in particular shifts the sub-vectors corresponding to each angular cell in order to mimic query image rotation and provides some rotation invariance. This strategy increases complexity proportionally to the number of rotations taken into account. In contrast, along with our method we propose a very efficient way to compute similarity for multiple image rotations.

WGC applies geometric constraints on the whole database of images, and not only on a short-list [5,6]. We achieve the same property with aggregated representations; thus individual descriptors are not indexed. Moreover, we do not need to explicitly form patch correspondences and compute relative angles for each.

We consider the context of match kernels. An image is typically described by a set of local descriptors 
                        
                           X
                           =
                           
                              {
                              
                                 x
                                 1
                              
                              ,
                              ⋯
                              ,
                              
                                 x
                                 i
                              
                              ,
                              ⋯
                              }
                           
                           ,
                           
                           
                              x
                              i
                           
                           ∈
                           
                              R
                              d
                           
                           ,
                           
                              ∥
                              
                                 x
                                 i
                              
                              ∥
                           
                           =
                           1
                           .
                        
                      Similar to other works [9,23,34], two images described by 
                        X
                      and 
                        Y
                      are compared with a match kernel K of the form

                        
                           (1)
                           
                              
                                 K
                                 
                                    (
                                    X
                                    ,
                                    Y
                                    )
                                 
                                 =
                                 β
                                 
                                    (
                                    X
                                    )
                                 
                                 β
                                 
                                    (
                                    Y
                                    )
                                 
                                 
                                    ∑
                                    
                                       x
                                       ∈
                                       X
                                    
                                 
                                 
                                    ∑
                                    
                                       y
                                       ∈
                                       Y
                                    
                                 
                                 k
                                 
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                                 ,
                              
                           
                        
                     where k is referred to as the local kernel and where the proportionality factor β ensures that 
                        
                           K
                           (
                           X
                           ,
                           X
                           )
                           =
                           K
                           (
                           Y
                           ,
                           Y
                           )
                           =
                           1
                        
                     . A convenient way to obtain such a kernel is to map the vectors x to a higher-dimensional space with a function 
                        
                           φ
                           :
                           
                              R
                              d
                           
                           →
                           
                              R
                              D
                           
                           ,
                        
                      such that the inner product similarity evaluates the local kernel 
                        
                           k
                           (
                           x
                           ,
                           y
                           )
                           =
                           〈
                           φ
                           (
                           x
                           )
                           |
                           φ
                           (
                           y
                           )
                           〉
                        
                     . This approach then represents a set of local descriptors by a single vector

                        
                           (2)
                           
                              
                                 X
                                 =
                                 β
                                 
                                    (
                                    X
                                    )
                                 
                                 
                                    ∑
                                    
                                       x
                                       ∈
                                       X
                                    
                                 
                                 φ
                                 
                                    (
                                    x
                                    )
                                 
                                 ,
                                 
                                 
                                 
                                 
                                 (such
                                 
                                 that
                                 
                                 
                                    ∥
                                    X
                                    ∥
                                    =
                                    1
                                 
                                 )
                              
                           
                        
                     because the match kernel is computed with a simple inner product as

                        
                           (3)
                           
                              
                                 K
                                 
                                    (
                                    X
                                    ,
                                    Y
                                    )
                                 
                                 =
                                 β
                                 
                                    (
                                    X
                                    )
                                 
                                 β
                                 
                                    (
                                    Y
                                    )
                                 
                                 
                                    ∑
                                    
                                       x
                                       ∈
                                       X
                                    
                                 
                                 
                                    ∑
                                    
                                       y
                                       ∈
                                       Y
                                    
                                 
                                 
                                    〈
                                    φ
                                    
                                       (
                                       x
                                       )
                                    
                                    |
                                    φ
                                    
                                       (
                                       y
                                       )
                                    
                                    〉
                                 
                                 =
                                 
                                    〈
                                    X
                                    |
                                    Y
                                    〉
                                 
                                 .
                              
                           
                        
                     
                  

This kernelized view encompasses many approaches for aggregating local image descriptors such as Bag-of-Words [4,35], LLC [13], Fisher vector [14], VLAD [15], or VLAT [36]. A desirable property of k is to have k(x, y) ≈ 0 for unrelated features, so that they do not interfere with the measurements between the true matches. It is somehow satisfied with the classical inner product 
                        
                           k
                           (
                           x
                           ,
                           y
                           )
                           =
                           〈
                           x
                           |
                           y
                           〉
                        
                     . Several authors [12,34,36,56] propose to increase the contrast between related and unrelated features with a monomial match kernel of degree p of the form

                        
                           (4)
                           
                              
                                 K
                                 
                                    (
                                    X
                                    ,
                                    Y
                                    )
                                 
                                 =
                                 β
                                 
                                    (
                                    X
                                    )
                                 
                                 β
                                 
                                    (
                                    Y
                                    )
                                 
                                 
                                    ∑
                                    
                                       x
                                       ∈
                                       X
                                    
                                 
                                 
                                    ∑
                                    
                                       y
                                       ∈
                                       Y
                                    
                                 
                                 
                                    
                                       〈
                                       x
                                       |
                                       y
                                       〉
                                    
                                    p
                                 
                                 .
                              
                           
                        
                     
                  

All monomial (and polynomial) embeddings admit exact finite-dimensional feature maps whose length rapidly increases with degree p (in 
                        
                           O
                           (
                           
                              d
                              p
                           
                           /
                           p
                           !
                           )
                           )
                        
                     . The order 
                        
                           p
                           =
                           2
                        
                      has already demonstrated some benefit, for instance in semantic segmentation [37] or in image classification [36]. In this case, the kernel is equivalent to comparing the set of features based on their covariance matrix [36]. Equivalently, by observing that some components are identical, we can define the embedding 
                        
                           
                              φ
                              2
                           
                           :
                           
                              R
                              d
                           
                           →
                           
                              R
                              
                                 d
                                 (
                                 d
                                 +
                                 1
                                 )
                                 /
                                 2
                              
                           
                        
                      mapping 
                        
                           x
                           =
                           
                              
                                 [
                                 
                                    x
                                    1
                                 
                                 ,
                                 ⋯
                                 ,
                                 
                                    x
                                    d
                                 
                                 ]
                              
                              ⊤
                           
                        
                      to

                        
                           (5)
                           
                              
                                 
                                    φ
                                    2
                                 
                                 
                                    (
                                    x
                                    )
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          x
                                          1
                                          2
                                       
                                       ,
                                       ⋯
                                       ,
                                       
                                          x
                                          d
                                          2
                                       
                                       ,
                                       
                                          x
                                          1
                                       
                                       
                                          x
                                          2
                                       
                                       
                                          2
                                       
                                       ,
                                       ⋯
                                       ,
                                       
                                          x
                                          
                                             d
                                             −
                                             1
                                          
                                       
                                       
                                          x
                                          d
                                       
                                       
                                          2
                                       
                                       ]
                                    
                                    ⊤
                                 
                                 .
                              
                           
                        
                     Similarly, the simplified exact monomial embedding associated with 
                        
                           p
                           =
                           3
                        
                      is the function 
                        
                           
                              φ
                              3
                           
                           :
                           
                              R
                              d
                           
                           →
                           
                              R
                              
                                 (
                                 
                                    d
                                    3
                                 
                                 +
                                 3
                                 
                                    d
                                    2
                                 
                                 +
                                 2
                                 
                                 d
                                 )
                                 /
                                 6
                              
                           
                        
                      defined as

                        
                           (6)
                           
                              
                                 
                                    
                                       
                                          
                                             φ
                                             3
                                          
                                          
                                             (
                                             x
                                             )
                                          
                                          =
                                          
                                             
                                                [
                                                
                                                   x
                                                   1
                                                   3
                                                
                                                ,
                                                ⋯
                                                ,
                                                
                                                   x
                                                   d
                                                   3
                                                
                                                ,
                                                
                                                   x
                                                   1
                                                   2
                                                
                                                
                                                   x
                                                   2
                                                
                                                
                                                   3
                                                
                                                ,
                                                ⋯
                                                ,
                                                
                                                   x
                                                   d
                                                   2
                                                
                                                
                                                   x
                                                   
                                                      d
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   3
                                                
                                                ,
                                                
                                                   x
                                                   1
                                                
                                                
                                                   x
                                                   2
                                                
                                                
                                                   x
                                                   3
                                                
                                                
                                                   6
                                                
                                                ,
                                                ⋯
                                                ,
                                                
                                                   x
                                                   
                                                      d
                                                      −
                                                      2
                                                   
                                                
                                                
                                                   x
                                                   
                                                      d
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   x
                                                   d
                                                
                                                
                                                   6
                                                
                                                ]
                                             
                                             ⊤
                                          
                                          .
                                          
                                          
                                          
                                          
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

The core idea of the proposed method is to exploit jointly the SIFT descriptors and the dominant orientation θx
                      associated with a region of interest. For this purpose, we now assume that an image is represented by a set 
                        
                           
                              X
                           
                           ☆
                        
                      of tuples, each of the form (x, θx
                     ), where x is a SIFT descriptor and 
                        
                           
                              θ
                              x
                           
                           ∈
                           
                              [
                              −
                              π
                              ,
                              π
                              ]
                           
                        
                      is the dominant orientation. Our objective is to obtain an approximation of a match kernel of the form

                        
                           (7)
                           
                              
                                 
                                    K
                                    ☆
                                 
                                 
                                    (
                                    
                                       
                                          X
                                       
                                       ☆
                                    
                                    ,
                                    
                                       
                                          Y
                                       
                                       ☆
                                    
                                    )
                                 
                                 =
                                 β
                                 
                                    (
                                    
                                       
                                          X
                                       
                                       ☆
                                    
                                    )
                                 
                                 β
                                 
                                    (
                                    
                                       
                                          Y
                                       
                                       ☆
                                    
                                    )
                                 
                                 
                                    ∑
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      (
                                                      x
                                                      ,
                                                      
                                                         θ
                                                         x
                                                      
                                                      )
                                                   
                                                   ∈
                                                   
                                                      
                                                         X
                                                      
                                                      ☆
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      (
                                                      y
                                                      ,
                                                      
                                                         θ
                                                         y
                                                      
                                                      )
                                                   
                                                   ∈
                                                   
                                                      
                                                         Y
                                                      
                                                      ☆
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 k
                                 
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                                 
                                 
                                    k
                                    θ
                                 
                                 
                                    (
                                    
                                       θ
                                       x
                                    
                                    ,
                                    
                                       θ
                                       y
                                    
                                    )
                                 
                              
                           
                        
                     
                     
                        
                           (8)
                           
                              
                                 
                                    
                                       
                                          K
                                          ☆
                                       
                                       
                                          (
                                          
                                             
                                                X
                                             
                                             ☆
                                          
                                          ,
                                          
                                             
                                                Y
                                             
                                             ☆
                                          
                                          )
                                       
                                    
                                 
                                 =
                                 〈
                                 
                                    X
                                    ☆
                                 
                                 |
                                 
                                    Y
                                    ☆
                                 
                                 〉
                                 ,
                              
                           
                        
                     where k is a local kernel identical to that considered in Section 2 and kθ
                      reflects the similarity between angles. The interest of enriching this match kernel with orientation is illustrated in Fig. 1, where we show that several incorrect matches are downweighted thanks to this information.

The kernel in (7) resembles that implemented in WGC [9] with a voting approach. In contrast, we intend to approximate this kernel with an inner product between two vectors as in (8), similar to the linear match kernel simplification in (3). Our work is inspired by the kernel descriptors [26] of Bo et al., who also consider a kernel of a similar form, but at the patch level, to construct a local descriptor from pixel attributes, such as gradient and position.

In our case, we consider the coding stage and employ a better approximation technique, namely explicit feature maps [27], to encode 
                        
                           
                              X
                           
                           ☆
                        
                     . This section first explains the feature map of the angle, then described how the descriptors and angles are jointly represented, and finally discusses the match kernel design and properties.

The first step is to find a mapping 
                           
                              
                                 α
                              
                              :
                              
                                 [
                                 −
                                 π
                                 ,
                                 π
                                 ]
                              
                              →
                              
                                 R
                                 M
                              
                           
                         from an angle θ to a vector 
                           α
                        (θ) such that 
                           
                              
                                 α
                              
                              
                                 
                                    (
                                    
                                       θ
                                       1
                                    
                                    )
                                 
                                 ⊤
                              
                              
                                 α
                              
                              
                                 (
                                 
                                    θ
                                    2
                                 
                                 )
                              
                              =
                              
                                 k
                                 θ
                              
                              
                                 (
                                 
                                    θ
                                    1
                                 
                                 −
                                 
                                    θ
                                    2
                                 
                                 )
                              
                           
                        . The function 
                           
                              
                                 k
                                 θ
                              
                              :
                              R
                              →
                              
                                 [
                                 0
                                 ,
                                 1
                                 ]
                              
                           
                         is a shift invariant kernel which should be symmetric (
                           
                              
                                 k
                                 θ
                              
                              
                                 (
                                 Δ
                                 θ
                                 )
                              
                              =
                              
                                 k
                                 θ
                              
                              
                                 (
                                 −
                                 Δ
                                 θ
                                 )
                              
                           
                        ), pseudo-periodic with period of 2π and monotonically decreasing over [0, π]. The function kθ
                         is scalar and it allows us to model the behaviour of the match kernel and to design the feature map accordingly. In the work of Vedaldi and Zisserman [27] it is termed as kernel signature. We consider in particular the following function:

                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             
                                                k
                                                VM
                                             
                                             
                                                (
                                                Δ
                                                θ
                                                )
                                             
                                             =
                                             
                                                
                                                   exp
                                                   (
                                                   κ
                                                   cos
                                                   (
                                                   Δ
                                                   θ
                                                   )
                                                   )
                                                   −
                                                   exp
                                                   (
                                                   −
                                                   κ
                                                   )
                                                
                                                
                                                   2
                                                   sinh
                                                   (
                                                   κ
                                                   )
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        It is derived from Von Mises distribution f(Δθ; κ), which is often considered as the probability density distribution of the noise of the measure of an angle, and therefore regarded as the equivalent Gaussian distribution for angles. Our function 
                           
                              k
                              VM
                           
                         is a shifted and scaled variant of Von Mises, designed such that its range is [0, 1], which ensures that 
                           
                              
                                 k
                                 VM
                              
                              
                                 (
                                 π
                                 )
                              
                              =
                              0
                           
                        .

The periodic function 
                           
                              k
                              VM
                           
                         can be expressed as a Fourier series whose coefficients are (see [38, Eq. (9.6.19)]

                           
                              (10)
                              
                                 
                                    
                                       k
                                       VM
                                    
                                    
                                       (
                                       Δ
                                       θ
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             I
                                             0
                                          
                                          
                                             (
                                             κ
                                             )
                                          
                                          −
                                          
                                             e
                                             
                                                −
                                                κ
                                             
                                          
                                          +
                                          2
                                          
                                             ∑
                                             
                                                n
                                                =
                                                1
                                             
                                             ∞
                                          
                                          
                                             I
                                             n
                                          
                                          
                                             (
                                             κ
                                             )
                                          
                                          cos
                                          
                                             (
                                             n
                                             Δ
                                             θ
                                             )
                                          
                                       
                                       
                                          2
                                          sinh
                                          (
                                          κ
                                          )
                                       
                                    
                                    ,
                                 
                              
                           
                        where In
                        (κ) is the modified Bessel function of the first kind of order n. We now consider the truncation 
                           
                              
                                 k
                                 ¯
                              
                              VM
                              N
                           
                         of the series to the first N terms

                           
                              (11)
                              
                                 
                                    
                                       
                                          k
                                          ¯
                                       
                                       VM
                                       N
                                    
                                    
                                       (
                                       Δ
                                       θ
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          n
                                          =
                                          0
                                       
                                       N
                                    
                                    
                                       γ
                                       n
                                    
                                    cos
                                    
                                       (
                                       n
                                       Δ
                                       θ
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    with
                                    
                                    
                                       γ
                                       0
                                    
                                    =
                                    
                                       
                                          (
                                          
                                             I
                                             0
                                          
                                          
                                             (
                                             κ
                                             )
                                          
                                          −
                                          
                                             e
                                             
                                                −
                                                κ
                                             
                                          
                                          )
                                       
                                       
                                          2
                                          sinh
                                          (
                                          κ
                                          )
                                       
                                    
                                    
                                    
                                    and
                                    
                                    
                                    
                                       γ
                                       n
                                    
                                    =
                                    
                                       
                                          
                                             I
                                             n
                                          
                                          
                                             (
                                             κ
                                             )
                                          
                                       
                                       
                                          sinh
                                          (
                                          κ
                                          )
                                       
                                    
                                    
                                    if
                                    
                                    
                                    n
                                    >
                                    0
                                    .
                                 
                              
                           
                        
                     

We design the feature map 
                           α
                        (θ), mappping an angle θ to a vector, as follows:

                           
                              (13)
                              
                                 
                                    
                                       
                                          
                                             
                                                α
                                             
                                             (
                                             θ
                                             )
                                          
                                       
                                       
                                          
                                             =
                                             (
                                             
                                                
                                                   γ
                                                   0
                                                
                                             
                                             ,
                                             
                                                
                                                   γ
                                                   1
                                                
                                             
                                             cos
                                             
                                                (
                                                θ
                                                )
                                             
                                             ,
                                             
                                                
                                                   γ
                                                   1
                                                
                                             
                                             sin
                                             
                                                (
                                                θ
                                                )
                                             
                                             ,
                                             …
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   γ
                                                   N
                                                
                                             
                                             cos
                                             
                                                (
                                                N
                                                θ
                                                )
                                             
                                             ,
                                             
                                                
                                                   γ
                                                   N
                                                
                                             
                                             
                                                
                                                   sin
                                                   
                                                      (
                                                      N
                                                      θ
                                                      )
                                                   
                                                   )
                                                
                                                ⊤
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        This vector has 
                           
                              2
                              N
                              +
                              1
                           
                         components. Moreover

                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             
                                                α
                                             
                                             
                                                
                                                   (
                                                   
                                                      θ
                                                      1
                                                   
                                                   )
                                                
                                                ⊤
                                             
                                             
                                                α
                                             
                                             
                                                (
                                                
                                                   θ
                                                   2
                                                
                                                )
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                γ
                                                0
                                             
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                γ
                                                n
                                             
                                             
                                                (
                                                cos
                                             
                                             
                                                (
                                                n
                                                
                                                   θ
                                                   1
                                                
                                                )
                                             
                                             cos
                                             
                                                (
                                                n
                                                
                                                   θ
                                                   2
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                             sin
                                             
                                                (
                                                n
                                                
                                                   θ
                                                   1
                                                
                                                )
                                             
                                             sin
                                             
                                                (
                                                n
                                                
                                                   θ
                                                   2
                                                
                                                )
                                             
                                             
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   0
                                                
                                                N
                                             
                                             
                                                γ
                                                n
                                             
                                             cos
                                             
                                                (
                                                n
                                                
                                                   (
                                                   
                                                      θ
                                                      1
                                                   
                                                   −
                                                   
                                                      θ
                                                      2
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   k
                                                   ¯
                                                
                                                VM
                                                N
                                             
                                             
                                                (
                                                
                                                   θ
                                                   1
                                                
                                                −
                                                
                                                   θ
                                                   2
                                                
                                                )
                                             
                                             ≈
                                             
                                                k
                                                VM
                                             
                                             
                                                (
                                                
                                                   θ
                                                   1
                                                
                                                −
                                                
                                                   θ
                                                   2
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The design of a feature map is explained in full details by Vedaldi and Zisserman [27]. This feature map gives an approximation of the target function 
                           
                              
                                 k
                                 VM
                              
                              ,
                           
                         which is more accurate as N is bigger.


                        Fig. 2 illustrates the function 
                           
                              k
                              VM
                           
                         for several values of the parameter κ and its approximation 
                           
                              
                                 k
                                 ¯
                              
                              VM
                              N
                           
                         for different values of N. First note that 
                           
                              
                                 k
                                 ¯
                              
                              VM
                              N
                           
                         may not fulfill the original requirements: its range might be wider than [0, 1] and it might not be monotonically decreasing over [0, π]. Larger values of κ produce a more “selective” function of the angle, yet require more components (larger value of N) to obtain an accurate estimation. Importantly, the approximation stemming from this explicit angle mapping is better than that based on efficient match kernels [23], which converges slowly with the number of components. Efficient match kernels are more intended to approximate kernels on vectors than on scalar values. As a trade-off between selectivity and the number of components, we set κ=8 and N=3 (see Section 6). Accordingly, we use 
                           
                              
                                 k
                                 ¯
                              
                              VM
                              3
                           
                         as kθ
                         in the sequel. The corresponding embedding 
                           
                              
                                 α
                              
                              :
                              R
                              →
                              
                                 R
                                 7
                              
                           
                         maps any angle to a 7-dimensional vector.

Instead of approximating a kernel on angles with finite Fourier series, one may rather consider directly designing a function satisfying our initial requirements (pseudo-period, symmetric, decreasing over [0, π]), such as

                                 
                                    (15)
                                    
                                       
                                          
                                             k
                                             P
                                          
                                          
                                             (
                                             Δ
                                             θ
                                             )
                                          
                                          =
                                          cos
                                          
                                             
                                                (
                                                Δ
                                                θ
                                                /
                                                2
                                                )
                                             
                                             P
                                          
                                          
                                          with
                                          
                                          P
                                          
                                          even
                                          .
                                       
                                    
                                 
                              Thanks to power reduction trigonometric identities, for even P this function is re-written as

                                 
                                    (16)
                                    
                                       
                                          
                                             k
                                             P
                                          
                                          
                                             (
                                             Δ
                                             θ
                                             )
                                          
                                          =
                                          
                                             ∑
                                             
                                                p
                                                =
                                                0
                                             
                                             
                                                P
                                                /
                                                2
                                             
                                          
                                          
                                             γ
                                             p
                                          
                                          cos
                                          
                                             (
                                             p
                                             Δ
                                             θ
                                             )
                                          
                                       
                                    
                                 
                              with

                                 
                                    (17)
                                    
                                       
                                          
                                             γ
                                             0
                                          
                                          =
                                          
                                             1
                                             
                                                2
                                                P
                                             
                                          
                                          
                                             (
                                             
                                                P
                                                
                                                   P
                                                   /
                                                   2
                                                
                                             
                                             )
                                          
                                          ,
                                          
                                             γ
                                             p
                                          
                                          =
                                          
                                             1
                                             
                                                2
                                                
                                                   P
                                                   −
                                                   1
                                                
                                             
                                          
                                          
                                             (
                                             
                                                P
                                                
                                                   P
                                                   /
                                                   2
                                                   −
                                                   p
                                                
                                             
                                             )
                                          
                                          
                                          0
                                          <
                                          p
                                          ≤
                                          P
                                          /
                                          2
                                          .
                                       
                                    
                                 
                              Now, applying (13) leads to a feature map 
                                 α
                              (θ) with 
                                 
                                    P
                                    +
                                    1
                                 
                               components such that 
                                 
                                    
                                       α
                                    
                                    
                                       
                                          (
                                          
                                             θ
                                             1
                                          
                                          )
                                       
                                       ⊤
                                    
                                    
                                       α
                                    
                                    
                                       (
                                       
                                          θ
                                          2
                                       
                                       )
                                    
                                    =
                                    
                                       k
                                       P
                                    
                                    
                                       (
                                       
                                          θ
                                          1
                                       
                                       −
                                       
                                          θ
                                          2
                                       
                                       )
                                    
                                    .
                                 
                               For this function, the interesting property is that the scalar product is exactly equal to the target kernel value 
                                 
                                    
                                       k
                                       P
                                    
                                    
                                       (
                                       
                                          θ
                                          1
                                       
                                       −
                                       
                                          θ
                                          2
                                       
                                       )
                                    
                                    ,
                                 
                               and that the original requirements now hold. From our experiments, this function gives reasonable results, but requires more components than 
                                 
                                    
                                       k
                                       ¯
                                    
                                    VM
                                 
                               to achieve a shape narrow around 
                                 
                                    Δ
                                    θ
                                    =
                                    0
                                 
                               and close to 0 otherwise. The results for our image search application task using this function are slightly below our Von Mises variant for a given dimensionality. So, despite its theoretical interest we do not use it in our experiments. Ultimately, one would rather directly learn a Fourier embedding for a targeted task (e.g. an embedding per classifier), in the spirit of Fourier kernel learning [39].

The vector 
                           α
                         encoding the angle θ “modulates”
                           2
                        
                        
                           2
                           By analogy to communications, where modulation refers to the process of encoding information over periodic waveforms.
                         any vector x (or pre-mapped descriptor φ(x)) with a function 
                           
                              m
                              :
                              
                                 R
                                 
                                    2
                                    N
                                    +
                                    1
                                 
                              
                              ×
                              
                                 R
                                 D
                              
                              →
                              
                                 R
                                 
                                    (
                                    2
                                    N
                                    +
                                    1
                                    )
                                    D
                                 
                              
                           
                        . Thanks to classical properties of the Kronecker product ⊗, we have

                           
                              (18)
                              
                                 
                                    
                                       
                                          
                                             m
                                             (
                                             x
                                             ,
                                             
                                                α
                                             
                                             (
                                             θ
                                             )
                                             )
                                          
                                       
                                       
                                          
                                             =
                                             x
                                             ⊗
                                             
                                                α
                                             
                                             (
                                             θ
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   (
                                                   
                                                      x
                                                      1
                                                   
                                                   
                                                      α
                                                   
                                                   
                                                      
                                                         (
                                                         θ
                                                         )
                                                      
                                                      ⊤
                                                   
                                                   ,
                                                   
                                                      x
                                                      2
                                                   
                                                   
                                                      α
                                                   
                                                   
                                                      
                                                         (
                                                         θ
                                                         )
                                                      
                                                      ⊤
                                                   
                                                   .
                                                   …
                                                   ,
                                                   
                                                      x
                                                      d
                                                   
                                                   
                                                      α
                                                   
                                                   
                                                      
                                                         (
                                                         θ
                                                         )
                                                      
                                                      ⊤
                                                   
                                                   )
                                                
                                                ⊤
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        We now consider two pairs of vectors and angle, (x, θx
                        ) and (y, θy
                        ), and their modulated descriptors m(x, α
                        (θx
                        )) and m(y, α
                        (θy
                        )), respectively. In the inner product space 
                           
                              
                                 R
                                 
                                    (
                                    2
                                    N
                                    +
                                    1
                                    )
                                    D
                                 
                              
                              ,
                           
                         the following holds:

                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             m
                                             
                                                
                                                   (
                                                   x
                                                   ,
                                                   
                                                      α
                                                   
                                                   
                                                      (
                                                      
                                                         θ
                                                         x
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                ⊤
                                             
                                             
                                                m
                                                (
                                                y
                                                ,
                                                
                                                   α
                                                
                                             
                                             
                                                (
                                                
                                                   θ
                                                   y
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   (
                                                   x
                                                   ⊗
                                                   
                                                      α
                                                   
                                                   
                                                      (
                                                      
                                                         θ
                                                         x
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                ⊤
                                             
                                             
                                                (
                                                y
                                                ⊗
                                                
                                                   α
                                                
                                                
                                                   (
                                                   
                                                      θ
                                                      y
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                (
                                                
                                                   x
                                                   ⊤
                                                
                                                ⊗
                                                
                                                   α
                                                
                                                
                                                   
                                                      (
                                                      
                                                         θ
                                                         x
                                                      
                                                      )
                                                   
                                                   ⊤
                                                
                                                )
                                             
                                             
                                                (
                                                y
                                                ⊗
                                                
                                                   α
                                                
                                                
                                                   (
                                                   
                                                      θ
                                                      y
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                (
                                                
                                                   x
                                                   ⊤
                                                
                                                y
                                                )
                                             
                                             ⊗
                                             
                                                (
                                                
                                                   α
                                                
                                                
                                                   
                                                      (
                                                      
                                                         θ
                                                         x
                                                      
                                                      )
                                                   
                                                   ⊤
                                                
                                                
                                                   α
                                                
                                                
                                                   (
                                                   
                                                      θ
                                                      y
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                (
                                                
                                                   x
                                                   ⊤
                                                
                                                y
                                                )
                                             
                                             
                                                k
                                                θ
                                             
                                             
                                                (
                                                
                                                   θ
                                                   x
                                                
                                                −
                                                
                                                   θ
                                                   y
                                                
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     


                        Fig. 3
                         shows the distribution of the similarities between regions of interest before and after modulation, as a function of the difference of angles. Interestingly, there is no obvious correlation between the difference of angle and the SIFT: the similarity distribution based on SIFT is similar for all angles. This suggests that the modulation with angle provides complementary information.

Consider any coding method φ that can be written as match kernel (Fisher, LLC, Bag-of-Words, VLAD, etc.). The match kernel in (7), with our kθ
                               approximation, is re-written as

                                 
                                    (20)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      K
                                                      ☆
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            X
                                                         
                                                         ☆
                                                      
                                                      ,
                                                      
                                                         
                                                            Y
                                                         
                                                         ☆
                                                      
                                                      )
                                                   
                                                   ∝
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     (
                                                                     x
                                                                     ,
                                                                     
                                                                        θ
                                                                        X
                                                                     
                                                                     )
                                                                  
                                                                  ∈
                                                                  
                                                                     
                                                                        X
                                                                     
                                                                     ☆
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     (
                                                                     y
                                                                     ,
                                                                     
                                                                        θ
                                                                        y
                                                                     
                                                                     )
                                                                  
                                                                  ∈
                                                                  
                                                                     
                                                                        Y
                                                                     
                                                                     ☆
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   m
                                                   
                                                      
                                                         (
                                                         φ
                                                         
                                                            (
                                                            x
                                                            )
                                                         
                                                         ,
                                                         
                                                            α
                                                         
                                                         
                                                            (
                                                            
                                                               θ
                                                               x
                                                            
                                                            )
                                                         
                                                         )
                                                      
                                                      ⊤
                                                   
                                                   m
                                                   
                                                      (
                                                      φ
                                                      
                                                         (
                                                         y
                                                         )
                                                      
                                                      ,
                                                      
                                                         α
                                                      
                                                      
                                                         (
                                                         
                                                            θ
                                                            y
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∝
                                             
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            (
                                                            x
                                                            ,
                                                            
                                                               θ
                                                               x
                                                            
                                                            )
                                                         
                                                      
                                                      m
                                                      
                                                         
                                                            (
                                                            φ
                                                            
                                                               (
                                                               x
                                                               )
                                                            
                                                            ,
                                                            
                                                               α
                                                            
                                                            
                                                               (
                                                               
                                                                  θ
                                                                  x
                                                               
                                                               )
                                                            
                                                            )
                                                         
                                                         ⊤
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                         
                                                            (
                                                            y
                                                            ,
                                                            
                                                               θ
                                                               y
                                                            
                                                            )
                                                         
                                                      
                                                      
                                                         m
                                                         (
                                                         φ
                                                         
                                                            (
                                                            y
                                                            )
                                                         
                                                         ,
                                                         
                                                            α
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            θ
                                                            y
                                                         
                                                         )
                                                      
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              where we observe that the image can be represented as the summation X
                              ⋆ of the embedded descriptors modulated by their corresponding dominant orientation, as

                                 
                                    (21)
                                    
                                       
                                          
                                             X
                                             ☆
                                          
                                          =
                                          β
                                          
                                             (
                                             
                                                
                                                   X
                                                
                                                ☆
                                             
                                             )
                                          
                                          
                                             ∑
                                             
                                                
                                                   (
                                                   x
                                                   ,
                                                   
                                                      θ
                                                      x
                                                   
                                                   )
                                                
                                                ∈
                                                
                                                   
                                                      X
                                                   
                                                   ☆
                                                
                                             
                                          
                                          m
                                          
                                             (
                                             φ
                                             
                                                (
                                                x
                                                )
                                             
                                             ,
                                             
                                                α
                                             
                                             
                                                (
                                                
                                                   θ
                                                   x
                                                
                                                )
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              This representation encodes the relative angles and is already more discriminative than an aggregation that does not consider them. However, at this stage, the comparison assumes that the images have the same global orientation. This is the case on benchmarks like Oxford5k building, where all images are orientated upright, but this is not true in general for particular object recognition.

So far our image representation is rotation covariant. Herein we propose how to achieve rotation invariance via efficient similarity computation for multiple image rotations. Up to now we have assumed that objects are aligned with respect to orientation or, more particularly, that objects are up-right. This implies that true corresponding patches should have similar orientation. We now describe how to produce a similarity score when the orientations of related images may be different. We represent the image vector X
                        ⋆ as the concatenation of 
                           
                              2
                              N
                              +
                              1
                           
                         
                        D-dimensional subvectors associated to one term of the finite Fourier series: 
                           
                              
                                 X
                                 ☆
                              
                              =
                              
                                 
                                    [
                                    
                                       
                                          
                                             X
                                             0
                                             ☆
                                          
                                       
                                       ⊤
                                    
                                    ,
                                    
                                       
                                          
                                             X
                                             
                                                1
                                                ,
                                                c
                                             
                                             ☆
                                          
                                       
                                       ⊤
                                    
                                    ,
                                    
                                       
                                          
                                             X
                                             
                                                1
                                                ,
                                                s
                                             
                                             ☆
                                          
                                       
                                       ⊤
                                    
                                    ,
                                    ⋯
                                    ,
                                    
                                       
                                          
                                             X
                                             
                                                N
                                                ,
                                                c
                                             
                                             ☆
                                          
                                       
                                       ⊤
                                    
                                    ,
                                    
                                       
                                          
                                             X
                                             
                                                N
                                                ,
                                                s
                                             
                                             ☆
                                          
                                       
                                       ⊤
                                    
                                    ]
                                 
                                 ⊤
                              
                           
                        . The vector 
                           
                              X
                              0
                              ☆
                           
                         is associated with the constant term in the Fourier expansion, 
                           
                              X
                              
                                 n
                                 ,
                                 c
                              
                              ☆
                           
                         and 
                           
                              
                                 X
                                 
                                    n
                                    ,
                                    s
                                 
                                 ☆
                              
                              ,
                           
                         1 ≤ n ≤ N, correspond to the cosine and sine terms, respectively.

Imagine now that this image undergoes a global rotation of angle θ. Denote 
                           
                              
                                 X
                                 ˘
                              
                              ☆
                           
                         the new set of pairs 
                           
                              (
                              x
                              ,
                              
                                 
                                    θ
                                    ˘
                                 
                                 x
                              
                              )
                           
                        . Since descriptor x is by nature rotation invariant, we obtain 
                           
                              
                                 X
                                 ˘
                              
                              ☆
                           
                         by simply shifting all dominant angles by θ, that is 
                           
                              
                                 
                                    θ
                                    ˘
                                 
                                 x
                              
                              =
                              
                                 θ
                                 x
                              
                              −
                              θ
                           
                        . Denote 
                           
                              
                                 
                                    X
                                    ˘
                                 
                              
                              ☆
                           
                         the new image vector derived from these local descriptors. It occurs that 
                           
                              
                                 
                                    
                                       X
                                       ˘
                                    
                                 
                                 0
                                 ☆
                              
                              =
                              
                                 
                                    X
                                 
                                 0
                                 ☆
                              
                           
                         because this term does not depend on the angle, and that, for a given frequency bin n, elementary trigonometry identities lead to

                           
                              (22)
                              
                                 
                                    
                                       
                                          
                                             X
                                             ˘
                                          
                                       
                                       
                                          n
                                          ,
                                          c
                                       
                                       ☆
                                    
                                    =
                                    
                                       
                                          X
                                       
                                       
                                          n
                                          ,
                                          c
                                       
                                       ☆
                                    
                                    cos
                                    n
                                    θ
                                    +
                                    
                                       
                                          X
                                       
                                       
                                          n
                                          ,
                                          s
                                       
                                       ☆
                                    
                                    sin
                                    n
                                    θ
                                 
                              
                           
                        
                        
                           
                              (23)
                              
                                 
                                    
                                       
                                          
                                             X
                                             ˘
                                          
                                       
                                       
                                          n
                                          ,
                                          s
                                       
                                       ☆
                                    
                                    =
                                    −
                                    
                                       
                                          X
                                       
                                       
                                          n
                                          ,
                                          c
                                       
                                       ☆
                                    
                                    sin
                                    n
                                    θ
                                    +
                                    
                                       
                                          X
                                       
                                       
                                          n
                                          ,
                                          s
                                       
                                       ☆
                                    
                                    cos
                                    n
                                    θ
                                    .
                                 
                              
                           
                        Therefore, we do not need to recompute the image representation of the rotated image. It is efficiently derived by component wise multiplications of the vector describing the original image. It also turns out that 
                           
                              
                                 ∥
                              
                              
                                 
                                    
                                       X
                                       ˘
                                    
                                 
                                 ☆
                              
                              
                                 ∥
                                 =
                                 ∥
                              
                              
                                 
                                    X
                                 
                                 ☆
                              
                              
                                 ∥
                                 ,
                              
                           
                         meaning that rotation has no effect on the global normalization factor 
                           
                              β
                              (
                              
                                 
                                    X
                                 
                                 ☆
                              
                              )
                           
                        .

When comparing two images with such vectors, the linearity of the inner product ensures that

                           
                              (24)
                              
                                 
                                    
                                       
                                          
                                             〈
                                             
                                                
                                                   
                                                      X
                                                      ˘
                                                   
                                                
                                                ☆
                                             
                                             |
                                             
                                                
                                                   Y
                                                
                                                ☆
                                             
                                             〉
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                〈
                                                
                                                   
                                                      X
                                                   
                                                   0
                                                   ☆
                                                
                                                |
                                                
                                                   
                                                      Y
                                                   
                                                   0
                                                   ☆
                                                
                                                〉
                                             
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             cos
                                             n
                                             θ
                                             
                                             
                                                (
                                                
                                                   〈
                                                   
                                                      X
                                                      
                                                         n
                                                         ,
                                                         c
                                                      
                                                      ☆
                                                   
                                                   |
                                                   
                                                      Y
                                                      
                                                         n
                                                         ,
                                                         c
                                                      
                                                      ☆
                                                   
                                                   〉
                                                
                                                +
                                                
                                                   〈
                                                   
                                                      X
                                                      
                                                         n
                                                         ,
                                                         s
                                                      
                                                      ☆
                                                   
                                                   |
                                                   
                                                      Y
                                                      
                                                         n
                                                         ,
                                                         s
                                                      
                                                      ☆
                                                   
                                                   〉
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             sin
                                             n
                                             θ
                                             
                                             
                                                (
                                                −
                                                
                                                   〈
                                                   
                                                      X
                                                      
                                                         n
                                                         ,
                                                         c
                                                      
                                                      ☆
                                                   
                                                   |
                                                   
                                                      Y
                                                      
                                                         n
                                                         ,
                                                         s
                                                      
                                                      ☆
                                                   
                                                   〉
                                                
                                                +
                                                
                                                   〈
                                                   
                                                      X
                                                      
                                                         n
                                                         ,
                                                         s
                                                      
                                                      ☆
                                                   
                                                   |
                                                   
                                                      Y
                                                      
                                                         n
                                                         ,
                                                         c
                                                      
                                                      ☆
                                                   
                                                   〉
                                                
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Here, we stress that the similarity between two images is a real trigonometric polynomial in θ (image rotation angle) of degree N. Its 
                           
                              2
                              N
                              +
                              1
                           
                         components are fully determined by computing 
                           
                              〈
                              
                                 X
                                 0
                                 ☆
                              
                              |
                              
                                 Y
                                 0
                                 ☆
                              
                              〉
                           
                         and the inner products between the subvectors associated with each frequency, i.e., 
                           
                              〈
                              
                                 X
                                 
                                    n
                                    ,
                                    c
                                 
                                 ☆
                              
                              |
                              
                                 Y
                                 
                                    n
                                    ,
                                    c
                                 
                                 ☆
                              
                              〉
                              ,
                           
                        
                        
                           
                              〈
                              
                                 X
                                 
                                    n
                                    ,
                                    s
                                 
                                 ☆
                              
                              |
                              
                                 Y
                                 
                                    n
                                    ,
                                    s
                                 
                                 ☆
                              
                              〉
                              ,
                           
                        
                        
                           
                              〈
                              
                                 X
                                 
                                    n
                                    ,
                                    c
                                 
                                 ☆
                              
                              |
                              
                                 Y
                                 
                                    n
                                    ,
                                    s
                                 
                                 ☆
                              
                              〉
                           
                         and 
                           
                              〈
                              
                                 X
                                 
                                    n
                                    ,
                                    s
                                 
                                 ☆
                              
                              |
                              
                                 Y
                                 
                                    n
                                    ,
                                    c
                                 
                                 ☆
                              
                              〉
                           
                        . Finding the maximum of this polynomial amounts to finding the rotation maximizing the image similarity.

Computing the coefficients of this polynomial requires a total of 
                           
                              D
                              ×
                              (
                              1
                              +
                              4
                              N
                              )
                           
                         elementary operations for a vector representation of dimensionality 
                           
                              D
                              ×
                              (
                              1
                              +
                              2
                              N
                              )
                              ,
                           
                         that is, less than twice the cost of the inner product between X
                        ⋆ and Y
                        ⋆. Once these components are obtained, the cost of finding the maximum value achieved by this polynomial is negligible for large values of D, for instance by simply sampling a few values of θ. Therefore, if we offer the orientation invariant property, the complexity of similarity computation is typically twice the cost of that of a regular vector representation (whose complexity is equal to the number of dimensions).

Our trigonometric polynomial of similarity scores can be rewritten as

                           
                              (25)
                              
                                 
                                    
                                       K
                                       ☆
                                    
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          ☆
                                       
                                       ,
                                       
                                          
                                             Y
                                          
                                          ☆
                                       
                                       ,
                                       θ
                                       )
                                    
                                    =
                                    c
                                    +
                                    
                                       ∑
                                       
                                          n
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       a
                                       n
                                    
                                    cos
                                    n
                                    θ
                                    +
                                    
                                       ∑
                                       
                                          n
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       b
                                       n
                                    
                                    sin
                                    n
                                    θ
                                    ,
                                 
                              
                           
                        with coefficients c, an, bn
                         given by (24). Note that in our experiment it turns out that retrieval performance already saturates at 
                           
                              N
                              =
                              3
                           
                        .

This strategy for computing the scores for all possible orientations of the query is not directly compatible with non-linear post-processing of X
                        ⋆ such as component-wise power-law normalization [40], except for the subvector 
                           
                              X
                              0
                              ☆
                           
                        . We adapt the power-law normalization to become compatible with our strategy: we compute the modulus of the complex number represented by two components (sin  and cos ) associated with the same frequency n and the same original component in φ(x). These two components are then divided by the square-root (or any power) of this modulus.

In detail, let 
                           
                              X
                              
                                 n
                                 ,
                                 c
                                 ,
                                 i
                              
                              ☆
                           
                         and 
                           
                              X
                              
                                 n
                                 ,
                                 s
                                 ,
                                 i
                              
                              ☆
                           
                         be the ith component of subvectors 
                           
                              X
                              
                                 n
                                 ,
                                 c
                              
                              ☆
                           
                         and 
                           
                              
                                 X
                                 
                                    n
                                    ,
                                    s
                                 
                                 ☆
                              
                              ,
                           
                         respectively. The modified scheme considers the modulus of those components. The power-law normalized version of the former turns out to be equal to 
                           
                              
                                 
                                    X
                                    
                                       n
                                       ,
                                       c
                                       ,
                                       i
                                    
                                    ☆
                                 
                                 
                                    
                                       (
                                       
                                          
                                             
                                                X
                                                ☆
                                             
                                          
                                          
                                             n
                                             ,
                                             c
                                             ,
                                             i
                                          
                                          2
                                       
                                       +
                                       
                                          
                                             
                                                X
                                                ☆
                                             
                                          
                                          
                                             n
                                             ,
                                             s
                                             ,
                                             i
                                          
                                          2
                                       
                                       )
                                    
                                    
                                       
                                          1
                                          −
                                          l
                                       
                                       2
                                    
                                 
                              
                              ,
                           
                         where l ∈ [0, 1] is the power-law exponent. The counterpart sine component is obtained similarly, and now the representation of the rotated image is factorized equivalently to (22) and (23).

In our experiments we reduce the dimensionality of the modulated image vector by PCA, as typically done with aggregated representations. It is then not possible to use the efficient polynomial of scores. In this case, we follow the naive strategy, which is to compute the query representation for several hypotheses of angle rotation, typically 8. In theory, this multiplies the query complexity by the same factor 8. However, in practice, it is faster to perform the matrix–matrix multiplication, with the right matrix representing 8 queries, than computing separately the corresponding 8 matrix–vector multiplications. In our former work [24], the naive approach was used in all cases, while now we explore the proposed polynomial on the full vectors.


                        Fig. 4
                         presents the evaluation of (25) for a pair of images. More frequencies improve the approximation. However, maximum similarity value is observed at a similar point in all cases.

Following the objective of jointly encoding local description and geometry, we now deal with the location of local features. We assume that an image is represented by a set 
                           
                              
                                 X
                              
                              ⋄
                           
                         of triples of the form (x, ux, vx
                        ). Local descriptor x is now accompanied by position coordinates ux
                         and vx
                        .

Depending on the use-case and on the desired invariance, ux
                         and vx
                         can be cartesian or polar coordinates. Whatever the coordinate system is, our position encoding is performed in a continuous manner, unlike SPM [19] and visual phrases 
                        [41], where positions, respectively position differences, are quantized to a uniform grid. In the following we consider cartesian coordinates.

We employ once more the angular embedding proposed in Section 4.1, by mapping a spatial coordinate to an angle. The kernel function kθ
                         defined for angles is periodic, while the spatial coordinates of a local feature are not. Mapping positions directly to 
                           
                              [
                              −
                              π
                              ,
                              π
                              ]
                           
                         would practically convert the position domain into a torus. In such a case, patches located at opposite edges of the image would be considered close to each other. We simply handle this by mapping to 
                           
                              [
                              −
                              π
                              /
                              2
                              ,
                              π
                              /
                              2
                              ]
                           
                        . Still, when employing multiple translations this undesired effect emerges, but it does not seem to harm the effectiveness of the method in our experiments. Therefore, we convert the position coordinates to angles by

                           
                              (26)
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                                ^
                                             
                                             =
                                             
                                                
                                                   u
                                                   −
                                                   
                                                      h
                                                      2
                                                   
                                                
                                                
                                                   max
                                                   {
                                                   h
                                                   ,
                                                   w
                                                   }
                                                
                                             
                                             
                                             π
                                             ,
                                             
                                             
                                                v
                                                ^
                                             
                                             =
                                             
                                                
                                                   v
                                                   −
                                                   
                                                      w
                                                      2
                                                   
                                                
                                                
                                                   max
                                                   {
                                                   h
                                                   ,
                                                   w
                                                   }
                                                
                                             
                                             
                                             π
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where h and w are the height and width of the image, respectively.

We now employ the procedure of Section 4. We map local coordinates ux
                         and vx
                         to 
                           
                              
                                 α
                              
                              (
                              
                                 
                                    u
                                    ^
                                 
                                 x
                              
                              )
                           
                         and 
                           
                              
                                 α
                              
                              (
                              
                                 
                                    v
                                    ^
                                 
                                 x
                              
                              )
                              ,
                           
                         respectively. Then, each one of them can be encoded jointly with descriptor x by 
                           
                              m
                              (
                              x
                              ,
                              
                                 α
                              
                              
                                 (
                                 
                                    
                                       u
                                       ^
                                    
                                    x
                                 
                                 )
                              
                              )
                           
                         and 
                           
                              m
                              (
                              x
                              ,
                              
                                 α
                              
                              
                                 (
                                 
                                    
                                       v
                                       ^
                                    
                                    x
                                 
                                 )
                              
                              )
                           
                        . We obtain two new match kernels 
                           
                              
                                 K
                                 u
                              
                              
                                 (
                                 
                                    
                                       X
                                    
                                    ⋄
                                 
                                 ,
                                 
                                    
                                       Y
                                    
                                    ⋄
                                 
                                 )
                              
                           
                         and 
                           
                              
                                 K
                                 v
                              
                              
                                 (
                                 
                                    
                                       X
                                    
                                    ⋄
                                 
                                 ,
                                 
                                    
                                       Y
                                    
                                    ⋄
                                 
                                 )
                              
                              ,
                           
                         down-weighting or up-weighting matches by the consistency of their u or v coordinate, respectively.

We are not limited to modulation only by u or v (single modulation), we can further encode both coordinates by a double modulation. This is achieved by modulating descriptor x by both 
                           
                              
                                 α
                              
                              (
                              
                                 
                                    u
                                    ^
                                 
                                 x
                              
                              )
                           
                         and 
                           
                              
                                 α
                              
                              (
                              
                                 
                                    v
                                    ^
                                 
                                 x
                              
                              )
                           
                         with a function 
                           
                              
                                 m
                                 
                                    u
                                    ,
                                    v
                                 
                              
                              :
                              
                                 R
                                 
                                    2
                                    N
                                    +
                                    1
                                 
                              
                              ×
                              
                                 R
                                 
                                    2
                                    N
                                    +
                                    1
                                 
                              
                              ×
                              
                                 R
                                 D
                              
                              →
                              
                                 R
                                 
                                    
                                       
                                          (
                                          2
                                          N
                                          +
                                          1
                                          )
                                       
                                       2
                                    
                                    D
                                 
                              
                              ,
                           
                         where

                           
                              (27)
                              
                                 
                                    
                                       m
                                       
                                          u
                                          ,
                                          v
                                       
                                    
                                    
                                       (
                                       x
                                       ,
                                       
                                          α
                                       
                                       
                                          (
                                          
                                             
                                                u
                                                ^
                                             
                                             x
                                          
                                          )
                                       
                                       ,
                                       
                                          α
                                       
                                       
                                          (
                                          
                                             
                                                v
                                                ^
                                             
                                             x
                                          
                                          )
                                       
                                       )
                                    
                                    =
                                    x
                                    ⊗
                                    
                                       α
                                    
                                    
                                       (
                                       
                                          
                                             u
                                             ^
                                          
                                          x
                                       
                                       )
                                    
                                    ⊗
                                    
                                       α
                                    
                                    
                                       (
                                       
                                          
                                             v
                                             ^
                                          
                                          x
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

The match kernel for two sets of local descriptors can be then written as

                           
                              (28)
                              
                                 
                                    
                                       
                                          
                                             
                                                K
                                                
                                                   u
                                                   ,
                                                   v
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      X
                                                   
                                                   ⋄
                                                
                                                ,
                                                
                                                   
                                                      Y
                                                   
                                                   ⋄
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             ∝
                                             
                                                ∑
                                                
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               x
                                                               ,
                                                               
                                                                  u
                                                                  x
                                                               
                                                               ,
                                                               
                                                                  v
                                                                  x
                                                               
                                                               )
                                                            
                                                            ∈
                                                            
                                                               
                                                                  X
                                                               
                                                               ⋄
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               y
                                                               ,
                                                               
                                                                  u
                                                                  y
                                                               
                                                               ,
                                                               
                                                                  v
                                                                  y
                                                               
                                                               )
                                                            
                                                            ∈
                                                            
                                                               
                                                                  Y
                                                               
                                                               ⋄
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             k
                                             
                                                (
                                                x
                                                ,
                                                y
                                                )
                                             
                                             
                                                k
                                                θ
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   x
                                                
                                                ,
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   y
                                                
                                                )
                                             
                                             
                                                k
                                                θ
                                             
                                             
                                                (
                                                
                                                   
                                                      v
                                                      ^
                                                   
                                                   x
                                                
                                                ,
                                                
                                                   
                                                      v
                                                      ^
                                                   
                                                   y
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ∝
                                             〈
                                             
                                                X
                                                ⋄
                                             
                                             |
                                             
                                                Y
                                                ⋄
                                             
                                             〉
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where each image is represented by vector X
                        ⋄. This is the vector of aggregated double modulated local descriptors

                           
                              (29)
                              
                                 
                                    
                                       X
                                       ⋄
                                    
                                    =
                                    β
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          ⋄
                                       
                                       )
                                    
                                    
                                       ∑
                                       
                                          
                                             (
                                             x
                                             ,
                                             
                                                u
                                                x
                                             
                                             ,
                                             
                                                v
                                                x
                                             
                                             )
                                          
                                          ∈
                                          
                                             
                                                X
                                             
                                             ⋄
                                          
                                       
                                    
                                    
                                       m
                                       
                                          u
                                          ,
                                          v
                                       
                                    
                                    
                                       (
                                       x
                                       ,
                                       
                                          α
                                       
                                       
                                          (
                                          
                                             
                                                u
                                                ^
                                             
                                             x
                                          
                                          )
                                       
                                       ,
                                       
                                          α
                                       
                                       
                                          (
                                          
                                             
                                                v
                                                ^
                                             
                                             x
                                          
                                          )
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     


                        Fig. 5 illustrates the function 
                           
                              
                                 k
                                 VM
                              
                              
                                 (
                                 Δ
                                 
                                    u
                                    ^
                                 
                                 )
                              
                              ×
                              
                                 
                                    k
                                    VM
                                 
                                 
                                    (
                                    Δ
                                    
                                       v
                                       ^
                                    
                                    )
                                 
                              
                           
                         along with it approximation for 2 and 3 frequencies. We want a “selective” kernel function in order to weight up pairs of similar patches placed at similar locations. The double modulation increases dimensionality too fast with respect to the number of frequencies. As a trade-off between selectivity and the number of components we set κ=8 and N=2. In this case, coordinates (u, v) are mapped to a 25 dimensional vector.

We have assumed, up to now, that objects are aligned. Next, we follow the same approach proposed for dominant orientation, in order to offer translation invariance. Note that rotation and scale invariance are lost in this case, but there is some tolerance introduced by the continuous encoding and by the employed similarity function.

In the case of single modulation of u or v, we are able to efficiently evaluate for multiple 1D translations with the same trigonometric polynomial introduced before (25). Detecting maximum similarity aligns objects with respect to u or v, independently. An example is shown in Fig. 6
                        . Another choice is to maximize independently and to keep best alignment of both. This is achieved by simply keeping the maximum similarity score of the two.

One step further, we allow for 2D translation along with the double modulation by u and v. Factorization similar to that of (22)–(23) is still possible, resulting into another trigonometric polynomial for efficient 2D translation

                           
                              (30)
                              
                                 
                                    
                                       
                                          
                                             
                                                K
                                                
                                                   u
                                                   ,
                                                   v
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      X
                                                   
                                                   ⋄
                                                
                                                ,
                                                
                                                   
                                                      Y
                                                   
                                                   ⋄
                                                
                                                ,
                                                
                                                   u
                                                   ^
                                                
                                                ,
                                                
                                                   v
                                                   ^
                                                
                                                )
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                a
                                                0
                                             
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                a
                                                n
                                                1
                                             
                                             cos
                                             n
                                             
                                                u
                                                ^
                                             
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                a
                                                n
                                                2
                                             
                                             sin
                                             n
                                             
                                                u
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                a
                                                t
                                                3
                                             
                                             cos
                                             t
                                             
                                                v
                                                ^
                                             
                                             +
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                a
                                                t
                                                4
                                             
                                             sin
                                             t
                                             
                                                v
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                a
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                5
                                             
                                             cos
                                             n
                                             
                                                u
                                                ^
                                             
                                             cos
                                             t
                                             
                                                v
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                a
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                6
                                             
                                             cos
                                             n
                                             
                                                u
                                                ^
                                             
                                             sin
                                             t
                                             
                                                v
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                a
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                7
                                             
                                             sin
                                             n
                                             
                                                u
                                                ^
                                             
                                             cos
                                             t
                                             
                                                v
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   n
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                a
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                8
                                             
                                             sin
                                             n
                                             
                                                u
                                                ^
                                             
                                             sin
                                             t
                                             
                                                v
                                                ^
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The image translation is denoted by 
                           
                              (
                              
                                 u
                                 ^
                              
                              ,
                              
                                 v
                                 ^
                              
                              )
                           
                        . Coefficients 
                           
                              
                                 a
                                 0
                              
                              …
                              
                                 a
                                 8
                              
                           
                         are given by inner products of particular sub-vectors of the two image representation vectors. We skip the details which are in analogy to those of (24).

Its computational cost is, once more, very small comparing to performing the translations in a naive way. Compatibility with power-law normalization is achieved in a similar fashion to that of Section 4, but with groups of 4 components in this case.

Our achievement of fast similarity computation for multiple translations resembles the work of Henriques et al. [42] who speed-up learning with multiple shifted versions of negative samples. They do this instead of performing costly sliding window based hard negative mining. In our case, we obtain the translated models through latent variables, i.e. translation on a given direction, parameterizing a trigonometric polynomial of similarity scores.

@&#EXPERIMENTS@&#

We evaluate the performance of the proposed approaches and compare with state-of-the-art methods on two publicly available datasets for image and particular object retrieval, namely Inria Holidays [25] and Oxford Buildings 5k [5]. We also combine the latter with 100k distractor images to measure the performance on a larger scale. The merged dataset is referred to as Oxford105k. Performance is measured with mean Average Precision (mAP) [5].

We further employ the rotated Holidays dataset [43], with images rotated to their natural orientation, in order to evaluate our position covariant kernels. This is necessary since this method is not rotation invariant. It is therefore not applicable when object rotations exist. Note that the rotation covariant kernel does not have such limitations. We refer to the upright oriented Holidays dataset as Holidays∧.

Our approach modulates any coding/pooling technique operating as a match kernel. Therefore, we evaluate the benefit of our approach combined with several coding techniques, namely

                                 
                                    •
                                    VLAD [15], which encodes a SIFT descriptor by considering the residual vector to the centroid.

The Fisher vector [14,40,44]. For image classification, Chatfield et al. [45] show that it outperforms concurrent coding techniques, in particular LLC [13]. We adopt the standard choice for image retrieval and use only the gradient with respect to the mean [15].

Monomomial embeddings of order 2 and 3 applied on local descriptors (see below for pre-processing), i.e., the functions φ2 in (5) and φ3 in (6). For the sake of consistency, we also denote by φ1 the function φ1: x → x.

We refer to these methods combined with single modulation with the symbol “⊗”: VLAD⊗, Fisher⊗, φ1⊗, φ2⊗ and φ3⊗ for the angle modulation. Single position modulations are denoted by VLAD⊗
                                 u
                               and VLAD⊗
                                 v
                               and double modulation by VLAD⊗
                                 u, v
                              . The particular case for which we independently encode u and v and keep the maximum score of both is referred as VLAD⊗
                                 u/v
                              . The same notation is followed for the Fisher and monomial embeddings.

In addition, we compare against the most related work, namely the recent CVLAD [22] method, which also aims at producing an image vector representation integrating the dominant orientations of the patches. Whenever the prior work is not referenced, results are produced using our own implementations of VLAD, Fisher and CVLAD, so that the results are directly comparable with the same features.

@&#IMPLEMENTATION DETAILS@&#

We use the Hessian-Affine detector [46] to extract the regions of interest, that are subsequently described by SIFT descriptors [1] post-processed with RootSIFT [47]. Then, we apply PCA and the resulting vector is subsequently ℓ2-normalized. Following the typical procedure for the Fisher vector [14,15,40], when applying PCA we reduce the vector to 80 components. The same stands for monomial embeddings. An exception is done for VLAD and CVLAD with which we only use the PCA basis to center and rotate descriptors as suggested by Delhumeau [48], without dimensionality reduction.

The optimized Hessian-Affine detector of Perdoch et al. [43] improves the retrieval performance. However, it is not compatible with our angular encoding (rotation covariant kernel) by discarding rotations and enforcing the gravity vector assumption (up-right features). For the needs of the angular modulation we use the original Hessian-Affine detector [46], but modify it so that it has similar parameters (enlarged measurement region by a factor of 2) and use a lower detector threshold. In addition, we use the detector of Perdoch et al. [43] for evaluating the position encoding. The translation covariant kernel can benefit from the advantages of up-right features when all depicted objects are aligned with respect to rotation. The use of the latter is explicitly stated in each case.

For all methods based on codebooks, we only consider distinct datasets for learning. More precisely and following common practice, the k-means and GMM (for VLAD and Fisher, respectively) are learned on Flickr60k for Inria Holidays and Paris6k [49] for Oxford buildings. We rely on the Yael library [50] for codebook construction and VLAD and Fisher encoding.

The final image vector obtained by each method is power-law normalized [11,15,40]. This processing improves the performance by efficiently handling the burstiness phenomenon. Exploiting the dominant orientation in our covariant match kernel provides a complementary way to further handle the same problem. We mention that using the dominant orientation is shown effective in a recent work by Torii et al. [51]. This post-processing, when applied to the modulated vectors, inherently captures and down weights patches with similar orientation or position.

In addition to power-law normalization, we rotate the aggregated vector representation with a learned PCA rotation matrix [52,53]. This aims at capturing the co-occurrences to down-weight them either by whitening [52] or a second power-law normalization [53]. We adopt the latter choice (with exponent 0.5) to avoid the sensitivity to eigenvalues (in whitening) when learning PCA with a few input data. We refer to this Rotation and Normalization [54] as RN.

Optionally, to produce compact representations, we keep only the first few components (the most energetic ones) and ℓ2-normalize the shortened vector.

In order to obtain rotation invariance jointly with power-law normalization we exploit the trigonometric polynomial presented in Section 4, along with our modified scheme for power-law normalization. Image similarity is evaluated for multiple query image rotations.

Since the aforementioned technique is not compatible with RN or dimensionality reduction, in that case, we follow the naive approach and apply rotations of the query image and perform individual queries.

We apply 8 query rotations on Holidays dataset. On Oxford5k, we rather adopt the common choice of not considering other possible orientations, since images are up-right.

Our methods for position encoding are evaluated on the upright Holidays∧ dataset. On Oxford5k we follow the standard protocol and use the cropped queries. However, we also consider the position of the bonding box in the image as known, in order to properly normalize the patch coordinates.

Once more, we use the trigonometric polynomial for computation of the image similarity score. In the case of 1D translations, we evaluate 25 possible translations on each direction and a step of 10 pixels, that is 
                                 
                                    1
                                    +
                                    25
                                    ×
                                    2
                                 
                               translations in total. While for 2D translations, we evaluate 20 translations per direction leading to a total of 
                                 
                                    
                                       (
                                       20
                                       +
                                       20
                                       +
                                       1
                                       )
                                    
                                    2
                                 
                               translations. The chosen step is also set to 10 pixels.

In Fig. 7 we present performance for power-law normalization of different exponents. The non-modulated representations appear to have optimal performance around 
                           
                              l
                              =
                              0.2
                              ,
                           
                         which is in accordance with previous results [48] in the case that the local descriptors are rotated with PCA. The behavior is different for the modulated vectors, where optimal performance appears for 
                           
                              l
                              =
                              0
                           
                        . Note that in contrast to the standard power-law normalization scheme, the modified scheme proposed in Section 4.3 does not produce binary vectors for such a choice.

In the rest of our experiments we adopt an exponent equal to 0 and 0.2 for the modulated and non-modulated vectors correspondingly. Such choices are not optimal while learning the PCA rotation matrix for RN or for dimensionality reduction, where we apply square-rooting. Any difference observed in the reported performance compared to our previous work [24] is attributed to an optimal power-law value used in this work and to the modified power-law normalization scheme.

The impact of the angle modulation is controlled by the function kθ
                         parametrized by κ and N. As shown in Fig. 2, the value κ typically controls the “bandwidth”, i.e., the range of Δθ values with non-zero response. The parameter N controls the quality of the approximation, and implicitly constrains the achievable bandwidth. It also determines the dimensionality of the output vector.


                        Fig. 8
                         shows the impact of the selectivity of the kernel signature on the performance. As to be expected, there is a trade-off between defining too narrow or too large. The optimal performance is achieved with κ in the range [2, 8].


                        Fig. 9
                         shows the performance for increasing number of frequencies, which rapidly converges to a fixed mAP. This is the mAP of the exact evaluation of (7). We set 
                           
                              N
                              =
                              3
                           
                         as a compromise between dimensionality expansion and performance. Therefore the modulation multiplies the input dimensionality by 7.


                        Table 1
                         shows the benefit of modulation when applied to the monomial embeddings φ1, φ2 and φ3. The results are on par with the recent coding techniques like VLAD or Fisher improved with modulation. We consider the obtained performance as one of our main achievements, because the representation is codebook-free and requires no learning. In addition, we further show the benefit of combining monomial embeddings with RN. This significantly boosts performance with the same vector dimensionality and negligible computational overhead.

To demonstrate the benefit of the proposed method, we compare VLAD, Fisher and monomial embeddings to their modulated counterparts. Fig. 10
                         shows that modulation significantly improves the performance for the same codebook size. Given that the modulated vector is 7 times larger (with 
                           
                              N
                              =
                              3
                           
                        ), the comparison focuses on the performance obtained with the same dimensionality. Even in this case, modulated VLAD⊗ and Fisher⊗ offer a significant improvement. We can conclude that it is better to increase the dimensionality by modulation than using a larger codebook.

We compare our approach, in particular, to CVLAD, as this work also intends to integrate the dominant orientation into a vector representation. We consistently apply 8 query rotations for both CVLAD and our method on Holidays dataset. Fig. 11
                         shows the respective performance measured for different codebooks. The proposed methods appear to consistently outperform CVLAD, both for the same codebook and for the same dimensionality. Noticeably, the modulated embedded monomial φ2⊗ is on par with or better than CVLAD.

We also compare to other prior works and present results in Table 2
                         for Holidays, Oxford5k and Oxford105k. We outperform by a large margin the state of the art with full vector representations. Further, our approach is arguably compatible with these concurrent approaches, which may bring further improvement. Note that RN also boosts performance for VLAD and Fisher. In particular with a codebook of size 32, they achieve 50.4 and 49.8 respectively on Oxford5k. Our scores on Holidays with Fisher⊗ and RN are also competitive to those reported by state-of-the-art methods based on large codebooks [12]. To our knowledge, this is the first time that a vector representation compatible with inner product attains such image search performance.

On Oxford5k and Oxford105k we do not evaluate multiple query rotations for our method. A simple way to enforce up-right objects for our baseline methods is to use up-right features. Performance on Oxford5k achieved by VLAD with codebook of size 256 and with up-right features of the same detector is 53.4, while the corresponding score with rotation invariant features is 52.4. Even though switching off rotation when all objects are aligned seems to slightly increase performance, our method appears to be more effective (VLAD⊗ achieves 56.2 with a codebook of size 32). Moreover, note that up-right features are not applicable when object rotation exists, while our rotation covariant match kernel is.


                        Table 3
                         reports the performance after dimensionality reduction to 128 or 1024 components. The same set of local features and codebooks are used for all methods. We observe a consistent improvement over the original encoding.

The selectivity parameter κ is set equal to 8, similarly to the case of dominant orientation. We evaluate the influence of multiple translations applied to the query image in order to identify the best alignment. In Fig. 12
                         we present the impact of the translation on the performance. Performance improves as we evaluate multiple translations and saturates around 250 pixels. In the rest of our experiments we set the maximum translation value to 250 pixels.

Interestingly, on Holidays∧ the vertical coordinate is significantly more informative than the horizontal one. This might be due to the nature of this dataset; images depicting the same landmark have been shot by the same person. Therefore, the objects/scenes have been photographed roughly at the same height, but with horizontal slides in a panoramic manner. On Oxford5k this is not the case.

We evaluate the position encoding for single and double modulation for comparable dimensionality (approximately 30K). The performance increases by taking into account more translations for both methods. Single modulation performs better than the double counterpart for the given dimensionality. The increase of dimensionality for the latter is high, but it uses a much smaller codebook.

In Table 4
                         we show results for the baseline VLAD, and Fisher vector, and their modulated counterparts with respect to position. By considering 2 instead of 3 frequencies the dimensionality of the modulated descriptor is reduced by 30% with just a small loss (1–2%). We note that, once more, comparing to the baseline the advantage relies on the fact that the visual codebook is smaller and the assignment to that is faster to compute. Recall that now scale invariance is lost, leading to lower performance on Oxford5k. In the case of scale changes the dominant orientation is more distinctive and reliable. Overall, the orientation information brings higher improvement compared to the spatial one.

In order to provide a direct comparison between the two proposed methods we evaluate the translation covariant match kernel on Oxford5k and with the same features as those of the experiments reported in Table 2. VLAD⊗
                           u
                         and VLAD⊗
                           v
                         achieve 47.1 and 50.1 respectively by computing similarity for 25 translations on each direction with a codebook of size 32. Concerning the position modulated Fisher vectors the corresponding scores are 43.0 and 45.7. It appears that encoding rotation is more effective for this use-case. However, the translation covariant match kernel opens other possible directions, such as application on image classification, as a continuous alternative to spatial pyramid match.

The image representation created by modulating the monomial embedding φ2 using 
                           
                              N
                              =
                              3
                           
                         takes on average 68 ms for a typical image with 3000 SIFT descriptors. The resulting aggregated vector representation has 22,680 components. The average query time with such a representation on Holidays is 5.8 ms, assuming no query rotation. Employing the trigonometric polynomial of scores results in 5.9 ms (6.1 ms) for 8 (64) possible fixed rotations. The corresponding timings for Oxford105k and vectors reduced to 128 dimensions are 55 ms (no rotations) and 134 ms (8 fixed rotations). In the case of reduced vectors, the query rotations are computed with the naive way. Note, these timings are better than those achieved by a Bag-of-Words representation with a large vocabulary, for which the quantization typically takes about 1 s with an approximate nearest neighbor search algorithm like FLANN [55]. Our timings are measured with a single threaded implementation on an Intel Xeon E5-4640@2.40 GHz.

@&#CONCLUSION@&#

Our modulation strategy integrates geometric information directly in the coding stage. Dominant orientation of local features or their position is jointly encoded with the local descriptor, in a continuous manner. Our method is inspired by and builds upon recent works on explicit feature maps and kernel descriptors. Thanks to a generic formulation provided by match kernels, it is compatible with coding strategies such as Fisher vector or VLAD.

Invariance is offered by estimating maximum similarity for multiple image rotations or translations. The nature of our representation enables this very efficiently with a simple trigonometric polynomial. Our context (datasets) simply demands just a few sampling points on the rotation or translation domain. However, note that our methodology provides high efficiency even for denser search.

Our experiments demonstrate a consistent gain compared to the original coding in all cases. Angular modulation appears to be more promising than that of position for the task that we examine. Interestingly, our method is also very effective with a simple monomial kernel, offering competitive performance for image search with a coding stage not requiring any quantization.

Whatever the coding stage that we use with our approach, the resulting representation is compared with inner product, which suggests that it is compliant with linear classifiers such as those considered in image classification.

@&#ACKNOWLEDGMENTS@&#

This work was supported by ERC grant VIAMASS No. 336054 and ANR project Fire-ID.

@&#REFERENCES@&#

