@&#MAIN-TITLE@&#Random sampling: Billiard Walk algorithm

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           New sampling algorithm giving fast convergence to uniform distribution is proposed.


                        
                        
                           
                           We extend billiard trajectories with random change of directions.


                        
                        
                           
                           Performance is tested in comparison with Hit-and-Run algorithm.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Sampling

Monte-Carlo

Hit-and-Run

Billiards

@&#ABSTRACT@&#


               
               
                  Hit-and-Run is known to be one of the best random sampling algorithms, its mixing time is polynomial in dimension. However in practice, the number of steps required to obtain uniformly distributed samples is rather high. We propose a new random walk algorithm based on billiard trajectories. Numerical experiments demonstrate much faster convergence to the uniform distribution.
               
            

@&#INTRODUCTION@&#

Generating points uniformly distributed in an arbitrary bounded region 
                        
                           Q
                           ⊂
                           
                              
                                 R
                              
                              
                                 n
                              
                           
                        
                      finds applications in many computational problems (Tempo, Calafiore, & Dabbene, 2004; Rubinstein & Kroese, 2008).

Straightforward sampling techniques are usually based on one of the three approaches: rejection, transformation, and composition. In the rejection approach, the region of interest Q is embedded into a region with available uniform sampler B (usually a box or a ball). At the next step, samples that do not belong to Q are rejected. Assume Q is the unit ball, and the bounding region B is the box 
                        
                           
                              
                                 [
                                 -
                                 1
                                 ,
                                 1
                                 ]
                              
                              
                                 n
                              
                           
                        
                     . Then for 
                        
                           n
                           =
                           2
                           k
                        
                     , the ratio of the volumes of the box and the ball is equal to 
                        
                           q
                           =
                           
                              
                                 Vol
                                 (
                                 Q
                                 )
                              
                              
                                 Vol
                                 (
                                 B
                                 )
                              
                           
                           =
                           
                              
                                 
                                    
                                       π
                                    
                                    
                                       k
                                    
                                 
                              
                              
                                 k
                                 !
                                 
                                    
                                       2
                                    
                                    
                                       k
                                    
                                 
                              
                           
                        
                     , thus 
                        
                           q
                           ≈
                           
                              
                                 10
                              
                              
                                 -
                                 8
                              
                           
                        
                      for 
                        
                           n
                           =
                           20
                        
                     , so that one has to generate 
                        
                           ∼
                           
                              
                                 10
                              
                              
                                 8
                              
                           
                        
                      samples to obtain just a few of them in Q. For polytopes this ratio can be much smaller. Another way to exploit pseudo-random number generator for a simple region B is to map B onto Q via a smooth deterministic function with constant Jacobian. For instance, to obtain uniform samples in 
                        
                           Q
                           =
                           {
                           x
                           :
                           
                              
                                 x
                              
                              
                                 T
                              
                           
                           Ax
                           <
                           1
                           }
                        
                     , A being a positive definite matrix, it suffices to generate samples y uniformly in the unit ball 
                        
                           |
                           |
                           y
                           |
                           
                              
                                 |
                              
                              
                                 2
                              
                           
                           <
                           1
                        
                      and transform them as 
                        
                           x
                           =
                           
                              
                                 A
                              
                              
                                 -
                                 1
                                 /
                                 2
                              
                           
                           y
                        
                     . Unfortunately, such a transformation exists just for a limited class of regions. In the composition approach, the set Q is partitioned into a finite number of sets that can be efficiently sampled. For instance, a polytope can be partitioned into simplices, but the large number of them makes the procedure computationally hard.

Other sampling procedures use modern versions of the Monte Carlo technique based on the Markov Chain Monte Carlo (MCMC) approach (Gilks, Richardson, & Spiegelhalter, 1996; Diaconis, 2009). For instance, efficient algorithms for computing volumes using random walks can be found in Dyer, Frieze, and Kannan (1991), Lovasz and Somonovits (1993), Lovasz and Deak (2012). One of the most famous and efficient algorithms of the MCMC type is Hit-and-Run (HR), which was originally proposed by Turchin (1971) and independently by Smith (1984). The brief description of the HR algorithm is as follows. At every step HR generates a random direction uniformly over the unit sphere and picks the next point uniformly on the segment of the straight line in the given direction in Q. HR is applicable to various control and optimization problems (Polyak & Gryazina, 2008; Polyak & Gryazina, 2011; Dabbene, Shcherbakov, & Polyak, 2010) as well as to simulation-based multiple criteria decision analysis (Tervonen, van Valkenhoef, Basturk, & Postmus, 2013). Unfortunately, even for simple “bad” sets, such as level sets of ill-posed functions, HR techniques fail or become computationally inefficient.

A variety of applications and drawbacks of the existing techniques provides much room for improving and developing new sampling algorithms. For instance, there were attempts to exploit the approach proposed for interior-point methods of convex optimization (Nesterov & Nemirovsky, 1994) and to combine it with MCMC algorithms. As a result, the Barrier Monte Carlo method (Polyak & Gryazina, 2010) generates random points with better uniformity properties as compared to the standard Hit-and-Run. On the other hand, the complexity of every iteration is in general high enough (the calculation of 
                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∇
                                          
                                          
                                             2
                                          
                                       
                                       F
                                       (
                                       x
                                       )
                                    
                                 
                              
                              
                                 -
                                 1
                                 /
                                 2
                              
                           
                        
                      is required, where 
                        
                           F
                           (
                           x
                           )
                        
                      is a barrier function of the set). Moreover, the Barrier Monte Carlo method does not accelerate convergence for simplex-like sets.

In this paper we propose a new random walk algorithm motivated by physical phenomena of gas diffusing in a vessel. A particle of gas moves with a constant speed until it meets the boundary of the vessel, then it reflects (the angle of incidence equals the angle of reflection) and so on. When a particle hits another one, its direction and speed change. In our simplified model we assume that the direction changes randomly, while the speed remains the same. Thus our model combines the ideas of the Hit-and-Run technique and use of the billiard trajectories. There exists a vast literature on mathematical billiards, and many useful facts can be extracted from there (Tabachnikov, 1995; Galperin & Zemlyakov, 1990; Sinai, 1970; Sinai, 1978; Kozlov & Treshchev, 1991). The traditional theory addresses the behavior of one particular billiard trajectory in different billiard tables, their ergodic properties, and the conditions for the existence of periodic orbits. In stochastic analogs of the classical billiard (Evans, 2001), a direction after reflection is chosen randomly uniformly. Shake-and-Bake algorithms are based on stochastic billiards and generate points on the boundary of a convex set (Boender et al., 1991). The recently proposed version of the Shake-and-Bake algorithm (Dieker & Vempala, xxxx) exhibits polynomial-time convergence to the uniform distribution. Our algorithm is aimed at sampling the interior of a set (actually, later in the text we consider open regions). Besides that, we extend billiard trajectories of random length keeping the standard reflection law. Such an incorporation of randomness also improves the ergodic properties.

The paper is organized as follows. In Section 2 we present a novel sampling algorithm and prove that it produces asymptotically uniformly distributed samples in Q. In Section 3 we pay much attention to some properties of the Billiard Walk (BW), implementation issues are discussed as well. Simulation of BW for particular test domains is presented in Section 4. Much attention is devoted to the capability of BW to get out of the corner, in comparison with HR. Here we consider just the most demonstrative types of geometry. In Section 4.6 we briefly discuss possible applications of the algorithm.

Assume there is a bounded, open connected set 
                        
                           Q
                           ⊂
                           
                              
                                 R
                              
                              
                                 n
                              
                           
                           ,
                           n
                           ⩾
                           2
                        
                     , and a point 
                        
                           
                              
                                 x
                              
                              
                                 0
                              
                           
                           ∈
                           Q
                        
                     . Our aim is to generate asymptotically uniform samples 
                        
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ∈
                           Q
                           ,
                           i
                           =
                           1
                           ,
                           …
                           ,
                           N
                        
                     .

The new BW algorithm generates a random direction uniformly over the unit sphere. Then the next sample is chosen as the end-point of the billiard trajectory of length 
                        
                           ℓ
                        
                     . This length is chosen randomly; i.e., we assume that the probability of collision with another particle is proportional to 
                        
                           δ
                           t
                        
                      for small time instances 
                        
                           δ
                           t
                        
                     , this validates the formula for 
                        
                           ℓ
                        
                      in the algorithm below. The scheme of the method is given in Fig. 1
                     , while the precise routine is as follows.


                        
                           
                              1.
                              Take 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             0
                                          
                                       
                                       ∈
                                       Q
                                       ;
                                       
                                       i
                                       =
                                       0
                                       ,
                                       x
                                       =
                                       
                                          
                                             x
                                          
                                          
                                             0
                                          
                                       
                                    
                                 .

Generate the length of the trajectory 
                                    
                                       ℓ
                                       =
                                       -
                                       τ
                                       log
                                       ξ
                                       ,
                                       ξ
                                    
                                  being uniform random on [0,1], 
                                    
                                       τ
                                    
                                  is a specified constant parameter of the algorithm.

Pick a random direction 
                                    
                                       d
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             n
                                          
                                       
                                    
                                  uniformly distributed over the unit sphere (i.e., 
                                    
                                       d
                                       =
                                       ξ
                                       /
                                       ‖
                                       ξ
                                       ‖
                                    
                                 , where 
                                    
                                       ξ
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             n
                                          
                                       
                                    
                                  has the standard Gaussian distribution). Construct a billiard trajectory starting at 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                    
                                  and having initial direction d. When the trajectory meets the boundary with internal normal 
                                    
                                       s
                                       ,
                                       |
                                       |
                                       s
                                       |
                                       |
                                       =
                                       1
                                    
                                 , the direction is changed as
                                    
                                       
                                          d
                                          →
                                          d
                                          -
                                          2
                                          (
                                          d
                                          ,
                                          s
                                          )
                                          s
                                          ,
                                       
                                    
                                 where 
                                    
                                       (
                                       d
                                       ,
                                       s
                                       )
                                    
                                  is the scalar product.

If a point with nonsmooth boundary is met or the number of reflections exceeds R, go to step 2. Otherwise proceed until the length of the trajectory equals 
                                    
                                       ℓ
                                    
                                 .


                                 
                                    
                                       i
                                       =
                                       i
                                       +
                                       1
                                    
                                 , take the end-point as 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                    
                                  and go to step 2.

The algorithm involves two parameters 
                           
                              τ
                           
                         and R and we discuss their choice below.

We prove asymptotical uniformity of the samples produced by BW for convex and nonconvex cases separately. The requirements on Q are different for these two cases, while the sampling algorithm remains the same. Consider the Markov Chain induced by the BW algorithm 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                           
                        . For an arbitrary measurable set 
                           
                              A
                              ⊆
                              Q
                           
                        , denote by 
                           
                              P
                              (
                              A
                              |
                              x
                              )
                           
                         the probability of obtaining 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ∈
                              A
                           
                         for 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              =
                              x
                           
                         by the BW algorithm. Then 
                           
                              
                                 
                                    P
                                 
                                 
                                    N
                                 
                              
                              (
                              A
                              |
                              x
                              )
                           
                         is the probability to get 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                    +
                                    N
                                 
                              
                              ∈
                              A
                           
                         for 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              =
                              x
                           
                        . We also denote by 
                           
                              p
                              (
                              y
                              |
                              x
                              )
                           
                         the probability density function for 
                           
                              P
                              (
                              A
                              |
                              x
                              )
                           
                        , i.e. 
                           
                              P
                              (
                              A
                              |
                              x
                              )
                              =
                              
                                 ∫
                                 
                                    A
                                 
                              
                              p
                              (
                              y
                              |
                              x
                              )
                              dy
                           
                        .
                           Theorem 1
                           
                              Assume Q is an open bounded convex set in 
                              
                                 
                                    
                                       
                                          R
                                       
                                       
                                          n
                                       
                                    
                                 
                              
                              , the boundary of Q is piecewise smooth. Then the distribution of points 
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                               
                              generated by the BW algorithm tends to the uniform one over Q, i.e.
                              
                                 
                                    
                                       
                                          
                                             
                                                lim
                                             
                                             
                                                N
                                                →
                                                ∞
                                             
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             N
                                          
                                       
                                       (
                                       A
                                       |
                                       x
                                       )
                                       =
                                       λ
                                       (
                                       A
                                       )
                                    
                                 
                              
                              for any measurable 
                              
                                 
                                    A
                                    ⊆
                                    Q
                                    ,
                                    
                                    λ
                                    (
                                    A
                                    )
                                    =
                                    Vol
                                    (
                                    A
                                    )
                                    /
                                    Vol
                                    (
                                    Q
                                    )
                                 
                               
                              and any starting point x.
                           

First, the algorithm is well-defined: at step 4 with zero probability the algorithm sticks at a point with nonsmooth boundary. On the other hand 
                                 
                                    ℓ
                                 
                               and d are chosen in such a way that, with positive probability, 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                 
                               is obtained by less than R reflections (see detailed discussion of “bad” situations in SubSections 3.1 and 3.2).

In view of Theorem 2 in Smith (1984) based on the asymptotic properties of Markov Chains, the two assumptions on 
                                 
                                    p
                                    (
                                    y
                                    |
                                    x
                                    )
                                 
                               imply that the uniform distribution over Q is a unique stationary distribution, and it is achieved for any starting point 
                                 
                                    x
                                    ∈
                                    Q
                                 
                              . The first assumption requires the existence of 
                                 
                                    p
                                    (
                                    y
                                    |
                                    x
                                    )
                                 
                               and its symmetry; the second assumption claims its positivity 
                                 
                                    p
                                    (
                                    y
                                    |
                                    x
                                    )
                                    >
                                    0
                                 
                               for all 
                                 
                                    x
                                    ,
                                    y
                                    ∈
                                    Q
                                 
                              .

Now we show that there exists a probability density function; i.e. for any 
                                 
                                    x
                                    ,
                                    y
                                    ∈
                                    Q
                                 
                              , the transition probability from x to a small neighborhood 
                                 
                                    δ
                                    y
                                 
                               of y is proportional to the volume of 
                                 
                                    δ
                                    y
                                 
                              . Among the trajectories proceeding from x to 
                                 
                                    δ
                                    y
                                 
                              , there exist a conic bundle of trajectories with no reflections, as well as some trajectories with 
                                 
                                    1
                                    ,
                                    2
                                    ,
                                    …
                                    ,
                                    R
                                 
                               reflections. For a bundle of trajectories with no reflections 
                                 
                                    P
                                    (
                                    δ
                                    y
                                    |
                                    x
                                    )
                                    ∼
                                    P
                                    (
                                    δ
                                    θ
                                    )
                                    P
                                    (
                                    δ
                                    ℓ
                                    )
                                 
                              , where 
                                 
                                    P
                                    (
                                    δ
                                    θ
                                    )
                                 
                               is the probability of choosing the spatial angle and 
                                 
                                    P
                                    (
                                    δ
                                    ℓ
                                    )
                                 
                               is the probability of choosing a certain trajectory length 
                                 
                                    ℓ
                                    ∈
                                    δ
                                    ℓ
                                 
                               while 
                                 
                                    p
                                    ∼
                                    q
                                 
                               means “p is proportional to q”. 
                                 
                                    P
                                    (
                                    δ
                                    θ
                                    )
                                 
                               is proportional to the volume of the base of the cone, 
                                 
                                    P
                                    (
                                    δ
                                    ℓ
                                    )
                                    ∼
                                    δ
                                    ℓ
                                 
                              , thus 
                                 
                                    P
                                    (
                                    δ
                                    y
                                    |
                                    x
                                    )
                                    ∼
                                    vol
                                    (
                                    δ
                                    y
                                    )
                                 
                              .

The bundles of trajectories with reflections are also cones with small spatial angle 
                                 
                                    δ
                                    θ
                                 
                              . The area of reflection with a smooth boundary can be approximated as plain region. Then reflection does not change the geometry of the bundle, and the proof for this situation remains the same as for the bundle of trajectories with no reflections. Hence, 
                                 
                                    p
                                    (
                                    y
                                    |
                                    x
                                    )
                                 
                               exists for all 
                                 
                                    x
                                    ,
                                    y
                                    ∈
                                    Q
                                 
                              .

For convex bodies, the positivity of 
                                 
                                    p
                                    (
                                    y
                                    |
                                    x
                                    )
                                 
                               is obvious, all the points are reachable by a trajectory with no reflections.

The symmetry of the probability density function follows from the uniformity of the distribution of the directions and reversibility of a billiard trajectory due to the reflection law: the angle of incidence is equal to the angle of reflection. Therefore, all the assumptions on 
                                 
                                    p
                                    (
                                    y
                                    |
                                    x
                                    )
                                 
                               are satisfied, and the distribution of points 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                               generated by the BW algorithm tends to the uniform distribution on Q.□


                              Assume Q is a bounded and open set, the boundary of Q is piecewise smooth and for all 
                              
                                 
                                    x
                                    ,
                                    y
                                    ∈
                                    Q
                                 
                               
                              there exists a piecewise-linear path such that it connects x and y, lies inside Q and has no more than B linear parts (B is an arbitrary positive integer). Then the distribution of points 
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                               
                              generated by the BW algorithm tends to the uniform distribution on Q in the same sense as in 
                              
                                 Theorem 1
                              .
                           

Again, the algorithm is well defined: with probability one a point 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    
                                    ≠
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                               is found for arbitrary 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ∈
                                    Q
                                 
                              .

All the constraints on Q are important. The existence of a piecewise-linear path implies connectedness and guarantees that, starting from any point, we can reach a measurable neighborhood of any other point in Q. Boundedness is necessary to define the uniform distribution on Q and to prevent the trajectories to go to infinity. Openness allows us to connect any two points with a tube of nonzero measure. Hence, there exists a piecewise linear trajectory connecting two arbitrary points.

Consider 
                                 
                                    
                                       
                                          p
                                       
                                       
                                          N
                                       
                                    
                                    (
                                    y
                                    |
                                    x
                                    )
                                 
                              , the probability density function of 
                                 
                                    
                                       
                                          P
                                       
                                       
                                          N
                                       
                                    
                                    (
                                    A
                                    |
                                    x
                                    )
                                 
                              . The inequality 
                                 
                                    
                                       
                                          p
                                       
                                       
                                          N
                                       
                                    
                                    (
                                    y
                                    |
                                    x
                                    )
                                    >
                                    0
                                 
                               holds for all integer 
                                 
                                    N
                                    >
                                    B
                                 
                              . The equality 
                                 
                                    p
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    |
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    p
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    )
                                 
                               (reversibility) holds for every pair of consecutive points due to the reflection law: the angle of incidence is equal to the angle of reflection. Therefore, 
                                 
                                    
                                       
                                          p
                                       
                                       
                                          N
                                       
                                    
                                    (
                                    y
                                    |
                                    x
                                    )
                                    =
                                    
                                       
                                          p
                                       
                                       
                                          N
                                       
                                    
                                    (
                                    x
                                    |
                                    y
                                    )
                                 
                              .

Hence, the distribution of the subsequence 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          0
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          N
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                          N
                                       
                                    
                                    ,
                                    …
                                 
                              , tends to the uniform one for 
                                 
                                    N
                                    >
                                    B
                                 
                              . The same is true for every subsequence 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          N
                                          +
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                          N
                                          +
                                          i
                                       
                                    
                                    ,
                                    …
                                 
                              . Since all the subsequences have asymptotically uniform distribution, the distribution of points 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                               generated by the BW algorithm tends to the uniform distribution on Q.□

There exist plenty of nonconvex domains that satisfy the conditions of Theorem 2. For instance, an estimate of B for the toroid is given in Subsection 4.8. Note that the constant B characterizes the geometry of Q.

@&#DISCUSSION@&#

We discuss some implementation issues first.

The measure of the set of points belonging to nonsmooth boundary is zero but the probability of hitting the nonsmooth part of the boundary is nonzero for some starting 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                           
                        . For instance, consider two similar convex and nonconvex sets
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                
                                                   1
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      x
                                                      ∈
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      :
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      /
                                                      4
                                                      +
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      <
                                                      1
                                                      ,
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      <
                                                      
                                                         
                                                            3
                                                         
                                                      
                                                      -
                                                      |
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      |
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      x
                                                      ∈
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      :
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      /
                                                      4
                                                      +
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      <
                                                      1
                                                      ,
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      <
                                                      
                                                         
                                                            3
                                                         
                                                      
                                                      +
                                                      |
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      |
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        both being truncated ellipses (Fig. 2
                        ). A large portion of directions makes trajectories of length 
                           
                              ℓ
                              ⩾
                              4
                           
                         starting at the focus 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    
                                       -
                                       
                                          
                                             3
                                          
                                       
                                       ;
                                       0
                                    
                                 
                              
                           
                         hit the nonsmooth boundary at the second focus 
                           
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              =
                              (
                              
                                 
                                    3
                                 
                              
                              ;
                              0
                              )
                           
                        . The reason is that we take a particular starting point. The measure of “bad” starting points is zero and this effect never happens when the starting point is taken randomly with some distribution.

To run the algorithm we need to specify the parameters 
                           
                              τ
                           
                         and R. The value of 
                           
                              τ
                           
                         strongly affects the behavior of the method. For 
                           
                              τ
                           
                         small enough, BW becomes slower than HR; it behaves as a ball walk with radius 
                           
                              τ
                           
                        . Empirical observations show that fast convergence to the uniform distribution is achieved for 
                           
                              τ
                              ≈
                              diam
                              Q
                           
                        , where 
                           
                              diam
                              Q
                           
                         is the diameter of the set Q.

We restrict the number of reflections by R for every trajectory (step 4 of the Algorithm). The goal is to avoid situations when the trajectory length remains less than 
                           
                              ℓ
                           
                         after a large number of reflections (a typical example is addressed in SubSection 4.4). The choice of R is mostly focused on eliminating computationally hard trajectories. The value of R should be large enough to implement most of the trajectories. But R also depends on 
                           
                              τ
                           
                        . The longer the trajectory one needs to implement, the more reflections are required. We usually take 
                           
                              R
                              =
                              10
                              n
                           
                         to make it dimension dependent.

If Q is “ill-shaped,” sometimes it can be improved with its linear transformation. For instance, if Q is a box 
                           
                              Q
                              =
                              {
                              x
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    n
                                 
                              
                              :
                              |
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              |
                              <
                              
                                 
                                    a
                                 
                                 
                                    i
                                 
                              
                              ,
                              i
                              =
                              1
                              ,
                              …
                              ,
                              n
                              }
                           
                        , and it is far from being cubic (
                           
                              min
                              
                                 
                                    a
                                 
                                 
                                    i
                                 
                              
                              /
                              max
                              
                                 
                                    a
                                 
                                 
                                    i
                                 
                              
                              ≪
                              1
                           
                        ), a simple scaling transforms Q into a cube. A similar scaling transforms an ellipsoid into a ball. In the general case,the following scaling can be helpful. Assume Q has a barrier 
                           
                              F
                              (
                              x
                              )
                           
                         defined on Q such that 
                           
                              F
                              (
                              x
                              )
                              →
                              +
                              ∞
                           
                         as 
                           
                              x
                              →
                              ∂
                              Q
                           
                        . In Nesterov and Nemirovsky (1994), a special class of self-concordant barriers is considered. For instance, for the polytope defined by m linear inequalities 
                           
                              Q
                              =
                              {
                              x
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    n
                                 
                              
                              :
                              (
                              
                                 
                                    a
                                 
                                 
                                    i
                                 
                              
                              ,
                              x
                              )
                              <
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              ,
                              i
                              =
                              1
                              ,
                              …
                              ,
                              m
                              }
                           
                        , this barrier is 
                           
                              F
                              (
                              x
                              )
                              =
                              -
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                 
                              
                              log
                              (
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              -
                              (
                              
                                 
                                    a
                                 
                                 
                                    i
                                 
                              
                              ,
                              x
                              )
                              )
                           
                        . Then it is easy to find an approximate minimum 
                           
                              
                                 
                                    x
                                 
                                 
                                    ∗
                                 
                              
                           
                         of 
                           
                              F
                              (
                              x
                              )
                           
                        . Dikin ellipsoid 
                        
                           
                              E
                              =
                              {
                              x
                              :
                              (
                              H
                              (
                              x
                              -
                              
                                 
                                    x
                                 
                                 
                                    ∗
                                 
                              
                              )
                              ,
                              (
                              x
                              -
                              
                                 
                                    x
                                 
                                 
                                    ∗
                                 
                              
                              )
                              )
                              ⩽
                              1
                              ,
                              H
                              =
                              
                                 
                                    ∇
                                 
                                 
                                    2
                                 
                              
                              F
                              (
                              
                                 
                                    x
                                 
                                 
                                    ∗
                                 
                              
                              )
                              }
                           
                        , lies in Q and it is a good approximation of the polytope Q. Hence we can calculate the linear mapping 
                           
                              T
                              =
                              
                                 
                                    H
                                 
                                 
                                    -
                                    1
                                    /
                                    2
                                 
                              
                           
                        ; by generating directions 
                           
                              
                                 
                                    d
                                 
                                 
                                    ′
                                 
                              
                              =
                              Td
                           
                        , where d is uniformly distributed over the unit sphere, we can strongly accelerate the convergence. However sometimes none of the transformations can improve the shape of the set; the simplex is known to be the worst-case example.

Both the HR and BW algorithms require computation of the intersections of a straight line (defined by the point 
                           
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                           
                         and the direction d of the trajectory) with the set Q. We call Boundary Oracle (BO) the procedure that calculates the boundary of the segment 
                           
                              [
                              
                                 
                                    t
                                 
                                 
                                    ̲
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    ¯
                                 
                              
                              ]
                           
                        , where
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ̲
                                    
                                 
                                 =
                                 
                                    
                                       
                                          max
                                       
                                       
                                          t
                                          <
                                          0
                                       
                                    
                                 
                                 {
                                 t
                                 :
                                 
                                    
                                       x
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 td
                                 ∈
                                 ∂
                                 Q
                                 }
                                 ,
                                 
                                 
                                    
                                       t
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 
                                    
                                       
                                          min
                                       
                                       
                                          t
                                          >
                                          0
                                       
                                    
                                 
                                 {
                                 t
                                 :
                                 
                                    
                                       x
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 td
                                 ∈
                                 ∂
                                 Q
                                 }
                              
                           
                        (we assume that Q is convex, otherwise the point of the first intersection of the straight line and the boundary of Q is taken). Thus HR needs both 
                           
                              
                                 
                                    t
                                 
                                 
                                    ̲
                                 
                              
                           
                         and 
                           
                              
                                 
                                    t
                                 
                                 
                                    ¯
                                 
                              
                           
                         for every iteration, and the computational cost of HR is equal to two BO per sample. BW takes 
                           
                              
                                 
                                    t
                                 
                                 
                                    ¯
                                 
                              
                           
                         for every reflection and the computation cost of BW is one BO per reflection. In most applications, finding BO is not a problem. For instance, if Q is a polytope defined by m linear inequalities
                           
                              
                                 Q
                                 =
                                 {
                                 x
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       n
                                    
                                 
                                 :
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 x
                                 )
                                 <
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 m
                                 }
                              
                           
                        then BO 
                           
                              [
                              
                                 
                                    t
                                 
                                 
                                    ̲
                                 
                              
                              ,
                              
                              
                                 
                                    t
                                 
                                 
                                    ¯
                                 
                              
                              ]
                           
                         can be written explicitly. Calculate 
                           
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    -
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    d
                                    )
                                 
                              
                              ,
                              i
                              =
                              1
                              ,
                              …
                              ,
                              m
                           
                        , and take
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ̲
                                    
                                 
                                 =
                                 
                                    
                                       
                                          max
                                       
                                       
                                          i
                                          :
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          <
                                          0
                                       
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       t
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 
                                    
                                       
                                          min
                                       
                                       
                                          i
                                          :
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          >
                                          0
                                       
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 .
                              
                           
                        
                     

Numerous examples of BO for other sets Q (for instance, defined by Linear Matrix Inequalities) can be found in Polyak and Gryazina (2008), Polyak and Gryazina (2011), Dabbene et al. (2010).

Billiard walks also require the calculation of normals s at the boundary points. In most applications it is not hard; for instance, for a polytope we have 
                           
                              s
                              =
                              
                                 
                                    a
                                 
                                 
                                    i
                                 
                              
                           
                        , where i is the index for which the maximum or the minimum in the formulas above is achieved.

Our goal in the test examples below is to compare HR and BW. We use several tools for this purpose. Sometimes theoretical considerations can help to compare the number of iterations to quit a corner. It is well known that HR may require too many iterations to get out of the corner, see estimates in Lovasz and Vempala (2004). We will show that estimates for BW are much more optimistic for many particular examples. On the other hand, we use simulation for the comparison as well. We exploit different tools to demonstrate that one sampling set is closer to uniform than another. Sometimes graphical figures in the 2D plane are quite evident. In other cases we demonstrate strong serial correlation in the samples. Finally, we use a parametric partition of Q and compare the number of empirical frequencies with the theoretical number for the uniform distribution via the 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         criterion.

To make final conclusions on the comparison of the two methods, we should have the following in mind. Of course, computationally BW is harder than HR. It requires more BO calculations, each reflection at the boundary also requires extra calculations for normals. We characterize the computational complexity by the number of calls to the BO and compare the outcomes of HR and BW obtained from the same number of BO (the number of samples is different in this case). The observed acceleration of convergence to the uniform distribution often makes BW preferable to HR.

Some sets below are unbounded; we present them to analyze the behavior at a corner. We say that a trajectory quits the corner if it goes to infinity.

Let the angle 
                           
                              Q
                              ⊂
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                           
                         be equal to 
                           
                              α
                              <
                              π
                           
                        . Then any billiard trajectory quits Q after no more than 
                           
                              
                                 
                                    N
                                 
                                 
                                    ∗
                                 
                              
                              =
                              ⌈
                              π
                              /
                              α
                              ⌉
                           
                         reflections for all initial points and initial directions; here 
                           
                              ⌈
                              a
                              ⌉
                           
                         stands for the smallest integer greater than or equal to a. The proof of this fact is as follows: if we reflect the angle N times around its side, billiard trajectory becomes the straight line. Every intersection of the line and the angle side corresponds to the reflection of the billiard trajectory. A straight line cannot intersect any straight line (not coinciding with itself) twice, and the total number of intersections with the reflected angle sides is no more than 
                           
                              
                                 
                                    N
                                 
                                 
                                    ∗
                                 
                              
                           
                        . Thus 
                           
                              
                                 
                                    N
                                 
                                 
                                    ∗
                                 
                              
                           
                         reflections are enough to quit the corner.

For HR we quit Q with probability 
                           
                              1
                              -
                              
                                 
                                    (
                                    1
                                    -
                                    α
                                    /
                                    π
                                    )
                                 
                                 
                                    N
                                 
                              
                           
                         after no more than N iterations. For 
                           
                              N
                              =
                              
                                 
                                    N
                                 
                                 
                                    ∗
                                 
                              
                           
                         being large enough, HR quits Q with probability 
                           
                              1
                              -
                              1
                              /
                              e
                              =
                              0.63
                           
                        , while BW quits with probability one.

It is of interest to estimate the average number of reflections (over random initial directions). Consider the triangle 
                           
                              Q
                              =
                              {
                              x
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                              :
                              |
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              |
                              ⩽
                              
                              atan
                              
                              
                                 
                                    α
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              ⩽
                              1
                              }
                           
                         with one of the angles equal to 
                           
                              α
                           
                        . Let the BW trajectories start at 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              =
                              (
                              0
                              ;
                              0.1
                              )
                           
                         and calculate the number of reflections until the trajectory reaches the line 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              =
                              1
                           
                         (i.e. quits the corner). Fig. 3
                         depicts 25 trajectories plotted for 
                           
                              α
                              =
                              π
                              /
                              4
                           
                        .

The results of 5000 runs and various 
                           
                              α
                           
                         are given in Table 1
                        . The empirical observations show that the average number of reflections for BW is equal to 
                           
                              
                                 
                                    N
                                 
                                 
                                    ∗
                                 
                              
                              /
                              2
                           
                        . For HR we calculate the number of iterations until BO reaches the line 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              =
                              1
                           
                        .

We conclude that BW is slightly more efficient that HR.

For a polyhedral cone there exists a number M which does not depend on the initial data, such that any billiard trajectory quits Q after no more than M reflections (see Sinai, 1978, also Tabachnikov, 1995, Theorem 7.17). However M depends on the geometry of Q. If M is large (
                           
                              M
                              >
                              R
                           
                        ) then sometimes the BW algorithm gets stuck at 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                           
                        . However it can be proved that BW is well defined with probability one.

It is easy to show that a billiard trajectory quits Q after no more than n reflections for an arbitrary initial point and initial direction. Indeed, for a given initial direction d, every reflection makes one of the components positive (if 
                           
                              d
                              >
                              0
                           
                         componentwise, the trajectory quits Q). Let 
                           
                              I
                              =
                              {
                              i
                              :
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              <
                              0
                              }
                           
                        , then every reflection eliminates at least one negative component of d, and after no more than n reflections we have 
                           
                              I
                              =
                              ∅
                           
                        .

A HR trajectory quits Q with probability 
                           
                              
                                 
                                    2
                                 
                                 
                                    -
                                    (
                                    n
                                    -
                                    1
                                    )
                                 
                              
                           
                         after a single iteration, thus it requires approximately 
                           
                              
                                 
                                    2
                                 
                                 
                                    n
                                    -
                                    1
                                 
                              
                           
                         iterations to quit Q with probability 
                           
                              1
                              -
                              1
                              /
                              e
                              =
                              0.63
                           
                        . The probability to quit the orthant after no more that n iterations is 
                           
                              
                                 
                                    2
                                 
                                 
                                    -
                                    (
                                    n
                                    -
                                    2
                                    )
                                 
                              
                              (
                              1
                              -
                              
                                 
                                    2
                                 
                                 
                                    -
                                    n
                                 
                              
                              )
                           
                         for HR and it decreases dramatically as the dimension n grows. Hence BW is much more efficient than HR for this case. Simulations for the cube (SubSection 4.6) confirm this statement.

All these results show that a polyhedral corner is not a problem for BW in contrast to HR, where the distance of the initial point to the corner and the size of the angle plays a significant role. The results can be extended to curvilinear corners with nondegenerate linear approximation, i.e. if a linear approximation of a corner is a polyhedral cone with nonempty interior.

In concave corners (that is, corners with concave boundaries) pure billiard trajectories may expose a large number of reflections (Sinai, 1970). Consider a typical domain (Fig. 4
                        ) with concave angle
                           
                              (1)
                              
                                 Q
                                 =
                                 
                                    
                                       
                                          x
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                2
                                             
                                          
                                          :
                                          -
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                             
                                                4
                                             
                                          
                                          <
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                          <
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                             
                                                4
                                             
                                          
                                          ,
                                          
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          ⩾
                                          1
                                       
                                    
                                 
                                 .
                              
                           
                        For a fixed 
                           
                              ℓ
                           
                        , the length of a billiard trajectory may remain less than 
                           
                              ℓ
                           
                         after a large number of reflections. Indeed, start the trajectory at the point 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              =
                              (
                              0.9
                              ;
                              ε
                              )
                              ,
                              ε
                           
                         being small enough, fix 
                           
                              ℓ
                              =
                              1
                              ,
                              d
                              =
                              (
                              -
                              1
                              ;
                              0
                              )
                           
                         and compute the number of reflections required. The results are shown in Table 2
                        . As one can notice, the number of reflections increases dramatically as the second coordinate of 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                           
                         tends to zero, and even for 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    10
                                 
                                 
                                    -
                                    4
                                 
                              
                           
                        , the trajectory can not be implemented. To avoid these situations we restrict the number of reflections by R in the BW algorithm. But, in general, these “bad” directions are rare. Fig. 4 depicts 200 points for domain (1), the average number of reflections per point is six.

For domains of the form 
                           
                              Q
                              =
                              {
                              x
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                              :
                              0
                              <
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              <
                              1
                              ,
                              |
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              |
                              <
                              M
                              }
                              ,
                              M
                           
                         being large enough, HR and BW demonstrate different abilities to walk along 
                           
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                           
                        . Below we show that if one counts the average number of steps per one BO call, BW is approximately 6 times faster. For a random line intersecting the strip, let 
                           
                              
                                 
                                    Δ
                                    x
                                 
                                 
                                    ‾
                                 
                              
                           
                         be the horizontal component of the intersection averaged over directions. HR takes 2 BO per step, and the average shift along 
                           
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                           
                         for uniformly distributed initial point is
                           
                              
                                 
                                    
                                       
                                          
                                             Δ
                                             x
                                          
                                          
                                             ‾
                                          
                                       
                                    
                                    
                                       HR
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       Δ
                                       x
                                    
                                    
                                       ‾
                                    
                                 
                                 
                                    ∫
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 
                                    ∫
                                    
                                       0
                                    
                                    
                                       1
                                    
                                 
                                 |
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 |
                                 
                                    
                                       dx
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       dx
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       6
                                    
                                 
                                 
                                    
                                       Δ
                                       x
                                    
                                    
                                       ‾
                                    
                                 
                              
                           
                        per one BO. BW gives 
                           
                              
                                 
                                    
                                       
                                          Δ
                                          x
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    HR
                                 
                              
                              =
                              1
                              /
                              2
                              
                                 
                                    Δ
                                    x
                                 
                                 
                                    ‾
                                 
                              
                           
                         for the first reflection (1 BO) and then 
                           
                              
                                 
                                    Δ
                                    x
                                 
                                 
                                    ‾
                                 
                              
                           
                         for every subsequent BO. The average shift along 
                           
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                           
                         produced by BW after N BO is 
                           
                              
                                 
                                    
                                       
                                          Δ
                                          x
                                       
                                       
                                          ‾
                                       
                                    
                                 
                                 
                                    BW
                                 
                              
                              =
                              
                                 
                                    
                                       1
                                       -
                                       
                                          
                                             1
                                          
                                          
                                             2
                                             N
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    Δ
                                    x
                                 
                                 
                                    ‾
                                 
                              
                           
                         per one BO. Thus BW is 6 times more efficient than HR.

For the unit cube 
                           
                              Q
                              =
                              {
                              x
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    n
                                 
                              
                              :
                              0
                              <
                              x
                              <
                              1
                              }
                           
                         (the inequality is understood component-wise), we can compute the next point of the BW algorithm explicitly.

At the current point x, for given 
                           
                              ℓ
                           
                         and d calculate 
                           
                              
                                 
                                    k
                                 
                                 
                                    i
                                 
                              
                              =
                              ⌊
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              +
                              ℓ
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              ⌋
                           
                         (
                           
                              ⌊
                              x
                              ⌋
                           
                         is the maximal integer less than or equal to x) and walk to y:
                           
                              
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   +
                                                   ℓ
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   is
                                                   
                                                   even
                                                
                                             
                                             
                                                
                                                   1
                                                   -
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   +
                                                   ℓ
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   ,
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   is
                                                   
                                                   odd
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                                 .
                              
                           
                        Of course there is no need to apply MCMC algorithms for random sampling in the cube, one can generate a vector of n independent uniform random variables over 
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                        . Moreover, the shape of the cube is so nice that the distribution of the HR points converges to the uniform fast enough. Nevertheless it is of interest to compare BW and HR for this simplest case.

For various dimensions n we sample 
                           
                              
                                 
                                    N
                                 
                                 
                                    BW
                                 
                              
                              =
                              1000
                           
                         points by the BW algorithm and calculate the amount 
                           
                              
                                 
                                    N
                                 
                                 
                                    BO
                                 
                              
                           
                         of the BO calls needed. Then we sample 
                           
                              
                                 
                                    N
                                 
                                 
                                    HR
                                 
                              
                              =
                              ⌈
                              
                                 
                                    N
                                 
                                 
                                    BO
                                 
                              
                              /
                              2
                              ⌉
                           
                         points by HR. In implementing BW, we take 
                           
                              τ
                              =
                              
                                 
                                    n
                                 
                              
                              ,
                              R
                              =
                              10
                              n
                           
                        , starting point is uniform random for both sampling algorithms.

First we examine serial correlation for points produced by different samplers. To judge about serial correlation, we partition the unit cube into 
                           
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                              
                              ,
                              i
                              =
                              1
                              ,
                              …
                              ,
                              
                                 
                                    2
                                 
                                 
                                    n
                                 
                              
                           
                        , small cubes of equal volumes. Then we calculate the empirical probability to proceed between different parts 
                           
                              P
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              
                              ∉
                              
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                              
                              |
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ∈
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                              
                              )
                           
                        . Table 3
                         shows the results as compared to the theoretical probability U for independent uniformly distributed points (which is 
                           
                              1
                              -
                              
                                 
                                    2
                                 
                                 
                                    -
                                    n
                                 
                              
                           
                        ). One can see that serial correlation is much stronger for HR than for the BW samples.

Then we make the 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         frequency test for 10,000 HR points in 
                           
                              
                                 
                                    R
                                 
                                 
                                    10
                                 
                              
                           
                        . We take 10 equal volume slabs in the ith coordinate direction for 
                           
                              i
                              =
                              1
                              ,
                              …
                              ,
                              10
                           
                        , and make 10 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         tests all together. The results are shown in Table 4
                        .

We start BW with computational complexity 20,000 BO and obtain 2148 points (
                           
                              ∼
                              215
                           
                         per slab). The 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         frequency test results are shown in Table 5
                        .

Upper and lower 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         values for 
                           
                              10
                              %
                           
                         statistical significance for 9 degrees of freedom are 
                           
                              [
                              3.3
                              ,
                              16.9
                              ]
                           
                         (for two tailed 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         test). Thus HR fails all 10 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         tests while BW fails just 2 out of the 10 tests.

The next test set is the standard n-dimensional simplex
                           
                              
                                 Q
                                 =
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          >
                                          0
                                          ,
                                          
                                             ∑
                                          
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          1
                                          ,
                                          i
                                          =
                                          0
                                          ,
                                          1
                                          ,
                                          …
                                          ,
                                          n
                                       
                                    
                                 
                                 .
                              
                           
                        The simplex is a set with many corners and the geometry of simplex cannot be improved by any affine transformation. We know that for HR walk it takes a lot of iterations to get out of a corner, thus it is interesting to compare HR and BW.

Smooth boundary of Q is specified by the points 
                           
                              ∂
                              Q
                              =
                              {
                              x
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    n
                                    +
                                    1
                                 
                              
                              :
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                              =
                              0
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              
                              ≠
                              
                              0
                              ,
                              i
                              =
                              0
                              ,
                              …
                              ,
                              n
                              ,
                              i
                              
                              ≠
                              
                              k
                              }
                           
                        , and the internal normal of unit length for these points is
                           
                              
                                 s
                                 =
                                 
                                    
                                       
                                          
                                             1
                                          
                                          
                                             n
                                             (
                                             n
                                             +
                                             1
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             -
                                             1
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         ︸
                                                      
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             ,
                                             …
                                             ,
                                             -
                                             1
                                          
                                       
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                        The length of any edge of the simplex is 
                           
                              
                                 
                                    2
                                 
                              
                           
                         for every dimension n, the choice of the parameter 
                           
                              τ
                              =
                              
                                 
                                    2
                                 
                              
                           
                         seems reasonable.

Note that for 
                           
                              n
                              =
                              2
                           
                        , the samples visually look uniformly distributed for both algorithms. To decide about uniformity more rigorously in the multidimensional case, consider the sequence of enclosed simplices 
                           
                              
                                 
                                    S
                                 
                                 
                                    α
                                 
                              
                              =
                              {
                              x
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    n
                                    +
                                    1
                                 
                              
                              :
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ⩾
                              α
                              ,
                              ∑
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              =
                              1
                              }
                              ,
                              0
                              ⩽
                              α
                              ⩽
                              
                                 
                                    1
                                 
                                 
                                    n
                                    +
                                    1
                                 
                              
                           
                        . For 
                           
                              α
                              =
                              0
                              ,
                              
                                 
                                    S
                                 
                                 
                                    0
                                 
                              
                           
                         is the initial simplex, and for 
                           
                              α
                              =
                              
                                 
                                    1
                                 
                                 
                                    n
                                    +
                                    1
                                 
                              
                           
                        , the simplex 
                           
                              
                                 
                                    S
                                 
                                 
                                    α
                                 
                              
                           
                         contains one point. Let 
                           
                              
                                 
                                    f
                                 
                                 
                                    ˆ
                                 
                              
                              (
                              α
                              )
                           
                         be the portion of points contained in 
                           
                              
                                 
                                    S
                                 
                                 
                                    α
                                 
                              
                           
                        , and denote 
                           
                              f
                              (
                              α
                              )
                              =
                              vol
                              
                                 
                                    S
                                 
                                 
                                    α
                                 
                              
                              /
                              vol
                              
                                 
                                    S
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    (
                                    1
                                    -
                                    (
                                    n
                                    +
                                    1
                                    )
                                    α
                                    )
                                 
                                 
                                    n
                                 
                              
                           
                        . Fig. 5
                         shows 
                           
                              
                                 
                                    f
                                 
                                 
                                    ˆ
                                 
                              
                              (
                              α
                              )
                           
                         for 
                           
                              n
                              =
                              50
                              ,
                              
                              N
                              =
                              300
                              ,
                              
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              =
                              {
                              1
                              /
                              (
                              n
                              +
                              1
                              )
                              ,
                              …
                              1
                              /
                              (
                              n
                              +
                              1
                              )
                              }
                           
                        . The red line corresponds to the uniformly distributed points, the black line describes the distribution for the HR points, and the blue line for BW points. We conclude that for BW samples, the empirical values of 
                           
                              
                                 
                                    f
                                 
                                 
                                    ˆ
                                 
                              
                              (
                              α
                              )
                           
                         are much closer to the mean value 
                           
                              f
                              (
                              α
                              )
                           
                         than for the HR samples.

We also perform two 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         tests for 
                           
                              n
                              =
                              10
                           
                        . For the first one we partition Q into 10 simplices 
                           
                              Q
                              =
                              
                                 
                                    S
                                 
                                 
                                    0
                                 
                              
                              ⊃
                              
                                 
                                    S
                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                              ⊃
                              …
                              ⊃
                              
                                 
                                    S
                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          10
                                       
                                    
                                 
                              
                              =
                              ∅
                           
                         such that 
                           
                              Vol
                              (
                              
                                 
                                    S
                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              ⧹
                              
                                 
                                    S
                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                 
                              
                              )
                              =
                              Vol
                              
                                 
                                    S
                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          9
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    10
                                 
                              
                              Vol
                              
                                 
                                    S
                                 
                                 
                                    0
                                 
                              
                           
                        . These differences 
                           
                              
                                 
                                    S
                                 
                                 
                                    i
                                 
                              
                              ⧹
                              
                                 
                                    S
                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                 
                              
                           
                         are of various geometry but their volumes are equal. For the second test we take 
                           
                              n
                              +
                              1
                           
                         subsets of the same volume and geometry, these subsets 
                           
                              
                                 
                                    Q
                                 
                                 
                                    i
                                 
                              
                           
                         contain points mostly close to the selected vertex 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                           
                        :
                           
                              
                                 
                                    
                                       Q
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 {
                                 x
                                 ∈
                                 Q
                                 :
                                 |
                                 |
                                 x
                                 -
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 
                                    
                                       |
                                    
                                    
                                       2
                                    
                                 
                                 <
                                 |
                                 |
                                 x
                                 -
                                 
                                    
                                       v
                                    
                                    
                                       j
                                    
                                 
                                 |
                                 
                                    
                                       |
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                 j
                                 
                                 ≠
                                 
                                 i
                                 }
                                 .
                              
                           
                        Restricting ourselves to 20,000 BO, we obtain 10,000 HR points and about 2000 BW points. Tables 6 and 7
                        
                         present the experimental results.

Recalling the upper and lower 
                           
                              
                                 
                                    χ
                                 
                                 
                                    2
                                 
                              
                           
                         test values 
                           
                              [
                              3.3
                              ,
                              16.9
                              ]
                           
                        , we conclude that the BW points fit uniform distribution while the HR points do not.

Both the HR and BW algorithms are applicable to nonconvex sets. Consider the toroid formed by an n-dimensional ball of radius r with its center rotating over a circle in the 
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        -plane:
                           
                              (2)
                              
                                 Q
                                 =
                                 {
                                 x
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       n
                                    
                                 
                                 :
                                 |
                                 |
                                 x
                                 -
                                 
                                    
                                       c
                                    
                                    
                                       x
                                    
                                 
                                 |
                                 |
                                 <
                                 r
                                 }
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          x
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        , i
                        =1, 2, 
                           
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          x
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              =
                              0
                              ,
                              i
                              >
                              2
                           
                        .

The conditions of Theorem 2 are satisfied with 
                           
                              B
                              =
                              
                                 
                                    
                                       
                                          
                                             π
                                          
                                          
                                             2
                                             arccos
                                             
                                                
                                                   1
                                                   -
                                                   r
                                                
                                                
                                                   1
                                                   +
                                                   r
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              +
                              1
                           
                        , i.e. for all 
                           
                              x
                              ,
                              y
                              ∈
                              Q
                           
                         there exists a piecewise-linear path such that it connects x and y, lies inside Q, and has no more than B linear parts.


                        Fig. 6
                         depicts 500 BW samples and 
                           
                              1764
                           
                         HR points (projected onto the 
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        -plane) for the set (2) of dimension 10 and 
                           
                              r
                              =
                              1
                              /
                              3
                           
                        . The number of samples is different because implementation of 500 BW samples requires 1764 BO calculations. HR points are plotted with black dots, BW points with blue ones.

It can be easily seen that the angle distrubition of the BW points is much more uniform than those for the HR points, the latter remain in the neighborhood of the initial point. Note that the visual lack of uniformity in the radial direction is an “optical effect” because we provide a 2D projection of the 10D picture.

In this paper we do not address numerous applications of the new version of random sampling. We can mention just few of them: global optimization (in particular, concave programming), control problems, robustness issues, numerical integration, calculation of the volume and the center of gravity and so on; see, for instance, our previous papers (Polyak & Gryazina, 2008; Polyak & Gryazina, 2011; Dabbene et al., 2010; Polyak & Gryazina, 2010). We plan to consider these applications in future works.

@&#ACKNOWLEDGEMENTS@&#

The initial impulse for the research was given by a student Alexander Rodin, who proposed to use physical model of gas diffusion for random sampling. The suggestions of Yakov Sinai on billiard theory were extremely helpful. We are also grateful to the anonymous referees for their comments resulted in the significant improvement of the original manuscript.

@&#REFERENCES@&#

