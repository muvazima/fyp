@&#MAIN-TITLE@&#Fast and accurate identification of fat droplets in histological images

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           A new method for identifying fat droplets in histological images is presented.


                        
                        
                           
                           Adjacency statistics are utilized as shape features.


                        
                        
                           
                           Fat droplets are identified with high sensitivity and specificity.


                        
                        
                           
                           Adjacency statistics greatly improve the identification of clustered fat droplets.


                        
                        
                           
                           The method can be quickly executed on standard computers.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Steatosis quantification

Histological image analysis

Shape features

Texture features

@&#ABSTRACT@&#


               
               
                  Background and objective
                  The accurate identification of fat droplets is a prerequisite for the automatic quantification of steatosis in histological images. A major challenge in this regard is the distinction between clustered fat droplets and vessels or tissue cracks.
               
               
                  Methods
                  We present a new method for the identification of fat droplets that utilizes adjacency statistics as shape features. Adjacency statistics are simple statistics on neighbor pixels.
               
               
                  Results
                  The method accurately identified fat droplets with sensitivity and specificity values above 90%. Compared with commonly-used shape features, adjacency statistics greatly improved the sensitivity toward clustered fat droplets by 29% and the specificity by 17%. On a standard personal computer, megapixel images were processed in less than 0.05s.
               
               
                  Conclusions
                  The presented method is simple to implement and can provide the basis for the fast and accurate quantification of steatosis.
               
            

@&#INTRODUCTION@&#

Steatosis, the abnormal retention of fat in cells, is a common disease of the liver. Liver steatosis can have a variety of causes, such as obesity, diabetes, and alcohol abuse. Due to the growing problem of obesity among the Western population, steatosis is expected to become ever more widespread [13]. Severe steatosis increases the risk of liver dysfunction after surgery. It is, therefore, frequently assessed in order to decide whether to perform an extended liver resection or whether to accept a liver graft.

The gold standard for the assessment of steatosis is the histological evaluation of tissue samples. Here, steatosis is most often assessed in routine stains, such as hematoxylin and eosin (H&E). Under the microscope, steatosis becomes visible as separate or clustered fat droplets in the cytoplasm of cells. Because fat is dissolved in the course of the normal histological processing, these fat droplets are actually empty spaces within the tissue. Nevertheless, they can usually be distinguished from other empty spaces, such as vessels or tissue cracks, by their distinctive roundish shape (Fig. 1
                     ).

Steatosis is typically assessed in terms of a semiquantitative scoring system that captures the percentage of cells with fat droplets [2]. Recent studies have shown that the results are often only poorly reproducible. In [5], no significant correlation could be demonstrated between 4 pathologists from 3 countries. In [6], nearly a quarter of 75 specimens were scored differently in a second assessment.

Errors in the assessment of steatosis can lead to inappropriate treatment decisions. For this reason, several image analysis methods have been proposed in order to automate and improve steatosis measurements.

The main operation of these image analysis methods is the identification of fat droplets. Afterwards, the amount of steatosis is simply quantified as the area fraction occupied by the fat droplets. Although the resulting values differ from the semiquantitative scoring system, they often provide a good correlation with biochemical measurements of the fat content of the tissue [10,4].

Most methods for the identification of fat droplets start with some kind of thresholding operation in order to segment all empty spaces within the tissue. The resulting segments, called “blobs”, are then classified into either fat droplets or other empty spaces by their shape. Here, the existing methods generally assume that fat droplets have a distinctive circular shape. In [5], the size or arc length of a blob is required to be similar to a circle which covers its area in order to be classified as a fat droplet. In [11,10,9,4], fat droplets are identified by applying static thresholds to the size and roundness or eccentricity of a blob.

The assumption of a circular shape generally holds true for images of mild steatosis where fat droplets are clearly separated and every droplet is represented by an individual blob. In images of severe steatosis, however, multiple fat droplets in close proximity often coalesce into single blobs, thereby exhibiting all kinds of complex or elongated shapes (Fig. 2
                     ). In these cases, the reliance on the roundness as a classification criterion produces severe classification errors.

The method proposed in [9] appears to be the only one to tackle this problem. Here, clustered droplets are separated prior to the classification with a combination of distance and watershed transformations. When applied to whole-slides images, these operations are computationally very expensive. In [9], this problem is solved by utilizing a large-scale grid-computing environment which is generally not available in clinical practice.

In this paper, we present a new method for the identification of fat droplets in histological images. This method directly identifies both separate and clustered fat droplets with high accuracy. At the same time, this method is very fast and can be quickly executed on standard personal computers.

@&#METHODS@&#

@&#OVERVIEW@&#

Like most existing image analysis methods for the identification of fat droplets, the presented method has two main processing steps (Fig. 3
                        ). In the first step, individual pixels are classified into either background or tissue. In the second step, blobs of connected background pixels are classified into either fat droplets or other empty spaces by their shape.

Background pixels are generally brighter and less saturated than tissue pixels. Therefore, we classify the pixels by thresholds to their brightness and saturation values. In poor quality images, it can help to normalize the pixel values before thresholding [12]. Because of its simplicity, we do not provide a more detailed discussion of the pixel classification step but focus on the more complex blob classification step.

The blob classification step is composed of multiple essential operations. First, a connected-component labeling operation identifies locally-connected background pixels as individual blobs. Second, a feature extraction operation computes certain shape features of each blob. And last, a classification operation classifies all blobs into either fat droplets or other empty spaces with respect to their shape features.

For the connected-component labeling operation, we utilize the algorithm presented in [8]. This algorithm is particularly fast, because it labels pixels without extensive computations and completes the connected-component identification in a single pass over the image.

The feature extraction operation is the key novelty in our approach and, therefore, described in more detail in the next section.

For the classification operation, we use a Random Forest classifier, which has been shown to be well-performing and practical for many classification tasks [1]. The Random Forest classifier is made up of an ensemble of decision trees that are built from different bootstrap samples of the training data. While the classification accuracy generally grows with the ensemble size, so does the execution time of the classifier. We utilize an ensemble of 20 decision trees, because we have empirically found that this is sufficient to achieve the maximum accuracy for all considered feature sets.

A look at Fig. 2 reveals that the shapes of separate fat droplets, clustered fat droplets and other empty spaces form distinct textures. This gave rise to the idea to use texture features for the blob classification.

In order to be applicable to shapes, the texture features must work on binary images of the shape masks. In [7], adjacency statistics were introduced as texture features to classify binary images of subcellular structures. Because adjacency statistics were shown to be very discriminative, we have adapted them as shape features for the identification of fat droplets.

In our implementation, adjacency statistics describe fractions of blob pixels with a specific number of other blob pixels in their neighborhood. We consider adjacency statistics in an 8-neighborhood, that is, they comprise nine features, each of which counts the fraction of blob pixels with 0, 1, 2, …, or 8 other blob pixel in their neighborhood.

Adjacency statistics are very simple to compute. In the following, we sketch an algorithm for computing adjacency statistics on the output image L of the connected-component labeling operation. We assume that the expression L[x][y] returns the label of the blob at position (x, y), or 0 if the position is empty. For every blob, we manage a data structure b which summarizes its adjacency statistics b.as[0], …, b.as[8]. Initially, all adjacency statistics are set to 0. To enable the quick mapping from labels to blobs, the algorithm utilizes a global label table T which maps every blob label l to the corresponding blob b=T[l].


                        for y=1 to height:
                     

 
                        for x=1 to width:
                     

  
                        if L[x][y] > 0:
                     

   
                        b = T[L[x][y]]
                     

   
                        c = 0
                     

   
                        for (i,j) in 
                        N
                        :
                     

    
                        if L[x+i][y+j] > 0:
                     

     
                        c += 1
                     

   
                        b.as[c] += 1
                     

Here, the set N comprises the relative positions of the eight neighbor pixels, that is, N
                        ={(−1, −1), (0, −1), …}. After the pass over the image, all feature values are divided by the sum of the adjacency statistics of the corresponding blob and, thereby, normalized to a value between 0 and 1.

@&#RESULTS AND DISCUSSION@&#

For the evaluation of the presented analysis method, we have asked an expert to give 1000 examples of blobs representing fat droplets and 1000 examples of blobs representing other empty spaces. The blobs representing fat droplets were labeled as either “separate” or “clustered”, depending on whether they cover just one or multiple fat droplets. Other empty spaces were considered to be all blobs representing non-droplet structures, such as vessels or tissue cracks. For both classes, the selection was aimed at covering the variability of blob shapes and sizes to the greatest extent.

The blob examples were annotated in 32 H&E-stained rat liver sections with mild, moderate or severe steatosis. Rat liver sections were used for the evaluation because they were readily available and because fat droplets in rat liver sections appear similar to the ones in human liver sections. In order to induce steatosis of different degrees, the rats were fed with a methionine-choline-deficient plus high-fat diet between 3 days and 6 weeks. The sections were imaged in entirety at 500pixel/mm resolution using a NanoZoomer 2.0-HT Slide Scanner by Hamamatsu Photonics K.K., Japan. To enable the distinction between separate and clustered fat droplets, the annotation was performed directly on the result image of the pixel classification step.

We have evaluated how accurate fat droplets can be identified by adjacency statistics. In this context, we have also evaluated how adjacency statistics perform in comparison to the commonly used shape features size and eccentricity.

The accuracy evaluation was carried out independently with three different feature sets. The first set contained only the size and eccentricity features. The size feature was computed as the number of pixels in a blob. The eccentricity feature was computed on the basis of the raw moments of the blobs and yields values between 0 for circular blobs and 1 for line-shaped ones [3]. The second set contained only the adjacency statistics features. The third set contained the adjacency statistics, size, and eccentricity features together.

Classification accuracy was assessed by repeated random sub-sampling validation. For this, the example blobs were divided into non-overlapping training and test sets of 1000 blobs each. A Random-Forest classifier, as described in Section 2, was trained on the training set and applied to the test set. Every blob in the test set was classified as either fat droplet or other empty space. Afterwards, different accuracy measures were calculated as described below. This process was repeated 1000 times with different randomly-selected training and test sets. The results were summarized through the mean value and the standard deviation of the accuracy measures across the repetitions.

The classification accuracy was rated in terms of the following measures, all of which were supposed to be maximized:
                           Sensitivity SFD
                           
                              The sensitivity toward separate fat droplets. Computed as the fraction of separate fat droplets that were identified correctly.

The sensitivity toward clustered fat droplets. Computed as the fraction of clustered fat droplets that were identified correctly.

The specificity toward fat droplets in general. Computed as the fraction of other empty spaces that were identified correctly.

The results of the accuracy evaluation are listed in Table 1
                        . For completeness, this table also lists the overall accuracy of the classification, computed as the fraction of test blobs that were identified correctly.

With the size and eccentricity features, an average of 86% of separate fat droplets were identified correctly. However, only 61% of clustered fat droplets were identified as such. With adjacency statistics, the sensitivity toward both separate and clustered fat droplets improved to over 90%. In the case of clustered fat droplets, this is a substantial increase of 29%. The specificity also benefited from the utilization of adjacency statistics and improved by 17%. A combination of both feature sets still marginally improved most accuracy measures.


                        Fig. 4
                         shows the size and eccentricity distributions of the different blob types. Here, the low accuracy values obtained with these features become plausible, because the distributions of clustered fat droplets and other empty spaces largely overlap.

The performance of any classifier depends largely on its training set. We have, therefore, evaluated how the accuracy measures are affected by variations in the training set. For this, we have performed the accuracy evaluation, as explained in the previous section, with different training set sizes.

The results are plotted in Fig. 5
                        . Every marker represents the mean value of an accuracy measure across the repetitions for a particular training set size. The envelopes visualize the standard deviation around the mean. The dots show the results obtained with adjacency statistics. The crosses show the results obtained with the size and eccentricity features.

All accuracy measures increased with the training set size. At the same time, the standard deviation decreased with a growing number of training examples. A lower standard deviation means that the results are more stable toward variations in the training set. While these trends were very obvious until a training set size of 200, they became less significant as more examples were added to the training set.

Independent of the training set size, the adjacency statistics features always produced higher accuracy measures than the size and eccentricity features. Also, the results produced with adjacency statistics appeared to be generally more stable toward variations in the training set. The superiority of the adjacency statistics was particularly obvious for the Sensitivity CFD and the Specificity measures.

We have evaluated the execution time of the presented fat droplet identification method on typical steatosis images. For this, we have cut out 30 sub-images with 1000×1000 pixels from the slide images described above. The sub-images were chosen to cover areas with mild, moderate or severe steatosis.

For the evaluation, we have implemented the presented fat droplet identification method in C++. This implementation was executed for every sub-image. The execution was performed on a standard personal computer with an Intel Xeon E5430 CPU utilizing a single core. For every sub-image, we have recorded the total execution time of the method, the execution time of only the feature extraction operation, and the number of blobs identified by the connected-component operation.

The results are plotted in Fig. 6
                        . Every dot marks the observed execution time of one image. Filled dots mark the total execution times of the method, hollow dots mark the execution times of the feature extraction operation. The x-coordinates of the dots represent the number of blobs in the respective image.

It became apparent, that the execution time grows with the number of blobs in the image. However, even on the images with the most blobs, the method proved to be fast and completed in less than 0.05s. The extraction of adjacency statistics made up only a small fraction of the total execution time and generally completed in less than 0.01s.

@&#CONCLUSIONS@&#

In this paper, we have presented a new method for the identification of fat droplets in histological images. This method is innovative in that it utilizes adjacency statistics as shape features. Adjacency statistics are very simple statistics on neighbor pixels.

In an empirical evaluation, the method accurately identified fat droplets with sensitivity and specificity values above 90%. In addition, the method proved to be fast. On a standard personal computer, megapixel images were processed in less than 0.05s.

Adjacency statistics generally enabled a more accurate identification of fat droplets than the commonly used size and eccentricity features. This was particularly obvious for clustered fat droplets that occur in images with severe steatosis. When adjacency statistics were used instead of the size and eccentricity features, the sensitivity toward clustered fat droplets significantly improved by 29%. The specificity also improved by 17%. The superiority of adjacency statistics was shown to be independent of the training set size.


                     Fig. 7
                      shows examples of image analysis results obtained with the size and eccentricity features or adjacency statistics. In both cases, the classifier was trained with all 2000 example blobs. All recognized fat droplets are highlighted in yellow. With the size and eccentricity features, clustered fat droplets and other empty spaces are often misclassified. With adjacency statistics, nearly all structures are identified correctly.

A major advantage of the presented method is that it accurately identifies clustered fat droplets without separating the individual droplets. The latter approach can significantly increase the complexity of the method and its execution time [9].

The accurate identification of fat droplets is the prerequisite for the accurate measurement of steatosis in histological images. However, we did not investigate how well steatosis measurements on the basis of the presented method correlate with measurements obtained by visual inspection or biochemical analysis. Also, we did not investigate how the measurements are affected by variations in the stain, or to what extent the measurements are predictive for postoperative complications. These questions should be addressed in future work.

Additional future work should be dedicated to evaluating whether adjacency statistics can be beneficial in other applications where complex shapes have to be recognized.

The authors declare that they have no conflict of interest.

@&#ACKNOWLEDGMENT@&#

This work was carried out as part of the Virtual Liver project, funded by the German Federal Ministry of Education and Research (BMBF).

@&#REFERENCES@&#

