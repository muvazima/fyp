@&#MAIN-TITLE@&#Optimal illumination directions for faces and rough surfaces for single and multiple light imaging using class-specific prior knowledge

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A distribution of normals is used, e.g. all faces have similar distribution.


                        
                        
                           
                           Three parameters were optimized, surface details-gradients, shadows and highlights.


                        
                        
                           
                           Isophotes were used increasing their density based on the normals distribution.


                        
                        
                           
                           Both, Lambertian and Phong models were considered.


                        
                        
                           
                           Experiments were performed with real and synthetic data to verify the outcomes.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Photometric stereo

3D imaging

Face reconstruction

@&#ABSTRACT@&#


               
               
                  The detection of image detail variation due to changes in illumination direction is a key issue in 3D shape and texture analysis. In this paper two approaches for estimating the optimal illumination direction for maximum enhancement of image detail and maximum suppression of shadows and highlights are presented. The methods are applicable both to single image/single illumination direction imaging and to photometric stereo imaging. This paper uses class-specific prior knowledge, where the distribution of the normals of the class of surfaces is used in the optimisation. Both the Lambertian and the Phong models are considered and the theoretical development is demonstrated with experimental results for both models. For each method experiments were performed using artificial images with isotropic and anisotropic distributions of normals, followed by experiments with real faces but synthesised images. Finally, results are presented using real objects and faces with and without ground-truth.
               
            

@&#INTRODUCTION@&#

The variation of the intensities observed in images depends on variation in both surface reflectance and surface relief. While the reflectance properties are intrinsic to a surface, the surface relief produces a pattern of shadings that depends strongly on the direction of illumination. The appearance of a 3D surface changes drastically with illumination [8]. Different image details are enhanced for different illumination directions. The idea of photometric stereo is to use this information to recover the intrinsic surface parameters, that is, local surface orientation and albedo, independent of the illumination direction. Photometric stereo estimates relief and reflectance information using three or more images of a surface illuminated from different directions captured from a single viewpoint. The method considers the isophotes in gradient space. The intersections of the isophotes from different illumination directions identify the gradients of individual surface facets (corresponding to pixels). Due to the non-linear nature of the problem, the shape, density and orientation of the isophotes affect the accuracy with which the gradient vectors can be estimated. The characteristics of the isophotes depend on the lighting directions. So, illumination directions play a crucial role in the quality of the produced image and they should be carefully chosen for applications in which this is possible. Sub-optimal geometric arrangements may crucially affect the reliability of the subsequently inferred information.

In this paper, two methods that estimate the optimal imaging configuration are proposed. The first one is based on maximising the level of detail in the reconstructed surfaces, revealing details and salient features of the imaged surface. In the second approach, we estimate optimal positions of the light sources by maximising the area covered by dense isophotes in gradient space for an arbitrarily shaped surface when the distribution of surface normals is roughly known. The problem has been studied before [32,15], but previous authors did not consider prior knowledge on the distribution of the normals of the facets of the surface. All previous optimisation methods effectively assumed uniform distribution of the normals. This paper uses class-specific prior knowledge, where the distribution of the normals of the class of surfaces is used in the optimisation. At this point we would like to stress that we do not expect to know the exact surface normals beforehand, as this would defeat the purpose of photometric stereo. We only assume the availability of the statistical distribution of the surface normals, which may be used for all objects of the same class, e.g. all human faces, although this statistical distribution might be obtained from the face of a plastic model, for example, using active sensing. The ultimate purpose is to take into consideration the statistical distribution of the normals, in order to design an optimal lighting system for this class of object, and so achieve best reconstruction of the surfaces of individual objects of the same class.

This paper is organised as follows. In Section 2 previous work on photometric stereo and optimal illumination estimation is reviewed. In Section 3, we propose an overview of the proposed approach. In Section 4 the first proposed methodology is analysed both for the Lambertian and the Phong models. Also, details on how this approach can be generalised to n illumination sources are presented. In Section 5 the second approach is introduced based on the density of the isophotes in the gradient space, for Lambertian surfaces. In Section 6 initially an analysis of some preliminary results related to the estimations of some model parameters are presented for the first approach. Then in Section 7, the proposed illumination setups are compared with the one proposed in [10]. First, experiments are performed using artificial images with isotropic distribution of normals, followed by experiments with anisotropic distributions with four different dominant orientations. Subsequently, experiments with real faces but synthesised images are performed. Finally, in Section 8 results are presented using real objects with ground-truth and real faces without ground-truth but using the side views and the Hausdorff distance for evaluation. In Section 9 conclusions on the proposed methodology and the evaluation process are presented.

In [41] photometric stereo was introduced. He proposed a method which was simple and efficient, but was sensitive to noise. In his method, the surface gradient can be recovered by using two photometric images, assuming that the surface albedo is already known for each point on the surface. In [9] photometric stereo was extended to four light sources, where specular reflections were discarded and estimation of surface shape could be performed by means of diffuse reflections and the use of the Lambertian model. In [27] a photometric approach which uses a linear combination of the Lambertian model was developed and an impulse specular component to obtain the shape and reflectance information for a surface. In [3–5] an algorithm for estimating the local surface gradient and albedo using four source colour photometric stereo was presented in the presence of highlights and shadows. In [22] an approach that utilises nine illumination sources was presented. It is also worth mentioning the related work presented in [31] focusing on 4-lights PS based on shape information and statistical segmentation techniques to determine which pixels are specular and which are non-specular. In [7] an algorithm for Lambertian photometric stereo in the presence of shadows is proposed based on fast graph cuts estimating per pixel light source visibility. Also, it allows images to be acquired with multiple illuminants, and there can be fewer images than light sources. In [24] a method to remove shadows from real images based on a probability shadow map is introduced and in [12] a shadow removal method is presented from a 3-band colour image finding an intrinsic reflectivity image based on assumptions of Lambertian reflectance. In the work presented in [30] a method for cast shadow removal from obliquely illuminated images of faces is suggested based on a statistical model of surface normal directions. [34] proposed a multi-light source photometric stereo system for reconstructing images of various characteristics of non-Lambertian rough surfaces with widely varying texture and specularity. An algorithm that no calibration is needed for recovery of geometry of objects with general reflectance properties from images was introduced in [17]. In [1] a technique for resolving the GBR ambiguity based on minimisation of the entropy of the recovered albedos was proposed. In [13] an uncalibrated photometric stereo technique for unknown light sources and general reflectance model was suggested. A review of different reflectance maps proposed in the literature for modelling reflection from real-world surfaces as presented in [35] and in [28] the problem of estimating the proportions of Lambertian and specular reflection components in order to improve the quality of surface normal information recoverable using shape-from-shading was discussed. Recursive approaches for shadow and highlights estimation for advanced reconstruction using photometric stereo of any number of lights were presented in [38,39]. In [18] a technique for face recognition was presented that combines the Fisherface method with the ridgelet transform and high-speed Photometric Stereo. In [21] was shown that a plausible shape can be obtained based on two light sources and in [11] a multiple illumination technique that directly recovers the viewer-centered curvature matrix and being independent of knowledge of incident illumination orientation, local surface orientation, or diffuse surface albedo was presented. A scheme to resolve handwriting from background printing using photometric stereo to recover the surface was suggested in [25] and in [19] a photometric stereo algorithm was presented that reconstructs object shapes from multiple images, in which 3D surfaces were approximated by Legendre polynomials. In [37] an algorithm for shape from shading was introduced based on the assumption that a single input image will be matched to a second image through a uniform disparity field.

The influence of a lighting arrangement to the accuracy of surface reconstruction based on photometric stereo has been considered in the past [41,23,32,8] and suggestions for optimal illumination configurations in terms of azimuth 
                        
                           
                              
                                 φ
                              
                              
                                 l
                              
                           
                        
                      and zenith 
                        
                           
                              
                                 θ
                              
                              
                                 l
                              
                           
                        
                      angles have been reported. In [40], using reflectance maps, dense iso-intensity contours were recommend to obtain maximal accuracy.

Lee and Kuo in [23], using two reflectance maps in the case of a two image photometric stereo, deduced that it is desirable to incorporate reflectance maps that compensate each other’s weaknesses (i.e. the accuracy of the reconstructed surface height is related to the slope of the reflectance map function and therefore using a second reflectance map can be combined to improve the reconstruction in certain areas), in order to determine the optimal illumination configuration.

Based on [23], it was further confirmed that the two image photometric stereo is more sensitive to the azimuth rather than the zenith angle difference and that the optimal value for azimuth difference is 90°. In [15] three light photometric stereo was considered and it was suggested that distributing the illumination azimuth angles uniformly through 
                        
                           360
                           °
                        
                      is optimal. A theoretical analysis of Gullon’s arrangement was presented in [32,33], based on the sensitivity analysis of photometric stereo and by deriving expressions of each surface normal vector with respect to image intensities.

It was discovered in [32] that the optimal azimuth and zenith angles cannot be specified without any assumptions and that the configuration that results the minimum noise is not unique. Instead, it was determined for a two lights Photometric Stereo that an orthogonal arrangement of the illumination vectors (with an angle of 
                        
                           90
                           °
                        
                      to each other) is the only restriction to obtain the optimal configuration. In the case of the common zenith angle being constrained, the optimal values for azimuth angles for three lights Photometric Stereo were estimated and it was suggested to use 
                        
                           120
                           °
                        
                      difference in a three-image Lambertian photometric stereo configuration.

The optimal zenith angle in the case of uniformly distributed light sources according to the azimuth was found to be around 
                        
                           55
                           °
                        
                     , but if shadows are present the angle should be reduced [32,15]. On the contrary, if the surface is smooth and shadows are not an issue, the zenith angle can be increased. Furthermore, in [10] the above was extended for n light sources and derived the same value for the optimal zenith angle when the sources are equally spaced in azimuth angles of 
                        
                           360
                           /
                           n
                        
                      degrees. It is also worth mentioning the similar methods presented in [14,16,29,20,42].

It is well known that the fraction of light reflected on an object’s surface in a certain direction depends upon the optical properties of the surface material. In this paper we use the Lambertian and Phong models, thus the fraction of the incident illumination reflected in a particular direction depends only on the surface normals. It has been proven in [10] that it is not possible to define the optimal imaging conditions without some prior knowledge about the imaged surface. In this work, we propose two novel approaches that separate the observed objects into classes which share common features and characteristics, such as similar distribution of the normals, and finds the optimal illumination conditions for each class of object (e.g. faces, bottles, round fruits, etc.).

If the purpose of imaging is to reveal the 3D structure of the surface, the assumption that the surface consists of a collection of facets, each with its own orientation and possibly albedo, has already been made. It is not possible then to select an optimal imaging configuration by considering either the characteristics of a single surface facet or the average characteristics of the full surface. Instead, the optimal configuration is selected by considering the statistical distribution of the normal vectors of the facets that make up the surface. The application of the proposed methodology is clearly for controlled environments only. For example, in an industrial inspection problem or a 3D face database creation problem, it is expected to know a priori what type of surface will be imaged. Then, from generic graphics models of surfaces of this kind, it may be assumed that the distribution of the normals of the surface is approximately known. Therefore, the proposed model is not parametric, but the required distribution of surface normals could be extracted from a generic object model of the type of object class we are interested in imaging.

At this point the relationship between the imaging resolution and the obtained surface normals should be analysed in more detail. The majority of the 3D reconstruction methods based on photometric stereo have a one-to-one relationship between the surface normals and the resolution of the acquired image. This means that each pixel corresponds to a facet with one normal. Furthermore, methods that provide subpixel reconstructions using photometric stereo are available [36] allowing lower resolution capturing devices to provide detailed estimates. It should be mentioned that this one-to-one relationship due to the lack of the correspondence problem is one of the main advantages of photometric stereo, allowing detailed reconstructions with applications to object inspection for defects, surveillance and recognition.

So, it is proposed that in case of objects (e.g. faces) that share common surface characteristics, which therefore result in similar statistical distributions of normal vectors, an optimal arrangement of the illumination directions may be obtained. The 3D surface of any face (even one of a plastic model scanned by a laser sensor) can supply us with the required distribution, as all faces are expected to have pretty similar distributions of the normals of their facets. This approach can be extended to any class of surface, not only faces, as long as they share similar facet normal distributions. With the proposed approach the optimal illumination directions are estimated once and then the obtained setup is used to capture other objects of the same class. If no prior knowledge on the distribution of the facets is available, a recursive approach may be used: a preliminary surface estimate may be obtained using a default light setting; from this estimate the optimal light setting may be worked out and the surface may be reconstructed more accurately using images captured under the new lighting arrangement. In the sections that follow, two approaches are proposed based on the above assumptions. The first one estimates the optimal illumination directions operating in the pixel domain while the second one reasons about the isophotes in the gradient domain.

The approach that operates in the pixel domain provides the optimal illumination setup both for a Lambertian and a Phong model. The solution is obtained by optimising an objective function consisting of three components that express three different factors that influence the performance of Photometric Stereo. The first component tries to maximise and enhance the visibility of the surface details; the second component tries to minimises the shadows; and the last one, that is applicable only to the Phong model, tries to determine the illumination setup that minimises the number of highlights (see Fig. 10). Regarding the shadow component it should be mentioned that only self-shadows were considered in the proposed model while cast shadows are not modelled in our simulations.

If 
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                 
                              
                           
                         is the normal vector of a surface facet, 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    i
                                 
                              
                           
                         its albedo and 
                           
                              
                                 
                                    I
                                 
                                 
                                    i
                                 
                              
                           
                         the corresponding brightness value recorded for that facet, for the Lambertian model we have
                           
                              (1)
                              
                                 
                                    
                                       I
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       L
                                    
                                    
                                       →
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       ρ
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ·
                                 
                                    
                                       L
                                    
                                    
                                       →
                                    
                                 
                              
                           
                        
                     

By incorporating the albedo into the normal vector, a generalised normal 
                           
                              
                                 
                                    
                                       
                                          N
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    i
                                 
                                 
                                    ′
                                 
                              
                              ≡
                              
                                 
                                    ρ
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    
                                       
                                          N
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                           
                         may be defined for each facet, so that
                           
                              (2)
                              
                                 
                                    
                                       I
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       L
                                    
                                    
                                       →
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                                 ·
                                 
                                    
                                       L
                                    
                                    
                                       →
                                    
                                 
                              
                           
                        Treating 
                           
                              
                                 
                                    
                                       
                                          N
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    ′
                                 
                              
                           
                         as a random variable, its distribution may be assumed known, constituting the prior knowledge we have for the problem, obtained from a training surface of similar type. In case the actual albedo of the generic model surface used is not available, it can be replaced by a uniform one without affecting the proposed methodology.

Any two neighbouring facets i and j will be recorded with brightness contrast
                           
                              (3)
                              
                                 Δ
                                 
                                    
                                       I
                                    
                                    
                                       ij
                                    
                                 
                                 (
                                 
                                    
                                       L
                                    
                                    
                                       →
                                    
                                 
                                 )
                                 =
                                 (
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       j
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 ·
                                 
                                    
                                       L
                                    
                                    
                                       →
                                    
                                 
                                 ≡
                                 Δ
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       ij
                                    
                                    
                                       ′
                                    
                                 
                                 ·
                                 
                                    
                                       L
                                    
                                    
                                       →
                                    
                                 
                              
                           
                        Over an imaged surface, 
                           
                              Δ
                              
                                 
                                    
                                       
                                          N
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    ij
                                 
                                 
                                    ′
                                 
                              
                           
                         is expected to take values from the estimated distribution of the ground truth (e.g. known class sample) as ij traces all neighbouring facets of the surface. L is the unknown illumination vector and in our problem it is constrained on a hemisphere with radius 1 (see Fig. 1
                        ), thus its position is parameterized with two angles 
                           
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                           
                         and 
                           
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                           
                        .

The idea then is to select 
                           
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                           
                         so that the spread of 
                           
                              Δ
                              
                                 
                                    I
                                 
                                 
                                    ij
                                 
                              
                           
                         is maximised, i.e. the detail seen in the image is maximised. If the distribution of 
                           
                              Δ
                              
                                 
                                    
                                       
                                          N
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    ij
                                 
                                 
                                    ′
                                 
                              
                           
                         is known, it is obvious that 
                           
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                           
                         could be estimated using a maximisation algorithm. So, the illumination direction could be estimated by maximising the sum of the magnitudes of the right-hand side of Eq. (3) for all neighbouring facets, integrated over the surface normals, given by
                           
                              (4)
                              
                                 f
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ≡
                                 
                                    
                                       1
                                    
                                    
                                       S
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ,
                                          
                                          and
                                          
                                          j
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                 
                                 
                                 |
                                 Δ
                                 
                                    
                                       N
                                    
                                    
                                       ij
                                    
                                    
                                       ′
                                    
                                 
                                 ·
                                 L
                                 |
                              
                           
                        where S is the total number of pairs 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                         considered and 
                           
                              
                                 
                                    R
                                 
                                 
                                    i
                                 
                              
                           
                         is the 4-neighbourhood of facet i.

If this function were to be minimised, however, we might end up with a large number of facets receiving no light (self-shadowed). This is undesirable in a photometric stereo application. To avoid self-shadows, the angle between the illumination direction 
                           
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                           
                         and the surface normal 
                           
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                           
                         in Eq. (1) should be in the range 
                           
                              
                                 
                                    
                                       -
                                       
                                          
                                             π
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             π
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        . So, a constraint is introduced to constrain the angles in the desirable range. We define:
                           
                              (5)
                              
                                 g
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ≡
                                 
                                    
                                       1
                                    
                                    
                                       M
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                       
                                          M
                                       
                                    
                                 
                                 
                                    
                                       W
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              
                                 
                                    W
                                 
                                 
                                    i
                                 
                              
                              =
                              1
                           
                         if 
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                 
                              
                              ·
                              L
                              >
                              0
                           
                         and 
                           
                              
                                 
                                    W
                                 
                                 
                                    i
                                 
                              
                              =
                              -
                              1
                           
                         if 
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                 
                              
                              ·
                              L
                              <
                              0
                           
                        , and M is the number of surface normals. So, instead of maximising the number of facets with 
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                 
                              
                              ·
                              L
                              >
                              0
                           
                        , the difference of the number of facets with 
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                 
                              
                              ·
                              L
                              >
                              0
                           
                         minus the number of facets with 
                           
                              
                                 
                                    N
                                 
                                 
                                    i
                                 
                              
                              ·
                              L
                              <
                              0
                           
                         is maximised. Since the number of all facets is constant, it makes no difference either only the number of facets with positive 
                           
                              
                                 
                                    W
                                 
                                 
                                    i
                                 
                              
                           
                        , or the difference of the two types of facet is maximised. The case of a 
                           
                              π
                              /
                              2
                           
                         angle is treated as neutral. Combining the two requirements (4) and (5) in a single quality function, we obtain
                           
                              (6)
                              
                                 Q
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ≡
                                 f
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 +
                                 λ
                                 g
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              λ
                              >
                              0
                           
                         is a weighting factor. Simulated annealing may be used to solve this global optimisation problem and obtain the optimal direction 
                           
                              (
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              )
                           
                         for the light source. In more details, the obtained quality function in Eq. (6) is the input to the simulated annealing and the optimal values for the 
                           
                              (
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                           
                         and 
                           
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              )
                           
                         parameters are obtained. In this way the distribution of the normals 
                           
                              Δ
                              
                                 
                                    N
                                 
                                 
                                    ′
                                 
                              
                           
                         and the self-shadow component are incorporated in the optimisation process.

The Phong model consists of three components, namely the diffuse, specular and ambient components (Fig. 2
                        ). The diffuse component is the Lambertian model. The specular component forms a lobe of reflected light which spreads out around the specular direction and is modelled by a cosine function raised to a power. The ambient component accounts for the ambient light and the inter-reflections. This model is mathematically expressed as
                           
                              (7)
                              
                                 I
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       I
                                    
                                    
                                       α
                                    
                                 
                                 +
                                 ρ
                                 
                                    
                                       L
                                    
                                    
                                       →
                                    
                                 
                                 ·
                                 
                                    
                                       N
                                    
                                    
                                       →
                                    
                                 
                                 +
                                 k
                                 
                                    
                                       (
                                       
                                          
                                             R
                                          
                                          
                                             →
                                          
                                       
                                       ·
                                       
                                          
                                             V
                                          
                                          
                                             →
                                          
                                       
                                       )
                                    
                                    
                                       m
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    I
                                 
                                 
                                    α
                                 
                              
                           
                         is the ambient constant light intensity and k is the specular reflectance coefficient. 
                           
                              
                                 
                                    V
                                 
                                 
                                    →
                                 
                              
                           
                         denotes the viewing direction, 
                           
                              
                                 
                                    R
                                 
                                 
                                    →
                                 
                              
                           
                         is the perfect reflector vector, and m controls the width of the specular lobe and it was equal to 64 in our simulations. One can easily work out that direction 
                           
                              
                                 
                                    R
                                 
                                 
                                    →
                                 
                              
                           
                         is given by 
                           
                              
                                 
                                    R
                                 
                                 
                                    →
                                 
                              
                              =
                              2
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                              (
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                              ·
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                              )
                              -
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                           
                        .

For our study the ambient light may be ignored, since it has the same constant value for all surface facets. Thus, the model of interest here consists of the Lambertian component and the highlight only. Since the Lambertian component is uniformly radiated, the position of the camera is not influenced by this. The Lambertian component is only influenced by the illumination direction, which may still be determined by the method discussed in Section 4.1. The position of the camera, however, should be such that the number of the highlights is minimised. Highlights are a nuisance when one wants to reconstruct a surface from photometric data, since the intensity saturates at the corresponding facets.

Since we must avoid highlights, the camera direction 
                           
                              
                                 
                                    V
                                 
                                 
                                    →
                                 
                              
                              ≡
                              (
                              
                                 
                                    φ
                                 
                                 
                                    v
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    v
                                 
                              
                              )
                           
                         should be selected so
                           
                              (8)
                              
                                 t
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ≡
                                 
                                    
                                       1
                                    
                                    
                                       M
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                       
                                          M
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             R
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ·
                                 
                                    
                                       V
                                    
                                    
                                       →
                                    
                                 
                              
                           
                        is minimised. Combining (6) and (8) we obtain as quality function
                           
                              (9)
                              
                                 P
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ≡
                                 f
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 +
                                 λ
                                 g
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 -
                                 κ
                                 t
                                 (
                                 
                                    
                                       φ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       l
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              κ
                              >
                              0
                           
                         is a weighting factor. Note the minus sign in front of 
                           
                              κ
                           
                        , indicating that this term has to be minimised, while the other two have to be maximised. Simulated annealing may be used to solve this global optimisation problem and obtain the optimal illumination 
                           
                              (
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              )
                           
                         and viewing 
                           
                              (
                              
                                 
                                    φ
                                 
                                 
                                    v
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    v
                                 
                              
                              )
                           
                         directions. In the Phong model case the approach is similar as in the Lamberian case but the quality function in Eq. (9) that is the input at simulated annealing contains a third component that incorporates the viewers direction in the optimisation process. Other stochastic optimisation methods may equally well be used. In our work, the directions proposed in [10] were used for initialisation.

In photometric stereo the main problem is to reconstruct the surface normals at the areas where shadows or highlights are present. Also, if the contrast is low, small irregularities, e.g. moles of a face, would not be revealed. In Eq. (9) the first term f is used to obtain the illumination direction that maximises the contrast, the second term to minimise the facets with shadows and the last one to minimise the highlights. The first and the second terms could not be combined since the contrast maximisation could be benefited by the presence of shadows and highlights.

The extension to n illumination sources for use in conjunction with photometric stereo is performed using alternating optimisation. According to this approach, the optimal light source direction of the first light is estimated using (6) or (9). During this first optimisation, the remaining illumination directions are kept constant. After the first illumination direction is obtained, the second is estimated in the same way but keeping the values estimated for the first light fixed. The remaining lights are estimated with the same process. After the directions of all light sources have been computed, the whole process is repeated until convergence is reached.

In the case of the Phong model, the viewing direction is defined only once, when the direction of the last light is worked out, since there is only a single acquisition point.

The optimisation process is performed once for each type of surface under inspection, off line, and therefore there are no issues related to the complexity and the required time for this step.

The second proposed approach to obtain the optimal illumination directions for a specific class of object (e.g. faces) that share similar distribution of normals is based on the fact that denser isophotes in the gradient space result more accurate normals during the reconstruction process. Knowing the class distribution of normals we try to estimate the illumination directions that will provide the denser isophotes to the areas with the most common and frequent normals since for most object classes a uniform distribution of normals is not the case. This idea is somehow equivalent to the idea we exploited in the previous section, since denser isophotes result from large changes in brightness between neighbouring pixels. The difference is that in that case, the term “neighbouring pixels” indicated proximity in the physical space, while here indicates proximity in the gradient space.

The reflectance characteristics of an object that are produced when a ray of light strikes its surface, (specular and diffuse) depend on the surface material, microstructure, incident wavelength, and the direction of incidence. Assuming a Lambertian surface and a viewing direction that is aligned with the z-axis of the object coordinate system, the normal vector of the surface is 
                        
                           (
                           -
                           
                              
                                 p
                              
                              
                                 n
                              
                           
                           ,
                           -
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                           ,
                           1
                           )
                        
                     , where 
                        
                           
                              
                                 p
                              
                              
                                 n
                              
                           
                           =
                           ∂
                           x
                           /
                           ∂
                           z
                        
                      and 
                        
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                           =
                           ∂
                           y
                           /
                           ∂
                           z
                        
                     . If the corresponding illumination vector is 
                        
                           (
                           -
                           
                              
                                 p
                              
                              
                                 l
                              
                           
                           ,
                           -
                           
                              
                                 q
                              
                              
                                 l
                              
                           
                           ,
                           1
                           )
                        
                     , the image intensity is calculated by taking the normalised dot product of the two vectors and multiplying it with the surface albedo 
                        
                           ρ
                           (
                           x
                           ,
                           y
                           )
                        
                     :
                        
                           (10)
                           
                              R
                              (
                              x
                              ,
                              y
                              )
                              =
                              ρ
                              (
                              x
                              ,
                              y
                              )
                              
                                 
                                    1
                                    +
                                    
                                       
                                          p
                                       
                                       
                                          l
                                       
                                    
                                    
                                       
                                          p
                                       
                                       
                                          n
                                       
                                    
                                    +
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                    
                                       
                                          q
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    
                                       
                                          1
                                          +
                                          
                                             
                                                p
                                             
                                             
                                                n
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                q
                                             
                                             
                                                n
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          1
                                          +
                                          
                                             
                                                p
                                             
                                             
                                                l
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                q
                                             
                                             
                                                l
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     If two images with different lighting directions are used, the orientation of each surface facet may be determined by the intersection of the iso-brightness contours (isophotes) of the two reflectance functions it lies on.

In general, the reflectance functions are non-linear, so more than one solutions are possible (contours may intersect at two points; twofold ambiguity). A third reflectance map, for a different illumination direction, is needed to resolve the ambiguity. The methodologies proposed in [10,15,23,32,33] for maximising the accuracy of isophote intersection determination, are based on the assumptions of isotropic and homogenous surfaces with uniform distribution of the 
                        
                           (
                           
                              
                                 p
                              
                              
                                 n
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                           )
                        
                      values of the surface facets in the reflectance map, resulting in the conclusion that the light sources should be symmetrically arranged in azimuth around the surface. These assumptions may be relaxed when some prior knowledge on the acquired surface is available.

Based on the fact that photometric stereo is most accurate in the regions of gradient space where the density of reflectance functions is high [41], a method that estimates the optimal illumination arrangement is proposed. This is self explanatory, since a reflectance map with higher density increases the probability for three or more isophotes to cross through a single point, providing an accurate solution for the system. Assuming a given surface material, ie fixed 
                        
                           ρ
                           (
                           x
                           ,
                           y
                           )
                        
                     , and point light sources, the angle between the viewer and the light source is one of the main parameters that affect this accuracy. In this case, the density of reflectance map contours increases for larger zenith angles, which at the same time increases the shadowed areas. So, a compromise should be reached. A second determiner of the accuracy is the choice of the relative directions of the light sources. Assuming that a rough model of the observed object is known (e.g. an average face in case of 3D face reconstruction applications), and therefore the distribution of its facets’ orientations is known, the illumination angles may be adjusted in such a way, that areas with dense surface normals 
                        
                           (
                           
                              
                                 p
                              
                              
                                 n
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                           )
                        
                      will also be covered densely by isophotes (see Fig. 3
                     ).

Let us assume an illumination direction
                        
                           (11)
                           
                              
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                              =
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    l
                                 
                              
                              )
                              =
                              (
                              sin
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              cos
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                              ,
                              sin
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              sin
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                              ,
                              cos
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          
                                             
                                                p
                                             
                                             
                                                l
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                q
                                             
                                             
                                                l
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          1
                                       
                                    
                                 
                              
                              (
                              -
                              
                                 
                                    p
                                 
                                 
                                    l
                                 
                              
                              ,
                              -
                              
                                 
                                    q
                                 
                                 
                                    l
                                 
                              
                              ,
                              1
                              )
                           
                        
                     where 
                        
                           cos
                           
                              
                                 θ
                              
                              
                                 l
                              
                           
                           =
                           
                              
                                 1
                              
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             l
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             q
                                          
                                          
                                             l
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       1
                                    
                                 
                              
                           
                        
                     , 
                        
                           
                              
                                 p
                              
                              
                                 l
                              
                           
                           =
                           cos
                           
                              
                                 φ
                              
                              
                                 l
                              
                           
                           tan
                           
                              
                                 θ
                              
                              
                                 l
                              
                           
                        
                      and 
                        
                           
                              
                                 q
                              
                              
                                 l
                              
                           
                           =
                           sin
                           
                              
                                 φ
                              
                              
                                 l
                              
                           
                           tan
                           
                              
                                 θ
                              
                              
                                 l
                              
                           
                        
                     . So, for a given surface normal 
                        
                           
                              
                                 N
                              
                              
                                 →
                              
                           
                           =
                           
                              
                                 1
                              
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             q
                                          
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       1
                                    
                                 
                              
                           
                           (
                           -
                           
                              
                                 p
                              
                              
                                 n
                              
                           
                           ,
                           -
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                           ,
                           1
                           )
                        
                      the intensity of this facet, given by Eq. (10), depends only on the azimuth 
                        
                           
                              
                                 φ
                              
                              
                                 l
                              
                           
                        
                      and zenith 
                        
                           
                              
                                 θ
                              
                              
                                 l
                              
                           
                        
                      angles (and the albedo).

If we assume that the 
                        
                           (
                           
                              
                                 p
                              
                              
                                 n
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                           )
                        
                      values are uniformly distributed in a square area of the reflectance map, corresponding to the case of an isotropic and uniformly rough surface, the density of the isophotes should be uniform too in the same area of the 
                        
                           (
                           p
                           ,
                           q
                           )
                        
                      space, in order to achieve a uniformly reliable recovery of all the surface normals. However for faces or other anisotropic surfaces, the lights should be arranged in such a way that the areas with more 
                        
                           (
                           
                              
                                 p
                              
                              
                                 n
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                           )
                        
                      points should be covered by more isophotes. So, the directions should be selected to satisfy the above requirement and they may be estimated using the following optimisation methodology.

Without any loss of generality, let us assume that our object class of interest is human faces. Let us consider that we have at our disposal the model of a 3D human face, obtained from a mannequin. This 3D surface represents the average face containing the most common facial characteristics and features.

Let us assume that the model face consists of M vertices and let an 
                        
                           M
                           ×
                           2
                        
                      matrix 
                        
                           W
                        
                      contain the directions of the vertices’ normals. The third component of the normal is discarded as being fully defined by the other two, due to the choice of the coordinate system we use.

So, 
                        
                           
                              
                                 W
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 p
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                              
                           
                           )
                        
                     , where 
                        
                           
                              
                                 p
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                              
                           
                           =
                           
                              
                                 dx
                              
                              
                                 i
                              
                           
                           /
                           
                              
                                 dz
                              
                              
                                 i
                              
                           
                        
                      and 
                        
                           
                              
                                 q
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                              
                           
                           =
                           
                              
                                 dy
                              
                              
                                 i
                              
                           
                           /
                           
                              
                                 dz
                              
                              
                                 i
                              
                           
                        
                     . The normals are quantised and their histogram 
                        
                           
                              
                                 W
                              
                              
                                 h
                              
                           
                           =
                           h
                           (
                           W
                           )
                        
                      is obtained containing m discrete entries keeping their number equal to the number of vertices (i.e. pixels on the 2D height map, with one axis for q and one for p). Some examples of 
                        
                           
                              
                                 W
                              
                              
                                 h
                              
                           
                        
                      are shown in Fig. 4
                     .

Since the normals are discretized on the 
                        
                           (
                           p
                           ,
                           q
                           )
                        
                      plane, their range is known with the vectors 
                        
                           P
                        
                      and 
                        
                           Q
                        
                      containing all possible values in each axis (i.e. the range of the normals’ values). For all these discrete normals, the reflectance map for a given illumination direction 
                        
                           (
                           
                              
                                 p
                              
                              
                                 l
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 l
                              
                           
                           )
                        
                      may be estimated using Eq. (10) and be represented as:
                        
                           (12)
                           
                              
                                 
                                    R
                                 
                                 
                                    ij
                                 
                                 
                                    (
                                    k
                                    )
                                 
                              
                              =
                              ρ
                              
                                 
                                    1
                                    +
                                    
                                       
                                          p
                                       
                                       
                                          lk
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          i
                                       
                                    
                                    +
                                    
                                       
                                          q
                                       
                                       
                                          lk
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    
                                       
                                          1
                                          +
                                          
                                             
                                                P
                                             
                                             
                                                i
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                Q
                                             
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          1
                                          +
                                          
                                             
                                                p
                                             
                                             
                                                lk
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                q
                                             
                                             
                                                lk
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              
                                 R
                              
                              
                                 ij
                              
                              
                                 (
                                 k
                                 )
                              
                           
                        
                      is the value of the reflectance map (isophota) at location ij for the k illumination direction.

So, the illumination directions of k lights should be selected to satisfy the above requirement. They may be estimated by maximising the sum of the gradient magnitudes of Eq. (12) for the K light sources, integrated over the whole available range of normals, given by
                        
                           (13)
                           
                              f
                              (
                              
                                 
                                    p
                                 
                                 
                                    
                                       
                                          l
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    q
                                 
                                 
                                    
                                       
                                          l
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              )
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       I
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       J
                                    
                                 
                              
                              
                                 
                                    W
                                 
                                 
                                    h
                                 
                              
                              (
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              )
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                k
                                                =
                                                1
                                             
                                             
                                                K
                                             
                                          
                                       
                                       ∥
                                       ∇
                                       
                                          
                                             R
                                          
                                          
                                             ij
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                       ∥
                                    
                                 
                              
                           
                        
                     where 
                        
                           ‖
                           ∇
                           
                              
                                 R
                              
                              
                                 ij
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           ‖
                           =
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         R
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         R
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     . An example of 
                        
                           R
                        
                      and 
                        
                           f
                           (
                           
                              
                                 p
                              
                              
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 
                                    
                                       l
                                    
                                    
                                       i
                                    
                                 
                              
                           
                           )
                        
                      is shown in Fig. 5
                     . We use simulated annealing to solve this global optimisation problem and obtain the optimal 
                        
                           (
                           
                              
                                 p
                              
                              
                                 l
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 l
                              
                           
                           )
                        
                      values for the light sources. Once the light gradients 
                        
                           (
                           
                              
                                 p
                              
                              
                                 l
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 l
                              
                           
                           )
                        
                      for each light source, that maximise our requirements have been estimated, we can obtain the directions of the lights because the zenith angle was considered constant and known.

@&#EXPERIMENTS AND RESULTS@&#

The idea of the experiments is to reconstruct a surface by using photometric stereo images of the surface, once captured under ‘default illumination directions’ (as proposed in [10]) and once captured under optimal illumination directions, as specified by the proposed methods. The aim is to show that more accurate reconstructions are obtained when the lighting directions have been selected by the proposed approaches. For all reconstructions, the standard 4-lights photometric stereo algorithm was used, without applying any techniques to exclude pixels affected by shadows or highlights. Initially, simulated surfaces are constructed from which photometric image sets are created. Also 3D models of human faces are used to perform controlled experiments. Three different textures were used to simulate albedo (see Fig. 6
                     ) on randomly generated isotropic and anisotropic surfaces. In the case of surfaces of human faces, a uniform grey colour was used, as well as their real albedo.

In more details our testing surfaces in the case of the isotropic contain a facet at each pixel location with the distribution of the normals to be uniform. In order to obtain these surfaces we restrict the orientation of the normals to be on a hemisphere and we sample uniformly obtaining the isotropic surfaces. In the anisotropic case the surfaces contain mainly ripples of different lengths and orientations and as a result this orientation reflects on the orientation of the distribution of the normals. Also faces were used that have anisotropic distribution of normals but there is an axis of symmetry. All the simulated models were rendered in the same way using the Phong model in order to avoid unfair comparisons. Furthermore, regarding the real data faces, bottles and other objects were used with or without ground truth depending on each case. Also it should be mentioned that both the simulated isotropic and anisotropic surfaces are not perfect isotropic and anisotropic due to the random generation of facets and the cropping the obtained distributions of the normals are not completely uniform.

Before we move to the actual evaluation of the proposed methods an experiment was performed to observe the optimisation landscape of the optimisation algorithm that was utilised. Therefore, we keep three of the four lights fixed and we optimise only for the last one and then in Fig. 7
                      the accuracy of reconstruction as a function of the direction of the 4th light source during the optimisation process is plotted. From the figure it can be seen that the illumination direction stabilises after approximately 1200 iterations close to the overall minimum.

Regarding the first method, in order to select the proper values for the weights 
                           
                              κ
                           
                         and 
                           
                              λ
                           
                         in Eqs. (6) and (9), some pilot experiments were performed to identify the order of magnitude of each term. The histograms of each of these terms are shown in Fig. 8
                        . It may be inferred that all of them are of the same order of magnitude but the modes of their values are not balanced. In this work we assume that each component is equally important in the quality functions and therefore these weights are select to secure this assumption and provide a global optimal with each term contributing the same. Therefore, the weights 
                           
                              λ
                           
                         and 
                           
                              κ
                           
                         should be properly selected to make the modes of all terms roughly the same, so all terms play role in the optimisation. From these histograms, it is inferred that 
                           
                              λ
                              ∼
                              0.5
                           
                         and 
                           
                              κ
                              ∼
                              2
                           
                        .

As simulated annealing works by minimising a cost function, while quality functions have been defined that have to be maximised, the cost function used in the optimisation step was 
                           
                              -
                              Q
                              (
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              )
                           
                         or 
                           
                              -
                              P
                              (
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    φ
                                 
                                 
                                    v
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    v
                                 
                              
                              )
                           
                        .


                        Fig. 9
                         shows the plots of the minimisation of these functions for an example case. In Fig. 10
                         the value of each of the terms considered in the construction of quality function 
                           
                              P
                              (
                              
                                 
                                    φ
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    l
                                 
                              
                              ,
                              
                                 
                                    φ
                                 
                                 
                                    v
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    v
                                 
                              
                              )
                           
                         at each pixel is shown, for specific values of the illumination and viewing directions, and for a particular example case. Furthermore, in Fig. 10 we have a visual representation of all terms 
                           
                              f
                              ,
                              g
                           
                         and t in Eqs. (6) and (9). Column 
                           
                              (
                              c
                              )
                           
                         corresponds to term f that represents the relative orientation between neighbouring facets trying to maximise the local contrast and improve the visibility of local detail; column 
                           
                              (
                              d
                              )
                           
                         corresponds to term g trying to minimise the self-shadows; and column 
                           
                              (
                              e
                              )
                           
                         corresponds to term t indicating the highlights present in the image. Therefore, it is clear that Eqs. (6) and (9) depend on the contents of the input images.

Experiments were performed with three sets of surface data: isotropic surfaces, anisotropic surfaces and simulated human faces with the terms isotropic and anisotropic we refer to the distribution of the surface normals. For all these surfaces the normal vector of each facet (ground truth) is known. For each set of surfaces, that share common characteristics and statistics related to the surface normals, the directions of four light sources were calculated using the proposed methodology. A subset of surfaces for each surface class was used to obtain the optimal illumination directions for the corresponding set. The mean illumination configuration from the training subset was selected and applied to the surfaces of the test subset. The term ‘mean’ corresponds to the average four vectors of all the surfaces in the training subset of each surface class. Regarding the first approach, in order to identify the corresponding illumination directions, which had to be averaged, the k-means clustering algorithm was used in the 
                        
                           (
                           
                              
                                 φ
                              
                              
                                 l
                              
                           
                           ,
                           
                              
                                 θ
                              
                              
                                 l
                              
                           
                           )
                        
                      space to partition all the estimated directions into four clusters. The mean for each cluster was calculated providing the direction of one light source. Fig. 11
                      shows some examples of the obtained clusters for different classes of surfaces used in our experiments.

In order to compare the performance of the proposed approaches, the angular error (AE) measure suggested by Beauchemin et al. [2] was used:
                        
                           (14)
                           
                              
                                 
                                    Ψ
                                 
                                 
                                    AE
                                 
                              
                              =
                              
                                 
                                    cos
                                 
                                 
                                    -
                                    1
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   e
                                                
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   c
                                                
                                             
                                             +
                                             
                                                
                                                   y
                                                
                                                
                                                   e
                                                
                                             
                                             
                                                
                                                   y
                                                
                                                
                                                   c
                                                
                                             
                                             +
                                             
                                                
                                                   z
                                                
                                                
                                                   e
                                                
                                             
                                             
                                                
                                                   z
                                                
                                                
                                                   c
                                                
                                             
                                             +
                                             1
                                          
                                          
                                             
                                                
                                                   1
                                                   +
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   1
                                                   +
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         e
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         e
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         e
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     Here 
                        
                           
                              
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       e
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       e
                                    
                                 
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       e
                                    
                                 
                                 )
                              
                              
                                 T
                              
                           
                        
                      and 
                        
                           
                              
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       r
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       r
                                    
                                 
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       r
                                    
                                 
                                 )
                              
                              
                                 T
                              
                           
                        
                      are the estimated and the real surface normals for a particular facet, respectively.

Furthermore, since the real albedo was available, the mean absolute difference between true and worked out albedo was used to compare the performance of the proposed methodologies
                        
                           (15)
                           
                              
                                 
                                    ∊
                                 
                                 
                                    AD
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    MN
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       M
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                              
                              ∣
                              
                                 
                                    A
                                 
                                 
                                    e
                                 
                              
                              (
                              i
                              ,
                              j
                              )
                              -
                              
                                 
                                    A
                                 
                                 
                                    r
                                 
                              
                              (
                              i
                              ,
                              j
                              )
                              ∣
                           
                        
                     where 
                        
                           
                              
                                 A
                              
                              
                                 e
                              
                           
                        
                      and 
                        
                           
                              
                                 A
                              
                              
                                 r
                              
                           
                        
                      are the estimated and the real albedo, respectively.

Fifteen isotropic surfaces for training were used and fifteen for evaluation (see Fig. 12
                     ). The surfaces were created to contain random peaks with low altitude, in order to avoid cast-shadows and provide a uniform distribution of normals. In all cases, the simulated annealing was initialised with the ‘default’ vectors for the illumination directions and with the 
                        
                           z
                        
                     -axis for the viewing direction. In Fig. 13
                      the worked out illumination directions are shown for both methods. It can be seen that, as expected, they are uniformly distributed about the surface. In the first row of Tables 1–3
                     
                     
                      the average angular and albedo errors for the isotropic surfaces for the Lambertian and the Phong models respectively are shown for all three textures that were used (see Fig. 6). Figs. 14 and 15
                     
                      show the angular error in degrees and the albedo difference as a function of the isotropic surfaces, respectively. The mean error of the recovered albedo is insignificant either the default illumination directions or the worked out ones were used.

From the results about the second approach, we may observe that for the case of 4-lights photometric stereo, the lights should be located close to the corners of a square as it was expected, since the simulated data satisfy the required assumption of a uniformly rough surface. Based on Eq. (11) the azimuth angle is given by 
                        
                           
                              
                                 φ
                              
                              
                                 l
                              
                           
                           =
                           
                              
                                 tan
                              
                              
                                 -
                                 1
                              
                           
                           (
                           
                              
                                 q
                              
                              
                                 l
                              
                           
                           /
                           
                              
                                 p
                              
                              
                                 l
                              
                           
                           )
                        
                      indicating that the angle remains the same when the ratio of the illumination directions is constant.

Next, four sets of anisotropic surfaces (Fig. 16
                     ) were used. The selection of these examples and these orientations was mainly to allow us to demonstrate that the obtained estimates are correct and according the expectations of the proposed methods. In each set there were seven surfaces with different appearance, but all with prominent anisotropy in the same direction. From the seven surfaces, three were used for training and four for testing. The estimated illumination directions for the anisotropic surfaces are shown in Fig. 17
                      coinciding with the directions of the gradients and exploiting the density of the isophotes as it was expected for both approaches. The average angular error is given in Tables 1 and 2 for the Lambertian and the Phong models, respectively, in rows two to five. It should be mentioned again that the the Phong model is applicable only for the first method. The average albedo error for each of the four directions is shown in Table 4
                      for both methods and the Lambertian model and in Table 5
                      only for the first approach and the Phong model. It may be observed that the proposed methodologies results more accurate normals with significant error reduction. Also from the obtained results it is observed that the first proposed method outperforms in the case of textured data in general, mainly due to the first term in Eqs. (6) and (9) that takes in to account the local surface deformations while the other approaches assume it is constant providing an advantage in these cases. In figures Figs. 18 and 19
                     
                      the angular and the mean absolute error for the anisotropic surfaces using the ‘default’ illumination configuration, versus the proposed one are shown. Observing the figures, we can see that the first method gives different results for the two models (Lambertian-left and Phong-right) due to the different illumination directions. Regarding the default lights, since they are the same illumination setup in both cases and the percentage of the highlights present in the images is very low compared with the total number of pixels, the average difference is almost negligible between the two models (Lambertian and Phong) for the first method. Even the average contribution of the highlights to the total error is very low, their removal is regarded essential due to the fact that highlights create local peaks that can affect significantly the visual outcome. Similar results were obtained for 
                        
                           λ
                        
                      in the range [0.5,0.75] and 
                        
                           κ
                        
                      in the range [1.5,2].

Further experiments were performed using faces (Fig. 20
                     ). The estimated optimal mean illumination directions of the lights are shown in Fig. 21
                      and all the results for each face are shown in Table 6
                     . Observing the results it may be seen that for the faces the optimal illumination directions are from the left and the right sides of the facial axis of symmetry, a bit lower than the chin or at the level of the eyes. The main difference is the angle 
                        
                           θ
                        
                      that is smaller in the case of Phong model with a small change in the viewing direction. The differences are due to the extra component in the objective functions that tries to reduce the presence of highlights and also to specify the optimal viewing direction which is not an issue for the Lambertian model. The mean angular and albedo errors for each face are shown in Figs. 22 and 23
                     
                     . All mean errors are shown in Tables 1, 2, 7 and 8
                     
                     . Similar results were obtained for 
                        
                           λ
                        
                      in the range 
                        
                           [
                           0.5
                           ,
                           0.75
                           ]
                        
                      and 
                        
                           κ
                        
                      in the range 
                        
                           [
                           1.5
                           ,
                           2
                           ]
                        
                     . This can be observed in figure Fig. 24
                      which shows the error versus the values of 
                        
                           λ
                        
                      and 
                        
                           κ
                        
                     . Observing the results of the second method, we may say that it provides illumination configurations that adjust the isophotes in order to achieve higher density at more frequented areas on the pq-plane (i.e. more frequently encountered normals).

Having learnt the optimal illumination directions from the simulated faces and anisotropic surfaces, now these arrangements are tested with real surfaces of similar type, for which the ground truth is available with the help of the 3dMD imaging system [26]. In particular, two mannequin faces (see Fig. 25
                     ) will be reconstructed using the optimal illumination directions reported in Tables 9 and 10
                     
                      and the reconstruction will be compared with the real height maps worked by the 3dMD scanner. In addition, a bottle, which may be thought of as a ribbed anisotropic surface, will also be tested using the optimal illumination directions for such surfaces, also reported in Tables 9–12
                     
                      and in Figs. 32–34. It can be observed that the optimal viewing direction is effectively at the zenith.

For these experiments, the sum of the absolute height map difference, between the estimated reconstructed surface, using Photometric Stereo, and the ground truth, obtained using the 3dMD imaging system, was used to compare the accuracy of the proposed methodology:
                        
                           (16)
                           
                              
                                 
                                    h
                                 
                                 
                                    EG
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    MN
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       M
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                              
                              ∣
                              
                                 
                                    H
                                 
                                 
                                    e
                                 
                              
                              (
                              i
                              ,
                              j
                              )
                              -
                              
                                 
                                    H
                                 
                                 
                                    r
                                 
                              
                              (
                              i
                              ,
                              j
                              )
                              ∣
                           
                        
                     where 
                        
                           
                              
                                 H
                              
                              
                                 e
                              
                           
                        
                      and 
                        
                           
                              
                                 H
                              
                              
                                 r
                              
                           
                        
                      are the estimated and the real height maps, respectively.

Each object was illuminated both from the default and the estimated optimal directions. The captured images are shown in Figs. 26–28
                     
                     
                     . Using the images captured from the default and the estimated optimal light sources, Photometric Stereo and integration are applied in succession, in order to obtain the 3D surfaces for both illumination configurations. Using the Iterative Closest Point algorithm [6] the obtained surfaces are aligned with the corresponding surfaces captured from the 3dMD imaging system. In order to evaluate the accuracy of the obtained surfaces, the absolute height map difference in Eq. (16) was utilised. The reconstructed 3D surfaces for both configurations are shown in Figs. 29–31
                     
                     
                     . Observing the surfaces, we may say that the proposed configuration produces fewer shadows with more details revealed especially close to the ears and the chin. Also, the seams created at the borders of shadowed and non-shadowed areas are less pronounced. The average absolute height map difference is shown in Table 13
                      with the proposed illumination configuration resulting in lower errors.
                     
                     
                  

The proposed algorithm was further applied to the reconstruction of six real human faces and four potatoes (see Fig. 35
                     ) using photometric data captured both with the default and the proposed illumination directions. The person is assumed to be still during the acquisition stage since a high speed camera was used for the acquisition (i.e. 200 frames per second), eliminating the registration problem.

In Figs. 36 and 37
                     
                      results of the reconstructed faces and potatoes obtained from the two compared illumination setups are shown. Observing the results it can be inferred that the proposed illumination directions result more accurate estimates especially at the region under the jaw indicating that the proposed illumination directions provide more accurate reconstructions for faces. Furthermore, the side view was used to evaluate the performance of the proposed iterative approach. The background was extracted manually and the Hausdorff distance was used to compare the reconstructions with the original profiles. Tables 14 and 15
                     
                      shows all the results for all the faces and objects. The obtained results can provide indications to practitioners on how to arrange the capturing system selecting the appropriate number and locations of the lights. In the results presented above different configurations are proposed based on the object class trying to provide most accurate reconstructions keeping the amount of lights constant.

@&#CONCLUSIONS@&#

In this paper, two methods for estimating the optimal illumination and viewing direction were proposed assuming that prior knowledge of the statistical distribution of the surface to be reconstructed is available. The first approach estimates the optimal illumination conditions taking into consideration three parameters; and according to this approach the effects of shadows and highlights are minimised, while it tries to maximise the distinctiveness of surface detail. The second approach is based on the fact that denser isophotes in the gradient space result more accurate normals during the reconstruction process. This method tries to estimate the illumination directions that will provide the denser isophotes to the areas with the most frequent normals.

Experiments with simulated and real surfaces were performed in order to evaluate the performance of the proposed schemes. From the results it could be inferred that both methods provide similar results with the first approach to outperform especially in the case of rough surfaces, mainly due to the third parameter in the optimisation function related to the surface roughness. Regarding the faces, the optimal directions are not uniformly distributed but the lights at the top and bottom of the face are closer compared to the sides. Similar outcome was obtained for the anisotropic surfaces but rotated according to the surface directionality. The surfaces with near isotropic facets the obtained distribution of the light sources is almost uniform, and this is further affected by the roughness of the surface. About the estimated zenith angle, it is at the same range for isotropic surfaces but in case of faces, it is significantly lower with the variations in general to depend on the morphology of the surface and the presence of cast shadows. In order to further evaluate the obtained estimates, experiments were performed with real faces and other objects indicating the improvement in 3D reconstruction by selecting the appropriate illumination directions.

@&#REFERENCES@&#

