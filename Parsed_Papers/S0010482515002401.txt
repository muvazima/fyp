@&#MAIN-TITLE@&#Wavelet analysis of cardiac optical mapping data

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Optical mapping (OM) technology is important to study cardiac electrophysiology.


                        
                        
                           
                           Wavelet analysis offers simultaneous localization in time and frequency domains.


                        
                        
                           
                           Wavelet analysis improved the signal quality compared to Fourier-based filtering.


                        
                        
                           
                           Spatial wavelet filtering produced more accurate conduction velocity estimates.


                        
                        
                           
                           Wavelet analysis is a promising tool for OM electrophysiological characterization.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Signal processing

Action potential

Optical mapping

Filtering methods

Cardiac electrophysiology

Conduction analysis

Bioengineering

Heart arrhythmias

@&#ABSTRACT@&#


               
               
                  Background
                  Optical mapping technology is an important tool to study cardiac electrophysiology. Transmembrane fluorescence signals from voltage-dependent dyes need to be preprocessed before analysis to improve the signal-to-noise ratio. Fourier analysis, based on spectral properties of stationary signals, cannot directly provide information on the spectrum changes with respect to time. Fourier filtering has the disadvantage of causing degradation of abrupt waveform changes such as those in action potential signals. Wavelet analysis has the ability to offer simultaneous localization in time and frequency domains, suitable for the analysis and reconstruction of irregular, non-stationary signals like the fast action-potential upstroke, and better than conventional filters for denoising.
               
               
                  Methods
                  We applied discrete wavelet transformation for temporal processing of optical mapping signals and wavelet packet analysis approaches to process activation maps from simulated and experimental optical mapping data from canine right atrium. We compared the results obtained with the wavelet approach to a variety of other methods (Fast Fourier Transformation (FFT) with finite or infinite response filtering, and Gaussian filters).Results: Temporal wavelet analysis improved signal-to-noise ratio (SNR) better than FFT filtering for 5–10dB SNR, and caused less distortion of the action potential waveform over the full range of simulated noise (5–20dB). Spatial wavelet filtering produced more efficient denoising and/or more accurate conduction velocity estimates than Gaussian filtering. Propagation patterns were also best revealed by wavelet filtering.Conclusions: Wavelet analysis is a promising tool, facilitating accurate action potential characterization, activation map formation, and conduction velocity estimation.
               
            

@&#INTRODUCTION@&#

Optical mapping is a very important tool to study cardiac electrophysiology ex vivo. This technique has the advantages of high spatiotemporal resolution of intracellular signals, which traditional intracellular and extracellular recording methods lack [1]. Optical action potentials (APs) have individual properties that differ from single cell measurements recorded with intracellular electrodes [2,3]. Given the benefit of high spatial resolution, optical imaging can record the propagation of the electrical wavefront over the surface of the heart to study electrical properties in normal and pathological conditions. Even though there have been great advances in imaging devices and voltage-sensitive dyes, challenges to recording high quality optical signal remain. In particular, transmembrane fluorescence signals emitted by voltage-sensitive dyes typically have low signal-to-noise ratio (SNR), which can hamper analysis [1]. Processing of optical mapping data can degrade the waveforms and alter physiologically relevant properties, leading to misinterpretations of physiological significance [1].

Wavelet analysis is an interesting method applied in many fields like mathematics, physics, engineering, and computer science [4–6]. The method, based on decomposing the signal into basic forms at different positions and scales, can be used for subsequent signal reconstruction with high precision. The main advantage of the wavelet approach is its ability to offer simultaneous localization in time and frequency domains, whereas the standard Fourier transformation is only specified in the frequency domain. Consequently, wavelet analysis has advantages in analyzing irregular and non-stationary waveforms. Cardiac APs generally have sharp upstrokes, for which the high frequency components are very rich over a very short period. Wavelet analysis might provide a powerful tool for the characterization of electrophysiological optical mapping data.

The objective of this study was to investigate the use of wavelet analysis as a temporal and spatial processing method for cardiac optical mapping data. Here, we first compare the temporal wavelet approach to Fourier filtering methods, specifically the Finite Impulse Response (FIR) and Infinite Impulse Response (IIR) filtering methods, on simulated optical APs and real canine atrial optical data. We then follow with a comparison between 2D spatial wavelet processing of activation maps and conduction velocity estimation with Gaussian kernel approach. Our results suggest that wavelet analysis is a promising technique for the processing and analysis of cardiac optical mapping data.

@&#METHODS@&#

The wavelet transform and its multi-resolution implementation provide an analysis of the signal that is localized in both time and frequency. Given a mother wavelet ψ(t), the wavelet series will be
                           
                              (1)
                              
                                 
                                    
                                       Ψ
                                    
                                    
                                       a
                                       ,
                                       b
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    1
                                    
                                       
                                          a
                                       
                                    
                                 
                                 ψ
                                 
                                    (
                                    
                                       
                                          
                                             t
                                             −
                                             b
                                          
                                          a
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        where 
                           a
                           ,
                           b
                           ∈
                           R
                           ,
                           
                           and
                           
                           a
                           ≠
                           0
                           .
                         Here a and b are the dilating and translating coefficients respectively. The continuous wavelet transform (CWT) of the function 
                           f
                           
                              (
                              t
                              )
                           
                           ∈
                           
                              
                                 L
                              
                              2
                           
                        , is expressed as
                           
                              (2)
                              
                                 
                                    
                                       W
                                    
                                    
                                       f
                                       
                                          (
                                          
                                             a
                                             ,
                                             b
                                          
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    |
                                    
                                       
                                          
                                             a
                                          
                                          
                                             −
                                             1
                                             /
                                             2
                                          
                                       
                                    
                                    |
                                 
                                 
                                    ∫
                                    R
                                 
                                 f
                                 (
                                 t
                                 )
                                 
                                    
                                       ψ
                                    
                                    ⁎
                                 
                                 
                                    (
                                    
                                       
                                          
                                             t
                                             −
                                             b
                                          
                                          a
                                       
                                    
                                    )
                                 
                                 d
                                 a
                                 d
                                 b
                                 .
                              
                           
                        Practically, 
                           
                           
                              
                                 W
                              
                              
                                 f
                                 
                                    (
                                    
                                       a
                                       ,
                                       b
                                    
                                    )
                                 
                              
                           
                         is sampled on a dyadic grid, i.e., a=
                           
                              
                                 2
                              
                              
                                 −
                                 m
                              
                           
                         (dyadic dilation) and b=
                           n
                           ⋅
                           
                              
                                 2
                              
                              
                                 −
                                 m
                              
                           
                         (dyadic position), with 
                           m
                           ,
                           n
                           ∈
                           Z
                        .

The discrete fast wavelet transform can be computed efficiently by using Mallat׳s algorithm with series of conjugate mirror filter pairs [7]. The decomposition level is obtained by using two complementary high-pass (
                           g
                           [
                           n
                           ]
                        ) and low-pass (
                           h
                           [
                           n
                           ]
                        ) filters under the following condition:
                           
                              (3)
                              
                                 
                                 g
                                 
                                    [
                                    
                                       L
                                       −
                                       1
                                       −
                                       n
                                    
                                    ]
                                 
                                 =
                                 
                                    
                                       (
                                       −
                                       1
                                       )
                                    
                                    n
                                 
                                 h
                                 [
                                 n
                                 ]
                                 ,
                              
                           
                        where L is the filter length. The high-pass and low-pass filters used in the algorithm are determined according to the mother wavelet [4]. The outputs from the 
                           h
                           [
                           n
                           ]
                         filter are refered to as approximation coefficients 
                           a
                           (
                           n
                           )
                         and the outputs from the 
                           g
                           [
                           n
                           ]
                         filters are referred to as detail coefficients 
                           d
                           (
                           n
                           )
                        . The two filtering and sampling operations can be expressed by
                           
                              (4)
                              
                                 
                                    
                                       a
                                    
                                    
                                       j
                                       +
                                       1
                                    
                                 
                                 [
                                 k
                                 ]
                                 =
                                 
                                    ∑
                                    n
                                 
                                 
                                    
                                       a
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 n
                                 )
                                 ⋅
                                 h
                                 [
                                 2
                                 k
                                 −
                                 n
                                 ]
                                 ,
                              
                           
                        
                        
                           
                              (5)
                              
                                 
                                 
                                    
                                       d
                                    
                                    
                                       j
                                       +
                                       1
                                    
                                 
                                 [
                                 k
                                 ]
                                 =
                                 
                                    ∑
                                    n
                                 
                                 
                                    
                                       a
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 n
                                 )
                                 ⋅
                                 g
                                 [
                                 2
                                 k
                                 −
                                 n
                                 ]
                                 ,
                              
                           
                        where, j>0 represents the jth decomposition level. For j=0, 
                           
                              
                                 a
                              
                              
                                 0
                              
                           
                           (
                           n
                           )
                         is the original signal to be analyzed.

The denoising procedure consisted of the following three steps: (1) Wavelet transform to obtain the approximation and detail coefficients 
                           a
                           (
                           n
                           )
                         and 
                           d
                           (
                           n
                           )
                         for levels j up to j
                        
                           max
                        ; (2) Selection of an optimal thresholding value to determine the set of detail coefficients; and (3) Reconstruction of the signal from the thresholded detail coefficients. With 
                           
                              
                                 f
                              
                              
                                 s
                                 /
                                 2
                              
                           
                         being half of the sampling frequency, each level j roughly corresponds to the frequency band between 
                           
                              
                                 2
                              
                              
                                 −
                                 j
                              
                           
                           
                              
                                 f
                              
                              
                                 s
                                 /
                                 2
                              
                           
                         and 
                           
                              
                                 2
                              
                              
                                 −
                                 j
                                 +
                                 1
                              
                           
                           
                              
                                 f
                              
                              
                                 s
                                 /
                                 2
                              
                           
                        .

For orthogonal or biorthogonal wavelets, the maximum decomposition level is determined by the length of the signal (N) and of the decomposition filter (L). Generally, the decomposition level j is selected at a level smaller than j
                        
                           max
                         (Eq. (6)), as long as the characteristic frequency of the signal is covered by the band [
                           
                              
                                 2
                              
                              
                                 −
                                 j
                              
                           
                           
                              
                                 f
                              
                              
                                 s
                                 /
                                 2
                              
                           
                           ,
                         
                        
                           
                              
                                 2
                              
                              
                                 −
                                 j
                                 +
                                 1
                              
                           
                           
                              
                                 f
                              
                              
                                 s
                                 /
                                 2
                              
                           
                        ] [8], where
                           
                              (6)
                              
                                 
                                    
                                       j
                                    
                                    
                                       m
                                       a
                                       x
                                    
                                 
                                 =
                                 floor
                                 (
                                 log
                                 (
                                 N
                                 /
                                 (
                                 L
                                 −
                                 1
                                 )
                                 )
                                 /
                                 
                                 log
                                 (
                                 2
                                 )
                                 )
                                 .
                              
                           
                        For the simulated data and experimental data shown in the paper, j
                        
                           max
                         was in the range between 4 and 8. The waveform of the synthesis and the analysis filters are identical, except for a time reversal.

Therefore, the reconstruction formula for each layer becomes
                           
                              (7)
                              
                                 
                                    
                                       
                                          a
                                          ^
                                       
                                    
                                    
                                       j
                                    
                                 
                                 
                                    [
                                    n
                                    ]
                                 
                                 =
                                 
                                    ∑
                                    
                                       k
                                       =
                                       −
                                       ∞
                                    
                                    ∞
                                 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                d
                                                ^
                                             
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          [
                                          k
                                          ]
                                       
                                       ⋅
                                       g
                                       
                                          [
                                          
                                             −
                                             n
                                             +
                                             2
                                             k
                                          
                                          ]
                                       
                                       +
                                       
                                          
                                             
                                                a
                                                ^
                                             
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          [
                                          k
                                          ]
                                       
                                       ⋅
                                       h
                                       
                                          [
                                          
                                             −
                                             n
                                             +
                                             2
                                             k
                                          
                                          ]
                                       
                                    
                                    )
                                 
                                 
                                 .
                              
                           
                        Here 
                           
                              
                                 
                                    a
                                    ^
                                 
                              
                              
                                 j
                                 +
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    d
                                    ^
                                 
                              
                              
                                 j
                                 +
                                 1
                              
                           
                         represents the reconstructed approximation and detail coefficients of the level j+1. A soft thresholding operation, done before the reconstruction step, is applied to the detail coefficient based on the function 
                           
                              
                                 ρ
                              
                              
                                 T
                              
                           
                         presented in Eq. (8). For example, for the level j, the thresholding operation is done by setting 
                           
                              
                                 d
                              
                              
                                 j
                              
                           
                           [
                           k
                           ]
                         to zero if its absolute value is below a certain level, denoted by 
                           
                              
                                 T
                              
                              
                                 M
                              
                           
                         (by Eqs. (9) and (10)), or reducing by the difference with the threshold value of the coefficient, as in Eq. (8),
                           
                              (8)
                              
                                 
                                    
                                       ρ
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             d
                                          
                                          
                                             j
                                          
                                       
                                       [
                                       k
                                       ]
                                    
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   sgn
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               d
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                         [
                                                         k
                                                         ]
                                                      
                                                      )
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            |
                                                            
                                                               
                                                                  
                                                                     d
                                                                  
                                                                  
                                                                     j
                                                                  
                                                               
                                                               [
                                                               k
                                                               ]
                                                            
                                                            |
                                                         
                                                         −
                                                         
                                                            
                                                               T
                                                            
                                                            
                                                               M
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                          
                                       
                                    
                                 
                                 
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   j
                                                
                                             
                                             [
                                             k
                                             ]
                                             >
                                             
                                                
                                                   T
                                                
                                                
                                                   M
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   j
                                                
                                             
                                             [
                                             k
                                             ]
                                             ≤
                                             
                                                
                                                   T
                                                
                                                
                                                   M
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                 .
                              
                           
                        
                        
                           
                              
                                 T
                              
                              
                                 M
                              
                           
                        , the threshold value, is a very important parameter for the reconstruction and is related to the noise level. The first step to calculate 
                           
                              
                                 T
                              
                              
                                 M
                              
                           
                         is to estimate the noise level 
                           
                              σ
                              ^
                           
                        . The noise estimation method proposed by Donoho and Johnstone [9] was adopted and 
                           
                              σ
                              ^
                           
                         calculated with Eq. (9)
                        
                           
                              (9)
                              
                                 
                                    σ
                                    ^
                                 
                                 =
                                 
                                    
                                       median
                                       
                                          (
                                          
                                             {
                                             
                                                |
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      [
                                                      k
                                                      ]
                                                   
                                                
                                                |
                                             
                                             }
                                          
                                          )
                                       
                                    
                                    
                                       0.6745
                                    
                                 
                                 .
                              
                           
                        The minimax method was then applied as a thresholding estimation method to obtain the threshold value 
                           
                              
                                 T
                              
                              
                                 M
                              
                           
                         as
                           
                              (10)
                              
                                 
                                    
                                       T
                                    
                                    
                                       M
                                    
                                 
                                 =
                                 
                                    σ
                                    ^
                                 
                                 
                                    (
                                    
                                       0.3936
                                       +
                                       0.1829
                                       
                                          
                                             log
                                          
                                          
                                             2
                                          
                                       
                                       
                                          (
                                          N
                                          )
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        A note should be taken that the thresholding process is only applied to the detailed coefficients for the denoising application [4].

The use of different mother wavelets to analyze the same signal could produce varying results. Usually, a mother wavelet is characterized by properties such as orthogonality, symmetry, compact support and vanishing moment. The selection of the mother wavelet is determined by similarities between the properties of the signal and of the mother wavelet [10]. In this paper, four popular types of mother wavelet functions, Daubechies, Biorthogonal, Coiflets and Symlets, were used to filter fluorescence-intensity signals. When performing denoising, the thresholding value was calculated by the method of minimax thresholding (Eq. (10)), and soft thresholding (Eq. (8)) was the cut-off method for high frequency components [11–13]. Daubechies wavelets are the extreme phase wavelets. Symlet wavelets are more symmetric than Daubechies. In the biorthogonal approach, analysis wavelets are orthogonal to the synthesis wavelets [14]. Coiflets are discrete wavelets with scaling functions that have vanishing moments. All four types of wavelets have been used in biomedical signal and image processing [15–19]. Symlet functions have the disadvantage of generally slower processing than other wavelet-based methods including Daubechies filtering [13–17].

A FIR (finite impulse response) filter is a filter whose impulse response is of finite duration. FIR filtering is inherently stable and can have the feature of linear phase frequency response [20,21]. IIR filters have internal feedback and continue to respond indefinitely. The high computational efficiency of IIR filters, with short phase delays, often make the IIR filter an attractive alternative [20,21]. In addition, an IIR filter can achieve a much steeper transition with frequency than a FIR filter of the same order. IIR filtering has the advantage of similar performance with a much lower order than FIIR filtering, making it more computationally efficient. For example, an IIR filter can match the performance of a 10 times-greater order FIR filter [1]. Here, the FIR filter is designed using the Parks–McClellan method based on the Remez exchange algorithm. The IIR filters tested include Chebyshev and Butterworth filters. Bidirectional processing was used to cancel phase effects in IIR filtering [1].

Activation maps generated from AP activation times are used to study electrical propagation patterns and conduction. Atrial activation maps were obtained by detection of the action potential dF/dt
                        max from the filtered signal for all the pixels of the field of view. All individual activation maps were overlaid and averaged to deduce mean activation values and maps. The isochronal activation map was obtained by offsetting the minimum time to 0. The conduction velocity was calculated from the gradient of the scalar field of the isochronal activation map using the algorithm proposed by Bayly et al. [22,23]. A local velocity vector, composed of horizontal and vertical components, determines the magnitude and direction of propagation. The conduction velocity was obtained from the average of magnitudes of the local velocity vectors.

The noise inherent in all cardiac mapping signals can distort activation maps obtained with any detection method. Proper denoising can thus improve the accuracy and value of activation analyses. Here, we examined the result of applying wavelet packet analysis to filter noisy activation-time map. For the sake of clarity, the description here is of the one-dimensional case, but the idea holds as well for two-dimensional analysis. Wavelet packet analysis is an optimal sub-band tree structuring method [24]. Unlike the discrete wavelet transformation, in which each level is calculated by passing only the previous approximation coefficients through the low and high pass quadrature mirror filters, in wavelet packet decomposition, both the approximation and detail coefficients are passed through the low and high pass filters to create the full binary tree. There are four fundamental steps in the algorithm: wavelet packet decomposition, best-basis selection, thresholding and reconstruction. The choice of thresholding value and best-basis selection are key aspects of wavelet packet decomposition [25]. Best basis selection is required to find the subtree that can completely represent the original signal with a minimum number of strong coefficients. For thresholding, a properly-selected threshold value separates the signal “structure” from noise because the signal coefficients have higher power compared with noise.

Here, the decomposition depth was set as 3 and the hard thresholding method was applied on individual elements. The SURE (Stein׳s Unbiased Risk Estimation) threshold criterion was chosen to calculate the threshold value (thre
                        
                           2D
                        ) [26] and is given by
                           
                              (11)
                              
                                 t
                                 h
                                 r
                                 
                                    
                                       e
                                    
                                    
                                       2
                                       D
                                    
                                 
                                 =
                                 σ
                                 
                                    
                                       2
                                       
                                       log
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                       
                                       
                                       l
                                       o
                                       g
                                       
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                       
                                       /
                                       
                                       log
                                       (
                                       2
                                       )
                                       )
                                    
                                 
                                 .
                              
                           
                        
                        
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                         is the total number of 2D image elements, 
                           
                           σ
                         is the noise standard deviation. The symlet 4 wavelet function was used for reconstruction.

As a comparison with wavelet packet filtering, a Gaussian filter was also tested. Gaussian filters are widely used to filter noisy 2-dimensional (2D) images. The filter׳s impulse response is a Gaussian function [27,28]. The relation of the support size of Gaussian kernel (k) and the standard deviation (σ) is here set to
                           
                              (12)
                              
                                 k
                                 =
                                 c
                                 e
                                 i
                                 l
                                 
                                    (
                                    
                                       6
                                       σ
                                    
                                    )
                                 
                                 −
                                 1
                                 .
                              
                           
                        
                     

When applied to 2D images, the Gaussian surface has a maximum at the origin with concentric circle isocontours. Each element in the filtered matrix is set to a weighted average of its neighborhood. The center element receives the heaviest weight and neighboring elements receive smaller weights as their distance to the focal element increases.

A canine atrial single cell model was integrated based on a modified Rosenbrock formula of order 2 and paced with a period of 1s to obtain a single-cell AP at steady state [29,30]. A simulated optical AP was obtained by integrating the single cell AP over time (phase), in which the wavefront propagates through the field of view of one pixel. The cells covered by a single imaging pixel were assumed to be cable-like, linearly arranged in a distance of L/N. L is the length of the field of view (FOV) of the camera, and N is the number of pixels over the length L. The first cell has a conduction phase delay 
                           
                              
                                 φ
                              
                              
                                 1
                              
                           
                        , and the last cell 
                           
                              
                                 φ
                              
                              
                                 N
                              
                           
                        . Propagation was assumed to occur at a constant velocity (
                           θ
                        ). In addition, the ratio of the fluorescence intensity change to transmembrane potential is set at a constant value 
                           
                              
                                 K
                              
                              
                                 c
                              
                           
                        . Instantaneous transmembrane voltage for the cellular AP is indicated as 
                           V
                           (
                           t
                           )
                        .

The total fluorescence change over time is represented as
                           
                              (13)
                              
                                 F
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    
                                       K
                                    
                                    
                                       c
                                    
                                 
                                 
                                    ∫
                                    
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             φ
                                          
                                          
                                             N
                                          
                                       
                                    
                                 
                                 V
                                 
                                    (
                                    
                                       t
                                       −
                                       φ
                                    
                                    )
                                 
                                 d
                                 φ
                                 ,
                              
                           
                        which we approximate by
                           
                              (14)
                              
                                 F
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    
                                       K
                                    
                                    
                                       c
                                    
                                 
                                 
                                    ∑
                                    
                                       i
                                       =
                                       
                                          
                                             φ
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             φ
                                          
                                          
                                             N
                                          
                                       
                                    
                                 
                                 V
                                 
                                    (
                                    
                                       t
                                       −
                                       i
                                    
                                    )
                                 
                                 .
                              
                           
                        The phase delay over one pixel is given by
                           
                              (15)
                              
                                 Δ
                                 φ
                                 =
                                 
                                    
                                       φ
                                    
                                    
                                       N
                                    
                                 
                                 −
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 
                                    L
                                    
                                       N
                                       θ
                                    
                                 
                                 
                                 .
                              
                           
                        The phase delay is proportional to the FOV, and inversely proportional to the conduction velocity 
                           θ
                         and image resolution N in one dimension. Representative optical APs are shown in 
                        Fig. 1A. In contrast with single cell APs, an optical AP can show a slower AP upstroke due to non-simultaneous activation of single cells within the emitting region of tissue covered by a pixel [31].

Spectral analysis of experimentally-obtained dog atrial optical mapping signals from 26 experiments showed that the noise is almost uniformly distributed. White Gaussian noise was added into the simulated AP to provide realistic simulated optical data. The noise levels were set to SNR values of 5, 10, 15, or 20dB.

Two types of variables were used to evaluate the impact of filtering: the SNR and measures of signal distortion. After denoising, the SNR is calculated as
                           
                              (16)
                              
                                 S
                                 N
                                 R
                                 =
                                 20
                                 
                                 
                                    
                                       log
                                    
                                    
                                       10
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∑
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             r
                                             e
                                             f
                                          
                                          
                                             2
                                          
                                       
                                       /
                                       
                                          ∑
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      r
                                                      e
                                                      f
                                                   
                                                
                                                −
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      f
                                                      i
                                                      l
                                                      t
                                                   
                                                
                                             
                                             )
                                          
                                          2
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 x
                              
                              
                                 r
                                 e
                                 f
                              
                           
                         is the reference signal and 
                           
                              
                                 x
                              
                              
                                 f
                                 i
                                 l
                                 t
                              
                           
                         is the filtered signal.

In this paper, for the comparison of wavelet mother functions and the comparison between wavelet and traditional Fourier filtering methods, the SNR was set at 5–20dB. We also used another measure of SNR for optical signal, OSNR, calculated by the ratio of the signal amplitude (A
                        
                           ref
                        ) divided by noise standard deviation (σ
                        
                           noise
                        ),
                           
                              (17)
                              
                                 O
                                 S
                                 N
                                 R
                                 =
                                 20
                                 
                                    
                                       log
                                    
                                    
                                       10
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   A
                                                
                                                
                                                   r
                                                   e
                                                   f
                                                
                                             
                                          
                                          
                                             
                                                
                                                   σ
                                                
                                                
                                                   n
                                                   o
                                                   i
                                                   s
                                                   e
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 
                                 .
                                 
                              
                           
                        
                     

The second type of variable (see Fig. 1B) relates to the waveform distortion due to filtering, including (1) peak time shift, i.e., the time difference between the peaks of the reference signal and the filtered signal 
                           Δ
                           
                              
                                 T
                              
                              
                                 p
                                 e
                                 a
                                 k
                                 ,
                                 f
                                 i
                                 l
                                 t
                              
                           
                           =
                           
                              
                                 T
                              
                              
                                 p
                                 e
                                 a
                                 k
                                 ,
                                 f
                                 i
                                 l
                                 t
                              
                           
                           −
                           
                              
                                 T
                              
                              
                                 p
                                 e
                                 a
                                 k
                                 ,
                                 r
                                 e
                                 f
                              
                           
                        ; (2) dF/dt
                        max, the maximum normalized dF/dt; and (3) AP duration (APD) difference between the reference and filtrered APD at 50% or 80% repolarization (
                           Δ
                           A
                           P
                           
                              
                                 D
                              
                              
                                 50
                              
                           
                         or 
                           Δ
                           A
                           P
                           
                              
                                 D
                              
                              
                                 80
                              
                           
                        ).

Experiments in canine atrial preparations from each of 26 non-diseased dogs were used to test various analysis methods on cardiac fluorescence data with temporal signal and 2D image processing methods. The excised right atrium was perfused via the right coronary artery with Krebs solution (mM: 120 NaCl, 4 KCl, 1.2 MgSO4 0.7, 1.2 KH2PO4, 25 NaHCO3, 5.5 glucose, 1.25 CaCl2, 95% O2/5% CO2) at 20mL/min and 37°C. After 30min for stabilization and electromechanical uncoupling with blebbistatin (15µM), the heart was stained with di-4-ANEPPS (4.16μM) (Biotium, CA). A high-speed charge-coupled device (CCD) camera system (80×80 pixels, RedShirt Imaging, LLC, Decatur, GA) recorded fluorescence images at 0.5, 1 and 2kHz in the right atrial appendage (RAA). Bipolar electrodes were used to pace the superior RAA. Optical maps were obtained from activations initiated by 2-ms, 1.5×threshold square-wave current stimuli at pacing cycle lengths of 200, 330, 500ms. A second pair of bipolar electrodes was put on atrial tissue to record epicardium electrograms.

All summary data are expressed as mean±std, except as otherwise specified. A two-tailed p-value below 0.05 was considered statistically significant. Paired Student t-tests were used to test the effect of 1D filter types, SNR level or any single parameter comparison. Two-way Analysis of Variance (ANOVA) was used to test filtering method and noise level effects. Two-way repeated measurement ANOVA was used to study filtering method and BCL (basic cycle length) dependence. Bonferroni-corrected post-hoc t-tests were used to compare replicate means when ANOVA revealed filtering effects. Statistical analysis was performed with SPSS (version 20) and Graphpad Prism 5 software.

Simulations and data processing was performed with custom-made software written in Matlab (version 7.11, MathWorks).

@&#RESULTS@&#

The SNR of simulated propagating optical APs after denoising with orthogonal or biorthogonal wavelets, biorthogonal (bior6.8), Coiflets (coif3), Symlet (sym8), and Daubechies (db8) were first compared (
                        Table 1).

The results presented in Table 1 indicate that the four types of wavelets have very good denoising effects: in all cases the SNR was greatly increased, especially for low initial SNR signals. The choice of mother wavelet does not lead to a significant difference (p>0.05 by ANOVA at each SNR level).

Next, the symlet mother wavelet was chosen for its wide denoising applications in signal and image analysis [13], to compare with FIR filter (order=50) and IIR filters (Butterworth and Chebychev, order=5) as illustrated in 
                        Fig. 2.

The complete results for this analysis are shown in 
                        Table 2. These data show that when the SNR was lower than 10dB, the wavelet method performed better than IIR or FIR filters (one-way ANOVA with post-hoc test, p<0.05).

We selected an approach based on the phase delay (AP propagation delay over one pixel) to simulate the changes in optical AP upstroke and study how it affects the quality of filtering. A total of 100 simulated APs (SNR=10dB) with 10, 20, 30, and 40ms phase delay were filtered with the FIR (order=50) and sym8 wavelet methods (level=4). Results are shown in 
                        Table 3.

The results show differences in APD independent of the filtering method, with greater differences for the FIR method compared to the wavelet approach. It is known that lower frequency content of the repolarization phase makes it better fitted for denoising with the FIR method. It is thus highly probable that the differences must come from the distortion of the upstroke by the denoising. However, the tendency for the differences in APD
                        80 to be greater compared to APD
                        50 may indicate some impact of filtering on the timing during the repolarization phase.

To compare filtering effects between FIR and wavelet methods in the processing of experimental optical mapping data, a representative optical mapping signal recorded from a canine right atrium was analyzed. The signals obtained from a single pixel before and after filtering are presented in 
                        Fig. 3.

For FIR filtering, when the order is set as low as n=30 with a narrow passing band, filtering can remove the noise and get a very smooth signal, while it provides a higher degree of distortion of the AP upstroke (abnormal slower depolarization). A high order (order of 100) of the FIR filter with a wide passing band produced a steeper upstroke of the filtered waveform fitting the original signal, while retaining an overall higher noise level. In comparison, the wavelet approach can achieve the goal of both keeping the upstroke waveform intact and removing high frequency noise. A comparison of the AP characteristics (for 4 consecutive APs) when filtering with either the wavelet or the FIR (n=30 or n=100) approaches is shown in 
                        Table 4.


                        
                        Fig. 4 shows activation maps calculated from signals filtered with the wavelet and FIR (n=30 and n=100) methods. The propagation patterns were similar for wavelet and high order FIR filtering, except that the latter was noisier. Low level FIR filtering altered the conduction pattern considerably.

To evaluate the 2D spatial wavelet packet denoising technique of reference activation maps, 3 simulated maps were generated (detailed analyses in 
                           
                           
                           
                           
                           
                           
                           Figs. 6–11): one with isotropic propagation (Fig. 6A), one with anisotropic propagation (Fig. 8A), and a reentry activation map (Fig. 10A). The isotropic conduction velocity was set to 100cm/s from the center to circumference similar to velocities documented in canine atrial tissue [32,33]. Anisotropic activation was set as an elliptically propagating wave starting at the center of the map with an anisotropic ratio of 2 (longitudinal vs. transverse CV).

In order to more closely represent real optical mapping data, Perlin noise was added to the simulated maps [34]. Examples presented in Figs. 6, 8 and 10B were obtained with the noise level set to 0.1. The effects of increasing the noise level were evaluated by increasing the absolute value of noise by 0.01 steps from 0.01 to 0.1 of the total activation time. At each noise level, 10 noisy (unfiltered) activation maps were randomly generated by adding 10 generated noise patterns to the non-noisy activation time map.

To compare the denoising quality with classical and commonly used 2D Gaussian filtering, two different filters, W1 (kernel size=5, sigma=
                              
                                 2
                              
                           ) and W2 (kernel size=19, 
                              s
                              i
                              g
                              m
                              a
                           =3.5) Gaussian filters were also used. Local conduction velocity vectors were calculated from the filtered maps (D, E and F panels of Figs. 6, 8, 10). In addition, the local CV vectors of the reference and unfiltered noisy maps (A and C panels of Figs. 5, 7, 9) were also calculated. Empirical distribution functions of local CV and their direction were calculated from the reference, unfiltered, W1, W2 and wavelet filtered maps and the results are presented in panels A and B of Figs. 6, 8, and 10.

To evaluate the filtering effect on local CV, differences between CV maps for filtered and reference maps were calculated as
                              
                                 (18)
                                 
                                    Δ
                                    C
                                    V
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   N
                                                
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   M
                                                
                                                
                                                   
                                                      (
                                                      
                                                         C
                                                         
                                                            
                                                               V
                                                            
                                                            
                                                               (
                                                               i
                                                               ,
                                                               j
                                                               )
                                                               f
                                                               i
                                                               l
                                                               t
                                                               e
                                                               r
                                                            
                                                         
                                                         −
                                                         C
                                                         
                                                            
                                                               V
                                                            
                                                            
                                                               (
                                                               i
                                                               ,
                                                               j
                                                               )
                                                               r
                                                               e
                                                               f
                                                               e
                                                               r
                                                               e
                                                               n
                                                               c
                                                               e
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   2
                                                
                                             
                                          
                                       
                                       
                                          N
                                          ×
                                          M
                                       
                                    
                                    
                                    ,
                                 
                              
                           where (N, M) is the size of the region of interest.

The effects of 2D filtering on activation maps and CV estimation are shown in Figs. 6–10. The mean±SEM 
                              Δ
                           CV values over 10 simulations for each noise level are plotted in panel C of Figs. 6, 8 and 10. Two-way ANOVA indicated that both the noise level and the filtering methods have significant effects on the calculated CV. No significant interaction effect was found.

The results of CV analysis for the anisotropic propagation as shown in Fig. 7 are presented in Fig. 8. Fig. 9 shows the effects of filtering on reentrant activity mapping. Fig. 10 shows the results of CV analysis for the reentrant activity presented in Fig. 9.

Activation maps for 26 dog atria obtained at pacing cycle lengths of 250, 330 and 500ms were filtered by wavelet and 2 Gaussian filters. In 
                           Fig. 12, one activation map with 500ms BCL is shown, with 3 filtered maps over which the local CV vectors are plotted. W1 Gaussian spatial filtering in panel B decreases importantly the neighbor-to-neighbor variability in orientation while keeping the overall change in direction apparent on the unfiltered activation map. Filtering with the W2 Gaussian filter (panel C) shows clear over- smoothing with loss of real change in propagation direction (middle right section in the map). In comparison, the wavelet-filtered map maintains the overall characteristics of the maps while reducing the regional variation in CV orientation.

CV analysis results of the experimental data are shown in Fig. 12 with the cumulative distributions of local CV magnitude presented in panel A and CV direction in panel B. The CV distribution has an increased range for the W1 Gaussian while over-smoothing with the larger W2 filter resulted in a more homogeneous CV distribution. In comparison, the wavelet filtering resulted in a distribution covering a smaller CV range.

Repeated measures ANOVA showed that the filtering method and BCL are significant determinants of CV. No interaction between these two factors was found.

@&#DISCUSSION@&#

Optical mapping is widely used in cardiac electrophysiology research. The appropriate choice of a signal processing method for the analysis of experimental data is important, and can affect the conclusions. Fourier-based methods are widely used in signal processing [35]. These methods transform the signals as an infinite summation of multiple weighted sine and cosine waves of frequencies that are integer multiples of the fundamental frequency, under the assumption that the nature of the signal is periodic and stationary [35,36]. Consequently, Fourier analysis has the disadvantage of dissipating transient components or locally specific features. The traditional way to denoise is to use a low or band-pass filter with specific cut-off frequencies to remove the noise from the original signal, under the assumption of separation between the signal and noise frequency spectrum. However for signals with very fast components like the action potential upstroke, important information can be lost when denoising. Filtering out all the “noise” frequency components with Fourier-based methods can thus induce loss of information and waveform distortion.

The wavelet transform is computed by changing the scale of the mother wavelet, shifting the scaled wavelet in time, multiplying by the signal, and integrating over time [37,38]. The multiresolution algorithm of the wavelet transform decomposes a signal into scales with different time and frequency resolution. The analysis uses finite-length wavelet functions, in which an analysis window is chosen to be shorter at high frequencies and longer at low frequencies [39]. This transformation flexibility makes it possible to obtain a local scale-dependent spectral analysis of individual signal features. Consequently, this approach allows for improved detection of high-frequency, short-duration abrupt changes without distorting low-frequency, and long-duration gradual variations in signals [38,39]. The wavelet transform can thus discriminate between relevant spikes and undesirable noise and is particularly useful for the analysis of transient, aperiodic and other non-stationary signal features. Denoising with wavelets is thus able to properly estimate the noise level in order to threshold the small-coefficient noise while maintaining the decomposition coefficients of the underlying noise-free signal.

Because of the wide variety and complexity of signals and images recorded in medicine and biology, wavelet analysis is increasingly used in medical data-processing applications like electrocardiography (ECG), electromyography, electroencephalography, computed tomography, magnetic resonance imaging, ultrasound, and position emission tomography [40–50]. Wavelet analysis has been widely applied in many specific ECG applications: ECG detection, timing and denoising; detection of localized abnormalities; analysis of heart rate variability; identification and classification of cardiac arrhythmias; and ECG data compression [51–54]. Here, wavelet analysis was applied to reduce noise levels in optical signals and their effects on activation maps. A few prior studies have applied wavelet methods to analyze optical mapping data [6,55–57]. The application of wavelet analysis to optical-mapping data was first suggested by Witkowski [56]. Asfour et al. introduced wavelet analysis to process fluorescence transmembrane potentials contaminated by motion artifacts: wavelet analysis was found to be a promising approach to remove motion artefact and unmask activation without electrical–mechanical uncouplers [6,55]. Here, we provide a detailed comparison of wavelet filtration of fluorescence signals with standard FIR and IIR methods, as well as activation maps processing by the spatial wavelet-based approach with 2D Gaussian smoothing methods.

One important advantage of wavelet transform is that many choices of wavelet mother functions are available. It is important to choose an appropriate mother wavelet function to denoise signal since the more similarity the mother wavelet function has with the signals, the more precisely the signals can be extracted from the unfiltered data [58]. For example, Daubechies wavelet functions were used by Witkowsky [56], whereas Asfour et al. used Coiflet4 wavelets. Here, we opted to use symlet8 wavelets. In the analysis here, there was no significant difference between Daubechies, Biorthogonal, Coiflets and Symlets mother wavelets. The lack of difference between the wavelet types in our study compared to other applications may be due to multiple factors. In the Asfour et al. study, the authors aimed to remove motion artifacts (relatively low-frequency), while in our work the principal focus was on removing relatively high-frequency noise on the AP. In addition, the simulated signals were different: Asfour et al. used a half-wave rectified sine wave signal to simulate motion artifact components, while we generated noisy signals with a range of 
                        d
                        F
                        /
                        d
                        
                           
                              t
                           
                           
                              m
                              a
                              x
                           
                        
                     . Asfour et al. chose Coiflet mother wavelets because the RMSE (root-mean-squared-error) of rTmp (early depolarization phase of the action potential difference) values were minimized when compared to other wavelets mother functions (Daubechies and Symlet) [55]. In our analysis, the criteria revolved around optimization of the SNR throughout the AP while faithfully maintaining the fast signal upstroke.

The temporal processing results showed that wavelet analysis performs at least as well, and in many cases better, than traditionally-used approaches. Wavelet analysis showed better results than traditional Fourier-based filtering methods with respect to waveform degradation, along with SNR improvement when the noise level is high. Lower-order FIR filters with narrow band-pass do remove noise, but at the expense of distortion of the AP; higher order FIR filtering with wide band-pass has better waveform fidelity for high noise levels.

The spatial pre-processing commonly used in optical mapping includes uniform averaging over a limited region (e.g.: 3×3 pixels) [1,59]. Here, we bypassed this pre-processing step and evaluated spatial filtering techniques applied to the activation map. The most common spatial process is Gaussian smoothing, an effective filtering method that removes noise-induced fluctuations [60,61]. In a large, fairly homogeneous area of activation time progression, Gaussian smoothing is quite suitable. Unfortunately, the improvement is typically accompanied by a well-recognized loss of detail by changing the intensity variation and removing useful features [62]. When Gaussian filters are used, the choice of kernel is critical to the filtering output. Gaussian smoothing with a large support size and 
                        σ
                      introduces substantial smoothing of activation maps, leading to loss of detailed propagation contours and increasing CV estimates as shown in Figs. 8,10, and 12. Filters with small kernel size maintain detailed textures but introduce less smoothing and retain higher noise levels, impairing analysis of the local propagation direction (as presented in Figs. 7, 9, 11, and 13). Wavelet filtering in 2D image application, as in 1D signal processing, has the advantage of retaining relevant localized information, while removing irrelevant noise [63,64]. Wavelet denoising methods remove local propagation orientation variability to an extent equivalent to large kernel size Gaussian filters. At the same time, they preserve the sharpness of propagation contours like lower kernel size Gaussian filters. Our simulation and experiment results indicate that at low noise levels, the deviations of local CV from reference values were significantly decreased by both Gaussian and wavelet filtering. However, at high noise levels, wavelet filtering was able to improve the image quality, with similar performance to Gaussian smoothing in relatively homogeneous areas, but with the additional advantage of causing limited distortion on activation map areas close to edges. Wavelet filtering also retains the spatial features in regions with localized important changes. In this respect, wavelet denoising is generally superior to Gaussian smoothing because the wavelet domain filter adapts “automatically” (because of the thresholding algorithm) to the noise distribution of the input image, while the Gaussian smoothing kernel must match the object size to be detected [61,63–65].

The main advantage of wavelet analysis in processing optical-mapping data lies in its ability to reduce noise while preserving intrinsic signal properties. The main disadvantage is the greater complexity of the wavelet method, requiring longer processing times than traditional Fourier-based filtering or 2D Gaussian smoothing.

Feng Xiong: Performed the optical mapping experiments, developed and applied all of the analytical tools, formulated the methods and hypotheses for the study, performed analyses and wrote the paper.

Xiaoyan Qi: Performed the experimental studies and assisted in their analysis.

Stanley Nattel: Provided funding for the experimental and analytical portions of the study, co-supervised the study, provided critical feedback on the approach and the manuscript.

Philippe Comtois: Provided primary supervision for all of the analytical and bioengineering parts of the study, provided critical feedback on the methods, data, figures and manuscript.

Non declared.

Research supported by Natural Sciences and Engineering Research Council of Canada (NSERC) (Grant no. RGPIN-2014-04233) Discovery grant (P.C.), Canadian Institutes of Health Research Award 6957 and Heart and Stroke foundation of Canada (S.N.).

@&#ACKNOWLEDGMENTS@&#

The authors thank Nathalie L’Heureux and Chantal St-Cyr for technical help and France Thériault and Tina Boivin for support in preparing and submitting the manuscript.

@&#REFERENCES@&#

