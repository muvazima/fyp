@&#MAIN-TITLE@&#Cross-calibration of time-of-flight and colour cameras

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Survey of depth-colour calibration methods.


                        
                        
                           
                           Novel calibration method based on projective alignment.


                        
                        
                           
                           Indepth experimental validation and error analysis.


                        
                        
                           
                           Alignment of time-of-flight and colour camera networks.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Camera networks

Time-of-flight cameras

Depth cameras

Camera calibration

3D reconstruction

RGB-D data

@&#ABSTRACT@&#


               
               
                  Time-of-flight cameras provide depth information, which is complementary to the photometric appearance of the scene in ordinary images. It is desirable to merge the depth and colour information, in order to obtain a coherent scene representation. However, the individual cameras will have different viewpoints, resolutions and fields of view, which means that they must be mutually calibrated. This paper presents a geometric framework for the resulting multi-view and multi-modal calibration problem. It is shown that three-dimensional projective transformations can be used to align depth and parallax-based representations of the scene, with or without Euclidean reconstruction. A new evaluation procedure is also developed; this allows the reprojection error to be decomposed into calibration and sensor-dependent components. The complete approach is demonstrated on a network of three time-of-flight and six colour cameras. The applications of such a system, to a range of automatic scene-interpretation problems, are discussed.
               
            

@&#INTRODUCTION@&#

The segmentation of multi-view video data, with respect to physically distinct objects of interest, is an essential task in automatic scene-interpretation. Visual segmentation can be based on colour, texture, parallax and motion information (e.g. [1,2]). The task remains very difficult, however, owing to the combined effects of non-rigid surfaces, variable lighting, and occlusion. It has become clear that depth cameras can make an important contribution to scene understanding, by enabling direct depth segmentation, based on the measured scene-structure (see CVIU special issue [3]). This approach is also highly effective for dynamic tasks, such as body tracking and action recognition [4]. Furthermore, if depth and colour information can be merged into a single representation, then a complete 3D representation is possible, in principle. This is clearly desirable, because colour and texture data are essential to many other aspects of scene-understanding, such as identification and tracking [5].

There are two major obstacles to the construction of a complete scene representation, from a multi-modal camera network. Firstly, typical depth sensors are unable to capture RGB data [6]. This means that the depth and colour cameras will have different viewpoints, and so the raw data are inconsistent. Secondly, typical TOF and RGB cameras have limited fields of view, and so the depth and colour data are incomplete. This paper addresses both of these problems, by showing how to estimate the geometric relationships in a multi-view, multi-modal camera network. This task will be called cross-calibration.

In order to constrain the problem, two practical constraints are imposed from the outset. Firstly, the system will be based on time-of-flight (TOF) cameras, in conjunction with ordinary RGB cameras. The TOF cameras are compact, can be properly synchronized, and are industrially specified, e.g., [6]. Secondly, a modular network of TOF+RGB units is required. This is so that individual units can be added or removed, in order to optimize the scene-coverage.

@&#OVERVIEW@&#

Time-of-flight cameras can, in principle, be geometrically calibrated by standard methods [7]. This means that each pixel records an estimate of the scene-distance (range) along the corresponding ray. The 3D structure of a scene can also be reconstructed from two or more ordinary images, via the parallax (e.g.binocular disparity) between corresponding image points. There are many advantages to be gained by combining the range and parallax data. Most obviously, each point in a parallax-based reconstruction can be mapped back into the original images, from which colour and texture can be obtained. Parallax-based reconstructions are, however, difficult to obtain, owing to the difficulty of putting the image points into correspondence. Indeed, it may be impossible to find any correspondences in untextured regions. Furthermore, if a Euclidean reconstruction is required, then the cameras must be calibrated. The accuracy of the resulting reconstruction will also tend to decrease with the distance of the scene from the cameras [8].

The range data, on the other hand, are often corrupted by noise and surface-scattering. The spatial resolution of current TOF sensors is relatively low, the depth-range is limited, and the luminance signal may be unusable for rendering and for classical image processing. It should also be recalled that TOF cameras, of the type used here, cannot be used in outdoor lighting conditions. These considerations lead to the idea of a mixed colour and time-of-flight system, as described in [9]. Such a system could, in principle, be used to make high-resolution Euclidean reconstructions, including photometric information [10,11].

In order to make full use of a mixed range/parallax system, it is necessary to find the exact geometric relationship between the different devices. In particular, the reprojection of the TOF data, into the colour images, must be obtained. This paper is concerned with the estimation of these geometric relationships. Specifically, the aim is to align the range and parallax reconstructions, by a suitable 3D transformation.

Multi-view depth and colour camera-networks, of the kind used here, produce data-streams that are subject to a variety of geometric relationships [12]. These relationships depend on the calibration state, relative orientation, and fields of view of the different cameras. It follows that a variety of calibration strategies can be adopted. These are discussed below, with reference to the literature, and contrasted with the approach presented here.

Perhaps the simplest way to combine RGB and TOF data is to perform an essentially 2D registration between the images and depth maps, as reviewed in [13]; see also [14–16]. This 2D approach, however, can only provide an instantaneous solution, because changes in the scene-structure produce corresponding changes in the image-to-image mapping. Moreover, owing to the different viewpoints, a complete registration will usually be impossible. If the depth camera also produces a reliable intensity image, then photo-consistency can be used as a 3D calibration criterion. For example, Beder et al. [17] (see also [18,19]) reproject the intensities of the depth data into the colour images, and optimize the camera parameters with respect to the photo-consistency.

Zhu et al. [20] (see also [21]) present a sensor-fusion framework for the integration of TOF depth and binocular disparity information. This method assumes that a dense disparity map is being computed on-line, which is not required by the method presented in this paper. Furthermore, the geometric calibration method [20] requires manual identification of corresponding points, and is based on a weak perspective camera model. In contrast, our method is automatic, and is based on the more appropriate perspective camera model. However, [20] is complementary to our method, in the sense that their sensor-fusion framework (along with a dense stereo-matcher) could be combined with the projective calibration method described below. Wang and Jia [22] describe a related sensor-fusion framework for Kinect (rather than TOF) depth data and colour images.

Another approach to the multi-modal calibration problem is to apply standard methods, as far as possible, to the depth cameras. Wu et al. [23] describe an example of this approach. Lindner et al. [9] analyze the applicability of standard methods to TOF cameras, as well as characterizing the accuracy of the depth data. Mure-Dubois and Hügli [24] describe the Euclidean alignment of multiple TOF point clouds, having calibrated the cameras by standard methods.

Silva et al. [25] describe a cross-calibration methodology that is based on the identification of 3D lines in the TOF data, which are then projected to corresponding 2D lines in the RGB images. This method does not require a chequerboard or other calibration pattern; it does, however, require the existence and detection of straight depth-edges throughout the scene. The approach of Silva et al. also involves a non-trivial correspondence problem, which in turn influences the calibration accuracy. Our method uses a standard chequerboard pattern, with a known number of vertices, for which the correspondence problem is relatively straightforward.

Zhang and Zhang [26] present cross-calibration methodology that is based on plane constraints, as given in [27]. This has the advantage of not requiring 2D features to be detected in the (low resolution) TOF images. However, this method cannot address the crucial issue of lens distortion, which is considerable in typical TOFcameras [28]. A related Kinect-based calibration system is described by Herrera et al. [29], again using the plane-based method of [27]. Herrera et al.give a careful analysis of the Kinect intrinsic parameters, including lens and depth distortion. The latter is analyzed in more detail by Teichman et al. [30]. Our method does require features to be detected in the TOFimages, but this also makes it straightforward to estimate the lens parameters, using standard techniques.

Mikhelson et al. [31] describe an automatic method for registering a Euclidean point-cloud (obtained from a Kinect device) to its 2Dimage-projections. This method, like ours, is based on a chequerboard target. However, Mikhelson et al. perform Euclidean 2D/3Dregistration, in contrast to the more general projective 3D/3Dregistration that is described below. Finally, there are methods that perform 3D/3Dregistration of dense data, subject to pointwise adjustments [32]. This strategy can achieve very close registrations, but introduces a more complex optimization problem, which is not fully compatible with the standard calibration pipeline.

This paper is organized as follows. Section 2.1 briefly reviews some standard material on projective reconstruction, while Section 2.2 describes the representation of range data in the present work. The chief contributions of the subsequent sections are as follows: Section 2.3 describes a point-based method that maps a classical multi-view reconstruction (projective or Euclidean) of the scene onto the corresponding TOFrepresentation. The data are obtained from a TOF+RGBsystem, as shown in Fig. 1
                        . This does not require the colour cameras to be calibrated (although it is necessary to correct for lens distortion). It is established that this model includes a projective-linear approximation of the systematic TOFdepth-error.

Section 3 addresses the problem of multi-system alignment, which is necessary for complete scene-coverage. It is shown that this can be achieved in a way that is compatible with the individual TOF+2RGBcalibrations. The complete cross-calibration pipeline, given a collection of chequerboard images, is fully automatic.

Section 4 contains a detailed evaluation of these methods, using several large data-sets, captured by three TOF+2RGBsystems (i.e. a nine-camera network). In particular, Section 4.1 extends the usual concepts of reprojection error [12] to the multi-modal case. Section 4.2 then introduces a new metric for mixed TOF/RGBsystems, which measures instantaneous sensor noise, as well as calibration error. The appropriateness of the 3Dhomography transformation, as opposed to a similarity transformation, is tested in Section 4.3. Section 4.4 discusses possible applications of these systems, including some real 3Dreconstruction examples. Conclusions and future directions are discussed in Section 5.

The system presented here is based on the approach introduced by Hansard et al. [33,34]. The earlier work has been improved, and extended to the case of multiple TOFand colour cameras. In addition, a new evaluation methodology has been developed, as described above. The automatic detection of calibration targets in the low-resolution TOFimages, which is a pre-requisite for the methods described here, was developed in a separate paper [7].

This section describes the theory of projective alignment, using the following notation. Bold type will be used for vectors and matrices. In particular, points 
                        
                           P
                           ,
                           Q
                        
                      and planes 
                        
                           U
                           ,
                           V
                        
                      in the 3Dscene will be represented by column-vectors of homogeneous coordinates, e.g.
                        
                           (1)
                           
                              P
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      ▵
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                              and
                              
                              U
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      U
                                                   
                                                   
                                                      ▵
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      U
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           
                              
                                 P
                              
                              
                                 ▵
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       P
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                    
                                 
                                 )
                              
                              
                                 ⊤
                              
                           
                        
                      and 
                        
                           
                              
                                 U
                              
                              
                                 ▵
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       U
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       U
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       U
                                    
                                    
                                       3
                                    
                                 
                                 )
                              
                              
                                 ⊤
                              
                           
                        
                     . The homogeneous coordinates are defined up to a non-zero scaling; for example, 
                        
                           P
                           ≃
                           
                              
                                 (
                                 
                                    
                                       P
                                    
                                    
                                       ▵
                                    
                                 
                                 /
                                 
                                    
                                       P
                                    
                                    
                                       4
                                    
                                 
                                 ,
                                 1
                                 )
                              
                              
                                 ⊤
                              
                           
                        
                     . In particular, if 
                        
                           
                              
                                 P
                              
                              
                                 4
                              
                           
                           =
                           1
                        
                     , then 
                        
                           
                              
                                 P
                              
                              
                                 ▵
                              
                           
                        
                      contains the ordinary space coordinates of the point 
                        
                           P
                        
                     . Furthermore, if 
                        
                           |
                           
                              
                                 U
                              
                              
                                 ▵
                              
                           
                           |
                           =
                           1
                        
                     , then 
                        
                           
                              
                                 U
                              
                              
                                 4
                              
                           
                        
                      is the signed perpendicular distance of the plane 
                        
                           U
                        
                      from the origin, and 
                        
                           
                              
                                 U
                              
                              
                                 ▵
                              
                           
                        
                      is the unit normal. The point 
                        
                           P
                        
                      is on the plane 
                        
                           U
                        
                      if 
                        
                           
                              
                                 U
                              
                              
                                 ⊤
                              
                           
                           P
                           =
                           0
                        
                     . The cross product 
                        
                           u
                           ×
                           v
                        
                      is often expressed as 
                        
                           
                              
                                 (
                                 u
                                 )
                              
                              
                                 ×
                              
                           
                           v
                        
                     , where 
                        
                           
                              
                                 (
                                 u
                                 )
                              
                              
                                 ×
                              
                           
                        
                      is a 
                        
                           3
                           ×
                           3
                        
                      antisymmetric matrix. The column-vector of N zeros is written 
                        
                           
                              
                                 0
                              
                              
                                 N
                              
                           
                        
                     . Projective cameras are represented by 
                        
                           3
                           ×
                           4
                        
                      matrices. For example, the range projection is
                        
                           (2)
                           
                              q
                              ≃
                              CQ
                              
                              where
                              
                              C
                              =
                              
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             3
                                             ×
                                             3
                                          
                                       
                                       
                                       |
                                       
                                       
                                          
                                             b
                                          
                                          
                                             3
                                             ×
                                             1
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     is a block-decomposition of the 
                        
                           3
                           ×
                           4
                        
                      camera matrix. The left and right colour cameras 
                        
                           
                              
                                 C
                              
                              
                                 ℓ
                              
                           
                        
                      and 
                        
                           
                              
                                 C
                              
                              
                                 r
                              
                           
                        
                      are similarly defined, e.g.
                     
                        
                           
                              
                                 p
                              
                              
                                 ℓ
                              
                           
                           ≃
                           
                              
                                 C
                              
                              
                                 ℓ
                              
                           
                           P
                        
                     . Table 1
                      summarizes the geometric objects that will be aligned.

Points and planes in the two systems are related by the unknown 
                        
                           4
                           ×
                           4
                        
                      space-homography 
                        
                           H
                        
                     , so that
                        
                           (3)
                           
                              Q
                              ≃
                              HP
                              
                              and
                              
                              V
                              ≃
                              
                                 
                                    H
                                 
                                 
                                    -
                                    ⊤
                                 
                              
                              U
                              .
                           
                        
                     This model encompasses all rigid, similarity and affine transformations in 3D. It preserves collinearity and flatness, and is linear in homogeneous coordinates. Note that, in the reprojection process, 
                        
                           H
                        
                      can be interpreted as a modification of the camera matrices. For example, 
                        
                           
                              
                                 p
                              
                              
                                 ℓ
                              
                           
                           ≃
                           
                              
                                 
                                    
                                       
                                          C
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          -
                                          1
                                       
                                    
                                 
                              
                           
                           Q
                        
                     , where 
                        
                           
                              
                                 H
                              
                              
                                 -
                                 1
                              
                           
                           Q
                           ≃
                           P
                        
                      is the point that would theoretically be reconstructed by triangulation.

The 
                        
                           4
                           ×
                           4
                        
                      homographies 
                        
                           H
                        
                      include, as special cases, the rigid transformations that would align a fully-calibrated Euclidean stereo-reconstruction to the TOFmeasurements. There are two motivations for the generalization. Firstly, it allows uncalibrated binocular reconstructions to be used, as described above. Secondly, it has been shown elsewhere [10,20] that TOFdata are subject to systematic depth biases and nonlinear distortions. These are difficult to correct, owing to the lack of a complete parametric model, and to their dependence on the camera settings (e.g.integration time). Nonetheless, the homography model (3) effectively includes a projective-linear approximation of the depth distortion, which is fitted along with the other transformation parameters. This model is quite powerful: it includes rational depth-distortions, with varying parameters, across each bundle of rays. For example, the two-parameter inverse disparity calibration, as used with Kinect devices [29], is a special case of the homography model described here. Indeed, even if the RGBcameras are fully calibrated, the 3Dhomographies are needed to account for depth-distortions and residual reconstruction errors, as demonstrated in [33]. This issue will be explored in Section 4.3, below.

A projective reconstruction of the scene can be obtained from matched points 
                           
                              
                                 
                                    p
                                 
                                 
                                    ℓ
                                    k
                                 
                              
                           
                         and 
                           
                              
                                 
                                    p
                                 
                                 
                                    rk
                                 
                              
                           
                        , together with the fundamental matrix 
                           
                              F
                           
                        , where 
                           
                              
                                 
                                    p
                                 
                                 
                                    rk
                                 
                                 
                                    ⊤
                                 
                              
                              F
                              
                              
                                 
                                    p
                                 
                                 
                                    ℓ
                                    k
                                 
                              
                              =
                              0
                           
                        . The fundamental matrix can be estimated automatically, using the well-established ransac method. The camera matrices can then be determined, up to a four-parameter projective ambiguity [12]. In particular, from 
                           
                              F
                           
                         and the epipole 
                           
                              
                                 
                                    e
                                 
                                 
                                    r
                                 
                              
                           
                        , the cameras can be defined as
                           
                              (4)
                              
                                 
                                    
                                       C
                                    
                                    
                                       ℓ
                                    
                                 
                                 ≃
                                 
                                    
                                       
                                          I
                                          
                                          |
                                          
                                          
                                             
                                                0
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                 
                                 
                                 and
                                 
                                 
                                    
                                       C
                                    
                                    
                                       r
                                    
                                 
                                 ≃
                                 
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      r
                                                   
                                                
                                                )
                                             
                                             
                                                ×
                                             
                                          
                                          
                                             
                                                
                                                   F
                                                   +
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                   
                                                
                                             
                                          
                                          
                                          γ
                                          
                                             
                                                e
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              γ
                              
                              ≠
                              
                              0
                           
                         and 
                           
                              g
                              =
                              
                                 
                                    (
                                    
                                       
                                          g
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          g
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          g
                                       
                                       
                                          3
                                       
                                    
                                    )
                                 
                                 
                                    ⊤
                                 
                              
                           
                         can be used to bring the cameras into a plausible form. This makes it easier to visualize the projective reconstruction and, more importantly, can improve the numerical conditioning of subsequent procedures.

The TOFcamera 
                           
                              C
                           
                         provides the range (i.e. radial distance) 
                           
                              ρ
                           
                         of each scene-point from the camera-centre, as well as the associated image-coordinates 
                           
                              q
                              =
                              (
                              x
                              ,
                              y
                              ,
                              1
                              )
                           
                        . The back-projection of this point into the scene is
                           
                              (5)
                              
                                 
                                    
                                       Q
                                    
                                    
                                       ▵
                                    
                                 
                                 =
                                 
                                    
                                       A
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 
                                    
                                       
                                          (
                                          ρ
                                          /
                                          α
                                          )
                                          
                                          q
                                          -
                                          b
                                       
                                    
                                 
                                 
                                 where
                                 
                                 α
                                 =
                                 
                                    
                                       
                                          
                                             
                                                A
                                             
                                             
                                                -
                                                1
                                             
                                          
                                          
                                          q
                                       
                                    
                                 
                                 .
                              
                           
                        Hence the point 
                           
                              
                                 
                                    (
                                    
                                       
                                          Q
                                       
                                       
                                          ▵
                                       
                                    
                                    ,
                                    1
                                    )
                                 
                                 
                                    ⊤
                                 
                              
                           
                         is at distance 
                           
                              ρ
                           
                         from the optical centre 
                           
                              -
                              
                                 
                                    A
                                 
                                 
                                    -
                                    1
                                 
                              
                              b
                           
                        , in the direction 
                           
                              
                                 
                                    A
                                 
                                 
                                    -
                                    1
                                 
                              
                              q
                           
                        . The scalar 
                           
                              α
                           
                         serves to normalize the direction-vector. This is the standard pinhole model, as used in [35].

The range data are noisy and incomplete, owing to illumination and scattering effects. This means that, given a sparse set of features in the intensity image (of the TOFdevice), it is not advisable to use the back-projected point (5) directly. A better approach is to segment the image of the plane in each TOFcamera (using the range and/or intensity data). It is then possible to back-project all of the enclosed points, and to robustly fit a plane 
                           
                              
                                 
                                    V
                                 
                                 
                                    j
                                 
                              
                           
                         to the enclosed points 
                           
                              
                                 
                                    Q
                                 
                                 
                                    ij
                                 
                              
                           
                        , so that 
                           
                              
                                 
                                    V
                                 
                                 
                                    j
                                 
                                 
                                    ⊤
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    ij
                                 
                              
                              ≈
                              0
                           
                         if point i lies on plane j. Now, the back-projection 
                           
                              
                                 
                                    Q
                                 
                                 
                                    π
                                 
                              
                           
                         of each sparse feature point 
                           
                              q
                           
                         can be obtained by intersecting the corresponding ray with the plane 
                           
                              V
                           
                        , so that the new range estimate 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    π
                                 
                              
                           
                         is
                           
                              (6)
                              
                                 
                                    
                                       ρ
                                    
                                    
                                       π
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ▵
                                          
                                          
                                             ⊤
                                          
                                       
                                       
                                          
                                             A
                                          
                                          
                                             -
                                             1
                                          
                                       
                                       b
                                       -
                                       
                                          
                                             V
                                          
                                          
                                             4
                                          
                                       
                                    
                                    
                                       (
                                       1
                                       /
                                       α
                                       )
                                       
                                       
                                          
                                             V
                                          
                                          
                                             ▵
                                          
                                          
                                             ⊤
                                          
                                       
                                       
                                          
                                             A
                                          
                                          
                                             -
                                             1
                                          
                                       
                                       q
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              |
                              
                                 
                                    V
                                 
                                 
                                    4
                                 
                              
                              |
                           
                         is the distance of the plane to the camera centre, and 
                           
                              
                                 
                                    V
                                 
                                 
                                    ▵
                                 
                              
                           
                         is the unit-normal of the range plane. The new point 
                           
                              
                                 
                                    Q
                                 
                                 
                                    π
                                 
                              
                           
                         is obtained by substituting 
                           
                              
                                 
                                    ρ
                                 
                                 
                                    π
                                 
                              
                           
                         into (5).

The choice of plane-fitting method is affected by two issues. Firstly, there may be very severe outliers in the data, due to the photometric and geometric errors in the depth-estimation process. Secondly, the noise-model should be based on the pinhole geometry, which means that perturbations occur radially along visual directions, which are not (in general) perpendicular to the observed plane [36,37]. Several plane-fitting methods, both iterative [38] and non-iterative [39] have been proposed for the pinhole model. However, for TOFdata, the chief problem is the large number of outliers. This means that a ransac-based method is the most effective in this context [33].

It is straightforward to show that the transformation 
                           
                              H
                           
                         in (3) could be estimated from five binocular points 
                           
                              
                                 
                                    P
                                 
                                 
                                    k
                                 
                              
                           
                        , together with the corresponding range points 
                           
                              
                                 
                                    Q
                                 
                                 
                                    k
                                 
                              
                           
                        . This would provide 
                           
                              5
                              ×
                              3
                           
                         equations, which determine the 
                           
                              4
                              ×
                              4
                           
                         entries of 
                           
                              H
                           
                        , subject to an overall projective scaling. It is better, however, to use the ‘Direct Linear Transformation’ method [12], which fits 
                           
                              H
                           
                         to all of the data. This method is based on the fact that if
                           
                              (7)
                              
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 HP
                                 ,
                              
                           
                        is a perfect match for 
                           
                              Q
                           
                        , then 
                           
                              μ
                              Q
                              =
                              λ
                              
                                 
                                    P
                                 
                                 
                                    ′
                                 
                              
                           
                        , and the scalars 
                           
                              λ
                           
                         and 
                           
                              μ
                           
                         can be eliminated between pairs of the four implied equations [40]. This results in 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                4
                                             
                                          
                                          
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                              =
                              6
                           
                         interdependent constraints per point. It is convenient to write these homogeneous equations as
                           
                              (8)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         4
                                                      
                                                   
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         ▵
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         4
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         ▵
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         ▵
                                                      
                                                   
                                                   ×
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         ▵
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       0
                                    
                                    
                                       6
                                    
                                 
                                 .
                              
                           
                        Note that if 
                           
                              
                                 
                                    P
                                 
                                 
                                    ′
                                 
                              
                           
                         and 
                           
                              Q
                           
                         are normalized so that 
                           
                              
                                 
                                    P
                                 
                                 
                                    4
                                 
                                 
                                    ′
                                 
                              
                              =
                              1
                           
                         and 
                           
                              
                                 
                                    Q
                                 
                                 
                                    4
                                 
                              
                              =
                              1
                           
                        , then the magnitude of the top half of (8) is simply the distance between the points. Following Förstner [41], the left-hand side of (8) can be expressed as 
                           
                              
                                 
                                    
                                       
                                          Q
                                       
                                    
                                 
                                 
                                    ∧
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    ′
                                 
                              
                           
                         where
                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             Q
                                          
                                       
                                    
                                    
                                       ∧
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         4
                                                      
                                                   
                                                   
                                                      
                                                         I
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                                
                                                   -
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         ▵
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     Q
                                                                  
                                                                  
                                                                     ▵
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         ×
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        is a 
                           
                              6
                              ×
                              4
                           
                         matrix, and 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                ▵
                                             
                                          
                                       
                                    
                                 
                                 
                                    ×
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    ▵
                                 
                              
                              =
                              
                                 
                                    Q
                                 
                                 
                                    ▵
                                 
                              
                              ×
                              
                                 
                                    P
                                 
                                 
                                    ▵
                                 
                              
                           
                        , as usual. Eq. (8) can now be written in terms of (7) and (9) as
                           
                              (10)
                              
                                 
                                    
                                       
                                          
                                             Q
                                          
                                       
                                    
                                    
                                       ∧
                                    
                                 
                                 HP
                                 =
                                 
                                    
                                       0
                                    
                                    
                                       6
                                    
                                 
                                 .
                              
                           
                        
                     

This system of equations is linear in the unknown entries of 
                           
                              H
                           
                        , the columns of which can be stacked into the 
                           
                              16
                              ×
                              1
                           
                         vector 
                           
                              h
                           
                        . The Kronecker product identity 
                           
                              vec
                              (
                              X
                              
                              Y
                              
                              Z
                              )
                              =
                           
                         
                        
                           
                              (
                              
                                 
                                    Z
                                 
                                 
                                    ⊤
                                 
                              
                              ⊗
                              X
                              )
                              
                              vec
                              (
                              Y
                              )
                           
                         can now be applied, to give
                           
                              (11)
                              
                                 
                                    
                                       
                                          
                                             
                                                P
                                             
                                             
                                                ⊤
                                             
                                          
                                          ⊗
                                          
                                             
                                                
                                                   
                                                      Q
                                                   
                                                
                                             
                                             
                                                ∧
                                             
                                          
                                       
                                    
                                 
                                 h
                                 =
                                 
                                    
                                       0
                                    
                                    
                                       6
                                    
                                 
                                 
                                 where
                                 
                                 h
                                 =
                                 vec
                                 
                                    
                                       
                                          H
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

If M points are observed on each of N planes, then there are 
                           
                              k
                              =
                              1
                              ,
                              …
                              ,
                              MN
                           
                         observed pairs of points, 
                           
                              
                                 
                                    P
                                 
                                 
                                    k
                                 
                              
                           
                         from the projective reconstruction and 
                           
                              
                                 
                                    Q
                                 
                                 
                                    k
                                 
                              
                           
                         from the range back-projection. The MN corresponding 
                           
                              6
                              ×
                              16
                           
                         matrices 
                           
                              
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             k
                                          
                                          
                                             ⊤
                                          
                                       
                                       ⊗
                                       
                                          
                                             (
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                          
                                             ∧
                                          
                                       
                                    
                                 
                              
                           
                         are stacked together, to give the complete system
                           
                              (12)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                
                                                
                                                   ⊗
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     Q
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         ∧
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   ⋮
                                                
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         MN
                                                      
                                                      
                                                         ⊤
                                                      
                                                   
                                                
                                                
                                                   ⊗
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     Q
                                                                  
                                                                  
                                                                     MN
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         ∧
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 h
                                 =
                                 
                                    
                                       0
                                    
                                    
                                       6
                                       MN
                                    
                                 
                                 ,
                              
                           
                        subject to the constraint 
                           
                              |
                              h
                              |
                              =
                              1
                           
                        , which excludes the trivial solution 
                           
                              h
                              =
                              
                                 
                                    0
                                 
                                 
                                    16
                                 
                              
                           
                        . It is straightforward to obtain an estimate of 
                           
                              h
                           
                         from the SVD of the 
                           
                              6
                              MN
                              ×
                              16
                           
                         matrix on the left of (12). This solution, which minimizes an algebraic error 
                        [12], is the singular vector corresponding to the smallest singular value of the matrix. Note that the point coordinates should be transformed, to ensure that (12) is numerically well-conditioned [12]. In this case the transformation ensures that 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    k
                                    ▵
                                 
                              
                              =
                              
                                 
                                    0
                                 
                                 
                                    3
                                 
                              
                           
                         and 
                           
                              
                                 
                                    1
                                 
                                 
                                    MN
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                 
                              
                              |
                              
                                 
                                    P
                                 
                                 
                                    k
                                    ▵
                                 
                              
                              |
                              =
                              
                                 
                                    3
                                 
                              
                           
                        , where 
                           
                              
                                 
                                    P
                                 
                                 
                                    k
                                    4
                                 
                              
                              =
                              1
                           
                        . The analogous transformation is applied to the range points 
                           
                              
                                 
                                    Q
                                 
                                 
                                    k
                                 
                              
                           
                        .

The above procedure effectively computes a projective basis in 3D, which requires five points, no four of which may be co-planar. This gives 
                           
                              5
                              ×
                              3
                           
                         numbers, which are equivalent to the 15 parameters of the homogeneous 
                           
                              4
                              ×
                              4
                           
                         matrix 
                           
                              H
                           
                        . In practice, however, we require full detection of 35 vertices per board, and around 10 boards per homography (depending on visibility constraints). Hence the procedure operates far from any degenerate cases, which would involve fewer than 15 degrees of freedom in total.

The DLT method, in practice, gives a good approximation 
                           
                              
                                 
                                    H
                                 
                                 
                                    DLT
                                 
                              
                           
                         of the homography (3). This can be used as a starting-point for the iterative minimization of a more appropriate error measure. In particular, consider the reprojection error in the left image,
                           
                              (13)
                              
                                 
                                    
                                       E
                                    
                                    
                                       ℓ
                                    
                                 
                                 (
                                 
                                    
                                       C
                                    
                                    
                                       ℓ
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          MN
                                       
                                    
                                 
                                 D
                                 
                                    
                                       
                                          
                                             
                                                
                                                   C
                                                
                                                
                                                   ℓ
                                                
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             ,
                                             
                                             
                                                
                                                   p
                                                
                                                
                                                   ℓ
                                                   k
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              D
                              (
                              p
                              ,
                              q
                              )
                              =
                              |
                              
                              
                                 
                                    p
                                 
                                 
                                    ▵
                                 
                              
                              /
                              
                                 
                                    p
                                 
                                 
                                    3
                                 
                              
                              -
                              
                                 
                                    q
                                 
                                 
                                    ▵
                                 
                              
                              /
                              
                                 
                                    q
                                 
                                 
                                    3
                                 
                              
                              |
                           
                        . A 12-parameter minimization of the reprojection error (13), starting with the linear estimate 
                           
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                              ←
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                              
                                 
                                    H
                                 
                                 
                                    DLT
                                 
                                 
                                    -
                                    1
                                 
                              
                           
                        , is then performed by the Levenberg–Marquardt algorithm [42]. The result will be the camera matrix 
                           
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                                 
                                    ★
                                 
                              
                           
                         that best reprojects the range data into the left image (
                           
                              
                                 
                                    C
                                 
                                 
                                    r
                                 
                                 
                                    ★
                                 
                              
                           
                         is similarly obtained). The solution, provided that the calibration points adequately covered the scene volume, will remain valid for subsequent depth and range data.

Alternatively, it is possible to minimize the joint reprojection error, defined as the sum of left and right contributions,
                           
                              (14)
                              
                                 E
                                 
                                    
                                       
                                          
                                             
                                                H
                                             
                                             
                                                -
                                                1
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       ℓ
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                C
                                             
                                             
                                                ℓ
                                             
                                          
                                          
                                             
                                                H
                                             
                                             
                                                -
                                                1
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       r
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                C
                                             
                                             
                                                r
                                             
                                          
                                          
                                             
                                                H
                                             
                                             
                                                -
                                                1
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        over the (inverse) homography 
                           
                              
                                 
                                    H
                                 
                                 
                                    -
                                    1
                                 
                              
                           
                        . The 16 parameters are again minimized by the Levenberg–Marquardt algorithm, starting from the DLT solution 
                           
                              
                                 
                                    H
                                 
                                 
                                    DLT
                                 
                                 
                                    -
                                    1
                                 
                              
                           
                        .

The difference between the separate (13) and joint (14) minimizations is that the latter preserves the original epipolar geometry, whereas the former does not. Recall that 
                           
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                           
                         
                        
                           
                              
                                 
                                    C
                                 
                                 
                                    r
                                 
                              
                              ,
                              H
                           
                         and 
                           
                              F
                           
                         are all defined up to scale, and that 
                           
                              F
                           
                         satisfies an additional rank-two constraint [12]. Hence the underlying parameters can be counted as 
                           
                              (
                              12
                              -
                              1
                              )
                              +
                              (
                              12
                              -
                              1
                              )
                              =
                              22
                           
                         in the separate minimizations, and as 
                           
                              (
                              16
                              -
                              1
                              )
                              =
                              15
                           
                         in the joint minimization. The fixed epipolar geometry accounts for the 
                           
                              (
                              9
                              -
                              2
                              )
                           
                         missing parameters in the joint minimization. If 
                           
                              F
                           
                         is known to be very accurate (or must be preserved) then the joint minimization (14) should be performed. This will also preserve the original binocular triangulation, provided that a projective-invariant method was used [43]. However, if minimal reprojection error is the objective, then the cameras should be treated separately. This will lead to a new fundamental matrix 
                           
                              
                                 
                                    F
                                 
                                 
                                    ★
                                 
                              
                              =
                              
                                 
                                    (
                                    
                                       
                                          e
                                       
                                       
                                          r
                                       
                                       
                                          ★
                                       
                                    
                                    )
                                 
                                 
                                    ×
                                 
                              
                              
                                 
                                    C
                                 
                                 
                                    r
                                 
                                 
                                    ★
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          C
                                       
                                       
                                          ℓ
                                       
                                       
                                          ★
                                       
                                    
                                    )
                                 
                                 
                                    +
                                 
                              
                           
                        , where 
                           
                              
                                 
                                    (
                                    ·
                                    )
                                 
                                 
                                    +
                                 
                              
                           
                         is the generalized inverse, and 
                           
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                                 
                                    ★
                                 
                              
                           
                        , 
                           
                              
                                 
                                    C
                                 
                                 
                                    r
                                 
                                 
                                    ★
                                 
                              
                           
                         are the optimized camera-matrices. The epipole in the right-hand image is obtained from 
                           
                              
                                 
                                    e
                                 
                                 
                                    r
                                 
                                 
                                    ★
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    r
                                 
                                 
                                    ★
                                 
                              
                              
                                 
                                    d
                                 
                                 
                                    ℓ
                                 
                                 
                                    ★
                                 
                              
                           
                        , where the vector 
                           
                              
                                 
                                    d
                                 
                                 
                                    ℓ
                                 
                                 
                                    ★
                                 
                              
                           
                         represents the nullspace 
                           
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                                 
                                    ★
                                 
                              
                              
                                 
                                    d
                                 
                                 
                                    ℓ
                                 
                                 
                                    ★
                                 
                              
                              =
                              
                                 
                                    0
                                 
                                 
                                    3
                                 
                              
                           
                        .

The methods described in Section 2.3 can be used to calibrate a single TOF+2RGBsystem; the joint calibration of several such systems will now be explained. In this section the notation 
                        
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                        
                      will be used for the binocular coordinates (with respect to the left camera) of a point in the i-th system, and likewise 
                        
                           
                              
                                 Q
                              
                              
                                 i
                              
                           
                        
                      for the TOFcoordinates of a point in the same system. Hence the i-th TOF, left and right RGBcameras (sharing the same physical mounting) have the form
                        
                           (15)
                           
                              
                                 
                                    
                                    
                                       
                                          
                                             
                                                C
                                             
                                             
                                                i
                                             
                                          
                                          ≃
                                          
                                             
                                                
                                                   
                                                      
                                                         A
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   |
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                C
                                             
                                             
                                                ℓ
                                                i
                                             
                                          
                                          ≃
                                          
                                             
                                                
                                                   
                                                      
                                                         A
                                                      
                                                      
                                                         ℓ
                                                         i
                                                      
                                                   
                                                   
                                                   |
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                             
                                          
                                          
                                          and
                                          
                                          
                                             
                                                C
                                             
                                             
                                                ri
                                             
                                          
                                          ≃
                                          
                                             
                                                
                                                   
                                                      
                                                         A
                                                      
                                                      
                                                         ri
                                                      
                                                   
                                                   
                                                   |
                                                   
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ri
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              
                                 A
                              
                              
                                 i
                              
                           
                        
                      and 
                        
                           
                              
                                 A
                              
                              
                                 ℓ
                                 i
                              
                           
                        
                      contain only intrinsic parameters, whereas 
                        
                           
                              
                                 A
                              
                              
                                 ri
                              
                           
                        
                      also encodes the relative orientation of 
                        
                           
                              
                                 C
                              
                              
                                 ri
                              
                           
                        
                      with respect to 
                        
                           
                              
                                 C
                              
                              
                                 ℓ
                                 i
                              
                           
                        
                     . Each system has a transformation 
                        
                           
                              
                                 H
                              
                              
                                 i
                              
                              
                                 -
                                 1
                              
                           
                        
                      that maps TOFpoints 
                        
                           
                              
                                 Q
                              
                              
                                 i
                              
                           
                        
                      into the corresponding RGBcoordinate system of 
                        
                           
                              
                                 C
                              
                              
                                 ℓ
                                 i
                              
                           
                        
                     . Furthermore, let the 
                        
                           4
                           ×
                           4
                        
                      matrix 
                        
                           
                              
                                 G
                              
                              
                                 ij
                              
                           
                        
                      be the transformation from system j, mapping back to system i (between different physical mountings). This matrix, in the binocularly-calibrated case, is a rigid 3Dtransformation. However, by analogy with the TOF-to-RGBmatrices 
                        
                           H
                        
                     , each 
                        
                           
                              
                                 G
                              
                              
                                 ij
                              
                           
                        
                      could be a projective transformation in the uncalibrated case; this would allow Euclidean structure to propagate from the TOFmeasurements, across the entire camera network.

The left and right cameras, in all cases, that project a scene-point 
                        
                           
                              
                                 P
                              
                              
                                 j
                              
                           
                        
                      in coordinate system j to image-points 
                        
                           
                              
                                 p
                              
                              
                                 ℓ
                                 i
                              
                           
                        
                      and 
                        
                           
                              
                                 p
                              
                              
                                 ri
                              
                           
                        
                      in system i are
                        
                           (16)
                           
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                    ij
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                    i
                                 
                              
                              
                              
                              
                                 
                                    G
                                 
                                 
                                    ij
                                 
                              
                              
                              and
                              
                              
                                 
                                    C
                                 
                                 
                                    rij
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    ri
                                 
                              
                              
                              
                              
                                 
                                    G
                                 
                                 
                                    ij
                                 
                              
                              .
                           
                        
                     Note that if a single global coordinate system is chosen to coincide with the k-th RGBsystem, then a point 
                        
                           
                              
                                 P
                              
                              
                                 k
                              
                           
                        
                      projects via 
                        
                           
                              
                                 C
                              
                              
                                 ℓ
                                 ik
                              
                           
                        
                      and 
                        
                           
                              
                                 C
                              
                              
                                 rik
                              
                           
                        
                     . These two cameras are respectively equal to 
                        
                           
                              
                                 C
                              
                              
                                 ℓ
                                 i
                              
                           
                        
                      and 
                        
                           
                              
                                 C
                              
                              
                                 ri
                              
                           
                        
                      in (15) only when 
                        
                           i
                           =
                           k
                        
                     , such that 
                        
                           
                              
                                 G
                              
                              
                                 ij
                              
                           
                           =
                           I
                        
                      in (16). A typical three-system configuration is shown in Fig. 2
                     .

The transformation 
                        
                           
                              
                                 G
                              
                              
                                 ij
                              
                           
                        
                      can only be estimated directly if there is a region of common visibility between systems i and j. If this is not the case (as when the systems face each other, such that the front of the calibration board is not simultaneously visible), then 
                        
                           
                              
                                 G
                              
                              
                                 ij
                              
                           
                        
                      can be computed indirectly. For example, 
                        
                           
                              
                                 G
                              
                              
                                 02
                              
                           
                           =
                           
                              
                                 G
                              
                              
                                 01
                              
                           
                           
                           
                              
                                 G
                              
                              
                                 12
                              
                           
                        
                      where 
                        
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           =
                           
                              
                                 G
                              
                              
                                 12
                              
                              
                                 -
                                 1
                              
                           
                           
                              
                                 G
                              
                              
                                 01
                              
                              
                                 -
                                 1
                              
                           
                           
                              
                                 P
                              
                              
                                 0
                              
                           
                        
                     . Note that, in all cases, the stereo-reconstructed points 
                        
                           P
                        
                      are used to estimate these transformations This is because they are always more reliable than the TOFpoints 
                        
                           Q
                        
                     , as demonstrated below.

@&#EVALUATION@&#

The following sections will describe the accuracy of a nine-camera setup, calibrated by the methods described above. Section 4.1 will evaluate calibration error, whereas Section 4.2 will evaluate total error. The former is essentially a fixed function of the estimated camera matrices, for a given scene. The latter also includes the range-noise from the TOFcameras, which varies from moment to moment (due to intrinsic noise, changing illumination, and object motion). The importance of this distinction will be discussed. In Section 4.3 we analyze the avantages of using homographies to align the data, as opposed to similarity transformations. Finally, in Section 4.4 we demonstrate some applications of the complete system.

The setup consists of three rail-mounted TOF+2RGBsystems, 
                        
                           i
                           =
                           1
                           …
                           3
                        
                     , as in Fig. 2. The stereo baselines are 17cm on average, and the TOFcameras are separated by 107cm on average. The RGBimages are 
                        
                           1624
                           ×
                           1224
                        
                     , whereas the Mesa Imaging sr4000 TOFimages are 
                        
                           176
                           ×
                           144
                        
                     , with a depth range of 500cm [6]. The three stereo systems are first calibrated by standard methods [12], returning a full Euclidean decomposition of 
                        
                           
                              
                                 C
                              
                              
                                 ℓ
                                 i
                              
                           
                        
                      and 
                        
                           
                              
                                 C
                              
                              
                                 ri
                              
                           
                        
                     , as well as the associated lens parameters. The lenses of the TOFcameras are also calibrated by standard methods [12]. This removes some of the radial depth deformation that has been observed in the TOFdata [32]. The matrices 
                        
                           
                              
                                 G
                              
                              
                                 ij
                              
                           
                        
                      are rigid-body transformations, which are estimated by the SVD method of Arun et al. [44]. Projective alignment is preferred for the TOF/RGBalignment, for reasons discussed in Sections 2 and 10. Hence the transformations 
                        
                           
                              
                                 H
                              
                              
                                 j
                              
                              
                                 -
                                 1
                              
                           
                        
                      are 
                        
                           4
                           ×
                           4
                        
                      homographies, estimated by the method of Section 2.3. Specifically, the DLT solutions were refined by Levenberg–Marquardt minimization of the joint geometric error, as in (14).

The calibration error is measured by first taking TOFpoints 
                           
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                                 
                                    π
                                 
                              
                           
                         corresponding to chequerboard vertices on the reconstructed calibration plane 
                           
                              
                                 
                                    π
                                 
                                 
                                    j
                                 
                              
                           
                         in system j, as described in Section 2.2. These can then be projected into a pair of RGBimages in system i, so that the geometric image-error 
                           
                              
                                 
                                    E
                                 
                                 
                                    ij
                                 
                                 
                                    cal
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             ℓ
                                             ij
                                          
                                          
                                             cal
                                          
                                       
                                       +
                                       
                                          
                                             E
                                          
                                          
                                             rij
                                          
                                          
                                             cal
                                          
                                       
                                    
                                 
                              
                           
                         can be computed, where
                           
                              (17)
                              
                                 
                                    
                                       E
                                    
                                    
                                       ℓ
                                       ij
                                    
                                    
                                       cal
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       |
                                       π
                                       |
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                j
                                             
                                             
                                                π
                                             
                                          
                                       
                                    
                                 
                                 D
                                 
                                    
                                       
                                          
                                             
                                                C
                                             
                                             
                                                ℓ
                                                ij
                                             
                                          
                                          
                                          
                                             
                                                H
                                             
                                             
                                                j
                                             
                                             
                                                -
                                                1
                                             
                                          
                                          
                                             
                                                Q
                                             
                                             
                                                j
                                             
                                             
                                                π
                                             
                                          
                                          ,
                                          
                                          
                                          
                                          
                                             
                                                p
                                             
                                             
                                                ℓ
                                                i
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        and 
                           
                              
                                 
                                    E
                                 
                                 
                                    rij
                                 
                                 
                                    cal
                                 
                              
                           
                         is similarly defined. The function 
                           
                              D
                              (
                              ·
                              ,
                              ·
                              )
                           
                         computes the image-distance between two inhomogenized points, as in (13), and the denominator corresponds to the number of vertices on the board, with 
                           
                              |
                              π
                              |
                              =
                              35
                           
                         in the present experiments. The measure (17) can of course be averaged over all images in which the board is visible. The RGBcameras were calibrated, by standard methods, as described above. Subpixel accuracy was obtained, which confirms the accuracy of the camera matrices 
                           
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                    i
                                 
                              
                           
                         and 
                           
                              
                                 
                                    C
                                 
                                 
                                    ri
                                 
                              
                           
                        , as well as the inter-system matrices 
                           
                              
                                 
                                    G
                                 
                                 
                                    ij
                                 
                              
                           
                        , where 
                           
                              i
                              ,
                              j
                              =
                              1
                              ,
                              2
                              ,
                              3
                           
                        .

For the purpose of evaluation, a new set of TOF-vertices 
                           
                              
                                 
                                    Q
                                 
                                 
                                    i
                                 
                                 
                                    π
                                 
                              
                           
                         were reconstructed, fitted and reprojected within each system i. This evaluation effectively tests the quality of the 
                           
                              
                                 
                                    H
                                 
                                 
                                    i
                                 
                                 
                                    -
                                    1
                                 
                              
                           
                         matrices, by comparing 
                           
                              
                                 
                                    C
                                 
                                 
                                    ℓ
                                    i
                                 
                              
                              
                                 
                                    H
                                 
                                 
                                    i
                                 
                                 
                                    -
                                    1
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    i
                                 
                                 
                                    π
                                 
                              
                           
                         to 
                           
                              
                                 
                                    p
                                 
                                 
                                    ℓ
                                    i
                                 
                              
                           
                        , and analogously to points 
                           
                              
                                 
                                    p
                                 
                                 
                                    ri
                                 
                              
                           
                         in the other image. Note that all camera and transformations parameters are now fixed; no optimization was performed with respect to the evaluation data. The whole experiment was performed on three large data-sets, from different capture-sessions, and with different camera configurations, labelled A, B and C. Such a configuration leads to one triplet per system as shown in Fig. 3
                        . While an image can be fronto-parallel for one frame, it may appear very slanted to the other frames. The example of Fig. 3 shows a calibration image that is almost fronto-parallel to the TOFframe of the central TOF+2RGBunit. Table 2 shows that the average reprojection error remains subpixel in all three data-sets. The corresponding error-distributions are shown as histograms in Fig. 4
                        .

It is also interesting to consider how the above TOF-vertices reproject into different systems. The error 3Derror distribution, for a given pixel (either TOFor stereo) is highly anisotropic; the direction of the corresponding ray is much more reliable than the distance along it [32]. In practice, the different TOF+2RGBsystems are distributed around the edge of the room, looking inwards. Hence a given system is likely to be seen ‘from the side’ by at least one other system. This means that any large depth errors in the first system will not cancel-out in the re-projection to the other systems. This effect is seen clearly in Fig. 5
                        , which shows calibration errors of up to several pixels, from one system to the others.

The calibration error, as reported in the preceding section, is the natural way to evaluate the estimated cameras and homographies. It is not, however, truly representative of the ‘live’ performance of the complete setup. This is because the calibration error uses each estimated plane 
                           
                              
                                 
                                    π
                                 
                                 
                                    j
                                 
                              
                           
                         to replace all vertices 
                           
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                           
                         with the fitted versions 
                           
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                                 
                                    π
                                 
                              
                           
                        . In general, however, no surface model is available, and so the raw points 
                           
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                           
                         must be used as input to segmentation, meshing and rendering processes.

The total error, which combines the calibration and range errors, can be measured as follows. The i-th RGBviews of plane 
                           
                              
                                 
                                    π
                                 
                                 
                                    j
                                 
                              
                           
                         are related to the TOFimage-points 
                           
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                              
                           
                         by the 2D
                        transfer homographies 
                           
                              
                                 
                                    T
                                 
                                 
                                    ℓ
                                    ij
                                 
                              
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    rij
                                 
                              
                           
                        , where
                           
                              (18)
                              
                                 
                                    
                                       p
                                    
                                    
                                       ℓ
                                       i
                                    
                                 
                                 ≃
                                 
                                    
                                       T
                                    
                                    
                                       ℓ
                                       ij
                                    
                                 
                                 
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                                 
                                 and
                                 
                                 
                                    
                                       p
                                    
                                    
                                       ri
                                    
                                 
                                 ≃
                                 
                                    
                                       T
                                    
                                    
                                       rij
                                    
                                 
                                 
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                                 .
                              
                           
                        These 
                           
                              3
                              ×
                              3
                           
                         matrices can be estimated to subpixel accuracy, by using the DLT algorithm [12] to obtain initial homographies, and then applying area-based alignment [45] to produce the final estimates 
                           
                              
                                 
                                    T
                                 
                                 
                                    ℓ
                                    ij
                                 
                              
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    rij
                                 
                              
                           
                        .

Let 
                           
                              
                                 
                                    Π
                                 
                                 
                                    j
                                 
                              
                           
                         be the 2Dhull (i.e.bounding-polygon) of plane 
                           
                              
                                 
                                    π
                                 
                                 
                                    j
                                 
                              
                           
                         as it appears in the TOFimage. Any pixel 
                           
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                              
                           
                         in the hull (including the original calibration vertices) can now be re-projected to the i-th RGBviews via the 3Dpoint 
                           
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                           
                        , or transferred directly by 
                           
                              
                                 
                                    T
                                 
                                 
                                    ℓ
                                    ij
                                 
                              
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    rij
                                 
                              
                           
                         in (18), as shown in Fig. 6
                        . In other words, we are able to isolate the image-to-image error that is incurred by mapping via the 3Dreconstruction, in relation to the direct 2Dto 2Dmapping defined by 
                           
                              
                                 
                                    T
                                 
                                 
                                    ℓ
                                    ij
                                 
                              
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    rij
                                 
                              
                           
                        .

The total error is the average difference between the reprojections and the transfers, 
                           
                              
                                 
                                    E
                                 
                                 
                                    ij
                                 
                                 
                                    tot
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             ℓ
                                             ij
                                          
                                          
                                             tot
                                          
                                       
                                       +
                                       
                                          
                                             E
                                          
                                          
                                             rij
                                          
                                          
                                             tot
                                          
                                       
                                    
                                 
                              
                           
                        , where
                           
                              (19)
                              
                                 
                                    
                                       E
                                    
                                    
                                       ℓ
                                       ij
                                    
                                    
                                       tot
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       |
                                       
                                          
                                             Π
                                          
                                          
                                             j
                                          
                                       
                                       |
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                          ∈
                                          
                                             
                                                Π
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 D
                                 
                                    
                                       
                                          
                                             
                                                C
                                             
                                             
                                                ℓ
                                                ij
                                             
                                          
                                          
                                          
                                             
                                                H
                                             
                                             
                                                j
                                             
                                             
                                                -
                                                1
                                             
                                          
                                          
                                             
                                                Q
                                             
                                             
                                                j
                                             
                                          
                                          ,
                                          
                                          
                                          
                                          
                                             
                                                T
                                             
                                             
                                                ℓ
                                                ij
                                             
                                          
                                          
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        and 
                           
                              
                                 
                                    E
                                 
                                 
                                    rij
                                 
                                 
                                    tot
                                 
                              
                           
                         is similarly defined. The view-dependent denominator 
                           
                              |
                              
                                 
                                    Π
                                 
                                 
                                    j
                                 
                              
                              |
                              ≫
                              |
                              π
                              |
                           
                         is the number of pixels in the hull 
                           
                              
                                 
                                    Π
                                 
                                 
                                    j
                                 
                              
                           
                        . Hence 
                           
                              
                                 
                                    E
                                 
                                 
                                    ij
                                 
                                 
                                    tot
                                 
                              
                           
                         is the total error, including both calibration errors and range-noise, of TOFplane 
                           
                              
                                 
                                    π
                                 
                                 
                                    j
                                 
                              
                           
                         as it appears in the i-th RGBcameras.

If the RGBcameras are not too far from the TOFcamera, then the range errors tend to be cancelled in the reprojection. This is evident from Table 3, in which the total errors, on average, are not much greater than the calibration errors in Table 2. It is, however, clear from Fig. 7
                        , that the tails of the total error distributions are greatly increased by outliers in the TOFdata-stream. Although errors up to 3 pixels are shown in distributions for the sake of clarity, maximum errors of more than five pixels are common (see Table 3).

When the raw TOFpoints are reprojected to a different system, a high total error is expected, because the sensor’s range-noise may be viewed ‘from the side’. Indeed, Fig. 8
                         shows that a substantial proportion of the TOFpoints reproject with total errors in excess of ten pixels. These kind of gross errors are characteristic of the TOFdata, owing to the inevitable presence of absorbing and scattering surfaces in a typical scene.

In fact, calibration error and total error are both influenced by surface orientation. For example, the higher errors in Set B of the data (see Tables 2 and 3
                        
                        ) are due to the presence of some very slanted boards, in both the fitting and evaluation data-sets; this causes two problems, as follows. Firstly, the images of these boards are very foreshortened in some systems. This leads to increased calibration error, because the vertices are hard to detect in the corresponding TOFimages. Secondly, the strength of the reflected IR signal is reduced whenever the surface is oblique to a given TOFcamera. If the surface is also absorbent (like the black squares of the board), then the total error is greatly increased, due to the combined effects of scattering and absorption.

It is possible to understand these results more fully by examining the distribution of the total error across individual boards. Fig. 9
                         shows the distribution for a board reprojected to same/different systems (i.e. part of the data from Figs. 7 and 8). There is a relatively smooth gradient of error across the board, which is attributable to errors in the fitting of plane 
                           
                              
                                 
                                    π
                                 
                                 
                                    j
                                 
                              
                           
                        , and in the estimation of the camera parameters. In addition to these effects, it is clear that the gross errors are correlated with the black squares of the board, which reflect too little of the TOFsignal. For instance, in the bottom example of Fig. 9, the mean reprojection error associated with the black squares is 
                           
                              10.05
                           
                         pixels, whereas the white squares are associated with a mean error of 
                           
                              3.55
                           
                         pixels. The effect is particularly noticeable, as expected from the histograms, when reprojecting to different camera systems.

It was argued in Section 2 that the 3Dhomography model is an appropriate way to compensate for miscalibrations of the TOFand stereo systems (and indeed it allows the stereo system to be left uncalibrated, if preferred [33]). This claim is tested in the following experiments, using data images from two new data sets.

The most obvious alternative to the homography is a rigid motion and scaling; i.e. a 3D
                        similarity transformation. Specifically, the 
                           
                              4
                              ×
                              4
                           
                         matrix 
                           
                              H
                           
                         in (3) can be replaced by the similarity transformation
                           
                              (20)
                              
                                 S
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   σ
                                                   
                                                   R
                                                
                                                
                                                   t
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              σ
                           
                         is a (positive) scalar, 
                           
                              R
                           
                         is a 
                           
                              3
                              ×
                              3
                           
                         rotation matrix, and 
                           
                              t
                           
                         is a 
                           
                              3
                              ×
                              1
                           
                         translation vector. Hence there are only seven degrees of freedom, in contrast to the fifteen of the homography. Geometrically, the similarity model can be interpreted as a rigid transformation between the TOFand stereo systems, where the baseline distance of the latter is unknown.

In principle, a homography should always result in equal or lower error, because it includes the similarity transformation as a special case. In particular, a homography can always be written as 
                           
                              H
                              =
                              SD
                           
                         where the deformation 
                           
                              D
                           
                         is composed of an affinity and an elation [12]. However, there are two practical issues to consider. Firstly, the quality of the actual estimate in each case; and secondly, the possible danger of over-fitting with the homography.

It was argued in Section 2 that the 3Dhomography model is an appropriate way to compensate for miscalibrations of the TOFand stereo systems (and also allows the stereo system to be left uncalibrated, if preferred [33]). In particular the deformation 
                           
                              D
                           
                         can help to account for locally linear depth bias in the TOFcamera [46]. Hence the additional eight degrees of freedom in the homography model allow for an overall approximation to the per-pixel corrections performed by Cui et al. [32].

The procedure to estimate the optimal similarity (20) is analogous to that used to estimate the homography in Section 2. Instead of DLT, an initial estimate is obtained from the Procrustes algorithm [47,48], using three or more correspondences. The reprojection error is then minimized using the Levenberg–Marquardt procedure, as with the homography. Note that the rotation 
                           
                              R
                           
                         in (20) is appropriately parameterized by the Rodrigues formula.

The results of these experiments are shown in Fig. 10
                        . In every TOF+2RGBsystem, and in both capture sessions, the homography results in lower error than the similarity. The mean reprojections errors (in pixels) were 0.22 vs. 0.65, and 0.46 vs. 1.06, for the respective capture sessions. The generally higher figures from the second set are due to a broader distribution of board-poses in the evaluation data-set.

These experiments show that the 3Dhomography transformation is a suitable model for TOF/RGBalignment, as argued in Section 2. It may also be noted that the homography is effectively easier to estimate than the similarity, as there is no need to maintain the orthogonality of 
                           
                              R
                           
                         during the final minimization.

The proposed cross-calibration methodology also allows a fully-textured 3Dmodel to be segmented and rendered. This is because the depth-data are automatically assigned to pixels in the RGBimages. Fig. 11
                         shows reconstruction instances with and without texture from a 360° reconstruction, obtained from the cross-calibration of four TOF+RGBsystems. Meshing was performed by the standard Poisson reconstruction method [49], followed by simple triangle-based texture mapping.

More dense reconstruction can be achieved by exploiting the full resolution of stereo cameras, as described elsewhere [11]. Fig. 12
                         shows the difference between the raw reconstruction obtained from the cross-calibration of a TOF+2RGBsystem, and that obtained after using the TOFdata in a subsequent stereo algorithm [11]. A high-resolution depth map is produced, making full use of the high-resolution RGBcameras.

@&#CONCLUSION@&#

It has been shown that 3Dprojective transformations can be used to cross-calibrate a system of TOFand stereo reconstructions. A practical method for computing these transformations, based on geometric principles, has been introduced. This calibration procedure has been extended to a nine-camera network of six RGBand three TOFcameras, and evaluated in detail.

A clear distinction has been made between calibration error, which is due to imperfect camera and image models, vs. total error, which incorporates TOF-specific noise and biases. It has been shown that these errors can be separated geometrically, and used to characterize the performance of a TOF/RGBcamera network. The overall performance of the system has been visualized in segmented 360° 3Dreconstructions. This type of reconstruction is challenging to compute, and shows that the system is more than adequate as a basis for scene-segmentation tasks.

The accuracy of the method presented here is somewhat limited by the relatively poor localization of points, even when spatially interpolated, in the TOFimages. The detection of standard chequerboard patterns, in TOFimages, has been discussed elsewhere [7]. The design of more convenient calibration patterns, for TOFcameras, would be a worthwhile direction for future research. Meanwhile, in mitigation, the spatial resolution of TOFcameras will continue to increase.

Future work should also consider the distribution of range-errors in 3D, and how this can be used to design custom meshing and surface reconstruction algorithms for time-of-flight data. This, in conjunction with the RGBtextures provided by the present method, would lead to a comprehensive approach to 3Dreconstruction, rendering and scene-understanding.

@&#ACKNOWLEDGMENT@&#

This work has received funding from Agence Nationale de la Recherche under the MIXCAM Project Number ANR-13-BS02-0010-01.

@&#REFERENCES@&#

