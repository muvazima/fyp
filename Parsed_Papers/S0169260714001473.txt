@&#MAIN-TITLE@&#QRS detection using S-Transform and Shannon energy

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           This work makes a QRS detection based on S-Transform (TS).


                        
                        
                           
                           The TS allows us access to the frequency content of the QRS complexes without recourse to any filtering.


                        
                        
                           
                           Shannon energy is computed for each obtained local spectrum. Shannon energy highlights all QRSs, even those having a small amplitude.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

QRS detection

S-Transform

Shannon energy

@&#ABSTRACT@&#


               
               
                  This paper presents a novel method for QRS detection in electrocardiograms (ECG). It is based on the S-Transform, a new time frequency representation (TFR). The S-Transform provides frequency-dependent resolution while maintaining a direct relationship with the Fourier spectrum. We exploit the advantages of the S-Transform to isolate the QRS complexes in the time–frequency domain. Shannon energy of each obtained local spectrum is then computed in order to localize the R waves in the time domain.
                  Significant performance enhancement is confirmed when the proposed approach is tested with the MIT-BIH arrhythmia database (MITDB). The obtained results show a sensitivity of 99.84%, a positive predictivity of 99.91% and an error rate of 0.25%. Furthermore, to be more convincing, the authors illustrated the detection parameters in the case of certain ECG segments with complicated patterns.
               
            

@&#INTRODUCTION@&#

Electrocardiography is an important tool in diagnosing the condition of the heart. The electrocardiogram (ECG) is a signal that records the electrical activity of the heart. It is characterized by its main waves: P, QRS and T. QRS complex is the most striking waveform within the ECG. It represents the depolarization phenomenon of the ventricles and yields useful information about their behavior.

Since the QRS complex is the dominant feature of the ECG signal, its detection is a crucial part of any ECG analysis algorithm. Once the positions of the QRS complexes are found, the locations of other components like P, T waves and ST segment, etc. are found relative to the position of the QRS, in order to analyze the complete cardiac period. QRS detection can be done rather easily by the trained eye of cardiologist. Unluckily, the problem of automation of this process is difficult, not only because of the physiological variability of the QRS complexes, but also because of the various types of noise that can be present in the ECG signal. Noise sources include muscle noise, artifacts due to electrode motion, power-line interference, baseline wander, P and T waves with high-frequency characteristics similar to QRS complexes.

Within the last decades, a wide diversity of QRS detection algorithms have been proposed in the literature. In [1], Köhler et al. have summarized and compared the most important approaches proposed until 2000. Refs. [2–4] represent original works on this subject. Such algorithms are based on digital filters and ECG signal derivative. This points out the usage of the characteristic steep slop of the QRS for its detection. Other algorithms are based on more sophisticated filters [5–7], filters and Hilbert transform [8]. Some algorithms operate in the time domain. R peak detection based on zero crossing counts is proposed in [9]. In [10], Christov has used adaptive thresholds considering noise level and low amplitude beats. Wavelet transform has also been widely used for QRS detection [11–16] but along with its flexibility, comes the price of determining the appropriate mother wavelet and level decomposition. Other methods were based on more complex approaches, neural network [12,17], Support Vector Machines [18], genetic algorithms [19], Hidden Markov Models [20], K-Nearest Neighbor [21] and combination of different algorithms working in parallel [22,23].

Although the performance of these algorithms, high detection accuracy still remains open problems. The currently achievable detection rates hide the problems that are still present in case of very noisy or pathological signals. A satisfying solution to these problems is still not found.

QRS detection algorithm in this paper is based on the S-Transform (ST). After ECG time–frequency decomposition, Shannon energy of local spectra is used to localize each QRS complex. The proposed algorithm was validated against the standard MIT-BIH arrhythmia database (MITDB).

The paper is organized as follows. After an introductory, Section 2 presents the S-Transform principle and how the QRS complexes are localized in the time domain. Accordingly, an algorithm of R peak detection is developed. The proposed method is tested in Section 3. Finally, Section 4 concludes the paper.

@&#METHOD@&#

To analyze QRS detector performance, it is necessary to use a standard database, so obtained results can be interpreted and compared to other results. Several standard ECG databases are available for the evaluation of software QRS detection algorithms. Tests on these annotated databases provide reproducible and comparable results. Furthermore, these databases contain atypical waveforms, considerable artifacts and broad variety of QRS morphologies.

Frequently, the annotated MIT-BIH arrhythmia database [25] is used. This database contains 48 records. Each record is of 30min length with a sampling frequency f
                        
                           s
                        
                        =360Hz. The data were recorded in two channels (modified limb lead II and one of the modified leads V1, V2, V4 or V5) of surface ECG [25]. Since normal QRS complexes might be usually prominent in lead II, this lead was used as a default. However, some segments with saturation are replaced by those of the other lead (eg, record 116: 1354.2–1361.9s). Two cardiologists have annotated all beats. Approximately 70% of the beats are annotated as Normal.

The complete database was considered, except for record 207, where a data segment showing ventricular flutter waves, for a total of 142.5s are excluded. Note that these intervals are not annotated.

The S-Transform was proposed in 1996 by Stockwell [24]. It provides frequency-dependent resolution while maintaining a direct relationship with the Fourier spectrum. The ST originates from two advanced signal processing tools, the short time Fourier transform (STFT) and the wavelet transform (WT). It can be viewed as a frequency dependant STFT or a phase corrected wavelet transform. This transform provides a good time and frequency resolution. In addition, it allows us access to any frequency component in the time–frequency domain without requiring to any digital filter.

Derived from the STFT, the standard ST of a time varying signal x(t) is given by:
                           
                              (1)
                              
                                 S
                                 (
                                 τ
                                 ,
                                 f
                                 )
                                 =
                                 
                                    ∫
                                    
                                       −
                                       ∞
                                    
                                    
                                       +
                                       ∞
                                    
                                 
                                 x
                                 (
                                 t
                                 )
                                 w
                                 (
                                 t
                                 −
                                 τ
                                 )
                                 
                                    e
                                    
                                       −
                                       i
                                       2
                                       π
                                       ft
                                    
                                 
                                 dt
                              
                           
                        where 
                           w
                           (
                           t
                           )
                         is a time window centered in t
                        =0 and used to extract a segment of x(t). The S-Transform can be found by defining a particular window function 
                           w
                           (
                           t
                           )
                        , a normalized gaussian:
                           
                              (2)
                              
                                 w
                                 (
                                 t
                                 )
                                 =
                                 
                                    1
                                    
                                       σ
                                       
                                          
                                             2
                                             π
                                          
                                       
                                    
                                 
                                 
                                    e
                                    
                                       (
                                       
                                          −
                                          
                                             t
                                             2
                                          
                                       
                                       )
                                       /
                                       (
                                       
                                          2
                                          
                                             σ
                                             2
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        where σ characterizes the width of the gaussian window. Note that the gaussian window was chosen since it is the most compact in time and frequency. We allow 
                           w
                           (
                           t
                           )
                         a translation τ and a dilatation (a variable width σ). A constraint is added to restrict the window width σ to be a function of the frequency
                           
                              (3)
                              
                                 σ
                                 (
                                 f
                                 )
                                 =
                                 
                                    1
                                    
                                       |
                                       f
                                       |
                                    
                                 
                              
                           
                        so Eq. (2) becomes
                           
                              (4)
                              
                                 w
                                 (
                                 t
                                 −
                                 τ
                                 )
                                 =
                                 
                                    
                                       |
                                       f
                                       |
                                    
                                    
                                       
                                          
                                             2
                                             π
                                          
                                       
                                    
                                 
                                 
                                    e
                                    
                                       (
                                       
                                          −
                                          
                                             
                                                (
                                                t
                                                −
                                                τ
                                                )
                                             
                                             2
                                          
                                          
                                             f
                                             2
                                          
                                       
                                       )
                                       /
                                       2
                                    
                                 
                              
                           
                        
                     

The function S-Transform is then rephrased as
                           
                              (5)
                              
                                 S
                                 (
                                 τ
                                 ,
                                 f
                                 )
                                 =
                                 
                                    
                                       |
                                       f
                                       |
                                    
                                    
                                       
                                          
                                             2
                                             π
                                          
                                       
                                    
                                 
                                 
                                    ∫
                                    
                                       −
                                       ∞
                                    
                                    
                                       +
                                       ∞
                                    
                                 
                                 x
                                 (
                                 t
                                 )
                                 
                                    e
                                    
                                       (
                                       
                                          −
                                          
                                             
                                                (
                                                t
                                                −
                                                τ
                                                )
                                             
                                             2
                                          
                                          
                                             f
                                             2
                                          
                                       
                                       )
                                       /
                                       2
                                    
                                 
                                 
                                    e
                                    
                                       −
                                       i
                                       2
                                       π
                                       ft
                                    
                                 
                                 dt
                              
                           
                        where τ and f denote respectively the time of the spectral localization and Fourier frequency. The window width σ varying inversely with frequency makes S-Transform performing a multi-resolution analysis on the signal. At each instant t
                        
                           o
                        , the one dimensional function of the frequency variable f defined by S(t
                        
                           o
                        , f) is a local spectrum. The one dimensional function of the time variable τ and a fixed frequency f
                        
                           o
                         defined by S(τ, f
                        
                           o
                        ) is called a voice.

In Eq. (5), the S-Transform can be seen as a continuous wavelet transform W(τ, d) with a specific mother wavelet and a phase factor correction [24]
                        
                           
                              (6)
                              
                                 S
                                 (
                                 τ
                                 ,
                                 f
                                 )
                                 =
                                 W
                                 (
                                 τ
                                 ,
                                 d
                                 )
                                 
                                    e
                                    
                                       −
                                       i
                                       2
                                       π
                                       f
                                       τ
                                    
                                 
                              
                           
                        with a constraint that the wavelet dilatation factor d
                        =
                        σ(f). hence, the mother wavelet is
                           
                              (7)
                              
                                 ψ
                                 (
                                 t
                                 ,
                                 f
                                 )
                                 =
                                 
                                    
                                       |
                                       f
                                       |
                                    
                                    
                                       
                                          
                                             2
                                             π
                                          
                                       
                                    
                                 
                                 
                                    e
                                    
                                       (
                                       
                                          −
                                          
                                             t
                                             2
                                          
                                          
                                             f
                                             2
                                          
                                       
                                       )
                                       /
                                       2
                                    
                                 
                                 
                                    e
                                    
                                       −
                                       i
                                       2
                                       π
                                       ft
                                    
                                 
                              
                           
                        Note that the wavelet (7) does not satisfy the admissibility condition of having a zero mean, so (6) is not strictly a CWT. The ST returns correct amplitude response for all frequencies and produces a time frequency representation instead of the time scale representation developed by the CWT. These two representations were compared in [26].

For a time series x(kT) corresponding to x(t) with k
                        =0, …, N
                        −1 and T, the time sampling interval, the discrete Fourier transform (DFT) is
                           
                              (8)
                              
                                 X
                                 
                                    
                                       
                                          
                                             n
                                             NT
                                          
                                       
                                    
                                 
                                 =
                                 
                                    1
                                    N
                                 
                                 
                                    ∑
                                    
                                       k
                                       =
                                       0
                                    
                                    
                                       N
                                       −
                                       1
                                    
                                 
                                 x
                                 (
                                 kT
                                 )
                                 
                                    e
                                    
                                       (
                                       
                                          −
                                          i
                                          2
                                          π
                                          nk
                                       
                                       )
                                       /
                                       N
                                    
                                 
                              
                           
                        where n
                        =0, …, M
                        −1 and M, the length of the DFT. The discrete version of S-Transform is given by:
                           
                              (9)
                              
                                 S
                                 (
                                 j
                                 ,
                                 n
                                 )
                                 =
                                 
                                    ∑
                                    
                                       m
                                       =
                                       0
                                    
                                    
                                       N
                                       −
                                       1
                                    
                                 
                                 X
                                 (
                                 m
                                 +
                                 n
                                 )
                                 W
                                 (
                                 m
                                 ,
                                 n
                                 )
                                 
                                    e
                                    
                                       (
                                       
                                          i
                                          2
                                          π
                                          mj
                                       
                                       )
                                       /
                                       N
                                    
                                 
                                 ;
                                 
                                 n
                                 ≠
                                 0
                              
                           
                        where 
                           W
                           (
                           m
                           ,
                           n
                           )
                           =
                           
                              e
                              
                                 (
                                 
                                    −
                                    2
                                    
                                       π
                                       2
                                    
                                    
                                       m
                                       2
                                    
                                 
                                 )
                                 /
                                 
                                    
                                       n
                                       2
                                    
                                 
                              
                           
                        , X(.) are obtained by shifting the DFT of x(kT) and ((n/NT)→
                        f, jT
                        →
                        τ). For n
                        =0, (f
                        =0), we have the average of the time series at the zero frequency voice [24,26]:
                           
                              (10)
                              
                                 S
                                 (
                                 j
                                 ,
                                 0
                                 )
                                 =
                                 
                                    1
                                    N
                                 
                                 
                                    ∑
                                    
                                       m
                                       =
                                       0
                                    
                                    
                                       N
                                       −
                                       1
                                    
                                 
                                 x
                                 
                                    
                                       
                                          
                                             m
                                             NT
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The output of the discrete S-Transform is an N
                        ×
                        M matrix called ST-matrix where rows represent the time and columns, the frequencies. In this paper, a frequency range [0–(f
                        
                           s
                        /2)Hz] is used to cover the composite ECG signal.

To study the QRS frequency content, four heartbeat types are considered: Normal beats (N), Premature Ventricular Contractions (PVC), Left and Right Bundle Branch Blocks (L and R). In a previous work [15], we showed that the frequency content of these beats representing the predominant classes of the considered database belongs essentially to the frequency band [5–22.5Hz]. This can be also seen in Fig. 1
                        . For this illustration, we have selected an ECG segment from record 119 containing normal beats, N (shifting to high frequencies) and PVC beats (shifting to low frequencies). In this figure, one can see that if we consider the frequency band cited above, the effect of P and T waves will be removed.

In order to detect QRS complexes in the time–frequency plane, we worked within the range of frequencies [5–22.5Hz], where the heartbeats are more pertinent. Accordingly, we exploit the already proposed method in [27] to heart sounds segmentation using Shannon energy of local spectra. Shannon energy (SSE) calculates the energy of the local spectrum obtained with ST for each sample (j) of the original ECG. Therefore, the SSE of each row “j” of the extracted ST-matrix in the selected frequency band is:
                              
                                 (11)
                                 
                                    SSE
                                    (
                                    j
                                    )
                                    =
                                    −
                                    
                                       ∑
                                       
                                          n
                                          =
                                          
                                             n
                                             o
                                          
                                       
                                       
                                          
                                             n
                                             1
                                          
                                       
                                    
                                    
                                       
                                          [
                                          S
                                          (
                                          j
                                          ,
                                          n
                                          )
                                          ]
                                       
                                       2
                                    
                                    log
                                    
                                       
                                          [
                                          S
                                          (
                                          j
                                          ,
                                          n
                                          )
                                          ]
                                       
                                       2
                                    
                                 
                              
                           where n
                           
                              o
                            and n
                           1 correspond respectively to f
                           
                              o
                           
                           =5Hz and f
                           1
                           =22.5Hz. The normalized Shannon energy is expressed by:
                              
                                 (12)
                                 
                                    
                                       SSE
                                       n
                                    
                                    =
                                    
                                       SSE
                                       
                                          |
                                          max
                                          (
                                          SSE
                                          |
                                       
                                    
                                 
                              
                           
                        

The advantage of using Shannon energy instead of squared energy is its capacity to emphasis medium and low QRSs better than the classical squared energy (see Fig. 2
                           ). This feature is useful in the case of significant QRS amplitude changes. Fig. 3
                           c illustrates the normalized Shannon energy computed using a segment of record MIDB:107. The SSE
                              n
                            signal highlights the QRS complexes and reduces the other components.

It should be noted that QRS location can be done using various methods such as multiresolution analysis [15], filter banks [5] and mainly bandpass filtering [1–3,6]. Fig. 4
                            shows a brief comparison between the proposed approach and bandpass filtering. The bandpass filtered ECG presents distortions due to the calculation process. This needs additional signal processing steps. In addition, the maxima are slightly shifted from the R peak positions. However, Shannon energy exhibits a smooth envelope where the effect of P and T waves is completely removed. Its maxima have the same positions as the R peaks. This combination of desirable features motivated us to retain the SSE signal as a temporal detection parameter.

The following algorithm summarizes the procedure used for QRS detection using Shannon envelope computed on the extracted ST matrix.


                           
                              
                                 1
                                 Apply S-transform to ECG signal x(j),

Compute the normalized Shannon energy SSE
                                       n
                                     on the selected frequency band,

QRS localization: Select SSE
                                       n
                                    (j) associated to QRS complex using a threshold λ
                                    =0, 3*max(SSE
                                       n
                                    ),
                                       
                                          -
                                          if SSE
                                                n
                                             (j)≥
                                             λ then position j
                                             ∈QRS (candidate),

else position j ∉ QRS,

Identify different QRS complexes: if j, j′ are consecutive selected positions: |j
                                    −
                                    j′|<36 then (x(j), x(j′)) ∈ same QRS else (x(j), x(j′)) ∉ same QRS. (36*
                                    f
                                    
                                       s
                                    
                                    =100ms is the standard QRS duration).

Elimination of multiple detection: a peak occurring within the refractory period (200ms) is disregarded. This constraint is a physiological one due to the refractory period during which ventricular depolarization cannot occur (QRS cannot occur).

Searchback for eventual missed QRS complexes: If no QRS complex is detected within 150% of the current RR interval, then we apply a searchback using a secondary threshold of 0.5 times the previous one to find any missed peaks [3,4,15].

In order to evaluate the performance of our algorithm, all considered ECG records was analyzed.

The principle of our algorithm is the access to any voice, hence, to the frequency content of the signal of interest (QRS complex) without recourse to filtering to remove the effect of noise, P and T waves. As a first application, we examine the localization of QRS complexes by avoiding the effect of P and T waves. For this, we used a segment of record 201 containing PVC beats and tall peaked T waves. Fig. 5
                     a plots the original ECG waveforms corresponding to the ranges of [638.8–650.3s]. The ST spectrogram displayed in Fig. 5b shows that in the selected frequency band [5–22.5Hz], the energy corresponds essentially to the QRS complexes. We note that the P and T waves belong to the frequency band [0–5Hz]. This allows us to isolate these QRSs in the time–frequency domain. In Fig. 5c, one can see that Shannon envelope leads to a correct enhancement of all R-peaks.

To show the robustness of the proposed method, we found it necessary to illustrate the QRS detection parameters on some selected ECG segments from records with abnormal beats and severe artifacts such as records (104, 105, 108, 203 and 228). These records are those for which most algorithms found in literature obtained worst results [1,2,5,9,15].

Tape 104, original ECG of a 66 years old woman is characterized by occurrence of several bursts of muscle noise. In Fig. 6
                     b, we can see that the muscle artifacts are shifted to high frequencies. This record is surely a good case for showing how the effect of high frequency noises is removed without filtering. We obtained a perfect extraction of the QRSs in the time–frequency domain, so Shannon energy localizes all the corresponding R peaks in the time domain. The artifacts amplitude in the segment [318–321s] is higher than that of the R waves but significantly attenuated in the localization signal SSE
                        n
                     . Hence, all R peaks are accurately detected (Fig. 6a).

Record 105 is an ECG of a 73 years old woman. The predominant feature of this tape is high-grade noise, artifacts, abnormal shapes and unclassifiable beats. especially at the episodes [1223–1247s], [1322–1333s], [1647–1661s] and [1688– 1697.2s]. Fig. 7
                     a plots the original ECG waveforms corresponding to the episode [1223–1237s]. It seems difficult, even for human eye to discriminate clearly the ECG beats from the cases with serious distortion of the ECG. There is a broad variety of QRS morphologies, noise and baseline shifts. The ST spectrogram displayed in Fig. 7b shows that in the frequency band [5–22.5Hz], the energy belongs essentially to the QRS complexes where the energy corresponding to the artifacts and baseline wander can be seen below 5Hz. This allows us to isolate these QRSs in the time–frequency domain. Fig. 7c illustrates Shannon energy computed using the selected time–frequency matrix.

Record 108 is with a borderline indication of a first degree of auriculo-ventricular blocks, fusion PVC and severe morphological changes. The ECG waveform given in Fig. 8
                     a is taken from the noisy episode of the record [25]. It displays peaked P waves quite uncharacteristic in morphology of typical P waves. This record also exhibits muscle noise and considerable baseline shifts. In the spectrogram (Fig. 8b), one can see that although their small amplitude, the QRS complexes are clearly isolated from the rest of the signal components. The peaked P waves show a frequency content slightly higher than 5Hz. Such waves could be detected as QRS complexes because of their high slopes. However, the high temporal resolution of the S-Transform allowed us to accurately locate all R peaks see (Fig. 8c).

In record 203 (a man of 43 years old), the PVCs are multiform. There are many QRS morphologies, sudden R amplitude variation and heart rate changes. There is considerable noise including muscle artifact and baseline shifts. This is a very difficult record, even for humans [25]. Fig. 9
                     a displays an original segment among the most challenging of this record. Heartbeats of a smaller amplitude are clearly separated from the other components in the time–frequency image (Fig. 9b). Therefore, all R peaks are correctly located (see Fig. 9c).

In Fig. 10
                     a, the selected segment of record 228 (a woman of 80 years old) shows multiform PVCs, small R waves with considerable baseline drift. The detection parameters illustrate clearly the localization of all R peaks (see Fig. 10c).

The presented results showed that the proposed method is precise in presence of high frequency noises as shown for the case of record 104 (Fig. 6), multi patterns problems signals such as the record 203 (Fig. 9), broad variety of QRS morphologies and baseline shift as noticed when screening the segments of the record 105 (Fig. 7). We note also that the R peaks beats are detected using the initial threshold λ
                     =0.3max(SSE
                        n
                     ).

Based on the frequency characteristics of the QRS complex, it might appear that a bandpass filtering might be used to localize the QRS complex. However, the traditional filters when applied to non-stationary signals such as QRS complex, might introduce jitter to the fiducial points (R-wave). Hence, the RR intervals might have high uncertainty. However, the time–frequency approach used here is devoid of this problem and the proposed approach reliably localizes the R waves.

Moreover, statistical parameters are used in order to compare detection algorithms. The sensitivity S
                     
                        e
                     , the positive predictivity P
                     + and the error rate E
                     
                        r
                      are defined respectively as:
                        
                           •
                           
                              
                                 
                                    S
                                    e
                                 
                                 =
                                 
                                    TP
                                    
                                       TP
                                       +
                                       FN
                                    
                                 
                              
                           


                              
                                 
                                    P
                                    +
                                 
                                 =
                                 
                                    TP
                                    
                                       TP
                                       +
                                       FP
                                    
                                 
                              
                           


                              
                                 
                                    E
                                    r
                                 
                                 =
                                 
                                    
                                       FN
                                       +
                                       FP
                                    
                                    TB
                                 
                              
                           

The achieved results reported in Table 1
                      show that our algorithm succeeded in detecting correctly 99.84% of total beats, further, the positive predictivity P
                     +
                     =99.91% and the error rate Er
                     =0.25%. Some records (105, 108, and 201) leading to an error rate higher than 1.2% suffer from changes in signal quality, baseline shifts, artifacts and QRS waves with highly unusual morphologies.

On the other hand, we performed a comparison with several other approaches cited in literature, classical algorithm [2], Digital filter based method [5], wavelet based methods [15], a zero crossing method [9], combined adaptive thresholds [10] and Combining algorithms [22] (see Table 2
                     ).

@&#CONCLUSION@&#

In this paper, a new R peak detection algorithm based on S-Transform and Shannon energy is proposed and tested with respect to the MIT-BIH arrhythmia database. To our knowledge, it is the first time that the S-Transform has been applied to QRS detection.

In this work, we pointed out the advantage of using S-Transform to access to the frequency content of the QRS complexes without recourse to any preprocessing stage and the advantage of using Shannon energy to highlight all beats, even those having a small amplitude.

The performance of our algorithm is evaluated for all 48 records of the database. The statistical indices are higher than, or comparable to those, published in the literature. Moreover, to be more convincing, we have illustrated the possibility of detecting R peak positions on some selected ECG segments with complicated patterns.

Further improvements to the algorithm may be easily achieved by extracting more features from the ST-matrix for other ECG signal processing tasks such as arrhythmia classification.

Finally, we hope that the proposed algorithm can be tested by an independent expert excluding possible author's influence.

@&#REFERENCES@&#

