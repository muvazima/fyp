@&#MAIN-TITLE@&#Improvement of automated image stitching system for DR X-ray images

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A new stitching method was proposed for X-ray images of full-spine and lower limb.


                        
                        
                           
                           The multi-time phase correlation solves the problem of inaccuracy of overlapping region.


                        
                        
                           
                           The overlapping region is less than 30% that can also be stitching successfully.


                        
                        
                           
                           It can tackle problem as image translation and rotation.


                        
                        
                           
                           The proposed method has a higher accuracy and a shorter average stitching time compared with previous methods.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

X-ray images

Improved phase correlation

Automated stitching

Fast automated stitching of spine

Digital detection imaging

@&#ABSTRACT@&#


               
               
                  The full bone structure of X-ray images cannot be captured in a single scan with Digital radiography (DR) system. The stitching method of X-ray images is very important for scoliosis or lower limb malformation diagnosing and pre-surgical planning. Based on the image registration technology, this paper proposes a new automated image stitching method for full-spine and lower limb X-ray images. The stitching method utilized down-sampling to decrease the size of image and reduce the amount of computation; improved phase correlation algorithm was adopted to find the overlapping region; correlation coefficient was used to evaluate the similarity of overlapping region; weighted blending is brought in to produce a panorama image. The performance of the proposed method was evaluated by 40 pairs of images from patients with scoliosis or lower limb malformation. The stitching method was fully automated without any user input required. The experimental results were compared with previous methods by analyzing the same database. It is demonstrated that the improved phase correlation has higher accuracy and shorter average stitching time than previous methods. It could tackle problems including image translation, rotation and small overlapping in image stitching.
               
            

@&#INTRODUCTION@&#

In the clinical diagnosis, it is often necessary to produce panoramic X-ray images with the purpose of observing the full bone structure of the patient, such as full-spine and lower limb. However, the existing Digital radiography (DR) system can only image part of the structure in a single scan; it is important to stitch several radiographs into a panoramic image. Currently, the commonly used technology in image stitching is based on grids [1], in which the grids are attached to the image detector. The images acquired by this method are shaded by the grids, which may misinform the doctors with their observation and diagnosis results, or even lead to misdiagnosis. Another stitching method is on account of exterior characteristic [2], by which markers are set on CR cassettes and then the overlapping area of the two images are marked. Though this method is simple, it is not applicable for DR X-ray equipments. In addition to that, there are some stitching methods based on X-ray ruler [3,4], which is placed along the edges and is parallel to the bones. All of this kind of methods depend on X-ray ruler which could affect observation and diagnosis. Parallax-free long bone stitching method was proposed by Wang and Traub [5] using a C-arm rotating around its X-ray source. This method can generate a parallax-free panoramic X-ray image without the requirement of any overlapping in the X-ray images. However, the method is based on C-arm system and needs a planar marker pattern. In other words, it is not applicable for CR systems.

Recently, many researchers use stitching software to stitch X-ray images of chest [6] or use template matching [7]; it is slow and not applicable for full-spine or leg. Grieser et al. [8] also adopt image stitching program to stitch full-spine images and a significant blending line in images was produced which could lead to false diagnosis. Supakul et al. [9] take on metallic ruler as a marker and Philips software to stitch the images, whereas this method does not improve the performance of image stitching for full-spine X-ray images, and stitching software results in assessed anatomical errors in digitally stitched scoliosis films. Apart from stitching software, Kumar et al. [10] propose a stitching method for X-ray images using histogram matching and mutual information, the problem is that their technique has increased complexity and does not satisfy rotation invariant. Samsudin et al. [11] bring in minimum average correlation energy filters to identify and merge pairs of X-ray images of hand. They claim that their proposed method outperforms the normalized cross-correlation (NCC) method [12] in classifying and merging the overlapping and non-overlapping medical images, but their method needs overlapping area between adjacent images not less than 30% for stitching and the experiment images are hand X-ray medical images. Therefore, their performance of stitching of full-spine X-ray images needs further verification.

Phase correlation is a fast method for image registration which combines Fourier transform and cross-power spectrum to estimate the relative translation between two images with overlapping region [13]. The phase correlation method is resilient to noise and can be extended to determine rotation and scaling differences between two images by converting the images to log-polar coordinates, where the rotation and scaling parameters can be measured in a manner invariant to translation [14,15]. However, the Fourier transform assumes a periodic function and the image will be truncated which will impair the performance of the method. It is important to employ a window function, like the Hanning window, during the Fourier transform to reduce edge effects [16].

Correlation coefficient (CC) has been used widely in medical images registration as template matching techniques [17]. The CC value is always in the range [0,1] which denotes the similarity between two images. It can cope with noisy images and change the brightness of objects [18].

On account of phase correlation and CC, we propose an X-ray images stitching method for full-spine and lower limb. The proposed algorithm employs phase correlation several times to find overlapping region in two X-ray images, and CC is used to determine the similarity of overlapping region, then the two images will be blended seamlessly by the weighted blending algorithm to produce a panorama image. In the experiment, the overlapping region of all images ranges from 16% to 32%. Our method is relatively stable with high accuracy. The main algorithm accompanied with its performance will be presented and discussed in the following sections.

@&#METHODS@&#

The flow diagram of the X-ray images stitching method is illustrated in 
                     Fig. 1. The stitching procedure proposed in this study consists of four steps: preprocessing; phase correlation; CC; image blending. In the first step, the images are down-sampled to reduce their size. In the second step, the rough overlapping region of the images is determined by phase correlation. In this stage, phase correlation algorithm repeats several times to acquire the overlapping region. If the region is invariant, we propose the best-matched position was ascertained for stitching. Then CC is employed to determine the similarity between two images. If CC is less than a certain threshold, it will be examined by a radiologist in order to take manual stitching prior to image blending. Otherwise, the images are blended seamlessly by the weighted blending algorithm to produce panorama. In the following subsections, a detailed description of the proposed method is presented.

Since the size of original X-ray images is quite large, the computation amount will be overwhelming in practice. Therefore, the images should be down-sampled to reduce the size firstly. The sampling factor K varies with the original size of the images which is defined as follows:
                           
                              (1)
                              
                                 
                                    
                                       
                                          i
                                          m
                                          a
                                          g
                                          e
                                          _
                                          s
                                          i
                                          z
                                          e
                                       
                                       
                                          K
                                          ×
                                          K
                                       
                                    
                                    ≥
                                    200
                                    ×
                                    200
                                    pixels
                                 
                              
                           
                        
                     

To guarantee sufficient areas for phase correlation, the image size after sampling should be not smaller than 200×200 pixels.

In our method, phase correlation algorithm is used for estimating the overlapping region of the two images that is to be stitched. In some cases, the noise or exposure can cause an inaccurate overlapping region. Therefore, we use phase correlation algorithm repeatedly to acquire the best-matched position.

At the first time, let 
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         denote original image and reference image, assuming there is a translation 
                           
                              
                                 x
                              
                              
                                 0
                              
                           
                         in 
                           x
                         direction and a 
                           
                              
                                 y
                              
                              
                                 0
                              
                           
                         in 
                           y
                         direction, we define
                           
                              (2)
                              
                                 
                                    
                                       
                                          f
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    x
                                    ,
                                    y
                                    )
                                    =
                                    
                                       
                                          f
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    x
                                    −
                                    
                                       
                                          x
                                       
                                       
                                          0
                                       
                                    
                                    ,
                                    y
                                    −
                                    
                                       
                                          y
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                              
                           
                        
                        
                           
                              (3)
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    ξ
                                    ,
                                    η
                                    )
                                    =
                                    
                                       
                                          F
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    ξ
                                    ,
                                    η
                                    )
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          j
                                          2
                                          π
                                          (
                                          ξ
                                          
                                             
                                                x
                                             
                                             
                                                0
                                             
                                          
                                          +
                                          η
                                          
                                             
                                                y
                                             
                                             
                                                0
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    F
                                 
                                 
                                    1
                                 
                              
                              (
                              ξ
                              ,
                              η
                              )
                           
                         and 
                           
                              
                                 
                                    F
                                 
                                 
                                    2
                                 
                              
                              (
                              ξ
                              ,
                              η
                              )
                           
                         are the Fourier transformation of the two images, their cross-power spectrum [19] is then given by
                           
                              (4)
                              
                                 
                                    P
                                    (
                                    ξ
                                    ,
                                    η
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                F
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          ξ
                                          ,
                                          η
                                          )
                                          ×
                                          
                                             
                                                
                                                   
                                                      F
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             *
                                          
                                          (
                                          ξ
                                          ,
                                          η
                                          )
                                       
                                       
                                          |
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             ξ
                                             ,
                                             η
                                             )
                                             ×
                                             
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                *
                                             
                                             (
                                             ξ
                                             ,
                                             η
                                             )
                                          
                                          |
                                       
                                    
                                    =
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          j
                                          2
                                          π
                                          (
                                          ξ
                                          
                                             
                                                x
                                             
                                             
                                                0
                                             
                                          
                                          +
                                          η
                                          
                                             
                                                y
                                             
                                             
                                                0
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          1
                                       
                                    
                                 
                                 *
                              
                              (
                              ξ
                              ,
                              η
                              )
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          2
                                       
                                    
                                 
                                 *
                              
                              (
                              ξ
                              ,
                              η
                              )
                           
                         are the complex conjugate of 
                           
                              
                                 
                                    F
                                 
                                 
                                    1
                                 
                              
                              (
                              ξ
                              ,
                              η
                              )
                           
                         and 
                           
                              
                                 
                                    F
                                 
                                 
                                    2
                                 
                              
                              (
                              ξ
                              ,
                              η
                              )
                           
                         respectively. 
                           
                              |
                              
                                 
                                    
                                       F
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 ξ
                                 ,
                                 η
                                 )
                                 
                                    
                                       
                                          
                                             F
                                          
                                          
                                             2
                                          
                                       
                                    
                                    *
                                 
                                 (
                                 ξ
                                 ,
                                 η
                                 )
                              
                              |
                           
                         is the complex magnitude of 
                           
                              
                                 
                                    F
                                 
                                 
                                    1
                                 
                              
                              (
                              ξ
                              ,
                              η
                              )
                              
                                 
                                    
                                       
                                          F
                                       
                                       
                                          2
                                       
                                    
                                 
                                 *
                              
                              (
                              ξ
                              ,
                              η
                              )
                           
                        .

Therefore, we can find impulse function 
                           
                              δ
                              (
                              x
                              −
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ,
                              y
                              −
                              
                                 
                                    y
                                 
                                 
                                    0
                                 
                              
                              )
                           
                         by inversing Fourier transform to 
                           
                              P
                              (
                              ξ
                              ,
                              η
                              )
                           
                        , the position of peak value of impulse function can tell us the first overlapping region (the red section as shown in 
                        Fig. 2). The peak value can be calculated by
                           
                              (5)
                              
                                 
                                    P
                                    e
                                    a
                                    k
                                    _
                                    v
                                    a
                                    l
                                    u
                                    e
                                    =
                                    
                                    max
                                    (
                                    a
                                    b
                                    s
                                    (
                                    δ
                                    )
                                    )
                                 
                              
                           
                        where peak value is the highest peak of absolute value of 
                           δ
                        . The position includes translation 
                           
                              
                                 x
                              
                              
                                 0
                              
                           
                         in 
                           x
                         direction and a 
                           
                              
                                 y
                              
                              
                                 0
                              
                           
                         in 
                           y
                         direction between two images. The first overlapping region is acquired by translations 
                           
                              
                                 x
                              
                              
                                 0
                              
                           
                         and 
                           
                              
                                 y
                              
                              
                                 0
                              
                           
                        .

For the second time, we extract the red section of overlapping region for phase correlation calculation; the generated overlapping region is demonstrated in Fig. 2 (green section). Afterwards, if the overlapping region is invariant, the best-matched position is found and will be blended. In practice, the position can be found by employing the phase correlation algorithm two or three times.

Also if 
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         have a rotation with 
                           
                              
                                 θ
                              
                              
                                 0
                              
                           
                         and scaling with 
                           σ
                        , we can define
                           
                              (6)
                              
                                 
                                    
                                       f
                                       2
                                    
                                    (
                                    x
                                    ,
                                    y
                                    )
                                    =
                                    
                                       f
                                       1
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   x
                                                   
                                                   cos
                                                   
                                                   
                                                      θ
                                                      0
                                                   
                                                   +
                                                   y
                                                   
                                                   sin
                                                   
                                                   
                                                      θ
                                                      0
                                                   
                                                   )
                                                
                                                ,
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   −
                                                   x
                                                   
                                                   sin
                                                   
                                                   
                                                      θ
                                                      0
                                                   
                                                   +
                                                   y
                                                   
                                                   cos
                                                   
                                                   
                                                      θ
                                                      0
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        
                     

According to [15,20], we convert image from the Cartesian coordinates 
                           
                              (
                              x
                              ,
                              y
                              )
                           
                         to the polar coordinates 
                           
                              (
                              ρ
                              ,
                              θ
                              )
                           
                        . The mathematical expression is shown as follows:
                           
                              (7)
                              
                                 
                                    ρ
                                    =
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   x
                                                   −
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                                )
                                             
                                             2
                                          
                                          +
                                          
                                             
                                                (
                                                
                                                   y
                                                   −
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         c
                                                      
                                                   
                                                
                                                )
                                             
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (8)
                              
                                 
                                    θ
                                    =
                                    
                                       
                                          tan
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          y
                                          −
                                          
                                             y
                                             c
                                          
                                       
                                       
                                          x
                                          −
                                          
                                             x
                                             c
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    c
                                 
                              
                              )
                           
                         is the center coordinate of the transformation in the Cartesian coordinates. 
                           
                              (
                              x
                              ,
                              y
                              )
                           
                         denotes the Cartesian coordinates and 
                           
                              (
                              ρ
                              ,
                              θ
                              )
                           
                         denotes the radius and the angular position in the polar coordinates.

There we use 
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              (
                              ρ
                              ,
                              θ
                              )
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                              (
                              ρ
                              ,
                              θ
                              )
                           
                         which denote polar coordinates of 
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         respectively, so we have
                           
                              (9)
                              
                                 
                                    
                                       
                                          f
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    ρ
                                    ,
                                    θ
                                    )
                                    =
                                    
                                       
                                          f
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ρ
                                                         σ
                                                      
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      θ
                                                      −
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        
                     

Then the polar coordinates 
                           
                              (
                              ρ
                              ,
                              θ
                              )
                           
                         to the log-polar coordinates 
                           
                              (
                              λ
                              ,
                              θ
                              )
                           
                        , 
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              (
                              ρ
                              ,
                              θ
                              )
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                              (
                              ρ
                              ,
                              θ
                              )
                           
                         are taken by the logarithm in 
                           ρ
                         direction, so
                           
                              (10)
                              
                                 
                                    
                                       
                                          f
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    λ
                                    ,
                                    θ
                                    )
                                    =
                                    
                                       
                                          f
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          λ
                                          −
                                          
                                             
                                                λ
                                             
                                             
                                                0
                                             
                                          
                                          ,
                                          θ
                                          −
                                          
                                             
                                                θ
                                             
                                             
                                                0
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        where 
                           
                              λ
                              =
                              
                              log
                              
                              ρ
                           
                        , 
                           
                              
                                 λ
                                 0
                              
                              =
                              
                              log
                              
                              σ
                           
                        , 
                           
                              (
                              λ
                              ,
                              θ
                              )
                           
                         denotes the log-radius and the angular position in the log-polar coordinates. It is known that 
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              (
                              λ
                              ,
                              θ
                              )
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                              (
                              λ
                              ,
                              θ
                              )
                           
                         have a translation relationship 
                           
                              (
                              
                                 
                                    λ
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    0
                                 
                              
                              )
                           
                         in Eq. (10), and we could compute the rotation 
                           
                              
                                 θ
                              
                              
                                 0
                              
                           
                         and scaling 
                           σ
                         according to Eqs. (2)–(5). An example was shown of the sampling point for image in the Cartesian coordinates as well as the transformed log-polar coordinates in 
                        Fig. 3.

CC is used as similarity indicator for the overlapping region. It can deal with noisy images and varies with brightness of objects. The function of CC is defined according to the following equation [21,22]:
                           
                              (11)
                              
                                 
                                    CC
                                    =
                                    
                                       
                                          
                                             ∑
                                             m
                                          
                                          
                                             ∑
                                             n
                                          
                                          
                                             (
                                             
                                                A
                                                
                                                   m
                                                   n
                                                
                                             
                                             −
                                             
                                                A
                                                ¯
                                             
                                             )
                                          
                                          
                                             (
                                             
                                                B
                                                
                                                   m
                                                   n
                                                
                                             
                                             −
                                             
                                                B
                                                ¯
                                             
                                             )
                                          
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   ∑
                                                   m
                                                
                                                
                                                   ∑
                                                   n
                                                
                                                
                                                   
                                                      (
                                                      
                                                         A
                                                         
                                                            m
                                                            n
                                                         
                                                      
                                                      −
                                                      
                                                         A
                                                         ¯
                                                      
                                                      )
                                                   
                                                   2
                                                
                                                )
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   m
                                                
                                                
                                                   ∑
                                                   n
                                                
                                                
                                                   
                                                      (
                                                      
                                                         B
                                                         
                                                            m
                                                            n
                                                         
                                                      
                                                      −
                                                      
                                                         B
                                                         ¯
                                                      
                                                      )
                                                   
                                                   2
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where CC represents the correlation coefficient calculation, 
                           A
                         and 
                           B
                         are the overlapping regions of two X-ray images, 
                           
                              A
                              ¯
                           
                         and 
                           
                              B
                              ¯
                           
                         denote the mean value of 
                           A
                         and 
                           B
                         respectively.

According to the consequence of the experiment taken in our method, setting the threshold at 0.85 produces the higher accuracy. Therefore threshold value of CC is set at 0.85 in this study. Owing to the exposure difference of two X-ray images in distinct time, the overlapping region of one image is not the same as the other image. Therefore, the CC of overlapping region is not equal to 1. If CC is less than that threshold, it will be checked by a radiologist and manual stitching will be carried out to stitch image.

Once the overlapping region of two images is acquired, weighted blending algorithm would be adopted to blend two images in order to eliminate blending seam. Let 
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                           
                         represent the two images, 
                           
                              f
                              (
                              x
                              ,
                              y
                              )
                           
                         denotes the stitched image, each pixel value can be given by the following equation:
                           
                              (12)
                              
                                 
                                    f
                                    (
                                    x
                                    ,
                                    y
                                    )
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  (
                                                                  x
                                                                  ,
                                                                  y
                                                                  )
                                                               
                                                            
                                                            
                                                               
                                                                  x
                                                                  ,
                                                                  y
                                                                  ∈
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        ω
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  (
                                                                  x
                                                                  ,
                                                                  y
                                                                  )
                                                                  +
                                                                  
                                                                     
                                                                        ω
                                                                     
                                                                     
                                                                        2
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                     
                                                                        2
                                                                     
                                                                  
                                                                  (
                                                                  x
                                                                  ,
                                                                  y
                                                                  )
                                                               
                                                            
                                                            
                                                               
                                                                  x
                                                                  ,
                                                                  y
                                                                  ∈
                                                                  
                                                                     (
                                                                     
                                                                        
                                                                           
                                                                              f
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                        
                                                                        ∩
                                                                        
                                                                           
                                                                              f
                                                                           
                                                                           
                                                                              2
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                     
                                                                        2
                                                                     
                                                                  
                                                                  (
                                                                  x
                                                                  ,
                                                                  y
                                                                  )
                                                               
                                                            
                                                            
                                                               
                                                                  x
                                                                  ,
                                                                  y
                                                                  ∈
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                     
                                                                        2
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       
                                          ω
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          y
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                L
                                             
                                          
                                       
                                       
                                          
                                             
                                                y
                                             
                                             
                                                U
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                L
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          ω
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                U
                                             
                                          
                                          −
                                          y
                                       
                                       
                                          
                                             
                                                y
                                             
                                             
                                                U
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                L
                                             
                                          
                                       
                                    
                                    
                                    or
                                    
                                    
                                       
                                          ω
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          x
                                          −
                                          
                                             
                                                x
                                             
                                             
                                                L
                                                e
                                                f
                                                t
                                             
                                          
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                R
                                                i
                                                g
                                                h
                                                t
                                             
                                          
                                          −
                                          
                                             
                                                x
                                             
                                             
                                                L
                                                e
                                                f
                                                t
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          ω
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                R
                                                i
                                                g
                                                h
                                                t
                                             
                                          
                                          −
                                          x
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                R
                                                i
                                                g
                                                h
                                                t
                                             
                                          
                                          −
                                          
                                             
                                                x
                                             
                                             
                                                L
                                                e
                                                f
                                                t
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 y
                              
                              
                                 U
                              
                           
                        , 
                           
                              
                                 y
                              
                              
                                 L
                              
                           
                        , 
                           
                              
                                 x
                              
                              
                                 R
                                 i
                                 g
                                 h
                                 t
                              
                           
                        , 
                           
                              
                                 x
                              
                              
                                 L
                                 e
                                 f
                                 t
                              
                           
                         denote the upper edge, lower edge, right edge, and left edge of overlapping region of the two images separately (see 
                        Fig. 4). Consequently, the seamless stitched image can be obtained.

The study was approved by the IRB of Xiangya hospital. All patients provided written informed consent. The 80 X-ray images studied in this paper were obtained from 40 patients with scoliosis in Xiangya Hospital of Central South University. The experimental databases contain spine and lower limb X-ray images. The image acquisition equipment is SIEMENS Aristos FX DR, with the image size of 2400×2400 to 3000×3000 pixels, spatial resolution is 3.5lp/mm, and each pixel size is 147 μm. The overlapping region to be stitched occupies about 16–32% of the images. The proposed method is running on a computer with an Intel Core 2 DUO 2GHz CPU and 2GB RAM. Matlab 2010 is taken in to implement the stitching algorithm. In this section, we use four pairs of standard images which include spine and lower limb X-ray images (see 
                     Fig. 5) to exhibit the stitching algorithm.

The stitching system reduces the size of input image with sampling factor K. The system used phase correlation algorithm twice to acquire the overlapping region. The position of the first peak value and the second peak value was illustrated in 
                     Fig. 6. According to the two peak values, we could settle the overlapping region for the blending procedure. Taken these four pairs of images as example, the CC is 0.93, 0.95, 0.98, and 0.87 individually, which is much higher than the threshold value (CC=0.85). The stitching result of the eight images is illuminated in 
                     Fig. 7.


                     
                     Fig. 8 illuminates a pair of stitching results from both our proposed method and clinical stitching software. No obvious blending seams exist in the stitched images (Fig. 8 on the left) which are blended by weighted blending algorithm. However, slight difference would be noticeable when we magnify the images. The right image in Fig. 8 is the stitching result of the clinical stitching software that was provided by SIEMENS DR Workstation. The magnified parts in Fig. 8 demonstrate that the accuracy of the method proposed in this study is relatively high compared with the result from the software.

Another pair of rotation test images is demonstrated in 
                     Fig. 9. We rotate one image from 0 to 90 degrees to test the system (see 
                     Fig. 10). 
                     Table 1 shows the rotation degree calculation by our algorithm. The result signifies that the proposed method can accommodate image rotation and the error is less than one degree.

@&#DISCUSSION@&#

The proposed method was evaluated by 40 pairs of images recorded from patients with scoliosis and the average stitching time is 1.9s. 
                     Table 2 shows the statistic results of stitching the 40 pairs of images from the technique put forward in this paper as well as the clinical software provided by SIEMENS DR Workstation, respectively.

The statistic results indicate that the proposed method has 90% accuracy when deviation distance in vertical direction is less than 4mm, which is much higher than that of the software. Two cases are failed in stitching by our method, one case is failed due to the significant exposure differences of the overlapping region. The other failure is due to the movement of patient due to which overlapping region could not be determined by phase correlation. In the remaining 38 cases, all images are stitched successfully by this proposed method. Nevertheless, some stitching errors are unavoidable because the overlapping region is almost impossible to be strictly the same due to patient’s breathing and the slight body movement. In order to eliminate the stitching error, patient should hold breath when DR system acquires the chest and abdomen image.

We also evaluated the capability of the proposed stitching method by comparing with other methods while employing our dataset. The method proposed by Samsudin et al. [11] was selected to compare with our method. The result is listed in 
                     Table 3. The results show that both methods are fully automated stitching and do not need any user inputs. The images are preprocessed by down-sampling to shorten the stitching time in our method. However, the method in [11] does not decrease the size of image and then the required time of image stitching is increased due to large image size. In order to compare these methods, the image involved in both methods is preprocessed by sampling factor K. According to Table 3, our method can tackle translation and rotation. If two images have rotation, the method in [11] cannot find the rotation degree. The average stitching time of our method is shorter than method [11], the accuracy of stitching is higher than their method. Our method can find the overlapping region when it is less than 30%, and even a 16% overlapping region can also be stitched successfully. The superior performance of our method could be indicated by its robustness to image translation and rotation when compared to other methods.

@&#CONCLUSIONS@&#

This paper proposes an automated image stitching technique with the ability of stitching full-spine and lower limb X-ray images. During the image registration stage, improved phase correlation algorithm is adopted to determine the best-matched position. Compared with previous methods, our proposed technology can tackle translation and rotation problems in the image. Even the reference image only has an overlapping region with the size of 16% to the original image, the proposed method can accomplish the stitching successfully. The average stitching time is decreased by down-sampling with sampling factor K. Those preprocessed methods would enhance the precision of peak value position of phase correlation algorithm. The results show that the proposed method has a high accuracy of 90% in image stitching while previous methods have an accuracy of 80% in comparison. According to the experimental results and performance evaluation, the proposed algorithm is simple, fast, and with high accuracy for full-spine and lower limb X-ray images. The best-matched position maybe acquired by using the algorithm once. Despite the success of the proposed method in stitching X-ray images, there may be some cases, such as the significant exposure differences, which would cause failure in detecting overlapping region. To overcome these difficulties, histogram matching or window function can be used before the phase correlation. In addition, the patient should hold breath during the image acquisition stage in order to achieve higher accuracy when the machine scans quickly.

None declared.

@&#ACKNOWLEDGMENTS@&#

This work is supported partly by the National Natural Science Foundation of China (Grant No. 81460206).

@&#REFERENCES@&#

