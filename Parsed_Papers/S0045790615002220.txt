@&#MAIN-TITLE@&#A cross-layer mobility support protocol for wireless sensor networks

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The L3 handover and the L2 handover can be performed simultaneously.


                        
                        
                           
                           A sensor node can directly achieve the L2 handover without scanning all channels.


                        
                        
                           
                           A sensor node neither needs a care-of address nor participates in the L3 handover.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

6LoWPAN

Wireless sensor network

Cross-layer

Mobility

Handover

@&#ABSTRACT@&#


               
               
                  This paper proposes a cross-layer mobility support scheme for the IPv6 over low-power wireless personal area network (6LoWPAN) wireless sensor network (WSN). This scheme combines the handover in the network layer (L3) with the handover in the link layer (L2) so that the L3 handover and the L2 one can be performed simultaneously. During the L3 handover process, a sensor node neither needs a care-of address nor participates in the handover process. During the L2 handover process, a node uses the channel information to directly achieve the L2 handover without scanning all channels. Finally, this paper analyzes and evaluates the performance of this protocol, and the data results show that this protocol improves the mobility handover performance.
               
            

@&#INTRODUCTION@&#

The IPv6 over low-power wireless personal area network (6LoWPAN) is made up of low-power nodes with limited resources, and one typical example is 6LoWPAN wireless sensor network (WSN) where sensor nodes sense some physical parameters. 6LoWPAN WSN has mobility, so it can obtain more extensive application space only if it provides mobility support.

The fact that a sensor node works as both a router and a host results in differences between the IPv6 network architecture and the 6LoWPAN WSN one, so current mobility standards [1,2] cannot efficiently work in 6LoWPAN WSN. This poses considerable obstacles to the 6LoWPAN applications. At present, some mobility handover solutions for 6LoWPAN WSN [3–12] are proposed, and they improve the mobility handover performance to various extents. However, these solutions only focus on either the L2 handover or L3 handover, and they do not effectively combine these two kinds of handovers to improve the total handover performance. Moreover, in these handover solutions the L2 handover and the L3 handover are two independent processes and are performed in serial. That is, the L3 handover is started after the L2 handover is complete, so the total handover delay is the sum of the L2 handover latency and the L3 one. As a result, the handover performance is degraded to some extent.

In order to improve the handover performance, this paper proposes a cross-layer mobility support protocol for 6LoWPAN WSN. Compared with these previous works, this protocol has the following contributions:
                        
                           (1)
                           This protocol proposes the 6LoWPAN WSN architecture. Based on this architecture, a distributed IPv6 addressing algorithm is presented. Through this algorithm, a node can acquire a unique address from its neighbor without duplicated address detection (DAD), and a routing backbone can be established. Via this routing backbone the routing can be achieved without route establishment.

Based on this architecture, a cross-layer mobility handover algorithm is proposed. This algorithm combines the L3 handover with the L2 handover so that the L3 handover and the L2 one can be performed simultaneously. As a result, the handover delay and packet loss are reduced.

In the L3 handover a node neither needs a care-of address (CoA) nor participates in the handover process, and in the L2 handover a node uses the channel information to directly achieve the L2 handover without scanning all channels, so the handover latency, cost and packet loss are lowered.

The following sections discuss this protocol in detail. In Section 2, the related work on the 6LoWPAN mobility support is discussed, and in Section 3 the 6LoWPAN architecture is presented. In Sections 4 and 5 the addressing algorithm and the handover algorithm are presented, respectively. In Section 6, the performance of this protocol is analyzed and evaluated, and in Section 7 the paper concludes with a summary.

@&#RELATED WORK@&#

Due to the differences between the IPv6 network architecture and the 6LoWPAN WSN one, the mobility support standards [1,2] cannot efficiently work in 6LoWPAN WSN. Therefore, the mobility support solutions for 6LoWPAN still remains an open issue and the further research is required [13].

In [3], a mobile media access control (MAC) protocol for IP-based WSN is proposed. In order to save the energy and maximize the network lifetime, this protocol uses complex a duty cycle strategy to achieve the handover. In [4] the performance of mobile IPv6 (MIPv6) in WSNs is assessed and the data show that MIPv6 complexity leads to long handover time and high cost. The authors propose a proxy-based mobility approach in order to relieve sensor nodes from handover tasks. In [5], a mobile node depends on its location information to achieve the handover. Since the handover is achieved in the link layer, the cost is reduced. In [6], the mobility handover is achieved in the link layer, so the mobility handover delay and cost are reduced. In [7], a location-based mobility support for 6LoWPAN is proposed and it focuses on the intra-6LoWPAN mobility handover. In this scheme, an address includes the location information, so the routes are established based on this information. As a result, the handover performance is also improved. However, these protocols [3–7] do not discuss the inter-network handover.

In order to achieve the inter-network handover, some handover schemes based on proxy MIPv6 (PMIPv6) are presented. In [8], a handover scheme based on is proposed. This scheme presents the network architecture and control message formats, and also evaluates the handover cost and energy consumption. The results show that this scheme reduces the energy consumption significantly. In [9], another mobility support scheme based on PMIPv6 is proposed. This scheme also aims at improving the L3 handover performance. In [10], a mobility handover protocol for 6LoWPAN based on PMIPv6 is proposed. This protocol uses router solicitation and router advertisement messages to achieve the L3 handover. Performance results show that this scheme improves the performance of the L3 handover.

In [11], each mobile node has a partner node which maintains the information on neighbor personal area network (PAN) coordinators. Based on this information, the partner node of a mobile node performs the handover pre-configuration operation for the node in order to shorten the handover delay. If a node moves relatively fast or its mobile angle suddenly changes, then the pre-configuration process may fail. In [12], a seamless mobility handover scheme for 6LoWPAN is proposed in order to improve the L3 handover performance. This scheme presents the L3 handover algorithm and discusses the communication process during the L3 handover. Finally, the performance of this scheme is evaluated.

From the above discussion, it can be seen that the existing handover solutions for 6LoWPAN WSN improve the mobility handover performance to various extents. However, these handover solutions only focus on either the L2 handover or L3 handover, and in these solutions the L2 handover and the L3 handover are two independent processes and are performed in serial. That is, the L3 handover is started after the L2 handover is complete. These solution do not effectively combine these two kinds of handovers to improve the total handover performance. As a result, the handover performance is degraded to some extent.

In order to improve the handover performance, this paper proposes a cross-layer mobility support protocol, and this protocol has the following novelties:
                           
                              (1)
                              This protocol combines the L3 handover with the L2 handover so that the L2 handover and the L3 one can be performed simultaneously.

In this protocol, a sensor node neither needs a care-of address nor participates in the L3 handover process. Moreover, a node can use the channel information to directly achieve the L2 handover without scanning all channels.

A sensor node can acquire a unique address from its neighbor without DAD. During the address configuration process, the routing backbone can be automatically established, and through the backbone the routing can be automatically achieved without route establishment.

The link protocol in 6LoWPAN is IEEE 802.15.4 [14] which defines two kinds of nodes: Full-function device (FFD) and reduced-function device (RFD).

In this protocol, a 6LoWPAN WSN is composed of multiple PANs, and each PAN is made up of a gateway, FFD sensor nodes and RFD sensor nodes. Among them, a gateway is an access router which connects a PAN to the IPv6 network, a(n) gateway/FFD is fixed with routing and forwarding function, and an RFD is mobile without routing or forwarding function. In a PAN, a gateway and all the FFDs construct a routing backbone which is organized into a tree called a PAN tree. In a PAN tree, the sole gateway is a root. An RFD achieves the communications with the IPv6 Internet through the routing backbone. The FFD in the backbone which directly communicates with an RFD is called the RFD’s associate node. At the same time, an RFD has only one associate node. An RFD is uniquely identified by its home address, and during the mobility process its address remains unchanged. The 6LoWPAN architecture is shown in Fig. 1
                     .

Based on the 6LoWPAN architecture, the following address structure is proposed, as shown in Table 1
                        .

In Table 1, an address consists of two parts. The first part is the PAN ID which is a global routing prefix. In a PAN, the PAN IDs of both FFDs and RFDs which acquire their addresses in the PAN are identical, and the value is equal to the PAN ID of the gateway in the same PAN. The second part is the node ID which uniquely identifies a sensor node. The IPv6 address of a gateway is preset.

In Table 1, i is determined by the network size and the node density in the practical applications. Taking the generality into account, the protocol sets i to 16. In this way, one PAN can contain up to 216 nodes.

A(n) gateway/FFD/RFD periodically broadcasts a beacon within a one-hop scope [14]. The payload in a beacon broadcasted by a(n) gateway/FFD includes the working channel and the depth in the PAN tree. The payload in a beacon broadcasted by an RFD includes the working channel and the depth of the RFD’s associate node in the PAN tree. An FFD maintains a child table where one entry consists of two fields: the child value and the child state including Assigned and Unassigned. An FFD has up to K child nodes and each child corresponds to one entry where the child value k ranges from 1 to K. In this protocol, K is set to 8.

After FFD Y starts, it receives beacons from neighbor gateways/FFDs. Then, Y selects the gateway/FFD X with the minimum depth and requests an address from X according to the following process:
                           
                              (1)
                              Y sends X an Addr-Req message.

After X receives the Addr-Req, it selects the minimum child value k with the Unassigned state from the child table and sends Y an Addr-Res message where the payload is k. Then, X sets as the Assigned state the child state in the selected entry.

After Y receives the Addr-Res, it calculates the node ID according to formula (1) where x is X’s node ID and y is Y’s node ID. Then, Y combines the node ID with X’s PAN ID to form an address and marks X as its father node.
                                    
                                       (1)
                                       
                                          y
                                          =
                                          K
                                          ·
                                          x
                                          +
                                          k
                                       
                                    
                                 
                              

Y’s addressing process ends, as shown in Fig. 2
                                 .

In the above process, if Y detects that its node ID y is more than 2
                           i
                        
                        −1, then it reselects a(n) gateway/FFD to acquire an address. After all FFDs in a PAN acquire an address the routing backbone is also established.

The values of K and i are determined by practical applications. For example, in real-time patient monitoring applications, K and i may be set to 8 and 16, respectively. In this case, the maximum depth of a PAN tree is 5. If the transmission radius is 80m, then the diameter of a PAN approximates to 400m. This PAN may cover an area with 400m×400m and be deployed around a hospital. In some applications where a PAN is required to cover a large area, i may be set to 64. In this case, the maximum depth of a PAN tree may reach 20.

This addressing algorithm has the following improvements over the previous work [15]:
                           
                              (1)
                              This addressing algorithm is achieved in the distributed way and a node acquires an address from its neighbor. The addressing algorithm in [15] is performed in the centralized way and a node acquires an address from a ZigBee coordinator (ZC) which is multi-hop away.

In this scheme, after the addressing process is complete, a PAN tree is constructed and the routes in a PAN tree are also established without any extra operations. In [15], after the addressing process is complete, a route update process must be performed to establish a route from a ZC to a specific node.

In this scheme, if the root of a PAN tree has only a single child, then most of the addresses are unusable. In order to avoid this situation, all the FFDs should be evenly deployed around a PAN. Moreover, RFDs are mobile and may acquire addresses from a root. This also helps avoid this situation.

Through the above process, an FFD can acquire a globally unique address without DAD. If FFDs F1 and F2 are the child nodes of FFD F with node ID x and F assigns child value k1/k2 to F1/F2, then it can prove that F1’s address is different from F2’s one, as shown as follows: 
                           
                              
                                 ∀
                                 k
                                 1
                                 ,
                                 
                                 k
                                 2
                                 ,
                                 
                                 k
                                 1
                                 
                                 ≠
                                 
                                 k
                                 2
                                 ,
                                 
                                 1
                                 ⩽
                                 k
                                 1
                                 ⩽
                                 K
                                 ,
                                 
                                 1
                                 ⩽
                                 k
                                 2
                                 ⩽
                                 K
                              
                           
                        
                        
                           
                              
                                 ∵
                                 
                                 K
                                 ·
                                 x
                                 +
                                 k
                                 1
                                 -
                                 (
                                 K
                                 ·
                                 x
                                 +
                                 k
                                 2
                                 )
                                 =
                                 k
                                 1
                                 -
                                 k
                                 2
                                 
                                 ≠
                                 
                                 0
                              
                           
                        
                        
                           
                              
                                 ∴
                                 
                                 K
                                 ·
                                 x
                                 +
                                 k
                                 1
                                 
                                 ≠
                                 
                                 K
                                 ·
                                 x
                                 +
                                 k
                                 2
                              
                           
                        If FFD F1 is a child of FFD F with node ID x1, FFD F2 is a child of FFD F’ with node ID x2, F assigns child value k1 to F1 and F’ assigns child value k2 to F2, then it can prove that F1’s address is different from F2’s one, as shown as follows:
                           
                              
                                 ∀
                                 x
                                 1
                                 ,
                                 
                                 x
                                 2
                                 ,
                                 
                                 x
                                 1
                                 
                                 ≠
                                 
                                 x
                                 2
                                 ,
                                 
                                 k
                                 1
                                 ,
                                 
                                 k
                                 2
                                 ,
                                 
                                 1
                                 ⩽
                                 k
                                 1
                                 ⩽
                                 K
                                 ,
                                 
                                 1
                                 ⩽
                                 k
                                 2
                                 ⩽
                                 K
                              
                           
                        
                        
                           
                              
                                 ∵
                                 
                                 K
                                 ·
                                 x
                                 1
                                 +
                                 k
                                 1
                                 -
                                 (
                                 K
                                 ·
                                 x
                                 2
                                 +
                                 k
                                 2
                                 )
                                 =
                                 K
                                 ·
                                 (
                                 x
                                 1
                                 -
                                 x
                                 2
                                 )
                                 +
                                 k
                                 1
                                 -
                                 k
                                 2
                                 
                                 ≠
                                 
                                 0
                              
                           
                        
                        
                           
                              
                                 ∴
                                 
                                 K
                                 ·
                                 x
                                 1
                                 +
                                 k
                                 1
                                 
                                 ≠
                                 
                                 K
                                 ·
                                 x
                                 2
                                 +
                                 k
                                 2
                              
                           
                        
                     

After RFD Z starts, it receives beacons from neighbor gateways/FFDs. Then, Z selects the gateway/FFD Y with the minimum depth and requests an address from Y according to the following process:
                           
                              (1)
                              Z sends Y an Addr-Req.

After Y receives the Addr-Req from Z, it selects the minimum child value m with the Unassigned state from the child table and sends Z an Addr-Res where the payload is m. Then, Y sets to the Assigned state the child state in the selected entry.

After Z receives the Addr-Res, it acquires the node ID according to formula (1). Then, Z combines the node ID with Y’s PAN ID to construct an address and marks Y as its associate node.

Z’s addressing process ends, as shown in Fig. 2.

After Z acquires an associate node, it notifies the gateway in the same PAN of storing its associate relationship.

After an FFD acquires an address, it receives beacons from neighbor FFDs. In this way, an FFD can acquire the information on neighbor nodes’ working channels and relative positions [6].

In this protocol, an FFD uses the received signal strength indicator (RSSI) [16,17] and arrival of angle (AoA) [18,19] to determine the relative position of a neighbor. When an FFD receives a beacon from a neighbor, it uses RSSI to calculate the distance to the neighbor, and employs AoA to obtain the angle between itself and the neighbor. In this way, an FFD can determine the relative position of one neighbor [6]. Similarly, the associate node of an RFD can acquire the relative position of the RFD.

In this scheme, an RFD and its associate node are neighbors, so the associate node can periodically calculate the distance from the RFD by receiving beacons. If the associate node detects that the distance from the RFD is more than a threshold, then it can consider that the RFD is about to leave its communication range and selects as the RFD’s next associate node the neighbor FFD which is closest to the RFD. This threshold is determined by the communication stability and is usually set to 0.7r where r is the communication radius [6]. As shown in Fig. 3
                        , at the time T1, the associate node of RFD X is FFD Y, and the relative position between Y and X is (α1, d1). At the time T2, the relative position between Y and X is (α2, d2), and Y detects that X is about to leave its communication area, so it selects neighbor FFD Z as X’s next associate node.

It is assumed that the associate node of RFD X is FFD Y. When Y detects that X is about to leave its communication scope, it selects neighbor FFD Z as X’s next associate node. If both Y and Z are located in the same PAN where the gateway is G, then Y launches the following handover process:
                              
                                 (1)
                                 Y sends a Handover message to X and G, respectively. The payload in the Handover for G includes the addresses of both X and Z, and the one for X contains the information on Z’s working channel.

After G receives the Handover, it changes X’s associate node from Y to Z, and sends a Handover_Ack message to Y.

After X receives the Handover, it uses Z’s working channel to directly perform the L2 handover with Z and marks Z as its new associate node.

After Y receives the Handover-Ack, it forwards the data messages destined for X to Z which then forwards the messages to X, as shown in Fig. 4
                                    (a) and (b).

In this protocol, the data message format is shown in Table 2
                            where the mesh header is shown in Table 3
                           .

In Table 2, the MAC header includes the source link address field whose value is the link address of the node forwarding this data message and the destination link address field whose value is the link address of the next hop. In Table 3, O and F indicate the length of the destination node ID and the length of the final node ID, respectively. The value of the hop limit decreases by 1 with one hop.

In Fig. 4, it is assumed that RFD X is communicating with an IPv6 node, and X’s associate node changes from Y to Z. Then, the communication process is described as follows:
                              
                                 (1)
                                 At the time T1, the data message destined for X first reaches gateway G which identifies the PAN tree where Y is located.

G encapsulates the message with a MAC header and a mesh header where the destination node ID is Y’s node ID, and the final node ID is X’s node ID. Then, G routes the message to Y through the PAN tree.

After Y receives the data message, it forwards the message to X.

At the time T2, X’s associate node is Z. In the data message returned by X, the destination node ID in the mesh header is G’s node ID and the destination address in the MAC header is Z’s node ID. In this way, the data message reaches Z.

Z routes the data message to G through the PAN tree, and then G routes the data message to the destination IPv6 node in the IPv6 routing way.

It is assumed that the associate node of RFD X is FFD Y. When Y detects that X is about to leave its communication scope, it selects neighbor FFD Z as X’s next associate node. If Y is located in the PAN with gateway G1 and Z is located in the PAN with gateway G2, then Y launches the following handover process:
                              
                                 (1)
                                 Y sends a Handover to X and Z, respectively. The payload in the Handover for Z is X’s address, and the one for X is Z’s working channel.

After X receives the Handover, it uses Z’s working channel to directly perform the L2 handover with Z and marks Z as its new associate node.

After Z receives the Handover, it can determine that Y is located in the different PAN by checking Y’s address. Therefore, Z sends a Handover to G2 and the payload is X’s address.

After G2 receives the Handover, it establishes the relationship between X and Z, and then sends a Handover to the gateway HG of the PAN where X acquires its address.

After HG receives the Handover, it changes X’s associated gateway from G1 to G2, and returns a Handover-Ack to G2 which forwards the Handover-Ack to Z. Finally, Z forwards the Handover-Ack to Y.

After Y receives the Handover-Ack, it forwards the data messages destined for X to Z which then forwards the messages to X, as shown in Fig. 5
                                    (a) and (b).

In the normal handover, the L2 handover and the L3 handover are performed in serial. That is, the L3 handover is started after the L2 handover is complete. In this scheme, the L3 handover is performed before the L2 handover is performed. After RFD X enters the overlay area of current associate node Y and next associate node Z, Y notifies X of Z’s working channel and performs the L3 handover with gateway G. After X receives Z’s working channel, it immediately performs the L2 handover. Therefore, the L2 handover and the L3 handover are performed simultaneously, as shown in Figs. 4(b) and 5(b).

In this scheme, an RFD achieves communications with other nodes via its associate node instead of its CoA. That is, a correspondent node can communicate with an RFD as long as it knows the address of the current associate node of the RFD. In this scheme, a gateway maintains the associate relationship between an RFD and its associate node, and records the address of the current associate node of an RFD. After a gateway receives a data message destined for an RFD, it checks the RFD’s associate relationship to acquire the address of the RFD’s associate node, and routes this message to the associate node. Then, the associate node forwards this message to the RFD, and the communication between an RFD and a correspondent node is achieved. Therefore, an RFD does not need to be configured with a CoA. Moreover, in this scheme, it is an RFD’s current associate node instead of an RFD that performs the L3 handover. Therefore, an RFD does not participate in the L3 handover, as shown in Figs. 4(b) and 5(b).

In Fig. 5, it is assumed that RFD X is communicating with an IPv6 node, and the associate node of X changes from Y to Z. Then, the communication process is described as follows:
                              
                                 (1)
                                 At the time T1, the data message destined for X first reaches the gateway HG of the PAN where X acquires its home address.

Based on X’s associate gateway, HG routes the data message to the gateway G1 of the PAN where X is located.

G1 encapsulates the message with a MAC header and a mesh header where the destination node ID is Y’s node ID, and the final node ID is X’s node ID. Then, G1 routes the message to Y through the PAN tree.

After Y receives the data message, it forwards the message to X.

At the time T2, the associate node of X becomes Z, so in the data message returned by X the destination node ID in the mesh header is G2’s node ID and the destination address in the MAC header is Z’s node ID. In this way, the data message reaches Z.

Z routes the data message to G2 through the PAN tree, and then G2 routes the data message to the destination IPv6 node in the IPv6 routing way.

@&#PERFORMANCE EVALUATION@&#

@&#ANALYSIS@&#

Based on Fig. 4(b), the intra-PAN handover delay 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Intra
                                    
                                 
                              
                            is made up of the L3 handover delay 
                              
                                 
                                    
                                       T
                                    
                                    
                                       L
                                       3
                                       -
                                       Intra
                                    
                                 
                              
                            and the L2 one 
                              
                                 
                                    
                                       T
                                    
                                    
                                       L
                                       2
                                       -
                                       Intra
                                    
                                 
                              
                           . Since the L3 handover and the L2 one are performed simultaneously, 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Intra
                                    
                                 
                              
                            is shown in formula (2) where 
                              
                                 
                                    
                                       t
                                    
                                    
                                       Handover
                                    
                                 
                                 /
                                 
                                    
                                       t
                                    
                                    
                                       Handover
                                       -
                                       Ack
                                    
                                 
                              
                            is the delay of transmitting a Handover/Handover-Ack between neighbors, 
                              
                                 
                                    
                                       D
                                    
                                    
                                       FFD
                                       -
                                       GW
                                    
                                 
                              
                            is the distance between a gateway and an FFD in one PAN, and 
                              
                                 
                                    
                                       D
                                    
                                    
                                       FFD
                                       -
                                       RFD
                                    
                                 
                              
                            is the distance between an RFD and its associate node. In this scheme, the distance is measured by hop and the cost is measured in the number of messages.
                              
                                 (2)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      Intra
                                                   
                                                
                                                =
                                                Max
                                                (
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      3
                                                      -
                                                      Intra
                                                   
                                                
                                                ,
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      2
                                                      -
                                                      Intra
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                where
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      3
                                                      -
                                                      Intra
                                                   
                                                
                                                =
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      GW
                                                   
                                                
                                                +
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                      -
                                                      Ack
                                                   
                                                
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      GW
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      2
                                                      -
                                                      Intra
                                                   
                                                
                                                =
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      RFD
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Before neither the L3 handover nor the L2 one is complete, an RFD receives data messages from its original associate node. After both the L3 handover and the L2 one are complete, an RFD receives data messages from the next associate node. If the L3 handover ends but the L2 one is ongoing or vice versa, then the packet loss can be incurred. Therefore, the packet loss rate 
                              
                                 
                                    
                                       P
                                    
                                    
                                       Intra
                                    
                                 
                              
                            is shown in formula (3) where v is the average speed and r is the communication radius.
                              
                                 (3)
                                 
                                    
                                       
                                          P
                                       
                                       
                                          Intra
                                       
                                    
                                    =
                                    
                                       
                                          |
                                          
                                             
                                                T
                                             
                                             
                                                L
                                                3
                                                -
                                                Intra
                                             
                                          
                                          -
                                          
                                             
                                                T
                                             
                                             
                                                L
                                                2
                                                -
                                                Intra
                                             
                                          
                                          |
                                       
                                       
                                          r
                                          /
                                          v
                                       
                                    
                                 
                              
                           
                        

Based on Fig. 4(b), the intra-PAN handover cost 
                              
                                 
                                    
                                       C
                                    
                                    
                                       Intra
                                    
                                 
                              
                            is made up of the L3 handover cost 
                              
                                 
                                    
                                       C
                                    
                                    
                                       L
                                       3
                                       -
                                       Intra
                                    
                                 
                              
                            and the L2 one 
                              
                                 
                                    
                                       C
                                    
                                    
                                       L
                                       2
                                       -
                                       Intra
                                    
                                 
                              
                           , as shown in formula (4) where 
                              
                                 
                                    
                                       c
                                    
                                    
                                       Handover
                                    
                                 
                                 /
                                 
                                    
                                       c
                                    
                                    
                                       Handover
                                       -
                                       Ack
                                    
                                 
                              
                            is the cost of transmitting a Handover/Handover-Ack between neighbors.
                              
                                 (4)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      Intra
                                                   
                                                
                                                =
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      L
                                                      3
                                                      -
                                                      Intra
                                                   
                                                
                                                +
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      L
                                                      2
                                                      -
                                                      Intra
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                where
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      L
                                                      3
                                                      -
                                                      Intra
                                                   
                                                
                                                =
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      GW
                                                   
                                                
                                                +
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                      -
                                                      Ack
                                                   
                                                
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      GW
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      L
                                                      2
                                                      -
                                                      Intra
                                                   
                                                
                                                =
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      RFD
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Based on Fig. 5(b), the inter-PAN handover delay 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Inter
                                    
                                 
                              
                            is made up of the L3 handover delay 
                              
                                 
                                    
                                       T
                                    
                                    
                                       L
                                       3
                                       -
                                       Inter
                                    
                                 
                              
                            and the L2 one 
                              
                                 
                                    
                                       T
                                    
                                    
                                       L
                                       2
                                       -
                                       Inter
                                    
                                 
                              
                           . Since the L3 handover and the L2 one are performed simultaneously, 
                              
                                 
                                    
                                       T
                                    
                                    
                                       Inter
                                    
                                 
                              
                            is shown in formula (5) where 
                              
                                 
                                    
                                       D
                                    
                                    
                                       FFD
                                       -
                                       NFFD
                                    
                                 
                              
                            is the distance between an FFD and a neighbor FFD, and 
                              
                                 
                                    
                                       D
                                    
                                    
                                       GW
                                       -
                                       HGW
                                    
                                 
                              
                            is the distance between two gateways.
                              
                                 (5)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      Int
                                                      er
                                                   
                                                
                                                =
                                                Max
                                                (
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      3
                                                      -
                                                      Int
                                                      er
                                                   
                                                
                                                ,
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      2
                                                      -
                                                      Int
                                                      er
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                where
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      3
                                                      -
                                                      Int
                                                      er
                                                   
                                                
                                                =
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                +
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                      -
                                                      Ack
                                                   
                                                
                                                )
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      GW
                                                   
                                                
                                                +
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                +
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                      -
                                                      Ack
                                                   
                                                
                                                )
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      NFFD
                                                   
                                                
                                                +
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                +
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                      -
                                                      Ack
                                                   
                                                
                                                )
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      GW
                                                      -
                                                      HGW
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      2
                                                      -
                                                      Int
                                                      er
                                                   
                                                
                                                =
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      L
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      RFD
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Before neither the L3 handover nor the L2 one is complete, an RFD receives data messages from its original associate node. After both the L3 handover and the L2 one are complete, an RFD receives data messages from the next associate node. If the L3 handover ends but the L2 one is ongoing or vice versa, then the packet loss happens. Therefore, the packet loss rate 
                              
                                 
                                    
                                       P
                                    
                                    
                                       Inter
                                    
                                 
                              
                            is shown in formula (6).
                              
                                 (6)
                                 
                                    
                                       
                                          P
                                       
                                       
                                          Inter
                                       
                                    
                                    =
                                    
                                       
                                          |
                                          
                                             
                                                T
                                             
                                             
                                                L
                                                3
                                                -
                                                Inter
                                             
                                          
                                          -
                                          
                                             
                                                T
                                             
                                             
                                                L
                                                2
                                                -
                                                Inter
                                             
                                          
                                          |
                                       
                                       
                                          r
                                          /
                                          v
                                       
                                    
                                 
                              
                           Based on Fig. 5(b), the inter-PAN handover cost 
                              
                                 
                                    
                                       C
                                    
                                    
                                       Inter
                                    
                                 
                              
                            is made up of the L3 handover cost 
                              
                                 
                                    
                                       C
                                    
                                    
                                       L
                                       3
                                       -
                                       Inter
                                    
                                 
                              
                            and the L2 one 
                              
                                 
                                    
                                       C
                                    
                                    
                                       L
                                       2
                                       -
                                       Inter
                                    
                                 
                              
                           , as shown in formula (7).
                              
                                 (7)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      Inter
                                                   
                                                
                                                =
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      L
                                                      3
                                                      -
                                                      Inter
                                                   
                                                
                                                +
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      L
                                                      2
                                                      -
                                                      Inter
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                where
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      L
                                                      3
                                                      -
                                                      Inter
                                                   
                                                
                                                =
                                                (
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                +
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                      -
                                                      Ack
                                                   
                                                
                                                )
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      GW
                                                   
                                                
                                                +
                                                (
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                +
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                      -
                                                      Ack
                                                   
                                                
                                                )
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      NFFD
                                                   
                                                
                                                +
                                                (
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                +
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                      -
                                                      Ack
                                                   
                                                
                                                )
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      GW
                                                      -
                                                      HGW
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      L
                                                      2
                                                      -
                                                      Inter
                                                   
                                                
                                                =
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      Handover
                                                   
                                                
                                                ·
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      FFD
                                                      -
                                                      RFD
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        


                        NS-2 is used to evaluate the performance of this scheme, and based on IEEE 802.15.4 [14] the parameters are shown in Table 4
                        . The L2 protocol in 6LoWPAN WSN is IEEE 802.15.4, so in the simulation the L2 protocol is IEEE 802.15.4. The random waypoint model is commonly used in the simulation of ad hoc networks [20] and it allows a node to move in a random direction and angle. The mobility models such as freeway or Manhattan are usually used for vehicular networks [21], so we choose the random waypoint model to evaluate this scheme. In order to satisfy the requirements in most applications, the speed ranges from 10m/s to 30m/s. Based on [22], the maximum transmission radius is set to 100m.

When r is 60m, the handover delay, packet loss rate and handover cost based on speed are shown in Figs. 6–8
                        
                        
                        .

With the increase in speed, the frequency of an RFD performing the intra-PAN/inter-PAN mobility handover increases and the link stability weakens, so both the network traffic and the packet loss rate grow, as shown in Fig. 7. Since the retransmission of the lost packets incurs the extra delay and cost, there is a slight increment in the delay and cost, as shown in Figs. 6 and 8. From Figs. 6–8, it can be seen that the intra-PAN handover delay, packet loss rate and handover cost are lower than the inter-PAN ones.

In general, the analysis is used to analyze the performance of a scheme in an ideal situation while the simulation is used to evaluate the performance in a relatively complex case. We compare the simulation with the analysis due to the following reasons:
                           
                              (1)
                              Through the comparison, we can determine if the simulation results basically verify the analysis.

Comparison can be used to measure the differences between the analysis in an ideal situation and the simulation in a complex case.

The analysis analyzes the performance of this scheme in an ideal situation, and it does not take into account the situations such as the packet loss caused by the link instability and the delay and cost caused by the retransmission of lost packets. By contrast, the simulation considers these situations, so the simulation results are usually more than the analysis results.

In order to evaluate the performance of this scheme, we compare our scheme with existing handover schemes for 6LoWPAN WSN [10,12], as shown from Figs. 9–11
                        
                        
                        . These two schemes are selected to compare with this scheme due to the following reasons:
                           
                              (1)
                              These two schemes achieve the mobility support for 6LoWPAN WSN.

These two schemes are relatively new.

The handover delay, packet loss rate and handover cost comparison based on speed are shown in Figs. 9–11.

When the speed increases, the network stability weakens and the handover frequency grows. Therefore, the network traffic grows and the network performance degrades, so the packet loss rates in these three schemes increase, as shown in Fig. 10. Due to the extra delay and cost caused by the retransmission of the lost packets, the handover delay and cost grow, as shown in Figs. 9 and 11. In this scheme, when the speed increases, the inter-PAN handover frequency grows. Since the inter-PAN handover cost, delay and packet loss rate are more than the intra-PAN ones, the average handover delay, cost and packet loss rate grow with the increase in the speed.

From Figs. 9–11, it can be seen that the proposed scheme has better performance than the existing schemes. The reasons are analyzed as follows:
                           
                              (1)
                              In this scheme, the L3 handover and the L2 one are performed simultaneously, and during the L3 handover a mobile node neither needs a CoA nor participates in the handover process. In the existing schemes, the L3 handover and the L2 one are performed in serial, and a mobile node needs to participate in the handover process.

In this scheme, during the L2 handover, a node uses the channel information to directly achieve the L2 handover without scanning all channels. In the existing schemes, a node has to scan all channels to achieve the L2 handover.

In this scheme, the routing is automatically achieved via PAN trees without route establishment. In the existing schemes, the route establishment is a part of the mobility handover process.

@&#CONCLUSION@&#

In this paper, we have looked into the existing mobility handover solutions for 6LoWPAN WSN. These solutions improve the mobility handover performance for 6LoWPAN WSN to various extents, but they only focus on either the L2 handover or L3 handover, and they do not effectively combine these two kinds of handovers to improve the total handover performance. Moreover, in these handover solutions the L2 handover and the L3 handover are two independent processes and are performed in serial. That is, the L3 handover is started after the L2 handover is complete, so the total handover delay is the sum of the L2 handover latency and the L3 one. As a result, the handover performance is degraded to some extent. Based on this observation, we are motivated to combine the L3 handover with the L2 handover so that the L2 handover and the L3 one can be performed simultaneously.

In the proposed protocol, the L3 handover is performed before the L2 handover is performed. During the L3 handover process, a sensor node can get the channel information and then it can use this channel information to directly achieve the L2 handover without scanning all channels. In this way, the L2 handover and the L3 handover can be performed in parallel. Moreover, in the L3 handover a sensor node neither needs a CoA nor participates in the handover process, so the handover latency, handover cost and packet loss are reduced.

Finally, the performance parameters of this protocol including the handover latency, handover cost and packet loss rate are analyzed and evaluated, and the data results justify the advantages of this protocol.

@&#ACKNOWLEDGEMENTS@&#

This work is supported by Jiangsu Nature Science Foundation (BK20141230) and National Natural Science Foundation of China (61202440).

@&#REFERENCES@&#

