@&#MAIN-TITLE@&#A personalized ellipsoid modeling method and matching error analysis for the artificial femoral head design

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We can obtain a more accurate personalized model of the femoral head prosthesis.


                        
                        
                           
                           The model can well match with the acetabulum.


                        
                        
                           
                           Static and dynamic matching error analyses can be implemented in our system.


                        
                        
                           
                           We can obtain a practical means for personalized modeling before manufacture.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Femoral head

Personalized modeling

Artificial prosthesis

Avascular necrosis

@&#ABSTRACT@&#


               
               
                  For curing the worldwide disease — avascular necrosis of femoral head, the matching quality between the femoral head prosthesis and the acetabulum plays an important role in the operative treatment of the artificial femoral head replacement. In order to obtain a more accurate model of the femoral head prosthesis for the specified patient, a new personalized modeling system is presented in this paper. It is different from our previous system based on the sphere fitting method. This new system can reconstruct a more accurate ellipsoid model of the femoral head for the specified patient. It can recover the necrotic femoral heads into the satisfactory models. These models can well match with the acetabulum. Also, the static and dynamic matching error analyses for the reconstructed models can be implemented in this system. This new system can give a theoretical model for the accurate operation locating in the treatment of artificial femoral head replacement. And this system also provides an innovative practical means for the personalized modeling of the artificial femoral head before the prosthesis manufacture procedure.
               
            

@&#INTRODUCTION@&#

In medicine, surgery and biomechanics, there is an increasing demand for computer aided instruments in order to assist doctors, technicians and engineers and to optimize clinical treatments and prosthetic devices. Therefore, new designing technologies and advanced CAD/CAM tools are essential today in that industry. Also, due to the growing number of surgical operations and the improvement of quality standards, surgeons and prosthesis designers are seeking tools that can support them in optimizing their activities, improving rehabilitative techniques and reducing the risk for patients. ‘Personalized’ and ‘precisionize’ are the development directions of modern medicine, especially for orthopedics. And ‘personalized’ is also the direct foundation and important guarantee of ‘precisionize’ in computer-assisted orthopedic surgery. Therefore, to meet the urgent requirements for the precise orthopedic surgery, we must utilize the patient’s own biological parameters, with the help of modern computer technology and modern manufacture technology, to produce the prosthesis which is matching with the patient’s bone structure.

There have been many methods of 3D image reconstruction developed for the clinical treatment. For example, Davide et al. deduced a set of expressions which can be useful for the understanding of upper limb mobility and reproduce their complex motion. The methodology is based on the observations of previous contributions, which have been rearranged in order to be suitable for a complete implementation in modern Computer Aided Design environments  [1]. Sergei described a framework for the modeling of sweep solids on freeform surfaces, considering various geometric and functional constrains. The proposed approach was employed for semi-automatic computer aided design of ventilation tubes for customized hearing aid devices  [2]. Evila et al. presented an integrated tool for the design of a functional and innovative tracheal stent to meet the most critical requirements, based on physicians’, hospital administrators’ and patients’ experiences collected during the interviews and hospital visits  [3]. With the rapid development of 3D printing technology, the rapid prototyping based on reverse engineering can be achieved. Personalized prosthesis geometry reconstruction has become the current problems to be solved.

As a typical disease in the orthopedic treatment, avascular necrosis of femoral head (ANFH) is a worldwide disease. Reportedly, there are millions of new cases annually all over the world. At the present time, there are mainly three treatment methods for patients with different age and different status. They are femoral head resurfacing arthroplasty, femoral head replacement and total hip replacement. Femoral head resurfacing arthroplasty is the most conservative treatment, and femoral head replacement is more conservative than total hip replacement. However, each treatment method has a not long period of validity (about 3–15 years), so the treatment choice is generally suggested to consider the sufferer’s age. Most of the scholars believe that the artificial femoral head replacement and the artificial femoral head resurfacing arthroplasty are the best treatment for most of the young advanced cases. When the period of validity is exhausted, the sufferers can receive the total hip replacement. Thereby, among these treatments, artificial femoral head replacement is the most commonly used method for young advanced cases  [4,5]. All over the world, more than 600,000 artificial femoral head implants are replaced in human bodies every year. More than 100 kinds of commercially available artificial femoral head implants exist at present. Nevertheless, these available artificial femoral heads are manufactured on an assembly line  [6–9]. The number of implant’s size which can be chosen by the surgeon is too small to meet the patient’s need.

In fact, there is a significant individual difference in skeletal structure among different patients. The embedded artificial femoral head prostheses cannot match with the acetabulums well. As a result, a lot of patient’s thighbone cannot move freely. The replacement of artificial femoral head may modify the loading of bone, which might lead to direct overload or adverse remodeling of bone. What is more, artificial femoral head which does not match with the specified patient’s acetabulum will aggravate the stress shielding so that lifetime of the implant is reduced greatly [10–12]. Therefore, complications such as femoral neck fracture and implant loosening occurred constantly in the first few months post-operatively. In the end, the revision surgery which will cause tremendous physical pain and property loss may be the only method to relieve the patients’ pain and recover the basic function of hip joint. A great number of factors lead to the happening of post-operative complication, such as material property and geometrical property of the femoral head implant  [13–16]. Nowadays, there are many developments for the implant material, and it has achieved success in ensuring the stability of an implanted part. However, study on the geometrical property of artificial femoral head is still at the initial stage.

Personalization and precision are the directions of development for the modern medicine. Personalization is also the direct foundation and important guarantee of the precision for computer assisted orthopedic surgery. We must make use of the patient’s own biological parameters and draw support from modern computer technology and manufacturing technology to produce the prosthesis which well matches with the patient’s bone structure. Thereby, the physiological functions of the patient can be farthest recovered. For the computer field, in order to better provide computational support to the diagnosis and treatment of orthopedic surgery, how to develop new graphical methods and how to utilize computer’s characteristic of precision have become a common goal of the academia. Along with the development of modern manufacturing, especially the rapid development of 3D printing technology, the reverse engineering based rapid manufacturing has become possible. Meanwhile, the world-wide researches on biocompatible materials are also advancing towards maturity. Consequently, for the femoral head prosthesis design, the personalized geometric model constructing has become the urgent problem to be solved.

In recent studies, we developed a system to obtain the accurate ellipsoid femoral head model of a specified patient by reverse technology. Comparing with the previous system we developed based on sphere reconstruction, we can obtain higher precision and higher quality femoral head models by this improved system.

@&#RELATED WORKS@&#

The accurate geometric model reconstruction of femoral head is significant for an individual patient, and reconstructing the parameter-self-matched femoral head prosthesis model by using reverse technology becomes a research focus in the treatment for ANFH. However, there is not a relatively unified research strategy about implant modeling. Zheng et al. presented an integrated approach using a multi-resolution point distribution model (MR-PDM) to reconstruct a patient-specific surface model of the proximal femur from sparse input data, which may consist of sparse point data or a limited number of calibrated X-ray images. This method can facilitate the reconstruction of a patient-specific surface model of the proximal femur from sparse input data  [17]. Tomos et al. presented and evaluated, in two multi-center and multi-vendor studies, a new method for anatomically corresponded regional analysis of cartilage (ACRAC) that allows analysis of knee cartilage morphology in anatomically corresponding focal regions defined on the bone surface. This method permitted detection of tiny morphological change in cartilage thickness over six months in a small study, and may be useful for OA disease analysis and treatment monitoring  [18]. These studies also find that if the implant is not highly matched, the postoperative incidence of articular cartilage inflammation is very high. So it can be seen that the research of personalized implant modeling is very important.

In the researches of implant articular surface reconstruction, Brian et al. proposed an articular surface remodeling method of the hip after periacetabular osteotomy. In this method, preoperative and postoperative computed tomography (CT) scans were segmented as triangulated meshes. The bony articular surfaces of these meshes were then isolated. The vertices of these surfaces were fit to spheres and to general ellipsoids and, in the case of the acetabulum, examined in anatomical coordinate frames to look for changes between pre and postoperative segmentations  [19]. Seung et al. developed an anatomically deformable model of the femur to predict bone landmarks automatically and quantified its prediction accuracy. The anatomical deformation technique developed in this study predicted bone landmarks automatically as the surface of a deformable model was matched to the surface of a given femur model  [20]. In these studies it is also proved that hip articular surface has very distinct personalization features and implementing personalized modeling is imperative.

In other existing literatures about computer assisted therapy of ANFH, Koumpoyiannis et al. predicted the osteonecrosis of femoral head by examining the location and size of the lesion of femoral head. The results suggest that lesion volume is an important factor strongly correlated with the risk of collapse of femoral head. The location of the lesion of necrotic area is an important supplemental parameter in order to predict with accuracy the progression of the disease  [21]. Li et al. measured the human hip cartilage thickness and volume using magnetic resonance imaging (MRI) for the quantitative evaluation of the hip joint necrosis. The noninvasive system in this paper, which enables the quantification of cartilage thickness and volume in the human hip joint using MRI, is the first to discriminate the acetabular and femoral head cartilage throughout the entire hip without the use of an external device, and to implement hip registration for follow-up studies on the same subject  [22]. In the similar research works, Kim et al. put forward that model status of the depressed femoral head could be estimated by superimposing the outlines of femoral head in the slice image sequence  [23,24]. Bassounas et al. assessed the dent extent of the necrotic femoral head by utilizing volume rendering method  [25]. These studies indicate that the proposed methods can be reliable tools for the assessment of femoral head necrosis.

In other related papers about biomedical surface reconstruction, there are also many interesting methods were reported. For example, Chiang et al. discussed a new method for the progressive reconstruction of an endocardial surface during a heart mapping procedure. Compared to prior art, the new method can reconstruct a realistic surface from a set of sparse and random data. It can advantageously provide a smooth reconstruction at initial acquisition and ensure a geometrical consistency between consecutive reconstructions  [26]. Yoo presented an effective method for the 3D Bio-CAD model reconstruction of human bone from a scanned point cloud data or a sequence of CT image data based on a 
                        B
                     -spline interpolation scheme. This method can create the three dimensional shapes of human bones suitable for bone scaffold design, finite element analysis, and medical diagnosis  [27].

These methods above accelerated the development of the femoral head prosthesis research. However, they mostly made use of the probability statistical result from multi-case. We could only obtain the morbid state of the femoral head and we could not reconstruct the desired model of the femoral head by these methods. The obtained model had prodigious difference from the actual model of the target patient. Moreover, only some general parameters can be obtained, and the necrotic femoral head models were reconstructed based on these general parameters. So the surface models of the femoral head were not accurate enough. Meanwhile, most of the existing studies aimed to estimate the sphere model of the femoral head. However, it has been proved that the shape of femoral head is not an accurate sphere. The ellipsoid model can behave better than the sphere model in the femoral head physical motion  [6,28].

@&#OVERVIEW@&#

In our system, first of all, we reconstructed the 3D model of specified patient’s acetabulum by the sequential CT images. And then, we utilized a mesh processing method to segment the concave surface of acetabulum. At last, we reconstructed the ellipsoid model of the femoral head by using the mesh vertices in the concave surface of acetabular fossa. In addition, the static and dynamic matching error analyses can also be accomplished in this system. Fig. 1
                         gives a schematic description of the steps involved in the system. They will be fully described in the following sections.

The hip joint is composed by the femoral head and the acetabulum. As shown in Fig. 2
                        , it is a typical enarthrosis. The femoral head and the acetabulum are spherically jointed by the lunate surface  [29–32]. The main symptom for ANFH is the subsiding on the spherical surface of the femoral head. It induces an obstruction of the slip connection between the femoral head and the acetabulum. Consequently, the surgical purpose for ANFH is: recover the necrotic femoral head to be the spherical model state, and accordingly resume the normal joint movement between the femoral head and the acetabulum.

After collecting the sequential slice images of the hip joint utilizing the multi-slice helical CT (Manufacturer: SIEMENS, Pixel Spacing: 
                           0.6875
                           
                           
                              mm
                           
                           ∖
                           0.6875
                           
                           
                              mm
                           
                        , Slice Thickness: 1 mm), an accurate and automatic segmentation method is used to extract the acetabulum  [33] (as shown in Fig. 3
                        (a), (b)). The processing scheme consists of the following five steps: (1) preprocessing, including resampling 3D CT data by a modified 
                           
                              Sin
                           
                           
                           C
                         interpolation to create isotropic volume and to avoid Gibbs ringing, and smoothing the resulting images by a 3D Gaussian filter; (2) detecting bone tissues from CT images by conventional techniques including histogram-based thresholding and binary morphological operations; (3) estimating initial boundary of the femoral head and the joint space between the acetabulum and the femoral head by a new approach utilizing the constraints of the greater trochanter and the shapes of the femoral head; (4) enhancing the joint space by a Hessian filter; and (5) refining the rough boundary obtained in step (3) by a moving disk technique and the filtered images obtained in step (4).

After extracting the binary images of the acetabulum, Marching Cubes algorithm is utilized to reconstruct the 3D model of the acetabular bone. The acetabulum models with surface rendering and the mesh rendering are shown in Fig. 3(c), (d).

For collecting the coordinate vertices on the concave surface of acetabular fossa, 3D mesh segmentation on the acetabular bone model is needed. Mesh segmentation is an important research subject. At present, methods based on the curvature analysis are widely utilized. However, the discrete curvature computing of the mesh model is quite difficult in some situations. According to the constructional feature of the vertex normal vector mutation on the edge of the acetabular fossa articular facets, a method based on the vertex normal vector is utilized to segment the 3D acetabular fossa mesh model  [34,35]. An improved algorithm is used to calculate the vertex normal vector.

As Fig. 4
                         shows: 
                           N
                           
                              (
                              v
                              )
                           
                         is a neighborhood of vertex 
                           v
                        ; 
                           D
                           
                              (
                              v
                              )
                           
                         is the set of points joined with vertex 
                           v
                         in 
                           N
                           
                              (
                              v
                              )
                           
                        ; 
                           E
                           
                              (
                              v
                              )
                           
                         is the set of edges joined with vertex 
                           v
                         in 
                           N
                           
                              (
                              v
                              )
                           
                        ; 
                           T
                           
                              (
                              v
                              )
                           
                         is the set of triangular faces joined with vertex 
                           v
                         in 
                           N
                           
                              (
                              v
                              )
                           
                        ; 
                           D
                           
                              (
                              v
                              )
                           
                           =
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    j
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    n
                                 
                              
                              }
                           
                        ; 
                           E
                           
                              (
                              v
                              )
                           
                           =
                           
                              {
                              
                                 
                                    e
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    e
                                 
                                 
                                    j
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    e
                                 
                                 
                                    n
                                 
                              
                              }
                           
                        ; 
                           T
                           
                              (
                              v
                              )
                           
                           =
                           
                              {
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    T
                                 
                                 
                                    j
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    T
                                 
                                 
                                    n
                                 
                              
                              }
                           
                        .


                        
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                         is an internal angle in vertex 
                           v
                         of the 
                           i
                        th triangular face in 
                           T
                           
                              (
                              v
                              )
                           
                        ; 
                           
                              
                                 α
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 β
                              
                              
                                 i
                              
                           
                         respectively denote two internal angles of the two triangular faces abut on edge 
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                         in 
                           N
                           
                              (
                              v
                              )
                           
                        ; and these two internal angles face to edge 
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                        ; 
                           
                              
                                 n
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       i
                                    
                                 
                              
                           
                         is an unit normal vector of the triangular face 
                           
                              
                                 T
                              
                              
                                 i
                              
                           
                         in 
                           N
                           
                              (
                              v
                              )
                           
                        . 
                           
                              (1)
                              
                                 
                                    
                                       n
                                    
                                    
                                       
                                          
                                             T
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 ×
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    v
                                    )
                                 
                                 /
                                 
                                    ‖
                                    
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    ×
                                    
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                       −
                                       v
                                       )
                                    
                                    ‖
                                 
                                 .
                              
                           
                        
                     

In the conventional methods, the unit normal vector 
                           
                              
                                 n
                              
                              
                                 v
                              
                           
                         of vertex 
                           v
                         is equal to the average value of 
                           
                              
                                 n
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       i
                                    
                                 
                              
                           
                         in 
                           T
                           
                              (
                              v
                              )
                           
                        . In some cases, this is clearly unreasonable and unscientific. For example, some triangular face is very large and other triangular faces are very small. In our method, the unit normal vector 
                           
                              
                                 n
                              
                              
                                 v
                              
                           
                         of vertex 
                           v
                         is:
                           
                              
                                 (2)
                                 
                                    
                                       
                                          n
                                       
                                       
                                          v
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ∈
                                          T
                                          
                                             (
                                             v
                                             )
                                          
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          n
                                       
                                       
                                          
                                             
                                                T
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                    /
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ∈
                                          T
                                          
                                             (
                                             v
                                             )
                                          
                                       
                                    
                                    
                                       
                                          γ
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 (3)
                                 
                                    
                                       
                                          n
                                       
                                       
                                          v
                                       
                                    
                                    =
                                    
                                       
                                          n
                                       
                                       
                                          v
                                       
                                       
                                          ′
                                       
                                    
                                    /
                                    
                                       ‖
                                       
                                          
                                             n
                                          
                                          
                                             v
                                          
                                          
                                             ′
                                          
                                       
                                       ‖
                                    
                                 
                              
                           
                         where 
                           
                              
                                 A
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 n
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       i
                                    
                                 
                              
                           
                         and 
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                         respectively denote the area, the unit normal vector and the internal angle in vertex 
                           v
                         of the 
                           i
                        th triangular face in 
                           T
                           
                              (
                              v
                              )
                           
                        . The influencing factor of triangular face shape is added to the vertex normal vector in this new method.

Interactive region growing method is utilized in the mesh segmentation. As shown in Fig. 5
                        (a), a seed vertex is manually collected in the region of interest (concave surface of acetabular fossa). Angle difference between two vertex unit normal vectors is used as the segmentation standard:
                           
                              (4)
                              
                                 φ
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          v
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                                 =
                                 arccos
                                 
                                    (
                                    
                                       
                                          n
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

By the ordinary method based on normal vector (without the influencing factor of triangular face shape), the segmented mesh (with red color) of the articular surface is shown as Fig. 5(b). While, by the improved vertex normal vector algorithm (with the influencing factor of triangular face shape), the segmented mesh (with red color) of the articular surface is shown as Fig. 5(c). In Fig. 5(b), we can see that there are a lot of missed vertices on the segmented articular surface. However, the segmentation result of the improved vertex normal vector algorithm (with the influencing factor of triangular face shape) is satisfactory and the missed vertices are of marked reduction. The vertices of the segmented mesh will be used as the data points for fitting the femoral head model.

For a long time, the femoral head articular surface was simply cognized to be a sphere. For the prosthesis designing, the articular surface of the acetabulum was supposed to be a spheroidal concave and the shape of the femoral head prosthesis was supposed to be spherical. However, the related research indicated that the femoral head articular surface is not a standard sphere but an ellipsoid [6,28,36,37]. A method for personalized modeling of the femoral head is introduced in this paper. The femoral head ellipsoid model of the specified patient can be reconstructed by utilizing the 3D coordinate vertices on the concave surface of acetabular fossa.

Comparing with sphere fitting, the ellipsoid fitting is a multi-dimensional nonlinear optimization mathematics problem. Corresponding to sphere’s isotropy, the ellipsoid is anisotropic. Its fitting procedure relates to the center position, the length of three rotation axes and the azimuth. Fitting algebraic surface with scatter 3D points has been discussed widely and some excellent works have been accomplished. In theory, the conditions that ensure a quadratic surface to be an ellipsoid have been well investigated. So we can use the existing theories in the ellipsoid fitting process. Some ellipsoid fitting techniques involve a highly nonlinear optimization procedure which often stops at a local minimum and cannot guarantee to obtain an optimal solution. Thereby, the ellipsoid fitting method in this paper starts from the general equation of quadratic surface.

Generally, a quadratic surface can be defined as the locus of points, whose coordinates satisfy the most general equation in second degree with three variables, 
                           
                              (5)
                              
                                 a
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 b
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 c
                                 
                                    
                                       z
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 2
                                 f
                                 y
                                 x
                                 +
                                 2
                                 g
                                 x
                                 z
                                 +
                                 2
                                 h
                                 y
                                 z
                                 +
                                 2
                                 p
                                 x
                                 +
                                 2
                                 q
                                 y
                                 +
                                 2
                                 r
                                 z
                                 +
                                 d
                                 =
                                 0
                                 .
                              
                           
                        
                     

Suppose that 
                           I
                           ,
                           J
                        , and 
                           K
                         are defined, respectively as in Eqs. (6)–(8).
                           
                              
                                 (6)
                                 
                                    I
                                    =
                                    a
                                    +
                                    b
                                    +
                                    c
                                 
                              
                              
                                 (7)
                                 
                                    J
                                    =
                                    a
                                    b
                                    +
                                    b
                                    c
                                    +
                                    a
                                    c
                                    −
                                    
                                       
                                          f
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    
                                       
                                          g
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    h
                                 
                              
                              
                                 (8)
                                 
                                    K
                                    =
                                    
                                       |
                                       
                                          
                                             
                                                a
                                             
                                             
                                                h
                                             
                                             
                                                g
                                             
                                          
                                          
                                             
                                                h
                                             
                                             
                                                b
                                             
                                             
                                                f
                                             
                                          
                                          
                                             
                                                g
                                             
                                             
                                                f
                                             
                                             
                                                c
                                             
                                          
                                       
                                       |
                                    
                                    .
                                 
                              
                           
                        
                     

Thus we can make sure that a surface is an ellipsoid using the property shown in Eq. (9), 
                           
                              (9)
                              
                                 α
                                 J
                                 −
                                 
                                    
                                       I
                                    
                                    
                                       2
                                    
                                 
                                 >
                                 0
                              
                           
                         where 
                           3
                           ≤
                           α
                           ≤
                           4
                         is a sufficient condition to guarantee that a surface is an ellipsoid, however it is not a necessary condition  [38–40]. The types of ellipsoids that cannot be characterized by the above condition are either long-thin or oblate. Obviously, the femoral head should not be an ellipsoid like that, so 
                           4
                           J
                           −
                           
                              
                                 I
                              
                              
                                 2
                              
                           
                           >
                           0
                         is enough for this situation.

And then, we use the least squares fitting method based on algebraic distance with constraint 
                           4
                           J
                           −
                           
                              
                                 I
                              
                              
                                 2
                              
                           
                           >
                           0
                         to find the ellipsoid that match with acetabulum best.

For each vertex 
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         on the segmented concave surface of acetabular fossa, suppose 
                           
                              (10)
                              
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                i
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                z
                                             
                                             
                                                i
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          2
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                y
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          2
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          2
                                          
                                             
                                                y
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          2
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          2
                                          
                                             
                                                y
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          2
                                          
                                             
                                                z
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          1
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                        
                     

For the general equation (5), suppose that 
                           v
                         is defined, as in Eq. (11). 
                           
                              (11)
                              
                                 v
                                 =
                                 
                                    
                                       
                                          (
                                          a
                                          ,
                                          b
                                          ,
                                          c
                                          ,
                                          f
                                          ,
                                          g
                                          ,
                                          h
                                          ,
                                          p
                                          ,
                                          q
                                          ,
                                          r
                                          ,
                                          d
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                        
                     

The ellipsoid fitting problem can be expressed like 
                           
                              (12)
                              
                                 min
                                 
                                    
                                       
                                          ‖
                                          D
                                          v
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 
                                 subject to  
                                 k
                                 J
                                 −
                                 
                                    
                                       I
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 1
                              
                           
                         where 
                           
                              (13)
                              
                                 D
                                 =
                                 
                                    (
                                    
                                       
                                          X
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          3
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          n
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

Define 
                           
                              
                                 (14)
                                 
                                    
                                       
                                          C
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                −
                                                1
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                1
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                1
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                1
                                             
                                             
                                                −
                                                1
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                1
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                1
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                1
                                             
                                             
                                                −
                                                1
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                −
                                                k
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                −
                                                k
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                −
                                                k
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                              
                                 (15)
                                 
                                    C
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      6
                                                      ×
                                                      4
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      4
                                                      ×
                                                      6
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      4
                                                      ×
                                                      4
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

The problem can be converted to the following equations using the Lagrange multiplier method 
                           
                              (16)
                              
                                 
                                    {
                                    
                                       
                                          
                                             D
                                             
                                                
                                                   D
                                                
                                                
                                                   T
                                                
                                             
                                             v
                                             =
                                             λ
                                             C
                                             v
                                          
                                       
                                       
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   T
                                                
                                             
                                             C
                                             v
                                             =
                                             1
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Define 
                           
                              
                                 (17)
                                 
                                    D
                                    
                                       
                                          D
                                       
                                       
                                          T
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      11
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      12
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      12
                                                   
                                                   
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      22
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                              
                                 (18)
                                 
                                    v
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           
                         where 
                           
                              
                                 S
                              
                              
                                 11
                              
                           
                           ,
                           
                              
                                 S
                              
                              
                                 12
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 22
                              
                           
                         are the matrices of 6×6, 6×4 and 4×4, meanwhile 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                         are the vectors of 6 rows and 4 rows. We find that 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                         is the eigenvector associated with the largest eigenvalue of the eigensystem 
                           
                              (19)
                              
                                 
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          11
                                       
                                    
                                    −
                                    
                                       
                                          S
                                       
                                       
                                          12
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          22
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          12
                                       
                                       
                                          T
                                       
                                    
                                    )
                                 
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 λ
                                 
                                    
                                       C
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                                 .
                              
                           
                        
                     

And 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                         can be solved by 
                           
                              (20)
                              
                                 
                                    
                                       v
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 −
                                 
                                    
                                       S
                                    
                                    
                                       22
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       12
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                                 .
                              
                           
                        
                     

On this condition, we can obtain all the coefficients of Eq. (5). In other words, the general equation for the surface of the femoral head ellipsoid model has been obtained. However, if this ellipsoid needs to be shown in the computer virtual scene, the characteristic parameters of the ellipsoid are necessary. The characteristic parameters include the center position, the lengths of three rotation axes and the azimuth.

For Eq. (5), supposing 
                           X
                           =
                           
                              
                                 
                                    (
                                    x
                                    ,
                                    y
                                    ,
                                    z
                                    )
                                 
                              
                              
                                 T
                              
                           
                        , it can be written as 
                           
                              (21)
                              
                                 d
                                 +
                                 
                                    (
                                    2
                                    p
                                    ,
                                    2
                                    q
                                    ,
                                    2
                                    r
                                    )
                                 
                                 X
                                 +
                                 
                                    
                                       X
                                    
                                    
                                       T
                                    
                                 
                                 K
                                 X
                                 =
                                 0
                                 .
                              
                           
                        
                     

The eigenvalue of 
                           K
                         is 
                           
                              (
                              
                                 
                                    λ
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    3
                                 
                              
                              )
                           
                        , and the 3×3 eigenvector of 
                           K
                         is 
                           R
                        .

We can suppose 
                           
                              
                                 a
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 a
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 a
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 a
                              
                              
                                 3
                              
                           
                         are defined, as in Eqs. (22) and  (23).
                           
                              
                                 (22)
                                 
                                    
                                       (
                                       
                                          
                                             a
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             a
                                          
                                          
                                             3
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       (
                                       2
                                       p
                                       ,
                                       2
                                       q
                                       ,
                                       2
                                       r
                                       )
                                    
                                    R
                                 
                              
                              
                                 (23)
                                 
                                    
                                       
                                          a
                                       
                                       
                                          0
                                       
                                    
                                    =
                                    d
                                    −
                                    
                                       
                                          1
                                       
                                       
                                          4
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   3
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   3
                                                
                                             
                                          
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

Then, we can obtain the lengths of the three rotation axes 
                           
                              (24)
                              
                                 a
                                 =
                                 
                                    
                                       −
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                 b
                                 =
                                 
                                    
                                       −
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                 c
                                 =
                                 
                                    
                                       −
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   3
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

The center point of the ellipsoid is 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           =
                           
                              
                                 
                                    (
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                1
                                             
                                          
                                       
                                       
                                          2
                                          
                                             
                                                λ
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                2
                                             
                                          
                                       
                                       
                                          2
                                          
                                             
                                                λ
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                3
                                             
                                          
                                       
                                       
                                          2
                                          
                                             
                                                λ
                                             
                                             
                                                3
                                             
                                          
                                       
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                        , and the rotation matrix between the ellipsoidal coordinate system and the main coordinate system is 
                           
                              
                                 R
                              
                              
                                 T
                              
                           
                        .

For a better robustness of the system, validation on the accuracy of the femoral head ellipsoid fitting is necessary. And in the entire processing flow, a key step is elimination of the error vertices.

In our system, the average value of the distances between the acetabulum mesh vertices and its corresponding points on the fitted ellipsoid surface is used as a statistics to measure the precision of the fitted model. A smaller average value of the distances means that the fitted ellipsoid surface is closer to the acetabulum mesh vertices. That is to say, the fitted model has a better fitting precision.

As shown in Fig. 6
                        , we suppose that 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    0
                                 
                              
                              )
                           
                         is the symmetric center of the fitted surface (sphere or ellipsoid in this paper); 
                           
                              
                                 M
                              
                              
                                 i
                              
                           
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    m
                                    i
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    m
                                    i
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    m
                                    i
                                 
                              
                              )
                           
                         are the vertices to be fitted on the segmented acetabulum mesh; 
                           
                              
                                 N
                              
                              
                                 i
                              
                           
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    n
                                    i
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    n
                                    i
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    n
                                    i
                                 
                              
                              )
                           
                         are the corresponding points on the fitted surface (intersection points of line 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           −
                           
                              
                                 M
                              
                              
                                 i
                              
                           
                         and the fitted surface); 
                           
                              
                                 D
                              
                              
                                 i
                              
                           
                         are the distances between 
                           
                              
                                 M
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 N
                              
                              
                                 i
                              
                           
                        , namely:
                           
                              (25)
                              
                                 
                                    
                                       D
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      n
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      n
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      n
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

For the fitted sphere surface, we can suppose that parameter 
                           r
                         is the radius. And then 
                           
                              
                                 D
                              
                              
                                 i
                              
                           
                         can be expressed as the difference of the distances between 
                           
                              
                                 M
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                         with the radius 
                           r
                        : 
                           
                              (26)
                              
                                 
                                    
                                       D
                                    
                                    
                                       i
                                       S
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      0
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      0
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      0
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 −
                                 r
                                 .
                              
                           
                        
                     

However, for the fitted ellipsoid surface, it is more complicated. The parameter equation of line 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                           −
                           
                              
                                 M
                              
                              
                                 i
                              
                           
                         can be written as: 
                           
                              (27)
                              
                                 
                                    {
                                    
                                       
                                          
                                             x
                                             =
                                             
                                                
                                                   x
                                                
                                                
                                                   m
                                                   i
                                                
                                             
                                             +
                                             
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      0
                                                   
                                                
                                                )
                                             
                                             t
                                          
                                       
                                       
                                          
                                             y
                                             =
                                             
                                                
                                                   y
                                                
                                                
                                                   m
                                                   i
                                                
                                             
                                             +
                                             
                                                (
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      0
                                                   
                                                
                                                )
                                             
                                             t
                                          
                                       
                                       
                                          
                                             z
                                             =
                                             
                                                
                                                   z
                                                
                                                
                                                   m
                                                   i
                                                
                                             
                                             +
                                             
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                −
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      0
                                                   
                                                
                                                )
                                             
                                             t
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

After substituting Eq. (27) into Eq. (5), we can obtain a quadratic equation with one variable 
                           t
                        : 
                           
                              (28)
                              
                                 A
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 B
                                 t
                                 +
                                 C
                                 =
                                 0
                              
                           
                         where 
                           
                              
                                 
                                    A
                                    =
                                    a
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   m
                                                   i
                                                
                                             
                                             −
                                             
                                                
                                                   x
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    b
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   y
                                                
                                                
                                                   m
                                                   i
                                                
                                             
                                             −
                                             
                                                
                                                   y
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    c
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   z
                                                
                                                
                                                   m
                                                   i
                                                
                                             
                                             −
                                             
                                                
                                                   z
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    2
                                    h
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             m
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             x
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                    
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             m
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             y
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                    +
                                    2
                                    g
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             m
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             x
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                    
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             m
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             z
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                    +
                                    2
                                    f
                                    
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             m
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             z
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                    
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             m
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             z
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                 
                              
                              
                                 (29)
                                 
                                    B
                                    =
                                    2
                                    
                                       [
                                       
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          −
                                          
                                             
                                                x
                                             
                                             
                                                0
                                             
                                          
                                          )
                                       
                                       
                                          (
                                          a
                                          
                                             
                                                x
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          h
                                          
                                             
                                                y
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          g
                                          
                                             
                                                z
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          p
                                          )
                                       
                                       +
                                       
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                0
                                             
                                          
                                          )
                                       
                                       
                                          (
                                          h
                                          
                                             
                                                x
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          b
                                          
                                             
                                                y
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          f
                                          
                                             
                                                z
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          q
                                          )
                                       
                                       +
                                       
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          −
                                          
                                             
                                                z
                                             
                                             
                                                0
                                             
                                          
                                          )
                                       
                                       
                                          (
                                          g
                                          
                                             
                                                x
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          f
                                          
                                             
                                                y
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          c
                                          
                                             
                                                z
                                             
                                             
                                                m
                                                i
                                             
                                          
                                          +
                                          d
                                          )
                                       
                                       ]
                                    
                                 
                              
                              
                                 
                                    C
                                    =
                                    a
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          i
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    b
                                    
                                       
                                          y
                                       
                                       
                                          m
                                          i
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    c
                                    
                                       
                                          z
                                       
                                       
                                          m
                                          i
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    2
                                    f
                                    
                                       
                                          y
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    +
                                    2
                                    g
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    +
                                    2
                                    h
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    +
                                    2
                                    p
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    +
                                    2
                                    q
                                    
                                       
                                          y
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    +
                                    2
                                    r
                                    
                                       
                                          z
                                       
                                       
                                          m
                                          i
                                       
                                    
                                    +
                                    d
                                    .
                                 
                              
                           
                        
                     

After solving Eq. (28) and substituting parameter 
                           t
                         into Eq. (27), we can obtain the intersection points 
                           
                              
                                 N
                              
                              
                                 i
                              
                           
                        . Consequently, we can obtain the clearance distances 
                           
                              
                                 D
                              
                              
                                 i
                                 E
                              
                           
                         for the fitted ellipsoid surface by Eq. (25).

Calculate the fitting residual error (namely 
                           
                              
                                 D
                              
                              
                                 i
                                 E
                              
                           
                        ) of each vertex by traversing the fitting vertex set. The histogram of fitting residual error has a Gaussian distribution, so the vertices with significant error can be eliminated. The Laiyite criterion 
                           
                              (
                              3
                              σ
                              )
                           
                         can be adopted to eliminate the error vertices. Compute the standard deviation estimator 
                           s
                         according to the Bessel equation: 
                           
                              (30)
                              
                                 s
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                             
                                                2
                                             
                                          
                                          )
                                       
                                       /
                                       
                                          (
                                          n
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

If some vertex 
                           
                              
                                 M
                              
                              
                                 i
                              
                           
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    m
                                    i
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    m
                                    i
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    m
                                    i
                                 
                              
                              )
                           
                         satisfies 
                           
                              
                                 D
                              
                              
                                 i
                                 E
                              
                           
                           >
                           3
                           s
                        , it can be regarded as a gross error vertex or an abnormal data which should be eliminated.

Update the fitting vertex set and repeat the steps (fitting 
                           ∼
                         eliminating) circularly. When there is no gross error vertex, the elimination process ends. In the entire processing procedure, firstly the gross error vertices on the non-articular facet are eliminated, and then the little error vertices on the lunate surface are abandoned gradually. Finally, all the coordinate vertices in the set are regarded as effective data. The elimination procedure is shown as Fig. 7
                        .

In previous studies, we developed a system called DUTMedAssist  [41]. It was based on the sphere fitting method for the femoral head personalized modeling. DUTMedAssist was developed by Microsoft®  Visual C++ 6.0 (MFC) and OpenGL®. The basic function of DUTMedAssist includes: sequential DICOM images loading, hip joint segmenting, sphere femoral head reconstructing and so on. In recent studies, we developed this new special system based on the above method in this paper. This new system can reconstruct the personalized models (both sphere and ellipsoid) of the femoral head for a specified patient. The ellipsoid models after reconstructing are more accurate than the sphere models. We call this new system FemoAssist. It was developed based on Microsoft®  Visual C++ 6.0 and Kitware®  VTK (Visualization Toolkit). Be same to DUTMedAssist, FemoAssist also runs on Windows®  operating system. The system interface is shown as Fig. 8
                        . The left part of the interface is user operation panel, and the right part of the interface is 3D interactive displaying region. Besides the basic function of DUTMedAssist, user can crosscut on the 3D models, calculate the geometrical error and export the prosthetic models. The download link of the video demo (file size: 60.4 MB, file format: avi) for this system is “http://www.filefactory.com/file/1xdkk2poqidl/FemoAssist-with%20subtitles.avi ”.

Besides the good operability and practicability, the time efficiency of the system is also worthy of attention. Therefore, we measured the overall performance of the method in terms of CPU time on a standard PC (Intel Core 2 Duo T6600 2.2 GHz, 2G memory). Time consumption of each primary step in the system is shown in Table 1
                        .

@&#EXPERIMENTAL RESULTS@&#

First, CT images of two ANFH patients were used as the experimental data for personalized modeling: patient (1), 28-year-old, male, 1st period necrosis condition; patient (2), 59-year-old, male, 3rd period necrosis condition. Results after the prosthetic modeling are shown in Fig. 9
                        . Fig. 9(a) and (f) are the left-hand and right-hand femoral head 3D models of patient (1) and (2) when in ill condition; Fig. 9(b) and (g) are the left-hand and right-hand femoral head 3D models of patient (1) and (2) after the prosthetic modeling; Fig. 9(c) and (h) are the matching status of the personalized femoral head surface and the acetabulum; Fig. 9(d) and (i) are the matching status of the reconstructed femoral head and the acetabulum; Fig. 9(e) and (j) are the total hip 3D models of patient (1) and (2); For each patient, comparing the unrepaired femoral head model with the repaired femoral head model, it can be seen that the necrotic femoral heads are all recovered into the satisfactory models by our system.

Also, the femoral head image data of fifty ANFH cases in different ages (24–77 years old) were utilized as other experimental objects. Some of the models are shown in Fig. 10
                        . The three arrowheads on the femoral head models are three axes of the fitted ellipsoid.

For comparing the precision difference between the previous system DUTMedAssist (sphere fitting method) and the current system FemoAssist (ellipsoid fitting method), on the base of the above femoral head image data of fifty ANFH cases in different ages (24–77 years old), a statistical analysis of the matching error between the acetabulum model and the reconstructed femoral head model was implemented. According to Eq. (25), we use 
                           
                              (31)
                              
                                 
                                    
                                       D
                                    
                                    ¯
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          num
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          num
                                       
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       i
                                    
                                 
                                 
                                 
                                    (
                                    
                                       
                                          D
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          D
                                       
                                       
                                          i
                                          S
                                       
                                    
                                      or  
                                    
                                       
                                          D
                                       
                                       
                                          i
                                          E
                                       
                                    
                                    )
                                 
                              
                           
                         as the statistics to measure the precision of fitting method, where the parameter 
                           
                              num
                           
                         is the total count of the vertices to be fitted on the segmented acetabulum mesh. The error statistics is shown in Fig. 11
                        .

We can see that the matching error of DUTMedAssist is on downtrend with the age increasing and the matching error of FemoAssist is almost unchanged with the age increasing. So it is also proved that FemoAssist has a higher precision and can be better adapted to different age patients.

In order to further verify the progressiveness and adaptability of the proposed personalized modeling method in this paper, a dynamic matching error analysis and comparison of these two methods (sphere modeling method and ellipsoid modeling method) was implemented. As we know, recovering normal walking is the most critical clinical purpose of the artificial femoral head replacement. According to the motion characteristic of human hip joint, under normal circumstances when walking, the motion angle between the thighbone and the hipbone is in the range of −40°to 90° (here, normal standing status is the benchmark), as shown in Fig. 12
                        .

Among the multitudinous dynamic matching error analysis results, a typical severe ANFH case of 56 years old was selected to illustrate the progressiveness and adaptability under the dynamic walking status. Fig. 13
                        (a) and (b) respectively show the motion angle of these two methods (sphere modeling method and ellipsoid modeling method). Fig. 13(c) shows the dynamic matching error comparison between these two methods. From Fig. 13 (c) we can see that the matching error of sphere modeling method is constant along with the motion angle changing. It is because that the sphere model is isotropic and the matching errors are equal from different directions. From Fig. 13(c) we can also see that the matching error of ellipsoid modeling method is slightly changing along with the motion angle changing. When the motion angle 
                           −
                           5
                           °
                           ≤
                           α
                           ≤
                           5
                           °
                        , the matching error is almost the smallest. It is because that the ellipsoid model is anisotropic and the femoral head ellipsoid model is reconstructed under the normal standing status (
                           α
                           =
                           0
                           °
                        ). It is also proved that the personalized femoral head models reconstructed by our new system have a higher precision and can adapt to the normal walking status.

Our research goal of this paper is exploring a personalized femoral head geometric model reconstruction method. In our opinion, in the future, there may be a kind of special machine which can manufacture the femoral head prosthesis automatically. However, this kind of machine does not exist now. Therefore, as a simulation of this future manufacturing process, we utilized a 3D printer (manufacturer and model: Myriwell RL200A; printed material: ABS) to substitute this machine, as shown in Fig. 14
                        .

After the personalized femoral head reconstructing operations being implemented on this above typical severe ANFH case of 56 years old, we loaded the geometric models into the 3D printer. Then, plastic femoral head (and hip bone) were generated. The 3D printing results are shown in Fig. 15
                        . From the figures, it can be seen that the obtained plastic femoral head and hip bone were exactly of the right size and shape with the virtual 3D models.

Then, as shown in Fig. 16
                        , the primary geometrical sizes (external diameter of the femoral head and internal diameter of the acetabulum) were measured by a vernier caliper.

After that, the three pair of plastic hip joints were respectively implemented an articulated motion by hands. As shown in Fig. 17
                        , one hand holds the acetabulum and one hand writhes the femoral head like human motions.

For each pair of plastic hip joint, 2000 cycles of articulated motions were implemented. The attrited hip articular surfaces are as shown in Fig. 18
                        . Also, for these attrited hip joints, the primary geometrical sizes (external diameter of the femoral head and internal diameter of the acetabulum) were measured by a vernier caliper, as shown in Fig. 19
                        .

The primary geometrical sizes before and after manual articulated motion are shown in Table 2
                        . From the table, we can see that the wear rate of sphere femoral head is lower than that of original femoral head, and the wear rate of ellipsoid femoral head is lower than that of sphere femoral head. Therefore, by this 3D printing validation, it can be proved that the modeling method in this paper is reasonable and effective.

@&#CONCLUSIONS@&#

In this paper, a new system for reconstructing the femoral head model is developed. It can recover the necrotic femoral heads into the satisfactory models. These models can well match with the acetabulum. In this system, an accurate and automatic segmentation method is used to extract the acetabulum contours in the CT images of the specified patient. After reconstructing the acetabular bone model, a 3D mesh segmentation algorithm is utilized to acquire the mesh model of the facies articularis acetabularis. And then, the error data in the mesh vertex set are eliminated. At last, fit the ellipsoid model of the femoral head starting from the general equation of quadratic surface. For verifying the progressiveness and adaptability of the proposed modeling method, static and dynamic matching error analyses for the reconstructed models are implemented. The experimental results show that this system can well reconstruct the femoral head models of the specified patients. Comparing with our previous system, this new system can reconstruct more accurate models.

Introducing the coordinate parameter constraints of the femoral head greater trochanter and lesser trochanter in the fitting process will be a probing direction in the future. Because these coordinate parameters can reduce the computational cost for solving the initial iterative values of the ellipsoid center. Biomechanical analysis is another important work in our future research process. The obtained personalized femoral head prosthesis model can be compared with the ordinary femoral head prosthesis models in the mechanics analysis system (such as ANSYS).

@&#ACKNOWLEDGMENTS@&#

This work is supported by the National Natural Science Foundation of China (Grant Nos. 61300085, 61033012), the Scientific Research Fund of Liaoning Provincial Education Department of China (Grant No. L2013012) and the Fundamental Research Funds for the Central Universities (Grant No. DUT14QY18).

@&#REFERENCES@&#

