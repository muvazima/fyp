@&#MAIN-TITLE@&#
               Monaco—A domain-specific language solution for reactive process control programming with hierarchical components

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Domain-specific language for reactive systems with imperative programming notation.


                        
                        
                           
                           Hierarchical components for hierarchical abstraction of reactive control functions.


                        
                        
                           
                           Visual language presentation automatically generated from source code.


                        
                        
                           
                           Formal definition of the semantics in the form of labeled transition systems.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Domain-specific languages

Automation control

Reactive programming

Component-based systems

@&#ABSTRACT@&#


               
               
                  In this paper, we present Monaco – a domain-specific language for developing event-based, reactive process control programs – and its visual interactive programming environment. The main purpose of the language is to bring process control programming closer to domain experts. Important design goals have therefore been to keep the language concise and to allow programs to be written that reflect the perceptions of domain experts. Monaco is similar to Statecharts in its expressive power, but adopts an imperative notation. Moreover, Monaco uses a state-of-the-art component approach with interfaces and polymorphic implementations, and enforces strict hierarchical component architectures that support hierarchical abstraction of control functionality. We present the main design goals, the essential programming elements, the visual interactive programming environment, results from industrial case studies, and a formal definition of the semantics of the reactive behavior of Monaco programs in the form of labeled transition systems.
               
            

@&#INTRODUCTION@&#

The demand for languages and tools that support domain experts in implementing process control solutions is increasing [1–3]. In industrial automation, domain experts commonly extend and adapt their control solutions to fulfill the specific requirements at hand. They must intervene in safety-critical, highly dependable systems and are often expected to alter programs while the machine is in operation and to make these changes effective at run time using online-change capabilities. However, domain experts usually lack “deep” software engineering skills and expertise, requiring programming environments to provide extensive support, guidance, and supervision.

Domain-specific languages (DSLs) [4] are a proven approach to bringing programming closer to application domains. They aim to present software in the notations of domain experts and allow a straightforward mapping of application concepts to software solutions. Many domain-specific languages and modeling approaches have emerged in the automation domain [5–8]. For example, domain-specific modeling systems for specifying control behavior in the form of function block diagrams 
                     [8–10] have been very successful and can be considered state-of-the-art. Specifying reactive behavior, however, has proved to be more challenging. In this context, the Statecharts formalism [11,12], and its derivatives (e.g. [13,14]) are widely used for expressing complex reactive system behavior, but these modeling approaches target software engineering experts rather than domain experts.

Therefore, we have developed a new DSL called Monaco (Modular NOtation for Automation COntrol), the goal of which is to allow implementation of event-based, reactive process control programs in a concise and intuitive manner. The context of this work is a collaboration with Keba AG (www.keba.com), a medium-sized company developing and producing hardware and software platforms and solutions for industrial automation. In their practice, development of automation solutions is a multi-stage process involving various stakeholders at different stages of the automation process with varying levels of programming knowledge and capabilities:
                        
                           •
                           Keba develops and produces a hardware and software platform with associated tool support.

The hardware and software platforms enable Keba customers (mainly OEMs of manufacturing machines) to realize automation systems for their products. Employees of OEMs, however, are often domain experts with limited software engineering capabilities.

OEMs also build customizable software systems and electronic control panels for use by machine operators who act as end user programmers.

The Monaco language is specialized to a rather narrow subfield of the automation domain, that is, programming control sequence operations of manufacturing machines. This narrow domain includes all types of automated machines, but excludes bigger automation systems such as whole manufacturing plants. Within the numerous layers of automation systems Monaco is designed to address the layer of event-based control of machine operations between the lower-level continuous control and signal processing layer and the higher-level manufacturing execution layer.


                     Monaco has been designed to allow the programming of sequences of control operations, to enable parallel activities, and to provide strong support for dealing with exceptions. In its expressive power, Monaco is therefore similar to Statecharts, but adopts an imperative notation similar to other languages in the domain [15]. Most importantly, however, Monaco's distinguishing feature is its hierarchical component approach, which allows building automation solutions in an arrangement of upper and subordinate components. Thus, it supports abstraction of reactive control behavior in several hierarchical layers and building reusable components. Hierarchical abstraction of control tasks results in simplifications that bring control programs closer to the perceptions of domain experts.

This paper makes the following contributions:
                           
                              −
                              It introduces Monaco as a novel programming language with a state-of-the-art component approach for programming reactive control systems. We show that its expressive power is similar to that of Statecharts. Monaco, additionally combines reactive system programming elements with an imperative programming notation and approved language concepts from structured programming.

It shows that the Monaco language allows implementing control programs in a concise way. In particular, we show how the aligned language features of Monaco facilitate hierarchical abstraction of control functionality.

We show that Monaco's small set of language elements is both expressive and intuitive. In particular, we demonstrate that Monaco is capable of expressing complex reactive control functionality in a way that coincides closely with domain expert perceptions.

We show a simple visualization scheme and the interactive development environment for Monaco programs which makes Monaco control programs even more appealing to domain experts.

We give a formal definition of the semantics of the reactive behavior of Monaco programs in the form of labeled transition systems.

The Monaco language and its visual notation were first published in [16,17], respectively. This paper subsumes and extends this work by providing a detailed presentation of the language, giving a formal definition of the semantics of the language, and presenting results from implementation and case studies.

The outline of this paper is as follows: Section 2 discusses principal ideas for the design of the language. Section 3 introduces the main language elements of Monaco. Section 4 demonstrates how hierarchical control programs can be built using an example control program for an injection molding machine. In Section 5 the interactive visual programming environment is presented. In Section 6 we give a formal definition of the reactive behavior of Monaco programs. Section 7 discusses implementation and results from industrial case studies. Section 8 compares the approach to related work, and Section 9 concludes with a summary and an overview of follow-up work.

In discussions with domain experts at our industrial partners, we learned how they conceptualize automation machines. From these findings, we derived the following language design features:


                     Imperative notation: The main motivation for designing a new notation for event-based control systems instead of using, for example, the well-established Statecharts formalism was the observation that domain experts think in sequences of control tasks and their coordination rather than in states and state transitions. Further, we observed that in normal operation mode, that is, without considering abnormal or erroneous behavior, the basic control flow is often inherently sequential. Asynchronous behavior arises only in abnormal situations and exceptions. Our language therefore allows expressing normal behavior as a sequence of operations. In addition, it adopts proven concepts from imperative languages such as procedural abstraction, synchronous procedure calls, parameters, block structure, and static scoping.


                     Concise event handling: Automation control systems are characterized by asynchronous events and parallel activities. Therefore, we introduced statements which allow expressing event handling, parallelism and synchronization, exception handling, and timeouts in a concise way. However, asynchronous event handling occurs in separate handler code segments. This approach is similar to exception handling in state-of-the-art object-oriented programming languages, which avoids contaminating the code for normal behavior with exception handling code.


                     Component-based hierarchical control architectures: Domain experts perceive automation machines as an assembly of independent components working together in a coordinated fashion. Therefore, Monaco pursues a component-based approach in which software component structure resembles the structure of the machine to be controlled. Components are modular units (black boxes) which communicate exclusively via defined interfaces. Unlike many other component-based approaches in this domain, such as UML/RT [18] and IEC 61499 [19], Monaco enforces a strict hierarchical control architecture of subordinate and superordinate components in master–slave arrangements. A component relies only on the operations and state properties of its subordinate components. It composes and coordinates the behavior of its subordinates and provides abstract and simplified views to its superordinate component. Thus, the language supports hierarchical abstraction of control functionality. We argue that this (i) results in more precise and easier to comprehend control programs and (ii) reflects the perceptions of domain experts.

It should be noted that such a hierarchical architecture can also be realized by other component-based approaches (see [20] for an example in the IEC 61499 modeling language). However, Monaco provides special language constructs and thus enforces strict hierarchical component architectures.


                     Static configuration: The setup of Monaco programs (i.e., instantiating and assembling components and setting their parameters) is done in a separate configuration phase prior to program execution. Hence, the whole system is statically configured: all components, component parameters, and array sizes are defined. After the program has started, this configuration cannot change, which makes Monaco programs static. For example, although subcomponents of components are polymorphic, they are defined at setup time, and dynamic method binding is not required. This static nature of Monaco programs allows run-time-optimized code to be generated, which avoids memory dynamics at run time and guarantees real-time properties.


                     Visual programming notation: In addition to a text-based notation, there is a dual visual representation of Monaco programs, which is usually preferred by domain experts and end users. Unlike other visual programming approaches in the domain, for instance, Statecharts modeling tools, the visual representation is created automatically from, and is synchronized with, the source code, i.e., generated without user involvement.

We have designed Monaco as a component-based language with an imperative notation with a Pascal-like syntax and an event handling mechanism similar to that of Statecharts. Below, we first outline the component approach and then the reactive programming features of the language. We present the language elements using abstract code samples and compare them to UML and Statecharts.

As outlined above, Monaco enforces a strict hierarchical component architecture of superior components and subcomponents which communicate via defined interfaces. Therefore, the component approach of Monaco comprises component interface declarations, parameterizable component implementations with polymorphic subcomponent declarations, and a static configuration creating a tree of component and subcomponent instances.

Interface declarations (
                           Fig. 1) are used to define the static contract between components and their clients and thus have a similar purpose as interfaces in state-of-the-art object-oriented languages. However, interfaces in Monaco express the hierarchical communication architecture of control programs. On the one hand, an interface defines the externally visible operations a component provides to its user in the form of routine and action declarations. These represent the commands a superordinate caller will be able to invoke. On the other hand, an interface defines how a component will provide feedback about the fulfillment of its control tasks. To this end, it specifies functions for accessing run-time state properties of the component. In other words, the routines and actions define the command operations a component can perform, and the functions define the feedback the component will provide. Additionally, interfaces can define input variables which allow a component to receive dynamic properties as input.

Interfaces are implemented by components (
                           Fig. 2), which means that components must implement the inputs, routines, action, and functions defined in the interfaces. A component has parameters and internal state variables. A parameter is a run-time constant used to configure a component instance at setup time, while a variable is used to hold run-time state properties of a component.

Components usually rely on subcomponents in fulfilling their control tasks. A component therefore declares subcomponent variables which can hold references to subcomponent instances. Interface types are used in the subcomponent variable declarations. Hence, a subcomponent declaration defines the interfaces required for the subcomponents (Fig. 2). This means that subcomponents are polymorphic: any component implementing (providing) the required interface can be used. The actual subcomponent instance is plugged into the subcomponent slot at setup time (see below). Note that there are no access modifiers in Monaco. Only elements defined in the implemented interfaces of the component are externally visible.

Components implement functions, actions, and routines. A function implementation in a component is similar to functions in procedural programming languages such as Pascal. They return run-time state properties of components. In Monaco, functions have no side effects and must not contain blocking statements. Usually, functions are used to compute dynamic properties from lower-level properties of subcomponents, which they forward in a more abstract, concentrated form to the component above.

Actions and routines are used to implement control algorithms and therefore constitute the central programming elements of components. Whereas actions represent atomic procedures which cannot block, routine implementations implement longer-term control activities which usually have blocking calls (WAIT, see below). Routine implementations are discussed in detail in the next section.

Further, the component must define the inputs for the subcomponents. This is done in the BINDINGS section, where for every input variable of a subcomponent, the input value is defined by an expression. Typically, the expression will access function values from other subcomponents and possibly its own input values to define the value for the input variable of the subcomponent. So an input variable binding simply functions like a value definition which is evaluated whenever the variable is accessed. In this way, subcomponents can exchange property values.

Interfaces also can be implemented by so-called native components. Native components are the lowest level components in the component hierarchy and build the interface to the underlying hardware layer or lower-level control system. They are not implemented in Monaco but in the language of the run-time system, i.e., in C++ for our C++ run-time system.

Actions of native components form the output commands of a Monaco program and the functions form the input interface of a Monaco program. We therefore speak of
                              
                                 −
                                 
                                    external output actions for actions of native components


                                    external inputs for the functions of native components.

In order to create a complete Monaco program, Monaco components need to be instantiated and the component/subcomponent relations established (
                           Fig. 3). Furthermore, component parameters must be set (if the desired values differ from the defined default values). This static system configuration is established in a setup phase prior to program execution. First, components are instantiated by declaring variables in a VARS section, and then parameter values are set for the component instances. Finally, the component/subcomponent relation is established by plugging component instances into subcomponent slots. The language allows for arrays of components and loops for iterating over component arrays.

The component configuration cannot be changed while executing a Monaco program. Note that native components form the leaves of the component hierarchy.

Functions, actions, and routines are similar to procedures in imperative languages. They are called in the same way as methods in object-oriented languages. In particular, a function, action, or routine defined in the interface of a subcomponent is called by the subcomponent variable name and the function, action, or routine name plus actual parameter separated by a dot. They can have parameters and local variables, and have a body with a statement sequence. Approved language constructs from structured programming languages such as block structure, lexical scoping, loops, and conditional statements are provided (we do not discuss these common constructs further).

Aside from these common features, the differences between functions, actions, and routines are significant and important for defining the run-time properties of the language (see also Section 6).
                              
                                 −
                                 Functions compute run-time state properties of components which are returned by the functions as result values. They usually access internal state properties and values given by functions of subcomponents from which they compute more abstract values. Functions can use Boolean and arithmetic operations, and conditional statements and loops, but must not use blocking statements (see below). Additionally, functions must not have side effects.

Actions encode single commands to a component and are similar to procedures in imperative languages. They usually set variables and call other actions. Like functions, actions can use common statements and operations, and conditional statements and loops, but must not use blocking statements.

Unlike actions, routines can use blocking statements and therefore implement longer-lasting control activities. They use exclusively the reactive statements presented below.

For reactive programming, Monaco provides the following three language constructs: conditional wait statement, ON statement, and parallel execution statement.

The WAIT statement is provided to suspend execution of the current execution thread until a specified condition is satisfied. In contrast to many other reactive languages, which usually require an event object as trigger, any Boolean expression can be used. The equivalent of a WAIT in Statecharts is a state node with the condition as triggering event (
                           Fig. 4).

ON handlers are used to handle events which can occur asynchronously from normal, sequential program execution. ON handlers specify an arbitrary event condition and are attached to BEGIN/END blocks (
                           Fig. 5). Their role is that whenever the condition of the ON handler becomes true while program execution is within the BEGIN/END block, the block is left, and the statement sequence of the ON handler is executed. For ON handlers to be meaningful, the guarded BEGIN/END block must have blocking statements (i.e., WAIT statements) at which program execution is suspended and the event condition test can occur (program execution from one WAIT state to the next is atomic and cannot be interrupted; see Section 6 for details).

ON handlers in Monaco are similar to OR states and their transitions in Statecharts. Fig. 5 shows the relation. The OR state groups the states (e.g., the blocking WAIT statements) and transitions within the BEGIN/END block. The transition leaving the OR state is labeled with the condition of the ON handler. An arbitrary sequence of statements can follow. Since ON handlers have interruptive behavior, program execution continues with the first statement after the block.

The behavior of an ON handler is interruptive by default. However, the RESUME statement can be used to resume execution of the block after the handler code has been executed. It therefore uses the same semantics as the deep history node in Statecharts (
                           Fig. 6). Monaco has no statement equivalent of the normal history node.

The PARALLEL statement is used to create multiple concurrent execution threads. Each parallel execution thread consists of a statement or a statement block. As soon as all parallel execution threads have terminated, program execution continues after the PARALLEL statement.

The PARALLEL statement has the semantics of the AND state in Statecharts (see 
                           Fig. 7).

In this section, we demonstrate programming in Monaco with a sample application system. We show how the language constructs presented in Section 3 are used to realize the component-based control program. First, we briefly describe the physical process of injection molding, then we demonstrate decomposition of the system into a hierarchy of components, and finally we show hierarchical abstraction of control functionality by components at different hierarchy levels.

We have developed several example applications in Monaco for concept validation. One example is a reimplementation of an existing control program for an injection molding machine, originally implemented in the IEC 61131-3 [15] standard languages. We realized the event-based part of the application in Monaco and coupled it with a simulator for testing purposes. Special emphasis was put on handling errors and malfunctions of the machine, and we showed that the Monaco language is capable of describing machine failure handling in a compact and concise way.

Injection molding machines are used to produce plastic parts by injecting heated, semifluid plastic into a mold where the plastic cools down and hardens within a short period. Producing plastic parts with various notches and holes requires an adaptable mold that inserts so-called cores into the molding chamber during the injection process. After the plastic part has hardened, the cores are removed, the part is ejected, and the process is repeated. During the cooling phase, new raw material (plastic pellets) is heated up for the next injection phase.


                        
                        Fig. 8 shows the structure of the sample molding machine with two main components: (i) the mold subsystem with the clamp, the ejector, and a core puller and (ii) the nozzle subsystem that is mounted on a sledge with the material funnel, the heating system, and the screw for injection. As the name implies, the ejector ejects the finished parts from the mold. Below we show code fragments of a simplified version of the example control program.

The component hierarchy of the control program resembles the structure of the real machine (
                        Fig. 9). Hence, there is a direct mapping from the problem structure to the solution structure. At the top, the Machine component is responsible for encoding the overall control cycles. It knows various operation modes, such as fully automatic or half-automatic. It relies on and coordinates several subcomponents corresponding to the machine subsystems. The components for nozzle and mold are further decomposed according to the parts of the subsystems. At the bottom of the hierarchy are components for interfacing with hardware or lower-level control layers. These are implemented in the native language of the lower layers; in this example program, Java components form the interface to the simulator.

Components at different hierarchy levels typically serve different purposes:
                           
                              −
                              Components at the bottom are used for interfacing with the hardware or lower control layers. They usually set and read basic system variables. This layer is often referred to as hardware integration layer.

Components at the first level compose these primitive operations into elementary control routines and supervise their execution.

Higher up in the hierarchy are several coordination components which coordinate and supervise the operations of several subcomponents.

In the example program, the components forming the leaves of the component hierarchy are native Java classes building the interface to a simulator which simulates the real machine and the continuous control layer. The native components, however, implement a Monaco interface for the superior components (with direct mapping of actions and functions to C functions which implement the interface to the lower-level control layer). The following code snippet shows the interface definition for the core puller component ICore. The interface defines elementary actions to set system variables, to start and stop insertion, and to remove the core, and a function that reports the current position of the core puller.
                           
                              
                                 
                                 
                                    
                                       
                                          INTERFACE ICore
                                    
                                    
                                       
                                          
                                          
                                          FUNCTION position(): REAL;
                                    
                                    
                                       
                                          
                                          
                                          ACTION startInsert();
                                    
                                    
                                       
                                          
                                          
                                          ACTION stopInsert();
                                    
                                    
                                       
                                          
                                          
                                          ACTION startRemove();
                                    
                                    
                                       
                                          
                                          
                                          ACTION stopRemove();
                                    
                                    
                                       
                                          END ICore
                                    
                                 
                              
                           
                        
                     

The components residing in the hierarchy level directly above the native components use these interfaces to compose elementary operations into basic control routines. For example, the CoreCtrl component has the native component as its single subcomponent. It defines two routines to insert and remove the core. Additionally, a stop action which immediately stops all movements is provided.

The following code snippet shows part of the CoreCtrl component. In addition to showing declaration of parameters, subcomponents, and variables, it also demonstrates how functions are used to abstract state properties from lower-level information of its subcomponents (see function isInserted).
                              
                           
                        

Routines implement the basic control tasks. However, in addition to defining the basic sequence of actions, routines also check for correct execution of control activities and correct reactions from the subordinate. This can be accomplished with ON handlers.

The following code snippet demonstrates this approach with the insert routine. First, action startInsert is called from its subcomponent core, which sets a hardware signal and starts the insertion process. Next, a reaction from the isRemoved signal is expected. If this sensor does not return FALSE within a given (brief) time period, a fault in the insertion process or a faulty sensor is assumed, the process is stopped, and an error flag is set. It then waits for the isInserted signal to become true, and then stops the insertion process. Again the process is supervised by two ON handlers: one checks that the isRemoved signal does not switch to true again (which might result from a faulty sensor), and the other checks that the reaction of the isInserted signal occurs in time. In both error cases, the process is stopped and the error is signaled. Additionally, a call from outside to the stop() action sets a stop flag, and the process routine stops all movements and terminates.
                              
                           
                        

The control behavior defined so far is provided in a more abstract way in an interface declaration to the superior component. The following code snippet shows the interface ICoreCtrl of the CoreCtrl component. There are routines for inserting and removing the core, an action to stop a process, and two Boolean functions that report whether the core is inserted or removed. Additionally, the isInError function appears in the interface, which means that the superior component is able to check for the errors occurring during execution of the control routines.
                              
                           
                        

The next higher-level component we discuss is the MoldCtrl component. It coordinates the operations of the coreCtrl and the clampCtrl subcomponents. Additionally, it uses the pressure input variable to receive a pressure value from the sibling PressureCtrl component. The close routine illustrates how the component coordinates the activities of its subcomponents. The task of the routine is to control the processes of closing the clamp and inserting the core, which should occur in parallel. First, a check is performed that the pressure is above a specified lower threshold. Then both activities are started, but core insertion must wait until the clamp has reached coreInsertPos. ON handlers check for error situations. Whenever the pressure drops below a specified lower threshold or one of the components reports an error, all activities are stopped, and an error is reported to the level above.
                              
                           
                        

Finally, the topmost component controls the activities of its four direct subcomponents, pressureCtrl, moldCtrl, nozzleCtrl, and ejectorCtrl. It defines bindings that forward the pressure provided by the pressureCtrl subcomponent to the other subcomponents as inputs.

The code snippet then shows the overall automatic control cycle of the machine. The operation cycle of the machine is clearly represented in the code. In the inner control loop, first the mold is closed, then injection occurs, and, in parallel, the cooling time is checked. The mold is then opened and, simultaneously, new material is inserted into the screw (nozzleCtrl.plasticize). After the mold has been opened to a specified point, the piece is ejected.
                              
                           
                        

We have developed an integrated development environment for programming in Monaco, based on the Eclipse Rich Client Platform (http://eclipsercp.org/). Its back-end consists of a compiler and a virtual machine (VM). The core component of the IDE's front-end is a GEF-based (http://www.eclipse.org/gef/) visual editor that allows visualization and interactive manipulation of the Monaco programs. A text editor with all typical features, such as syntax highlighting, can be used to edit the source code directly, and the IDE keeps textual and visual representation in sync. In this section, we briefly describe the visual representation of Monaco programs.

The visual representation scheme for Monaco programs allows visualization of component structures and the control algorithms implemented in routines. The visual representation of routines maps directly to the source code and visualizes it in two dimensions. Its goal is to exploit two-dimensional space to reveal the event-based control flow. The essential elements to be visualized are block structure, sequential control flow and standard imperative constructs (conditional statements and loops), parallel execution threads, and asynchronous event handling. The tool derives the visual representation automatically from the source code, thereby freeing the programmer from the need to place elements by hand. Further, it allows collapsing and expanding visual elements.

Block structure and block nesting are visualized as rectangular shapes of color tones that grow brighter as the nesting level of the block increases. Thus, block nesting is clearly displayed. Sequential control flow is shown in the vertical dimension, and sequential statements are connected with vertical lines. 
                     Fig. 10(a) shows the statement sequence as introduced in the insert routine in the example in Section 4. Further, IF–THEN–ELSE constructs are arranged vertically. The horizontal dimension is reserved for parallelism and exception-handling constructs. ON handlers are attached to the right side of the rectangles of their BEGIN/END blocks (Fig. 10(b)). Additionally, the asynchronous event nature of ON statements is emphasized by a lightning symbol. Although the example is very simple, it shows the advantages of the visual representation, particularly in combination with the possibility to collapse and expand program elements. When all ON handlers are collapsed, the normal flow of control is clearly visible (see Fig. 10(a)). Expanding handlers offers the possibility to see coverage of all unexpected events.

Statements that are executed in parallel are arranged horizontally side by side. Connecting lines show the forking and joining of parallel execution threads. Additionally, dashed lines separate the thread blocks. 
                     Fig. 11 shows the visual representation of the “automatic” routine from the example in Section 3.

In this section, we define the semantics of the reactive behavior of Monaco programs by labeled transition systems. This is done in a constructive approach in which labeled transition systems are first defined for elementary statements and essential control structures and then composed by composition operators. This means that the construction process is bottom-up: transition systems of statements are combined using composition operators to build transition systems of routine implementations. Crucial concerns in the construction process are (i) how labels of transitions are formed and (ii) where states are introduced. The reason is that transitions are executed atomically and cannot be interrupted, whereas states represent possible decision points with possibly several follow-up transitions.

Thus, for the construction of labeled transition systems of Monaco programs, the distinction between atomic code and code with blocking behavior is essential. Generally speaking, statements are atomic when they do not contain WAIT statements. In labeled transition systems, atomic code appears as labels of transitions, whereas non-atomic code results in transition systems with states. As the goal of Monaco is implementing reactive control logic, we will restrict our formal semantics definition on the reactive part of the language. The semantics of purely imperative code, however, which can be seen as identical to that of traditional imperative programming languages, is not defined in the sequel but assumed to be given by functions which define the effect of imperative code on variable values and outputs.

A Monaco program is executed by a run-time system which provides the external inputs from the lower-level layer, triggers the execution of a program step, and receives the external output actions. The Monaco program accesses the external inputs by functions of native components operates on internal variables, and calls the external output actions. The semantics of the reactive behavior is therefore formulated in terms of variables, external input functions, Monaco functions, output actions, Monaco actions and routines. Let us assume a static configuration with a tree of component instances as outlined in Section 3.1 and illustrated in Section 4.2. Then let
                        
                           
                              
                                 V
                               be the set of all variables of all Monaco component instances,


                              
                                 I
                               be the set of all external inputs provided by the functions of native component instances,


                              
                                 F
                               be the set of all functions of all Monaco component instances (i.e., functions implemented in Monaco),


                              
                                 O
                               be the set of all external output actions of native component instances,


                              
                                 A
                               be the set of all actions of all Monaco component instances (actions implemented in Monaco),


                              
                                 R
                               be the set of all routines of all Monaco component instances.

Note, that there are unique variables, external inputs, functions, actions, and routines for each component instance.

In the following we will formulate the reactive semantics of Monaco programs using those elements. First we define the execution semantics of labels in transitions. Then in Section 6.2, we introduce a labeled transition system formalism and introduce composition operators which we will use in the sequel. We introduce labeled transitions systems for elementary statements in Section 6.3. Then we show how transition systems for the essential control structures and routine calls are built in Section 6.4 and Section 6.5, respectively. This construction process for labeled transition systems resembles the compilation process of Monaco programs. In Section 6.6 we therefore discuss the compilation process and execution system of Monaco programs.

Labels are sequences of
                           
                              −
                              
                                 imperative code which are basically assignment statements, calls to external output actions, internal actions, conditional statements and loops, and sequences thereof


                                 predicates over variables, external inputs, and calls of internal functions.

The execution of imperative code is specified as the effect it has on the values of internal variables and the output actions executed. It is based on current values of variables and external inputs. So let a value assignment 
                              
                                 
                                    α
                                 
                                 
                                    V
                                 
                              
                            for internal variables 
                              V
                            be a function
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          V
                                       
                                    
                                    :
                                    V
                                    →
                                    D
                                 
                              
                           which assigns a unique value to each variable in 
                              V
                            where 
                              D
                            is the universal domain for values. We write 
                              Α
                              (
                              V
                              )
                            for the set of all variable value assignments. Accordingly, a value assignment
                              
                                 
                                    
                                       
                                          α
                                       
                                       
                                          I
                                       
                                    
                                    :
                                    I
                                    →
                                    D
                                 
                              
                           gives unique values to external inputs and we use 
                              Α
                              (
                              I
                              )
                            to denote the set of all value assignments of external inputs. A function
                              
                                 
                                    α
                                    :
                                    V
                                    ∪
                                    I
                                    →
                                    D
                                 
                              
                           is a value assignment for variables and external inputs and we use 
                              Α
                              (
                              V
                              ∪
                              I
                              )
                            for the set of all value assignments of variables and external inputs. Obviously, given value assignments 
                              
                                 
                                    α
                                 
                                 
                                    V
                                 
                              
                            and 
                              
                                 
                                    α
                                 
                                 
                                    I
                                 
                              
                            a value assignment 
                              α
                              ∈
                              Α
                              (
                              V
                              ∪
                              I
                              )
                            is defined by 
                              α
                              =
                              
                                 
                                    α
                                 
                                 
                                    V
                                 
                              
                              ∪
                              
                                 
                                    α
                                 
                                 
                                    I
                                 
                              
                           .

Let 
                              
                                 
                                    O
                                 
                                 ⁎
                              
                            be the set of all sequences of external output actions. We use the concatenation operator 
                              °
                            for concatenating sequences and 
                              ε
                            to denote the empty sequence.

Without loss of generality we abstract from imperative code in labels and assume the semantics of imperative code to be given by a function which gives the effect of the code in terms of changes of variable values and issued output actions. So let 
                              S
                              (
                              V
                              
                              ∪
                              I
                              ∪
                              F
                              ∪
                              O
                              ∪
                              A
                              )
                            be the set of all imperative statements using variables 
                              V
                           , external inputs 
                              I
                           , internal functions 
                              F
                           , output actions 
                              O
                           , and internal actions 
                              A
                           . Then we assume the semantics of 
                              s
                              ∈
                              S
                              (
                              V
                              ∪
                              I
                              ∪
                              F
                              ∪
                              O
                              ∪
                              A
                              )
                            be given by function
                              
                                 
                                    S
                                    D
                                    e
                                    f
                                    :
                                    S
                                    (
                                    V
                                    ∪
                                    I
                                    ∪
                                    F
                                    ∪
                                    O
                                    ∪
                                    A
                                    )
                                    
                                    ×
                                    
                                    Α
                                    (
                                    V
                                    ∪
                                    I
                                    )
                                    →
                                    
                                    Α
                                    (
                                    V
                                    )
                                    ×
                                    
                                       
                                          O
                                       
                                       ⁎
                                    
                                 
                              
                           i.e., 
                              S
                              D
                              e
                              f
                              (
                              s
                              ,
                              
                              α
                              )
                            defines the semantics of 
                              s
                            in terms of the resulting variable assignment and sequence of output actions given a current value assignment of variables and external inputs (note, that such a definition can easily be derived using standard operational semantics and follows the line of the operational semantics of traditional imperative languages).

Similarly, we assume the semantics of functions 
                                 f
                                 ∈
                                 F
                                 
                               to be given by the function
                                 
                                    
                                       F
                                       D
                                       e
                                       f
                                       :
                                       F
                                       ×
                                       Α
                                       (
                                       V
                                       ∪
                                       I
                                       )
                                       →
                                       D
                                    
                                 
                              
                           

i.e., 
                                 F
                                 D
                                 e
                                 f
                                 (
                                 f
                                 ,
                                 α
                                 )
                               gives a value for 
                                 f
                               given the current value assignment 
                                 α
                              . Then we define predicates as Boolean valued formulae over variables 
                                 V
                              , external inputs 
                                 I
                              , and internal functions 
                                 F
                              . Let 
                                 P
                                 (
                                 V
                                 ∪
                                 I
                                 ∪
                                 F
                                 )
                               be the set of Boolean formulae over variables 
                                 V
                              , inputs 
                                 I
                              , and functions 
                                 F
                              . Again, let the semantics of predicates 
                                 p
                                 ∈
                                 P
                                 (
                                 V
                                 ∪
                                 I
                                 ∪
                                 F
                                 )
                               be given by the function
                                 
                                    
                                       P
                                       D
                                       e
                                       f
                                       :
                                       P
                                       (
                                       V
                                       ∪
                                       I
                                       ∪
                                       F
                                       )
                                       ×
                                       Α
                                       (
                                       V
                                       ∪
                                       I
                                       )
                                       →
                                       B
                                       o
                                       o
                                       l
                                    
                                 
                              
                           

The set of valid atomic labels are the predicates 
                                 p
                                 ∈
                                 P
                                 (
                                 V
                                 ∪
                                 I
                                 ∪
                                 F
                                 )
                               and imperative statements 
                                 s
                                 ∈
                                 S
                                 (
                                 V
                                 ∪
                                 I
                                 ∪
                                 F
                                 ∪
                                 O
                                 ∪
                                 A
                                 )
                              , plus
                                 
                                 ε
                               denoting an empty label. Then, a concatenation operator 
                                 °
                               for building sequences of labels is defined: let 
                                 
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                               and 
                                 
                                    
                                       l
                                    
                                    
                                       2
                                    
                                 
                               be two labels, then 
                                 
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                                 °
                                 
                                    
                                       l
                                    
                                    
                                       2
                                    
                                 
                               is again a label. Note that the empty sequence 
                                 ε
                               is the neutral element for the concatenation operator with 
                                 l
                                 
                                 °
                                 
                                 ε
                                 =
                                 l
                               and 
                                 ε
                                 
                                 °
                                 
                                 l
                                 =
                                 l
                              . Further, we allow negation of labels by a not operator (which will be exclusively used to resolve non-determinisms in parallel statements; cf. Section 6.4). So the set of allowed labels is given by the EBNF definition
                                 
                                    
                                       L
                                       =
                                       
                                       P
                                       (
                                       V
                                       ∪
                                       I
                                       ∪
                                       F
                                       )
                                       
                                       |
                                       
                                       S
                                       (
                                       V
                                       ∪
                                       I
                                       ∪
                                       F
                                       ∪
                                       O
                                       ∪
                                       A
                                       )
                                       
                                       |
                                       
                                       "
                                       ε
                                       "
                                       
                                       |
                                       
                                       L
                                       "
                                       °
                                       "
                                       L
                                       
                                       |
                                       
                                       "
                                       n
                                       o
                                       t
                                       "
                                       L
                                       .
                                    
                                 
                              
                           

Now we introduce three operations on labels which define (i) the changes of internal variable values when executing a label, (ii) the sequence of external actions when executing a label, and (iii) if a label is satisfied and can be executed. Given a current value assignment 
                                 α
                              , the execution of a label 
                                 l
                                 ∈
                                 L
                               is defined as a function on value assignments
                                 
                                    
                                       e
                                       x
                                       e
                                       c
                                       :
                                       L
                                       ×
                                       Α
                                       (
                                       V
                                       ∪
                                       I
                                       )
                                       →
                                       Α
                                       (
                                       V
                                       )
                                    
                                 
                              with
                                 
                                    
                                       
                                          
                                             
                                                
                                                   e
                                                   x
                                                   e
                                                   c
                                                   
                                                   (
                                                   l
                                                   ,
                                                   
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         V
                                                      
                                                   
                                                   ∪
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         I
                                                      
                                                   
                                                   )
                                                   =
                                                   
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         V
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   if
                                                   
                                                   l
                                                   ∈
                                                   P
                                                   (
                                                   V
                                                   ∪
                                                   I
                                                   ∪
                                                   F
                                                   )
                                                   
                                                   ∪
                                                   {
                                                   ε
                                                   
                                                   }
                                                
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                   x
                                                   e
                                                   c
                                                   
                                                   (
                                                   n
                                                   o
                                                   t
                                                   
                                                   l
                                                   ,
                                                   
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         V
                                                      
                                                   
                                                   ∪
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         I
                                                      
                                                   
                                                   )
                                                   =
                                                   
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         V
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   l
                                                   ∈
                                                   L
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                   x
                                                   e
                                                   c
                                                   
                                                   (
                                                   s
                                                   ,
                                                   
                                                   α
                                                   )
                                                   =
                                                   
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         V
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   if
                                                   
                                                   s
                                                   ∈
                                                   S
                                                   (
                                                   V
                                                   ∪
                                                   I
                                                   ∪
                                                   F
                                                   ∪
                                                   O
                                                   ∪
                                                   A
                                                   )
                                                   
                                                   and
                                                   
                                                   S
                                                   D
                                                   e
                                                   f
                                                   
                                                   (
                                                   s
                                                   ,
                                                   α
                                                   )
                                                   =
                                                   (
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         V
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                   o
                                                   s
                                                   )
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                   x
                                                   e
                                                   c
                                                   
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   °
                                                   
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   α
                                                   )
                                                   =
                                                   e
                                                   x
                                                   e
                                                   c
                                                   
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   e
                                                   x
                                                   e
                                                   c
                                                   
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   α
                                                   )
                                                   )
                                                
                                             
                                             
                                          
                                       
                                    
                                 
                              
                           

The output operator is defined as a function
                                 
                                    
                                       o
                                       u
                                       t
                                       p
                                       u
                                       t
                                       :
                                       L
                                       ×
                                       Α
                                       (
                                       V
                                       ∪
                                       I
                                       )
                                       →
                                       
                                          
                                             O
                                          
                                          ⁎
                                       
                                    
                                 
                              with
                                 
                                    
                                       
                                          
                                             
                                                
                                                   o
                                                   u
                                                   t
                                                   p
                                                   u
                                                   t
                                                   
                                                   (
                                                   s
                                                   ,
                                                   α
                                                   )
                                                   =
                                                   
                                                   o
                                                   s
                                                
                                             
                                             
                                                
                                                   if
                                                   
                                                   s
                                                   ∈
                                                   S
                                                   (
                                                   V
                                                   ∪
                                                   I
                                                   ∪
                                                   F
                                                   ∪
                                                   O
                                                   ∪
                                                   A
                                                   )
                                                   
                                                   and
                                                   
                                                   S
                                                   D
                                                   e
                                                   f
                                                   (
                                                   s
                                                   ,
                                                   α
                                                   )
                                                   =
                                                   (
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         V
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   o
                                                   s
                                                   )
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   o
                                                   u
                                                   t
                                                   p
                                                   u
                                                   t
                                                   
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   °
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   α
                                                   )
                                                   =
                                                   o
                                                   u
                                                   p
                                                   u
                                                   t
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   a
                                                   )
                                                   °
                                                   o
                                                   u
                                                   p
                                                   u
                                                   t
                                                   
                                                   (
                                                   e
                                                   x
                                                   e
                                                   c
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   a
                                                   )
                                                   ,
                                                   α
                                                   )
                                                   )
                                                   
                                                
                                             
                                             
                                          
                                          
                                             
                                                
                                                   o
                                                   u
                                                   t
                                                   p
                                                   u
                                                   t
                                                   
                                                   (
                                                   l
                                                   ,
                                                   a
                                                   )
                                                   =
                                                   ε
                                                
                                             
                                             
                                                
                                                   otherwise
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Finally, the satisfied operator is defined as a Boolean function
                                 
                                    
                                       s
                                       a
                                       t
                                       :
                                       L
                                       ×
                                       Α
                                       (
                                       V
                                       ∪
                                       I
                                       )
                                       →
                                       B
                                       o
                                       o
                                       l
                                    
                                 
                              with
                                 
                                    
                                       
                                          
                                             
                                                
                                                   s
                                                   a
                                                   t
                                                   (
                                                   l
                                                   ,
                                                   
                                                   α
                                                   )
                                                   =
                                                   
                                                   T
                                                   R
                                                   U
                                                   E
                                                
                                             
                                             
                                                
                                                   if
                                                   
                                                   l
                                                   ∈
                                                   S
                                                   (
                                                   V
                                                   
                                                   ∪
                                                   I
                                                   ∪
                                                   F
                                                   ∪
                                                   O
                                                   ∪
                                                   A
                                                   )
                                                   ∪
                                                   {
                                                   ε
                                                   }
                                                
                                             
                                          
                                          
                                             
                                                
                                                   s
                                                   a
                                                   t
                                                   (
                                                   p
                                                   ,
                                                   α
                                                   )
                                                   =
                                                   
                                                   P
                                                   D
                                                   e
                                                   f
                                                   
                                                   (
                                                   p
                                                   ,
                                                   α
                                                   )
                                                
                                             
                                             
                                                
                                                   if
                                                   
                                                   p
                                                   ∈
                                                   P
                                                   (
                                                   V
                                                   ∪
                                                   I
                                                   ∪
                                                   F
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                
                                                   s
                                                   a
                                                   t
                                                   (
                                                   
                                                   n
                                                   o
                                                   t
                                                   
                                                   l
                                                   ,
                                                   α
                                                   )
                                                   =
                                                   
                                                   ¬
                                                   
                                                   (
                                                   s
                                                   a
                                                   t
                                                   
                                                   (
                                                   l
                                                   ,
                                                   α
                                                   )
                                                
                                             
                                             
                                                
                                                   l
                                                   ∈
                                                   L
                                                
                                             
                                          
                                          
                                             
                                                
                                                   s
                                                   a
                                                   t
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   °
                                                   
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   α
                                                   )
                                                   =
                                                   s
                                                   a
                                                   t
                                                   
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   α
                                                   )
                                                   ∧
                                                   s
                                                   a
                                                   t
                                                   
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   e
                                                   x
                                                   e
                                                   c
                                                   
                                                   (
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   α
                                                   )
                                                   )
                                                
                                             
                                             
                                          
                                       
                                    
                                 
                              
                           

Note, the last line in the definition of the 
                                 s
                                 a
                                 t
                               operator. It defines that the second label 
                                 
                                    
                                       l
                                    
                                    
                                       2
                                    
                                 
                               is evaluated with the variable value assignment established by executing the first label 
                                 
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                              .

For representing the reactive behavior of Monaco programs, we introduce a labeled transition system as a structure
                              
                                 
                                    T
                                    S
                                    =
                                    
                                       〈
                                       
                                          V
                                          ,
                                          I
                                          ,
                                          O
                                          ,
                                          S
                                          ,
                                          
                                             
                                                s
                                             
                                             i
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             f
                                          
                                          ,
                                          L
                                          ,
                                          T
                                       
                                       〉
                                    
                                    ,
                                 
                              
                           where 
                              V
                            is the set of variables, 
                              I
                            is the set of external inputs, 
                              O
                            is the set of external output actions, 
                              S
                            is the set of states, 
                              
                                 
                                    s
                                 
                                 i
                              
                              ∈
                              S
                            is the single initial state, 
                              
                                 
                                    s
                                 
                                 f
                              
                              ∈
                              S
                            is the single final state, 
                              L
                            is the set of labels, and 
                              T
                              =
                              S
                              ×
                              L
                              ×
                              S
                            is the transition relation with the constraints
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          i
                                       
                                       
                                       ≠
                                       
                                       
                                          
                                             s
                                          
                                          f
                                       
                                    , i.e., we have two unique initial and final states,


                                    
                                       ∀
                                       l
                                       ∈
                                       L
                                       ,
                                       
                                       
                                          
                                             s
                                          
                                          x
                                       
                                       ∈
                                       S
                                       :
                                       (
                                       
                                          
                                             s
                                          
                                          x
                                       
                                       ,
                                       
                                       l
                                       ,
                                       
                                       
                                          
                                             s
                                          
                                          i
                                       
                                       )
                                       ∉
                                       T
                                    , i.e., the initial state has no incoming transitions, and


                                    
                                       ∀
                                       l
                                       ∈
                                       L
                                       ,
                                       
                                          
                                             s
                                          
                                          y
                                       
                                       ∈
                                       S
                                       :
                                       (
                                       
                                          
                                             s
                                          
                                          f
                                       
                                       ,
                                       l
                                       ,
                                       
                                          
                                             s
                                          
                                          y
                                       
                                       )
                                       ∉
                                       T
                                    , i.e., the final state has no outgoing transitions.

To support definition of sequential composition and inline operators, we first introduce an append operator 
                           
                              
                                 
                                    ∼
                                 
                                 
                                    
                                       
                                          s
                                       
                                       b
                                    
                                 
                                 
                                    
                                       
                                          s
                                       
                                       a
                                    
                                 
                              
                            that appends transitions in a transition system 
                              T
                              S
                            at given states 
                              
                              
                                 
                                    s
                                 
                                 a
                              
                            and 
                              
                                 
                                    s
                                 
                                 b
                              
                            as follows: Let 
                              
                                 
                                    s
                                 
                                 a
                              
                            and 
                              
                                 
                                    s
                                 
                                 b
                              
                            be states of a transition system 
                              T
                              S
                            with 
                              
                                 
                                    s
                                 
                                 a
                              
                              
                              ≠
                              
                              
                                 
                                    s
                                 
                                 i
                              
                           , 
                              
                                 
                                    s
                                 
                                 a
                              
                              
                              ≠
                              
                              
                                 
                                    s
                                 
                                 f
                              
                           , 
                              
                                 
                                    s
                                 
                                 b
                              
                              
                              ≠
                              
                              
                                 
                                    s
                                 
                                 i
                              
                           , 
                              
                                 
                                    s
                                 
                                 b
                              
                              
                              ≠
                              
                              
                                 
                                    s
                                 
                                 f
                              
                           , and 
                              
                                 
                                    s
                                 
                                 a
                              
                              
                              ≠
                              
                              
                                 
                                    s
                                 
                                 b
                              
                           , 
                              
                                 
                                    s
                                 
                                 a
                              
                            has no outgoing transitions, i.e., 
                              ∀
                              l
                              ∈
                              L
                              ,
                              
                                 
                                    s
                                 
                                 x
                              
                              ∈
                              S
                              :
                              (
                              
                                 
                                    s
                                 
                                 a
                              
                              ,
                              l
                              ,
                              
                                 
                                    s
                                 
                                 x
                              
                              )
                              ∉
                              T
                           , 
                              
                                 
                                    s
                                 
                                 b
                              
                            has no incoming transitions, i.e., 
                              ∀
                              l
                              ∈
                              L
                              ,
                              
                                 
                                    s
                                 
                                 y
                              
                              ∈
                              S
                              :
                              (
                              
                                 
                                    s
                                 
                                 y
                              
                              ,
                              l
                              ,
                              
                                 
                                    s
                                 
                                 b
                              
                              )
                              
                              ∉
                              T
                           , and there are no direct transitions from 
                              
                                 
                                    s
                                 
                                 b
                              
                            to 
                              
                                 
                                    s
                                 
                                 a
                              
                           , i.e. 
                              ∀
                              l
                              ∈
                              L
                              :
                              (
                              
                                 
                                    s
                                 
                                 b
                              
                              ,
                              l
                              ,
                              
                                 
                                    s
                                 
                                 a
                              
                              )
                              ∉
                              T
                           . Then the append operator 
                              
                                 
                                    ~
                                 
                                 
                                    
                                       
                                          s
                                       
                                       b
                                    
                                 
                                 
                                    
                                       
                                          s
                                       
                                       a
                                    
                                 
                              
                            applied to
                              
                              T
                              S
                           , denoted 
                              T
                              
                                 
                                    S
                                 
                                 
                                    
                                 
                              
                              
                                 
                                    ~
                                 
                                 
                                    
                                       
                                          s
                                       
                                       b
                                    
                                 
                                 
                                    
                                       
                                          s
                                       
                                       a
                                    
                                 
                              
                           , gives a transition system
                              
                                 
                                    
                                       T
                                       
                                          
                                             S
                                          
                                          
                                             ~
                                          
                                       
                                    =
                                       
                                       
                                          
                                             V
                                          
                                          
                                             ~
                                          
                                       
                                       ,
                                       
                                          
                                             I
                                          
                                          
                                             ~
                                          
                                       
                                       ,
                                       
                                          
                                             O
                                          
                                          
                                             ~
                                          
                                       
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             ~
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             ~
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             ~
                                          
                                          
                                             f
                                          
                                       
                                       ,
                                       
                                          
                                             L
                                          
                                          
                                             ~
                                          
                                       
                                       ,
                                       
                                          
                                             T
                                          
                                          
                                             ~
                                          
                                       
                                    
                                 

with


                                    
                                       
                                          
                                             V
                                          
                                          
                                             ~
                                          
                                       
                                       =
                                       V
                                    , 
                                       
                                          
                                             I
                                          
                                          
                                             ~
                                          
                                       
                                       =
                                       I
                                    , 
                                       
                                          
                                             O
                                          
                                          
                                             ~
                                          
                                       
                                       =
                                       O
                                    ,


                                    
                                       
                                          
                                             S
                                          
                                          
                                             ~
                                          
                                       
                                       =
                                       S
                                       \
                                       {
                                       
                                          
                                             s
                                          
                                          a
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          b
                                       
                                       }
                                    ,


                                    
                                       
                                          
                                             s
                                          
                                          
                                             ~
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       
                                          
                                             s
                                          
                                          i
                                       
                                    ,


                                    
                                       
                                          
                                             s
                                          
                                          
                                             ~
                                          
                                          
                                             f
                                          
                                       
                                       =
                                       
                                          
                                             s
                                          
                                          f
                                       
                                    ,

All other transitions of 
                              T
                            are carried over unchanged into 
                              
                                 
                                    T
                                 
                                 
                                    ~
                                 
                              
                           , i.e., for all transitions 
                              (
                              
                                 
                                    s
                                 
                                 x
                              
                              ,
                              
                                 
                                    l
                                 
                                 
                                    x
                                    y
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 y
                              
                              )
                              ∈
                              T
                            with 
                              
                                 
                                    s
                                 
                                 y
                              
                              ≠
                              
                                 
                                    s
                                 
                                 a
                              
                            and 
                              
                                 
                                    s
                                 
                                 x
                              
                              ≠
                              
                                 
                                    s
                                 
                                 b
                              
                            it follows that 
                              (
                              
                                 
                                    s
                                 
                                 x
                              
                              ,
                              
                                 
                                    l
                                 
                                 
                                    x
                                    y
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 y
                              
                              )
                              ∈
                              
                                 
                                    T
                                 
                                 
                                    ~
                                 
                              
                           .

The set of labels 
                              
                                 
                                    L
                                 
                                 
                                    ~
                                 
                              
                            is naturally defined as the resulting labels in all transitions 
                              
                                 
                                    T
                                 
                                 
                                    ~
                                 
                              
                           , i.e.,
                              
                                 
                                    
                                       
                                          L
                                       
                                       
                                          ~
                                       
                                    
                                    =
                                    {
                                    l
                                    |
                                    (
                                    
                                       
                                          s
                                       
                                       x
                                    
                                    ,
                                    l
                                    ,
                                    
                                       
                                          s
                                       
                                       y
                                    
                                    )
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          ~
                                       
                                    
                                    }
                                    .
                                 
                              
                           
                        


                           
                           Fig. 12 illustrates the append operator. The transition system is composed at transitions to the state 
                              
                                 
                                    s
                                 
                                 a
                              
                            and transitions from the state 
                              
                                 
                                    s
                                 
                                 b
                              
                            and the labels of those transitions are concatenated. Note that due to this construction process, a transition to 
                              
                                 
                                    s
                                 
                                 a
                              
                            with a sequence of atomic statements 
                              
                                 
                                    l
                                 
                                 
                                    x
                                    a
                                 
                              
                            appended with a transition from 
                              
                                 
                                    s
                                 
                                 b
                              
                            with a sequence of atomic statements 
                              
                                 
                                    l
                                 
                                 
                                    b
                                    y
                                 
                              
                            results in one single transition with the statement sequences concatenated and no state in between. States 
                              
                                 
                                    s
                                 
                                 a
                              
                            and 
                              
                                 
                                    s
                                 
                                 b
                              
                            disappear.

Since we want to be able to apply append operations to different states in arbitrary order, the append operator must be associative.
                              Lemma
                              
                                 The append operator is associative, i.e., 
                                    (
                                    T
                                    S
                                    
                                    
                                       
                                          ~
                                       
                                       
                                          
                                             
                                                s
                                             
                                             b
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             a
                                          
                                       
                                    
                                    
                                    )
                                    
                                       
                                          ~
                                       
                                       
                                          
                                             
                                                s
                                             
                                             d
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             c
                                          
                                       
                                    
                                    =
                                    (
                                    T
                                    S
                                    
                                       
                                          ~
                                       
                                       
                                          
                                             
                                                s
                                             
                                             d
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             c
                                          
                                       
                                    
                                    )
                                    
                                       
                                          ~
                                       
                                       
                                          
                                             
                                                s
                                             
                                             b
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             a
                                          
                                       
                                    
                                  
                                 if 
                                 
                                    
                                       
                                          s
                                       
                                       a
                                    
                                    ≠
                                    
                                       
                                          s
                                       
                                       b
                                    
                                    ≠
                                    
                                       
                                          s
                                       
                                       c
                                    
                                    ≠
                                    
                                       
                                          s
                                       
                                       d
                                    
                                 .

A sketch of the proof is given in the Appendix.

Equipped with the append operator, we define a sequential composition operator for composing transition systems for code blocks which are put into sequence as follows. Let


                           A; B
                        

be two arbitrary code parts 
                              A
                            and 
                              B
                            put into sequence, and let transition systems 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                              =
                              
                              
                                 〈
                                 
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          A
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          T
                                       
                                       
                                          A
                                       
                                    
                                 
                                 〉
                              
                            be the transition system representing the behavior of code 
                              A
                            and 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                              =
                              
                                 〈
                                 
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                    
                                 
                                 〉
                              
                            be the transition system representing the behavior of code 
                              B
                           . The sequential composition 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                              →
                              
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                            is then
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          →
                                          B
                                       
                                    
                                    =
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          +
                                          B
                                       
                                    
                                    
                                       
                                          ~
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                B
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                A
                                             
                                             
                                                f
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          +
                                          B
                                          
                                          
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          
                                             
                                                V
                                             
                                             
                                                A
                                             
                                          
                                          ∪
                                          
                                             
                                                V
                                             
                                             
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                I
                                             
                                             
                                                A
                                             
                                          
                                          ∪
                                          
                                             
                                                I
                                             
                                             
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                O
                                             
                                             
                                                A
                                             
                                          
                                          ∪
                                          
                                             
                                                O
                                             
                                             
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                S
                                             
                                             
                                                A
                                             
                                          
                                          ∪
                                          
                                             
                                                S
                                             
                                             
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                A
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                B
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          
                                             
                                                L
                                             
                                             
                                                A
                                             
                                          
                                          ∪
                                          
                                             
                                                L
                                             
                                             
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                T
                                             
                                             
                                                A
                                             
                                          
                                          ∪
                                          
                                             
                                                T
                                             
                                             
                                                B
                                             
                                          
                                       
                                       〉
                                    
                                    ,
                                 
                              
                           i.e., the sequential composition 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                              →
                              
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                            is the union of systems 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                            and 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                            with the initial state taken from 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                            and the final state taken from 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                            and the resulting system appended at states 
                              
                                 
                                    s
                                 
                                 
                                    A
                                 
                                 
                                    f
                                 
                              
                            and 
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                           .

For the sequential composition of systems to be applicable in arbitrary order, the sequential composition operator must be associative.
                              Lemma
                              
                                 
                                    →
                                 
                                 The sequential composition operator is associative, i.e., 
                                    (
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    →
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    )
                                    →
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          C
                                       
                                    
                                    =
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    →
                                    (
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    →
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          C
                                       
                                    
                                    )
                                 .

The proof is provided in the Appendix.

For building transition systems of control flow statements, we define an inline operator 
                           
                              
                              T
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                              
                                 
                                    >
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          e
                                       
                                    
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          b
                                       
                                    
                                 
                              
                              T
                              
                                 
                                    S
                                 
                                 
                                    T
                                 
                              
                            which allows inlining of a transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                              
                            – the inlined system – into a transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    T
                                 
                              
                              
                            – the target system – at begin state 
                              
                                 
                                    s
                                 
                                 
                                    T
                                 
                                 
                                    b
                                 
                              
                            and end state 
                              
                                 
                                    s
                                 
                                 
                                    T
                                 
                                 
                                    e
                                 
                              
                            of 
                              T
                              
                                 
                                    S
                                 
                                 
                                    T
                                 
                              
                            as
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          I
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                e
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          T
                                       
                                    
                                    =
                                    (
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          T
                                          ⁎
                                          I
                                       
                                    
                                    
                                       
                                          ~
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                I
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                    )
                                    
                                       
                                          ~
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                e
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                I
                                             
                                             
                                                f
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          T
                                          ⁎
                                          I
                                       
                                    
                                    =
                                    〈
                                    
                                       
                                          V
                                       
                                       
                                          T
                                       
                                    
                                    ∪
                                    
                                       
                                          V
                                       
                                       
                                          I
                                       
                                    
                                    ,
                                    
                                       
                                          I
                                       
                                       
                                          T
                                       
                                    
                                    ∪
                                    
                                       
                                          I
                                       
                                       
                                          I
                                       
                                    
                                    ,
                                    
                                       
                                          O
                                       
                                       
                                          T
                                       
                                    
                                    ∪
                                    
                                       
                                          O
                                       
                                       
                                          I
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          T
                                       
                                    
                                    ∪
                                    
                                       
                                          S
                                       
                                       
                                          I
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          T
                                       
                                    
                                    ∪
                                    
                                       
                                          L
                                       
                                       
                                          I
                                       
                                    
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          T
                                       
                                    
                                    ∪
                                    
                                       
                                          T
                                       
                                       
                                          I
                                       
                                    
                                    ,
                                    〉
                                 
                              
                           i.e., the inline operator 
                              T
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                              
                                 
                                    >
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          e
                                       
                                    
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          b
                                       
                                    
                                 
                              
                              
                              T
                              
                                 
                                    S
                                 
                                 
                                    T
                                 
                              
                            is defined by the union of systems 
                              T
                              
                                 
                                    S
                                 
                                 
                                    T
                                 
                              
                            and 
                              T
                              
                                 
                                    S
                                 
                                 
                                    I
                                 
                              
                            with the initial and the final state taken from 
                              T
                              
                                 
                                    S
                                 
                                 
                                    T
                                 
                              
                            and the resulting system first appended at states 
                              
                                 
                                    s
                                 
                                 
                                    T
                                 
                                 
                                    b
                                 
                              
                            and 
                              
                                 
                                    s
                                 
                                 
                                    I
                                 
                                 
                                    i
                                 
                              
                            and the resulting transition system then appended at states 
                              
                                 
                                    s
                                 
                                 
                                    I
                                 
                                 
                                    f
                                 
                              
                            and 
                              
                                 
                                    s
                                 
                                 
                                    T
                                 
                                 
                                    e
                                 
                              
                           .


                           
                           Fig. 13 illustrates the inline operator.

For the inline operator to be well defined, the inlined system must contain no direct transitions from initial state 
                              
                                 
                                    s
                                 
                                 
                                    I
                                 
                                 
                                    i
                                 
                              
                            to final state 
                              
                                 
                                    s
                                 
                                 
                                    I
                                 
                                 
                                    f
                                 
                              
                            and no loop transitions from end state 
                              
                                 
                                    s
                                 
                                 
                                    T
                                 
                                 
                                    e
                                 
                              
                            to begin state 
                              
                                 
                                    s
                                 
                                 
                                    T
                                 
                                 
                                    b
                                 
                              
                            (see WHILE loops in Section 6.4 for an explanation).

We want to use inlining of different systems at different states into one target system in arbitrary order.
                              Lemma
                              
                                 Inlining system 
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          I
                                          1
                                       
                                    
                                  
                                 at states 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          b
                                          1
                                       
                                    
                                  
                                 and 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          e
                                          1
                                       
                                    
                                  
                                 and system 
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          I
                                          2
                                       
                                    
                                  
                                 at states 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          b
                                          2
                                       
                                    
                                  
                                 and 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          e
                                          2
                                       
                                    
                                  
                                 into a target system 
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          T
                                       
                                    
                                  
                                 can be done in any order, i.e., 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          I
                                          2
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                e
                                                2
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                b
                                                2
                                             
                                          
                                       
                                    
                                    (
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          I
                                          1
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                e
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                b
                                                1
                                             
                                          
                                       
                                    
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          T
                                       
                                    
                                    )
                                    =
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          I
                                          1
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                e
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                b
                                                1
                                             
                                          
                                       
                                    
                                    (
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          I
                                          2
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                e
                                                2
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                T
                                             
                                             
                                                b
                                                2
                                             
                                          
                                       
                                    
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          T
                                       
                                    
                                    )
                                  
                                 if 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          b
                                          1
                                       
                                    
                                    ≠
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          b
                                          2
                                       
                                    
                                    ≠
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          e
                                          1
                                       
                                    
                                    ≠
                                    
                                       
                                          s
                                       
                                       
                                          T
                                       
                                       
                                          e
                                          2
                                       
                                    
                                 .

The proof is given in the Appendix.

In this section, we define labeled transition systems for elementary statements.

A single atomic statement


                           a;

yields a transition system (see 
                           Fig. 14(a))
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    =
                                    
                                       
                                          V
                                       
                                       
                                          a
                                       
                                    
                                    ,
                                    
                                       
                                          I
                                       
                                       
                                          a
                                       
                                    
                                    ,
                                    
                                       
                                          O
                                       
                                       
                                          a
                                       
                                    
                                    ,
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          f
                                       
                                    
                                    }
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    {
                                    a
                                    }
                                    ,
                                    {
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    a
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          f
                                       
                                    
                                    )
                                    }
                                 
                              
                           with 
                              
                                 
                                    V
                                 
                                 
                                    a
                                 
                              
                           , 
                              
                                 
                                    I
                                 
                                 
                                    a
                                 
                              
                            and 
                              
                                 
                                    O
                                 
                                 
                                    a
                                 
                              
                            are the variables, external inputs, and output actions used in statement a, respectively.

Further, we define an empty statement

;

to obtain a transition system (see Fig. 14(b))
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          ε
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          ∅
                                          ,
                                          ∅
                                          ,
                                          ∅
                                          ,
                                          {
                                          
                                             
                                                s
                                             
                                             
                                                ε
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                ε
                                             
                                             
                                                f
                                             
                                          
                                          }
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                ε
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                ε
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          {
                                          ε
                                          }
                                          ,
                                          {
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                ε
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ε
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                ε
                                             
                                             
                                                f
                                             
                                          
                                          )
                                          }
                                       
                                       〉
                                    
                                    .
                                 
                              
                           
                        

A WAIT statement

WAIT w;

with condition w is represented by a transition system (see Fig. 14(c))
                              1
                           
                           
                              1
                              We will write predicates 
                                    p
                                    ∈
                                    P
                                    (
                                    V
                                    ∪
                                    I
                                    ∪
                                    F
                                    )
                                  which occur in labels in brackets, i.e., 
                                    [
                                    p
                                    ]
                                 , in the following.
                           
                           
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          W
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          
                                             
                                                V
                                             
                                             
                                                W
                                             
                                          
                                          ,
                                          
                                             
                                                I
                                             
                                             
                                                W
                                             
                                          
                                          ,
                                          ∅
                                          ,
                                          {
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                w
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                f
                                             
                                          
                                          }
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          {
                                          ε
                                          ,
                                          [
                                          w
                                          ]
                                          }
                                          ,
                                          {
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ε
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                w
                                             
                                          
                                          )
                                          ,
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                w
                                             
                                          
                                          ,
                                          [
                                          w
                                          ]
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                W
                                             
                                             
                                                f
                                             
                                          
                                          )
                                          }
                                       
                                       〉
                                    
                                 
                              
                           with 
                              
                                 
                                    V
                                 
                                 
                                    W
                                 
                              
                            and 
                              
                                 
                                    I
                                 
                                 
                                    W
                                 
                              
                            are the variables and external inputs used in condition w, respectively.


                           
                           Fig. 15 illustrates how sequential composition of these elementary statements works. Note how atomic statements are combined and initial and final states disappear. The resulting system always has just one initial and one final state.

Equipped with the inline operator, we can define the transition system for an IF statement as follows: Let
                              
                           be an IF statement with condition c, THEN branch T, and ELSE branch E, and let 
                              T
                              
                                 
                                    S
                                 
                                 
                                    T
                                 
                              
                            be the transition system for the THEN branch and 
                              T
                              
                                 
                                    S
                                 
                                 
                                    E
                                 
                              
                            the transition system for the ELSE branch. First we define a transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    C
                                 
                              
                            for representing the conditional branch only as
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          C
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          
                                             
                                                V
                                             
                                             
                                                C
                                             
                                          
                                          ,
                                          
                                             
                                                I
                                             
                                             
                                                C
                                             
                                          
                                          ,
                                          ∅
                                          ,
                                          
                                             
                                                S
                                             
                                             
                                                C
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                C
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                C
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          
                                             
                                                L
                                             
                                             
                                                C
                                             
                                          
                                          ,
                                          
                                             
                                                T
                                             
                                             
                                                C
                                             
                                          
                                       
                                       〉
                                    
                                 
                              
                           with 
                              
                                 
                                    V
                                 
                                 
                                    C
                                 
                              
                            and 
                              
                                 
                                    I
                                 
                                 
                                    C
                                 
                              
                            are the variables and external inputs used in condition c, respectively. 
                              
                                 
                                    S
                                 
                                 
                                    C
                                 
                              
                              =
                              {
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    b
                                    t
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    e
                                    t
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    b
                                    e
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    e
                                    e
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    f
                                 
                              
                              }
                           , 
                              
                                 
                                    L
                                 
                                 
                                    C
                                 
                              
                              =
                              {
                              [
                              c
                              ]
                              ,
                              [
                              ¬
                              c
                              ]
                              ,
                              ε
                              }
                           , and 
                              
                                 
                                    T
                                 
                                 
                                    C
                                 
                              
                              =
                              {
                              (
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    i
                                 
                              
                              ,
                              [
                              c
                              ]
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    b
                                    t
                                 
                              
                              )
                              ,
                              (
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    i
                                 
                              
                              ,
                              [
                              ¬
                              c
                              ]
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    b
                                    e
                                 
                              
                              )
                              ,
                              (
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    e
                                    t
                                 
                              
                              ,
                              ε
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    f
                                 
                              
                              )
                              ,
                              (
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    e
                                    e
                                 
                              
                              ,
                              ε
                              ,
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    f
                                 
                              
                              )
                              }
                           .

The transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    I
                                    F
                                 
                              
                              
                            defining the behavior of the IF statement is then defined by inlining the transition system for THEN and ELSE branches at states 
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    b
                                    t
                                 
                              
                            and 
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    e
                                    t
                                 
                              
                            and states 
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    b
                                    e
                                 
                              
                            and 
                              
                                 
                                    s
                                 
                                 
                                    C
                                 
                                 
                                    e
                                    e
                                 
                              
                           , respectively,
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          I
                                          F
                                       
                                    
                                    =
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          E
                                          
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                C
                                             
                                             
                                                e
                                                e
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                C
                                             
                                             
                                                b
                                                e
                                             
                                          
                                       
                                    
                                    (
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          T
                                          
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                C
                                             
                                             
                                                e
                                                t
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                C
                                             
                                             
                                                b
                                                t
                                             
                                          
                                       
                                    
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          C
                                          
                                       
                                    
                                    )
                                    .
                                 
                              
                           
                        


                           
                           Fig. 16 illustrates the construction of the transition system for IF statements. Note that the cascaded IF conditions result in multiple atomic transitions with labels containing multiple conditions.

We build transition systems for WHILE loops
                              
                                 
                                    
                                    
                                       
                                          
                                             WHILE 
                                             c 
                                             LOOP
                                          
                                       
                                       
                                          
                                             
                                                
                                                B
                                          
                                       
                                       
                                          
                                             END_LOOP
                                          
                                       
                                    
                                 
                              
                           which have a body B with a transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                              =
                              
                                 〈
                                 
                                    
                                       
                                          V
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          I
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          O
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                    
                                 
                                 〉
                              
                            which has no direct transitions 
                              (
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                              ,
                              l
                              ,
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    f
                                 
                              
                              )
                              ∉
                              
                                 
                                    T
                                 
                                 
                                    B
                                 
                              
                            from initial to final states as follows: Let
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          L
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          
                                             
                                                V
                                             
                                             
                                                L
                                             
                                          
                                          ,
                                          
                                             
                                                I
                                             
                                             
                                                L
                                             
                                          
                                          ,
                                          ∅
                                          ,
                                          
                                             
                                                S
                                             
                                             
                                                L
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                L
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                L
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          
                                             
                                                L
                                             
                                             
                                                L
                                             
                                          
                                          ,
                                          
                                             
                                                T
                                             
                                             
                                                L
                                             
                                          
                                       
                                       〉
                                    
                                 
                              
                           be a transition system with (cf. 
                              T
                              
                                 
                                    S
                                 
                                 
                                    L
                                 
                              
                            in 
                           Fig. 17).


                           
                              
                                 
                                    V
                                 
                                 
                                    L
                                 
                              
                            and 
                              
                                 
                                    I
                                 
                                 
                                    L
                                 
                              
                            are the variables and external inputs used in condition c, respectively,
                              
                                 
                                    
                                       
                                          S
                                       
                                       
                                          L
                                       
                                    
                                    =
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          b
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          e
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          f
                                       
                                    
                                    }
                                    
                                       
                                          L
                                       
                                       
                                          L
                                       
                                    
                                    =
                                    {
                                    [
                                    c
                                    ]
                                    ,
                                    [
                                    ¬
                                    c
                                    ]
                                    }
                                    
                                    and
                                    
                                       
                                          T
                                       
                                       
                                          L
                                       
                                    
                                    =
                                    {
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    [
                                    c
                                    ]
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          b
                                       
                                    
                                    )
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    [
                                    ¬
                                    c
                                    ]
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          f
                                       
                                    
                                    )
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          e
                                       
                                    
                                    ,
                                    [
                                    c
                                    ]
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          b
                                       
                                    
                                    
                                    )
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          e
                                       
                                    
                                    ,
                                    [
                                    ¬
                                    c
                                    ]
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          L
                                       
                                       
                                          f
                                       
                                    
                                    )
                                    }
                                 
                              
                           
                        

The transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    W
                                    L
                                 
                              
                              
                           defining the behavior of the WHILE statement is then defined by inlining the transition system for the loop body at states 
                              
                                 
                                    s
                                 
                                 
                                    L
                                 
                                 
                                    b
                                 
                              
                            and 
                              
                                 
                                    s
                                 
                                 
                                    L
                                 
                                 
                                    e
                                 
                              
                           
                           
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          W
                                          L
                                       
                                    
                                    =
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          B
                                          
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                L
                                             
                                             
                                                e
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                L
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          L
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        


                           Fig. 17 illustrates the construction of a transition system for WHILE loops.

The construction process clearly shows why direct transitions 
                              (
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                              ,
                              l
                              ,
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    f
                                 
                              
                              )
                            from initial to final states are not allowed in the inlined system: no state would exist for the loop, and a direct transition from final state 
                              
                                 
                                    s
                                 
                                 
                                    L
                                 
                                 
                                    f
                                 
                              
                            to initial state 
                              
                                 
                                    s
                                 
                                 
                                    L
                                 
                                 
                                    i
                                 
                              
                            would result. This, however, is not allowed for transition systems. Therefore, Monaco provides different looping constructs for atomic statements. Such a loop is treated as an atomic statement and becomes part of a label in a transition system.

For an ON statement
                              
                                 
                                    
                                    
                                       
                                          
                                             BEGIN
                                          
                                       
                                       
                                          
                                             
                                                
                                                B
                                          
                                       
                                       
                                          
                                             ON 
                                             c
                                          
                                       
                                       
                                          
                                             
                                                
                                                H
                                          
                                       
                                       
                                          
                                             END
                                          
                                       
                                    
                                 
                              
                           we define a transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    O
                                    N
                                 
                              
                            in the following way: Let 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                              =
                              
                                 〈
                                 
                                    
                                       
                                          V
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          I
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          O
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                    
                                 
                                 〉
                              
                              
                            be the transition system representing the code 
                              B
                            with set of states 
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                              =
                              {
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    b
                                 
                              
                              ,
                              …
                              ,
                              
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    f
                                 
                              
                              }
                           . Let 
                              T
                              
                                 
                                    S
                                 
                                 
                                    H
                                 
                              
                              =
                              
                                 〈
                                 
                                    
                                       
                                          V
                                       
                                       
                                          H
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          H
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          H
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          H
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          H
                                       
                                    
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          H
                                       
                                    
                                 
                                 〉
                              
                            be the transition system representing the handler code 
                              H
                           . Then we first define a transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    O
                                 
                              
                            as
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          O
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          
                                             
                                                V
                                             
                                             
                                                O
                                             
                                          
                                          ,
                                          
                                             
                                                I
                                             
                                             
                                                O
                                             
                                          
                                          ,
                                          
                                             
                                                O
                                             
                                             
                                                O
                                             
                                          
                                          ,
                                          
                                             
                                                S
                                             
                                             
                                                O
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                O
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                O
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          
                                             
                                                L
                                             
                                             
                                                O
                                             
                                          
                                          ,
                                          
                                             
                                                T
                                             
                                             
                                                O
                                             
                                          
                                       
                                       〉
                                    
                                 
                              
                           with 
                              
                                 
                                    V
                                 
                                 
                                    O
                                 
                              
                           , 
                              
                                 
                                    I
                                 
                                 
                                    O
                                 
                              
                            and 
                              
                                 
                                    O
                                 
                                 
                                    O
                                 
                              
                            are the variables, external inputs, and output actions used in B and c,
                              
                                 
                                    
                                       
                                          S
                                       
                                       
                                          O
                                       
                                    
                                    =
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    ∪
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          O
                                       
                                       
                                          b
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          s
                                       
                                       
                                          O
                                       
                                       
                                          e
                                       
                                    
                                    }
                                    
                                       
                                          s
                                       
                                       
                                          O
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          s
                                       
                                       
                                          O
                                       
                                       
                                          f
                                       
                                    
                                    =
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    
                                       
                                          L
                                       
                                       
                                          O
                                       
                                    
                                    =
                                    
                                       
                                          L
                                          ′
                                       
                                       
                                          B
                                       
                                    
                                    ∪
                                    {
                                    [
                                    c
                                    ]
                                    }
                                    
                                    and
                                    
                                       
                                          T
                                       
                                       
                                          O
                                       
                                    
                                    =
                                    
                                       
                                          T
                                          ′
                                       
                                       
                                          B
                                       
                                    
                                    ∪
                                    {
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    [
                                    c
                                    ]
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          O
                                       
                                       
                                          b
                                       
                                    
                                    )
                                    |
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ∈
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    \
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    }
                                    }
                                    ∪
                                    {
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          O
                                       
                                       
                                          e
                                       
                                    
                                    ,
                                    ε
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    )
                                    }
                                 
                              
                           where
                              
                                 
                                    
                                       
                                          L
                                          ′
                                       
                                       
                                          B
                                       
                                    
                                    =
                                    {
                                    
                                    [
                                    ¬
                                    c
                                    ]
                                    
                                    °
                                    
                                       
                                          l
                                       
                                       
                                          B
                                       
                                    
                                    |
                                    
                                       
                                          l
                                       
                                       
                                          B
                                       
                                    
                                    ∈
                                    
                                       
                                          L
                                       
                                       
                                          B
                                       
                                    
                                    }
                                    
                                    and
                                    
                                    
                                       
                                          T
                                          ′
                                       
                                       
                                          B
                                       
                                    
                                    =
                                    {
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    [
                                    ¬
                                    c
                                    ]
                                    
                                    °
                                    
                                       
                                          l
                                       
                                       
                                          B
                                       
                                       
                                          x
                                          y
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          y
                                       
                                    
                                    )
                                    |
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          B
                                       
                                       
                                          x
                                          y
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          y
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                    
                                    }
                                 
                              
                           i.e., the transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                            is changed so that each transition label is prefixed with 
                              [
                              ¬
                              c
                              ]
                            guaranteeing that the ON condition does not occur. Additionally transitions from all states 
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    x
                                 
                              
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                            (except initial and final states) to the state 
                              
                                 
                                    s
                                 
                                 
                                    O
                                 
                                 
                                    b
                                 
                              
                            representing the begin of the ON handler with the ON condition 
                              [
                              c
                              ]
                            as label are added. Moreover, there is a single transition from the state 
                              
                              
                                 
                                    s
                                 
                                 
                                    O
                                 
                                 
                                    e
                                 
                              
                            (representing the end of the ON handler) to the final state. 
                           Fig. 18(a) shows the transition systems for ON statements.

The final transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    O
                                    N
                                 
                              
                            for the whole BEGIN/END with ON handler statement is obtained by inlining the transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    H
                                 
                              
                            (representing the handler code at states 
                              
                                 
                                    s
                                 
                                 
                                    O
                                 
                                 
                                    b
                                 
                              
                            and 
                              
                                 
                                    s
                                 
                                 
                                    O
                                 
                                 
                                    e
                                 
                              
                              )
                            into 
                              T
                              
                                 
                                    S
                                 
                                 
                                    O
                                 
                              
                              :
                           
                           
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          O
                                          N
                                       
                                    
                                    =
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          H
                                       
                                    
                                    
                                       
                                          >
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                O
                                             
                                             
                                                e
                                             
                                          
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                O
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          O
                                       
                                    
                                    .
                                 
                              
                           
                        

For an ON statement with a RESUME at the end of the handler code
                              
                                 
                                    
                                    
                                       
                                          
                                             BEGIN
                                          
                                       
                                       
                                          
                                             
                                                
                                                B
                                          
                                       
                                       
                                          
                                             ON 
                                             c
                                          
                                       
                                       
                                          
                                             
                                                
                                                H
                                          
                                       
                                       
                                          
                                             
                                                
                                                
                                             
                                             RESUME;
                                       
                                       
                                          
                                             END
                                          
                                       
                                    
                                 
                              
                           the transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    O
                                    N
                                 
                              
                            is constructed in a similar way, but with transitions back to the previous state instead of to the final state. Let 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                              =
                              
                              
                                 〈
                                 
                                    
                                       
                                          V
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                    
                                 
                                 〉
                              
                            be the transition system representing code 
                              B
                            as previously defined. Then we define the transition system 
                              T
                              
                                 
                                    S
                                 
                                 
                                    O
                                    R
                                 
                              
                            as
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          O
                                          R
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          
                                             
                                                V
                                             
                                             
                                                O
                                                R
                                             
                                             
                                                +
                                                s
                                             
                                          
                                          ,
                                          
                                             
                                                I
                                             
                                             
                                                O
                                                R
                                             
                                          
                                          ,
                                          
                                             
                                                O
                                             
                                             
                                                O
                                                R
                                             
                                          
                                          ,
                                          
                                             
                                                S
                                             
                                             
                                                O
                                                R
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                O
                                                R
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                O
                                                R
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          
                                             
                                                L
                                             
                                             
                                                O
                                                R
                                             
                                          
                                          ,
                                          
                                             
                                                T
                                             
                                             
                                                O
                                                R
                                             
                                          
                                       
                                       〉
                                    
                                    .
                                 
                              
                           with 
                              
                                 
                                    V
                                 
                                 
                                    O
                                    R
                                 
                              
                           , 
                              
                                 
                                    I
                                 
                                 
                                    O
                                    R
                                 
                              
                            and 
                              
                                 
                                    O
                                 
                                 
                                    O
                                    R
                                 
                              
                            are the variables, external inputs, and output actions used in B and c and
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          O
                                          R
                                       
                                       
                                          +
                                          s
                                       
                                    
                                    =
                                    
                                       
                                          V
                                       
                                       
                                          O
                                          R
                                       
                                    
                                    ∪
                                    {
                                    s
                                    }
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          O
                                          R
                                       
                                    
                                    =
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    ∪
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          O
                                          R
                                       
                                       
                                          b
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          O
                                          R
                                       
                                       
                                          e
                                       
                                    
                                    }
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          O
                                          R
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          O
                                          R
                                       
                                       
                                          f
                                       
                                    
                                    =
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          O
                                          R
                                       
                                    
                                    =
                                    
                                       
                                          L
                                       
                                       
                                          B
                                       
                                       
                                          '
                                       
                                    
                                    ∪
                                    {
                                    [
                                    c
                                    ]
                                    s
                                    :
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    |
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ∈
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    \
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    }
                                    }
                                    ,
                                    
                                    and
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          O
                                          R
                                       
                                    
                                    =
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                       
                                          '
                                       
                                    
                                    ∪
                                    {
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    [
                                    c
                                    ]
                                    s
                                    :
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          O
                                          R
                                       
                                       
                                          b
                                       
                                    
                                    )
                                    |
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ∈
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    \
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    }
                                    }
                                    ∪
                                    {
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          O
                                          R
                                       
                                       
                                          e
                                       
                                    
                                    ,
                                    [
                                    s
                                    =
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ]
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    )
                                    |
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          x
                                       
                                    
                                    ∈
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    \
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    }
                                    }
                                    ,
                                 
                              
                           where 
                              s
                              :
                              =
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    x
                                 
                              
                            is the statement for saving the current state 
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    x
                                 
                              
                            in a local variable 
                              s
                              ,
                            and 
                              [
                              s
                              =
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    x
                                 
                              
                              ]
                            is a condition testing if the saved state is equal to 
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    x
                                 
                              
                           . 
                              
                                 
                                    L
                                 
                                 
                                    B
                                 
                                 
                                    '
                                 
                              
                            and 
                              
                                 
                                    T
                                 
                                 
                                    B
                                 
                                 
                                    '
                                 
                              
                            are defined as above.


                           Fig. 18(b) shows the construction of transition systems for ON statements with RESUME.

For a PARALLEL statement
                              
                                 
                                    
                                    
                                       
                                          
                                             PARALLEL
                                          
                                       
                                       
                                          
                                             
                                                
                                                A
                                          
                                       
                                       
                                          ||
                                       
                                       
                                          
                                             
                                                
                                                B
                                          
                                       
                                       
                                          
                                             END
                                          
                                       
                                    
                                 
                              
                           defining the parallel execution of code 
                              A
                            and code 
                              B
                              ,
                            we construct the transition system by a parallel interleaving of states and state transitions of 
                              A
                            and 
                              B
                            which is defined by a parallel composition operator 
                           
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                              |
                              |
                              
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                           . Let 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                              =
                              
                                 〈
                                 
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          A
                                       
                                    
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          A
                                       
                                    
                                 
                                 〉
                              
                            be the transition system for the code block 
                              A
                            with set of states 
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                              =
                              {
                              
                                 
                                    s
                                 
                                 
                                    A
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    A
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    A
                                 
                                 
                                    b
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    s
                                 
                                 
                                    A
                                 
                                 
                                    f
                                 
                              
                              }
                            and 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                              =
                              
                                 〈
                                 
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                    
                                 
                                 〉
                              
                            be the transition system for the code block 
                              B
                            with set of states 
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                              =
                              {
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    d
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    s
                                 
                                 
                                    B
                                 
                                 
                                    f
                                 
                              
                              }
                           . Then we define the transition system for parallel execution of 
                              A
                            and 
                              B
                            by
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                    
                                    =
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    |
                                    |
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          
                                             
                                                V
                                             
                                             
                                                A
                                                |
                                                |
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                V
                                             
                                             
                                                A
                                                |
                                                |
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                V
                                             
                                             
                                                A
                                                |
                                                |
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                S
                                             
                                             
                                                A
                                                |
                                                |
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                A
                                                |
                                                |
                                                B
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                A
                                                |
                                                |
                                                B
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          
                                             
                                                L
                                             
                                             
                                                A
                                                |
                                                |
                                                B
                                             
                                          
                                          ,
                                          
                                             
                                                T
                                             
                                             
                                                A
                                                |
                                                |
                                                B
                                             
                                          
                                       
                                       〉
                                    
                                 
                              
                           with
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                    
                                    =
                                    
                                       
                                          V
                                       
                                       
                                          A
                                       
                                    
                                    ∪
                                    
                                       
                                          V
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          I
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                    
                                    =
                                    
                                       
                                          I
                                       
                                       
                                          A
                                       
                                    
                                    ∪
                                    
                                       
                                          I
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                    
                                       
                                          O
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                    
                                    =
                                    
                                       
                                          O
                                       
                                       
                                          A
                                       
                                    
                                    ∪
                                    
                                       
                                          O
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    \
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    }
                                    )
                                    ×
                                    
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    \
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    }
                                    )
                                    
                                    ∪
                                    {
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    }
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          f
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          f
                                       
                                    
                                    )
                                    
                                       
                                          T
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                    
                                    =
                                    
                                    {
                                    (
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          A
                                       
                                       
                                          i
                                          x
                                       
                                    
                                    °
                                    
                                       
                                          l
                                       
                                       
                                          B
                                       
                                       
                                          i
                                          u
                                       
                                    
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    )
                                    )
                                    |
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          A
                                       
                                       
                                          i
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          A
                                       
                                    
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          B
                                       
                                       
                                          i
                                          u
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                    
                                    }
                                    ∪
                                    {
                                    (
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          A
                                       
                                       
                                          x
                                          y
                                       
                                    
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          y
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    )
                                    )
                                    |
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          A
                                       
                                       
                                          x
                                          y
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          y
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          A
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ≠
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    ∈
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    â§¹
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    }
                                    }
                                    ∪
                                    {
                                    (
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    )
                                    ,
                                    (
                                    
                                       
                                          °
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                A
                                             
                                             
                                                x
                                             
                                          
                                          ,
                                          
                                             
                                                l
                                             
                                             
                                                A
                                             
                                             
                                                x
                                                y
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                A
                                             
                                             
                                                y
                                             
                                          
                                          )
                                          ∈
                                          
                                             
                                                T
                                             
                                             
                                                A
                                             
                                          
                                       
                                    
                                    n
                                    o
                                    t
                                    
                                    
                                       
                                          l
                                       
                                       
                                          A
                                       
                                       
                                          x
                                          y
                                       
                                    
                                    )
                                    °
                                    
                                       
                                          l
                                       
                                       
                                          B
                                       
                                       
                                          u
                                          v
                                       
                                    
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          v
                                       
                                    
                                    )
                                    )
                                    |
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          B
                                       
                                       
                                          u
                                          v
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          v
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          B
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    ≠
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ∈
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    â§¹
                                    
                                    {
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          i
                                       
                                    
                                    }
                                    }
                                    ,
                                 
                              
                           and
                              
                                 
                                    
                                       
                                          L
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                    
                                    =
                                    {
                                    l
                                    |
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    )
                                    ,
                                    l
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          y
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          v
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          A
                                          |
                                          |
                                          B
                                       
                                    
                                    }
                                    .
                                 
                              
                           
                        

Note the three lines in the definition of the transitions relation. The first line handles the transitions from the initial state of both components 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                            and 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                            which are immediately executed. The second line handles the transitions stemming from 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                           . The third line handles the transtions from 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                            and contain the condition 
                              n
                              o
                              t
                              
                              
                                 
                                    l
                                 
                                 
                                    A
                                 
                                 
                                    x
                                    y
                                 
                              
                            for all possible transitions 
                              (
                              
                                 
                                    s
                                 
                                 
                                    A
                                 
                                 
                                    x
                                 
                              
                              ,
                              
                                 
                                    l
                                 
                                 
                                    A
                                 
                                 
                                    x
                                    y
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    A
                                 
                                 
                                    y
                                 
                              
                              )
                              ∈
                              
                                 
                                    T
                                 
                                 
                                    A
                                 
                              
                              
                           from 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                            which guarantees that none of them can be executed. That means that transitions of 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                            always have priority.


                           
                           Fig. 19 illustrates parallel composition of transition systems.

Again we want the ability to apply parallel composition in arbitrary order and thus require the parallel composition operator to be associative.
                              Lemma
                              
                                 The parallel composition operator is associative, i.e., 
                                    (
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    |
                                    |
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    )
                                    |
                                    |
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          C
                                       
                                    
                                    =
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          A
                                       
                                    
                                    |
                                    |
                                    (
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          B
                                       
                                    
                                    |
                                    |
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          C
                                       
                                    
                                    )
                                 .

Assuming that 
                                    (
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          C
                                       
                                       
                                          s
                                       
                                    
                                    )
                                    =
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          C
                                       
                                       
                                          s
                                       
                                    
                                    )
                                    )
                                    =
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          A
                                       
                                       
                                          x
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          B
                                       
                                       
                                          u
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          C
                                       
                                       
                                          s
                                       
                                    
                                    )
                                 , proof follows directly from the construction process.□

Note that, due to the priority scheme that enforces that 
                              T
                              
                                 
                                    S
                                 
                                 
                                    A
                                 
                              
                            has priority over 
                              T
                              
                                 
                                    S
                                 
                                 
                                    B
                                 
                              
                           , the parallel composition operation is not commutative.

Finally, we define the transition systems for routine implementations and routine calls. The transition systems use a queue 
                           q
                         of calls to allow multiple calls, and a variable 
                           c
                           u
                           r
                           r
                         to represent the current call. These variables are used to synchronize the call with the execution of the routine. Note that, although the call semantics allows for multiple calls to be initiated, a call must wait until the previous call has finished. Thus, routines are not reentrant.
                           
                              
                                 
                                 
                                    
                                       Let
                                    
                                    
                                       
                                          ROUTINE 
                                          rout() BEGIN
                                       
                                    
                                    
                                       
                                          
                                          
                                          B
                                       
                                    
                                    
                                       
                                          END 
                                          rout
                                       
                                    
                                 
                              
                           
                        be a routine implementation in a component with a body 
                           B
                         with 
                           T
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                           =
                           
                              〈
                              
                                 
                                    
                                       V
                                    
                                    
                                       B
                                    
                                 
                                 ,
                                 
                                    
                                       S
                                    
                                    
                                       B
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       B
                                    
                                    
                                       f
                                    
                                 
                                 ,
                                 
                                    
                                       L
                                    
                                    
                                       B
                                    
                                 
                                 ,
                                 
                                    
                                       T
                                    
                                    
                                       B
                                    
                                 
                              
                              〉
                           
                           
                         being the transition system for 
                           B
                        . The transition system for the routine is defined by inlining 
                           T
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                         into the transition system 
                           T
                           
                              
                                 S
                              
                              
                                 R
                              
                           
                           .
                        
                        
                           
                              
                                 T
                                 
                                    
                                       S
                                    
                                    
                                       B
                                    
                                 
                                 
                                 
                                    
                                       >
                                    
                                    
                                       
                                          
                                             S
                                          
                                          
                                             R
                                          
                                          
                                             e
                                          
                                       
                                    
                                    
                                       
                                          
                                             S
                                          
                                          
                                             R
                                          
                                          
                                             b
                                          
                                       
                                    
                                 
                                 
                                 T
                                 
                                    
                                       S
                                    
                                    
                                       R
                                    
                                 
                                 ,
                              
                           
                        where 
                           T
                           
                              
                                 S
                              
                              
                                 R
                              
                           
                           
                        encodes the entry and return as follows (see 
                        Fig. 20(a)):
                           
                              
                                 T
                                 
                                    
                                       S
                                    
                                    
                                       R
                                    
                                 
                                 =
                                 <
                                 
                                    
                                       V
                                    
                                    
                                       R
                                    
                                 
                                 ,
                                 ∅
                                 ,
                                 ∅
                                 ,
                                 
                                    
                                       S
                                    
                                    
                                       R
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       f
                                    
                                 
                                 ,
                                 
                                    
                                       L
                                    
                                    
                                       R
                                    
                                 
                                 ,
                                 
                                    
                                       T
                                    
                                    
                                       R
                                    
                                 
                                 >
                                 
                              
                           
                        with
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       R
                                    
                                 
                                 =
                                 {
                                 q
                                 ,
                                 c
                                 u
                                 r
                                 r
                                 }
                                 ,
                                 
                                    
                                       S
                                    
                                    
                                       R
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       f
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       w
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       e
                                    
                                 
                                 }
                                 ,
                                 
                                    
                                       L
                                    
                                    
                                       R
                                    
                                 
                                 =
                                 
                                 {
                                 [
                                 ¬
                                 q
                                 .
                                 e
                                 m
                                 p
                                 t
                                 y
                                 ]
                                 °
                                 c
                                 u
                                 r
                                 r
                                 :
                                 q
                                 .
                                 f
                                 i
                                 r
                                 s
                                 t
                                 °
                                 q
                                 :
                                 =
                                 q
                                 .
                                 d
                                 e
                                 q
                                 u
                                 e
                                 ,
                                 c
                                 u
                                 r
                                 r
                                 :
                                 =
                                 NULL
                                 }
                                 ,
                                 
                                 and
                                 
                                    
                                       T
                                    
                                    
                                       R
                                    
                                 
                                 
                                 =
                                 
                                 {
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 ε
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       w
                                    
                                 
                                 )
                                 ,
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       w
                                    
                                 
                                 ,
                                 
                                 
                                    [
                                    
                                       ¬
                                       q
                                       .
                                       e
                                       m
                                       p
                                       t
                                       y
                                    
                                    ]
                                 
                                 
                                 °
                                 c
                                 u
                                 r
                                 r
                                 :
                                 q
                                 .
                                 f
                                 i
                                 r
                                 s
                                 t
                                 
                                 °
                                 q
                                 :
                                 =
                                 q
                                 .
                                 d
                                 e
                                 q
                                 u
                                 e
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 )
                                 ,
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       e
                                    
                                 
                                 ,
                                 c
                                 u
                                 r
                                 r
                                 :
                                 =
                                 NULL
                                 ,
                                 
                                 
                                    
                                       s
                                    
                                    
                                       R
                                    
                                    
                                       w
                                    
                                 
                                 )
                                 }
                                 .
                              
                           
                        
                     

This means that the transition system waits until the queue is not empty (i.e., a call has arrived). It stores the next call as its current call 
                           c
                           u
                           r
                           r
                        . At this point, the inlined transition systems 
                           T
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                         is executed, and after finishing, the current call 
                           c
                           u
                           r
                           r
                         is reset to NULL, and the process is repeated.

A transition system is created for every instance of the component. We denote the transition system for routine 
                           r
                           o
                           u
                           t
                         in component instance 
                           c
                           o
                           m
                           p
                         as 
                           c
                           o
                           m
                           p
                           .
                           r
                           o
                           u
                           t
                        .

A routine call


                           comp.rout();

of a routine 
                              r
                              o
                              u
                              t
                            in subcomponent instance 
                              c
                              o
                              m
                              p
                            defines a transition system (see Fig. 20(b))
                              
                                 
                                    T
                                    
                                       
                                          S
                                       
                                       
                                          C
                                       
                                    
                                    =
                                    
                                       〈
                                       
                                          
                                             
                                                V
                                             
                                             
                                                R
                                             
                                          
                                          ,
                                          ∅
                                          ,
                                          ∅
                                          ,
                                          
                                             
                                                S
                                             
                                             
                                                C
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                C
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                C
                                             
                                             
                                                f
                                             
                                          
                                          ,
                                          
                                             
                                                L
                                             
                                             
                                                C
                                             
                                          
                                          ,
                                          
                                             
                                                T
                                             
                                             
                                                C
                                             
                                          
                                       
                                       〉
                                    
                                 
                              
                           with
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      R
                                                   
                                                
                                                =
                                                {
                                                c
                                                o
                                                m
                                                p
                                                .
                                                r
                                                o
                                                u
                                                t
                                                .
                                                q
                                                ,
                                                
                                                c
                                                o
                                                m
                                                p
                                                .
                                                r
                                                o
                                                u
                                                t
                                                .
                                                c
                                                u
                                                r
                                                r
                                                }
                                                ,
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      C
                                                   
                                                
                                                =
                                                {
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      C
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      C
                                                   
                                                   
                                                      c
                                                   
                                                
                                                ,
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      C
                                                   
                                                   
                                                      r
                                                   
                                                
                                                ,
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      C
                                                   
                                                   
                                                      f
                                                   
                                                
                                                }
                                                ,
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      C
                                                   
                                                
                                                =
                                                {
                                                c
                                                o
                                                m
                                                p
                                                .
                                                r
                                                o
                                                u
                                                t
                                                .
                                                q
                                                :
                                                
                                                =
                                                c
                                                o
                                                m
                                                p
                                                .
                                                r
                                                o
                                                u
                                                t
                                                .
                                                q
                                                .
                                                e
                                                n
                                                q
                                                u
                                                e
                                                (
                                                t
                                                h
                                                i
                                                s
                                                )
                                                ,
                                                [
                                                c
                                                o
                                                m
                                                p
                                                .
                                                r
                                                o
                                                u
                                                t
                                                .
                                                c
                                                u
                                                r
                                                r
                                                =
                                                t
                                                h
                                                i
                                                s
                                                ]
                                                ,
                                                [
                                                c
                                                o
                                                m
                                                p
                                                .
                                                r
                                                o
                                                u
                                                t
                                                .
                                                c
                                                u
                                                r
                                                r
                                                
                                                ≠
                                                t
                                                h
                                                i
                                                s
                                                ]
                                                }
                                                ,
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  T
                                                               
                                                               
                                                                  C
                                                               
                                                            
                                                            =
                                                            
                                                            {
                                                            (
                                                            
                                                               
                                                                  s
                                                               
                                                               
                                                                  C
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            c
                                                            o
                                                            m
                                                            p
                                                            .
                                                            r
                                                            o
                                                            u
                                                            t
                                                            .
                                                            q
                                                            .
                                                            e
                                                            n
                                                            q
                                                            u
                                                            e
                                                            (
                                                            t
                                                            h
                                                            i
                                                            s
                                                            )
                                                            ,
                                                            
                                                               
                                                                  s
                                                               
                                                               
                                                                  C
                                                               
                                                               
                                                                  c
                                                               
                                                            
                                                            )
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  s
                                                               
                                                               
                                                                  C
                                                               
                                                               
                                                                  c
                                                               
                                                            
                                                            ,
                                                            [
                                                            c
                                                            o
                                                            m
                                                            p
                                                            .
                                                            r
                                                            o
                                                            u
                                                            t
                                                            .
                                                            c
                                                            u
                                                            r
                                                            r
                                                            =
                                                            t
                                                            h
                                                            i
                                                            s
                                                            ]
                                                            ,
                                                            
                                                               
                                                                  s
                                                               
                                                               
                                                                  C
                                                               
                                                               
                                                                  r
                                                               
                                                            
                                                            )
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  s
                                                               
                                                               
                                                                  C
                                                               
                                                               
                                                                  r
                                                               
                                                            
                                                            ,
                                                            [
                                                            c
                                                            o
                                                            m
                                                            p
                                                            .
                                                            r
                                                            o
                                                            u
                                                            t
                                                            .
                                                            c
                                                            u
                                                            r
                                                            r
                                                            
                                                            ≠
                                                            t
                                                            h
                                                            i
                                                            s
                                                            ]
                                                            ,
                                                            
                                                               
                                                                  s
                                                               
                                                               
                                                                  C
                                                               
                                                               
                                                                  f
                                                               
                                                            
                                                            )
                                                            }
                                                            ,
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              c
                              o
                              m
                              p
                              .
                              r
                              o
                              u
                              t
                            represents the transition function of subcomponent 
                              c
                              o
                              m
                              p
                              ,
                            and 
                              t
                              h
                              i
                              s
                            uniquely represents this call. Note that the first transition enqueues 
                              t
                              h
                              i
                              s
                            in the queue 
                              c
                              o
                              m
                              p
                              .
                              r
                              o
                              u
                              t
                              .
                              q
                            of the routine, the second transition waits until the routine accepts the call and sets 
                              t
                              h
                              i
                              s
                            as the running call 
                              c
                              o
                              m
                              p
                              .
                              r
                              o
                              u
                              t
                              .
                              c
                              u
                              r
                              r
                           , and the third transition waits for the running call to be reset, which signifies the return of the call.

We implemented a compiler which reads a fully configured Monaco program – that is, a program with all components instantiated, their parameters set, and the subcomponent tree configured – from which it creates a C++ program which can then be executed by a run-time system. The Monaco compiler resembles the construction process for transition system as presented above. In particular, it creates objects representing the transition systems for each routine and each individual component instance which then contain state objects for the states of the transition system. The state object contains a pointer to a compiled C++ function which encodes all transitions originating from that state. The C++ function returns the next state object or null if no transition can trigger. Note, that the C++ function implements the 
                           s
                           a
                           t
                        , 
                           e
                           x
                           e
                           c
                         and 
                           o
                           u
                           t
                           p
                           u
                           t
                         operations of the labels of all transitions originating from a state. 
                        Fig. 21 illustrates the approach schematically for transitions from a state 
                           
                              
                                 s
                              
                              w
                           
                         corresponding to a statement WAIT w;. The block of this statement is guarded by a ON condition. Therefore there is a transition from 
                           
                              
                                 s
                              
                              w
                           
                         to 
                           
                              
                                 s
                              
                              x
                           
                         with label 
                           [
                           c
                           ]
                           g
                           ;
                        . Then there are two transitions with [w] being the triggering condition. Additionally the labels are prefixed with condition 
                           [
                           ¬
                           c
                           ]
                         guaranteeing that the ON condition is not satisfied. The IF statement testing condition 
                           d
                         results in two transitions, one with condition [d] and the other with 
                           [
                           ¬
                           d
                           ]
                         with two different labels and follow up states. The C++ function for this code is shown in Fig. 21(c). Note that the ON condition 
                           c
                         is tested first and only if this is not satisfied (i.e., condition 
                           [
                           ¬
                           c
                           ]
                         holds) condition 
                           w
                         is tested. When condition 
                           w
                         is satisfied, it returns either state 
                           
                              
                                 s
                              
                              v
                           
                         or 
                           
                              
                                 s
                              
                              u
                           
                         and executes 
                           a
                           ;
                           e
                           ;
                         or 
                           a
                           ;
                           f
                           ;
                        , depending on condition 
                           d
                        . If neither 
                           c
                         nor 
                           w
                         are satisfied, the function returns 
                           n
                           u
                           l
                           l
                        , indicating that no transition is possible.

Note that, if the first triggering condition is satisfied, it is guaranteed that one of the transitions can be executed. The reason is that conditions which occur after imperative code in labels always come from conditional branches and not from blocking statements. So, if there is a transition with label with a condition after some imperative code, like the condition 
                           [
                           d
                           ]
                         in the example, there will be an equivalent transition with same beginning and with the negation of the condition, e.g., 
                           [
                           ¬
                           d
                           ]
                        . So both transitions can be encoded in a C++ function with equal beginning and then a branch on that condition.

The run-time system uses a current state list and current time variable 
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                         and starts with an initial value assignment for internal variables. The current state list contains all currently active states. It starts by putting the initial states of the transition systems of routines into the current state list. Then the run-time system works in a cyclic mode with a fixed cycle period (1ms by default). First, it will receive new input values from the hardware interface or lower-level control layer and provides those as input value assignments 
                           
                              
                                 α
                              
                              
                                 I
                              
                           
                           (
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           )
                         to the Monaco program. Note that those values get frozen for the execution cycle. Then it iterates through the current state list and executes the transition functions of the states. When the transition function returns a non-null next state, the current state is removed from the state list and replaced with the next. Scanning of the current state list restarts from the beginning until no transition returns a non-null next state. This is the point to advance the time and repeat.
                           
                              
                                 
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    
                                 :=0

initialize variables values 
                                    
                                       
                                          α
                                       
                                       
                                          V
                                       
                                    
                                    (
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              

current_states +=initial states of transitions systems of routines

loop


                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          I
                                       
                                    
                                    (
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                 take over variable values from lower control layer


                                 do


                                 
                                 next:=null


                                 
                                 for state in current_states while next =null


                                 
                                 
                                 next:=state.transition()


                                 
                                 
                                 if (next!=null)


                                 
                                 
                                 
                                 current_states −=state


                                 
                                 
                                 
                                 current_states +=next


                                 
                                 until (next =null)


                                 
                                 
                                 
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                 :=
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                 + cycle_period


                                 end_loop

The PARALLEL statements are treated slightly differently by the compiler and run-time system than defined in the formal definition. Actually the interleaving of states of parallel code blocks is not performed explicitly but generated by executing the code blocks in parallel threads. 
                        Fig. 22 illustrates the approach: (1) the threads start immediately executing code 
                           
                              
                                 l
                              
                              
                                 A
                              
                              
                                 i
                                 x
                              
                           
                        and 
                           
                              
                                 l
                              
                              
                                 B
                              
                              
                                 i
                                 u
                              
                           
                         (in that order) and run to the first blocking states 
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 x
                              
                           
                         and 
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 u
                              
                           
                        ; this corresponds to transition from 
                           (
                           (
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 i
                              
                           
                           )
                           ,
                           
                              
                                 l
                              
                              
                                 A
                              
                              
                                 i
                                 x
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 B
                              
                              
                                 i
                                 u
                              
                           
                           ,
                           (
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 x
                              
                           
                           ,
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 u
                              
                           
                           )
                           )
                         in the parallel interleaving. (2) Let us assume then that 
                           
                              
                                 l
                              
                              
                                 A
                              
                              
                                 x
                                 y
                              
                           
                         is not statisfied but 
                           
                              
                                 l
                              
                              
                                 B
                              
                              
                                 u
                                 v
                              
                           
                         is. So 
                           T
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                         transits to 
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 v
                              
                           
                         executing 
                           
                              
                                 l
                              
                              
                                 B
                              
                              
                                 u
                                 v
                              
                           
                         which corresponds to state transition to 
                           (
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 x
                              
                           
                           ,
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 v
                              
                           
                           )
                        . Note, that transitions in the two parallel threads are tested and executed in the order 
                           T
                           
                              
                                 S
                              
                              
                                 A
                              
                           
                         before 
                           T
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                        . This guarantees that, when transition 
                           
                              
                                 l
                              
                              
                                 B
                              
                              
                                 u
                                 v
                              
                           
                         in 
                           T
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                         is tested, transition 
                           
                              
                                 l
                              
                              
                                 A
                              
                              
                                 x
                                 y
                              
                           
                         is not satisfied and hence 
                           ¬
                           (
                           s
                           a
                           t
                           
                           
                              
                                 l
                              
                              
                                 A
                              
                              
                                 x
                                 y
                              
                           
                           )
                         already holds, which exactly corresponds to the label 
                           n
                           o
                           t
                           
                           
                              
                                 l
                              
                              
                                 A
                              
                              
                                 x
                                 y
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 B
                              
                              
                                 u
                                 v
                              
                           
                         in the parallel interleaving.

We developed and tested the language on the basis of a set of typical examples, ranging from simple machines to small manufacturing cells. In particular, we re-implemented two existing automation solutions from our industrial partner which are both currently implemented in the IEC 61131-3 [19] languages Structured Text and Sequential Function Chart as SoftPLC applications running on industrial PCs with a real-time operating system extension. The first is an automation solution for an injection molding machine. The example in Section 3 was taken from this system. The other is an existing solution for the paint supply system of a painting robot used in the automotive industry. Both are typical SoftPLC solutions from the domain of our industrial partner. In both programs, we covered the event-based reactive part of the systems, connected the applications to a lower-level control system written in IEC 61131-3, and tested the applications with systems simulating the machine to be controlled.

The results of these two case studies were very encouraging. Our code was a fraction of the length of the original. The original injection molding solution has in total more than 30,000 lines of code (Structured Text), of which about a quarter (conservative estimate) is for the purely reactive control part. Our solution has exactly 942 lines of code. The abstract control part for the paint supply system typically consists of over 20 medium-sized Sequential Function Charts plus several time-based programs (a proprietary programming model is used in this type of solution). Our Monaco program has 1403 lines of code.

These two case studies showed that two features of the Monaco language are particularly helpful: the hierarchical component approach and the exception handling approach with ON handlers. Unsurprisingly, hierarchical component structuring is more appropriate when the machine has a clear hierarchical structure. Although the hierarchical structure was clearer in the injection molding application, the paint supply system also had a clear hierarchical structure, but with stronger coupling between sibling components. We have found exception handling to be critical and difficult to express. In the original applications, the greater part of the code checked for and reacted to exceptional situations and was extremely difficult to understand. This was considerably simpler with ON statements in Monaco. Moreover, Monaco allows all conceivable exceptions to be expressed concisely, which was not possible, for example, using the Sequential Function Chart language of the IEC 61131-3.

The Monaco applications are intended to run in a real-time setting as part of a hard real-time process controller solution. We therefore tested the performance of the run-time system. 
                     Fig. 23 shows the results from run-time measurements conducted for the paint supply application. The cycle time is about 5–25μs (the current application runs with a cycle period of 4ms) and very stable. Note the two peaks in the measurements: The first peak, with a median value of 10μs, represents cycles in which no transition occurs, while the second peak, with a cycle time of about 20μs, represents cycles with a transition.

@&#RELATED WORK@&#

The design of the Monaco language was influenced by several languages and tools for reactive embedded system modeling and programming, most notably by the Statecharts formalism [11] and related systems [14,21], the synchronous languages Esterel 
                     [22] and its derivatives [23–25], and the UML/RT [12] and other component-based modeling approaches [19,26–29].

The Statecharts formalism [11] and implementations such as AnyLogic (www.xjtek.com) and Rhapsody (www.ilogix.com) were the primary influences on the Monaco language. As outlined in Section 2, Monaco has statements which are analogous to Statecharts OR and AND states. However, Monaco is more restrictive in terms of control flow: Monaco enforces a hierarchical block structure with lexical scoping, and arbitrary program jumps (gotos) are prohibited (which are possible in Statecharts because no restrictions are defined for source and destination states of transitions).

The main difference between Monaco and Statecharts is the imperative notation. Monaco could be considered an imperative version of a core subset of Statecharts. We argue that its imperative notation makes Monaco programs more suitable for domain experts, who, in our experience, are not used to thinking in terms of states and state transitions, but usually perceive control behavior as coordinated sequences of machine operations.

A second important influence was Esterel [22], which is a synchronous language [23,24], with an imperative syntax for describing event-based reactive control of embedded systems. Esterel programs consist of collections of nested threads which communicate exclusively via event signals. As a novel feature, Esterel has introduced statements for preemption and exception handling.


                        Monaco is related to Esterel because both are imperative languages for reactive control programming. The WAIT, PARALLEL, and ON statements of Monaco have semantics similar to the await, par and abort statements of Esterel. Further, the execution model is similar to those of Esterel and the SugarCubes [30] and Junior [31] systems (which are synchronous machine implementations strongly influenced by Esterel).

However, Monaco also differs significantly from Esterel and its derivatives in many respects. First, Monaco's event handling is much more general. In Esterel, thread communication and event synchronization is possible exclusively via signals. In Monaco, any Boolean expression can be used to specify an event trigger. We argue that this is an important enhancement which makes control programming much simpler and more user-friendly. Moreover, Monaco's syntax is simpler than Esterel's. It has fewer control structures and shows stronger similarities to common imperative programming languages.

Our component approach has been strongly influenced by UML/RT [18] and comparable component approaches for embedded systems (e.g., [19,28,32,33]). The main difference to these component approaches is that in Monaco communication is between higher-level and lower-level components. In the more traditional approaches, components are coupled by connecting input and output ports, that is, components at the same hierarchy level are connected. Although components can be arranged in a hierarchical manner, communication between components is not hierarchical. Moreover, in most approaches, components can only communicate via simple signals, whereas Monaco uses synchronous routine calls. We argue that the parent–child communication structures supported by the Monaco language are an important feature of our approach which facilitates the required hierarchical abstraction and simplification of control programs.

Furthermore, our hierarchical communication scheme shows similarities to hierarchical scheduling schemes for real-time systems that have recently emerged [26,27,34]. Similar to our approach, they employ event-based methods for modeling control of task execution in a hierarchical manner. However, their focus is on task scheduling issues, and only limited language support is provided. Our approach concentrates on language expressiveness and does not currently address task scheduling in the lower control layers, which is assumed to be handled within the lower control layers.

In this paper, we have presented the domain-specific language Monaco and its visual programming environment and have given a formal definition of the semantics in the form of labeled transition systems. We have discussed the objectives of the language, the main design decisions, and the most important language features. The main focus of the language is to bring reactive control programming closer to the perceptions of domain experts. We regard the language features of Monaco, in particular it’s imperative notation, its hierarchical component and communication architecture for control abstraction, the asynchronous event handling mechanism, and the static nature of Monaco programs as important features that make such an approach feasible.

It is also important to note what has been omitted from the Monaco language. For example, Monaco is intentionally not object-oriented. Language features such as inheritance and dynamic binding are well accepted as powerful, high-level programming concepts. However, they introduce a complexity which conflicts with the requirements of making programming capabilities accessible to domain experts. For similar reasons, Monaco does not support pointers, references, and a new operator (component instantiation can only be done at setup time).

The Monaco language is the core of a larger research project with the overall goal of making machine control programming more reliable and more adequate for domain experts and to give even end users limited programming capabilities. An important extension to Monaco will be the support of dynamic interface contracts and their use in guiding and constraining domain experts [35]. The idea is simple: dynamic contracts will define valid orders of operations and the legal feedback of a component defined in the form of finite state automata. A component must guarantee that it will not violate the contracts of its subcomponents. This allows static checking that a sequence of operations is correct and will result in a semantically meaningful and complete program. In [35], an approach was presented in which such contracts are checked in a modular hierarchical verification approach, and the results are used to support domain experts in online semantic assistance tools.

@&#ACKNOWLEDGMENTS@&#

This work was conducted in cooperation with Keba AG, Austria, and was supported by the Christian Doppler Forschungsgesellschaft, Austria.

Associativity of the append operator, i.e., 
                           (
                           T
                           S
                           
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                           )
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                           =
                           (
                           T
                           S
                           
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                           )
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                         if 
                           
                              
                                 s
                              
                              a
                           
                           ≠
                           
                              
                                 s
                              
                              b
                           
                           ≠
                           
                              
                                 s
                              
                              c
                           
                           ≠
                           
                              
                                 s
                              
                              d
                           
                        , can be proved by showing that in both application orders the resulting transition systems will be equal. This is trivial for a set of states, since from the laws of set theory it follows that
                           
                              
                                 (
                                 S
                                 
                                 â§¹
                                 {
                                 
                                    
                                       s
                                    
                                    a
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    b
                                 
                                 }
                                 
                                 )
                                 \
                                 {
                                 
                                    
                                       s
                                    
                                    c
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    d
                                 
                                 }
                                 =
                                 (
                                 S
                                 
                                 \
                                 {
                                 
                                    
                                       s
                                    
                                    c
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    d
                                 
                                 }
                                 )
                                 \
                                 {
                                 
                                    
                                       s
                                    
                                    a
                                 
                                 ,
                                 
                                 
                                    
                                       s
                                    
                                    b
                                 
                                 }
                                 ,
                              
                           
                        and initial state 
                           
                              
                                 s
                              
                              i
                           
                         and final state 
                           
                              
                                 s
                              
                              f
                           
                         remain the same.

In order to show that the resulting transition relation will be equal in both cases, we must show that 
                           (
                           T
                           S
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                           )
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                         and 
                           (
                           T
                           S
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                           )
                           
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                         will contain the same transitions. Let us assume first that the system does not contain direct transitions 
                           (
                           
                              
                                 s
                              
                              b
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              c
                           
                           )
                         from 
                           
                              
                                 s
                              
                              b
                           
                         to 
                           
                              
                                 s
                              
                              c
                           
                         or 
                           (
                           
                              
                                 s
                              
                              d
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 d
                                 a
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              a
                           
                           )
                         from 
                           
                              
                                 s
                              
                              d
                           
                         to 
                           
                              
                                 s
                              
                              a
                           
                         (this means that there are no dependencies between operations 
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                         and 
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                        ). According to the definition of the append operator 
                           T
                           S
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                           ,
                        transitions 
                           (
                           
                              
                                 s
                              
                              x
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 x
                                 a
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              a
                           
                           )
                         and transitions 
                           (
                           
                              
                                 s
                              
                              b
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 b
                                 y
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              y
                           
                           )
                         are then replaced with transitions 
                           (
                           
                              
                                 s
                              
                              x
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 x
                                 a
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 b
                                 y
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              y
                           
                           )
                           ,
                         but since 
                           
                              
                                 s
                              
                              a
                           
                           ≠
                           
                              
                                 s
                              
                              b
                           
                           ≠
                           
                              
                                 s
                              
                              c
                           
                           ≠
                           
                              
                                 s
                              
                              d
                           
                           ,
                         all other transitions in 
                           T
                           S
                        , in particular transitions 
                           (
                           
                              
                                 s
                              
                              u
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 u
                                 c
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              c
                           
                           )
                         and 
                           (
                           
                              
                                 s
                              
                              
                                 u
                                 d
                              
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 d
                                 v
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              v
                           
                           )
                        , are carried over unchanged into 
                           T
                           S
                           
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                        . If we compose 
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                         to the result of 
                           T
                           S
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                        , then transitions 
                           (
                           
                              
                                 s
                              
                              u
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 u
                                 c
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              c
                           
                           )
                         and 
                           (
                           
                              
                                 s
                              
                              
                                 u
                                 d
                              
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 d
                                 v
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              v
                           
                           )
                         are replaced with 
                           (
                           
                              
                                 s
                              
                              u
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 u
                                 c
                              
                           
                           °
                           
                           
                              
                                 l
                              
                              
                                 d
                                 v
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              v
                           
                           )
                           ,
                         and all other transitions are carried over unchanged. The same reasoning applies to building 
                           (
                           T
                           S
                           
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                           )
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                           ,
                         showing that both results are equal.

Direct transitions 
                           (
                           
                              
                                 s
                              
                              b
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              c
                           
                           )
                         from 
                           
                              
                                 s
                              
                              b
                           
                         to 
                           
                              
                                 s
                              
                              c
                           
                         are replaced differently. Building 
                           T
                           S
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                        first replaces transition 
                           (
                           
                              
                                 s
                              
                              b
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              c
                           
                           )
                         with transition 
                           (
                           
                              
                                 s
                              
                              x
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 x
                                 a
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              c
                           
                           )
                         for all transitions 
                           (
                           
                              
                                 s
                              
                              x
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 x
                                 a
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              a
                           
                           )
                        . Building 
                           (
                           T
                           S
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                           )
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                         then replaces 
                           (
                           
                              
                                 s
                              
                              x
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 x
                                 a
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              c
                           
                           )
                         with transition 
                           (
                           
                              
                                 s
                              
                              x
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 x
                                 a
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 d
                                 y
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              y
                           
                           )
                         for all transitions 
                           (
                           
                              
                                 s
                              
                              d
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 d
                                 y
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              y
                           
                           )
                        . If we build
                           
                           T
                           S
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                         first, then transition 
                           (
                           
                              
                                 s
                              
                              b
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              c
                           
                           )
                         is replaced with transition 
                           (
                           
                              
                                 s
                              
                              b
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 d
                                 y
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              y
                           
                           )
                         for all transitions 
                           (
                           
                              
                                 s
                              
                              d
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 d
                                 y
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              d
                           
                           )
                        . Building 
                           (
                           T
                           S
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    d
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    c
                                 
                              
                           
                           )
                           
                              
                                 ~
                              
                              
                                 
                                    
                                       s
                                    
                                    b
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    a
                                 
                              
                           
                         then replaces 
                           (
                           
                              
                                 s
                              
                              b
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 d
                                 y
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              y
                           
                           )
                         with transition 
                           (
                           
                              
                                 s
                              
                              x
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 x
                                 a
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 b
                                 c
                              
                           
                           °
                           
                              
                                 l
                              
                              
                                 d
                                 y
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              y
                           
                           )
                         for all transitions 
                           (
                           
                              
                                 s
                              
                              x
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 x
                                 a
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              a
                           
                           )
                        . The same reasoning applies to direct transitions 
                           (
                           
                              
                                 s
                              
                              d
                           
                           ,
                           
                           
                              
                                 l
                              
                              
                                 d
                                 a
                              
                           
                           ,
                           
                           
                              
                                 s
                              
                              a
                           
                           )
                         from 
                           
                              
                                 s
                              
                              d
                           
                         to 
                           
                              
                                 s
                              
                              a
                           
                        . Thus, the resulting transitions are equal.□

The proof works by showing that the union systems 
                           
                           T
                           
                              
                                 S
                              
                              
                                 (
                                 A
                                 +
                                 B
                                 )
                                 +
                                 C
                                 
                              
                           
                         and 
                           
                           T
                           
                              
                                 S
                              
                              
                                 A
                                 +
                                 (
                                 B
                                 +
                                 C
                                 )
                              
                           
                         are equal. Then, as 
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 i
                              
                           
                           
                           ≠
                        
                        
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 f
                              
                           
                           ≠
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 i
                              
                           
                           ≠
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 f
                              
                           
                           ≠
                           
                              
                                 s
                              
                              
                                 C
                              
                              
                                 i
                              
                           
                           ,
                         we can rely on the associativity of the append operator, and it directly follows that 
                           (
                           T
                           
                              
                                 S
                              
                              
                                 A
                              
                           
                           →
                           T
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                           )
                           →
                           T
                           
                              
                                 S
                              
                              
                                 C
                              
                           
                         =
                           T
                           
                              
                                 S
                              
                              
                                 A
                              
                           
                           →
                           (
                           T
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                           →
                           T
                           
                              
                                 S
                              
                              
                                 C
                              
                           
                           )
                           .
                        
                     

Hence, it is sufficient to show that 
                           
                           T
                           
                              
                                 S
                              
                              
                                 (
                                 A
                                 +
                                 B
                                 )
                                 +
                                 C
                                 
                              
                           
                           =
                           T
                           
                              
                                 S
                              
                              
                                 A
                                 +
                                 (
                                 B
                                 +
                                 C
                                 )
                              
                           
                        . From the associativity of set union it follows that 
                           (
                           
                              
                                 S
                              
                              
                                 A
                              
                           
                           
                           ∪
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                           )
                           ∪
                           
                              
                                 S
                              
                              
                                 C
                              
                           
                           =
                           
                              
                                 S
                              
                              
                                 A
                              
                           
                           
                           ∪
                           (
                           
                              
                                 S
                              
                              
                                 B
                              
                           
                           ∪
                           
                              
                                 S
                              
                              
                                 C
                              
                           
                           )
                        , 
                           (
                           
                              
                                 L
                              
                              
                                 A
                              
                           
                           ∪
                           
                              
                                 L
                              
                              
                                 B
                              
                           
                           )
                           
                           ∪
                           
                              
                                 L
                              
                              
                                 C
                              
                           
                           =
                           
                              
                                 L
                              
                              
                                 A
                              
                           
                           ∪
                           (
                           
                              
                                 L
                              
                              
                                 B
                              
                           
                           ∪
                           
                              
                                 L
                              
                              
                                 B
                              
                           
                           )
                        , and 
                           (
                           
                              
                                 T
                              
                              
                                 A
                              
                           
                           ∪
                           
                              
                                 T
                              
                              
                                 B
                              
                           
                           )
                           ∪
                           
                              
                                 T
                              
                              
                                 C
                              
                           
                           =
                           
                              
                                 T
                              
                              
                                 A
                              
                           
                           ∪
                           (
                           
                              
                                 T
                              
                              
                                 B
                              
                           
                           ∪
                           
                              
                                 T
                              
                              
                                 B
                              
                           
                           )
                        . From the definition of the initial state it follows that 
                           
                              
                                 s
                              
                              
                                 A
                                 +
                                 B
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 i
                              
                           
                        , and thus 
                           
                              
                                 s
                              
                              
                                 (
                                 A
                                 +
                                 B
                                 )
                                 +
                                 C
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 s
                              
                              
                                 B
                                 +
                                 C
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 i
                              
                           
                         and 
                           
                              
                                 s
                              
                              
                                 (
                                 A
                                 +
                                 B
                                 )
                                 +
                                 C
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 A
                              
                              
                                 i
                              
                           
                        . From the definition of the final state it follows that 
                           
                              
                                 s
                              
                              
                                 A
                                 +
                                 B
                              
                              
                                 f
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 B
                              
                              
                                 f
                              
                           
                         and 
                           
                              
                                 s
                              
                              
                                 (
                                 A
                                 +
                                 B
                                 )
                                 +
                                 C
                              
                              
                                 f
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 C
                              
                              
                                 f
                              
                           
                         and 
                           
                              
                                 s
                              
                              
                                 B
                                 +
                                 C
                              
                              
                                 f
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 C
                              
                              
                                 f
                              
                           
                         and 
                           
                              
                                 s
                              
                              
                                 A
                                 +
                                 (
                                 B
                                 +
                                 C
                                 )
                              
                              
                                 f
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 C
                              
                              
                                 f
                              
                           
                        . Hence, 
                           
                           T
                           
                              
                                 S
                              
                              
                                 (
                                 A
                                 +
                                 B
                                 )
                                 +
                                 C
                                 
                              
                           
                           =
                           
                           T
                           
                              
                                 S
                              
                              
                                 A
                                 +
                                 (
                                 B
                                 +
                                 C
                                 )
                              
                           
                        .□

Proving that 
                           T
                           
                              
                                 S
                              
                              
                                 I
                                 2
                              
                           
                           
                              
                                 >
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                    
                                       e
                                       2
                                    
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                    
                                       b
                                       2
                                    
                                 
                              
                           
                           (
                           T
                           
                              
                                 S
                              
                              
                                 I
                                 1
                              
                           
                           
                              
                                 >
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                    
                                       e
                                       1
                                    
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                    
                                       b
                                       1
                                    
                                 
                              
                           
                           T
                           
                              
                                 S
                              
                              
                                 T
                              
                           
                           )
                           =
                           
                           T
                           
                              
                                 S
                              
                              
                                 I
                                 1
                              
                           
                           
                              
                                 >
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                    
                                       e
                                       1
                                    
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                    
                                       b
                                       1
                                    
                                 
                              
                           
                           (
                           T
                           
                              
                                 S
                              
                              
                                 I
                                 2
                              
                           
                           
                              
                                 >
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                    
                                       e
                                       2
                                    
                                 
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       T
                                    
                                    
                                       b
                                       2
                                    
                                 
                              
                           
                           T
                           
                              
                                 S
                              
                              
                                 T
                              
                           
                           )
                         follows the same line as the proof of the associativity of the sequential composition operator; in particular, it can be shown in the same way as 
                           
                           T
                           
                              
                                 S
                              
                              
                                 (
                                 A
                                 +
                                 B
                                 )
                                 +
                                 C
                              
                           
                           =
                           
                           T
                           
                              
                                 S
                              
                              
                                 A
                                 +
                                 (
                                 B
                                 +
                                 C
                                 )
                              
                           
                         that 
                           
                           T
                           
                              
                                 S
                              
                              
                                 (
                                 A
                                 ⁎
                                 B
                                 )
                                 ⁎
                                 C
                              
                           
                           =
                           
                           T
                           
                              
                                 S
                              
                              
                                 A
                                 ⁎
                                 (
                                 B
                                 ⁎
                                 C
                                 )
                              
                           
                        , because again we have 
                           
                              
                                 s
                              
                              
                                 T
                              
                              
                                 b
                                 1
                              
                           
                           
                           ≠
                        
                        
                           
                              
                                 s
                              
                              
                                 T
                              
                              
                                 b
                                 2
                              
                           
                           ≠
                           
                              
                                 s
                              
                              
                                 T
                              
                              
                                 e
                                 1
                              
                           
                           ≠
                           
                              
                                 s
                              
                              
                                 T
                              
                              
                                 e
                                 2
                              
                           
                           ,
                         and therefore we can rely on the associativity of the append operator.□

@&#REFERENCES@&#

