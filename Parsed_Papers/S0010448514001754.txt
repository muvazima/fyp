@&#MAIN-TITLE@&#Spherical volume-preserving Demons registration

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We introduce a volume-preserving registration framework for brain shift analysis.


                        
                        
                           
                           A volume-preserving mapping is supported by a rigorous continuous theory.


                        
                        
                           
                           The registration is performed on spherical tetrahedron mesh with MRI gray value.


                        
                        
                           
                           The registration can retain the equality of local volume elements.


                        
                        
                           
                           Our method can register the brain efficiently while preserving the volume.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Registration

Brain image

Tetrahedral mesh

Volume-preserving parameterization

@&#ABSTRACT@&#


               
               
                  In order to analyze the brain shift situation accurately, we need to register the medical image and analyze its deformation. In this paper, we introduce a framework with volume-preserving registration for brain shift analysis. First, a volume-preserving mapping is introduced for general manifolds supported by a rigorous continuous theory. The registration is then performed on the spherical tetrahedron mesh with MRI gray values. The registration can retain the equality of local volume elements while registering the manifold to a template at the same time. We use simulated brain shift data to test our method. The results show that our method can efficiently register the brain while preserving the volume of each vertex.
               
            

@&#INTRODUCTION@&#

At present, the increasing use of image-guided surgery systems for neurosurgery has brought to prominence of the problem regarding brain shift, including the deformation of the brain after craniotomy and tumor resection. This phenomenon is caused by various interacting factors such as the characteristics of tissue, the swelling of brain structures, a deformation following gravity, and so on  [1]. Most of the deformation can be considered as a volume-preserving deformation. In consequence, the correspondence of structures identified between the pre-operative image data and the real-time imaging data of the patient’s brain becomes incorrect during the operation. Therefore, the location and the extent of structures are misinterpreted when mapping pre-operative findings into real-time images. Thus, it is of great importance to register and align these images. This topic has recently led to considerable interest in the solid and physics-based modeling as well as medical image analysis communities  [2].

In order to analyze medical image data, a complicated geometric structure from the image data is desired to be mapped onto a canonical domain. Instead of working on the complicated geometry directly, all the operations can be defined on a simpler domain, such as planes and structured grid volumes. The mapping will help improving the efficiency of the data processing. In general, a manifold cannot be mapped to another domain without any distortions. Thus, different mapping methods focus on preserving certain local geometries like angle  [3,4] or area  [5,6]. To date, more and more volumetric measurements are derived from a rich line of multimodal imaging, e.g. neuronal density, activation extent, thickness, etc., so that volume-preserving mapping becomes increasingly important. In 2D domain, to prevent severe geometric stretches, the original model can be decomposed into many charts which are topologically equal to an open disk to make interior Gaussian curvature closed to zero  [7]. Even distribution of intrinsic distortions  [5,7] are studied to achieve uniformity metrics mapping. Based on the singular values of the Jacobian matrix, Sander  [5] optimized the parametric location of each vertex within its 1-ring neighborhood to reduce local stretches. Sorkine et al.’s bounded-distortion mapping  [7] made heavy use of mesh cuts to keep distortions below some preset threshold. They considered 2D area distortion with an energy term. The purpose is to minimize the 2D area distortion. No conclusion is drawn whether an absolute area-preserving patch mapping can be practically achieved. Desbrun et al.  [8] also focused on minimizing area distortion for the intrinsic mapping of triangle meshes. In their work, an intuitive area-preserving functional was devised. Zhao  [9] presents a novel area-preserving flattening method using the optimal mass transport technique based on Monge–Brenier theory. Zou  [6] proposed a theoretical authalic mapping based on the differential forms on 2D manifold by flowing under a Lie advection of area. The aforementioned methods are for 2D general surfaces so far. There also exist many harmonic volumetric mapping techniques among objects  [10].

Image registration is the process of finding the optimal transformation that aligns different imaging data into spatial correspondence. As a result, the same anatomic structures occupy the same spatial locations in different images  [11]. It is the building block for a variety of medical image analysis tasks, such as motion correction, multi-modality information fusion, atlas-based image segmentation, population-based studies, longitudinal studies, computational anatomy and image-guided surgery  [12]. Since most brain shift deformations can be treated as a volume-preserving deformation based on their physical properties, registration with preserving volumetric properties can capture more information of brain deformation, hence achieving a higher accuracy in terms of volume-preserving alignment. However, general manifold volume-preserving mapping with registration was seldom discussed within those mapping methods.

In this paper, we introduce a framework for a volume-preserving registration method based on volume-preserving parameterization. First, a volume-preserving mapping is introduced for general manifolds supported by a rigorous continuous theory. Then, registration is performed based on new Demons metric to preserve local volume elements. We use 12 pairs of simulated brain shift datasets to test our method and compare our method with traditional Demons. The results show that our method can successfully register the deformed and shifted brain while preserving the volume during the registration.

Our framework consists of two major steps. First, we introduce a volume-preserving parameterization to map the mesh into a sphere domain. Then, we conduct the novel volume-preserving Demons registration to register the different meshes.

Given two connected manifolds with the same topology, there are diffeomorphisms between them. Each diffeomorphism is corresponding to a mapping between these meshes. Different mappings have different purposes. They either preserve local geometry or minimize some deformation energy. Consider a three dimension manifold 
                           P
                        , a local volume element is defined on the local coordinates 
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 x
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 x
                              
                              
                                 3
                              
                           
                         as
                           
                              (1)
                              
                                 
                                    
                                       τ
                                    
                                    
                                       P
                                    
                                 
                                 =
                                 
                                    
                                       ρ
                                    
                                    
                                       P
                                    
                                 
                                 
                                    (
                                    x
                                    )
                                 
                                 d
                                 x
                                 ,
                              
                           
                         where 
                           d
                           x
                           =
                           d
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           ∧
                           d
                           
                              
                                 x
                              
                              
                                 2
                              
                           
                           ∧
                           d
                           
                              
                                 x
                              
                              
                                 3
                              
                           
                         and 
                           
                              
                                 ρ
                              
                              
                                 P
                              
                           
                           
                              (
                              x
                              )
                           
                           >
                           0
                         is a volume density function. There exists a diffeomorphism 
                           f
                         which maps 
                           P
                         to another manifold 
                           Q
                        , 
                           f
                           :
                           P
                           →
                           Q
                        . Without loss of generality, the global volume of 
                           Q
                         can be scaled to that of 
                           P
                        , which means 
                           
                              
                                 ∫
                              
                              
                                 P
                              
                           
                           
                              
                                 τ
                              
                              
                                 P
                              
                           
                           =
                           
                              
                                 ∫
                              
                              
                                 Q
                              
                           
                           
                              
                                 τ
                              
                              
                                 Q
                              
                           
                        . After the mapping, the local volume element 
                           
                              
                                 τ
                              
                              
                                 P
                              
                           
                         deforms to 
                           
                              
                                 τ
                              
                              
                                 Q
                              
                           
                        . Suppose there is another diffeomorphism 
                           g
                         which maps 
                           Q
                         to itself, 
                           g
                           :
                           Q
                           →
                           Q
                        . 
                           g
                         also maps the local volume element 
                           
                              
                                 τ
                              
                              
                                 Q
                              
                           
                         to 
                           
                              
                                 τ
                              
                              
                                 Q
                              
                              
                                 ′
                              
                           
                        . If 
                           
                              
                                 τ
                              
                              
                                 P
                              
                           
                           ≡
                           
                              
                                 τ
                              
                              
                                 Q
                              
                              
                                 ′
                              
                           
                         everywhere, 
                           g
                           ∘
                           f
                         is such a diffeomorphism, which maps 
                           P
                         to 
                           Q
                         preserving the local volume. According to Eq. (1), 
                           
                              
                                 τ
                              
                              
                                 P
                              
                           
                           ≡
                           
                              
                                 τ
                              
                              
                                 Q
                              
                              
                                 ′
                              
                           
                         can be converted to 
                           
                              
                                 ρ
                              
                              
                                 Q
                              
                              
                                 ′
                              
                           
                           ≡
                           
                              
                                 ρ
                              
                              
                                 P
                              
                           
                        . 
                           g
                         not only maps 
                           Q
                         to itself, but also maps the volume density back to the original one in 
                           P
                        . This density change in 
                           Q
                         is described as fluid dynamics. Suppose that 
                           Q
                         follows a velocity field 
                           V
                         defined at itself; then the material derivative can be derived from 
                           V
                           :
                           
                              
                                 D
                                 ρ
                              
                              
                                 D
                                 t
                              
                           
                           =
                           ∇
                           ρ
                           ⋅
                           V
                        .

The material derivative describes the density changes along the stream line in 
                           V
                        . Note that, each element moves along the stream line in 
                           V
                        , so that the local density 
                           
                              
                                 ρ
                              
                              
                                 Q
                              
                           
                         changes to 
                           
                              
                                 ρ
                              
                              
                                 P
                              
                           
                        . This change can be interpolated linearly as 
                           ρ
                           
                              (
                              t
                              )
                           
                           =
                           
                              (
                              1
                              −
                              t
                              )
                           
                           
                              
                                 ρ
                              
                              
                                 Q
                              
                           
                           +
                           t
                           
                              
                                 ρ
                              
                              
                                 P
                              
                           
                           ,
                           
                           t
                           ∈
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                        .

Thus, 
                           V
                         must satisfy 
                           
                              (2)
                              
                                 −
                                 
                                    
                                       ρ
                                    
                                    
                                       Q
                                    
                                 
                                 +
                                 
                                    
                                       ρ
                                    
                                    
                                       P
                                    
                                 
                                 =
                                 ∇
                                 ρ
                                 ⋅
                                 V
                                 .
                              
                           
                         In order to solve this equation of 
                           V
                        , we introduce a scalar field 
                           φ
                           
                              (
                              x
                              ,
                              t
                              )
                           
                         such that 
                           V
                           =
                           ∇
                           φ
                        . Then, Eq. (2) is converted into a Poisson equation of 
                           φ
                           
                              (
                              x
                              ,
                              t
                              )
                           
                        : 
                           −
                           
                              
                                 ρ
                              
                              
                                 Q
                              
                           
                           +
                           
                              
                                 ρ
                              
                              
                                 P
                              
                           
                           =
                           −
                           ρ
                           
                              Δ
                           
                           φ
                        .

The Poisson equation has a unique solution. Once the scalar field is solved, the path of each element on 
                           Q
                         is an integral curve 
                           x
                           
                              (
                              t
                              )
                           
                         such that 
                           
                              (3)
                              
                                 
                                    
                                       
                                          d
                                          x
                                          
                                             (
                                             t
                                             )
                                          
                                       
                                       
                                          d
                                          t
                                       
                                    
                                    =
                                    V
                                    
                                       (
                                       x
                                       
                                          (
                                          t
                                          )
                                       
                                       ,
                                       t
                                       )
                                    
                                    ,
                                 
                              
                              
                                 
                                    x
                                    
                                       (
                                       0
                                       )
                                    
                                    =
                                    
                                       
                                          x
                                       
                                       
                                          0
                                       
                                    
                                    ,
                                 
                              
                           
                         where 
                           x
                         is the initial position of the curve. If each element follows the curve 
                           x
                           
                              (
                              t
                              )
                           
                         from 
                           t
                           =
                           0
                         to 
                           t
                           =
                           1
                        , the density 
                           ρ
                         on it changes linearly from 
                           
                              
                                 ρ
                              
                              
                                 Q
                              
                           
                         to 
                           
                              
                                 ρ
                              
                              
                                 P
                              
                           
                        . Since the density is positive, the curve 
                           x
                           
                              (
                              t
                              )
                           
                         yields a desired diffeomorphism 
                           g
                        , and 
                           g
                           ∘
                           f
                           :
                           P
                           →
                           Q
                         is a diffeomorphism which maps manifold 
                           P
                         to 
                           Q
                         with local volume preserved.

Based on the above mathematical derivation, in the discrete condition, we apply an iterative algorithm on those manifolds with discrete representations. Manifolds in 3D can be represented with tetrahedral volume meshes. First, an initial mapping is constructed. Then, the time interval is divided into the discrete time steps for the iteration. At the beginning of each iteration, the current local density is calculated on each vertex. The Poisson equation, Eq. (2), is solved within current time step. All the vertices move a time step along the vector field 
                           V
                         guided by the solved scalar field. The iteration continues for each time step.

Assume that a 3D volume is represented with a tetrahedral mesh 
                           T
                           =
                           
                              {
                              V
                              ,
                              E
                              ,
                              F
                              ,
                              C
                              }
                           
                        , 
                           V
                           =
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              }
                           
                         denotes the vertex set, 
                           E
                           =
                           
                              {
                              
                                 
                                    e
                                 
                                 
                                    i
                                    j
                                 
                              
                              }
                           
                         the edge set, 
                           F
                           =
                           
                              {
                              
                                 
                                    f
                                 
                                 
                                    i
                                    j
                                    k
                                 
                              
                              }
                           
                         the face set, and 
                           C
                           =
                           
                              {
                              
                                 
                                    c
                                 
                                 
                                    i
                                    j
                                    k
                                    l
                                 
                              
                              }
                           
                         the tetrahedral cell set with 
                           1
                           ≤
                           i
                           ,
                           j
                           ,
                           k
                           ,
                           l
                           ≤
                           m
                           =
                           
                              |
                              V
                              |
                           
                        . Given a scalar function 
                           φ
                         on the volume, its discrete version is a vector 
                           
                              
                                 φ
                              
                              →
                           
                           =
                           
                              
                                 
                                    [
                                    
                                       
                                          φ
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          φ
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          φ
                                       
                                       
                                          m
                                       
                                    
                                    ]
                                 
                              
                              
                                 T
                              
                           
                        , defined at the vertices. The volume element is represented with the voronoi volume 
                           
                              |
                              
                                 
                                    Ω
                                 
                                 
                                    i
                                 
                              
                              |
                           
                         of that vertex.

Thus, the discrete Laplace–Beltrami operator is linearly approximated at each vertex. Suppose that 
                           
                              
                                 e
                              
                              
                                 i
                                 j
                              
                           
                         is shared by 
                           n
                         tetrahedrons, the volumetric 
                           δ
                           φ
                         is estimated at 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         as  [13]
                        
                           
                              (4)
                              
                                 δ
                                 φ
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ∈
                                       N
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    (
                                    φ
                                    
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    −
                                    φ
                                    
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             j
                                          
                                       
                                       )
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 w
                              
                              
                                 i
                                 j
                              
                           
                         is the volumetric edge weight defined on edge 
                           
                              
                                 e
                              
                              
                                 i
                                 j
                              
                           
                         and 
                           N
                           
                              (
                              i
                              )
                           
                         is the one-ring neighbor of vertex 
                           i
                        . As the scalar function 
                           φ
                         is represented with a vector, the Laplace operator is defined with a weight matrix as 
                           
                              
                                 L
                              
                              
                                 i
                                 j
                              
                           
                        .

Suppose that an edge 
                           
                              
                                 e
                              
                              
                                 i
                                 j
                              
                           
                         is shared by 
                           n
                         tetrahedrons, 
                           
                              
                                 w
                              
                              
                                 i
                                 j
                              
                           
                         is defined as 
                           
                              
                                 w
                              
                              
                                 i
                                 j
                              
                           
                           =
                           
                              
                                 1
                              
                              
                                 
                                    |
                                    
                                       
                                          Ω
                                       
                                       
                                          i
                                       
                                    
                                    |
                                 
                              
                           
                           
                              (
                              
                                 
                                    1
                                 
                                 
                                    6
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                    l
                                 
                              
                              
                                 
                                    l
                                 
                                 
                                    i
                                    l
                                 
                              
                              
                                 cot
                              
                              
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       k
                                       l
                                    
                                 
                                 )
                              
                              )
                           
                           [14], where 
                           
                              |
                              
                                 
                                    Ω
                                 
                                 
                                    i
                                 
                              
                              |
                           
                         is the voronoi volume of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , 
                           
                              
                                 l
                              
                              
                                 k
                                 l
                              
                           
                         is the edge length of 
                           
                              
                                 e
                              
                              
                                 k
                                 l
                              
                           
                         to the opposite edge 
                           
                              
                                 e
                              
                              
                                 i
                                 j
                              
                           
                        , and 
                           
                              
                                 θ
                              
                              
                                 k
                                 l
                              
                           
                         is the dihedral angle on 
                           
                              
                                 e
                              
                              
                                 k
                                 l
                              
                           
                        . When considering all vertices of a mesh, Eq. (4) can be written as a linear system 
                           L
                           x
                           =
                           b
                        , where 
                           x
                           =
                           
                              
                                 φ
                              
                              →
                           
                         and 
                           b
                           =
                           
                              (
                              
                                 
                                    ρ
                                 
                                 
                                    Q
                                 
                              
                              −
                              
                                 
                                    ρ
                                 
                                 
                                    P
                                 
                              
                              )
                           
                           /
                           ρ
                        .

By solving the discrete Poisson equation, we obtain the scalar field 
                           φ
                         on the unit sphere volume. The gradient of the field is assumed constant inside the tetrahedral cell. To obtain a unique vector at each vertex, 
                           ∇
                           φ
                         at vertex 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         is defined as 
                           
                              (5)
                              
                                 
                                    
                                       V
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 ∇
                                 
                                    
                                       φ
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   i
                                                   j
                                                   k
                                                   l
                                                
                                             
                                             ∈
                                             
                                                
                                                   N
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                       
                                       
                                          
                                             α
                                          
                                          
                                             j
                                             k
                                             l
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             c
                                          
                                          
                                             i
                                             j
                                             k
                                             l
                                          
                                       
                                       ∈
                                       
                                          
                                             N
                                          
                                          
                                             1
                                          
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                 
                                 
                                    
                                       α
                                    
                                    
                                       j
                                       k
                                       l
                                    
                                    
                                       i
                                    
                                 
                                 ∇
                                 φ
                                 
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          i
                                          j
                                          k
                                          l
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         that is, an average of the gradients of the adjacent cells, weighted by the inverse of the distance 
                           
                              
                                 α
                              
                              
                                 j
                                 k
                                 l
                              
                              
                                 i
                              
                           
                         between the central vertex 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         and the centroid of cell 
                           
                              
                                 c
                              
                              
                                 i
                                 j
                                 k
                                 l
                              
                           
                        .


                        
                           V
                           
                              (
                              t
                              )
                           
                         is not a steady field but varies with time 
                           t
                         depending on the solution of 
                           ∇
                           φ
                           
                              (
                              t
                              )
                           
                        . Therefore, an iterative integration is employed based on each vertex. The time interval 
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                         is divided into 
                           K
                         step, and the time difference between the neighbor step is 
                           δ
                           =
                           
                              
                                 1
                              
                              
                                 K
                              
                           
                        . Thus, we get the iteration 
                           
                              (6)
                              
                                 X
                                 
                                    (
                                    k
                                    )
                                 
                                 =
                                 X
                                 
                                    (
                                    k
                                    −
                                    1
                                    )
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       K
                                    
                                 
                                 V
                                 
                                    (
                                    K
                                    −
                                    1
                                    )
                                 
                                 ,
                                 
                                 k
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 K
                                 ,
                              
                           
                         where 
                           X
                           
                              (
                              k
                              )
                           
                         is the current position of the 
                           k
                        -th step. And the final diffeomorphism 
                           g
                         is represented with the sum of the displacements of all steps as 
                           g
                           
                              (
                              x
                              )
                           
                           =
                           
                              
                                 x
                              
                              
                                 0
                              
                           
                           +
                           
                              
                                 ∑
                              
                              
                                 k
                                 =
                                 1
                              
                              
                                 K
                              
                           
                           
                              
                                 1
                              
                              
                                 K
                              
                           
                           ∇
                           φ
                           
                              (
                              k
                              −
                              1
                              )
                           
                        .

In general, a larger number of iteration steps result in more accurate approximations. Empirically, 
                           K
                         is set to 50, which will satisfy most cases.

The movement of vertices is in principle determined by the designated volume changes. However, degenerated tetrahedron may undermine the discrete computation due to inaccurate approximation of the Laplace–Beltrami operator. At the beginning of each step, we optimize the underlying tetrahedralization by performing combinatorial flips to all flippable faces for the Delaunay condition. Note that the geometry of volume is realized by their 
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                         embedding. Throughout this procedure, the discrete sampling of the shape remains unchanged, but is merely interpolated by a different tetrahedralization.

Based on the volume-preserving parameterization, we continue to solve the volume-preserving registration. The registration can be defined to find a registration which can minimize the distance between two meshes without breaking the original volume-preserving constraint. Here, the distance between two meshes can be defined as the MRI gray value differences of the corresponding vertices between two meshes.

We introduce metrics similar to the Demons approach  [15] to our volume-preserving registration. In  [15], Thirion proposed to consider non-parametric non-rigid registration as a diffusion process. He introduced Demons that pushes according to local characteristics of the images in a similar way Maxwell did for solving the Gibbs paradox.

A normal Demons approach is a two-step optimization, in which the first step represents a search for the update direction of the current warp, and the second the regularization of the new warp resulting from this update. Given a fixed image 
                           S
                         and a moving image 
                           T
                        , non-parametric image registration is treated as an optimization problem that aims at finding the displacement of each pixel to get a reasonable alignment of the images. In many cases, non-parametric spatial transformations will be described by a displacement field 
                           u
                         which is simply added to an identity transformation to get the non-parametric transformation: 
                           u
                           :
                           p
                           →
                           p
                           +
                           u
                           
                              (
                              p
                              )
                           
                        .

The similarity criterion 
                           
                              Sim
                           
                           
                              (
                              .
                              ,
                              .
                              )
                           
                         measures the resemblance of two volumes. Here, we consider the distance between two volumetric meshes as 
                           
                              Sim
                           
                           
                              (
                              S
                              ,
                              T
                              ∘
                              u
                              )
                           
                           =
                           
                              
                                 1
                              
                              
                                 2
                              
                           
                           
                              
                                 
                                    ‖
                                    
                                       |
                                       S
                                       −
                                       T
                                       ∘
                                       u
                                       |
                                    
                                    ‖
                                 
                              
                              
                                 2
                              
                           
                        .

A simple optimization of 
                           
                              Sim
                           
                         over the space of non-parametric transformations leads to an ill-posed problem with unstable and non-smooth solutions. To avoid this and possibly add some a priori knowledge, a regularization term 
                           
                              Reg
                           
                           
                              (
                              u
                              )
                           
                         is introduced to get the global energy 
                           
                              (7)
                              
                                 E
                                 
                                    (
                                    u
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             i
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    Sim
                                 
                                 
                                    (
                                    S
                                    ,
                                    T
                                    ∘
                                    u
                                    )
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             T
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    Reg
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 σ
                              
                              
                                 i
                              
                           
                         accounts for the noise on the image intensity and 
                           
                              
                                 σ
                              
                              
                                 T
                              
                           
                         controls the amount of regularization we need.

The idea is to consider the regularization criterion as a prior on the smoothness of the transformation 
                           u
                        . Instead of requiring the point correspondences between image pixels, a non-parametric spatial transformation, 
                           g
                        , is exact realization of the spatial transformation 
                           u
                        , but allows some error at each image point. Considering a Gaussian noise on displacements, we end up with the global energy:
                           
                              (8)
                              
                                 E
                                 
                                    (
                                    g
                                    ,
                                    u
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          ‖
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          
                                             (
                                             S
                                             −
                                             T
                                             ∘
                                             g
                                             )
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    dist
                                 
                                 
                                    
                                       
                                          (
                                          u
                                          ,
                                          g
                                          )
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             T
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    Reg
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 σ
                              
                              
                                 x
                              
                           
                         accounts for a spatial uncertainty on the correspondences, 
                           
                              dist
                           
                           
                              (
                              u
                              ,
                              g
                              )
                           
                           =
                           
                              ‖
                              g
                              −
                              u
                              ‖
                           
                         and 
                           
                              Reg
                           
                           
                              (
                              u
                              )
                           
                           =
                           
                              
                                 
                                    ‖
                                    ∇
                                    u
                                    ‖
                                 
                              
                              
                                 2
                              
                           
                        .

The unique advantage of the algorithms is precisely the separation of the two optimization problems: each cost can be optimized very efficiently with either a linear approximation or a fast convolution.

Since the third term in Eq. (8) can be interpreted as a penalty on the harmonic energy of 
                           u
                        , as well as its norm, and can be smoothed with a Gaussian kernel. Smoothing the displacement field is often termed “diffusion-like regularization”, and smoothing the update, “fluid-like regularization”. Thus, in order to preserving the volume while registration, we modified the regularization term as follows.

Given a manifold 
                           M
                        , a displacement field 
                           u
                         is required to deform the whole volume domain at each step. To accomplish the volume registration, 
                           u
                         must satisfy two criteria: first, 
                           u
                         is divergence free everywhere so that the volume elements are preserved under the deformation; second, 
                           u
                         on the boundary has no normal components, where no element moves in or out of the original volume domain. Formally, the problem can be represented as finding a displacement field 
                           u
                         defined on the volume domain 
                           M
                         such that
                           
                              (9)
                              
                                 
                                    {
                                    
                                       
                                          
                                             ∇
                                             U
                                             ≡
                                             0
                                          
                                       
                                       
                                          
                                             u
                                             
                                                (
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                             ⋅
                                             n
                                             
                                                (
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                             ≡
                                             0
                                             ,
                                             
                                             
                                                
                                                   b
                                                
                                                
                                                   j
                                                
                                             
                                             ∈
                                             ∂
                                             M
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Since Radial Basis Function (RBF) interpolation is a powerful tool to generate a function which interpolates a discrete set of values, the set of values is the displacement vector 
                           u
                         for each constant time step. Therefore, instead of regular scalar RBF, vector–matrix RBF is employed, which is represented as
                           
                              (10)
                              
                                 u
                                 
                                    (
                                    x
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                    
                                 
                                 Φ
                                 
                                    (
                                    
                                       ‖
                                       x
                                       −
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       ‖
                                    
                                    )
                                 
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 ,
                              
                           
                         where 
                           Φ
                         is an 
                           n
                           ∗
                           n
                         matrix valued radial basis function in 
                           n
                         dimensions space, and 
                           
                              
                                 c
                              
                              
                                 i
                              
                           
                         is a coefficient vector. The set of 
                           
                              
                                 c
                              
                              
                                 i
                              
                           
                         satisfies 
                           
                              |
                              u
                              
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              |
                           
                           =
                           
                              |
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                              
                              |
                           
                        . Thus, Eq. (10) is an overdetermined equation that we could find the optimal solution.

To interpolate a divergence free field, we employ the radial basis function, which McNally proposed to interpolate a magnetic field  [16], since at each step, the update direction 
                           g
                         can form a divergence free field.
                           
                              (11)
                              
                                 Φ
                                 
                                    (
                                    x
                                    )
                                 
                                 =
                                 
                                    (
                                    ∇
                                    
                                       
                                          ∇
                                       
                                       
                                          T
                                       
                                    
                                    −
                                    I
                                    Δ
                                    )
                                 
                                 ϕ
                                 
                                    (
                                    x
                                    )
                                 
                                 ,
                              
                           
                         where the 
                           ∇
                         operator is represented with a vector operator 
                           
                              
                                 
                                    [
                                    
                                       
                                          ∂
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          ∂
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          ∂
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                n
                                             
                                          
                                       
                                    
                                    ]
                                 
                              
                              
                                 T
                              
                           
                        , 
                           Δ
                         is a scalar valued Laplace operator, and 
                           Φ
                         is a scalar value radial basis function. Thus, we have 
                           
                              (12)
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                    
                                 
                                 Φ
                                 
                                    (
                                    
                                       ‖
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       −
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       ‖
                                    
                                    )
                                 
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 
                                 j
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 N
                                 .
                              
                           
                        
                     

With the solution of this equation, 
                           u
                         is interpolated, which is divergence free and guarantees that each point is along the direction. In the experiment, we choose Gaussian 
                           Φ
                           
                              (
                              x
                              )
                           
                           =
                           
                              
                                 e
                              
                              
                                 −
                                 λ
                                 
                                    
                                       
                                          ‖
                                          x
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         as the scalar valued radius basis function, which makes the divergence procedure equivalent with diffusion like Demons registration in the Lie group  [17].

After a divergence free displacement field 
                           u
                         is obtained, we need to constrain the boundary so that the shape of the domain can still be a unit sphere after the deformation. To keep the original shape of the domain, the displacement field must have zero normal component on the boundary, which means nothing is moving in or out of the original domain. To eliminate the normal component on the boundary to zero, another displacement field 
                           
                              
                                 u
                              
                              
                                 c
                              
                           
                         can be added to the existing 
                           u
                        . 
                           
                              
                                 u
                              
                              
                                 c
                              
                           
                         is also divergence free as 
                           u
                         and has the same normal components at those sampling points on the boundary, but with opposite normal directions. Then, adding 
                           
                              
                                 u
                              
                              
                                 c
                              
                           
                         to 
                           u
                         leads to the final registration displacement field 
                           
                              
                                 u
                              
                              
                                 r
                              
                           
                           =
                           u
                           +
                           
                              
                                 u
                              
                              
                                 c
                              
                           
                        .

Here, we can find that the divergence free displacement field 
                           u
                         is a Lie group under composition, the original warp direction is computed based on Eq. (8), the warp value is calculated by Eq. (10), after the iteration, we can finally get the optimal registration results.

Thus, we define the volume-preserving Demons registration as 
                           
                              (13)
                              
                                 
                                    {
                                    
                                       
                                          
                                             u
                                             =
                                             
                                                
                                                   
                                                      argmin
                                                   
                                                
                                                
                                                   u
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         ‖
                                                         S
                                                         −
                                                         T
                                                         ∘
                                                         
                                                            {
                                                            g
                                                            ∗
                                                            u
                                                            }
                                                         
                                                         ‖
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      σ
                                                   
                                                
                                                
                                                   dist
                                                
                                                
                                                   (
                                                   g
                                                   ,
                                                   u
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             u
                                             
                                                (
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                             ⋅
                                             n
                                             
                                                (
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             
                                             ≡
                                             0
                                             ,
                                             
                                             
                                                
                                                   b
                                                
                                                
                                                   j
                                                
                                             
                                             ∈
                                             ∂
                                             M
                                          
                                       
                                       
                                          
                                             u
                                             
                                                (
                                                x
                                                )
                                             
                                             =
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   N
                                                   ∗
                                                   K
                                                
                                             
                                             Φ
                                             
                                                (
                                                
                                                   ‖
                                                   x
                                                   −
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ‖
                                                
                                                )
                                             
                                             
                                                
                                                   u
                                                
                                                
                                                   i
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In practice, we first perform a rigid registration to minimize the distance between two meshes. Then we conduct the volume-preserving registration based on Eq. (13). Finally we can get the transfer matrix and the registration results. Algorithm 1 shows the whole registration steps.


                        
                           
                              
                           
                        
                     

@&#EXPERIMENTAL RESULTS@&#

In order to evaluate our algorithms, we obtain 12 brain volumes from the CUMC dataset.
                        1
                     
                     
                        1
                        
                           http://mindboggle.info.
                      The data was scanned at the Columbia University Medical Center on a 1.5 T GE scanner, and segmented and manually labeled by one technician trained according to the Cardviews labeling scheme  [18] created at the CMA with 128 labeled regions. Each brain volume was first extracted out the brain surface based on their brainmask. Then, the tetrahedral mesh is constructed from the brain surface using TetGen software.
                        2
                     
                     
                        2
                        
                           http://wias-berlin.de/software/tetgen/.
                      Each brain mesh was performed a brain shift simulation based on  [19]. The deformation is based on generalized barycentric coordinates while adding the constraint of keeping a volume constant. The deformation first computes the Mean-Value Coordinates, then using the generalized barycentric coordinates to calculate the new mesh. In order to simulate the brain shift, we modify the elastic coefficient to make the brain mesh modeled as a homogeneous linear visco-elastic material  [20]. Besides, we add position constrained at some vertices of brainstem to make the deformation close to brain shift situation.

After performing the deformation, we conduct the volume preserving parameterization. Fig. 1
                      shows the original volume and the parameterized volume, the volume ratio between the original volume and parameterized volume of each vertex is around 1 (Fig. 2
                     ), which means it successfully preserves the volume while parameterization. Besides, we also calculate the angle distortion. After parameterization, the angle distortion is still around 1 while its variance is about 0.3.

After the parameterization, we register the deformed mesh to the original one with their parameterized results. Fig. 3
                      shows the registration results between each group. Then we evaluate the accuracy of the registration with union overlap (UO). UO is defined as the ratio of overlapped volume area with corresponding labels to the union, which is also called Jaccard coefficient  [21]. In another word, UO between 
                        
                           
                              V
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              V
                           
                           
                              2
                           
                        
                      is defined as 
                        U
                        O
                        =
                        
                           
                              
                                 
                                    A
                                 
                                 
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    ∩
                                    
                                       
                                          V
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                           
                              
                                 
                                    A
                                 
                                 
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    ∪
                                    
                                       
                                          V
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        
                     .

The average UO of the registration is 94.65%, which means that our method can successfully register the mesh of different shapes. Fig. 4
                      shows the Voronoi volume ratio between original volume and the registration results. From Fig. 4(a), we can see that the ratio of the Voronoi volume of each vertex is still around 1, which means our volume-preserving registration method can efficiently preserve the volume of each vertex while achieving accurate registration. Compared with Fig. 2 we found that the volume ratio around 1 is decreased, which is caused by the registration since Eq. (10) is overdetermined so that we can only find the optimal solution which makes the displacement field not be able to preserve strictly divergence free.

We also analyze the registration accuracy for each structure, respectively. Table 1
                      shows the registration result of each structure. From the results we can see that our method can successfully and accurately register the volume.

We also compared our method with traditional Demons algorithms. The average UO of traditional Demons is about 95%. Fig. 5
                      shows the registration accuracy comparison between our method and Demons for each subcortical structures. About 67.26% of the brain volumetric structures show that our method’s accuracy is better than traditional Demons. Our method can successfully register the image with the comparable performance to traditional Demons. We also compare the volume change ratios between our method and traditional Demons. Fig. 4(b) shows the ratio between original volumes and registration results of traditional Demons. Since Demons does not preserve the volume ratio, the ratio is only about 50% while our method can preserve the ratio up to 80%.

Based on the experiments, we can see that our method can successfully register the image. The accuracy of the registration is similar to traditional Demons. Besides, our method can successfully preserve the volume ratio during the registration. In some subcortical structure, our method’s results are less accurate than traditional Demons. The main reason is because we need to preserve the Volume ratio between the original image and the deformed one.

@&#CONCLUSION@&#

In this paper, we introduce a new spherical volume-preserving Demons registration of tetrahedral volumes.

Since the brain shift can be treated as a volume-preserving deformation, we find a way to register the deformation while preserving the volumetric property. Given an initial mapping between two closed connected manifolds, a volume-preserving mapping can be built, derived from the compressible flow of the volume form on the target manifold. Then, a volume-preserving Demons registration is introduced to minimize the misalignment. Compared with traditional Demons registration, our method’s registration results are similar to Demons, while ours can preserve the local volume. In future, we will test our method on real patient data. Also we will extend our registration method to other different cortical structures.

@&#ACKNOWLEDGMENTS@&#

This work is supported in part by 863 Project (2013 AA013803), NSFC (61271151, 61228103) and NSF (IIS-0915933, IIS-0937586).

@&#REFERENCES@&#

