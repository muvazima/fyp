@&#MAIN-TITLE@&#Optimization of insulin pump therapy based on high order run-to-run control scheme

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Two kinds of high order R2R control methods are presented to optimize the insulin pump therapy.


                        
                        
                           
                           Using the proposed method, both the basal and the bolus insulin are adjusted simultaneously.


                        
                        
                           
                           The proposed method can converge even when there are ±60min random variations in meal timing or ±40% random variations in meal size.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Type 1 diabetes mellitus

Glucose regulation

High order run-to-run control

@&#ABSTRACT@&#


               
               
                  Background and objectives
                  Continuous subcutaneous insulin infusion (CSII) pump is widely considered a convenience and promising way for type 1 diabetes mellitus (T1DM) subjects, who need exogenous insulin infusion. In the standard insulin pump therapy, there are two modes for insulin infusion: basal and bolus insulin. The basal-bolus therapy should be individualized and optimized in order to keep one subject's blood glucose (BG) level within the normal range; however, the optimization procedure is troublesome and it perturb the patients a lot. Therefore, an automatic adjustment method is needed to reduce the burden of the patients, and run-to-run (R2R) control algorithm can be used to handle this significant task.
               
               
                  Methods
                  In this study, two kinds of high order R2R control methods are presented to adjust the basal and bolus insulin simultaneously. For clarity, a second order R2R control algorithm is first derived and studied. Furthermore, considering the differences between weekdays and weekends, a seventh order R2R control algorithm is also proposed and tested.
               
               
                  Results
                  In order to simulate real situation, the proposed method has been tested with uncertainties on measurement noise, drifts, meal size, meal time and snack. The proposed method can converge even when there are ±60min random variations in meal timing or ±50% random variations in meal size.
               
               
                  Conclusions
                  According to the robustness analysis, one can see that the proposed high order R2R has excellent robustness and could be a promising candidate to optimize insulin pump therapy.
               
            

@&#INTRODUCTION@&#

In recent years, there is a clearly rising trend in the incidence of diabetes around the world, according to the statistic of IDF Atlas, there are about 387 million people living with diabetes in 2014 and it will increase to 592 million in 2035 [1]. Diabetes mellitus is a metabolic disease with hyperglycemia (high blood glucose level), and people with diabetes often feel thirsty, hungry, and excessive urination [2–6]. The chronic hyperglycemia increases the risk of complications, such as heart disease, stroke, blindness, renal failure, and so on [7–10]. There are three main types of diabetes (type 1, type 2, and gestational diabetes) and other specific type of diabetes [11]. This article focuses on type 1 diabetes which is characterized by absent or insufficient endogenous production of insulin. Consequently, people affected by type 1 diabetes have to completely rely on exogenous insulin infusion [12,13].

For type 1 diabetic patients, the only choice to reduce the blood glucose (BG) level is utilizing exogenous insulin. There are mainly two ways for exogenous insulin delivery: multiple daily injection (MDI) and continuous subcutaneous insulin infusion (CSII) pump. CSII shows superiority over MDI in keeping people with type 1 diabetes in higher percentage of time in euglycemia and therefore has an increased popularity over the years [14,15]. In the CSII pump therapy, insulin delivery rate is typically divided into two regimens: basal insulin and bolus insulin: the former one is used to keep the balance of intra-individual glucose secretion and the latter one is utilized to offset the glucose fluctuations induced by meals corresponding to three regulation times for breakfast, lunch and dinner, respectively. Due to intra- and inter-subject variability, the basal-bolus therapy should be individualized and optimized in order to keep one subject's blood glucose level within the normal range.

Due to its good learning ability, run-to-run (R2R) control has successfully been utilized to optimize CSII therapy by many scholars, e.g., Palerm et al. [16,17], Zisser et al. [18], Owens et al. [19], and Campos-Cornejo et al. [20,21]. Among these studies, only [17] adopts the R2R control strategy to adjust the basal insulin, and while other studies [16,18–23] use R2R to design the bolus insulin or parameter of the control algorithm. After analyzing and comparing these optimization methods, all of them use the first order R2R scheme, and to the author's best knowledge, there is no reported study using high order R2R for optimization of CSII pump therapy.

On the other hand, finger stick is widely used in previous years and it can only provide sparse glucose measurements for therapy optimization. While over the recent years, there are significant improvements on the continuous glucose monitoring system (CGMS), which has successfully been applied in clinical practice [24–27]. Correspondingly, blood glucose prediction is a hot topic in the related field [28,29]. In short, more data are available for therapy optimization.

In this study, a high order R2R control scheme is proposed to update both basal insulin and bolus insulin, and particularly a second order R2R and a seventh order R2R are chosen as two example. The seventh order R2R is a power tool to deal with differences of living habits between weekdays and weekends. Evaluated on 11 virtual subjects from the FDA-accepted UVa/Padova metabolism simulator [30,31], the proposed method not only make blood glucose converge to a safe range of 70–170mg/dL in less than 10 days, but also has superior performance compared with the traditional first-order R2R control under the same condition, especially including meal amount variations, meal time variations, meal amount & time combined variations, or CGMS noise and drift. Hence, high order R2R control is more robust than the traditional first-order R2R control. Considering the inevitable uncertainties in real life, two kinds of uncertainties, meal timing and meal amount uncertainties, are both included to test the robustness of the proposed methodology. According to the simulation results, the proposed control algorithm can endure ±60min random variations in meal timing, ±50% random variations in meal size, CGMS noise up to 10%, CGMS drift up to 18mg/dL/h, or the added snack, while the traditional method diverges in such situation.

In sum, this study has the following contributions: First, the proposed algorithm can update the basal and bolus simultaneously and while the reported studies can only update one of them. Second, because CGMS is more and more popular and reliable, the CGMS readings are used to design the updating law and hence improved performance can be achieved. Furthermore, high order R2R (second order and seventh order) was first implemented to optimize the basal and bolus therapy, which can enhance the control performance.

The remainder of this paper is organized as follow: in Section 2, a high order R2R control scheme is proposed and applied to adjust the basal insulin and bolus insulin. In Section 3, simulation results are presented and analyzed, including comparing the control performance both second order formulation and seventh order formulation with the traditional first order method with respect to variations on meal time, meal amount, or CGMS noise and drift. At last, some conclusions are presented in Section 4.

Let us consider a single-input single-output process, of which the input–output relation is described as below:
                           
                              (1)
                              
                                 
                                    y
                                    (
                                    k
                                    )
                                    =
                                    b
                                    u
                                    (
                                    k
                                    )
                                    +
                                    a
                                    (
                                    k
                                    )
                                    +
                                    ε
                                    (
                                    k
                                    )
                                 
                              
                           
                        where k is the run index; y(k) and u(k) are the output and input of the process, respectively; parameter b is the slope coefficient; a is the drift coefficient; ɛ(k) denotes disturbance [32].

Evidently, the optimal control action of k-th run is
                           
                              (2)
                              
                                 
                                    u
                                    (
                                    k
                                    )
                                    =
                                    
                                       
                                          
                                             y
                                             *
                                          
                                          −
                                          a
                                          (
                                          k
                                          )
                                       
                                       b
                                    
                                 
                              
                           
                        where y* is the target value for the output. The above-mentioned expression can be easily extended to multi-input multi-output case. In this case, b is a matrix and a and y* are vectors, so Eq. (2) is changed as u(k)=
                        b
                        −1(y*−
                        a(k)). It usually exploit exponentially weighted moving average (EWMA) formula to update the offset term, as shown below:
                           
                              (3)
                              
                                 
                                    a
                                    (
                                    k
                                    +
                                    1
                                    )
                                    =
                                    λ
                                    [
                                    y
                                    (
                                    k
                                    )
                                    −
                                    b
                                    u
                                    (
                                    k
                                    )
                                    ]
                                    +
                                    (
                                    1
                                    −
                                    λ
                                    )
                                    a
                                    (
                                    k
                                    )
                                 
                              
                           
                        
                     

Eq. (3) is a first order EWMA formula, and λ is an adjusting parameter between (0, 1). Based on Eqs. (2) and (3), the traditional R2R control action can be described as
                           
                              (4)
                              
                                 
                                    u
                                    (
                                    k
                                    +
                                    1
                                    )
                                    =
                                    u
                                    (
                                    k
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    )
                                    ]
                                     
                                    
                                       
                                          K
                                          =
                                          
                                             λ
                                             b
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Similarly to Eq. (3), the second order EWMA formula can be written as:
                           
                              (5)
                              
                                 
                                    a
                                    (
                                    k
                                    +
                                    1
                                    )
                                    =
                                    θ
                                    {
                                    λ
                                    [
                                    y
                                    (
                                    k
                                    )
                                    −
                                    b
                                    u
                                    (
                                    k
                                    )
                                    ]
                                    +
                                    (
                                    1
                                    −
                                    λ
                                    )
                                    a
                                    (
                                    k
                                    )
                                    }
                                    +
                                    (
                                    1
                                    −
                                    θ
                                    )
                                    {
                                    λ
                                    [
                                    y
                                    (
                                    k
                                    −
                                    1
                                    )
                                    −
                                    b
                                    u
                                    (
                                    k
                                    −
                                    1
                                    )
                                    ]
                                    +
                                    (
                                    1
                                    −
                                    λ
                                    )
                                    a
                                    (
                                    k
                                    −
                                    1
                                    )
                                    }
                                 
                              
                           
                        where θ is a parameter which varies from 0 to 1. Combining Eqs. (2) and (4) and setting K
                        =
                        λ/b, one can get the following recursive formula:
                           
                              (6)
                              
                                 
                                    u
                                    (
                                    k
                                    +
                                    1
                                    )
                                    =
                                    θ
                                    {
                                    u
                                    (
                                    k
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    )
                                    ]
                                    }
                                    +
                                    (
                                    1
                                    −
                                    θ
                                    )
                                    {
                                    u
                                    (
                                    k
                                    −
                                    1
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    −
                                    1
                                    )
                                    ]
                                    }
                                 
                              
                           
                        Similarly to the derivation of second order R2R formula, seventh order R2R control scheme is given below:
                           
                              (7)
                              
                                 
                                    u
                                    (
                                    k
                                    +
                                    1
                                    )
                                    =
                                    
                                       α
                                       1
                                    
                                    {
                                    u
                                    (
                                    k
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    )
                                    ]
                                    }
                                    +
                                    
                                       α
                                       2
                                    
                                    {
                                    u
                                    (
                                    k
                                    −
                                    1
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    −
                                    1
                                    )
                                    ]
                                    }
                                    +
                                    
                                       α
                                       3
                                    
                                    {
                                    u
                                    (
                                    k
                                    −
                                    2
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    −
                                    2
                                    )
                                    ]
                                    }
                                    +
                                    
                                       α
                                       4
                                    
                                    {
                                    u
                                    (
                                    k
                                    −
                                    3
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    −
                                    3
                                    )
                                    ]
                                    }
                                    +
                                    
                                       α
                                       5
                                    
                                    {
                                    u
                                    (
                                    k
                                    −
                                    4
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    −
                                    4
                                    )
                                    ]
                                    }
                                    +
                                    
                                       α
                                       6
                                    
                                    {
                                    u
                                    (
                                    k
                                    −
                                    5
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    −
                                    5
                                    )
                                    ]
                                    }
                                    +
                                    
                                       α
                                       7
                                    
                                    {
                                    u
                                    (
                                    k
                                    −
                                    6
                                    )
                                    +
                                    K
                                    [
                                    
                                       y
                                       *
                                    
                                    −
                                    y
                                    (
                                    k
                                    −
                                    6
                                    )
                                    ]
                                    }
                                 
                              
                           
                        where α
                        
                           i
                        (i
                        =1, 2, …, 7) are some design parameters, which satisfies α
                        1
                        +
                        α
                        2
                        +
                        α
                        3
                        +
                        α
                        4
                        +
                        α
                        5
                        +
                        α
                        6
                        +
                        α
                        7
                        =1.

In this part, there is a brief introduction for a standard insulin pump therapy, which will be used as the initial therapy. When a subject starts to use insulin pump therapy, there are some steps. The first step is to estimate the total insulin amounts, which is related to the patient's weight. The general way of calculation is expressed as
                           
                              (8)
                              
                                 
                                    I
                                    =
                                    W
                                    ×
                                    0.6
                                     
                                    U
                                    /
                                    kg
                                 
                              
                           
                        where W (kg) is the weight of the patients, I is the total insulin dose [17]. Taking the half of the total amount as the basal insulin requirements, which is described as V
                        basal
                        =0.5×
                        I, where V
                        basal (U) represents the basal insulin. The sensitivity of insulin and human life habits have repetitive nature, and the timing and magnitude of the disturbances such as meals will behave differently in response to a controller depending on the day of the week or time of day. Hence, the following division of the initial basal insulin infusion rate V
                        infusion rate (U/h) is widely used [17]:
                           
                              (9)
                              
                                 
                                    
                                       V
                                       
                                          infusion rate
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            0.5
                                                            
                                                               V
                                                               
                                                                  basal
                                                               
                                                            
                                                         
                                                         
                                                            24
                                                             
                                                            h
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                      :
                                                      00
                                                      −
                                                      4
                                                      :
                                                      00
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            0.5
                                                            
                                                               V
                                                               
                                                                  basal
                                                               
                                                            
                                                         
                                                         
                                                            24
                                                             
                                                            h
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      4
                                                      :
                                                      00
                                                      −
                                                      10
                                                      :
                                                      00
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               V
                                                               
                                                                  basal
                                                               
                                                            
                                                         
                                                         
                                                            24
                                                             
                                                            h
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      10
                                                      :
                                                      00
                                                      −
                                                      18
                                                      :
                                                      00
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               V
                                                               
                                                                  basal
                                                               
                                                            
                                                         
                                                         
                                                            24
                                                             
                                                            h
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      18
                                                      :
                                                      00
                                                      −
                                                      24
                                                      :
                                                      00
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Then, the initial bolus insulin V
                        bolus (U) should be determined by using the meal content, in other words
                           
                              (10)
                              
                                 
                                    
                                       V
                                       
                                          bolus
                                       
                                    
                                    =
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   M
                                                   b
                                                
                                             
                                          
                                          
                                             
                                                
                                                   M
                                                   l
                                                
                                             
                                          
                                          
                                             
                                                
                                                   M
                                                   d
                                                
                                             
                                          
                                       
                                    
                                    ]
                                    ×
                                    I
                                    C
                                 
                              
                           
                        where M
                        
                           b
                        , M
                        
                           l
                        , and Md (g) are the carbohydrate contents of breakfast, lunch, and dinner, respectively. IC (U/g) indicates the insulin–carbohydrates ratio, which is a priori knowledge of the patients.

Applying R2R algorithm in insulin pump therapy optimization, a day can be treated as a run; u(k) is the manipulated variable, which corresponds to the basal and bolus insulin, i.e., V(k)=[V
                        infusion rate 
                        V
                        bolus], where V
                        infusion rate and V
                        bolus in Eqs. (9) and (10). Therefore, on the k-th day, there should be a performance index according to the CGMS readings, which is used to adjust the insulin automatically for the (k
                        +1)-th day. Hence the output can be closer to the desired target run by run.

The general procedure of R2R algorithm applying in glucose regulation can be described as follow: First, choose an initial value for V(k) (when k
                        =1), which corresponds to u(k) in (1). Second, calculate the performance index PI(k)=[T(k) Γ(k)], which corresponds to y(k) in (1), based on the CGMS readings. The definitions of T(k) and Γ(k) are given in (12) and (15), respectively. Third, use V(k) and PI(k) to update the input V(k
                        +1) based on Eq. (6); repeat the second and third steps from day to day, and it will tend to converge.

Because CGMS is more and more frequently-used and accurate, it is assumed that the CGMS readings are used to optimize the basal and bolus therapy. The Dexcom CGMS model in the UVa/Padova simulator was used to simulate the real CGMS. Due to (9), the data from CGMS is divided into four segments to adjust in basal insulin regulation, which is shown in Fig. 1
                           .

In this way, the designed basal infusion rates can more easily accommodate insulin sensitivity variations and other situation may happen in one day. Considering the average glucose is mainly influenced by basal insulin, the average CGMS reading is selected as the controlled objective in every segment, which is defined as:
                              
                                 (11)
                                 
                                    
                                       T
                                       
                                          A
                                          j
                                       
                                       
                                          =
                                          ˆ
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      n
                                                      j
                                                   
                                                
                                             
                                             
                                                C
                                                G
                                                
                                                   M
                                                   j
                                                
                                                (
                                                i
                                                )
                                             
                                          
                                          
                                             
                                                n
                                                j
                                             
                                          
                                       
                                    
                                 
                              
                           where n
                           
                              j
                            means the number of CGMS readings in segment j, CGM
                           
                              j
                            represents the corresponding glucose measurements of segment j (j
                           =1, 2, 3 and 4), which is used to calculate the performance index. Using CGMS readings to update the basal and bolus mainly due to the following reasons: first, CGMS are more and more frequently-used and accurate; second, CGMS could provide more information, for example, it can reflect the change of insulin sensitivity. The controlled variable vector can be defined as:
                              
                                 (12)
                                 
                                    
                                       T
                                       =
                                       
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         T
                                                         
                                                            A
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         T
                                                         
                                                            A
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         T
                                                         
                                                            A
                                                            3
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         T
                                                         
                                                            A
                                                            4
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          T
                                       
                                       .
                                    
                                 
                              
                           
                        

Finally, the basal insulin updating scheme based on the second order R2R can be described as:
                              
                                 (13)
                                 
                                    
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       +
                                       1
                                       )
                                       =
                                       θ
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       )
                                       ]
                                       }
                                       +
                                       (
                                       1
                                       −
                                       θ
                                       )
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       −
                                       1
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       −
                                       1
                                       )
                                       ]
                                       }
                                    
                                 
                              
                           
                        

The seventh order R2R can be describe as:
                              
                                 (14)
                                 
                                    
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       +
                                       1
                                       )
                                       =
                                       
                                          θ
                                          1
                                       
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          2
                                       
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       −
                                       1
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       −
                                       1
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          3
                                       
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       −
                                       2
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       −
                                       2
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          4
                                       
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       −
                                       3
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       −
                                       3
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          5
                                       
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       −
                                       4
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       −
                                       4
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          6
                                       
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       −
                                       5
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       −
                                       5
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          7
                                       
                                       {
                                       
                                          V
                                          
                                             infusion rate
                                          
                                       
                                       (
                                       k
                                       −
                                       6
                                       )
                                       +
                                       
                                          K
                                          1
                                       
                                       [
                                       
                                          T
                                          *
                                       
                                       −
                                       T
                                       (
                                       k
                                       −
                                       6
                                       )
                                       ]
                                       }
                                    
                                 
                              
                           where θ
                           1
                           +
                           θ
                           2
                           +
                           θ
                           3
                           +
                           θ
                           4
                           +
                           θ
                           5
                           +
                           θ
                           6
                           +
                           θ
                           7
                           =1, T* represents the target values of average blood glucose over one segment, which is set as 90mg/dL in this study.

In bolus insulin regulation, it is some different from basal insulin regulation because of different impact on the glucose adjustment. Only six glucose measurements are needed for adjustment, there are three measurements right before the three meals and other three measurements are the highest glucose level after taking three meals, as shown in Fig. 2
                           .

Bolus insulin can make an influence on the glucose deviation after a meal, and the maximum deviation between pre-prandial glucose and post-prandial glucose according to the CGMS readings can be denoted as 
                              
                                 Γ
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      γ
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      γ
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      γ
                                                      3
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    T
                                 
                              
                           , where γ
                           1, γ
                           2, and γ
                           3 is calculated as
                              
                                 (15)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            γ
                                                            1
                                                         
                                                         =
                                                         
                                                            GA
                                                            b
                                                         
                                                         −
                                                         
                                                            GB
                                                            b
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            γ
                                                            2
                                                         
                                                         =
                                                         
                                                            GA
                                                            l
                                                         
                                                         −
                                                         
                                                            GB
                                                            l
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            γ
                                                            3
                                                         
                                                         =
                                                         
                                                            GA
                                                            d
                                                         
                                                         −
                                                         
                                                            GB
                                                            d
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where GB are the measurements just before meals and GA are the maximum measurements after meals. Therefore, the updating scheme of bolus insulin in (k
                           +1)-th day is described as:
                              
                                 (16)
                                 
                                    
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       +
                                       1
                                       )
                                       =
                                       θ
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       )
                                       ]
                                       }
                                       +
                                       (
                                       1
                                       −
                                       θ
                                       )
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       −
                                       1
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       −
                                       1
                                       )
                                       ]
                                       }
                                    
                                 
                              
                           where Γ*=[20 40 40]
                              T
                            is chosen as the target value, which denotes the desire maximum fluctuation after a meal, Γ(k) and Γ(k
                           −1) are determined by the glucose of k-th day and (k
                           −1)-th day, respectively. Similarly, the seventh order updating law is as below:
                              
                                 (17)
                                 
                                    
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       +
                                       1
                                       )
                                       =
                                       
                                          θ
                                          1
                                       
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       )
                                       ]
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          2
                                       
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       −
                                       1
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       −
                                       1
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          3
                                       
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       −
                                       2
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       −
                                       2
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          4
                                       
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       −
                                       3
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       −
                                       3
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          5
                                       
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       −
                                       4
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       −
                                       4
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          6
                                       
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       −
                                       5
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       −
                                       5
                                       )
                                       ]
                                       }
                                       +
                                       
                                          θ
                                          7
                                       
                                       {
                                       
                                          V
                                          
                                             bolus
                                          
                                       
                                       (
                                       k
                                       −
                                       6
                                       )
                                       +
                                       
                                          K
                                          2
                                       
                                       [
                                       
                                          Γ
                                          *
                                       
                                       −
                                       Γ
                                       (
                                       k
                                       −
                                       6
                                       )
                                       ]
                                       }
                                    
                                 
                              
                           
                        

In Sections 3.1 and 3.2.1–3.2.4, all in silico tests are made on the nominal subject in the UVa/Padova metabolism simulator, which has the average parameter setting. In Section 3.2.5, in silico tests are made on other 10 virtual subjects in the UVa/Padova simulator.

The nominal subject follows a protocol of three meals at 7:00am, noon, and 6:00pm of 40g, 70g, and 60g of carbohydrates, respectively. In 50-day simulation, the initial glucose level is fixed at 150mg/dL and the traditional method is used in the first day, i.e., the insulin delivery rate mentioned in Section 2 is used.

In order to get the optimal controller gain, simulations have been done to choose best combination of K
                        1 and K
                        2. First, K
                        1 was set to a random value between −0.005 to −0.04, find a K
                        2 which has a better control result, then keep the K
                        2, change the K
                        1 in range of −0.005 to −0.04 and find the K
                        1
                        =−0.015 will get the best result in this case. Hence, the gains of the R2R controller are set to be K
                        1
                        =−0.015 for the basal insulin and K
                        2
                        =−0.06 for the bolus insulin and θ
                        =0.5. The control results of the second order R2R algorithm in comparison with the first order control method are shown in Fig. 3
                        . In the simulation, it is under the same conditions including the initial basal insulin infusion rate and bolus insulin.

According to Fig. 3, one can clearly see that both two control schemes can keep learning from the previous day to renovate the input and the control performance has sustaining improvement. However, after a period of time, the first order method will be a little diverging while the proposed method still can keep learning and improving. Some control performance indices are calculated for the proposed method after 10th day as shown below: there is no either hyper- or hypo-glycemia, the lowest BG value is 77mg/dL and the highest BG value is 161.5mg/dL, and the mean glucose concentration is 112mg/dL. Because there are 50 days and each day includes four segments, so there are totally 200 basal segments in Fig. 3. This is why it looks like that the basal insulin changes frequently.

In the previous parts, the insulin sensitivity of a subject and the amount and time of the meals are assumed to be the same for all days, while it is impossible in real life. And the proposed method has to make a good control performance although there are some variations. In order to evaluate the robustness of the proposed method, five scenarios are studied: (a) sensor noise and drifts; (b) meal amount random variation; (c) meal time random variation; (d) meal amount and time combined variation; (e) subject variability. The nominal subject consume three meals every day, and the nominal values of meal amount and meal time are still selected as [40g, 70g, 60g] and [7am, 12am, 6pm]. The variations of the meal size, meal timing, and the CGMS noise are all assumed to be normal distribution.

Because the study is based on the data collected by CGMS, the noise and the drifts may happen in this process. In this section, the sensor error is considered. A noise up to 10% and a random drift up to 18mg/dL is considered in simulation on a nominal subject with values of meal amount and meal time of [40g, 70g, 60g] and [7am, 12am, 6pm] and the result is shown in Fig. 4
                           .

As shown in Fig. 4, the result with noise and drift will not cause too much hyper- or hypo-glycemia, compare with the first order R2R, the second order R2R shows better on robustness respect to noise and drifts of the sensor.

In this section, the meal timing is fixed in order to focus on the effect of meal amount variation. A uniform distributed random variation is added to the meal amount, the proposed algorithm can endure ±40% meal amount variation [33]. The control results of the proposed second order method and the traditional first order method with ±40% meal amount variation on the nominal subject are given in Fig. 5
                           .

As shown in Fig. 5, there is a little hyperglycemia and no hypoglycemia under the proposed method, while there is severe hyperglycemia and some hypoglycemia under the first order method, also the fluctuation is acuter. Therefore, the second order R2R algorithm has good robustness with respect to the meal amount variations.

In this case, the meal amount for everyday is fixed and the meal time has a random variation. The uniform distributed random variable is still added to the meal time, and the proposed method can endure ±60min meal time variation. The minimum meal time interval is 3h and the maximum meal time interval is 8h, which is a relative large range for the nominal meal time. The control results of two methods with ±60min meal time variation on the nominal subject are shown in Fig. 6
                           . It is clear that the control performance of the proposed method can be robust to ±60min meal time variation, but the control results of the traditional first order method are much worse.

Based on Fig. 6, one can see that if the meal time variation is within ±60min, there is no hypoglycemia and little hyperglycemia in the proposed second order method, and the worst case hypoglycemia is higher than the hypoglycemia threshold (60mg/dL).

Generally speaking, both meal amount and meal time variations will exist at the same time in the real life. In this part, the following situation is considered: there are both ±60min of meal time variations and ±30% meal amount variations synchronously.

Some statistical results of 100 groups of Monte Carlo simulations are given in Table 1
                           , where each Monte Carlo simulation runs for 50 days. However, only the last 40 days’ results are used to calculating these indices. Because a suboptimal basal and bolus therapy is used in first day as a starting point, the first 10 days generally have worse and unsteady performance and hence they are irrelevant from the analysis point of view.


                           Table 1 shows the comparison results of the second order and the first order R2R control schemes. The hyperglycemia and hypoglycemia under the traditional first order R2R control scheme are more severe than those under the proposed second order method. The minimum BG value under the proposed second order R2R control algorithm is much higher than that under the traditional first order method. The standard deviation of the blood glucose concentration under the proposed algorithm is relative smaller, which means the fluctuation of glucose concentration is mild.

The above results were all conducted on the nominal subject. While in clinic, different subjects have different factors such as weights, insulin resistances, and ages that will have much influence on the control results. Hence a good therapy should be particularly robust to different subjects.

In this section, 10 adult subjects from the FDA-accepted UVa/Padova simulator are tested under the high order R2R control. The 10 different subjects has a large difference on parameter. Taking the parameter Vmx as an example, which is used to determine the insulin sensitivity, it varies from 0.029849164 to 0.095717488. The controller gains including basal segment and bolus segment are the same. The control results for these 10 subjects under the proposed method are shown in Fig. 7
                           .

From Fig. 7, it is seen that the control performance can be improved from day to day for all subjects. After a few days, the BG concentrations can converge within the safe range with little variation for these 10 subjects. It means that the proposed method has good robustness to subject variations.

In the previous learning control algorithms, they always make adjustment of the input based on the previous batch, if considering that it exists the life habits of some days are very different, then the traditional learning control algorithms may not reach a good control results. For example, a week includes five weekdays and two weekends, and weekday and weekend have much difference in meal amount and meal time. In five weekdays, the nominal values of meal amount and meal time are still assumed to be the same with the previous section, i.e., [40g, 70g, 60g] and [7:00am, 12:00 noon, 6:00pm], respectively. In a typical weekend, people generally get up later with taking little breakfast, eat much more for lunch, and eat dinner later, so meal amount and meal timing is not regular, which are set as [10g, 100g, 60g] and [8:00am, 12:00am, 7:00pm], respectively. Concerning the proposed seventh order R2R in (7), the equal weight on every day is implemented for generality and simplicity, i.e., α
                        1
                        =
                        α
                        2
                        =
                        α
                        3
                        =
                        α
                        4
                        =
                        α
                        5
                        =
                        α
                        6
                        =
                        α
                        7
                        =1/7. Because the conventional basal and bolus therapy was used in the first week, the meals are assume to be the same from weekday to weekend for simplicity. The control results of the seventh order R2R algorithm with the comparison with the first order control method are given in Fig. 8
                        . Similarly, it is still under the same conditions including the initial basal insulin infusion rate and bolus insulin.

From Fig. 8, on can see that although hyperglycemic events occur under both two methods; however, there is no hypoglycemia under the proposed method and the standard deviation is smaller, which shows a stable performance.

In the real life, a robustness analysis should be made to make sure whether the proposed method can perform well if there is variation. Similar with the second order R2R control, three aspects are considered; (a) meal amount random variations, (b) meal time random variations, and (c) combined meal amount and time random variations. Considering the differences between the weekdays and the weekends, the nominal values of meal amount and meal time are still selected as [40g, 70g, 60g] and [7:00am, noon, 6:00pm] in weekdays and [10g, 100g, 60g] and [8:00am, noon, 7:00pm] in weekends.

Similarly, 100 groups of Monte Carlo simulations are made, where each Monte Carlo simulation runs for 50 days. Because the conventional basal and bolus therapy was used in the first week, the meals are assume to be the same from weekday to weekend for simplicity. From the second week, the proposed seventh order R2R was used to update the basal and bolus, and then the meal disturbance on the weekend was introduced. The last 40 days’ results are used to calculate these indices. Three cases are tested on the nominal subject. (1) Fixing the meal time in order to study the effect of meal amount variation. A uniform distributed random variation is added into the meal amount, the control performance indicators of proposed algorithm and the first order method under ±20% meal amount variation. (2) Fixing the meal amount at the nominal value and add a uniform distributed random variation into meal time, the control performance indicators of proposed algorithm and traditional first order method under ±30min meal time variation. (3) The meal amount variation is set as ±10% and meal time variation is set as ±30min. (4) a snack of 40g CHO is added at 4:00 pm [34]. The nominal meal amount has been disordered, so the meal amount range is quite large with the variation.

According to Table 2
                           , one can find that there is little hyperglycemia under the seventh order methods because of the large range of the meal amount; while there is severe hypoglycemia in the traditional first order method and the worst case hypoglycemia is too low which may affect the patients’ life safe. The results demonstrate that the seventh order R2R control scheme has better robustness with respect to real life disturbance than the first order method.

Similar to the previous section, 10 subjects are tested under seventh order R2R control method. The control results for 10 subjects are shown in Fig. 9
                           .

From Fig. 9, one can see that the control performance can become better from day to day for most subjects under seventh order R2R control scheme. The glucose level can converge into the safe range after a few days, which demonstrates that this method can be robust enough to subject variations. For some subjects, e.g. Adults 2, 4, 6 and 8, there is a little jump between seventh and eighth days. The reason is that the proposed seventh order R2R control starts to work from eighth day.

All results have been achieved on the same simulator and these results demonstrate that both the proposed second order and seventh order R2R perform better than the first order one. Because the UVa/Padova simulator tends to be forgiving in the hypo region, the proposed method need to be tested clinically in the future.

@&#CONCLUSIONS@&#

A novel high order R2R scheme is proposed in this study and it can successfully achieve a good glucose regulation for type 1 diabetes mellitus. The proposed method can exploit more historical information than the traditional first order R2R method, so it can get a better control performance. Compared with the first order method, the proposed method has less hyperglycemia and hypoglycemia episodes, because of taking full advantage of more batch information. Moreover, the robustness of the proposed method is studied with respect to meal amount and timing variations and subject variability. The proposed method has much stronger robustness than the traditional first order method according to the Monte Carlo experiments.

The authors declare that they have no conflict of interest.

@&#ACKNOWLEDGEMENTS@&#

This work is partially supported by a EFSD/CDS/Lilly grant, National Natural Science Foundation in China (61374099), the Program for New Century Excellent Talents in University (NCET-13-0652), and the Scientific Research Foundation for the Returned Overseas Chinese Scholars, State Education Ministry (LXJJ201301).

@&#REFERENCES@&#

