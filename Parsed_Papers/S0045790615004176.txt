@&#MAIN-TITLE@&#A distributed algorithm for inter-layer network coding-based multimedia multicast in Internet of Things

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A method to save bandwidth for multimedia multicast in IoT.


                        
                        
                           
                           A distributed algorithm of joint rate control and multicast layer flow allocation.


                        
                        
                           
                           The inter-layer network coding is more stable than the intra-layer ones.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Internet of Things

Multimedia multicast

Inter-layer network coding

Flow optimization

Distributed algorithm

@&#ABSTRACT@&#


               
               
                  With the development of the Internet of Things (IoT), more and more devices that have diverse computing and communication capabilities are interconnected. For multimedia multicast in the IoT, a fixed flow rate cannot meet the quality-of-service requirements of heterogeneous devices and each device may not get the information from all other devices. In order to satisfy the heterogeneous requirements, we develop a distributed algorithm to solve the inter-layer flow optimization problem based on network coding for multimedia multicast in the IoT, by using primal decomposition and primal-dual analysis. We also apply Lyapunov theory to prove the convergence and global stability of the proposed iterative algorithm. Numerical results demonstrate that the proposed algorithm has better flexibility, stability, and implementation advantages than the previous intra-layer ones.
               
            

@&#INTRODUCTION@&#

Traditional internet has connected billions of computers together, through which people can exchange information conveniently. Today, in the era of the Internet of Things (IoT), machine themselves communicate with other machine or human. Although there is no standard identification of the IoT, [1] provided a good description as follows: “Things have identities and virtual personalities operating in smart spaces using intelligent interfaces to connect and communicate within social, environment, and user contexts”. Around us, a lot of “things”, such as sensors, actuators, and smart phones are connected to create a ubiquitous communication environment. The “things” can realize some communication functions by discovering their neighbors to cooperate with them [1,2].

Multimedia communication in the IoT is a very hot topic, since the “things” are creating, transmitting, and receiving multimedia information everywhere. However, the devices such as smart phones, sensors, and personal computers are different from each other in the capabilities of processing and the rate of receiving. So if the multimedia information is transmitted at a fixed rate, it may exceed the bandwidth budget of some devices and the quality-of-service requirements of some devices may not be satisfied.

Two kinds of quality-of-service requirements for multimedia services in heterogeneous networks were proposed in [3]: first, it must be able to effectively use all the available bandwidth; second, it must control the place of computation. Therefore, the first question of multimedia communication is how to make full use of the available bandwidth. One method to save bandwidth is to use the multicast scheme. In a multicast process, the receivers are divided into several multicast groups based on their requirements. For the heterogeneous receivers in the context of the IoT, multi-rate multicast is preferred, because different devices in the same multicast group could request different quality-of-service [4].

Network coding is an effective technology that can improve the throughput. It extends the functionality of nodes from storing/forwarding packets to performing algebraic operations on the received data [5]. A large number of studies have shown that network coding can dramatically improve the throughput of traditional routing, the transmission efficiency of information, etc [5–7].

Naturally, people has considered to combine the multi-rate multicast scheme with network coding. For the multi-rate multicast problem, most researchers consider the situation that flow rates for each multicast session or the link capacities are fixed. However, for the desired data rates of the receivers, the construction of optimal multi-rate multicast network codes is sometimes NP-hard [8], or may even not exist [9]. In such cases, flow control is needed to make full use of bandwidth while avoiding congestion and maintaining certain fairness among the competing flows in the network. For flow rate control, at present some researchers have proposed layered multicast schemes [10,11] applying network coding to improve performance of layered multicast based on traditional routing [12]. In general, they divide the network into different layers and construct single-rate multicast network coding for each layer [13,14]. However, these methods only apply network coding inside one layer, therefore cannot realize the full potential of network coding.

The second question of multimedia communication is where to perform the computation. In the context of the IoT, the number of intermediate nodes and sink nodes are increasing at a very fast rate. Any node in the multimedia transmission network does not know the capabilities of all other nodes, and even the network topology itself is varying from time to time. The authors in [15] suggested that “the computational part can be developed using distributed processing or cloud computing”. The inter-layer network coding scheme in [16,17] has greater flexibility in optimizing the data flow compared to previous methods, and thus achieves higher throughput. But this scheme cannot be applied in the context of IoT, because it is not a distributed algorithm. Therefore, in this paper, we study the distributed flow rate control problem for multimedia multicast based on inter-layer network coding in the IoT.

The main contributions of this paper are summarized as follows:

                        
                           •
                           We study a method to save bandwidth and perform the computation efficiently for multimedia multicast in the IoT.

We introduce the concept of transfer price specially for inter-layer network coding-based multicast flows, which is a Lagrange multiplier in the proposed algorithm. It, together with congestion price proposed in [16,17], are buffered in virtual queues at each node to determine the flow control strategy. In the scheme proposed in [16,17], the interactions of transfer price and congestion price emerged from multicast flows and the inverse of the derivative function of utility are not well expressed. We adopt an alternative iteration method which has been successfully used in [11] and extend it to inter-layer network coding-based rate control relying on current transfer price and congestion price. Therefore the problems encountered in rate control, which was solved by the direct solving method for intra-layer network coding [13], are avoided.

We propose a distributed algorithm of joint rate control and multicast layer flow allocation. We use a partially-primal and dual gradient-based approach complies with the adaptive control of signal transmission mechanism to solve the optimization problem, while reducing the required control information. Furthermore, we mathematically proves the convergence and the globally stability of the proposed algorithm for the network coding-based multi-rate multicast, by using Lyapunov theory.

The rest of this paper is organized as follows. Section 2 briefly discusses the related works. Section 3 describes the details of the system model and the formulation of the flow optimization problem for multi-rate multicast based on inter-layer network coding. Section 4 proposes the distributed algorithm for the flow optimization problem and proves that the proposed algorithm is globally stable. In Section 5, numerical examples are provided to illustrate the convergence, performance improvement, and implementation advantages of the proposed algorithm. Finally, Section 6 concludes the paper.

@&#RELATED WORKS@&#

In recent years, some schemes about network coding-based layered multicast have been proposed to address the problems emerging in the field of multi-rate multicast. Compared to traditional routing, these schemes had substantially improved the throughput [18]. Based on the traditional layered multicast scheme [12], Zhao et al. [10] proposed a layered overlay multicast scheme to cope with heterogeneity and to improve throughput. Zou et al. [14] studied the prioritized flow optimization for scalable video coding and multicast over networks, jointly considering multi-path video streaming, network coding-based routing, and network flow control. Lakshminarayana and Eryilmaz [11] adopted layered multicast mechanism with intra-layer network coding and nested optimization approach to investigate the multi-rate multicast utility maximization problem.

However, many layered multicast schemes [19] that mainly used intra-layer network coding divided the multicast network into multiple multicast layers according to some standard. Each multicast layer can be seen as a session and network coding is used in each layer, respectively. The existing polynomial-time algorithm [7] was used respectively for each layer, and then the superposition approach was used over multiple layers [20].

Intuitively, the main feature of intra-layer network coding is that network coding is performed only inside one layer, which cannot achieve the full potential of network coding. So the researchers are focusing on the promising inter-layer network coding technique recently. The authors in [16,17] focused on network code construction for novel layered multicast using inter-layer network coding and provide a concentrating solution for flow optimization. Widmer et al. [21] provided a heuristic algorithm for rate allocation and code assignment based on layered multicast streaming with inter-layer network coding. Owning to these literature mainly concentrating on coding strategies, the corresponding solutions are in view of centralized control. This paper studies distributed flow control based on layered multicast with inter-layer network coding. Our scheme allows flow in multicast layer k to carry data in all data layers 
                        
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           k
                        
                     . Thus, messages sent in layer k are linear combinations of data in layers 
                        
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           k
                        
                     . While [16,17] provided no optimization methods for inter-layer network coding, this paper provides a dynamic, distributed flow control algorithm for the inter-layer network coding scheme. This distributed flow control algorithm use a partially-primal and dual decomposition method to get the dynamic solution which is obtained by just using local information to maximize the users’ utilities. As for the dual variables in the Lagrange multiplier method, except for the concrete congestion price proposed in [16,17], we introduce the transfer price. The price is for some part of the flow in lower layers to be transmitted in higher layers when we use the inter-layer network coding technique. The part of flow that brings the congestion in lower layers will be transferred to the higher layers, so it needs to pay the price for buffering the transferred data.

Furthermore, to analyze the stability and convergence of the proposed algorithm, we adopt classical Lyapunov theory [22], which is triumphantly devoted in the convergence analysis of control algorithms, such as stability analysis of iterative algorithms for scalable multi-rate multicast [14], congestion control for single-rate multicast flows with network coding [13] and multi-rate multicast with intra-layer network coding [11], etc.

First, we build a optimization model of the flow routing based on network coding to make full use of available bandwidth.

We consider a network, denoted by a graph 
                           
                              G
                              =
                              (
                              V
                              ,
                              E
                              )
                              ,
                           
                         with a set V of nodes and a set E of links. Meanwhile, the set of sink nodes is denoted by D. Let the receiving rate of the sink node d ∈ D denoted by R(d). For each node v ∈ V, we use In(v) to represent the set of all incoming links to node v and Out(v) to represent the set of all outgoing links from node v. The link belonging to set E is denoted by the directed pair (i, j) of the nodes i, j ∈ V that it connects. Assume the multicast source sends the messages 
                           
                              
                                 a
                                 1
                              
                              ,
                              …
                              ,
                              
                                 a
                                 S
                              
                              ,
                           
                         of equal size, and each source packet ai
                        (1 ≤ i ≤ S) is treated as an indivisible flow unit.

First of all, implementation steps of the inter-layer network coding scheme in [16,17] are summarized as follows:

                           
                              (1)
                              According to each sink’s max-flow value [6] and utility function, partition D into several subsets 
                                    
                                       
                                          D
                                          1
                                       
                                       ,
                                       
                                          D
                                          2
                                       
                                       ,
                                       …
                                       ,
                                       
                                          D
                                          N
                                       
                                    
                                  (which means that there are N multicast groups) such that:
                                    
                                       ∀
                                       d
                                       ∈
                                       
                                          D
                                          k
                                       
                                       ,
                                       
                                          d
                                          
                                             ′
                                             ′
                                          
                                       
                                       ∈
                                       
                                          D
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       ,
                                       R
                                       
                                          (
                                          d
                                          )
                                       
                                       <
                                       R
                                       
                                          (
                                          
                                             d
                                             
                                                ′
                                                ′
                                             
                                          
                                          )
                                       
                                       ,
                                    
                                  and 
                                    
                                       ∀
                                       d
                                       ,
                                       
                                          d
                                          ′
                                       
                                       ∈
                                       
                                          D
                                          k
                                       
                                       ,
                                       R
                                       
                                          (
                                          d
                                          )
                                       
                                       =
                                       R
                                       
                                          (
                                          
                                             d
                                             ′
                                          
                                          )
                                       
                                       ≡
                                       
                                          R
                                          k
                                       
                                    
                                  and 
                                    
                                       
                                          U
                                          d
                                       
                                       
                                          (
                                          
                                             R
                                             k
                                          
                                          )
                                       
                                       =
                                       
                                          U
                                          
                                             d
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             R
                                             k
                                          
                                          )
                                       
                                       ,
                                    
                                  where Ud
                                 ( · ) represents the utility function of sink d.

Based on the N multicast groups determined by (1), the source data flow is encoded into a series of non-overlapping layers 
                                    
                                       
                                          L
                                          1
                                       
                                       ,
                                       
                                          L
                                          2
                                       
                                       ,
                                       …
                                       ,
                                       
                                          L
                                          N
                                       
                                    
                                 .

With the idea of inter-layer network coding, the source node or the intermediate nodes could choose to transport the combinations of all the data in the first k data layers to sink d. That means some data is allowed to be transferred from one layer to a higher layer at the source node or some intermediate nodes. We say that some part of the flow in lower layers is allowed to be “delayed” and transmitted in higher layers. However, finally all the “delayed” flow have to reach sink d in order to ensure that d receives all the data in the first k data layers.

Then, according to the specific inter-layer network coding scheme discussed above, the flow optimization problem 
                           P
                         can be formulated as follows:

                           
                              (1a)
                              
                                 
                                    max
                                    
                                    
                                       ∑
                                       
                                          d
                                          ∈
                                          D
                                       
                                    
                                    
                                       U
                                       d
                                    
                                    
                                       (
                                       
                                          R
                                          
                                             L
                                             (
                                             d
                                             )
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (1b)
                              
                                 
                                    subject
                                    
                                    
                                    to
                                    :
                                    
                                    
                                    
                                       b
                                       
                                          j
                                       
                                       
                                          d
                                          ,
                                          l
                                       
                                    
                                    =
                                    
                                       ∑
                                       
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          I
                                          n
                                          (
                                          j
                                          )
                                       
                                    
                                    
                                       x
                                       
                                          i
                                          ,
                                          j
                                       
                                       
                                          d
                                          ,
                                          l
                                       
                                    
                                    −
                                    
                                       ∑
                                       
                                          (
                                          j
                                          ,
                                          i
                                          )
                                          ∈
                                          O
                                          u
                                          t
                                          (
                                          j
                                          )
                                       
                                    
                                    
                                       x
                                       
                                          j
                                          ,
                                          i
                                       
                                       
                                          d
                                          ,
                                          l
                                       
                                    
                                    ,
                                    ∀
                                    
                                    
                                    j
                                    ∈
                                    V
                                    ,
                                    d
                                    ∈
                                    D
                                    ,
                                    1
                                    ≤
                                    l
                                    ≤
                                    N
                                 
                              
                           
                        
                        
                           
                              (1c)
                              
                                 
                                    
                                       R
                                       j
                                    
                                    ≥
                                    −
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       j
                                    
                                    
                                       b
                                       
                                          s
                                       
                                       
                                          d
                                          ,
                                          i
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                    
                                    d
                                    ∈
                                    D
                                    ,
                                    1
                                    ≤
                                    j
                                    <
                                    L
                                    
                                       (
                                       d
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (1d)
                              
                                 
                                    
                                       R
                                       j
                                    
                                    =
                                    −
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       j
                                    
                                    
                                       b
                                       
                                          s
                                       
                                       
                                          d
                                          ,
                                          i
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                    
                                    d
                                    ∈
                                    D
                                    ,
                                    j
                                    =
                                    L
                                    
                                       (
                                       d
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (1e)
                              
                                 
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       j
                                    
                                    
                                       b
                                       
                                          n
                                       
                                       
                                          d
                                          ,
                                          i
                                       
                                    
                                    ≥
                                    0
                                    ,
                                    
                                    ∀
                                    
                                    
                                    d
                                    ∈
                                    D
                                    ,
                                    1
                                    ≤
                                    j
                                    <
                                    L
                                    
                                       (
                                       d
                                       )
                                    
                                    ,
                                    n
                                    ∉
                                    
                                       {
                                       s
                                       ,
                                       d
                                       }
                                    
                                 
                              
                           
                        
                        
                           
                              (1f)
                              
                                 
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       j
                                    
                                    
                                       b
                                       
                                          n
                                       
                                       
                                          d
                                          ,
                                          i
                                       
                                    
                                    =
                                    0
                                    ,
                                    
                                    ∀
                                    
                                    
                                    d
                                    ∈
                                    D
                                    ,
                                    j
                                    =
                                    L
                                    
                                       (
                                       d
                                       )
                                    
                                    ,
                                    n
                                    ∉
                                    
                                       {
                                       s
                                       ,
                                       d
                                       }
                                    
                                 
                              
                           
                        
                        
                           
                              (1g)
                              
                                 
                                    −
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       j
                                    
                                    
                                       b
                                       
                                          s
                                       
                                       
                                          d
                                          ,
                                          i
                                       
                                    
                                    ≥
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       j
                                    
                                    
                                       b
                                       
                                          d
                                       
                                       
                                          d
                                          ,
                                          i
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                    
                                    d
                                    ∈
                                    D
                                    ,
                                    1
                                    ≤
                                    j
                                    <
                                    L
                                    
                                       (
                                       d
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (1h)
                              
                                 
                                    −
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       j
                                    
                                    
                                       b
                                       
                                          s
                                       
                                       
                                          d
                                          ,
                                          i
                                       
                                    
                                    =
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       j
                                    
                                    
                                       b
                                       
                                          d
                                       
                                       
                                          d
                                          ,
                                          i
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                    
                                    d
                                    ∈
                                    D
                                    ,
                                    j
                                    =
                                    L
                                    
                                       (
                                       d
                                       )
                                    
                                 
                              
                           
                        
                        
                           
                              (1i)
                              
                                 
                                    
                                       y
                                       
                                          i
                                          ,
                                          j
                                       
                                       l
                                    
                                    ≥
                                    
                                       x
                                       
                                          i
                                          ,
                                          j
                                       
                                       
                                          d
                                          ,
                                          l
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                    
                                    d
                                    ∈
                                    D
                                    ,
                                    1
                                    ≤
                                    l
                                    ≤
                                    N
                                 
                              
                           
                        
                        
                           
                              (1j)
                              
                                 
                                    
                                       ∑
                                       
                                          l
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       y
                                       
                                          i
                                          ,
                                          j
                                       
                                       l
                                    
                                    =
                                    
                                       C
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                    
                                       (
                                       i
                                       ,
                                       j
                                       )
                                    
                                    ∈
                                    E
                                 
                              
                           
                        where Ud
                        ( · ), as a function of rate R(d), is assumed to be continuously differentiable, increasing, and strictly concave for the flow rate. L(d) denotes the number of the data layers that sink d will receive (i.e. 
                           
                              L
                              (
                              d
                              )
                              =
                              k
                           
                         if and only if d ∈ Dk
                        ). Let 
                           
                              x
                              
                                 i
                                 ,
                                 j
                              
                              
                                 d
                                 ,
                                 l
                              
                           
                         be the flow on link (i, j) for sink d in layer l. Define 
                           
                              b
                              
                                 j
                              
                              
                                 d
                                 ,
                                 l
                              
                           
                         to be the potential of node j for sink d in layer l, which is the difference between the incoming flow and the outgoing flow. Let 
                           
                              y
                              
                                 i
                                 ,
                                 j
                              
                              l
                           
                         be the actual flow on link (i, j) in layer l (over all sinks). C
                        
                           i, j
                         denotes the capacity of each link (i, j) ∈ E in the network.

In the optimization problem 
                           
                              P
                              ,
                           
                         constraints (1c), (1e), and (1g) concern the flow transfer at the source node, the intermediate nodes, and the sink nodes, respectively. Constraints (1d), (1f), and (1h) are the flow balance constraints at the source node, the intermediate nodes, and the sink nodes, respectively. Constraint (1i) is the network coding constraint. Constraint (1j) confines that the actual flow in each link cannot exceed the capacity of that link.

As the authors in [16,17] did not give optimization algorithms for the inter-layer network coding scheme, in this section we use primal decomposition and primal-dual analysis to form a distributed algorithm for the flow optimization problem 
                        P
                     . This algorithm uses only local information of the nodes in the network, so as to reduce the required control information and comply with the adaptive control of signal transmission mechanism. Moreover, this algorithm can make each node collaborated with the user terminals and let all of them interconnect efficiently to improve the communication performance of multi-rate multicast. In addition, we prove that the proposed algorithm is globally stable.

First, we find that Problem 
                           P
                         can be divided into two subproblems: Subproblem 
                           
                              P
                              1
                           
                         is max ∑
                           d ∈ D
                        
                        Ud
                        (R
                        
                           L(d)) with respect to (1c)–(1h), and Subproblem 
                           
                              P
                              2
                           
                         is max L(R, p, v) with respect to (1b), (1i), and (1j), where L(R, p, v) is the Lagrangian of the Problem 
                           P
                         with respect to the flow balance and flow transfer constraints, that is

                           
                              (2)
                              
                                 
                                    
                                       
                                          
                                             L
                                             (
                                             R
                                             ,
                                             p
                                             ,
                                             v
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                U
                                                d
                                             
                                             
                                                (
                                                
                                                   R
                                                   
                                                      L
                                                      (
                                                      d
                                                      )
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                ∑
                                                
                                                   1
                                                   ≤
                                                   j
                                                   <
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                p
                                                
                                                   s
                                                
                                                
                                                   d
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                −
                                                
                                                   R
                                                   j
                                                
                                                −
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      s
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                ∑
                                                
                                                   n
                                                   ∉
                                                   {
                                                   s
                                                   ,
                                                   d
                                                   }
                                                
                                             
                                             
                                                ∑
                                                
                                                   1
                                                   ≤
                                                   j
                                                   <
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                p
                                                
                                                   n
                                                
                                                
                                                   d
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                −
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      n
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             −
                                             
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                ∑
                                                
                                                   1
                                                   ≤
                                                   j
                                                   <
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                p
                                                
                                                   d
                                                
                                                
                                                   d
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      d
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      s
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                v
                                                
                                                   s
                                                
                                                
                                                   d
                                                   ,
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                (
                                                
                                                   R
                                                   
                                                      L
                                                      (
                                                      d
                                                      )
                                                   
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      L
                                                      (
                                                      d
                                                      )
                                                   
                                                
                                                
                                                   b
                                                   
                                                      s
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             −
                                             
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                ∑
                                                
                                                   n
                                                   ∉
                                                   {
                                                   s
                                                   ,
                                                   d
                                                   }
                                                
                                             
                                             
                                                v
                                                
                                                   n
                                                
                                                
                                                   d
                                                   ,
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      L
                                                      (
                                                      d
                                                      )
                                                   
                                                
                                                
                                                   b
                                                   
                                                      n
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                v
                                                
                                                   d
                                                
                                                
                                                   d
                                                   ,
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                (
                                                −
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      s
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                −
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      d
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where vector 
                           
                              R
                              =
                              {
                              
                                 R
                                 
                                    L
                                    (
                                    d
                                    )
                                 
                              
                              ,
                              d
                              ∈
                              D
                              }
                              ,
                           
                         vector 
                           
                              v
                              =
                              {
                              
                                 v
                                 
                                    n
                                 
                                 
                                    d
                                    ,
                                    L
                                    (
                                    d
                                    )
                                 
                              
                              ,
                              d
                              ∈
                              D
                              ,
                              n
                              ∈
                              V
                              }
                              ,
                           
                         and vector 
                           
                              p
                              =
                              {
                              
                                 p
                                 
                                    n
                                 
                                 
                                    d
                                    ,
                                    j
                                 
                              
                              ,
                              d
                              ∈
                              D
                              ,
                              n
                              ∈
                              V
                              ,
                              1
                              ≤
                              j
                              <
                              L
                              
                                 (
                                 d
                                 )
                              
                              }
                           
                        . Besides, define vector 
                           
                              x
                              =
                              {
                              
                                 x
                                 
                                    i
                                    ,
                                    j
                                 
                                 
                                    d
                                    ,
                                    l
                                 
                              
                              ,
                              
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                              ∈
                              E
                              ,
                              d
                              ∈
                              D
                              ,
                              1
                              ≤
                              l
                              ≤
                              N
                              }
                              ,
                           
                         and vector 
                           
                              y
                              =
                              {
                              
                                 y
                                 
                                    i
                                    ,
                                    j
                                 
                                 l
                              
                              ,
                              
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                              ∈
                              E
                              ,
                              1
                              ≤
                              l
                              ≤
                              N
                              }
                           
                        .

For each node n ∈ V and 1 ≤ j < L(d), 
                           
                              p
                              
                                 n
                              
                              
                                 d
                                 ,
                                 j
                              
                           
                         can be interpreted as the “transfer price” at node n for multicast layer j and sink node d ∈ D, and 
                           
                              v
                              
                                 n
                              
                              
                                 d
                                 ,
                                 L
                                 (
                                 d
                                 )
                              
                           
                         can be interpreted as the “congestion price” at node n for sink d ∈ D. 
                           
                              v
                              
                                 n
                              
                              
                                 d
                                 ,
                                 L
                                 (
                                 d
                                 )
                              
                           
                         means that, due to its insufficient memory or slow processor, node n needs to pay the price for failing to make the flow designated to sink d queuing in its buffer, updating the routing tables, and so on; 
                           
                              p
                              
                                 n
                              
                              
                                 d
                                 ,
                                 j
                              
                           
                         means that the cache overhead is needed when flow at node n is transferred from layer j to a higher layer and the node n may transfer the congested flow in layer j to a higher layer because of the flow transfer.

Again, the Lagrange function L(R, p, v) is separable:
                           
                              L
                              (
                              R
                              ,
                              p
                              ,
                              v
                              )
                              =
                              L
                              (
                              R
                              )
                              +
                              L
                              (
                              p
                              ,
                              v
                              )
                              ,
                           
                         where

                           
                              
                                 
                                    L
                                    
                                       (
                                       R
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          d
                                          ∈
                                          D
                                       
                                    
                                    
                                       U
                                       d
                                    
                                    
                                       (
                                       
                                          R
                                          
                                             L
                                             (
                                             d
                                             )
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       ∑
                                       
                                          d
                                          ∈
                                          D
                                       
                                    
                                    
                                       ∑
                                       
                                          1
                                          ≤
                                          j
                                          <
                                          L
                                          (
                                          d
                                          )
                                       
                                    
                                    
                                       p
                                       
                                          s
                                       
                                       
                                          d
                                          ,
                                          j
                                       
                                    
                                    
                                       R
                                       j
                                    
                                    −
                                    
                                       ∑
                                       
                                          d
                                          ∈
                                          D
                                       
                                    
                                    
                                       v
                                       
                                          s
                                       
                                       
                                          d
                                          ,
                                          L
                                          (
                                          d
                                          )
                                       
                                    
                                    
                                       R
                                       
                                          L
                                          (
                                          d
                                          )
                                       
                                    
                                 
                              
                           
                        and

                           
                              
                                 
                                    
                                       
                                          
                                             L
                                             (
                                             p
                                             ,
                                             v
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                ∑
                                                
                                                   1
                                                   ≤
                                                   j
                                                   <
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                p
                                                
                                                   s
                                                
                                                
                                                   d
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      s
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                             +
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                ∑
                                                
                                                   n
                                                   ∉
                                                   {
                                                   s
                                                   ,
                                                   d
                                                   }
                                                
                                             
                                             
                                                ∑
                                                
                                                   1
                                                   ≤
                                                   j
                                                   <
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                p
                                                
                                                   n
                                                
                                                
                                                   d
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      n
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             −
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                ∑
                                                
                                                   1
                                                   ≤
                                                   j
                                                   <
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                p
                                                
                                                   d
                                                
                                                
                                                   d
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      d
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      s
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                             +
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                v
                                                
                                                   d
                                                
                                                
                                                   d
                                                   ,
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      s
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   j
                                                
                                                
                                                   b
                                                   
                                                      d
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             −
                                             
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                v
                                                
                                                   s
                                                
                                                
                                                   d
                                                   ,
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      L
                                                      (
                                                      d
                                                      )
                                                   
                                                
                                                
                                                   b
                                                   
                                                      s
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                ∑
                                                
                                                   n
                                                   ∉
                                                   {
                                                   s
                                                   ,
                                                   d
                                                   }
                                                
                                             
                                             
                                                v
                                                
                                                   n
                                                
                                                
                                                   d
                                                   ,
                                                   L
                                                   (
                                                   d
                                                   )
                                                
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      L
                                                      (
                                                      d
                                                      )
                                                   
                                                
                                                
                                                   b
                                                   
                                                      n
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Thus the Problem 
                           
                              P
                              1
                           
                         can be divided into two parts: 
                           
                              P
                              11
                           
                         and 
                           
                              
                                 P
                                 12
                              
                              ,
                           
                         where 
                           
                              P
                              11
                           
                         is max L(R), and 
                           
                              P
                              12
                           
                         is max L(p, v).

Then we obtain the following joint rate control and multicast layer flow allocation algorithm as follows: first for fixed vector v and vector p, to solve Subproblem 
                           
                              P
                              11
                           
                        ; then for fixed vector x, vector y, and obtained vector R, to solve Subproblem 
                           
                              P
                              12
                           
                        ; for obtained vector p, vector v, and vector R, to solve Subproblem 
                           
                              P
                              2
                           
                         at last.

At time t, given congestion price vector v(t) and transfer price vector p(t), source node s adjusts its sending rate Rk
                            to the sink/sinks d in layer k (equal to L(d)) according to the total net congestion price 
                              
                                 
                                    
                                       P
                                       ^
                                    
                                    
                                       s
                                    
                                    
                                       D
                                       k
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                              
                            of layer k which is generated locally at the source node, namely, ∀d ∈ D,

                              
                                 (3)
                                 
                                    
                                       
                                          R
                                          k
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                       =
                                       
                                          
                                             [
                                             
                                                R
                                                k
                                             
                                             
                                                (
                                                t
                                                −
                                                1
                                                )
                                             
                                             +
                                             
                                                α
                                                k
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      d
                                                      ∈
                                                      
                                                         D
                                                         k
                                                      
                                                   
                                                
                                                
                                                   U
                                                   d
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      R
                                                      k
                                                   
                                                   
                                                      (
                                                      t
                                                      −
                                                      1
                                                      )
                                                   
                                                   )
                                                
                                                −
                                                
                                                   
                                                      P
                                                      ^
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      D
                                                      k
                                                   
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                )
                                             
                                             ]
                                          
                                          
                                             
                                                φ
                                                0
                                             
                                          
                                          
                                             φ
                                             1
                                          
                                       
                                       ,
                                    
                                 
                              
                           where 
                              
                                 
                                    U
                                    d
                                    ′
                                 
                                 
                                    (
                                    R
                                    )
                                 
                                 =
                                 
                                    
                                       d
                                       
                                          U
                                          d
                                          ′
                                       
                                       
                                          (
                                          R
                                          )
                                       
                                    
                                    
                                       d
                                       R
                                    
                                 
                              
                           ; 
                              
                                 
                                    
                                       P
                                       ^
                                    
                                    
                                       s
                                    
                                    
                                       D
                                       k
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       d
                                       ∈
                                       
                                          D
                                          k
                                       
                                    
                                 
                                 
                                    v
                                    
                                       s
                                    
                                    
                                       d
                                       ,
                                       k
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 −
                                 
                                    ∑
                                    
                                       
                                          d
                                          ′
                                       
                                       ∈
                                       
                                          D
                                          
                                             L
                                             (
                                             
                                                d
                                                ′
                                             
                                             )
                                          
                                       
                                       ,
                                       L
                                       
                                          (
                                          
                                             d
                                             ′
                                          
                                          )
                                       
                                       >
                                       k
                                    
                                 
                                 
                                    p
                                    
                                       s
                                    
                                    
                                       
                                          d
                                          ′
                                       
                                       ,
                                       k
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                              
                           ; and 
                              
                                 
                                    [
                                    z
                                    ]
                                 
                                 
                                    a
                                 
                                 b
                              
                            
                           [11] denotes the projection of z onto the interval [a, b]. Furthermore, αk
                            is a small positive step-size parameter, 
                              
                                 0
                                 <
                                 
                                    φ
                                    0
                                 
                                 <
                                 
                                    min
                                    k
                                 
                                 
                                    R
                                    k
                                    *
                                 
                              
                            where R
                           * is the optimal solution, and φ1 is a finite constant that is greater than 
                              
                                 
                                    ∑
                                    
                                       (
                                       i
                                       ,
                                       j
                                       )
                                       ∈
                                       E
                                    
                                 
                                 
                                    C
                                    
                                       i
                                       ,
                                       j
                                    
                                    ′
                                 
                              
                           .

This section will provide the mechanism of updating the transfer price and congestion price. According to the projection method in [11], by solving Subproblem 
                              
                                 
                                    P
                                    12
                                 
                                 ,
                              
                            the transfer price and congestion price is updated as follows:

                              
                                 (i)
                                 Each node h belonging to set V updates its transfer price with respect to sink d ∈ Dk
                                    (1 ≤ k ≤ N) and multicast layer 
                                       
                                          j
                                          (
                                          1
                                          ≤
                                          j
                                          ≤
                                          k
                                          −
                                          1
                                          )
                                          ,
                                       
                                     according to

                                       
                                          (4)
                                          
                                             
                                                
                                                   
                                                      
                                                         {
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        p
                                                                        
                                                                           s
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           j
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        +
                                                                        1
                                                                        )
                                                                     
                                                                     =
                                                                     
                                                                        p
                                                                        
                                                                           s
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           j
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     +
                                                                     
                                                                        γ
                                                                        s
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           [
                                                                           
                                                                              ∑
                                                                              
                                                                                 i
                                                                                 =
                                                                                 1
                                                                              
                                                                              j
                                                                           
                                                                           
                                                                              (
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    s
                                                                                    ,
                                                                                    h
                                                                                    )
                                                                                    ∈
                                                                                    O
                                                                                    u
                                                                                    t
                                                                                    (
                                                                                    s
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    s
                                                                                    ,
                                                                                    h
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              )
                                                                           
                                                                           −
                                                                           
                                                                              R
                                                                              j
                                                                           
                                                                           ]
                                                                        
                                                                        
                                                                           
                                                                              p
                                                                              
                                                                                 s
                                                                              
                                                                              
                                                                                 d
                                                                                 ,
                                                                                 j
                                                                              
                                                                           
                                                                        
                                                                        +
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        p
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           j
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        +
                                                                        1
                                                                        )
                                                                     
                                                                     =
                                                                     
                                                                        p
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           j
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     +
                                                                     
                                                                        γ
                                                                        n
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           [
                                                                           
                                                                              ∑
                                                                              
                                                                                 i
                                                                                 =
                                                                                 1
                                                                              
                                                                              j
                                                                           
                                                                           
                                                                              (
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    n
                                                                                    ,
                                                                                    h
                                                                                    )
                                                                                    ∈
                                                                                    O
                                                                                    u
                                                                                    t
                                                                                    (
                                                                                    n
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    n
                                                                                    ,
                                                                                    h
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              −
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    h
                                                                                    ,
                                                                                    n
                                                                                    )
                                                                                    ∈
                                                                                    I
                                                                                    n
                                                                                    (
                                                                                    n
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    h
                                                                                    ,
                                                                                    n
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              )
                                                                           
                                                                           ]
                                                                        
                                                                        
                                                                           
                                                                              p
                                                                              
                                                                                 n
                                                                              
                                                                              
                                                                                 d
                                                                                 ,
                                                                                 j
                                                                              
                                                                           
                                                                        
                                                                        +
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        p
                                                                        
                                                                           d
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           j
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        +
                                                                        1
                                                                        )
                                                                     
                                                                     =
                                                                     
                                                                        p
                                                                        
                                                                           d
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           j
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     +
                                                                     
                                                                        γ
                                                                        d
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           [
                                                                           
                                                                              ∑
                                                                              
                                                                                 i
                                                                                 =
                                                                                 1
                                                                              
                                                                              j
                                                                           
                                                                           
                                                                              (
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    h
                                                                                    ,
                                                                                    d
                                                                                    )
                                                                                    ∈
                                                                                    I
                                                                                    n
                                                                                    (
                                                                                    d
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    h
                                                                                    ,
                                                                                    d
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              −
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    s
                                                                                    ,
                                                                                    h
                                                                                    )
                                                                                    ∈
                                                                                    O
                                                                                    u
                                                                                    t
                                                                                    (
                                                                                    s
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    s
                                                                                    ,
                                                                                    h
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              )
                                                                           
                                                                           ]
                                                                        
                                                                        
                                                                           
                                                                              p
                                                                              
                                                                                 d
                                                                              
                                                                              
                                                                                 d
                                                                                 ,
                                                                                 j
                                                                              
                                                                           
                                                                        
                                                                        +
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 

for each sink ∀d ∈ Dk
                                    (1 ≤ k ≤ N), 
                                       
                                          1
                                          ≤
                                          j
                                          ≤
                                          k
                                          −
                                          1
                                          ,
                                       
                                     where both step size γs
                                    (t) and step size γn
                                    (t) are positive, and n ∈ V∖{s, d}.

Node h ∈ V updates its transfer price with respect to multicast layer k and sink d ∈ Dk
                                     where 1 ≤ k ≤ N follows

                                       
                                          (5)
                                          
                                             
                                                
                                                   
                                                      
                                                         {
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        v
                                                                        
                                                                           s
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           k
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        +
                                                                        1
                                                                        )
                                                                     
                                                                     =
                                                                     
                                                                        v
                                                                        
                                                                           s
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           k
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     +
                                                                     
                                                                        δ
                                                                        s
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           [
                                                                           
                                                                              R
                                                                              k
                                                                           
                                                                           −
                                                                           
                                                                              ∑
                                                                              
                                                                                 i
                                                                                 =
                                                                                 1
                                                                              
                                                                              k
                                                                           
                                                                           
                                                                              
                                                                                 (
                                                                                 
                                                                                    ∑
                                                                                    
                                                                                       (
                                                                                       s
                                                                                       ,
                                                                                       h
                                                                                       )
                                                                                       ∈
                                                                                       O
                                                                                       u
                                                                                       t
                                                                                       (
                                                                                       s
                                                                                       )
                                                                                    
                                                                                 
                                                                                 
                                                                                    x
                                                                                    
                                                                                       s
                                                                                       ,
                                                                                       h
                                                                                    
                                                                                    
                                                                                       d
                                                                                       ,
                                                                                       i
                                                                                    
                                                                                 
                                                                                 )
                                                                              
                                                                              )
                                                                           
                                                                           ]
                                                                        
                                                                        
                                                                           
                                                                              v
                                                                              
                                                                                 s
                                                                              
                                                                              
                                                                                 d
                                                                                 ,
                                                                                 k
                                                                              
                                                                           
                                                                        
                                                                        +
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        v
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           k
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        +
                                                                        1
                                                                        )
                                                                     
                                                                     =
                                                                     
                                                                        v
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           k
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     +
                                                                     
                                                                        δ
                                                                        n
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           [
                                                                           
                                                                              ∑
                                                                              
                                                                                 i
                                                                                 =
                                                                                 1
                                                                              
                                                                              k
                                                                           
                                                                           
                                                                              (
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    h
                                                                                    ,
                                                                                    n
                                                                                    )
                                                                                    ∈
                                                                                    I
                                                                                    n
                                                                                    (
                                                                                    n
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    h
                                                                                    ,
                                                                                    n
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              −
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    n
                                                                                    ,
                                                                                    h
                                                                                    )
                                                                                    ∈
                                                                                    O
                                                                                    u
                                                                                    t
                                                                                    (
                                                                                    n
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    n
                                                                                    ,
                                                                                    h
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              )
                                                                           
                                                                           ]
                                                                        
                                                                        
                                                                           
                                                                              v
                                                                              
                                                                                 n
                                                                              
                                                                              
                                                                                 d
                                                                                 ,
                                                                                 k
                                                                              
                                                                           
                                                                        
                                                                        +
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        v
                                                                        
                                                                           d
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           k
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        +
                                                                        1
                                                                        )
                                                                     
                                                                     =
                                                                     
                                                                        v
                                                                        
                                                                           d
                                                                        
                                                                        
                                                                           d
                                                                           ,
                                                                           k
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     +
                                                                     
                                                                        δ
                                                                        d
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           [
                                                                           
                                                                              ∑
                                                                              
                                                                                 i
                                                                                 =
                                                                                 1
                                                                              
                                                                              k
                                                                           
                                                                           
                                                                              (
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    s
                                                                                    ,
                                                                                    h
                                                                                    )
                                                                                    ∈
                                                                                    O
                                                                                    u
                                                                                    t
                                                                                    (
                                                                                    s
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    s
                                                                                    ,
                                                                                    h
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              −
                                                                              
                                                                                 ∑
                                                                                 
                                                                                    (
                                                                                    h
                                                                                    ,
                                                                                    d
                                                                                    )
                                                                                    ∈
                                                                                    I
                                                                                    n
                                                                                    (
                                                                                    d
                                                                                    )
                                                                                 
                                                                              
                                                                              
                                                                                 x
                                                                                 
                                                                                    h
                                                                                    ,
                                                                                    d
                                                                                 
                                                                                 
                                                                                    d
                                                                                    ,
                                                                                    i
                                                                                 
                                                                              
                                                                              )
                                                                           
                                                                           ]
                                                                        
                                                                        
                                                                           
                                                                              v
                                                                              
                                                                                 d
                                                                              
                                                                              
                                                                                 d
                                                                                 ,
                                                                                 k
                                                                              
                                                                           
                                                                        
                                                                        +
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 

for each sink d ∈ Dk
                                     and 1 ≤ k ≤ N, where both step size γs
                                    (t) and step size γn
                                    (t) are positive, and n ∈ V∖{s, d}.

Note that the transfer price identically equal to zero in other cases which mean there is no transfer. For example, if d ∈ D
                           2, then 
                              
                                 
                                    p
                                    
                                       s
                                    
                                    
                                       d
                                       ,
                                       3
                                    
                                 
                                 ≡
                                 0
                                 ,
                              
                            and that is because the sinks in the layer 2 have completed the reception of all data required during the first two layers. Another example is 
                              
                                 
                                    p
                                    
                                       s
                                    
                                    
                                       d
                                       ,
                                       2
                                    
                                 
                                 ≡
                                 0
                              
                            which derives from the fact that the flow designated to the sinks belonging to layer 2 in the layer 2 can no longer be transferred to a higher layer.

Intuitively, multicast data layer with higher link net congestion price should be allocated more link bandwidth. We elect the layers of which the flow will aggravate the link net congestion and the layers of which the flow have caused more serious congestion on the link, and take the average cumulative congestion of these layers as the threshold value to update the link bandwidth.

The Subproblem 
                              
                                 P
                                 2
                              
                            can be solved by using the subgradient method [23]. Specifically, let 
                              
                                 
                                    
                                       P
                                       ^
                                    
                                    
                                       h
                                       ,
                                       n
                                    
                                    
                                       i
                                       ,
                                       k
                                       (
                                       d
                                       )
                                    
                                 
                                 =
                                 
                                    V
                                    
                                       h
                                       ,
                                       n
                                    
                                    
                                       d
                                       ,
                                       k
                                    
                                 
                                 −
                                 
                                    P
                                    
                                       h
                                       ,
                                       n
                                    
                                    
                                       i
                                       ,
                                       k
                                       (
                                       d
                                       )
                                    
                                 
                                 ,
                              
                            where (h, n) ∈ E, d ∈ Dk
                            and i ≤ k ≤ N, and interpret 
                              
                                 
                                    P
                                    ^
                                 
                                 
                                    h
                                    ,
                                    n
                                 
                                 
                                    i
                                    ,
                                    k
                                    (
                                    d
                                    )
                                 
                              
                            as the “net congestion price” at link (h, n) for the flow of layer i destined to sink d which belong to the multicast layer k. At each link (h, n), the amount of bandwidth 
                              
                                 y
                                 
                                    h
                                    ,
                                    n
                                 
                                 i
                              
                            that is allocated to layer i is as follows: ∀1 ≤ i ≤ N, (h, n) ∈ E, and if 
                              
                                 n
                                 =
                                 d
                                 ,
                              
                            then d ∈ Dk
                           , where i ≤ k ≤ N,

                              
                                 (6)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   y
                                                   
                                                      h
                                                      ,
                                                      n
                                                   
                                                   i
                                                
                                                
                                                   (
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                =
                                                
                                                   y
                                                   
                                                      h
                                                      ,
                                                      n
                                                   
                                                   i
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                +
                                                
                                                   
                                                      ɛ
                                                   
                                                   
                                                      h
                                                      ,
                                                      n
                                                   
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                
                                                   
                                                      [
                                                      
                                                         w
                                                         
                                                            h
                                                            ,
                                                            n
                                                         
                                                         i
                                                      
                                                      −
                                                      
                                                         E
                                                         
                                                            h
                                                            ,
                                                            n
                                                         
                                                      
                                                      
                                                         [
                                                         w
                                                         ]
                                                      
                                                      ]
                                                   
                                                   
                                                      
                                                         y
                                                         
                                                            h
                                                            ,
                                                            n
                                                         
                                                         i
                                                      
                                                   
                                                   +
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where

                              
                                 
                                    
                                       
                                          V
                                          
                                             h
                                             ,
                                             n
                                          
                                          
                                             d
                                             ,
                                             k
                                          
                                       
                                       =
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            h
                                                         
                                                         
                                                            d
                                                            ,
                                                            k
                                                         
                                                      
                                                      −
                                                      
                                                         v
                                                         
                                                            n
                                                         
                                                         
                                                            d
                                                            ,
                                                            k
                                                         
                                                      
                                                      −
                                                      
                                                         v
                                                         
                                                            d
                                                         
                                                         
                                                            d
                                                            ,
                                                            k
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            h
                                                         
                                                         
                                                            d
                                                            ,
                                                            k
                                                         
                                                      
                                                      +
                                                      
                                                         v
                                                         
                                                            n
                                                         
                                                         
                                                            d
                                                            ,
                                                            k
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            h
                                                         
                                                         
                                                            d
                                                            ,
                                                            k
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         v
                                                         
                                                            h
                                                         
                                                         
                                                            d
                                                            ,
                                                            k
                                                         
                                                      
                                                      −
                                                      
                                                         v
                                                         
                                                            n
                                                         
                                                         
                                                            d
                                                            ,
                                                            k
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             
                                          
                                       
                                       
                                       
                                          P
                                          
                                             h
                                             ,
                                             n
                                          
                                          
                                             i
                                             ,
                                             k
                                             (
                                             d
                                             )
                                          
                                       
                                       =
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               j
                                                               =
                                                               i
                                                            
                                                         
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            p
                                                            
                                                               h
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         −
                                                         
                                                            p
                                                            
                                                               n
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         −
                                                         
                                                            p
                                                            
                                                               d
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         )
                                                      
                                                      ,
                                                      
                                                   
                                                
                                                
                                                   
                                                      if
                                                      
                                                      
                                                      
                                                         h
                                                         =
                                                         s
                                                         ,
                                                         n
                                                         ∉
                                                         {
                                                         s
                                                         ,
                                                         d
                                                         }
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               j
                                                               =
                                                               i
                                                            
                                                         
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            p
                                                            
                                                               h
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         +
                                                         
                                                            p
                                                            
                                                               n
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         )
                                                      
                                                      ,
                                                      
                                                   
                                                
                                                
                                                   
                                                      if
                                                      
                                                      
                                                      
                                                         h
                                                         ∉
                                                         {
                                                         s
                                                         ,
                                                         d
                                                         }
                                                         ,
                                                         n
                                                         =
                                                         d
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               j
                                                               =
                                                               i
                                                            
                                                         
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         p
                                                         
                                                            h
                                                         
                                                         
                                                            d
                                                            ,
                                                            j
                                                         
                                                      
                                                      ,
                                                      
                                                   
                                                
                                                
                                                   
                                                      if
                                                      
                                                      
                                                      
                                                         h
                                                         =
                                                         s
                                                         ,
                                                         n
                                                         =
                                                         d
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               j
                                                               =
                                                               i
                                                            
                                                         
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            p
                                                            
                                                               h
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         −
                                                         
                                                            p
                                                            
                                                               n
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         )
                                                      
                                                      ,
                                                      
                                                   
                                                
                                                
                                                   otherwise;
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 
                                    
                                       
                                          
                                             [
                                             h
                                             ]
                                          
                                          
                                             z
                                          
                                          +
                                       
                                       =
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      h
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      if
                                                      
                                                      
                                                      
                                                         z
                                                         >
                                                         0
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      max
                                                      {
                                                      0
                                                      ,
                                                      h
                                                      }
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      if
                                                      
                                                      
                                                      
                                                         z
                                                         =
                                                         0
                                                      
                                                      ;
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           the cumulative net congestion of layer i on link (h, n) is

                              
                                 (7)
                                 
                                    
                                       
                                          w
                                          
                                             h
                                             ,
                                             n
                                          
                                          i
                                       
                                       =
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            k
                                                            =
                                                            i
                                                         
                                                         N
                                                      
                                                      
                                                         ∑
                                                         
                                                            d
                                                            ∈
                                                            
                                                               D
                                                               k
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            [
                                                            
                                                               
                                                                  P
                                                                  ^
                                                               
                                                               
                                                                  h
                                                                  ,
                                                                  n
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  k
                                                                  (
                                                                  d
                                                                  )
                                                               
                                                            
                                                            ]
                                                         
                                                         +
                                                      
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      if
                                                      
                                                      
                                                      
                                                         n
                                                         ≠
                                                         d
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                      
                                                      
                                                      
                                                         
                                                            [
                                                            
                                                               
                                                                  P
                                                                  ^
                                                               
                                                               
                                                                  h
                                                                  ,
                                                                  n
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  k
                                                                  (
                                                                  d
                                                                  )
                                                               
                                                            
                                                            ]
                                                         
                                                         +
                                                      
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      if
                                                      
                                                      
                                                      
                                                         n
                                                         =
                                                         d
                                                      
                                                      ;
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where ε
                              h, n
                           (t) is a positive step-size and E
                           
                              h, n
                           [w(t)] denotes the minimal of those 
                              
                                 
                                    
                                       w
                                       ¯
                                    
                                    
                                       h
                                       ,
                                       n
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                              
                            at time t such that 
                              
                                 
                                    
                                       w
                                       ¯
                                    
                                    
                                       h
                                       ,
                                       n
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    1
                                    
                                       
                                          |
                                       
                                       
                                          N
                                          
                                             h
                                             ,
                                             n
                                          
                                          ′
                                       
                                       
                                          
                                             (
                                             t
                                             )
                                          
                                          |
                                       
                                    
                                 
                                 
                                    ∑
                                    
                                       i
                                       ∈
                                       
                                          N
                                          
                                             h
                                             ,
                                             n
                                          
                                          ′
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    w
                                    
                                       h
                                       ,
                                       n
                                    
                                    i
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 
                                 with
                                 
                                 
                                    N
                                    
                                       h
                                       ,
                                       n
                                    
                                    ′
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 :
                                 =
                                 
                                    {
                                    i
                                    ∣
                                    
                                       y
                                       
                                          h
                                          ,
                                          n
                                       
                                       i
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    >
                                    0
                                    or
                                    
                                       w
                                       
                                          h
                                          ,
                                          n
                                       
                                       i
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    ≥
                                    
                                       
                                          w
                                          ¯
                                       
                                       
                                          h
                                          ,
                                          n
                                       
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    ,
                                    i
                                    ∈
                                    
                                       {
                                       1
                                       ,
                                       …
                                       ,
                                       N
                                       }
                                    
                                    }
                                 
                              
                            
                           [13,24].

Over link (h, n), a random linear combination [25] of the data of first i multicast layers to all sinks d such that 
                              
                                 
                                    
                                       P
                                       ^
                                    
                                    
                                       h
                                       ,
                                       n
                                    
                                    
                                       i
                                       ,
                                       k
                                       (
                                       d
                                       )
                                    
                                 
                                 >
                                 0
                              
                            is sent at rate 
                              
                                 
                                    y
                                    
                                       h
                                       ,
                                       n
                                    
                                    i
                                 
                                 ,
                              
                            namely,

                              
                                 (8)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                   
                                                      h
                                                      ,
                                                      n
                                                   
                                                   
                                                      d
                                                      ,
                                                      i
                                                   
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                =
                                                
                                                   {
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  y
                                                                  
                                                                     h
                                                                     ,
                                                                     n
                                                                  
                                                                  i
                                                               
                                                               
                                                                  (
                                                                  t
                                                                  )
                                                               
                                                               ,
                                                            
                                                         
                                                         
                                                            
                                                               if
                                                               
                                                               
                                                               
                                                                  
                                                                     
                                                                        P
                                                                        ^
                                                                     
                                                                     
                                                                        h
                                                                        ,
                                                                        n
                                                                     
                                                                     
                                                                        i
                                                                        ,
                                                                        k
                                                                        (
                                                                        d
                                                                        )
                                                                     
                                                                  
                                                                  >
                                                                  0
                                                               
                                                               ,
                                                               
                                                               where
                                                               
                                                               
                                                                  d
                                                                  ∈
                                                               
                                                               
                                                               
                                                                  D
                                                                  k
                                                               
                                                               
                                                               and
                                                               
                                                               
                                                                  i
                                                                  ≤
                                                                  k
                                                                  ≤
                                                                  N
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               0
                                                               ,
                                                            
                                                         
                                                         
                                                            otherwise
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

According to (6) and the computing process of E
                           
                              h, n
                           [w(t)], we can come to the conclusion:

                              
                                 (9)
                                 
                                    
                                       
                                          ∑
                                          
                                             i
                                             =
                                             1
                                          
                                          N
                                       
                                       
                                          
                                             y
                                             ˙
                                          
                                          
                                             h
                                             ,
                                             n
                                          
                                          i
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                       =
                                       0
                                       .
                                    
                                 
                              
                           
                        

To implement the proposed distributed algorithm, each link (h, n), as well as each node h, is regarded as a processor of a distributed computation system. Assume that the processor for link (h, n) keeps track of variables 
                           
                              y
                              
                                 h
                                 ,
                                 n
                              
                              i
                           
                         and 
                           
                              
                                 x
                                 
                                    h
                                    ,
                                    n
                                 
                                 
                                    d
                                    ,
                                    i
                                 
                              
                              ,
                           
                         while the processor for node h keeps track of variables 
                           
                              v
                              
                                 h
                              
                              
                                 d
                                 ,
                                 k
                              
                           
                         and 
                           
                              p
                              
                                 h
                              
                              
                                 d
                                 ,
                                 j
                              
                           
                        . The proposed distributed algorithm can be implemented as follows:

The time complexity of the process for each node is O(NLU) and the time complexity of the process for each link is O(N
                        2
                        L
                        2
                        U), where N is the number of intermediate nodes, U is the number of sink nodes, and L is the number of multi-rate multicast layers. Thus the time complexity of the proposed distributed algorithm
                         is O(N
                        2
                        L
                        2
                        U).

The distributed control (3)–(6), and (8) is a partially-primal and dual algorithm. We consider the proposed algorithm as a nonlinear autonomous system and apply Lyapunov stability theorem to analyze the convergence behavior of the proposed algorithm as the proof in [22].

Because of the page limitation, we only point out the key of the proof.

If the equilibrium point x*
                         is some 
                           
                              
                                 x
                                 ^
                              
                              ≠
                              0
                              ,
                           
                         Lyapunov theorem is also true. Since in this case, we just need to consider the state vector of the system as 
                           
                              y
                              =
                              x
                              −
                              
                                 x
                                 ^
                              
                              ,
                           
                         the results of Lyapunov theorem can be applied.

If R
                        *, x
                        *, and y
                        * are the optimal source rate and multicast layer flow allocation of Problem 
                           
                              P
                              ,
                           
                         and p
                        * and v
                        * are optimal solution to the dual problem L(p, v), then by Karush–Kuhn–Tucker (KKT) conditions [23], they satisfy the constraints of Problem 
                           P
                         and the following relations:

                           
                              (10)
                              
                                 
                                    
                                       ∑
                                       
                                          d
                                          ∈
                                          
                                             D
                                             k
                                          
                                       
                                    
                                    
                                       U
                                       d
                                       ′
                                    
                                    
                                       (
                                       
                                          
                                             (
                                             
                                                R
                                                *
                                             
                                             )
                                          
                                          k
                                       
                                       )
                                    
                                    −
                                    
                                       (
                                       
                                          ∑
                                          
                                             d
                                             ∈
                                             
                                                D
                                                k
                                             
                                          
                                       
                                       
                                          
                                             (
                                             
                                                v
                                                *
                                             
                                             )
                                          
                                          
                                             s
                                          
                                          
                                             d
                                             ,
                                             k
                                          
                                       
                                       −
                                       
                                          ∑
                                          
                                             
                                                d
                                                ′
                                             
                                             ∈
                                             
                                                D
                                                
                                                   L
                                                   (
                                                   
                                                      d
                                                      ′
                                                   
                                                   )
                                                
                                             
                                             ,
                                             L
                                             
                                                (
                                                
                                                   d
                                                   ′
                                                
                                                )
                                             
                                             >
                                             k
                                          
                                       
                                       
                                          
                                             (
                                             
                                                p
                                                *
                                             
                                             )
                                          
                                          
                                             s
                                          
                                          
                                             
                                                d
                                                ′
                                             
                                             ,
                                             k
                                          
                                       
                                       )
                                    
                                    =
                                    0
                                    
                                    ∀
                                    
                                    
                                    k
                                    ∈
                                    
                                       {
                                       1
                                       ,
                                       …
                                       ,
                                       N
                                       }
                                    
                                 
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      x
                                                      *
                                                   
                                                   )
                                                
                                                
                                                   h
                                                   ,
                                                   n
                                                
                                                
                                                   d
                                                   ,
                                                   i
                                                
                                             
                                             =
                                             arg
                                             
                                                
                                                   max
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               x
                                                               *
                                                            
                                                            )
                                                         
                                                         
                                                            h
                                                            ,
                                                            n
                                                         
                                                         
                                                            d
                                                            ,
                                                            i
                                                         
                                                      
                                                      ≤
                                                      
                                                         
                                                            (
                                                            
                                                               y
                                                               *
                                                            
                                                            )
                                                         
                                                         
                                                            h
                                                            ,
                                                            n
                                                         
                                                         i
                                                      
                                                   
                                                
                                                
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      N
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            y
                                                            *
                                                         
                                                         )
                                                      
                                                      
                                                         h
                                                         ,
                                                         n
                                                      
                                                      i
                                                   
                                                   =
                                                   
                                                      C
                                                      
                                                         h
                                                         ,
                                                         n
                                                      
                                                      ′
                                                   
                                                
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      (
                                                      h
                                                      ,
                                                      n
                                                      )
                                                   
                                                
                                                
                                                   n
                                                   ≠
                                                   d
                                                
                                             
                                             
                                                
                                                   ∑
                                                   N
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                             
                                             
                                                
                                                   ∑
                                                   N
                                                
                                                
                                                   k
                                                   =
                                                   i
                                                
                                             
                                             
                                                ∑
                                                
                                                   d
                                                   ∈
                                                   
                                                      D
                                                      k
                                                   
                                                
                                             
                                             
                                                x
                                                
                                                   h
                                                   ,
                                                   n
                                                
                                                
                                                   d
                                                   ,
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      (
                                                      
                                                         V
                                                         *
                                                      
                                                      )
                                                   
                                                   
                                                      h
                                                      ,
                                                      n
                                                   
                                                   
                                                      d
                                                      ,
                                                      k
                                                   
                                                
                                                −
                                                
                                                   
                                                      (
                                                      
                                                         P
                                                         *
                                                      
                                                      )
                                                   
                                                   
                                                      h
                                                      ,
                                                      n
                                                   
                                                   
                                                      d
                                                      ,
                                                      j
                                                   
                                                
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      p
                                                      *
                                                   
                                                   )
                                                
                                                
                                                   h
                                                
                                                
                                                   d
                                                   ,
                                                   j
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                             
                                             ∀
                                             
                                             
                                             d
                                             ∈
                                             
                                                D
                                                k
                                             
                                             
                                                (
                                                1
                                                ≤
                                                k
                                                ≤
                                                N
                                                )
                                             
                                             ,
                                             1
                                             ≤
                                             j
                                             ≤
                                             k
                                             −
                                             1
                                             ,
                                             h
                                             ∈
                                             V
                                          
                                       
                                    
                                    
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  p
                                                                  *
                                                               
                                                               )
                                                            
                                                            
                                                               s
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            −
                                                            
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     *
                                                                  
                                                                  )
                                                               
                                                               j
                                                            
                                                            +
                                                            
                                                               
                                                                  ∑
                                                                  j
                                                               
                                                               
                                                                  i
                                                                  =
                                                                  1
                                                               
                                                            
                                                            
                                                               ∑
                                                               
                                                                  (
                                                                  s
                                                                  ,
                                                                  h
                                                                  )
                                                                  ∈
                                                                  O
                                                                  u
                                                                  t
                                                                  (
                                                                  s
                                                                  )
                                                               
                                                            
                                                            
                                                               
                                                                  (
                                                                  
                                                                     x
                                                                     *
                                                                  
                                                                  )
                                                               
                                                               
                                                                  s
                                                                  ,
                                                                  h
                                                               
                                                               
                                                                  d
                                                                  ,
                                                                  i
                                                               
                                                            
                                                            )
                                                         
                                                         =
                                                         0
                                                         ,
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  p
                                                                  *
                                                               
                                                               )
                                                            
                                                            
                                                               n
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            −
                                                            
                                                               
                                                                  ∑
                                                                  j
                                                               
                                                               
                                                                  i
                                                                  =
                                                                  1
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ∑
                                                                  
                                                                     (
                                                                     h
                                                                     ,
                                                                     n
                                                                     )
                                                                     ∈
                                                                     I
                                                                     n
                                                                     (
                                                                     n
                                                                     )
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        x
                                                                        *
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     h
                                                                     ,
                                                                     n
                                                                  
                                                                  
                                                                     d
                                                                     ,
                                                                     i
                                                                  
                                                               
                                                               −
                                                               
                                                                  ∑
                                                                  
                                                                     (
                                                                     n
                                                                     ,
                                                                     h
                                                                     )
                                                                     ∈
                                                                     O
                                                                     u
                                                                     t
                                                                     (
                                                                     n
                                                                     )
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        x
                                                                        *
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     n
                                                                     ,
                                                                     h
                                                                  
                                                                  
                                                                     d
                                                                     ,
                                                                     i
                                                                  
                                                               
                                                               )
                                                            
                                                            )
                                                         
                                                         =
                                                         0
                                                         ,
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  p
                                                                  *
                                                               
                                                               )
                                                            
                                                            
                                                               d
                                                            
                                                            
                                                               d
                                                               ,
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               
                                                                  ∑
                                                                  j
                                                               
                                                               
                                                                  i
                                                                  =
                                                                  1
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ∑
                                                                  
                                                                     (
                                                                     h
                                                                     ,
                                                                     d
                                                                     )
                                                                     ∈
                                                                     I
                                                                     n
                                                                     (
                                                                     d
                                                                     )
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        x
                                                                        *
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     h
                                                                     ,
                                                                     d
                                                                  
                                                                  
                                                                     d
                                                                     ,
                                                                     i
                                                                  
                                                               
                                                               −
                                                               
                                                                  ∑
                                                                  
                                                                     (
                                                                     s
                                                                     ,
                                                                     h
                                                                     )
                                                                     ∈
                                                                     O
                                                                     u
                                                                     t
                                                                     (
                                                                     s
                                                                     )
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        x
                                                                        *
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     s
                                                                     ,
                                                                     h
                                                                  
                                                                  
                                                                     d
                                                                     ,
                                                                     i
                                                                  
                                                               
                                                               )
                                                            
                                                            )
                                                         
                                                         =
                                                         0
                                                         ,
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       
                                          
                                             ∀
                                             
                                             
                                             d
                                             ∈
                                             
                                                D
                                                k
                                             
                                             ,
                                             1
                                             ≤
                                             k
                                             ≤
                                             N
                                             ,
                                             1
                                             ≤
                                             j
                                             ≤
                                             k
                                             −
                                             1
                                             ,
                                             n
                                             ∈
                                             V
                                             ∖
                                             
                                                {
                                                s
                                                ,
                                                d
                                                }
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Then if (R
                        *, x
                        *, y
                        *, p
                        *, v
                        *) is an equilibrium point of the primal-dual algorithm proposed in (3)–(6), and (8), by forming the following Lyapunov function V(v, p, y), we can prove that the algorithm is globally stable by using Lyapunov theory.

In this section, numerical simulation results are presented to complement the analysis in previous sections, and to verify the convergence, the performance improvement, and the implementation advantages of the proposed algorithm.

First of all, we conduct experiments on a simple multi-rate multicast graph adapted from the butterfly graph, as shown in Fig. 1
                        (a). The multicast graph is assumed to be directed and each link has one unit of capacity. Assume that there is only one source node s1 and three sink nodes d1, d2, and d3, with the same utility 
                           
                              
                                 U
                                 d
                              
                              
                                 (
                                 
                                    R
                                    
                                       L
                                       (
                                       d
                                       )
                                    
                                 
                                 )
                              
                              =
                              ln
                              
                                 (
                                 1
                                 +
                                 a
                                 ·
                                 
                                    R
                                    
                                       L
                                       (
                                       d
                                       )
                                    
                                 
                                 )
                              
                           
                        . We choose such a small, simple network topology to facilitate detailed discussions about the results.

According to the inter-layer network coding scheme, the sinks’ set D should be divided into two subsets D
                           1 and D
                           2 where d1 ∈ D
                           1 and d2, d3 ∈ D
                           2. In addition, source messages should be encoded into two layers. Thus, the sink node d1 only receives the data a1 of layer 1, and sink nodes d2 and d3 receive the data a1 and a2 of layer 1 and layer 2.

By theoretically analysis of the modified butterfly graph, we obtain the analytical solution of the layered network coding scheme, as shown in Fig. 1(a) and Table 1
                           , where 
                              
                                 
                                    Y
                                    
                                       1
                                       ×
                                       24
                                    
                                 
                                 =
                                 
                                    {
                                    
                                       y
                                       
                                          i
                                          ,
                                          j
                                       
                                       l
                                    
                                    |
                                    
                                       (
                                       i
                                       ,
                                       j
                                       )
                                    
                                    ∈
                                    E
                                    ,
                                    l
                                    =
                                    1
                                    ,
                                    2
                                    ,
                                    m
                                    =
                                    1
                                    }
                                 
                              
                           . Therein, in each tuple (a, b; c, d; e, f) of Fig. 1(b), elements a and b indicate the information flow of the first layer and the second layer destined for sink d1, respectively; elements c and d indicate similarly for sink d2, and similarly for elements e and f. In addition, in each tuple (h, i) of Fig. 1(c), elements h and i over each link indicate the physical flow of the first layer and the second layer over the link, respectively.

By carefully examining the analytical solution for the given multi-rate multicast network as shown in Fig. 1(d), we observe that the flow can indeed be divided into two multicast layers. It can be seen that the second multicast layer carries data in both layers, not just in layer 2. Moreover, note that sink node d3 does not receive any unit of flow in the first multicast layer, but then in order to compensate, receives two units of flow in the second multicast layer. Precisely, links (w1, v1), (v1, d2), and (v1, d3) transmit a combination of a1 and a2. At the node w1, the flow a1 in the first layer is transferred to the second layer. We say that for sinks d2 and d3, the data a1 in the first layer is “delayed” and transmitted together with the data in the second layer.

Then, we analyze the analytical layered solution for the given multicast network in Fig. 1(b)–(d) to further explain the specific physical significance of the congestion price and transfer price.

                              
                                 (a)
                                 Congestion price: At the node u
                                    1, the flow from the incoming link (s
                                    1, u
                                    1), when it is bigger than the throughput capability of the outgoing link (u
                                    1, w
                                    1) or the processing power of node u
                                    1, may cause congestion and need to pay the price for it.

Transfer price: At the node w
                                    1, some or all of the flow from the incoming link (u
                                    1, w
                                    1) in the first multicast layer is transferred to the second multicast layer, thus the first multicast layer gets some gains.

In this subsection, we start with the convergence behavior of the proposed algorithm.


                           Fig. 2
                            shows the evolution of source rates over different layers with step sizes 
                              
                                 
                                    α
                                    k
                                 
                                 =
                                 
                                    
                                       ɛ
                                    
                                    
                                       h
                                       ,
                                       n
                                    
                                 
                                 =
                                 0.01
                                 ,
                                 
                                    δ
                                    n
                                 
                                 =
                                 0.005
                                 ,
                              
                            and γn
                            being diminished gradually. It can be seen from the plots that the rate of layer 2 is well within 5% of their optimal values after 1500 iterations. Although the rate of layer 1 converges at a little slower rate for the gradually diminished step sizes of the transfer price. The convergence of the whole rate control algorithm is rather fast. We see that the source rates approach the corresponding optimum quickly.

We further compare the rate control solutions as shown in Fig. 3
                           . In this figure, “Our Scheme A” denotes the proposed algorithm with step sizes 
                              
                                 
                                    α
                                    k
                                 
                                 =
                                 
                                    
                                       ɛ
                                    
                                    
                                       h
                                       ,
                                       n
                                    
                                 
                                 =
                                 0.01
                                 ,
                                 
                                    δ
                                    n
                                 
                                 =
                                 0.005
                                 ,
                              
                            and γn
                            being diminished gradually. “Our Scheme B” denotes the proposed algorithm with step sizes 
                              
                                 
                                    α
                                    k
                                 
                                 =
                                 
                                    
                                       ɛ
                                    
                                    
                                       h
                                       ,
                                       n
                                    
                                 
                                 =
                                 0.01
                                 ,
                                 
                                    δ
                                    n
                                 
                                 =
                                 
                                    γ
                                    n
                                 
                                 =
                                 0.005
                              
                           . “SIFA A” and “SIFA B” come from [24] and [13], respectively. In “SIFA A”, physical and information flow iteration step sizes are equal to 0.005. We can see from the figures that compared to “SIFA A”, “Our Scheme A” can obtain much better multicast layer flow allocation result at the expense of more iterations. Meanwhile, due to the interaction of congestion price and transfer price, with the same multicast layer flow allocation and price adjustment, “our Scheme A” that sacrifices a little multicast layer flow allocation performance can achieve more effective rate control than “SIFA B”. In other words, “our Scheme A” gets a tradeoff between rate control and optimal flow allocation. Thus, “our Scheme A” is more suitable for multi-rate multicast based on inter-layer network coding to proceed rate control and multicast layer flow allocation. Moreover, “our Scheme B” is slightly better than “our Scheme A” for the simple butterfly graph with only a few sink nodes. However, as the sink nodes increases, “our Scheme A” is more flexible than “our Scheme B”. Besides, we notice that the time complexity of “SIFA A” and “SIFA B” are the same as our schemes.

Next, we investigate how the proposed algorithm performs when the network topology is random.

In this section, we consider a random network topology as shown in Fig. 4
                        , where the number next to the link is the capacity of that link.

Here we use the more flexible scheme “our Scheme A” mentioned in Section 5.1.4 to solve the flow optimization problem for the random network topology. Fig. 5
                           (a) shows the evolution results of the rates of layers. The results demonstrate that rate control using the proposed distributed algorithm approaches the maximum flow rates 2, 5, and 5.

We choose the more recently proposed scheme “SIFA B” to be compared with “our Scheme A”. Fig. 5(b) shows the evolution results of the rates of layers for this scheme. From Fig. 5, we can see that although “our Scheme A” converges more slowly than “SIFA B”, “our Scheme A” is more stable than “SIFA B”, of which the rates are a little oscillating all the time.

@&#CONCLUSION@&#

In this paper, we have proposed a distributed algorithm for optimizing the flow rates of inter-layer network coding-based multi-rate multicast in Internet of Things. The algorithm can be implemented in the transport layer to adjust source rates and in the network layer to carry out network coding with multicast layer flow allocation, as well as congestion price and transfer price update. We also proved the stability and convergence of the proposed iterative algorithm using Lyapunov theory. Compared to the intra-layer network coding schemes, the layered multicast scheme that allows the network coding performed across different layers has better flexibility and stability in optimizing the data flow.

@&#ACKNOWLEDGMENT@&#

This work was supported by the National Natural Science Foundation of China under Grants 61261017, 61162008, 61362006; by the Foundation of Key Laboratory of Universal Wireless Communications under Grant KFKT-2014102; by the Guangxi Natural Science Foundation under Grants 2013GXNSFAA019334 and 2015GXNSFBB139007; by the Foundation of Guangxi Key Laboratory of Wireless Wideband Communication & Signal Processing under Grants GXKL0614101, GXKL061501, GXKL0614202; by the Foundation of Guangxi Experiment Center of Information Science under Grant 20130310; and by the Foundation of Key Laboratory of Cognitive Radio and Information Processing under Grant CRKL150112

@&#REFERENCES@&#

