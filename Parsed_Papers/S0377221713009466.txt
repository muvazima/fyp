@&#MAIN-TITLE@&#Hop constrained Steiner trees with multiple root nodes

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           New optimization problem generalizing diameter and hop constrained tree problems.


                        
                        
                           
                           Analysis of special polynomial cases, NP-hardness proof and non-approximability result.


                        
                        
                           
                           Extended formulations based on layered graph reformulations and strengthening valid inequalities.


                        
                        
                           
                           Theoretical and computational comparisons between all models.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Integer programming

OR in telecommunications

Steiner tree

Hop-constraints

@&#ABSTRACT@&#


               
               
                  We consider a network design problem that generalizes the hop and diameter constrained Steiner tree problem as follows: Given an edge-weighted undirected graph with two disjoint subsets representing roots and terminals, find a minimum-weight subtree that spans all the roots and terminals so that the number of hops between each relevant node and an arbitrary root does not exceed a given hop limit H. The set of relevant nodes may be equal to the set of terminals, or to the union of terminals and root nodes. This article proposes integer linear programming models utilizing one layered graph for each root node. Different possibilities to relate solutions on each of the layered graphs as well as additional strengthening inequalities are then discussed. Furthermore, theoretical comparisons between these models and to previously proposed flow- and path-based formulations are given. To solve the problem to optimality, we implement branch-and-cut algorithms for the layered graph formulations. Our computational study shows their clear advantages over previously existing approaches.
               
            

@&#INTRODUCTION@&#

Quality-of-service aspects are among the major issues when designing modern telecommunication networks and in particular bounding the maximum overall delay of each relevant communication path is important. It is widely accepted that in many applications the delay along some connection mainly depends on the number of intermediate routers, i.e., hops, and that restricting the maximum length of each established path by some predefined threshold limits the probability of failures (see, e.g., Dahl, Gouveia, & Requejo, 2006; Salama, Reeves, & Viniotis, 1996). Furthermore, whenever redundancy is not of major importance it is usually desired that the final network has tree structure in order to ensure unique communication paths and to reduce the maintenance effort, cf. Salama (1996) and Salama et al. (1996).

The literature contains many works dedicated to two problems that fit into this framework, namely the “centralized” hop-constrained minimum spanning/Steiner tree problem (HMSTP/ HMStTP), see, e.g., Dahl et al. (2006), Gouveia (1995), Gouveia and Requejo (2001), Gouveia, Paias, and Sharma (2011), Gouveia, Simonetti, and Uchoa (2011), and Voß (1999) and the references therein, and the “decentralized” diameter-constrained minimum spanning/Steiner tree problem (DMSTP/DMStTP), see, e.g., Achuthan, Caccetta, Caccetta, and Geelen (1994), Gouveia and Magnanti (2003), Gouveia, Magnanti, and Requejo (2004, 2006), Gouveia et al. (2011), and Gruber (2009) and the references therein.

To define the HMSTP consider an undirected, edge-weighted graph 
                        
                           G
                           =
                           (
                           V
                           ,
                           E
                           )
                        
                      with node set V, edge set E, a hop limit 
                        
                           H
                           ∈
                           N
                        
                     , and one dedicated central node 
                        
                           r
                           ∈
                           V
                        
                     . The objective is to identify a minimum cost spanning tree such that the path between the root r and any node 
                        
                           v
                           ∈
                           V
                        
                      does consist of at most H edges. For the Steiner variant (HMStTP) we are further given a set of terminals 
                        
                           T
                           ⊂
                           V
                        
                      and the aim is to identify a minimum cost Steiner tree connecting all terminals such that the path between the root r and any terminal node 
                        
                           t
                           ∈
                           T
                        
                      does consist of at most H edges. To define the DMSTP consider, as before, an undirected, edge-weighted graph. The objective is to identify a minimum cost spanning tree such that the path between any two nodes does consist of at most D edges, for some given diameter limit 
                        
                           D
                           ∈
                           N
                        
                     . Changes to the Steiner variant (DMStTP) are analogous to the hop-constrained problems.

However, several other tree problems with hop constraints appear to be of practical interest and one objective of this work is to propose a more general framework to contextualize these problems. In practice we may have multiple (e.g., replicated) central servers in which case each server communicates with a subset of terminals, and lengths of the corresponding communication paths are limited. One of the important sparse mode multicast routing protocols is based on core-based trees (CBTs) (Ballardie, Francis, & Crowcroft, 1993). In this protocol, a set of “core routers” is given, and they all multicast the information to a set of other relevant nodes (these correspond to receivers, that can be other routers or even end users). In classical multicast routing, each core router builds its own communication tree (also known as the source tree architecture), connecting the core router with the group of its relevant nodes. In the sparse mode multicast routing, however, it is required that the union of subtrees associated to the core routers builds a single tree. In this latter concept, also known as the shared-tree architecture, a common tree is built that connects all core routers and their relevant nodes, cf. Gossain, de Morais Cordeiro, and Carlos (2002), Salama (1996), and Salama et al. (1996). CBTs offer better scalability when compared to the source tree architecture and their main applications are for the Internet Protocol Television (IPTV) and in Mobile Digital Video Broadcasting-Handheld (DVB-H), see Minoli (2007). To ensure that the communication delays are not too high and also to ensure a certain reliability of the network, additional hop constraints may be imposed along the communication paths, e.g., between each server–receiver pair, cf. Dahl et al. (2006).

In this paper, we provide a new generic mathematical model for the application described above. The problem is called the Hop Constrained Minimum Steiner Tree Problem with Multiple Root nodes (HSTPMR) problem. We are given an undirected graph 
                        
                           G
                           =
                           (
                           V
                           ,
                           E
                           )
                        
                     , with node set V, edge set E, edge costs 
                        
                           
                              
                                 c
                              
                              
                                 e
                              
                           
                           ⩾
                           0
                        
                     , for all 
                        
                           e
                           ∈
                           E
                        
                     , and a hop limit 
                        
                           H
                           ∈
                           N
                        
                     . The node set V contains two disjoint subsets: root nodes 
                        
                           R
                           ,
                           |
                           R
                           |
                           ⩾
                           1
                        
                     , and terminal nodes 
                        
                           T
                           ⊆
                           V
                           ⧹
                           R
                        
                     . Furthermore, we are given a set 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           ⊆
                           T
                           ∪
                           R
                        
                      of relevant nodes for which hop limits to all root nodes need to be considered.

A solution to the HSTPMR is a Steiner tree 
                        
                           
                              
                                 G
                              
                              
                                 ′
                              
                           
                           =
                           (
                           
                              
                                 V
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 E
                              
                              
                                 ′
                              
                           
                           )
                        
                      spanning all root and terminal nodes, i.e., 
                        
                           R
                           ∪
                           T
                           ⊆
                           
                              
                                 V
                              
                              
                                 ′
                              
                           
                        
                     , such that the hop constraints are met for all relevant nodes 
                        
                           v
                           ∈
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                        
                     . More precisely, for each relevant node 
                        
                           t
                           ∈
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                        
                      and each root 
                        
                           r
                           ∈
                           R
                        
                     , the unique path between t and r can contain at most H edges. The objective is to find a feasible subtree yielding minimum total edge costs. If 
                        
                           T
                           ∪
                           R
                           =
                           V
                        
                     , the solution will be a spanning tree of G.

In this study we consider two particular cases of this new framework which as far as we know have not been studied before (with exception to the introductory work in Gouveia, Leitner, & Ljubić (2012a)): (a) 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                           ∪
                           R
                        
                      and (b) 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                        
                     . In the first case, delay bounds between roots have to be taken into consideration (e.g., when roots model replica servers) and in the second case delays between roots are not critical (e.g., when services by different providers are offered to terminals). An illustrative instance of the HSTPMR with two roots and three terminals is given in Fig. 1
                     a, while Fig. 1b and c depict solutions to this instance for 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                           ∪
                           R
                        
                      and 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                        
                     , respectively, assuming that 
                        
                           H
                           =
                           3
                        
                     . Notice that one could generalize this problem even further by introducing subsets of roots and hop limits that would depend on each node from 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                        
                     .

However, the two cases already present different characteristics that strongly affect the corresponding models. For the case 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                           ∪
                           R
                        
                     , it is easy to see that the hop-constrained arborescences associated to each root span the same set of nodes and the same set of undirected edges. This property is useful to strengthen the models that will be proposed in the next subsection. Unfortunately, this property may not be satisfied in the case 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                        
                      since the maximum distance between any two roots may exceed H. In fact as can be deduced from Fig. 1c, the subtree obtained from undirecting the arcs of the hop-constrained arborescence associated to root 0 does not coincide with the subtree obtained from undirecting the arcs of the hop-constrained arborescence associated to root 1. Thus, many of the model enhancements valid for the case 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                           ∪
                           R
                        
                      that we will discuss below, will not be valid for 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                        
                     . The following results, however, provide an upper bound on the maximum distance between any two roots.
                        Lemma 1
                        
                           Let 
                           
                              
                                 
                                    
                                       G
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       V
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       E
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              
                            
                           be a feasible solution to an instance of the HSTPMR with 
                           
                              
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 T
                              
                            
                           and let 
                           
                              
                                 d
                                 (
                                 u
                                 ,
                                 v
                                 )
                              
                            
                           denote the distance between two nodes 
                           
                              
                                 u
                                 ,
                                 v
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       ′
                                    
                                 
                              
                            
                           in 
                           
                              
                                 
                                    
                                       G
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           . Then, the maximum distance between any pair of root nodes in 
                           
                              
                                 
                                    
                                       G
                                    
                                    
                                       ′
                                    
                                 
                              
                            
                           does not exceed 
                           
                              
                                 2
                                 H
                                 -
                                 ℓ
                              
                            
                           where 
                           
                              
                                 ℓ
                              
                            
                           is the maximum distance between any two terminal nodes in 
                           
                              
                                 
                                    
                                       G
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           , i.e., 
                           
                              
                                 ℓ
                                 =
                                 
                                    
                                       max
                                    
                                    
                                       u
                                       ,
                                       v
                                       ∈
                                       T
                                    
                                 
                                 d
                                 (
                                 u
                                 ,
                                 v
                                 )
                              
                           
                           .
                        

If there is a single terminal, two roots can be each at distance H from it, which gives the maximum distance of 
                              
                                 2
                                 H
                              
                           . Assume that 
                              
                                 |
                                 T
                                 |
                                 ⩾
                                 2
                              
                           , let 
                              
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                              
                            be two terminals at maximum distance and let 
                              
                                 P
                                 =
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       v
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       ℓ
                                    
                                 
                                 =
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                            (
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       ′
                                    
                                 
                              
                            for 
                              
                                 0
                                 ⩽
                                 i
                                 ⩽
                                 ℓ
                              
                           , and 
                              
                                 {
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 }
                                 ∈
                                 
                                    
                                       E
                                    
                                    
                                       ′
                                    
                                 
                              
                            for 
                              
                                 0
                                 ⩽
                                 i
                                 ⩽
                                 ℓ
                                 -
                                 1
                              
                           ) denote the path between 
                              
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                              
                            in 
                              
                                 
                                    
                                       G
                                    
                                    
                                       ′
                                    
                                 
                              
                           . Furthermore, let 
                              
                                 r
                                 ∈
                                 R
                              
                            be an arbitrary root and 
                              
                                 
                                    
                                       v
                                    
                                    
                                       j
                                    
                                 
                                 ∈
                                 P
                                 ,
                                 0
                                 ⩽
                                 j
                                 ⩽
                                 ℓ
                              
                           , be the node from P such that the path between r and 
                              
                                 
                                    
                                       v
                                    
                                    
                                       j
                                    
                                 
                              
                            is edge disjoint to P. Since, the maximum distance between a terminal and a root node may not exceed H, we have
                              
                                 
                                    d
                                    (
                                    r
                                    ,
                                    
                                       
                                          v
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    ⩽
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      H
                                                      -
                                                      ℓ
                                                      +
                                                      j
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      ⩽
                                                      ℓ
                                                      /
                                                      2
                                                   
                                                
                                                
                                                   
                                                      H
                                                      -
                                                      j
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      ⩾
                                                      ℓ
                                                      /
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           Now let 
                              
                                 s
                                 ∈
                                 R
                              
                            be another root and 
                              
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                                 ∈
                                 P
                                 ,
                                 0
                                 ⩽
                                 k
                                 ⩽
                                 ℓ
                              
                            again be the node from P such that the path between s and 
                              
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                              
                            is edge disjoint to P. Without loss of generality we assume that 
                              
                                 j
                                 ⩽
                                 k
                              
                           . Then, by case distinction it is easy to see that
                              
                                 
                                    d
                                    (
                                    r
                                    ,
                                    s
                                    )
                                    =
                                    d
                                    (
                                    r
                                    ,
                                    
                                       
                                          v
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    +
                                    d
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                    
                                    )
                                    +
                                    d
                                    (
                                    s
                                    ,
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                    
                                    )
                                    ⩽
                                    2
                                    H
                                    -
                                    ℓ
                                 
                              
                           holds and that this bound can be tight. □

The next corollary immediately follows from Lemma 1.
                        Corollary 1
                        
                           Let 
                           
                              
                                 diam
                                 (
                                 T
                                 )
                              
                            
                           be the minimum diameter of a subtree of G spanning all nodes from T. Then, for any feasible solution 
                           
                              
                                 
                                    
                                       G
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       V
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       E
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              
                            
                           to an instance of the HSTPMR on G with 
                           
                              
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 T
                              
                            
                           the maximum distance between any pair of root nodes in 
                           
                              
                                 
                                    
                                       G
                                    
                                    
                                       ′
                                    
                                 
                              
                            
                           does not exceed 
                           
                              
                                 
                                    
                                       H
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           , where 
                           
                              
                                 
                                    
                                       H
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 2
                                 H
                                 -
                                 diam
                                 (
                                 T
                                 )
                              
                           
                           .
                        

Notice that 
                        
                           
                              
                                 H
                              
                              
                                 ′
                              
                           
                        
                      can be calculated in polynomial time: It suffices to run breadth-first-search starting from each 
                        
                           t
                           ∈
                           T
                        
                      until all remaining terminals are reached. The subtree with the smallest diameter obtained gives us the value of 
                        
                           diam
                           (
                           T
                           )
                        
                     . As we will show in Section 3.4, this corollary allows us to provide modified models, where many of the enhancements directly valid for the case 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                           ∪
                           R
                        
                      apply. The drawback is that these modified models use many more variables and constraints than the original model without the enhancements.


                     Our Contribution. In this paper, besides introducing the general and new problem we present three kinds of results: (a) Complexity: We analyze special cases in which the HSTPMR can be reduced to previously studied network design problems, identify special polynomial cases, show that the problem is NP-hard in general, and that one cannot guarantee to find an approximation ratio better than 
                        
                           Θ
                           (
                           log
                           |
                           V
                           |
                           )
                        
                      unless P=NP. (b) Mixed integer programming (MIP) models: We discuss layered graph reformulations, present strengthening valid inequalities and show that the obtained models theoretically dominate flow- and path-based models studied in Gouveia et al. (2012a). (c) Computational results: Branch-and-cut algorithms are developed for layered graph models and computationally compared to each other and to the best performing approach from Gouveia et al. (2012a). Computations are carried out on a set of benchmark instances known from the HMSTP – the results show that the branch-and-cut approaches appear to be reasonable alternatives to solve these more general cases.


                     Outline of the Paper. In the remainder of this section we study the computational complexity of the HSTPMR. In Section 2 we discuss a generic integer linear programming (ILP) formulation of the problem and review a path-based formulation from our previous work (Gouveia et al., 2012a) which outperformed the other flow- and path-based models from Gouveia et al. (2012a) both theoretically, i.e., with respect to the quality of its linear programming (LP) bounds, and computationally. Afterwards, two possibilities for reformulating the HSTPMR over layered graphs together with further valid inequalities for strengthening the LP relaxations of the resulting models are discussed in Section 3. In Section 4 we compare our models with respect to their LP relaxation values and also show which variants dominate the previously proposed models. Details of the developed branch-and-cut approaches are given in Section 5, where we also discuss the results of our computational study. Finally, some conclusions are drawn in Section 6.

Next, we analyze the computational complexity of the HSTPMR and its relationship with other problems. Obviously, for singleton sets R and T the problem becomes the Hop Constrained Shortest Path Problem (HSPP) which can be solved in polynomial time for any H since we are given nonnegative edge costs. If either 
                           
                              |
                              R
                              |
                              =
                              1
                           
                         or 
                           
                              |
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              |
                              =
                              1
                           
                         (but not both), the problem is either the HMStTP if 
                           
                              V
                              
                              ≠
                              
                              T
                              ∪
                              R
                           
                         or the HMSTP if 
                           
                              V
                              =
                              T
                              ∪
                              R
                           
                        . These problems are known to be NP-hard if 
                           
                              2
                              ⩽
                              H
                              <
                              |
                              V
                              |
                              -
                              1
                           
                        , cf. (Gouveia, 1995). If 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              R
                           
                         or 
                           
                              |
                              T
                              |
                              =
                              1
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                        , we have the DMStTP or the DMSTP with the diameter equal to H which are known to be NP hard if 
                           
                              4
                              ⩽
                              H
                              <
                              |
                              V
                              |
                              -
                              1
                           
                        , cf. Garey and Johnson (1979).

In the remainder of this paper, we will consider the most general case, assuming that 
                           
                              H
                              ⩾
                              3
                              ,
                              |
                              R
                              |
                              ⩾
                              2
                           
                         and 
                           
                              |
                              T
                              |
                              ⩾
                              2
                           
                        , which is shown to be NP-hard by the following Lemma (see Appendix A for the proof).
                           Lemma 2
                           
                              Assuming that 
                              
                                 
                                    |
                                    R
                                    |
                                    ⩾
                                    2
                                 
                               
                              and 
                              
                                 
                                    |
                                    T
                                    |
                                    ⩾
                                    2
                                 
                              
                              , the HSTPMR can be solved in polynomial time for 
                              
                                 
                                    H
                                    =
                                    2
                                 
                              
                              . For 
                              
                                 
                                    H
                                    ⩾
                                    3
                                 
                              
                              , the problem is NP-hard, and it cannot be guaranteed to find an approximation ratio better than 
                              
                                 
                                    Θ
                                    (
                                    log
                                    n
                                    )
                                 
                               
                              unless P
                              
                              =
                              
                              NP.
                           

An overview on all complexity results regarding the HSTPMR and its relationships with related problems is provided in Table 1
                         where “
                           
                              ∈
                              P
                           
                        ” is used to denote cases when the problem is solvable in polynomial time and “–” denotes that a particular case is infeasible or that no previously considered problem corresponds to that case.


                        Notation. Let 
                           
                              S
                              =
                              V
                              ⧹
                              (
                              T
                              ∪
                              R
                              )
                           
                         denote the set of remaining nodes that we will refer to as potential Steiner nodes. To model a feasible solution 
                           
                              
                                 
                                    G
                                 
                                 
                                    ′
                                 
                              
                              =
                              (
                              
                                 
                                    V
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         on G, we will use binary edge variables, 
                           
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                           
                        , that are set to one if 
                           
                              {
                              i
                              ,
                              j
                              }
                              ∈
                              
                                 
                                    E
                                 
                                 
                                    ′
                                 
                              
                           
                        , and to zero, otherwise, for all 
                           
                              {
                              i
                              ,
                              j
                              }
                              ∈
                              E
                           
                        . In addition, we will use binary node variables associated to potential Steiner nodes: 
                           
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                           
                         is set to one if 
                           
                              i
                              ∈
                              
                                 
                                    V
                                 
                                 
                                    ′
                                 
                              
                              ∩
                              S
                           
                        , and to zero, otherwise, for all nodes 
                           
                              v
                              ∈
                              S
                           
                        . Furthermore, let 
                           
                              A
                              =
                              {
                              (
                              i
                              ,
                              j
                              )
                              ,
                              (
                              j
                              ,
                              i
                              )
                              |
                              {
                              i
                              ,
                              j
                              }
                              ∈
                              E
                              }
                           
                         denote the set of bi-directed arcs in G. For a subset 
                           
                              W
                              ⊂
                              V
                           
                        , we use 
                           
                              δ
                              (
                              W
                              )
                              =
                              {
                              {
                              i
                              ,
                              j
                              }
                              ∈
                              E
                              |
                              i
                              
                              ∉
                              
                              W
                              ,
                              j
                              ∈
                              W
                              }
                              ,
                              
                                 
                                    δ
                                 
                                 
                                    -
                                 
                              
                              (
                              W
                              )
                              =
                              {
                              (
                              i
                              ,
                              j
                              )
                              ∈
                              A
                              |
                              i
                              
                              ∉
                              
                              W
                              ,
                              j
                              ∈
                              W
                              }
                           
                        , and 
                           
                              
                                 
                                    δ
                                 
                                 
                                    +
                                 
                              
                              (
                              W
                              )
                              =
                              {
                              (
                              i
                              ,
                              j
                              )
                              ∈
                              A
                              |
                              i
                              ∈
                              W
                              ,
                              j
                              
                              ∉
                              
                              W
                              }
                           
                         to denote the undirected and directed, ingoing and outgoing cutset, respectively. For a set of arcs 
                           
                              
                                 
                                    A
                                 
                                 
                                    ′
                                 
                              
                           
                         and some vector of variables 
                           
                              z
                           
                        , we also use notation 
                           
                              z
                              [
                              
                                 
                                    A
                                 
                                 
                                    ′
                                 
                              
                              ]
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∈
                                    
                                       
                                          A
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              
                                 
                                    z
                                 
                                 
                                    ij
                                 
                              
                           
                        . Finally, for a binary vector 
                           
                              x
                              ∈
                              
                                 
                                    {
                                    0
                                    ,
                                    1
                                    }
                                 
                                 
                                    |
                                    E
                                    |
                                 
                              
                           
                         let 
                           
                              E
                              (
                              x
                              )
                           
                         denote the subset of edges for which 
                           
                              
                                 
                                    x
                                 
                                 
                                    e
                                 
                              
                              =
                              1
                           
                        .

Next we present a generic model for the HSTPMR which will be specialized later on by means of paths and layered graphs.

Let 
                        
                           F
                           =
                           {
                           x
                           ∈
                           
                              
                                 {
                                 0
                                 ,
                                 1
                                 }
                              
                              
                                 |
                                 E
                                 |
                              
                           
                           |
                           ∀
                           s
                           ∈
                           R
                           ,
                           
                           ∀
                           t
                           ∈
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           ,
                           
                           ∃
                           
                           s
                           -
                           t
                           
                           path
                           
                           P
                           
                           in
                           
                           E
                           (
                           x
                           )
                           
                           s
                           .
                           t
                           .
                           
                           |
                           P
                           |
                           ⩽
                           H
                           }
                        
                      be the set of incidence vectors that contain at least one feasible path between each 
                        
                           s
                           ∈
                           R
                        
                      and each 
                        
                           t
                           ∈
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           ⧹
                           {
                           s
                           }
                        
                     , i.e., a path of length at most H. A generic MIP model for the HSTPMR is given by (1)–(7):
                        
                           (1)
                           
                              min
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       {
                                       i
                                       ,
                                       j
                                       }
                                       ∈
                                       E
                                    
                                 
                              
                              
                                 
                                    c
                                 
                                 
                                    ij
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                           
                        
                     
                     
                        
                           (2)
                           
                              s
                              .
                              t
                              .
                              
                              x
                              ∈
                              F
                           
                        
                     
                     
                        
                           (3)
                           
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              ⩽
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              
                              i
                              ∈
                              S
                              ,
                              
                              {
                              i
                              ,
                              j
                              }
                              ∈
                              E
                           
                        
                     
                     
                        
                           (4)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       {
                                       i
                                       ,
                                       j
                                       }
                                       ∈
                                       E
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              =
                              |
                              R
                              |
                              +
                              |
                              T
                              |
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ∈
                                       S
                                    
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              -
                              1
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       {
                                       i
                                       ,
                                       j
                                       }
                                       ∈
                                       E
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              ⩾
                              2
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              
                              i
                              ∈
                              S
                           
                        
                     
                     
                        
                           (6)
                           
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              ∈
                              {
                              0
                              ,
                              1
                              }
                              
                              {
                              i
                              ,
                              j
                              }
                              ∈
                              E
                           
                        
                     
                     
                        
                           (7)
                           
                              
                                 
                                    y
                                 
                                 
                                    i
                                 
                              
                              ∈
                              {
                              0
                              ,
                              1
                              }
                              
                              i
                              ∈
                              S
                           
                        
                     
                  

Constraints (2) ensure that a solution must contain a feasible path for each commodity pair 
                        
                           (
                           s
                           ,
                           t
                           )
                        
                     . These constraints can be modeled in several ways by using multi-commodity flows, path variables and constraints, or jump inequalities. To discuss the constraints (3)–(5) which, together with (2) ensure that the solution is a tree, we first observe that due to constraints (2) the solution subgraph induced by the hop-constrained paths for all commodities will be connected. Hence, to obtain a valid model, we further add constraints (3) and (4), inequalities (3) to guarantee that a node variable is set to one whenever an incident edge is chosen and Eq. (4) to ensure that the number of edges in the solution is one less than the number of nodes. Finally, constraints (5) guarantee that the degree of each Steiner node in a feasible solution is at least two, i.e., Steiner nodes cannot be leaves of a solution. Due to the hop constraints these constraints also guarantee that the solution is not disconnected as illustrated by Fig. 2
                     . Thus (1)–(7) is a feasible model for the HSTPMR and Fig. 2 illustrates that constraints (5) are not redundant in this formulation since omitting them we may obtain isolated components.

In this section, we briefly recall model 
                           
                              
                                 
                                    UPath
                                 
                                 
                                    DI
                                 
                              
                           
                         from Gouveia et al. (2012a) which turned out to be the best model, both from a theoretical as well as from a computational perspective among all models presented in Gouveia et al. (2012a). Next to already introduced edge and node decision variables, 
                           
                              
                                 
                                    UPath
                                 
                                 
                                    DI
                                 
                              
                           
                         used disaggregated arc variables 
                           
                              
                                 
                                    a
                                 
                                 
                                    ij
                                 
                                 
                                    s
                                 
                              
                              ,
                              ∀
                              s
                              ∈
                              R
                              ,
                              ∀
                              (
                              i
                              ,
                              j
                              )
                              ∈
                              A
                           
                        , to indicate whether or not arc 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                         is used when interpreting the solution as an outgoing arborescence rooted at s. Furthermore, the set of all hop constrained paths 
                           
                              
                                 
                                    W
                                 
                                 
                                    st
                                 
                              
                              ⊆
                              
                                 
                                    2
                                 
                                 
                                    A
                                 
                              
                              ,
                              |
                              p
                              |
                              ⩽
                              H
                              ,
                              ∀
                              p
                              ∈
                              
                                 
                                    W
                                 
                                 
                                    st
                                 
                              
                           
                        , from each root 
                           
                              s
                              ∈
                              R
                           
                         to each relevant terminal 
                           
                              t
                              ∈
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              ⧹
                              {
                              s
                              }
                           
                         is considered and an exponential number of path variables 
                           
                              0
                              ⩽
                              
                                 
                                    λ
                                 
                                 
                                    p
                                 
                                 
                                    st
                                 
                              
                              ⩽
                              1
                           
                         one for each commodity pair 
                           
                              (
                              s
                              ,
                              t
                              )
                              ,
                              s
                              ∈
                              R
                              ,
                              t
                              ∈
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              ⧹
                              {
                              s
                              }
                           
                        , and each feasible path 
                           
                              p
                              ∈
                              
                                 
                                    W
                                 
                                 
                                    st
                                 
                              
                           
                         is introduced. Then, a valid path model is obtained by replacing (2) by (8)–(12) in model (1)–(7).
                           
                              (8)
                              
                                 
                                    
                                       a
                                    
                                    
                                       ij
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 
                                    
                                       a
                                    
                                    
                                       ji
                                    
                                    
                                       s
                                    
                                 
                                 =
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 {
                                 i
                                 ,
                                 j
                                 }
                                 ∈
                                 E
                              
                           
                        
                        
                           
                              (9)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          
                                             
                                                W
                                             
                                             
                                                st
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       λ
                                    
                                    
                                       p
                                    
                                    
                                       st
                                    
                                 
                                 =
                                 1
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 t
                                 ∈
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 ⧹
                                 {
                                 s
                                 }
                              
                           
                        
                        
                           
                              (10)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          
                                             
                                                W
                                             
                                             
                                                st
                                             
                                          
                                          :
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          p
                                       
                                    
                                 
                                 
                                    
                                       λ
                                    
                                    
                                       p
                                    
                                    
                                       st
                                    
                                 
                                 ⩽
                                 
                                    
                                       a
                                    
                                    
                                       ij
                                    
                                    
                                       s
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 t
                                 ∈
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 ⧹
                                 {
                                 s
                                 }
                                 ,
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 A
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    
                                       λ
                                    
                                    
                                       p
                                    
                                    
                                       st
                                    
                                 
                                 ⩾
                                 0
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 t
                                 ∈
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 ⧹
                                 {
                                 s
                                 }
                                 ,
                                 
                                 p
                                 ∈
                                 
                                    
                                       W
                                    
                                    
                                       st
                                    
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       a
                                    
                                    
                                       ij
                                    
                                    
                                       s
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 (
                                 i
                                 ,
                                 j
                                 )
                                 ∈
                                 A
                              
                           
                        Finally, for 
                           
                              
                                 
                                    UPath
                                 
                                 
                                    DI
                                 
                              
                           
                         we add the strengthening constraints (13) and (14) ensuring that the indegree of each node 
                           
                              i
                              
                              ∉
                              
                              R
                           
                         is identical for all arborescences and that Steiner nodes cannot be leaves in them. In turn, we remove (4) and (5) since these constraints were shown to be redundant in the resulting model (Gouveia et al., 2012a).
                           
                              (13)
                              
                                 
                                    
                                       a
                                    
                                    
                                       s
                                    
                                 
                                 [
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 i
                                 )
                                 ]
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                
                                                
                                                   i
                                                   ∈
                                                   S
                                                
                                             
                                             
                                                
                                                   0
                                                   ,
                                                
                                                
                                                   i
                                                   =
                                                   s
                                                
                                             
                                             
                                                
                                                   1
                                                   ,
                                                
                                                
                                                   else
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 i
                                 ∈
                                 V
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    
                                       a
                                    
                                    
                                       s
                                    
                                 
                                 [
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 i
                                 )
                                 ]
                                 ⩾
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 i
                                 ∈
                                 S
                              
                           
                        
                     

Reformulating hop-constrained network design problems using layered graphs recently became a popular technique for obtaining theoretically strong ILP models yielding tight LP bounds. Branch-and-cut algorithms used to solve these models are frequently among the leading approaches for the underlying problems, cf. Gouveia et al. (2011) and Ljubić and Gollowitzer (2013). In this section we show two different layered graph approaches that can be used to model the HSTPMR.

We now introduce one layered graph 
                           
                              
                                 
                                    G
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             A
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                    
                                 
                              
                           
                         for each root node 
                           
                              s
                              ∈
                              R
                           
                        . For every 
                           
                              s
                              ∈
                              R
                              ,
                              
                                 
                                    V
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                         is defined by its root node 
                           
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                           
                        , together with nodes 
                           
                              
                                 
                                    i
                                 
                                 
                                    h
                                 
                              
                              ,
                              1
                              ⩽
                              h
                              ⩽
                              H
                              -
                              1
                           
                        , for all original nodes 
                           
                              i
                              ∈
                              V
                              ⧹
                              {
                              s
                              }
                           
                         and nodes 
                           
                              
                                 
                                    t
                                 
                                 
                                    H
                                 
                              
                           
                         for all other relevant terminals 
                           
                              t
                              ∈
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              ⧹
                              {
                              s
                              }
                           
                        . For each pair of nodes 
                           
                              
                                 
                                    i
                                 
                                 
                                    h
                                 
                              
                              ,
                              
                                 
                                    j
                                 
                                 
                                    h
                                    +
                                    1
                                 
                              
                              ∈
                              
                                 
                                    V
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                         we add an arc 
                           
                              (
                              
                                 
                                    i
                                 
                                 
                                    h
                                 
                              
                              ,
                              
                                 
                                    j
                                 
                                 
                                    h
                                    +
                                    1
                                 
                              
                              )
                           
                         to 
                           
                              
                                 
                                    A
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                         if 
                           
                              (
                              i
                              ,
                              j
                              )
                              ∈
                              A
                           
                        . Formally, for each 
                           
                              s
                              ∈
                              R
                              ,
                              
                                 
                                    V
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                              =
                              {
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                              }
                              ∪
                              {
                              
                                 
                                    i
                                 
                                 
                                    h
                                 
                              
                              :
                              i
                              ∈
                              V
                              ⧹
                              {
                              s
                              }
                              ,
                              1
                              ⩽
                              h
                              ⩽
                              H
                              -
                              1
                              }
                              ∪
                              {
                              
                                 
                                    t
                                 
                                 
                                    H
                                 
                              
                              :
                              t
                              ∈
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              ⧹
                              {
                              s
                              }
                              }
                           
                         and 
                           
                              
                                 
                                    A
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 
                                    
                                       (
                                       
                                          
                                             i
                                          
                                          
                                             h
                                          
                                       
                                       ,
                                       
                                          
                                             j
                                          
                                          
                                             h
                                             +
                                             1
                                          
                                       
                                       )
                                       :
                                       
                                          
                                             i
                                          
                                          
                                             h
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             j
                                          
                                          
                                             h
                                             +
                                             1
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       (
                                       i
                                       ,
                                       j
                                       )
                                       ∈
                                       A
                                    
                                 
                              
                           
                        ; see Fig. 3
                         for an example.

In addition to the previously introduced node and edge design variables, we use two new sets of binary variables to model the problem in the layered graph framework. Variables 
                           
                              
                                 
                                    X
                                 
                                 
                                    ij
                                 
                                 
                                    sh
                                 
                              
                           
                        , are associated to arcs 
                           
                              (
                              
                                 
                                    i
                                 
                                 
                                    h
                                 
                              
                              ,
                              
                                 
                                    j
                                 
                                 
                                    h
                                    +
                                    1
                                 
                              
                              )
                              ∈
                              
                                 
                                    A
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                         and are set to one if the corresponding arc is part of the rooted Steiner arborescence in 
                           
                              
                                 
                                    G
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                        , for each 
                           
                              s
                              ∈
                              R
                           
                        . Variables 
                           
                              
                                 
                                    Y
                                 
                                 
                                    i
                                 
                                 
                                    sh
                                 
                              
                           
                         are associated to nodes 
                           
                              
                                 
                                    i
                                 
                                 
                                    h
                                 
                              
                              ∈
                              
                                 
                                    V
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                              ,
                              i
                              ∈
                              V
                              ,
                              0
                              ⩽
                              h
                              ⩽
                              H
                           
                        , and are set to one if the corresponding node is part of the rooted Steiner arborescence in 
                           
                              
                                 
                                    G
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                        , for each 
                           
                              s
                              ∈
                              R
                           
                        . The resulting MIP model to which we will refer to as 
                           
                              LG
                           
                         is given by (15)–(21) together with (3)–(7).
                           
                              (15)
                              
                                 
                                    min
                                 
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          {
                                          i
                                          ,
                                          j
                                          }
                                          ∈
                                          E
                                       
                                    
                                 
                                 
                                    
                                       c
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                              
                           
                        
                        
                           
                              (16)
                              
                                 s
                                 .
                                 t
                                 .
                                 
                                 
                                    
                                       X
                                    
                                    
                                       s
                                    
                                 
                                 [
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 i
                                 
                                 ≠
                                 
                                 s
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          1
                                       
                                       
                                          H
                                       
                                    
                                 
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   =
                                                   1
                                                
                                                
                                                   i
                                                   ∈
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ⧹
                                                   {
                                                   s
                                                   }
                                                
                                             
                                             
                                                
                                                   ⩽
                                                   1
                                                
                                                
                                                   i
                                                   ∈
                                                   R
                                                   ⧹
                                                   (
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ∪
                                                   {
                                                   s
                                                   }
                                                   )
                                                
                                             
                                             
                                                
                                                   ⩽
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ∈
                                                   S
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 i
                                 ∈
                                 V
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          
                                             
                                                i
                                             
                                             
                                                h
                                                -
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                h
                                             
                                          
                                          )
                                          ∈
                                          
                                             
                                                A
                                             
                                             
                                                L
                                             
                                             
                                                s
                                             
                                          
                                          ,
                                          
                                          i
                                          ≠
                                          k
                                       
                                    
                                 
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                    
                                       s
                                       ,
                                       h
                                       -
                                       1
                                    
                                 
                                 ⩾
                                 
                                    
                                       X
                                    
                                    
                                       jk
                                    
                                    
                                       sh
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 (
                                 
                                    
                                       j
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       h
                                       +
                                       1
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       A
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 j
                                 
                                 ≠
                                 
                                 s
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          0
                                       
                                       
                                          H
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ij
                                             
                                             
                                                sh
                                             
                                          
                                          +
                                          
                                             
                                                X
                                             
                                             
                                                ji
                                             
                                             
                                                sh
                                             
                                          
                                       
                                    
                                 
                                 ⩽
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 {
                                 i
                                 ,
                                 j
                                 }
                                 ∈
                                 E
                              
                           
                        
                        
                           
                              (20)
                              
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                    
                                       sh
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       h
                                       +
                                       1
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       A
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                              
                           
                        
                        
                           
                              (21)
                              
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    (3)–(7)
                                 
                              
                           
                        
                     

Indegree constraints (16) link arc to node variables on each layered graph, while constraints (17) ensure that each original node is used at most once on each layered graph and link node variables on the layered graph to original node variables for potential Steiner nodes. Since layered graphs are acyclic, inequalities (18) ensure connectivity on each layered graph, i.e., they guarantee that an arc 
                           
                              (
                              
                                 
                                    j
                                 
                                 
                                    h
                                 
                              
                              ,
                              
                                 
                                    k
                                 
                                 
                                    h
                                    +
                                    1
                                 
                              
                              )
                           
                         emanating from node 
                           
                              
                                 
                                    j
                                 
                                 
                                    h
                                 
                              
                           
                         may only be used if at least one ingoing arc 
                           
                              (
                              
                                 
                                    i
                                 
                                 
                                    h
                                    -
                                    1
                                 
                              
                              ,
                              
                                 
                                    j
                                 
                                 
                                    h
                                 
                              
                              )
                           
                         with 
                           
                              i
                              
                              ≠
                              
                              k
                           
                         is selected. Constraints (19) link arc variables on each layered graph to undirected edge variables on the original graph. Fig. 4
                         shows that in the context of this model, that is after adding all the information provided by the layered graph variables, constraints (4) and (5) are still necessary to guarantee that the final solution will be a tree.

Acyclicity of each layered graph, allows to eliminate subtours in model 
                           
                              LG
                           
                         using a polynomial number of constraints (18). Hence, 
                           
                              LG
                           
                         is a compact model which can be solved by LP-based branch-and-bound. It is well known, however, that one can strengthen layered graph based models by adding directed cutset constraints (22) where 
                           
                              
                                 
                                    V
                                 
                                 
                                    i
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             i
                                          
                                          
                                             h
                                          
                                       
                                       ∈
                                       
                                          
                                             V
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                       |
                                       1
                                       ⩽
                                       h
                                       ⩽
                                       H
                                    
                                 
                              
                           
                        .
                           
                              (22)
                              
                                 
                                    
                                       X
                                    
                                    
                                       s
                                    
                                 
                                 [
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 W
                                 )
                                 ]
                                 ⩾
                                 1
                                 ,
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 t
                                 ∈
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 ⧹
                                 {
                                 s
                                 }
                                 ,
                                 
                                 W
                                 ⊆
                                 
                                    
                                       V
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                                 ⧹
                                 {
                                 
                                    
                                       s
                                    
                                    
                                       0
                                    
                                 
                                 }
                                 ,
                                 
                                 
                                    
                                       V
                                    
                                    
                                       t
                                    
                                    
                                       s
                                    
                                 
                                 ⊆
                                 W
                              
                           
                        
                     

The resulting model will be denoted by 
                           
                              
                                 
                                    LG
                                 
                                 
                                    C
                                 
                              
                           
                        . It contains an exponential number of constraints and can be solved by branch-and-cut (B&C).

As pointed out in the introduction, the arborescences for each root share the same set of edges. Thus, we can replace inequalities by equations in (17) and (19), i.e., consider Eqs. (23) and (24) instead.
                           
                              (23)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          1
                                       
                                       
                                          H
                                       
                                    
                                 
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ∈
                                                   S
                                                
                                             
                                             
                                                
                                                   1
                                                
                                                
                                                   i
                                                   ∈
                                                   (
                                                   R
                                                   ∪
                                                   T
                                                   )
                                                   ⧹
                                                   {
                                                   s
                                                   }
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   i
                                                   =
                                                   s
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                              
                           
                        
                        
                           
                              (24)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          0
                                       
                                       
                                          H
                                          -
                                          1
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ij
                                             
                                             
                                                sh
                                             
                                          
                                          +
                                          
                                             
                                                X
                                             
                                             
                                                ji
                                             
                                             
                                                sh
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 {
                                 i
                                 ,
                                 j
                                 }
                                 ∈
                                 E
                              
                           
                        
                     

We use 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CI
                                 
                              
                           
                         to refer to model 
                           
                              
                                 
                                    LG
                                 
                                 
                                    C
                                 
                              
                           
                         where inequalities (17) and (19) are replaced by Eqs. (23) and (24). To make sure that the indegree of each Steiner node does not exceed its outdegree, we can further add (25) to obtain model 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CIO
                                 
                              
                           
                        .
                           
                              (25)
                              
                                 
                                    
                                       X
                                    
                                    
                                       s
                                    
                                 
                                 [
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 )
                                 ]
                                 ⩾
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 ∈
                                 
                                    
                                       V
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                 i
                                 ∈
                                 S
                              
                           
                        
                     

Another set of valid inequalities is derived from the fact that the distance between two roots must not depend on the arborescence considered, i.e., on the chosen root. Root-depth constraints 
                        (26) which are further added to obtain model 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CIOR
                                 
                              
                           
                         simply state that if root 
                           
                              q
                              ∈
                              R
                           
                         is on level h w.r.t. 
                           
                              
                                 
                                    G
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                        , then root 
                           
                              s
                              ∈
                              R
                           
                         must be on the same level w.r.t. 
                           
                              
                                 
                                    G
                                 
                                 
                                    L
                                 
                                 
                                    q
                                 
                              
                           
                        .
                           
                              (26)
                              
                                 
                                    
                                       Y
                                    
                                    
                                       q
                                    
                                    
                                       sh
                                    
                                 
                                 =
                                 
                                    
                                       Y
                                    
                                    
                                       s
                                    
                                    
                                       qh
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 q
                                 ∈
                                 R
                                 ⧹
                                 {
                                 s
                                 }
                                 ,
                                 1
                                 ⩽
                                 h
                                 ⩽
                                 H
                              
                           
                        
                     

As pointed out above, the strengthening inequalities (23) and (24) are not valid in this case since we cannot simply ensure that the arborescences for each root share the same set of edges. Corollary 1 permits us to introduce a different layered graph model 
                           
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                         containing 
                           
                              
                                 
                                    H
                                 
                                 
                                    ′
                                 
                              
                           
                         layers for the case 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                           
                         in which all arborescences use the same set of original nodes and edges. In each such graph 
                           
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                           
                         the maximum layer 
                           
                              H
                              (
                              i
                              )
                           
                         of some original node 
                           
                              i
                              ∈
                              V
                           
                         is defined as
                           
                              
                                 H
                                 (
                                 i
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   if
                                                   
                                                   i
                                                   =
                                                   s
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         H
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   i
                                                   ∈
                                                   R
                                                   ⧹
                                                   {
                                                   s
                                                   }
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         H
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   -
                                                   1
                                                
                                                
                                                   if
                                                   
                                                   i
                                                   ∈
                                                   S
                                                
                                             
                                             
                                                
                                                   H
                                                
                                                
                                                   if
                                                   
                                                   i
                                                   ∈
                                                   T
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Formally, for each 
                           
                              s
                              ∈
                              R
                              ,
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   A
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                    
                                 
                              
                           
                         is defined by 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                              =
                              {
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                              }
                              
                              ∪
                              {
                              
                                 
                                    i
                                 
                                 
                                    h
                                 
                              
                              :
                              i
                              ∈
                              V
                              ⧹
                              {
                              s
                              }
                              ,
                              1
                              ⩽
                              h
                              ⩽
                              H
                              (
                              i
                              )
                              }
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    L
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 
                                    
                                       (
                                       
                                          
                                             i
                                          
                                          
                                             h
                                          
                                       
                                       ,
                                       
                                          
                                             j
                                          
                                          
                                             h
                                             +
                                             1
                                          
                                       
                                       )
                                       :
                                       
                                          
                                             i
                                          
                                          
                                             h
                                          
                                       
                                       ∈
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             j
                                          
                                          
                                             h
                                             +
                                             1
                                          
                                       
                                       ∈
                                       
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             L
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       (
                                       i
                                       ,
                                       j
                                       )
                                       ∈
                                       A
                                    
                                 
                              
                           
                        .

Based on this observations, model (27)–(33) to which we will refer to as 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                              
                           
                         uses the same set of variables as the previous model. Note, however, that for this case we consider 
                           
                              
                                 
                                    H
                                 
                                 
                                    ′
                                 
                              
                           
                         layers which is almost as twice as the number of layers in the original graph. On the other hand, the model defined in this extended layered graph permits us to use the strengthening inequalities that have been used for the 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                         case.
                           
                              (27)
                              
                                 
                                    min
                                 
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          {
                                          i
                                          ,
                                          j
                                          }
                                          ∈
                                          E
                                       
                                    
                                 
                                 
                                    
                                       c
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                              
                           
                        
                        
                           
                              (28)
                              
                                 s
                                 .
                                 t
                                 .
                                 
                                 
                                    
                                       X
                                    
                                    
                                       s
                                    
                                 
                                 [
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 i
                                 
                                 ≠
                                 
                                 s
                              
                           
                        
                        
                           
                              (29)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          1
                                       
                                       
                                          H
                                          (
                                          i
                                          )
                                       
                                    
                                 
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   i
                                                   ∈
                                                   (
                                                   T
                                                   ∪
                                                   R
                                                   )
                                                   ⧹
                                                   {
                                                   s
                                                   }
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                                
                                                   i
                                                   ∈
                                                   S
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 i
                                 ∈
                                 V
                              
                           
                        
                        
                           
                              (30)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          (
                                          
                                             
                                                i
                                             
                                             
                                                h
                                                -
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                h
                                             
                                          
                                          )
                                          ∈
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                L
                                             
                                             
                                                s
                                             
                                          
                                          ,
                                          
                                          i
                                          ≠
                                          k
                                       
                                    
                                 
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                    
                                       s
                                       ,
                                       h
                                       -
                                       1
                                    
                                 
                                 ⩾
                                 
                                    
                                       X
                                    
                                    
                                       jk
                                    
                                    
                                       sh
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 (
                                 
                                    
                                       j
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       h
                                       +
                                       1
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                 j
                                 
                                 ≠
                                 
                                 s
                              
                           
                        
                        
                           
                              (31)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          0
                                       
                                       
                                          H
                                          (
                                          i
                                          )
                                       
                                    
                                 
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                    
                                       sh
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          0
                                       
                                       
                                          H
                                          (
                                          j
                                          )
                                       
                                    
                                 
                                 
                                    
                                       X
                                    
                                    
                                       ji
                                    
                                    
                                       sh
                                    
                                 
                                 =
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 {
                                 i
                                 ,
                                 j
                                 }
                                 ∈
                                 E
                              
                           
                        
                        
                           
                              (32)
                              
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                    
                                       sh
                                    
                                 
                                 ⩾
                                 0
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       h
                                       +
                                       1
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                              
                           
                        
                        
                           
                              (33)
                              
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 ⩾
                                 0
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    (5)–(7)
                                 
                              
                           
                        
                     

Note that, we do not include constraints (3) and (4) in model 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                              
                           
                         since they are redundant as we will prove in Section 4. As previously discussed, by considering directed cutset constraints (34) we can obtain a stronger model 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                                 
                                    C
                                 
                              
                           
                         which contains an exponential number of constraints. To avoid that Steiner nodes may be leaves in any of the arborescences, we further add inequalities (35) yielding model 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                                 
                                    CO
                                 
                              
                           
                        . Finally, by the same arguments as before root-depth constraints (36) are valid and we will use 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                                 
                                    COR
                                 
                              
                           
                         to refer to the resulting model.
                           
                              (34)
                              
                                 
                                    
                                       X
                                    
                                    
                                       s
                                    
                                 
                                 [
                                 
                                    
                                       δ
                                    
                                    
                                       -
                                    
                                 
                                 (
                                 W
                                 )
                                 ]
                                 ⩾
                                 1
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 t
                                 ∈
                                 (
                                 T
                                 ∪
                                 R
                                 )
                                 ⧹
                                 {
                                 s
                                 }
                                 ,
                                 
                                 W
                                 ⊆
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                                 ⧹
                                 {
                                 
                                    
                                       s
                                    
                                    
                                       0
                                    
                                 
                                 }
                                 ,
                                 
                                 {
                                 
                                    
                                       t
                                    
                                    
                                       h
                                    
                                 
                                 :
                                 1
                                 ⩽
                                 h
                                 ⩽
                                 H
                                 (
                                 t
                                 )
                                 }
                                 ⊆
                                 W
                              
                           
                        
                        
                           
                              (35)
                              
                                 
                                    
                                       X
                                    
                                    
                                       s
                                    
                                 
                                 [
                                 
                                    
                                       δ
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 )
                                 ]
                                 ⩾
                                 
                                    
                                       Y
                                    
                                    
                                       i
                                    
                                    
                                       sh
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                    
                                       i
                                    
                                    
                                       h
                                    
                                 
                                 ∈
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       L
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 i
                                 ∈
                                 S
                              
                           
                        
                        
                           
                              (36)
                              
                                 
                                    
                                       Y
                                    
                                    
                                       q
                                    
                                    
                                       sh
                                    
                                 
                                 =
                                 
                                    
                                       Y
                                    
                                    
                                       s
                                    
                                    
                                       qh
                                    
                                 
                                 
                                 s
                                 ∈
                                 R
                                 ,
                                 
                                 q
                                 ∈
                                 R
                                 ⧹
                                 {
                                 s
                                 }
                                 ,
                                 1
                                 ⩽
                                 h
                                 ⩽
                                 
                                    
                                       H
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                        
                     

In this section we compare the different formulations with respect to the value of their LP relaxation. In Section 4.1 we address the case 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                           ∪
                           R
                        
                      and in Section 4.2 we address that case 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           T
                        
                     . We also show that some set of constraints becomes redundant after the addition of some sets of valid inequalities.

By 
                        
                           
                              
                                 P
                              
                              
                                 M
                              
                           
                        
                      we will denote the convex hull of all feasible LP solutions of a MIP formulation M and by 
                        
                           
                              
                                 proj
                              
                              
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           (
                           
                              
                                 P
                              
                              
                                 M
                              
                           
                           )
                        
                     , the orthogonal projection of the convex hull of LP solutions of M onto the space defined by variables 
                        
                           
                              
                                 a
                              
                              
                                 1
                              
                           
                        
                     , …, 
                        
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                        
                     . Furthermore, by 
                        
                           
                              
                                 v
                              
                              
                                 LP
                              
                           
                           (
                           .
                           )
                        
                      we denote the value of the LP relaxation of some model. When comparing two formulations 
                        
                           
                              
                                 F
                              
                              
                                 1
                              
                           
                        
                      and 
                        
                           
                              
                                 F
                              
                              
                                 2
                              
                           
                        
                     , we say 
                        
                           
                              
                                 F
                              
                              
                                 1
                              
                           
                        
                      is stronger than 
                        
                           
                              
                                 F
                              
                              
                                 2
                              
                           
                        
                      if 
                        
                           
                              
                                 v
                              
                              
                                 LP
                              
                           
                           (
                           
                              
                                 F
                              
                              
                                 2
                              
                           
                           )
                           ⩽
                           
                              
                                 v
                              
                              
                                 LP
                              
                           
                           (
                           
                              
                                 F
                              
                              
                                 1
                              
                           
                           )
                        
                      and strictly stronger if there additionally exist instances for which strict inequality holds. Furthermore, if for two formulations, none of them is stronger than the other, we say that they are incomparable. In many cases strict dominance follows due to the computational results that will be discussed in Section 5.1. Usually, however, we will additionally provide solutions that are feasible for one model and not feasible for the other.

For better readability, Table 2
                      provides a summary of all model variants and their definitions.

The following theorem which is proved by a series of subsequent lemmas summarizes the obtained relations between the considered models when 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                        .
                           Theorem 4.1
                           
                              For 
                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                    ∪
                                    R
                                 
                              
                              , the following relations hold:
                           


                              
                                 
                                    
                                 
                              
                           


                              Thereby, an arrow indicates that the formulation at the target is strictly stronger than the one at the source while a dashed edge indicates that the corresponding formulations are incomparable.
                           


                              Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    LG
                                 
                              
                              .
                           

We skip the proof of this lemma, since it is well known that the result holds for the case of a single root and the result easily extends to multiple roots.
                           Lemma 4
                           
                              Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CI
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                              
                              . Furthermore, constraints 
                              
                                 (3) and (4)
                               
                              are redundant in 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CI
                                       
                                    
                                 
                              
                              .
                           

Since 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CI
                                       
                                    
                                 
                               contains all constraints of model 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               it is sufficient to consider the example given in Fig. 5 which shows that constraints (23) and (19) improve the LP bound. Computational results given in Section 5.1 further show this relation.

To prove the second result, consider an arbitrary root 
                                 
                                    s
                                    ∈
                                    R
                                 
                               and edge 
                                 
                                    {
                                    i
                                    ,
                                    j
                                    }
                                    ∈
                                    E
                                 
                               incident to some potential Steiner node 
                                 
                                    i
                                    ∈
                                    S
                                 
                              . To see that constraints (3) are redundant we use Eq. (24), (18), (16) and (23) together with the fact that the minimum and maximum layer of nodes 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          h
                                       
                                    
                                 
                               corresponding to potential Steiner nodes i is 1 and 
                                 
                                    H
                                    -
                                    1
                                 
                              , respectively:
                                 
                                    
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         ij
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (24)
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            0
                                                         
                                                         
                                                            H
                                                            -
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  X
                                                               
                                                               
                                                                  ji
                                                               
                                                               
                                                                  sh
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  X
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  sh
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            0
                                                         
                                                         
                                                            H
                                                            -
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         sh
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            H
                                                            -
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         sh
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            ⩽
                                                         
                                                         
                                                            
                                                               (18)
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   ⩽
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            0
                                                         
                                                         
                                                            H
                                                            -
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         sh
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            0
                                                         
                                                         
                                                            H
                                                            -
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        
                                                                           k
                                                                        
                                                                        
                                                                           h
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           i
                                                                        
                                                                        
                                                                           h
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                     )
                                                                     ∈
                                                                     
                                                                        
                                                                           A
                                                                        
                                                                        
                                                                           L
                                                                        
                                                                        
                                                                           s
                                                                        
                                                                     
                                                                     ,
                                                                  
                                                                  
                                                                     k
                                                                     ≠
                                                                     j
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         ki
                                                      
                                                      
                                                         sh
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            H
                                                            -
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   [
                                                   
                                                      
                                                         δ
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         i
                                                      
                                                      
                                                         h
                                                      
                                                   
                                                   )
                                                   ]
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (16)
                                                            
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            H
                                                            -
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         sh
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (23)
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

To show that Eq. (4) is implied:
                                 
                                    
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            {
                                                            i
                                                            ,
                                                            j
                                                            }
                                                            ∈
                                                            E
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         ij
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (24)
                                                            
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            {
                                                            i
                                                            ,
                                                            j
                                                            }
                                                            ∈
                                                            E
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            0
                                                         
                                                         
                                                            H
                                                            -
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  X
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  sh
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  X
                                                               
                                                               
                                                                  ji
                                                               
                                                               
                                                                  sh
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            ∈
                                                            V
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            H
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   [
                                                   
                                                      
                                                         δ
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         i
                                                      
                                                      
                                                         h
                                                      
                                                   
                                                   )
                                                   ]
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (16)
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (16)
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            ∈
                                                            V
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            H
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         sh
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (23)
                                                            
                                                         
                                                      
                                                   
                                                   |
                                                   R
                                                   |
                                                   +
                                                   |
                                                   T
                                                   |
                                                   +
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            ∈
                                                            S
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   1
                                                   
                                                   □
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           


                              Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CI
                                       
                                    
                                 
                              
                              . Furthermore, inequalities 
                              
                                 (5)
                               
                              are redundant in 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                              
                              .
                           

Since 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                               contains all constraints of 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CI
                                       
                                    
                                 
                              , it only remains to show that 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                               is strictly stronger. This relation can be seen from the computational results discussed in Section 5.1. In addition, Fig. 6
                               illustrates an example that is feasible for the 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CI
                                       
                                    
                                 
                               model, but it violates inequalities (25).

Finally, for each potential Steiner nodes 
                                 
                                    i
                                    ∈
                                    S
                                 
                              , inequalities (5) are redundant since:
                                 
                                    
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            {
                                                            i
                                                            ,
                                                            j
                                                            }
                                                            ∈
                                                            δ
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         ij
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (24)
                                                            
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            {
                                                            i
                                                            ,
                                                            j
                                                            }
                                                            ∈
                                                            δ
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            0
                                                         
                                                         
                                                            H
                                                            -
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  X
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  sh
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  X
                                                               
                                                               
                                                                  ji
                                                               
                                                               
                                                                  sh
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            H
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   [
                                                   
                                                      
                                                         δ
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         i
                                                      
                                                      
                                                         h
                                                      
                                                   
                                                   )
                                                   ]
                                                   +
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            0
                                                         
                                                         
                                                            H
                                                            -
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   [
                                                   
                                                      
                                                         δ
                                                      
                                                      
                                                         +
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         i
                                                      
                                                      
                                                         h
                                                      
                                                   
                                                   )
                                                   ]
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   
                                                      
                                                         
                                                            ⩾
                                                         
                                                         
                                                            
                                                               (16) and (25)
                                                            
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            H
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         sh
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            h
                                                            =
                                                            0
                                                         
                                                         
                                                            H
                                                            -
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         sh
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               (24)
                                                            
                                                         
                                                      
                                                   
                                                   2
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   
                                                   □
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           


                              Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIOR
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                              
                              .
                           

Since 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIOR
                                       
                                    
                                 
                               contains all constraints of 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                              , it only remains to show that root-depth constraints (26) can be violated in an optimal LP solutions of model 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                              . Consider the solution shown in Fig. 7
                               feasible for 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                               (
                                 
                                    H
                                    =
                                    5
                                    ;
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                    ∪
                                    R
                                 
                              ). Clearly, inequalities (26) are violated since 
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          1
                                       
                                       
                                          05
                                       
                                    
                                    
                                    ≠
                                    
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          0
                                       
                                       
                                          15
                                       
                                    
                                 
                               and also 
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          1
                                       
                                       
                                          04
                                       
                                    
                                    
                                    ≠
                                    
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          0
                                       
                                       
                                          14
                                       
                                    
                                 
                              .

It remains to show that, for solution values 
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    )
                                 
                               corresponding to Fig. 7a we cannot find a different set of feasible vectors 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          s
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          s
                                       
                                    
                                    )
                                    ,
                                    s
                                    ∈
                                    {
                                    0
                                    ,
                                    1
                                    }
                                 
                              , that satisfy constraints (26). This is established by the following two observations which will be proved in the following:
                                 
                                    1.
                                    For any solution vector 
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         ∼
                                                      
                                                   
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         ∼
                                                      
                                                   
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                          
                                        feasible w.r.t. 
                                          
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                             
                                                
                                                   y
                                                
                                                
                                                   ¯
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         ∼
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                                
                                                   05
                                                
                                             
                                             ⩾
                                             1
                                             /
                                             3
                                          
                                        holds.

For any solution vector 
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         ∼
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         ∼
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                          
                                        feasible w.r.t. 
                                          
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ¯
                                                
                                             
                                             ,
                                             
                                                
                                                   y
                                                
                                                
                                                   ¯
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   
                                                      
                                                         Y
                                                      
                                                      
                                                         ∼
                                                      
                                                   
                                                
                                                
                                                   0
                                                
                                                
                                                   15
                                                
                                             
                                             =
                                             0
                                          
                                        holds.

To see that 
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          1
                                       
                                       
                                          05
                                       
                                    
                                    =
                                    1
                                    /
                                    3
                                 
                               must hold, note that each path in Fig. 7a between nodes 0 and 3 consists of at least three edges. Since 
                                 
                                    H
                                    =
                                    5
                                 
                               and we need to establish a feasible connection from 0 to 9, this implies that 
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          3
                                       
                                       
                                          03
                                       
                                    
                                    =
                                    1
                                 
                               and thus through the path 0–5–7–3 and 0–1–6–3 we send 
                                 
                                    2
                                    /
                                    3
                                 
                               and 
                                 
                                    1
                                    /
                                    3
                                 
                               units of flow, respectively. Since indegree of 6 and 7 needs to be one, 
                                 
                                    1
                                    /
                                    3
                                 
                               units of flow are sent through 
                                 
                                    (
                                    6
                                    ,
                                    7
                                    )
                                    ,
                                    (
                                    3
                                    ,
                                    6
                                    )
                                    ,
                                    (
                                    2
                                    ,
                                    6
                                    )
                                 
                              . Consequently, 
                                 
                                    1
                                    /
                                    3
                                 
                               units of flow has to be sent along 0–5–7–3–6–1 to reach node 1 which means that 
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          1
                                       
                                       
                                          05
                                       
                                    
                                    ⩾
                                    1
                                    /
                                    3
                                 
                              .

Note that 
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          0
                                       
                                       
                                          15
                                       
                                    
                                    =
                                    0
                                 
                               means that node 0 cannot be at the last layer. To see that this holds observe that terminal 4 can only be reached through node 0. Therefore, when 1 is taken as the root, the maximal layer for node 0 is four. □


                              Formulation 
                              
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    LG
                                 
                              
                              .
                           

Let 
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          a
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          ¯
                                       
                                    
                                    )
                                 
                               be an optimal solution to the LP relaxation of formulation 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                              . We first show how to derive a solution 
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          ‾
                                       
                                    
                                    ,
                                    
                                       
                                          Y
                                       
                                       
                                          ‾
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          P
                                       
                                       
                                          LG
                                       
                                    
                                 
                               with the same objective value. The main difficulty in this derivation is that the linking constraints (19) of model 
                                 
                                    LG
                                 
                               sum over all copies of one edge 
                                 
                                    e
                                    ∈
                                    E
                                 
                               while the linking constraints (8) of model 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               consider each terminal individually. Thus, for each 
                                 
                                    s
                                    ∈
                                    R
                                 
                               and each arc 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∈
                                    A
                                 
                              , we use values of the variables 
                                 
                                    
                                       
                                          a
                                       
                                       
                                          ij
                                       
                                       
                                          s
                                       
                                    
                                 
                               to obtain the values of the variables 
                                 
                                    
                                       
                                          X
                                       
                                       
                                          ij
                                       
                                       
                                          sh
                                       
                                    
                                    ,
                                    (
                                    
                                       
                                          i
                                       
                                       
                                          h
                                       
                                    
                                    ,
                                    
                                       
                                          j
                                       
                                       
                                          h
                                          +
                                          1
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          A
                                       
                                       
                                          L
                                       
                                       
                                          s
                                       
                                    
                                    ,
                                    0
                                    ⩽
                                    h
                                    ⩽
                                    H
                                    -
                                    1
                                 
                               as follows:
                                 
                                    (37)
                                    
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             ij
                                          
                                          
                                             sh
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     a
                                                                  
                                                                  
                                                                     ¯
                                                                  
                                                               
                                                            
                                                            
                                                               ij
                                                            
                                                            
                                                               s
                                                            
                                                         
                                                      
                                                      
                                                         if
                                                         
                                                         i
                                                         =
                                                         s
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            max
                                                         
                                                         
                                                            
                                                               
                                                                  0
                                                                  ,
                                                                  
                                                                     min
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 
                                                                                    
                                                                                       a
                                                                                    
                                                                                    
                                                                                       ¯
                                                                                    
                                                                                 
                                                                              
                                                                              
                                                                                 ij
                                                                              
                                                                              
                                                                                 s
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                           
                                                                              
                                                                                 
                                                                                    ∑
                                                                                 
                                                                                 
                                                                                    (
                                                                                    
                                                                                       
                                                                                          k
                                                                                       
                                                                                       
                                                                                          h
                                                                                          -
                                                                                          1
                                                                                       
                                                                                    
                                                                                    ,
                                                                                    
                                                                                       
                                                                                          i
                                                                                       
                                                                                       
                                                                                          h
                                                                                       
                                                                                    
                                                                                    )
                                                                                    ∈
                                                                                    
                                                                                       
                                                                                          A
                                                                                       
                                                                                       
                                                                                          L
                                                                                       
                                                                                       
                                                                                          s
                                                                                       
                                                                                    
                                                                                    :
                                                                                    k
                                                                                    ≠
                                                                                    j
                                                                                 
                                                                              
                                                                           
                                                                           
                                                                              
                                                                                 
                                                                                    
                                                                                       X
                                                                                    
                                                                                    
                                                                                       ‾
                                                                                    
                                                                                 
                                                                              
                                                                              
                                                                                 ki
                                                                              
                                                                              
                                                                                 s
                                                                                 ,
                                                                                 h
                                                                                 -
                                                                                 1
                                                                              
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  -
                                                                  
                                                                     
                                                                        
                                                                           ∑
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 h
                                                                              
                                                                              
                                                                                 ′
                                                                              
                                                                           
                                                                           =
                                                                           0
                                                                        
                                                                        
                                                                           h
                                                                           -
                                                                           1
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              X
                                                                           
                                                                           
                                                                              ‾
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        ij
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              sh
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         otherwise
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              For each root s and for each arc 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                 
                              , the values 
                                 
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          ij
                                       
                                       
                                          sh
                                       
                                    
                                 
                               are defined recursively w.r.t. the layers starting from the root. Available capacities 
                                 
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          ij
                                       
                                       
                                          s
                                       
                                    
                                 
                               are distributed among the layers while respecting the connectivity constraints (18) and ensuring that 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          0
                                       
                                       
                                          H
                                          -
                                          1
                                       
                                    
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          ij
                                       
                                       
                                          sh
                                       
                                    
                                    ⩽
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          ij
                                       
                                       
                                          s
                                       
                                    
                                 
                              . We note that since 
                                 
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          s
                                       
                                    
                                    [
                                    
                                       
                                          δ
                                       
                                       
                                          -
                                       
                                    
                                    (
                                    i
                                    )
                                    ]
                                    ⩽
                                    1
                                    ,
                                    ∀
                                    i
                                    ∈
                                    V
                                 
                              , cf. (13), we can use Eq. (16) to set variable values 
                                 
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          i
                                       
                                       
                                          sh
                                       
                                    
                                    ,
                                    ∀
                                    s
                                    ∈
                                    R
                                    ,
                                    ∀
                                    
                                       
                                          i
                                       
                                       
                                          h
                                       
                                    
                                    ∈
                                    
                                       
                                          V
                                       
                                       
                                          L
                                       
                                       
                                          s
                                       
                                    
                                 
                              . To see that inequalities (17) hold, we first observe that for each node 
                                 
                                    i
                                    ∈
                                    V
                                 
                              , we have
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                1
                                             
                                             
                                                H
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   Y
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             i
                                          
                                          
                                             sh
                                          
                                       
                                       
                                          
                                             
                                                =
                                             
                                             
                                                
                                                   (16)
                                                
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                1
                                             
                                             
                                                H
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             s
                                          
                                       
                                       [
                                       
                                          
                                             δ
                                          
                                          
                                             -
                                          
                                       
                                       (
                                       
                                          
                                             i
                                          
                                          
                                             h
                                          
                                       
                                       )
                                       ]
                                       =
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                (
                                                j
                                                ,
                                                i
                                                )
                                                ∈
                                                A
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                1
                                             
                                             
                                                H
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             ji
                                          
                                          
                                             sh
                                          
                                       
                                       
                                          
                                             
                                                ⩽
                                             
                                             
                                                
                                                   (37)
                                                
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                (
                                                j
                                                ,
                                                i
                                                )
                                                ∈
                                                A
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ji
                                          
                                          
                                             s
                                          
                                       
                                       
                                          
                                             
                                                =
                                             
                                             
                                                
                                                   (13)
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     y
                                                                  
                                                                  
                                                                     ¯
                                                                  
                                                               
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                      
                                                         i
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         i
                                                         =
                                                         s
                                                      
                                                   
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         else
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

It remains to prove that for each root 
                                 
                                    s
                                    ∈
                                    R
                                 
                               and each terminal 
                                 
                                    t
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    ⧹
                                    {
                                    s
                                    }
                                    ,
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          1
                                       
                                       
                                          H
                                       
                                    
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          t
                                       
                                       
                                          sh
                                       
                                    
                                    =
                                    1
                                 
                               does hold. First observe that due to (9), (10), and (13) for each arc 
                                 
                                    (
                                    u
                                    ,
                                    t
                                    )
                                 
                               we have 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          
                                             
                                                W
                                             
                                             
                                                st
                                             
                                          
                                          :
                                          (
                                          u
                                          ,
                                          t
                                          )
                                          ∈
                                          p
                                       
                                    
                                    
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          p
                                       
                                       
                                          st
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          ut
                                       
                                       
                                          s
                                       
                                    
                                 
                              . Furthermore, for each arc 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ,
                                    i
                                    
                                    ≠
                                    
                                    s
                                 
                              , contained in the used set of paths from s to t, i.e., in the set 
                                 
                                    {
                                    p
                                    ∈
                                    
                                       
                                          W
                                       
                                       
                                          st
                                       
                                    
                                    |
                                    
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                    >
                                    0
                                    }
                                 
                              , we have 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          
                                             
                                                W
                                             
                                             
                                                st
                                             
                                          
                                          |
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          p
                                       
                                    
                                    
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                    ⩽
                                    
                                       
                                          ∑
                                       
                                       
                                          p
                                          ∈
                                          
                                             
                                                W
                                             
                                             
                                                st
                                             
                                          
                                          |
                                          (
                                          k
                                          ,
                                          i
                                          )
                                          ∈
                                          p
                                          ,
                                          k
                                          ≠
                                          j
                                       
                                    
                                    
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                 
                               since flow balance holds for each path. Thus, due to (37) we will distribute the total available capacity 
                                 
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          it
                                       
                                       
                                          s
                                       
                                    
                                 
                               for each arc 
                                 
                                    (
                                    i
                                    ,
                                    t
                                    )
                                 
                               with 
                                 
                                    t
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    ⧹
                                    {
                                    s
                                    }
                                 
                               on the arcs of the layered arborescence with root s, i.e., 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          1
                                       
                                       
                                          H
                                       
                                    
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          s
                                       
                                    
                                    [
                                    
                                       
                                          δ
                                       
                                       
                                          -
                                       
                                    
                                    (
                                    
                                       
                                          t
                                       
                                       
                                          h
                                       
                                    
                                    )
                                    ]
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          h
                                          =
                                          1
                                       
                                       
                                          H
                                       
                                    
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          t
                                       
                                       
                                          sh
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                a
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          s
                                       
                                    
                                    [
                                    
                                       
                                          δ
                                       
                                       
                                          -
                                       
                                    
                                    (
                                    t
                                    )
                                    ]
                                    =
                                    1
                                 
                              .

To see that the inequality can be strict consider the LP-solution 
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          ‾
                                       
                                    
                                    ,
                                    
                                       
                                          Y
                                       
                                       
                                          ‾
                                       
                                    
                                    )
                                 
                               given in Fig. 5 feasible for 
                                 
                                    LG
                                 
                              . It is, however, not possible to derive assignments of variable values 
                                 
                                    
                                       
                                          a
                                       
                                       
                                          0
                                       
                                    
                                 
                               and 
                                 
                                    
                                       
                                          a
                                       
                                       
                                          1
                                       
                                    
                                 
                               that satisfy all constraints of model 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                              . □


                              Formulations 
                              
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               
                              and 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               
                              are incomparable.
                           

We first consider the solution given in Fig. 5 which is a feasible LP-solution of 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               but infeasible for the LP relaxation of 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                              . Hence, it suffices to additionally consider an LP-solution feasible for 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               which is infeasible for 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                              . As already observed by Gouveia et al. (2011) for the single root case a path formulation allows to use the full capacity of arcs at different positions in paths to different terminals, while in a layered graph formulation total capacity must be equal to the sum of capacities on different positions independently of the considered terminal. Their example can be generalized to the multiple root case in a straightforward way. □


                              Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                              
                              .
                           

We show that given an LP solution 
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          ‾
                                       
                                    
                                    ,
                                    
                                       
                                          Y
                                       
                                       
                                          ‾
                                       
                                    
                                    )
                                 
                               of 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                               we can construct a solution 
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          a
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          ¯
                                       
                                    
                                    )
                                    ∈
                                    
                                       
                                          P
                                       
                                       
                                          
                                             
                                                UPath
                                             
                                             
                                                DI
                                             
                                          
                                       
                                    
                                 
                               using
                                 
                                    (38)
                                    
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ij
                                          
                                          
                                             s
                                          
                                       
                                       ≔
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                0
                                             
                                             
                                                H
                                                -
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             ij
                                          
                                          
                                             sh
                                          
                                       
                                       
                                       ∀
                                       s
                                       ∈
                                       R
                                       ,
                                       
                                       ∀
                                       (
                                       i
                                       ,
                                       j
                                       )
                                       ∈
                                       A
                                    
                                 
                              
                           

Hereby, to simplify the notation we assume that 
                                 
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ‾
                                             
                                          
                                       
                                       
                                          ij
                                       
                                       
                                          sh
                                       
                                    
                                    =
                                    0
                                 
                               if 
                                 
                                    (
                                    
                                       
                                          i
                                       
                                       
                                          h
                                       
                                    
                                    ,
                                    
                                       
                                          j
                                       
                                       
                                          h
                                          +
                                          1
                                       
                                    
                                    )
                                    
                                    ∉
                                    
                                    
                                       
                                          A
                                       
                                       
                                          L
                                       
                                       
                                          s
                                       
                                    
                                 
                              . From Lemma 4 we conclude that inequalities (3) are satisfied since they are implied by model 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          CIO
                                       
                                    
                                 
                              . Constraints (8) follow due to (38) and (24). Furthermore, from the directed cutset constraints (22), using the max-flow min-cut theorem together with the path decomposition of the flow we can construct the necessary set of paths on the layered graph for each root 
                                 
                                    s
                                    ∈
                                    R
                                 
                               and each relevant terminal 
                                 
                                    t
                                    ∈
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    ⧹
                                    {
                                    s
                                    }
                                 
                              . Since hop constraints are implicitly satisfied in the structure of the layered graph, constraints (9) and (10) are satisfied. Using (38), (16) and (23) we show that Eq. (13) are satisfied as follows:
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                (
                                                j
                                                ,
                                                i
                                                )
                                                ∈
                                                A
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ji
                                          
                                          
                                             s
                                          
                                       
                                       
                                          
                                             
                                                =
                                             
                                             
                                                
                                                   (38)
                                                
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                (
                                                j
                                                ,
                                                i
                                                )
                                                ∈
                                                A
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                0
                                             
                                             
                                                H
                                                -
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             ji
                                          
                                          
                                             sh
                                          
                                       
                                       =
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                1
                                             
                                             
                                                H
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             s
                                          
                                       
                                       [
                                       
                                          
                                             δ
                                          
                                          
                                             -
                                          
                                       
                                       (
                                       
                                          
                                             i
                                          
                                          
                                             h
                                          
                                       
                                       )
                                       ]
                                       
                                          
                                             
                                                =
                                             
                                             
                                                
                                                   (16)
                                                
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                1
                                             
                                             
                                                H
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   Y
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             i
                                          
                                          
                                             sh
                                          
                                       
                                       
                                          
                                             
                                                =
                                             
                                             
                                                
                                                   (23)
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     y
                                                                  
                                                                  
                                                                     ¯
                                                                  
                                                               
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                      
                                                         i
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         i
                                                         =
                                                         s
                                                      
                                                   
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         else
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              Finally, using the fact that potential Steiner nodes 
                                 
                                    i
                                    ∈
                                    S
                                 
                               do not exist in any layered graph at layer H, inequalities (14) hold for each root 
                                 
                                    s
                                    ∈
                                    R
                                 
                               since
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                                ∈
                                                A
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ij
                                          
                                          
                                             s
                                          
                                       
                                       
                                          
                                             
                                                =
                                             
                                             
                                                
                                                   (38)
                                                
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                                ∈
                                                A
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                0
                                             
                                             
                                                H
                                                -
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             ij
                                          
                                          
                                             sh
                                          
                                       
                                       =
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                0
                                             
                                             
                                                H
                                                -
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             s
                                          
                                       
                                       [
                                       
                                          
                                             δ
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             i
                                          
                                          
                                             h
                                          
                                       
                                       )
                                       ]
                                       
                                          
                                             
                                                ⩾
                                             
                                             
                                                
                                                   (25)
                                                
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                h
                                                =
                                                0
                                             
                                             
                                                H
                                                -
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   Y
                                                
                                                
                                                   ‾
                                                
                                             
                                          
                                          
                                             i
                                          
                                          
                                             sh
                                          
                                       
                                       
                                          
                                             
                                                =
                                             
                                             
                                                
                                                   (23)
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   y
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             i
                                          
                                       
                                       .
                                    
                                 
                              
                           

To see that the inclusion can be strict, we refer again to the previously mentioned straightforward generalization of the example provided by Gouveia et al. (2011) for the single root case. □

In this subsection we prove similar results for the case 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                           
                        . Again, the following theorem is proved by a series of subsequent lemmas.
                           Theorem 4.2
                           
                              For 
                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                 
                              
                              , the following relations hold:
                           


                              
                                 
                                    
                                 
                              
                           


                              Thereby, an arrow indicates that the formulation at the target is strictly stronger than the one at the source while a dashed edge indicates that the corresponding formulations are incomparable.
                           

In what follows, we will prove only those results stated in the latter theorem that are non-trivial and cannot be derived in a similar way as for the case 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                        .
                           Lemma 10
                           
                              Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    LG
                                 
                              
                              . Furthermore, formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          C
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                              
                              .
                           

We skip the proof of this result since it is well known for the case of one root and it is easy to find examples showing that the directed cutset constraints can be violated in optimal LP solutions of models 
                           
                              LG
                           
                         and 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                              
                           
                        , respectively.
                           Lemma 11
                           
                              Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    LG
                                 
                               
                              and formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          C
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                              
                              . Furthermore, constraints 
                              
                                 (3) and (4)
                               
                              are redundant in 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                              
                              .
                           

To see that 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                               is stronger than 
                                 
                                    LG
                                 
                              , we observe that it essentially differs from model 
                                 
                                    LG
                                 
                               by equations Eq. (29) which are lifted variants of inequalities (17) and Eq. (31) which are stronger versions of inequalities (19). To see that the relation is strict, we consider the LP-solution of 
                                 
                                    LG
                                 
                               corresponding to Fig. 8
                               and note that we cannot find a layered arborescence with root 1 feasible for 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                              , i.e., such that the indegree of node 0 is one, without increasing the variable value 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          01
                                       
                                    
                                 
                               or 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          03
                                       
                                    
                                 
                              .

The same arguments can be used when considering the formulations with directed cutset constraints, i.e., 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          C
                                       
                                    
                                 
                               and 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          C
                                       
                                    
                                 
                              . Redundancy of constraints (3) and (4) in 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                               can be shown using an analogous deduction as in Lemma 4 for the case 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                    ∪
                                    R
                                 
                              .□


                              Formulations 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                               
                              and 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               
                              are incomparable.
                           

We first observe that if 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                 
                              , the solution given in Fig. 8 is a valid LP solution for 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                              . As argued before, however, we cannot find a feasible arborescence with root 1 such that the indegree of 0 (and all terminals) is one. Since this argument does not depend on the maximum allowed path length (and thus on the number of layers on a layered graph) this solution is infeasible for 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                              . On the other hand, it is well known that the directed cutset constraints (22) can be violated in optimal LP-solutions of 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                    
                                 
                              . □


                              Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          CO
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          C
                                       
                                    
                                 
                              
                              . Formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          COR
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          CO
                                       
                                    
                                 
                              
                              . Furthermore, constraints 
                              
                                 (5)
                               
                              are redundant in 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          CO
                                       
                                    
                                 
                              
                              .
                           


                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          COR
                                       
                                    
                                 
                               contains all constraints of 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          CO
                                       
                                    
                                 
                               which in turn contains all constraints of 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          C
                                       
                                    
                                 
                              . Strict inequality can be seen by modifying the previously discussed exemplary solutions given in Fig. 6 and 
                              Fig. 7 to the case 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                 
                              . Redundancy of inequalities (5) in 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          CO
                                       
                                    
                                 
                               can be shown in an analogous way as for the case 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                    ∪
                                    R
                                 
                               in Lemma 5.□


                              Formulation 
                              
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    LG
                                 
                              
                              . Furthermore, formulation 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          CO
                                       
                                    
                                 
                               
                              is strictly stronger than formulation 
                              
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                              
                              .
                           

One can prove that 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               is stronger than 
                                 
                                    LG
                                 
                               and that 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          E
                                       
                                       
                                          CO
                                       
                                    
                                 
                               is stronger than 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               using analogous arguments than for the case 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                    ∪
                                    R
                                 
                              , cf., Lemmas 7 and 9. To see that the first relation can be strict consider the previously discussed example given in Fig. 8 which provides a feasible LP solution of 
                                 
                                    LG
                                 
                               which is infeasible for 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                              . For the second relation, again consider the previously mentioned straightforward generalization of the example from Gouveia et al. (2011) to the case with more than one root node.□


                              Formulations 
                              
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               
                              and 
                              
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               
                              are incomparable.
                           

As mentioned before for the case 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    T
                                    ∪
                                    R
                                 
                               an exemplary LP-solution feasible for 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                               but infeasible for 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               can be constructed as a straightforward generalization from the single root case (Gouveia et al., 2011). On the other hand, as discussed in Lemma 12 the solution given in Fig. 8 is feasible for 
                                 
                                    
                                       
                                          LG
                                       
                                       
                                          C
                                       
                                    
                                 
                               but we cannot find a feasible orientation with root 1 such that the indegree of 0 is one, i.e., the solution is infeasible for the LP-relaxation of 
                                 
                                    
                                       
                                          UPath
                                       
                                       
                                          DI
                                       
                                    
                                 
                              .□

In this section, we detail all components of the implemented branch-and-cut algorithms (B&C) for the different variants of 
                        
                           LG
                        
                      and 
                        
                           
                              
                                 LG
                              
                              
                                 E
                              
                           
                        
                      and of the column generation approach (CG) used to solve the LP relaxation of 
                        
                           
                              
                                 UPath
                              
                              
                                 DI
                              
                           
                        
                     . All approaches are implemented in C++ using IBM CPLEX 12.4 and all experiments have been performed on a single core of an Intel Xeon processor with 2.53gigahertz using at most 3gigabytes RAM.

For the separation of directed cutset constraints (22) or (34), respectively, we run the maximum flow algorithm of Cherkassky and Goldberg (1994). In all separation variants, we use nested and backcuts, cf. (Ljubić et al., 2006), and insert at most 100 violated cuts in each iteration. If a particular model considers outdegree constraints on potential Steiner nodes, cf. (25) and (35), or root-depth inequalities, cf. (26) or (36), they are separated dynamically, rather than statically inserted in the beginning, since preliminary tests showed that typically only very few of them will be violated.

In the column generation approach of 
                        
                           
                              
                                 UPath
                              
                              
                                 DI
                              
                           
                        
                     , a hop constrained shortest path problem between each root and each relevant node on a graph with nonnegative arc costs needs to be solved in order to solve the pricing subproblem. As originally proposed by Gouveia, Paias, and Sharma (2008) for a spanning tree problem with distance constraints we potentially add multiple path variables for each root terminal pair by considering the shortest paths to all nodes adjacent to a currently considered relevant node for all hop values 
                        
                           0
                           ⩽
                           h
                           ⩽
                           H
                           -
                           1
                        
                     , for more details see Gouveia et al. (2012a).


                     Benchmark Instances. Evaluation and comparison of the approaches and models is conducted on benchmark instances from Gouveia et al. (2011) that are typically used for testing HMSTP and DMSTP approaches. We choose the first instance from each of the groups of random (R) and Euclidean instances (C) with 31, 41, and 61 nodes. For the sake of simplicity we will use 30, 40, and 60 to refer to them. All graphs are complete and we use the first 
                        
                           |
                           T
                           |
                        
                      nodes as terminals and the last 
                        
                           |
                           R
                           |
                        
                      nodes as roots. In our experiments, we choose 
                        
                           |
                           R
                           |
                           ∈
                           {
                           2
                           ,
                           4
                           ,
                           6
                           ,
                           8
                           }
                           ,
                           |
                           T
                           |
                           ∈
                           {
                           5
                           ,
                           10
                           ,
                           15
                           ,
                           20
                           }
                        
                     , and test all possible combinations for hop limits 
                        
                           H
                           =
                           3
                           ,
                           …
                           ,
                           6
                        
                      and 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           ∈
                           {
                           T
                           ,
                           T
                           ∪
                           R
                           }
                        
                     .


                        Tables 3 and 4
                        
                         detail our results regarding the LP relaxations of all proposed models for 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                           
                        , respectively. Results are grouped by instance sets, numbers of root nodes, and the hop limit. The tables provide information on: the total number of instances in each group (
                           
                              #
                           
                        ), the number of instances for which the LP relaxation of a particular model could be solved within 7200 CPU-seconds (
                           
                              
                                 
                                    #
                                 
                                 
                                    solved
                                 
                              
                           
                        ), geometric means of the corresponding CPU-times, the numbers of instances for which the LP relaxation is integral (
                           
                              
                                 
                                    #
                                 
                                 
                                    int
                                 
                              
                           
                        ), average and maximum LP gaps in percent calculated by 
                           
                              (
                              OPT
                              -
                              
                                 
                                    v
                                 
                                 
                                    LP
                                 
                              
                              (
                              .
                              )
                              )
                              /
                              OPT
                           
                        . Notice, that 
                           
                              
                                 
                                    #
                                 
                                 
                                    all
                                 
                              
                           
                         denotes the number of instances for which the LP-relaxation could be solved by all models and for which the optimal IP solution is known. The values for 
                           
                              
                                 
                                    #
                                 
                                 
                                    int
                                 
                              
                           
                        , average and maximum gaps are calculated only among those instances.

We first observe that solving the LP relaxation of 
                           
                              
                                 
                                    UPath
                                 
                                 
                                    DI
                                 
                              
                           
                         needs significantly more CPU-time than solving the LP-relaxation of any of the layered graph models both for 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                         and for 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                           
                        . Furthermore, model 
                           
                              
                                 
                                    UPath
                                 
                                 
                                    DI
                                 
                              
                           
                         is not only theoretically dominated by the stronger layered graph variants but also exhibits significantly larger LP gaps in our test cases. Thus, it is clearly not competitive to the layered graph approaches. Since in the integer case the latter are additionally expected to benefit much more from built-in preprocessing of state-of-the-art ILP solvers we will not consider model 
                           
                              
                                 
                                    UPath
                                 
                                 
                                    DI
                                 
                              
                           
                         in the remainder of this study. Comparing the different layered graph models, the largest improvement on the reported LP gaps is obtained with the inclusion of the directed cutset constraints. On the other hand, their inclusion also significantly increases the runtime. From Table 3 we further observe that when 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                        , that is in the case where the arborescences of each root share the same set of nodes and edges, the addition of Eqs. (23) and (24), often yields a further significant reduction on the reported LP gaps. This reduction is usually obtained with no cost or only with little cost in terms of CPU-time. Adding outdegree constraints (25) for potential Steiner nodes on each layered graph and root-depth constraints (26) further reduces the obtained gaps in many cases. This improvement, however, is typically rather small. On the other hand, since we only dynamically separate these constraints the additional CPU-time is almost negligible.

For 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                           
                        , cf. Table 4, we conclude that despite the reported tighter LP bounds, the additional CPU-time needed to solve 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                              
                           
                         is not negligible compared to 
                           
                              LG
                           
                        .

Similar to our previous observations w.r.t. 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CI
                                 
                              
                           
                         in case 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                        , the bounds of model 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                                 
                                    C
                                 
                              
                           
                         are clearly better than those of 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                              
                           
                         or 
                           
                              
                                 
                                    LG
                                 
                                 
                                    C
                                 
                              
                           
                        . Outdegree and root-depth constraints produce a further, although usually rather small, improvement on the reported LP bounds. Their influence seems to be more significant for the larger random instances.

Overall, we conclude that the LP gaps usually increase with the instance size, increasing number of root nodes or decreasing hop limit and that the gaps resulting from random instances (R) are usually significantly larger than those resulting from the Euclidean instances (C). Furthermore, all proposed model enhancements are not only of theoretical importance but clearly tighten the LP bounds in many cases. In general the additional CPU-time needed to compute the tighter gaps is reasonable and, as we will see below, using the enhancements often contributes for solving the integer models.


                        Tables 5 and 6
                        
                         summarize the computational results for solving the layered graph models in the integer case for 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                           
                        , respectively. Here, we report the numbers of instances in each set (
                           
                              #
                           
                        ), the numbers of instances solved to proven optimality within the time limit of 7200 CPU-seconds (
                           
                              
                                 
                                    #
                                 
                                 
                                    solved
                                 
                              
                           
                        ), geometric means of CPU-times in seconds, average optimality gaps in percent, numbers of instances where the LP relaxation could be solved by each layered graph model (
                           
                              
                                 
                                    #
                                 
                                 
                                    L
                                 
                              
                           
                        ), and average optimality gaps in percent on them. Hereby, optimality gaps are calculated as 
                           
                              (
                              UB
                              -
                              LB
                              )
                              /
                              UB
                           
                         where 
                           
                              UB
                           
                         and 
                           
                              LB
                           
                         denote the obtained upper and lower bounds, respectively.

From Table 5, i.e., in case 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                        , we first observe that model 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CI
                                 
                              
                           
                         clearly outperforms the weaker variants 
                           
                              LG
                           
                         and 
                           
                              
                                 
                                    LG
                                 
                                 
                                    C
                                 
                              
                           
                         with respect to all analyzed criteria. Whether 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CI
                                 
                              
                           
                         or the two even stronger models 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CIO
                                 
                              
                           
                         and 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CIOR
                                 
                              
                           
                         perform best heavily depends on the considered instance and its parameters. On the one hand, 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CI
                                 
                              
                           
                         often yields the lowest CPU-times and optimality gaps after two hours. On the other hand, 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CIO
                                 
                              
                           
                         and 
                           
                              
                                 
                                    LG
                                 
                                 
                                    CIOR
                                 
                              
                           
                         successfully solve some instances to proven optimality that could not be solved by the theoretically weaker models. For 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                           
                         the benefit of the stronger models including the various enhancements is intensified. 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                                 
                                    COR
                                 
                              
                           
                         solved more instances to proven optimality than any of the other models. 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                                 
                                    C
                                 
                              
                           
                         and 
                           
                              
                                 
                                    LG
                                 
                                 
                                    E
                                 
                                 
                                    CO
                                 
                              
                           
                         also perform almost as good. With respect to needed CPU-times, these three models are usually quite close to each other and frequently exhibit a better overall performance than the weaker variants. In particular, we conclude that considering the extended layered graph with 
                           
                              2
                              H
                              -
                              diam
                              (
                              T
                              )
                           
                         layers which enables most of the strengthening techniques clearly pays off in practice. When comparing the average gaps grouped by the numbers of root nodes, we observe that only for 
                           
                              |
                              R
                              |
                              =
                              2
                           
                         we were able to solve all instances to optimality. The problem becomes more difficult to solve already for 
                           
                              |
                              R
                              |
                              =
                              4
                           
                        , where the average gaps are 11.1% and 21.3% for 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                              ∪
                              R
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              =
                              T
                           
                        , respectively. Note that for the instances of manageable size (i.e., where the LP relaxations could be solved by all layered graph models) the average gaps are significantly smaller. When 
                           
                              |
                              R
                              |
                              =
                              6
                           
                         or 
                           
                              |
                              R
                              |
                              =
                              8
                           
                         the remaining gaps remain, however, quite large (e.g., around 26% for 
                           
                              |
                              R
                              |
                              =
                              8
                           
                        ). Overall, we conclude that the models including the proposed enhancements often outperform their weaker variants and in particular allow to solve more instances to proven optimality within the given time limit.

@&#CONCLUSIONS@&#

In this article, we studied a generalization of the hop- and diameter constrained Steiner tree problems which arises by introducing multiple central, i.e., root, nodes. After introducing the general case we draw our attention to two particular cases which are motivated from practical applications. For them we identified special polynomially solvable cases and proved that the problem is NP-hard in general. Furthermore, we discussed MIP models for the two cases based on layered graph reformulations together with strengthening valid inequalities, established a hierarchy with respect to their LP relaxation values, and also compared them theoretically to a previously proposed path model. A computational study carried out on a set of benchmark instances known from the literature shows that the branch-and-cut approaches based on the layered graph reformulations clearly outperform the previously leading path model. Our results clearly indicate that all proposed model enhancements reduce the LP gaps in practice. Furthermore, in spite of the additional time needed to solve the LP relaxations, the stronger ILP models often lead to a better overall performance.

The results of our computational study also indicate two directions for potential future research: (a) Since even for the strongest among the proposed models the bounds of the linear programming relaxation are sometimes quite large, one may try to identify further strengthening valid inequalities or even different modeling approaches. (b) We observed that for several instances, no reasonably good primal solutions could be obtained leading to large optimality gaps. Hence, obtaining high-quality heuristic solutions is another interesting topic for future research. It is, however, an open question whether we can always find a feasible solution to the HSTPMR in polynomial time. We conclude this paper by pointing out that other variants of the more general problem introduced at the beginning of the paper may be worth studying. Consider the variant with 
                        
                           
                              
                                 T
                              
                              
                                 ′
                              
                           
                           =
                           R
                        
                      and 
                        
                           V
                           =
                           T
                           ∪
                           R
                        
                     . This corresponds to the problem of finding a minimum cost spanning tree that includes a diameter constrained Steiner tree with terminal set R. This variant is closely related to the two-level problem described and studied in Gouveia, Leitner, and Ljubić (2012b). It is also worth pointing out the particular case with 
                        
                           |
                           R
                           |
                           =
                           2
                        
                      where we obtain the problem of finding a minimum cost spanning tree such that the length of the path between the two given root nodes does not exceed H. To the best of our knowledge it is not known and it does not appear to be obvious whether this problem can be solved in polynomial time.


                     
                        Proof of Lemma 2
                        
                           
                              
                                 H
                                 =
                                 2
                              
                           : For 
                              
                                 |
                                 R
                                 |
                                 ⩾
                                 3
                              
                           , each optimal solution must be a star centered at a node 
                              
                                 v
                                 ∈
                                 V
                              
                            with all roots and terminals different from v being leaves. Thus, we enumerate all such stars and each one yielding lowest cost is an optimal solution. In case 
                              
                                 |
                                 R
                                 |
                                 =
                                 2
                              
                            there are additional feasible solutions that can be obtained by assigning each terminal 
                              
                                 t
                                 ∈
                                 T
                              
                            to the closest of the two roots and connecting the roots by an edge. Thus, we can still obtain an optimal solution by enumeration. This argument holds for both cases, 
                              
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 T
                              
                            and 
                              
                                 
                                    
                                       T
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 T
                                 ∪
                                 R
                              
                           .


                           
                              
                                 H
                                 ⩾
                                 3
                              
                           : To show this non-approximability result, we use an error-preserving reduction (see, e.g., Crescenzi, Kann, Silvestri, & Trevisan (1999)) from the SET COVER problem. Given a set cover instance with the set of elements 
                              
                                 X
                                 =
                                 {
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       n
                                    
                                 
                                 }
                              
                            and a collection of subsets 
                              
                                 Y
                                 =
                                 {
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       m
                                    
                                 
                                 }
                              
                           , we transform it into a HSTPMR instance with two roots 
                              
                                 0
                                 ,
                                 1
                              
                            and 
                              
                                 H
                                 =
                                 3
                              
                            as follows: Construct a graph G with the set of nodes 
                              
                                 V
                                 =
                                 {
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       m
                                    
                                 
                                 ,
                                 0
                                 ,
                                 1
                                 }
                              
                           . We insert an edge of cost one between 
                              
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       y
                                    
                                    
                                       j
                                    
                                 
                              
                            whenever the set 
                              
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                              
                            contains the element 
                              
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                              
                           . We connect all y nodes to the root 0 and set the cost of those edges to 
                              
                                 n
                                 +
                                 1
                              
                           . Finally, we connect 0 and 1 with an edge of cost one (see Fig. 9
                           ). It is not difficult to see that there is a one-to-one correspondence between the set of feasible solutions of the set cover and the set of feasible solutions of the HSTPMR on G with 
                              
                                 H
                                 =
                                 3
                              
                           . This transformation can be done in polynomial time. To show that this transformation also preserves the approximation ratio, observe that if the cost of the set cover solution is k, so is the cost of the corresponding HSTPMR solution equal to 
                              
                                 F
                                 (
                                 k
                                 )
                                 =
                                 (
                                 n
                                 +
                                 1
                                 )
                                 (
                                 k
                                 +
                                 1
                                 )
                              
                           . Let S be a feasible HSTPMR solution with the objective value equal to 
                              
                                 F
                                 (
                                 
                                    
                                       k
                                    
                                    
                                       s
                                    
                                 
                                 )
                              
                            where 
                              
                                 
                                    
                                       k
                                    
                                    
                                       s
                                    
                                 
                              
                            is the value of the corresponding set cover solution, and let k be the value of the optimal set cover solution. Then we have:
                              
                                 
                                    
                                       
                                          F
                                          (
                                          
                                             
                                                k
                                             
                                             
                                                s
                                             
                                          
                                          )
                                          -
                                          OPT
                                       
                                       
                                          OPT
                                       
                                    
                                    =
                                    
                                       
                                          (
                                          n
                                          +
                                          1
                                          )
                                          (
                                          
                                             
                                                k
                                             
                                             
                                                s
                                             
                                          
                                          +
                                          1
                                          )
                                          -
                                          (
                                          n
                                          +
                                          1
                                          )
                                          (
                                          k
                                          +
                                          1
                                          )
                                       
                                       
                                          (
                                          n
                                          +
                                          1
                                          )
                                          (
                                          k
                                          +
                                          1
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                k
                                             
                                             
                                                s
                                             
                                          
                                          -
                                          k
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    ⩾
                                    β
                                    
                                       
                                          
                                             
                                                k
                                             
                                             
                                                s
                                             
                                          
                                          -
                                          k
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                           which is true for, e.g., 
                              
                                 β
                                 =
                                 1
                                 /
                                 2
                              
                           . Therefore, any approximation algorithm for the HSTPMR that runs in polynomial time cannot have a better approximation ratio than 
                              
                                 Θ
                                 (
                                 log
                                 n
                                 )
                              
                            since 
                              
                                 
                                    
                                       
                                          
                                             k
                                          
                                          
                                             s
                                          
                                       
                                       -
                                       k
                                    
                                    
                                       k
                                    
                                 
                                 ⩾
                                 Θ
                                 (
                                 log
                                 n
                                 )
                              
                            holds for the set cover problem unless P=NP (Lund & Yannakakis, 1994).

For 
                              
                                 |
                                 R
                                 |
                                 ⩾
                                 3
                              
                           , we attach all further roots to 0 and set the edge costs to one. The rest of the proof works similarly.□

@&#REFERENCES@&#

