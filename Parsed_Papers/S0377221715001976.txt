@&#MAIN-TITLE@&#Efficient analysis of the MMAP[K]/PH[K]/1 priority queue

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Provides a unique approach to the analysis of the MMAP[K]/PH[K]/1 priority queue.


                        
                        
                           
                           Both the preemptive resume and the non-preemptive service policies are covered.


                        
                        
                           
                           Properties of the sojourn time and the number of jobs in the system are obtained.


                        
                        
                           
                           Numerically efficient procedure that can handle a large number of phases.


                        
                        
                           
                           At least an order of magnitude faster than alternative methods.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Queueing

Preemptive resume priority queue

Non-preemptive priority queue

Matrix-analytic methods

@&#ABSTRACT@&#


               
               
                  In this paper we consider the MMAP/PH/1 priority queue, both the case of preemptive resume and the case of non-preemptive service. The main idea of the presented analysis procedure is that the sojourn time of the low priority jobs in the preemptive case (and the waiting time distribution in the non-preemptive case) can be represented by the duration of the busy period of a special Markovian fluid model. By making use of the recent results on the busy period analysis of Markovian fluid models it is possible to calculate several queueing performance measures in an efficient way including the sojourn time distribution (both in the time domain and in the Laplace transform domain), the moments of the sojourn time, the generating function of the queue length, the queue length moments and the queue length probabilities.
               
            

@&#INTRODUCTION@&#

Priority queues belong to the most essential multi-class queueing systems that allow different job classes to receive differentiated levels of service. They play an important role in several fields like telecommunication (Demoor, Walraevens, Fiems, De Vuyst, & Bruneel, 2009), manufacturing systems (Shalev-Oren, Seidmann, & Schweitzer, 1985) or, more recently, in health care (de Souza, Morabito, Chiyoshi, & Iannoni, 2015; Hagen, Jopling, Buchman, & Lee, 2013).

Priority queues are extensively studied since the middle of the last century (Miller, 1960), starting with the most basic variant with Poisson arrival process and exponentially distributed service times. However, in the practice there are cases when the Poisson assumption is not reasonable. In the last two decades most research activity on priority queues has considered more general arrival processes like the Markovian arrival process (MAP) or the marked Markovian arrival process (MMAP).

In Takine (1994) the MAP/G/1 preemptive priority queue is analyzed based on the workload process, and the Laplace–Stieltjes transform (LST) of the sojourn time distribution of the jobs is derived. The non-preemptive case is investigated in Takine (1996, 1999), where the LST of the sojourn time, the moments of the sojourn time, the generating function (GF) of the queue length, the queue length moments and the queue length probabilities are provided. Subramanian and Srikant (2000) study the tail probabilities of the low priority waiting times and queue lengths in the MAP/G/1 non-preemptive priority queue.

After this overview one may think that not too much has left to be done in the field of MAP driven priority queues. However, all the aforementioned results assume a general distribution for the service time, which makes the solution complex and often difficult to implement in a proper way (in the numerical sense). To address this issue the generally distributed service times can be replaced by phase-type distributed ones in the hope of the simpler and numerically more tractable solution.

In Alfa, Liu, and He (2003) the (discrete–time) MAP/PH/1 priority queue is considered by representing the state space with a quasi birth–death process (QBD) and exploiting the special structure of the related fundamental matrices. While this approach is elegant and seems promising, there are some computational bottlenecks (as pointed out in Horváth, 2012). There have been efforts to make it more efficient (see Horváth, Horváth, & Telek, 2009; Horváth, 2012), but apart from the queue length moments all performance measures can be computed only in case of a very limited number of phases.

The solution approach presented in this paper is based on the analysis of the workload process, like in Takine (1994). The main difference is, however, that in case of PH distributed service times it is possible to analyze the workload process and the performance measures through some appropriately defined Markovian fluid models. Taking advantage of the matrix-analytic solution technique available for Markovian fluid models we managed to derive several sojourn time and queue length related quantities in an efficient and numerically stable way, both with preemptive resume and non-preemptive service. The computationally most intensive steps of the procedure are the solutions of non-symmetric algebraic Riccati equations and Sylvester equations, for which various mature implementations exist, allowing to compute the performance measures in a reasonable time even if the number of phases is relatively large.

The rest of the paper is organized as follows. Section 2 introduces the queue considered in the paper. Section 3 covers Markovian fluid flows (especially their busy period), as our solution relies on them. For two job classes, the preemptive priority queue is analyzed in Section 4, and the non-preemptive case is considered in Section 5. The extension to arbitrary many job classes is provided in the appendix. Some numerical examples are presented in Section 6. Finally, Section 7 concludes the paper.

In the MMAP[K]/PH[K]/1 queue K types (classes) of jobs are distinguished. The arrival process of the jobs is described by a marked Markovian arrival process, and the service times are phase-type (PH) distributed. There is a single server, which always picks the job having the highest priority for service. If the ongoing service cannot be interrupted when a higher priority job arrives, the service is called to be non-preemptive. In the preemptive resume case (also referred to as the preemptive case for simplicity), however, the service of jobs can be interrupted, and resumed later when all higher priority jobs leave the system.

To introduce the analysis approach, the two-class case (
                        
                           K
                           =
                           2
                        
                     ) is considered throughout the paper, and the extension to the general case (K > 2) is provided in the appendix.

The MMAP characterizing the arrivals (He & Neuts, 1998) has a background process, that is a continuous time Markov chain (CTMC) 
                        
                           {
                           J
                           (
                           t
                           )
                           ,
                           t
                           >
                           0
                           }
                        
                      with 
                        
                           N
                           A
                        
                      states and generator matrix D (which is assumed to be irreducible). Some of the transitions of the background process are accompanied by the arrival of high (low) priority jobs with the corresponding transition rates given by matrix D
                     H (D
                     L), respectively. The rates of the internal transitions (that do not generate arrivals) are in matrix D
                     0, thus we have that 
                        
                           
                              D
                           
                           =
                           
                              
                                 D
                              
                              0
                           
                           +
                           
                              
                                 D
                              
                              L
                           
                           +
                           
                              
                                 D
                              
                              H
                           
                        
                     .

The mean arrival rate of high priority jobs is denoted by λ
                     H, and it is calculated by 
                        
                           
                              λ
                              H
                           
                           =
                           θ
                           
                              
                                 D
                              
                              H
                           
                           1
                        
                      with vector θ being the steady state distribution of the MMAP phase process, which is the unique solution of 
                        
                           θ
                           
                              D
                           
                           =
                           0
                           ,
                           θ
                           1
                           =
                           1
                        
                      (
                        1
                      denotes the column vector of ones). The mean arrival rate of low priority jobs is calculated similarly, it is 
                        
                           
                              λ
                              L
                           
                           =
                           θ
                           
                              
                                 D
                              
                              L
                           
                           1
                        
                     .

The random variable representing the service times of the low priority jobs SL
                      is PH distributed (Latouche & Ramaswami, 1999) with NL
                      phases, characterized by σL
                     , S
                     L and sL
                     . Row vector σL
                      is the initial vector, matrix S
                     L is the transient generator and column vector sL
                      holds the transition rates to the absorbing state, thus 
                        
                           
                              s
                              L
                           
                           =
                           −
                           
                              
                                 S
                              
                              L
                           
                           1
                        
                     . The probability density function (pdf) 
                        
                           
                              f
                              
                                 S
                                 L
                              
                           
                           
                              (
                              t
                              )
                           
                           ,
                        
                      its Laplace transform 
                        
                           
                              f
                              
                                 S
                                 L
                              
                              *
                           
                           
                              (
                              s
                              )
                           
                        
                      and the moments 
                        
                           E
                           (
                           
                              S
                              L
                              k
                           
                           )
                        
                      are

                        
                           (1)
                           
                              
                                 
                                    
                                       
                                          
                                             f
                                             
                                                S
                                                L
                                             
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             σ
                                             L
                                          
                                          
                                             e
                                             
                                                
                                                   
                                                      S
                                                   
                                                   L
                                                
                                                t
                                             
                                          
                                          
                                             s
                                             L
                                          
                                          ,
                                          
                                          
                                          
                                             f
                                             
                                                S
                                                L
                                             
                                             *
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          =
                                          
                                             σ
                                             L
                                          
                                          
                                             
                                                (
                                                s
                                                
                                                   I
                                                
                                                
                                                −
                                                
                                                
                                                   
                                                      S
                                                   
                                                   L
                                                
                                                )
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             s
                                             L
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          E
                                          
                                             (
                                             
                                                S
                                                
                                                   L
                                                
                                                k
                                             
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          k
                                          
                                             σ
                                             L
                                          
                                          
                                             
                                                (
                                                −
                                                
                                                   
                                                      S
                                                   
                                                   L
                                                
                                                )
                                             
                                             
                                                −
                                                k
                                             
                                          
                                          1
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     and the mean service rate is 
                        
                           
                              μ
                              L
                           
                           =
                           1
                           /
                           E
                           
                              (
                              
                                 S
                                 L
                              
                              )
                           
                        
                     . The PH distribution corresponding to the high priority service times and its properties are defined similarly, by using subscript H instead of L.

The load of the queue is 
                        
                           ρ
                           =
                           
                              λ
                              H
                           
                           /
                           
                              μ
                              H
                           
                           +
                           
                              λ
                              L
                           
                           /
                           
                              μ
                              L
                           
                        
                     . Throughout in this paper ρ < 1 is assumed.

Markov fluid models (also known as Markovian fluid flows) are characterized by a two-dimensional Markov process 
                           
                              {
                              X
                              (
                              t
                              )
                              ,
                              Z
                              (
                              t
                              )
                              ,
                              t
                              >
                              0
                              }
                              ,
                           
                         where 
                           
                              X
                              (
                              t
                              )
                           
                         represents the fluid level and 
                           
                              Z
                              (
                              t
                              )
                           
                         is the underlying CTMC with state space 
                           S
                         of size 
                           
                              |
                              S
                              |
                              =
                              N
                           
                         and generator matrix Q that modulates the rate at which fluid is accumulated in the fluid buffer.

The rate at which the level of the buffer changes in state i of the background process is denoted by ri
                        . The diagonal matrix R is composed by fluid rates 
                           
                              
                                 r
                                 i
                              
                              ,
                              i
                              =
                              1
                              ,
                              ⋯
                              ,
                              N
                           
                        . Formally, the behavior of the fluid buffer is as follows,

                           
                              (2)
                              
                                 
                                    
                                       
                                          
                                             
                                                d
                                                
                                                   d
                                                   t
                                                
                                             
                                             X
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               r
                                                               
                                                                  Z
                                                                  (
                                                                  t
                                                                  )
                                                               
                                                            
                                                            ,
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            X
                                                            (
                                                            t
                                                            )
                                                            >
                                                            0
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            max
                                                            {
                                                            0
                                                            ,
                                                            
                                                               r
                                                               
                                                                  Z
                                                                  (
                                                                  t
                                                                  )
                                                               
                                                            
                                                            }
                                                            ,
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            X
                                                            (
                                                            t
                                                            )
                                                            =
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Let us denote the row vector of the stationary distribution of the fluid level for x > 0 by 
                           
                              π
                              
                                 (
                                 x
                                 )
                              
                              =
                              {
                              
                                 π
                                 i
                              
                              
                                 (
                                 x
                                 )
                              
                              ,
                              i
                              ∈
                              S
                              }
                           
                         with 
                           
                              
                                 π
                                 i
                              
                              
                                 (
                                 x
                                 )
                              
                              =
                              
                                 lim
                                 
                                    t
                                    →
                                    ∞
                                 
                              
                              
                                 lim
                                 
                                    Δ
                                    →
                                    0
                                 
                              
                              
                                 (
                                 1
                                 /
                                 Δ
                                 )
                              
                              P
                              
                                 (
                                 X
                                 
                                    (
                                    t
                                    )
                                 
                                 ∈
                                 
                                    (
                                    x
                                    ,
                                    x
                                    +
                                    Δ
                                    )
                                 
                                 ,
                                 Z
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 i
                                 )
                              
                              ,
                           
                         and the row vector of the stationary probabilities of empty buffer by 
                           
                              p
                              =
                              {
                              
                                 p
                                 i
                              
                              ,
                              i
                              ∈
                              S
                              }
                           
                         with 
                           
                              
                                 p
                                 i
                              
                              =
                              
                                 lim
                                 
                                    t
                                    →
                                    ∞
                                 
                              
                              P
                              
                                 (
                                 Z
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 i
                                 ,
                                 X
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 0
                                 )
                              
                           
                        .

In the recent decades it has been recognized that the matrix-analytic approach basing the efficient analysis of QBDs can be applied to fluid models as well, making it possible to solve fluid models with a large number of states (up to several thousand) in a numerically stable way (see Ramaswami, 1999; Soares & Latouche, 2002). Fluid models where 
                           
                              
                                 |
                              
                              
                                 r
                                 i
                              
                              
                                 |
                                 =
                                 1
                                 ,
                                 ∀
                                 i
                                 ∈
                                 S
                              
                           
                         are referred to as canonical fluid models, and are especially simple to analyze. Here we summarize the main steps of the analysis of canonical fluid models. We assume that the state space is partitioned according to the associated fluid rates to two sets 
                           
                              
                                 S
                                 +
                              
                              =
                              
                                 {
                                 i
                                 ∈
                                 S
                                 ,
                                 
                                    r
                                    i
                                 
                                 =
                                 1
                                 }
                              
                           
                         and 
                           
                              
                                 S
                                 −
                              
                              =
                              
                                 {
                                 i
                                 ∈
                                 S
                                 ,
                                 
                                    r
                                    i
                                 
                                 =
                                 −
                                 1
                                 }
                              
                           
                         (
                           
                              
                                 N
                                 +
                              
                              
                                 =
                                 |
                              
                              
                                 S
                                 +
                              
                              
                                 |
                                 ,
                              
                              
                                 N
                                 −
                              
                              =
                              
                                 |
                                 
                                    S
                                    −
                                 
                                 |
                              
                           
                        ) as

                           
                              (3)
                              
                                 
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               Q
                                                               
                                                                  +
                                                                  +
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               Q
                                                               
                                                                  +
                                                                  −
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               Q
                                                               
                                                                  −
                                                                  +
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               Q
                                                               
                                                                  −
                                                                  −
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                R
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            −
                                                            
                                                               I
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The analysis is based on two fundamental matrices, matrix 
                           Ψ
                         and K (see Ramaswami, 1999). Matrix 
                           Ψ
                         has a simple probabilistic interpretation, entry 
                           
                              
                                 
                                    (
                                    
                                       Ψ
                                    
                                    )
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              ,
                              
                              i
                              ∈
                              
                                 S
                                 +
                              
                              ,
                              j
                              ∈
                              
                                 S
                                 −
                              
                           
                         is the probability that the background process is in state j when the fluid level returns to 0 given that it was in state i when the busy period (a non-empty period of the fluid queue) was initiated. Matrix 
                           Ψ
                         is the solution to the nonsymmetric algebraic Riccati equation (NARE)

                           
                              (4)
                              
                                 
                                    
                                       
                                          
                                             
                                                Ψ
                                             
                                             
                                                
                                                   Q
                                                   
                                                      −
                                                      +
                                                   
                                                
                                             
                                             
                                                Ψ
                                             
                                             +
                                             
                                                Ψ
                                             
                                             
                                                
                                                   Q
                                                   
                                                      −
                                                      −
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   Q
                                                   
                                                      +
                                                      +
                                                   
                                                
                                             
                                             
                                                Ψ
                                             
                                             +
                                             
                                                
                                                   Q
                                                   
                                                      +
                                                      −
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                0
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Matrix K has an important role as well. Entry i, j of matrix e
                        
                           K
                           x
                         is the expected number of crossings of fluid level x in phase 
                           
                              j
                              ∈
                              
                                 S
                                 +
                              
                           
                         starting from level 0 and phase 
                           
                              i
                              ∈
                              
                                 S
                                 +
                              
                              ,
                           
                         before returning to level 0. If the mean fluid rate is negative, all eigenvalues of matrix K have negative real parts (thus it is full rank and invertible) and can be expressed from 
                           Ψ
                         as

                           
                              (5)
                              
                                 
                                    
                                       
                                          
                                             
                                                K
                                             
                                             =
                                             
                                                
                                                   Q
                                                   
                                                      +
                                                      +
                                                   
                                                
                                             
                                             +
                                             
                                                Ψ
                                             
                                             
                                                
                                                   Q
                                                   
                                                      −
                                                      +
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Based on these matrices the stationary fluid level density vector and the stationary probability vector of the idle buffer can be computed by the following theorem.

                           Theorem 1
                           
                              If the drift of the queue is negative, vector π(x) is given by
                              
                                 
                                    (6)
                                    
                                       
                                          
                                             
                                                
                                                   π
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                   =
                                                   
                                                      [
                                                      
                                                         π
                                                         +
                                                      
                                                      
                                                         (
                                                         x
                                                         )
                                                      
                                                      
                                                      
                                                         π
                                                         −
                                                      
                                                      
                                                         (
                                                         x
                                                         )
                                                      
                                                      ]
                                                   
                                                   =
                                                   
                                                      p
                                                      −
                                                   
                                                   
                                                      
                                                         Q
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                   
                                                   
                                                      e
                                                      
                                                         
                                                            K
                                                         
                                                         x
                                                      
                                                   
                                                   
                                                      [
                                                      
                                                         I
                                                      
                                                      
                                                      
                                                         Ψ
                                                      
                                                      ]
                                                   
                                                   ,
                                                   
                                                   x
                                                   ≥
                                                   0
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              and the probability mass vector p equals to
                              
                                 
                                    (7)
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   =
                                                   
                                                      [
                                                      0
                                                      
                                                      
                                                         p
                                                         −
                                                      
                                                      ]
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where
                              
                                 
                                    p
                                    −
                                 
                               
                              is the solution to the set of linear equations
                              
                                 
                                    (8)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                      −
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               −
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               +
                                                            
                                                         
                                                      
                                                      
                                                         Ψ
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   0
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (9)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                      −
                                                   
                                                   
                                                      
                                                         Q
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            K
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     I
                                                                  
                                                                  
                                                                  
                                                                     Ψ
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      ]
                                                   
                                                   1
                                                   +
                                                   
                                                      p
                                                      −
                                                   
                                                   1
                                                
                                             
                                             
                                                
                                                   =
                                                   1
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The theorem is based on Soares and Latouche (2002), especially in Theorem 2.2.□

In this section we briefly summarize the most essential results of Ahn and Ramaswami (2005) and Ramaswami, Woolford, and Stanford (2008) on the busy period analysis of fluid models.

As mentioned above, 
                           Ψ
                         is the phase transition probability matrix between the beginning and the end of the busy period. If the duration of the busy period is also of interest, we can introduce matrix 
                           Ψ
                        (t), the time dependent counterpart of 
                           Ψ
                        . Entry 
                           
                              
                                 
                                    (
                                    
                                       Ψ
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    )
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              ,
                              
                              i
                              ∈
                              
                                 S
                                 +
                              
                              ,
                              j
                              ∈
                              
                                 S
                                 −
                              
                              ,
                              t
                              >
                              0
                           
                         is the joint probability that the duration of the busy period is less than t and the underlying Markov chain is in state j when the fluid level returns to 0 given that it was in state i when the busy period was initiated.

According to Theorem 1 of Ramaswami et al. (2008), the LST of 
                           Ψ
                        (t), denoted by 
                           Ψ
                        *(s) satisfies the nonsymmetric algebraic Riccati equation

                           
                              (10)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Ψ
                                                
                                                *
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             
                                                
                                                   Q
                                                   
                                                      −
                                                      +
                                                   
                                                
                                             
                                             
                                                
                                                   Ψ
                                                
                                                *
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             +
                                             
                                                
                                                   Ψ
                                                
                                                *
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             
                                                
                                                   Q
                                                   
                                                      −
                                                      −
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   Q
                                                   
                                                      +
                                                      +
                                                   
                                                
                                             
                                             
                                                
                                                   Ψ
                                                
                                                *
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             +
                                             
                                                
                                                   Q
                                                   
                                                      +
                                                      −
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             =
                                             2
                                             
                                             s
                                             
                                                
                                                   Ψ
                                                
                                                *
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Let the random variable 
                           B
                         denote the length of the busy period of a canonical fluid queue characterized by matrix Q given that the state probability vector of the background CTMC is 
                           
                              κ
                              =
                              {
                              
                                 κ
                                 i
                              
                              ,
                              i
                              =
                              1
                              ,
                              ⋯
                              ,
                              
                                 N
                                 +
                              
                              }
                           
                         when the busy period starts.

                           Theorem 2
                           
                              The LST of the busy period
                              
                                 
                                    
                                       f
                                       
                                          B
                                       
                                       *
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    =
                                    E
                                    
                                       (
                                       
                                          e
                                          
                                             −
                                             s
                                             B
                                          
                                       
                                       )
                                    
                                 
                               
                              is given by
                              
                                 
                                    (11)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      
                                                         B
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                   =
                                                   κ
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                   1
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The theorem follows from the probabilistic interpretation of 
                                 Ψ
                              (t).□


                              The kth moment of the busy period is given by
                              
                                 
                                    (12)
                                    
                                       
                                          
                                             
                                                
                                                   E
                                                   
                                                      (
                                                      
                                                         B
                                                         k
                                                      
                                                      )
                                                   
                                                   =
                                                   κ
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         1
                                                         )
                                                      
                                                      k
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   1
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where
                              
                                 
                                    
                                       
                                          Ψ
                                       
                                       
                                          (
                                          0
                                          )
                                       
                                    
                                    =
                                    
                                       Ψ
                                    
                                 
                               
                              and matrices 
                              
                                 Ψ
                              
                              (k), k > 0 are defined recursively as
                              
                                 
                                    (13)
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            Q
                                                            
                                                               +
                                                               +
                                                            
                                                         
                                                      
                                                      
                                                      +
                                                      
                                                      
                                                         Ψ
                                                      
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               +
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               −
                                                            
                                                         
                                                      
                                                      
                                                      +
                                                      
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               +
                                                            
                                                         
                                                      
                                                      
                                                         Ψ
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   =
                                                   2
                                                   k
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         (
                                                         k
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   −
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         k
                                                         i
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Q
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         (
                                                         k
                                                         −
                                                         i
                                                         )
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           


                              Eq. (13) follows from routine derivations with 
                                 
                                    
                                       
                                          Ψ
                                       
                                       
                                          (
                                          k
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          d
                                          k
                                       
                                       
                                          d
                                          
                                             s
                                             k
                                          
                                       
                                    
                                    
                                       
                                          Ψ
                                       
                                       *
                                    
                                    
                                       
                                          
                                             (
                                             s
                                             )
                                          
                                          |
                                       
                                       
                                          s
                                          =
                                          0
                                       
                                    
                                 
                              .□

Since Eq. (10) is a NARE and Eq. (13) is a Sylvester equation, the LST of the busy period and the moments can be obtained in a numerically efficient way. The distribution function in time domain, 
                           
                              
                                 F
                                 B
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              P
                              
                                 (
                                 B
                                 <
                                 t
                                 )
                              
                              =
                              κ
                              
                              
                                 Ψ
                              
                              
                                 (
                                 t
                                 )
                              
                              1
                           
                         is, however, more involved to calculate. One can rely on a generic numerical Laplace transform inversion procedure, but according to our experience they are not always reliable up to the machine precision, and need complex arithmetic. Instead, a simple and elegant procedure called Erlangization is available (Ramaswami et al., 2008), according to which the order-n approximation 
                           
                              
                                 F
                                 B
                                 
                                    (
                                    n
                                    )
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         is

                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             
                                                F
                                                B
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                ∫
                                                0
                                                ∞
                                             
                                             
                                                f
                                                
                                                   E
                                                   (
                                                   n
                                                   ,
                                                   n
                                                   /
                                                   t
                                                   )
                                                
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                             ·
                                             
                                                F
                                                B
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                             
                                             d
                                             u
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 f
                                 
                                    E
                                    (
                                    n
                                    ,
                                    n
                                    /
                                    t
                                    )
                                 
                              
                              
                                 (
                                 u
                                 )
                              
                           
                         is the density of an order-n Erlang distribution with rate parameter 
                           
                              ν
                              =
                              n
                              /
                              t
                           
                         and we have that 
                           
                              
                                 F
                                 B
                                 
                                    (
                                    n
                                    )
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              →
                              
                                 F
                                 B
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         as n → ∞. 
                           
                              
                                 F
                                 B
                                 
                                    (
                                    n
                                    )
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         is basically the probability that the busy period is shorter than an Erlang(n, ν) variable.

Specifically for the busy period analysis 
                           
                              
                                 F
                                 B
                                 
                                    (
                                    n
                                    )
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         can be obtained according to the next theorem.

                           Theorem 4
                           (Ramaswami et al., 2008, Theorem 4) The order-n approximation of the busy period distribution is
                              
                                 
                                    (15)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      F
                                                      B
                                                      
                                                         (
                                                         n
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   =
                                                   κ
                                                   
                                                      ∑
                                                      
                                                         k
                                                         =
                                                         0
                                                      
                                                      
                                                         n
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      k
                                                      ν
                                                   
                                                   1
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where matrices
                              
                                 
                                    
                                       Ψ
                                    
                                    k
                                    ν
                                 
                               
                              are defined recursively as
                              
                                 
                                    (16)
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            Q
                                                            
                                                               +
                                                               +
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            Ψ
                                                         
                                                         0
                                                         ν
                                                      
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               +
                                                            
                                                         
                                                      
                                                      −
                                                      ν
                                                      
                                                         I
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      k
                                                      ν
                                                   
                                                   +
                                                   
                                                      
                                                         Ψ
                                                      
                                                      k
                                                      ν
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               −
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               +
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            Ψ
                                                         
                                                         0
                                                         ν
                                                      
                                                      −
                                                      ν
                                                      
                                                         I
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   =
                                                   −
                                                   2
                                                   ν
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                      ν
                                                   
                                                   −
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      i
                                                      ν
                                                   
                                                   
                                                      
                                                         Q
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         k
                                                         −
                                                         i
                                                      
                                                      ν
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              for k > 0, and
                              
                                 
                                    
                                       Ψ
                                    
                                    0
                                    ν
                                 
                               
                              is the solution to the NARE
                              
                                 
                                    (17)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Ψ
                                                      
                                                      0
                                                      ν
                                                   
                                                   
                                                      
                                                         Q
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      0
                                                      ν
                                                   
                                                   +
                                                   
                                                      
                                                         Ψ
                                                      
                                                      0
                                                      ν
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               −
                                                            
                                                         
                                                      
                                                      −
                                                      ν
                                                      
                                                         I
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      (
                                                      
                                                         
                                                            Q
                                                            
                                                               +
                                                               +
                                                            
                                                         
                                                      
                                                      −
                                                      ν
                                                      
                                                         I
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      0
                                                      ν
                                                   
                                                   +
                                                   
                                                      
                                                         Q
                                                         
                                                            +
                                                            −
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      0
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

For the detailed proof of the theorem, see Ramaswami et al. (2008). The idea is to construct a special fluid model which counts the number of Exp(ν) events during the busy period. Matrix 
                           
                              
                                 Ψ
                              
                              k
                              ν
                           
                         is the probability that k such events occur before the end of busy period (with the usual phase-transition probabilities being the entries of the matrix). If the number of Exp(ν) events is less than n, then the busy period is shorter than an Erlang(n, ν) variable, providing Eq. (14).

Our approach is based on the analysis of the workload process, just like (Takine, 1994) in the context of MAP/G/1 preemptive priority queues. However, by exploiting the technical simplicity of the PH distributed service times we are able to arrive to a more intuitive, simpler to implement and numerically more beneficial solution.

For the analysis of the sojourn time we first need to derive the distribution of the workload a low priority arrival finds in the system.

The workload process 
                           
                              {
                              V
                              (
                              t
                              )
                              ,
                              t
                              >
                              0
                              }
                           
                         is the amount of work in the system at time t, thus the time needed to process all the jobs in the queue if the arrival process is frozen. 
                           
                              V
                              (
                              t
                              )
                           
                         decreases by a slope of one between the arrival epochs, and jumps up at arrival epochs according to the service time requirement of the arrival; thus, 
                           
                              V
                              (
                              t
                              )
                           
                         is skip-free to the left. An example to the workload process is depicted in Fig. 1
                        . As we have two job classes, there are two kinds of jumps in the figure, the dotted one corresponds to the high, the dashed one to the low priority jobs.

To completely characterize the situation an arriving low priority job finds in the system, the stationary solution of 
                           
                              {
                              V
                              (
                              t
                              )
                              ,
                              J
                              (
                              t
                              )
                              }
                              ,
                           
                         thus the joint distribution of the workload and the MMAP phase needs to be derived.

In our case the inter-arrival times are given by a MMAP and the size of the jumps is PH distributed, which makes it possible to apply the method of Dzial, Breuer, Soares, Latouche, and Remiche (2005) to transform 
                           
                              V
                              (
                              t
                              )
                              ,
                           
                         which is skip-free to the left, to 
                           
                              
                                 V
                                 ′
                              
                              
                                 (
                                 t
                                 )
                              
                              ,
                           
                         which is skip-free to both directions. More precisely, the continuous process with jumps 
                           
                              {
                              V
                              (
                              t
                              )
                              ,
                              J
                              (
                              t
                              )
                              }
                           
                         is transformed to 
                           
                              {
                              
                                 V
                                 ′
                              
                              
                                 (
                                 t
                                 )
                              
                              ,
                              Z
                              
                                 (
                                 t
                                 )
                              
                              }
                           
                         from which the stationary distribution of 
                           
                              {
                              V
                              (
                              t
                              )
                              ,
                              J
                              (
                              t
                              )
                              }
                           
                         at low priority arrivals is computed.

The transformation to the skip-free process is performed as follows. Let 
                           
                              {
                              
                                 V
                                 ′
                              
                              
                                 (
                                 t
                                 )
                              
                              ,
                              Z
                              
                                 (
                                 t
                                 )
                              
                              }
                           
                         be a canonical Markovian fluid model where 
                           
                              Z
                              (
                              t
                              )
                           
                         is the underlying CTMC with generator matrix Q given by

                           
                              (18)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                   
                                                      +
                                                      +
                                                   
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               
                                                                  S
                                                               
                                                               L
                                                            
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               
                                                                  S
                                                                  H
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   Q
                                                   
                                                      +
                                                      −
                                                   
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               L
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                   
                                                      −
                                                      +
                                                   
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  D
                                                               
                                                               L
                                                            
                                                            ⊗
                                                            
                                                               σ
                                                               L
                                                            
                                                            
                                                            
                                                            
                                                            
                                                               
                                                                  D
                                                               
                                                               H
                                                            
                                                            ⊗
                                                            
                                                               σ
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   Q
                                                   
                                                      −
                                                      −
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   D
                                                
                                                0
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        This fluid model behaves like 
                           
                              {
                              V
                              (
                              t
                              )
                              ,
                              J
                              (
                              t
                              )
                              }
                           
                         between arrivals, when it stays in the negative states 
                           
                              S
                              −
                           
                        . Whenever an arrival occurs, however, it switches to one of the positive state groups (depending on the class of the entering job), and accumulates the workload increment with a slope of 1. Thus, the jumps are eliminated and replaced by progressive workload accumulations. (A similar technique has been used in Houdt (2012) for the analysis of a multi-type queue with impatient customers.) The transformed process obtained from Fig. 1 is depicted in Fig. 2
                        .

Observe that the joint stationary density of the workload and the MMAP phase at low priority arrivals are the same in the original and in the transformed process. The stationary solution π(x) of the transformed process (that is a canonical fluid model) is given by Theorem 1, from which, by embedding at just after low priority arrivals we get a matrix-exponential solution

                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             
                                                π
                                                ^
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                1
                                                
                                                   c
                                                   ^
                                                
                                             
                                             π
                                             
                                                (
                                                x
                                                )
                                             
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               L
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             =
                                             
                                                1
                                                
                                                   c
                                                   ^
                                                
                                             
                                             
                                                p
                                                −
                                             
                                             
                                                
                                                   Q
                                                   
                                                      −
                                                      +
                                                   
                                                
                                             
                                             
                                                e
                                                
                                                   
                                                      K
                                                   
                                                   x
                                                
                                             
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                      
                                                      
                                                         
                                                            Ψ
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               L
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         1
                                                         
                                                            c
                                                            ^
                                                         
                                                      
                                                      
                                                         p
                                                         −
                                                      
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               +
                                                            
                                                         
                                                      
                                                   
                                                   ︸
                                                
                                                
                                                   β
                                                   ^
                                                
                                             
                                             
                                                e
                                                
                                                   
                                                      K
                                                   
                                                   x
                                                
                                             
                                             
                                                
                                                   
                                                      [
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     I
                                                                  
                                                                  ⊗
                                                                  
                                                                     s
                                                                     L
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  0
                                                               
                                                            
                                                         
                                                      
                                                      ]
                                                   
                                                   ︸
                                                
                                                
                                                   
                                                      B
                                                   
                                                   ^
                                                
                                             
                                             =
                                             
                                                β
                                                ^
                                             
                                             
                                                e
                                                
                                                   
                                                      K
                                                   
                                                   x
                                                
                                             
                                             
                                                
                                                   B
                                                
                                                ^
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where the normalization constant is 
                           
                              
                                 c
                                 ^
                              
                              =
                              
                                 p
                                 −
                              
                              
                                 
                                    Q
                                    
                                       −
                                       +
                                    
                                 
                              
                              
                                 
                                    (
                                    −
                                    
                                       K
                                    
                                    )
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 
                                    B
                                 
                                 ^
                              
                              1
                           
                        . Note that from the three blocks in the last matrix term the upper two belong to 
                           
                              S
                              +
                           
                         and the lower belongs to 
                           
                              S
                              −
                           
                        .

Due to technical reasons (which will be discussed later) the representation given by Eq. (19) will not be appropriate in the forthcoming derivations, because in general 
                           
                              
                                 K
                              
                              1
                              +
                              
                                 
                                    B
                                 
                                 ^
                              
                              1
                              ≠
                              0
                           
                        . The following theorem provides the representation transformation that ensures the proper row-sums.

                           Theorem 5
                           
                              The joint density of the workload and the phase probability of the MMAP just after low priority arrivals
                              
                                 
                                    
                                       π
                                       ^
                                    
                                    
                                       (
                                       x
                                       )
                                    
                                 
                               
                              can be obtained by
                              
                                 
                                    (20)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      π
                                                      ^
                                                   
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                   =
                                                   
                                                      
                                                         β
                                                         ^
                                                      
                                                      ′
                                                   
                                                   
                                                      e
                                                      
                                                         
                                                            
                                                               K
                                                               ′
                                                            
                                                         
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         ^
                                                      
                                                      ′
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              with
                              
                                 
                                    
                                       
                                          β
                                          ^
                                       
                                       ′
                                    
                                    =
                                    
                                       β
                                       ^
                                    
                                    ·
                                    
                                       d
                                       i
                                       a
                                       g
                                    
                                    
                                       〈
                                       Δ
                                       〉
                                    
                                    ,
                                    
                                       
                                          K
                                          ′
                                       
                                    
                                    =
                                    
                                       d
                                       i
                                       a
                                       g
                                    
                                    
                                       
                                          〈
                                          Δ
                                          〉
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    ·
                                    
                                       K
                                    
                                    ·
                                    
                                       d
                                       i
                                       a
                                       g
                                    
                                    
                                       〈
                                       Δ
                                       〉
                                    
                                 
                               
                              and
                              
                                 
                                    
                                       
                                          
                                             B
                                          
                                          ^
                                       
                                       ′
                                    
                                    =
                                    
                                       d
                                       i
                                       a
                                       g
                                    
                                    
                                       
                                          〈
                                          Δ
                                          〉
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    ·
                                    
                                       
                                          B
                                       
                                       ^
                                    
                                    ,
                                 
                               
                              where
                              
                                 
                                    Δ
                                    =
                                    
                                       
                                          (
                                          −
                                          
                                             K
                                          
                                          )
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          B
                                       
                                       ^
                                    
                                    1
                                 
                              . Furthermore, we have that
                              
                                 
                                    (21)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         K
                                                         ′
                                                      
                                                   
                                                   1
                                                   +
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         ^
                                                      
                                                      ′
                                                   
                                                   1
                                                   =
                                                   0
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The fact that Eq. (20) equals to Eq. (19) can be proven by

                                 
                                    (22)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      π
                                                      ^
                                                   
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      
                                                         β
                                                         ^
                                                      
                                                      ′
                                                   
                                                   
                                                      e
                                                      
                                                         
                                                            
                                                               K
                                                               ′
                                                            
                                                         
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         ^
                                                      
                                                      ′
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      β
                                                      ^
                                                   
                                                   ·
                                                   diag
                                                   
                                                      〈
                                                      Δ
                                                      〉
                                                   
                                                   ·
                                                   
                                                      e
                                                      
                                                         diag
                                                         
                                                            
                                                               〈
                                                               Δ
                                                               〉
                                                            
                                                            
                                                               −
                                                               1
                                                            
                                                         
                                                         ·
                                                         
                                                            K
                                                         
                                                         ·
                                                         diag
                                                         
                                                            〈
                                                            Δ
                                                            〉
                                                         
                                                         x
                                                      
                                                   
                                                   diag
                                                   
                                                      
                                                         〈
                                                         Δ
                                                         〉
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         B
                                                      
                                                      ^
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      β
                                                      ^
                                                   
                                                   ·
                                                   diag
                                                   
                                                      〈
                                                      Δ
                                                      〉
                                                   
                                                   ·
                                                   diag
                                                   
                                                      
                                                         〈
                                                         Δ
                                                         〉
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   ·
                                                   
                                                      e
                                                      
                                                         
                                                            K
                                                         
                                                         x
                                                      
                                                   
                                                   ·
                                                   diag
                                                   
                                                      〈
                                                      Δ
                                                      〉
                                                   
                                                   diag
                                                   
                                                      
                                                         〈
                                                         Δ
                                                         〉
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         B
                                                      
                                                      ^
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      β
                                                      ^
                                                   
                                                   
                                                      e
                                                      
                                                         
                                                            K
                                                         
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         B
                                                      
                                                      ^
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              To prove that Eq. (21) holds we have

                                 
                                    (23)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         K
                                                         ′
                                                      
                                                   
                                                   1
                                                   +
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         ^
                                                      
                                                      ′
                                                   
                                                   1
                                                   =
                                                   diag
                                                   
                                                      
                                                         〈
                                                         Δ
                                                         〉
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         K
                                                      
                                                      
                                                         
                                                            (
                                                            −
                                                            
                                                               K
                                                            
                                                            )
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            B
                                                         
                                                         ^
                                                      
                                                      1
                                                      +
                                                      
                                                         
                                                            B
                                                         
                                                         ^
                                                      
                                                      1
                                                      )
                                                   
                                                   =
                                                   0
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              □

For the sojourn time analysis of low priority jobs we introduce the remaining sojourn time process 
                           
                              {
                              T
                              (
                              t
                              )
                              ,
                              t
                              ≥
                              0
                              }
                           
                        . At 
                           
                              t
                              =
                              0
                              ,
                           
                        
                        
                           
                              T
                              (
                              t
                              )
                           
                         is the workload seen by a low priority job when it arrives. For t > 0, 
                           
                              T
                              (
                              t
                              )
                           
                         decreases by a slope of one till a high priority arrival occurs, when 
                           
                              T
                              (
                              t
                              )
                           
                         has a jump with size given by a high priority service time. When 
                           
                              T
                              (
                              t
                              )
                           
                         reaches zero, it remains zero and the corresponding low priority job leaves the system (see Fig. 3
                        ). Hence, the sojourn time of low priority jobs TL
                         is

                           
                              (24)
                              
                                 
                                    
                                       
                                          
                                             
                                                T
                                                L
                                             
                                             =
                                             inf
                                             
                                                {
                                                t
                                                >
                                                0
                                                :
                                                T
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                =
                                                0
                                                }
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Just like the workload process 
                           
                              V
                              (
                              t
                              )
                              ,
                           
                         the remaining sojourn time process 
                           
                              T
                              (
                              t
                              )
                           
                         is skip-free to the left and has upward jumps. As we did with the workload process, we transform 
                           
                              T
                              (
                              t
                              )
                           
                         to a process which is easier to handle numerically, and derive the properties of 
                           
                              T
                              (
                              t
                              )
                           
                         from the transformed process.

This transformation is based on Dzial et al. (2005) again. Let us introduce a canonical fluid model 
                           
                              {
                              
                                 T
                                 ˜
                              
                              
                                 (
                                 t
                                 )
                              
                              ,
                              
                                 Z
                                 ˜
                              
                              
                                 (
                                 t
                                 )
                              
                              }
                           
                         where the generator 
                           
                              
                                 Q
                              
                              ˜
                           
                         of the underlying CTMC is

                           
                              (25)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   ˜
                                                
                                                
                                                   +
                                                   +
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               K
                                                            
                                                            ′
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               
                                                                  S
                                                                  H
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   ˜
                                                
                                                
                                                   +
                                                   −
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     B
                                                                  
                                                                  ^
                                                               
                                                            
                                                            ′
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                ˜
                                             
                                             
                                                −
                                                +
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                            
                                                            
                                                            
                                                               
                                                                  D
                                                               
                                                               H
                                                            
                                                            ⊗
                                                            
                                                               σ
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   ˜
                                                
                                                
                                                   −
                                                   −
                                                
                                             
                                             =
                                             
                                                
                                                   D
                                                
                                                0
                                             
                                             +
                                             
                                                
                                                   D
                                                
                                                L
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        furthermore, let the distribution of 
                           
                              
                                 Z
                                 ˜
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         at 
                           
                              t
                              =
                              0
                           
                         be

                           
                              (26)
                              
                                 
                                    
                                       
                                          
                                             
                                                κ
                                                ˜
                                             
                                             =
                                             
                                                {
                                                P
                                                
                                                   (
                                                   
                                                      
                                                         Z
                                                         ˜
                                                      
                                                      +
                                                   
                                                   
                                                      (
                                                      0
                                                      )
                                                   
                                                   =
                                                   i
                                                   )
                                                
                                                }
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  β
                                                                  ^
                                                               
                                                               ′
                                                            
                                                            
                                                            0
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        This fluid model has three state groups: there are two state groups in 
                           
                              
                                 S
                                 +
                              
                              ,
                           
                         and 
                           
                              S
                              −
                           
                         is the third one.

The role of the first state group is the accumulation of the initial workload, experienced by a low priority job when it enters the system. Observe that the sojourn time density of the first state group, when started from 
                           
                              
                                 κ
                                 ˜
                              
                              ,
                           
                         is exactly 
                           
                              
                                 π
                                 ^
                              
                              
                                 (
                                 x
                                 )
                              
                              ,
                           
                         which is the density of the initial workload. The second group of states is activated when an arrival occurs, and the corresponding workload increment is accumulated. The third group of states, the negative ones represent the periods when the server is processing the low priority workload and is decreasing the remaining sojourn time of the tagged low priority job.

Note that due to Theorem 5 the usual property of Markovian generators 
                           
                              
                                 
                                    Q
                                 
                                 ˜
                              
                              1
                              =
                              0
                           
                         holds. The correctness of the solution with the non-Markovian components K′ and 
                           
                              
                                 
                                    
                                       B
                                    
                                    ^
                                 
                              
                              ′
                           
                         is ensured by Buchholz and Telek (2012).

The main idea in this section is that, by construction, the relation between the duration of the busy period 
                           
                              B
                              ˜
                           
                         of the fluid model characterized by 
                           
                              (
                              
                                 κ
                                 ˜
                              
                              ,
                              
                                 
                                    Q
                                 
                                 ˜
                              
                              )
                           
                         and the sojourn time of low priority jobs TL
                         is

                           
                              (27)
                              
                                 
                                    
                                       
                                          
                                             
                                                T
                                                L
                                             
                                             =
                                             
                                                B
                                                ˜
                                             
                                             /
                                             2
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        This relation is clearly visible when looking at Figs. 3 and 4
                        .

Finally, the following corollary expresses the properties of the sojourn time with the properties of the busy period (detailed in Section 3.2).

                           Corollary 1
                           
                              The distribution of TL in time domain, in LST domain, and its moments can be expressed by
                              
                                 
                                    (28)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      F
                                                      
                                                         T
                                                         L
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   P
                                                   
                                                      (
                                                      
                                                         T
                                                         L
                                                      
                                                      <
                                                      t
                                                      )
                                                   
                                                   =
                                                   
                                                      F
                                                      
                                                         B
                                                         ˜
                                                      
                                                   
                                                   
                                                      (
                                                      2
                                                      t
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (29)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      
                                                         T
                                                         L
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   E
                                                   
                                                      (
                                                      
                                                         e
                                                         
                                                            −
                                                            s
                                                            
                                                               T
                                                               L
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   =
                                                   
                                                      f
                                                      
                                                         
                                                            B
                                                            ˜
                                                         
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      /
                                                      2
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (30)
                                    
                                       
                                          
                                             
                                                
                                                   E
                                                   
                                                      (
                                                      
                                                         T
                                                         L
                                                         k
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   E
                                                   
                                                      (
                                                      
                                                         
                                                            B
                                                            ˜
                                                         
                                                         k
                                                      
                                                      )
                                                   
                                                   /
                                                   
                                                      2
                                                      k
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

First we derive the distribution of the number of low priority jobs at low priority departure epochs (the corresponding random variable is denoted by XL
                        ), then the one at a random point in time (denoted by YL
                        ).

When a low priority job leaves the system, the number of jobs behind it equals to the number of low priority arrivals during its sojourn in the system. To analyze this quantity, let us go back to the remaining sojourn time introduced in Section 4.2, and modify the background process of the related fluid model such that it counts the number of low priority arrivals. Instead of 
                           
                              
                                 Q
                              
                              ˜
                           
                         we get 
                           
                              
                                 
                                    Q
                                 
                                 ˜
                              
                              ′
                           
                         defined by

                           
                              (31)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   ˜
                                                
                                                ′
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               F
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               F
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               F
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               F
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               F
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         ⋱
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                      
                                                         ⋱
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where matrices F0
                         and F1
                         are

                           
                              (32)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   F
                                                   0
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  Q
                                                               
                                                               ˜
                                                            
                                                            
                                                               +
                                                               +
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  Q
                                                               
                                                               ˜
                                                            
                                                            
                                                               +
                                                               −
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  Q
                                                               
                                                               ˜
                                                            
                                                            
                                                               −
                                                               +
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               D
                                                            
                                                            0
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   F
                                                   1
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               D
                                                            
                                                            L
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        With this generator, matrix 
                           
                              
                                 
                                    Ψ
                                 
                                 ˜
                              
                              ′
                           
                         of the corresponding canonical Markovian fluid model has an upper block-Toeplitz structure like

                           
                              (33)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Ψ
                                                   
                                                   ˜
                                                
                                                ′
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               ˜
                                                            
                                                            0
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               ˜
                                                            
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               ˜
                                                            
                                                            2
                                                         
                                                      
                                                      
                                                         ⋯
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               ˜
                                                            
                                                            0
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               ˜
                                                            
                                                            1
                                                         
                                                      
                                                      
                                                         ⋯
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               ˜
                                                            
                                                            0
                                                         
                                                      
                                                      
                                                         ⋯
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                      
                                                         ⋱
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where the entry 
                           
                              
                                 (
                                 
                                    
                                       
                                          Ψ
                                       
                                       ˜
                                    
                                    i
                                 
                                 )
                              
                              
                                 k
                                 ,
                                 ℓ
                              
                           
                         is the probability that i low priority arrivals occur during the sojourn time of a low priority job and the phase of the MMAP is ℓ at the departure given that the phase was k when it entered the system.

The reason of the upper block-Toeplitz structure is that the number of low-priority arrivals during the sojourn time can only increase, and that the MMAP generating the arrivals is independent of the queue length.

                           Theorem 6
                           
                              Matrix
                              
                                 
                                    
                                       
                                          Ψ
                                       
                                       ˜
                                    
                                    0
                                 
                               
                              is the solution to the NARE
                              
                                 
                                    (34)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      0
                                                   
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         −
                                                         +
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      0
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      0
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      0
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         +
                                                         +
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      0
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         +
                                                         −
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      0
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              and for i > 0 matrices
                              
                                 
                                    
                                       
                                          Ψ
                                       
                                       ˜
                                    
                                    i
                                 
                               
                              can be obtained recursively by solving the Sylvester equation
                              
                                 
                                    (35)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               Q
                                                            
                                                            ˜
                                                         
                                                         
                                                            +
                                                            +
                                                         
                                                      
                                                      
                                                      +
                                                      
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ˜
                                                         
                                                         0
                                                      
                                                      
                                                         
                                                            
                                                               Q
                                                            
                                                            ˜
                                                         
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      i
                                                   
                                                   
                                                   +
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            D
                                                         
                                                         0
                                                      
                                                      
                                                      +
                                                      
                                                      
                                                         
                                                            
                                                               Q
                                                            
                                                            ˜
                                                         
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ˜
                                                         
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      L
                                                   
                                                   
                                                   −
                                                   
                                                   
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      j
                                                   
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         −
                                                         +
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      
                                                         i
                                                         −
                                                         j
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Let us partition matrix 
                                 
                                    
                                       
                                          Q
                                       
                                       ˜
                                    
                                    ′
                                 
                               according to the positive and negative states. We get

                                 
                                    (36)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         ′
                                                         ′
                                                      
                                                   
                                                   =
                                                   
                                                      [
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              Q
                                                                           
                                                                           ˜
                                                                        
                                                                        
                                                                           ′
                                                                           ′
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     +
                                                                     +
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              Q
                                                                           
                                                                           ˜
                                                                        
                                                                        
                                                                           ′
                                                                           ′
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     +
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              Q
                                                                           
                                                                           ˜
                                                                        
                                                                        
                                                                           ′
                                                                           ′
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     −
                                                                     +
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              Q
                                                                           
                                                                           ˜
                                                                        
                                                                        
                                                                           ′
                                                                           ′
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     −
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      ]
                                                   
                                                   =
                                                   
                                                      [
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        Q
                                                                     
                                                                     ˜
                                                                  
                                                                  
                                                                     +
                                                                     +
                                                                  
                                                               
                                                            
                                                            
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        Q
                                                                     
                                                                     ˜
                                                                  
                                                                  
                                                                     +
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        Q
                                                                     
                                                                     ˜
                                                                  
                                                                  
                                                                     +
                                                                     +
                                                                  
                                                               
                                                            
                                                            
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        Q
                                                                     
                                                                     ˜
                                                                  
                                                                  
                                                                     +
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                            
                                                            
                                                               ⋱
                                                            
                                                            
                                                            
                                                            
                                                               ⋱
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        Q
                                                                     
                                                                     ˜
                                                                  
                                                                  
                                                                     −
                                                                     +
                                                                  
                                                               
                                                            
                                                            
                                                            
                                                            
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  0
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  L
                                                               
                                                            
                                                         
                                                         
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        Q
                                                                     
                                                                     ˜
                                                                  
                                                                  
                                                                     −
                                                                     +
                                                                  
                                                               
                                                            
                                                            
                                                            
                                                            
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  0
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  L
                                                               
                                                            
                                                         
                                                         
                                                            
                                                            
                                                            
                                                               ⋱
                                                            
                                                            
                                                            
                                                            
                                                               ⋱
                                                            
                                                         
                                                      
                                                      ]
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              Substituting Eqs. (36) and (33) into the NARE Eq. (4) provides the theorem after some algebraic manipulation.□

The probabilities for the number of low priority jobs at low priority departures 
                           
                              
                                 x
                                 i
                                 L
                              
                              =
                              P
                              
                                 (
                                 
                                    X
                                    L
                                 
                                 =
                                 i
                                 )
                              
                           
                         are obtained from 
                           
                              
                                 
                                    Ψ
                                 
                                 ˜
                              
                              i
                           
                         by taking into consideration the initial probability vector of the busy period 
                           
                              κ
                              ˜
                           
                        . For later use, we also introduce row vector 
                           
                              
                                 
                                    x
                                    ̲
                                 
                                 i
                                 L
                              
                              =
                              
                                 {
                                 P
                                 
                                    (
                                    
                                       X
                                       L
                                    
                                    =
                                    i
                                    ,
                                    J
                                    =
                                    j
                                    )
                                 
                                 ,
                                 j
                                 =
                                 1
                                 ,
                                 ⋯
                                 ,
                                 
                                    N
                                    A
                                 
                                 }
                              
                              ,
                           
                         the joint probability of the number of jobs and the phase of the MMAP at departures (obviously, 
                           
                              
                                 x
                                 i
                                 L
                              
                              =
                              
                                 
                                    x
                                    ̲
                                 
                                 i
                                 L
                              
                              1
                           
                        ).

                           Corollary 2
                           
                              For the distribution of the number of low priority jobs at low priority departures we have
                              
                                 
                                    (37)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                         ̲
                                                      
                                                      i
                                                      L
                                                   
                                                   =
                                                   
                                                      κ
                                                      ˜
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ˜
                                                      
                                                      i
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The significance of Eq. (37) lies in the fact that the consecutive queue length probabilities can be obtained by consecutive solutions of Sylvester equations calculating 
                           
                              
                                 
                                    Ψ
                                 
                                 ˜
                              
                              i
                           
                        . The prior procedures of the related literature are far more expensive computationally.

                           Corollary 3
                           
                              The generating function (GF) of the distribution of the number of jobs at departures
                              
                                 
                                    
                                       X
                                       L
                                    
                                    
                                       (
                                       z
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          i
                                          =
                                          0
                                       
                                       ∞
                                    
                                    
                                       z
                                       i
                                    
                                    
                                       
                                          x
                                          ̲
                                       
                                       i
                                       L
                                    
                                 
                               
                              can be obtained by
                              
                                 
                                    (38)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                      L
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   =
                                                   
                                                      κ
                                                      ˜
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      ˜
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where matrix
                              
                                 
                                    
                                       
                                          Ψ
                                       
                                       ˜
                                    
                                    
                                       (
                                       z
                                       )
                                    
                                 
                               
                              satisfies the NARE
                              
                                 
                                    (39)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Ψ
                                                      
                                                      ˜
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         −
                                                         +
                                                      
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      ˜
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   +
                                                   
                                                      
                                                         Ψ
                                                      
                                                      ˜
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            D
                                                         
                                                         0
                                                      
                                                      +
                                                      z
                                                      
                                                         
                                                            D
                                                         
                                                         L
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         +
                                                         +
                                                      
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      ˜
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         +
                                                         −
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      0
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Multiplying Eq. (35) by zi
                              , summing it from 1 to infinity, then adding Eq. (34) provides Eq. (39).□

Finally, the factorial moments of XL
                         can be calculated by taking the derivatives of the generating function, hence

                           
                              (40)
                              
                                 
                                    
                                       
                                          
                                             E
                                             
                                                (
                                                
                                                   X
                                                   L
                                                   k
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   0
                                                
                                                ∞
                                             
                                             
                                                i
                                                k
                                             
                                             
                                                x
                                                i
                                                L
                                             
                                             =
                                             
                                                
                                                   d
                                                   k
                                                
                                                
                                                   d
                                                   
                                                      z
                                                      k
                                                   
                                                
                                             
                                             
                                                X
                                                L
                                             
                                             
                                                
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   |
                                                
                                                
                                                   z
                                                   =
                                                   1
                                                
                                             
                                             1
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        yielding a recursion introduced by the next corollary.

                           Corollary 4
                           
                              For the kth factorial moment of XL we have
                              
                                 
                                    (41)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      E
                                                      
                                                         (
                                                         
                                                            X
                                                            L
                                                            k
                                                         
                                                         )
                                                      
                                                   
                                                   ̲
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      κ
                                                      ˜
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ˜
                                                         
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   ,
                                                   
                                                   E
                                                   
                                                      (
                                                      
                                                         X
                                                         L
                                                         k
                                                      
                                                      )
                                                   
                                                   =
                                                   
                                                      
                                                         E
                                                         
                                                            (
                                                            
                                                               X
                                                               L
                                                               k
                                                            
                                                            )
                                                         
                                                      
                                                      ̲
                                                   
                                                   1
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where
                              
                                 
                                    
                                       
                                          
                                             
                                                Ψ
                                             
                                             ˜
                                          
                                       
                                       
                                          (
                                          k
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          d
                                          k
                                       
                                       
                                          d
                                          
                                             z
                                             k
                                          
                                       
                                    
                                    
                                       
                                          Ψ
                                       
                                       ˜
                                    
                                    
                                       
                                          
                                             (
                                             z
                                             )
                                          
                                          |
                                       
                                       
                                          z
                                          =
                                          1
                                       
                                    
                                 
                              . Matrix
                              
                                 
                                    
                                       
                                          
                                             
                                                Ψ
                                             
                                             ˜
                                          
                                       
                                       
                                          (
                                          0
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          Ψ
                                       
                                       ˜
                                    
                                 
                               
                              and for k > 0 matrices
                              
                                 
                                    
                                       
                                          
                                             Ψ
                                          
                                          ˜
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                 
                               
                              are obtained recursively by solving the following Sylvester equations
                              
                                 
                                    (42)
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               Q
                                                            
                                                            ˜
                                                         
                                                         
                                                            +
                                                            +
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               ˜
                                                            
                                                         
                                                         
                                                            (
                                                            0
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               Q
                                                            
                                                            ˜
                                                         
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ˜
                                                         
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ˜
                                                         
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               Q
                                                            
                                                            ˜
                                                         
                                                         
                                                            −
                                                            −
                                                         
                                                      
                                                      
                                                      +
                                                      
                                                      
                                                         
                                                            
                                                               Q
                                                            
                                                            ˜
                                                         
                                                         
                                                            −
                                                            +
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               ˜
                                                            
                                                         
                                                         
                                                            (
                                                            0
                                                            )
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   =
                                                   −
                                                   k
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ˜
                                                         
                                                      
                                                      
                                                         (
                                                         k
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      L
                                                   
                                                   −
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         k
                                                         i
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ˜
                                                         
                                                      
                                                      
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            Q
                                                         
                                                         ˜
                                                      
                                                      
                                                         −
                                                         +
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ˜
                                                         
                                                      
                                                      
                                                         (
                                                         k
                                                         −
                                                         i
                                                         )
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

In the rest of the section we calculate various properties of the number of low priority jobs at random point in time denoted by YL
                        . Our contribution in this subsection ends here, since the relations between XL
                         and YL
                         are extensively studied in Takine (1996), which we adopt in this paper, and provide them for the sake of completeness.

Let us introduce row vector 
                           
                              
                                 
                                    y
                                    ̲
                                 
                                 i
                                 L
                              
                              =
                              
                                 {
                                 P
                                 
                                    (
                                    
                                       Y
                                       L
                                    
                                    =
                                    i
                                    ,
                                    J
                                    =
                                    j
                                    )
                                 
                                 ,
                                 j
                                 =
                                 1
                                 ,
                                 ⋯
                                 ,
                                 
                                    N
                                    A
                                 
                                 }
                              
                           
                        .

                           Theorem 7
                           (Takine, 1996, Theorem 4.6) The generating function of
                              
                                 
                                    
                                       
                                          y
                                          ̲
                                       
                                       i
                                       L
                                    
                                    ,
                                 
                               
                              denoted by
                              
                                 
                                    
                                       Y
                                       L
                                    
                                    
                                       (
                                       z
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          i
                                          =
                                          0
                                       
                                       ∞
                                    
                                    
                                       z
                                       i
                                    
                                    
                                       
                                          y
                                          ̲
                                       
                                       i
                                       L
                                    
                                 
                               
                              is related to XL
                              (z) as
                              
                                 
                                    (43)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Y
                                                      L
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            D
                                                         
                                                         0
                                                      
                                                      +
                                                      
                                                         
                                                            D
                                                         
                                                         H
                                                      
                                                      +
                                                      z
                                                      
                                                         
                                                            D
                                                         
                                                         L
                                                      
                                                      )
                                                   
                                                   =
                                                   
                                                      λ
                                                      L
                                                   
                                                   
                                                      (
                                                      z
                                                      −
                                                      1
                                                      )
                                                   
                                                   
                                                      X
                                                      L
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

(Takine, 1996, Corollary 3.11) Vectors
                              
                                 
                                    
                                       
                                          y
                                          ̲
                                       
                                       i
                                       L
                                    
                                    ,
                                    i
                                    ≥
                                    0
                                 
                               
                              are recursively obtained by
                              
                                 
                                    (44)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                               ̲
                                                            
                                                            0
                                                            L
                                                         
                                                      
                                                      
                                                         
                                                            =
                                                            
                                                               λ
                                                               L
                                                            
                                                            
                                                               
                                                                  x
                                                                  ̲
                                                               
                                                               0
                                                               L
                                                            
                                                            
                                                               
                                                                  (
                                                                  −
                                                                  
                                                                     
                                                                        D
                                                                     
                                                                     0
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        D
                                                                     
                                                                     H
                                                                  
                                                                  )
                                                               
                                                               
                                                                  −
                                                                  1
                                                               
                                                            
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                               ̲
                                                            
                                                            i
                                                            L
                                                         
                                                      
                                                      
                                                         
                                                            =
                                                            
                                                               (
                                                               
                                                                  
                                                                     y
                                                                     ̲
                                                                  
                                                                  
                                                                     i
                                                                     −
                                                                     1
                                                                  
                                                                  L
                                                               
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  L
                                                               
                                                               +
                                                               
                                                                  λ
                                                                  L
                                                               
                                                               
                                                                  
                                                                     x
                                                                     ̲
                                                                  
                                                                  i
                                                                  L
                                                               
                                                               −
                                                               
                                                                  λ
                                                                  L
                                                               
                                                               
                                                                  
                                                                     x
                                                                     ̲
                                                                  
                                                                  
                                                                     i
                                                                     −
                                                                     1
                                                                  
                                                                  L
                                                               
                                                               )
                                                            
                                                            
                                                               
                                                                  (
                                                                  −
                                                                  
                                                                     
                                                                        D
                                                                     
                                                                     0
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        D
                                                                     
                                                                     H
                                                                  
                                                                  )
                                                               
                                                               
                                                                  −
                                                                  1
                                                               
                                                            
                                                            ,
                                                            
                                                            i
                                                            >
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

(Takine, 1996, Corollary 3.10) The factorial moments of the number of low priority jobs at random point in time are obtained recursively as
                              
                                 
                                    (45)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            E
                                                            
                                                               (
                                                               
                                                                  Y
                                                                  L
                                                                  k
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            =
                                                            E
                                                            
                                                               (
                                                               
                                                                  X
                                                                  L
                                                                  k
                                                               
                                                               )
                                                            
                                                            +
                                                            k
                                                            
                                                               (
                                                               
                                                                  
                                                                     E
                                                                     
                                                                        (
                                                                        
                                                                           X
                                                                           L
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        )
                                                                     
                                                                  
                                                                  ̲
                                                               
                                                               −
                                                               
                                                                  
                                                                     E
                                                                     
                                                                        (
                                                                        
                                                                           Y
                                                                           L
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        )
                                                                     
                                                                  
                                                                  ̲
                                                               
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  L
                                                               
                                                               /
                                                               
                                                                  λ
                                                                  L
                                                               
                                                               )
                                                            
                                                            
                                                               
                                                                  (
                                                                  1
                                                                  θ
                                                                  −
                                                                  
                                                                     D
                                                                  
                                                                  )
                                                               
                                                               
                                                                  −
                                                                  1
                                                               
                                                            
                                                            
                                                               
                                                                  D
                                                               
                                                               L
                                                            
                                                            1
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               E
                                                               
                                                                  (
                                                                  
                                                                     Y
                                                                     L
                                                                     k
                                                                  
                                                                  )
                                                               
                                                            
                                                            ̲
                                                         
                                                      
                                                      
                                                         
                                                            =
                                                            E
                                                            
                                                               (
                                                               
                                                                  Y
                                                                  L
                                                                  k
                                                               
                                                               )
                                                            
                                                            θ
                                                            +
                                                            k
                                                            
                                                               (
                                                               
                                                                  
                                                                     E
                                                                     
                                                                        (
                                                                        
                                                                           Y
                                                                           L
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        )
                                                                     
                                                                  
                                                                  ̲
                                                               
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  L
                                                               
                                                               −
                                                               
                                                                  λ
                                                                  L
                                                               
                                                               
                                                                  
                                                                     E
                                                                     
                                                                        (
                                                                        
                                                                           X
                                                                           L
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        )
                                                                     
                                                                  
                                                                  ̲
                                                               
                                                               )
                                                            
                                                            
                                                               
                                                                  (
                                                                  1
                                                                  θ
                                                                  −
                                                                  
                                                                     D
                                                                  
                                                                  )
                                                               
                                                               
                                                                  −
                                                                  1
                                                               
                                                            
                                                            ,
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              for k > 0, and 
                                 
                                    
                                       
                                          E
                                          (
                                          
                                             Y
                                             L
                                             0
                                          
                                          )
                                       
                                       ̲
                                    
                                    =
                                    θ
                                 
                              .

In case of the preemptive resume service policy the high priority class can be analyzed in separation, as a single-class MAP/PH/1 queue with arrival process given by matrices 
                           
                              (
                              
                                 
                                    D
                                 
                                 0
                              
                              +
                              
                                 
                                    D
                                 
                                 L
                              
                              ,
                              
                                 
                                    D
                                 
                                 H
                              
                              )
                           
                         and service time distribution given by (σ
                        H, SH
                        ). The number of jobs in the system is matrix-exponentially distributed, and can be derived from the solution of a QBD (see Section 4.4.1 in He, 2014). The sojourn time of the jobs in a MAP/PH/1 queue is matrix exponentially distributed, as proven in He (2012) based on the analysis of the age process.

The two-class analysis procedure developed here can be used to solve models with more than two classes as well. When analyzing the ith class, all lower priority classes can be neglected, only the higher priority classes need to be taken into account. The details are provided in Appendix A.

The presented approach can be generalized to handle correlated service times as well, thus when the service process is a MAP. In this case the state space of the Markov chains corresponding to the fluid models have to be extended such that the phase of the service MAP is preserved in the negative states.

In the non-preemptive case the service of a low priority job cannot be interrupted. It turns out, that the analysis approach developed in Section 4 can still be used with a small difference. Instead of analyzing the sojourn time and the number of jobs in the system, in the non-preemptive case we will focus on the waiting time (which can be interrupted by a high priority arrival any time) and the number of waiting jobs in the system. The non-interruptible service time and the number of arrivals during it will be added afterward to obtain the sojourn time and the number of jobs in the system.

When a low priority job enters the system, its waiting time equals to the workload of the system just before its arrival (thus without its own service time) plus the service times of all high priority jobs arrived during waiting in the queue. To find out the workload just before the arrival in the example of Fig. 1 this means that we need the distribution of 
                           
                              V
                              (
                              t
                              )
                           
                         just before the jumps, instead of just after the jumps.

This distribution can be obtained by applying the same transformation procedure which results in a canonical Markovian fluid model with stationary fluid density π(x) and probability mass at level zero p. Embedding right before low priority arrivals we get the density

                           
                              (46)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         π
                                                         ˇ
                                                      
                                                      
                                                         (
                                                         x
                                                         )
                                                      
                                                   
                                                
                                                
                                                   
                                                      =
                                                      
                                                         1
                                                         
                                                            c
                                                            ˇ
                                                         
                                                      
                                                      π
                                                      
                                                         (
                                                         x
                                                         )
                                                      
                                                      
                                                         [
                                                         
                                                            
                                                               
                                                                  
                                                                     0
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     0
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        D
                                                                     
                                                                     L
                                                                  
                                                               
                                                            
                                                         
                                                         ]
                                                      
                                                      =
                                                      
                                                         1
                                                         
                                                            c
                                                            ˇ
                                                         
                                                      
                                                      
                                                         p
                                                         −
                                                      
                                                      
                                                         
                                                            Q
                                                            
                                                               −
                                                               +
                                                            
                                                         
                                                      
                                                      
                                                         e
                                                         
                                                            
                                                               K
                                                            
                                                            x
                                                         
                                                      
                                                      
                                                         [
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        I
                                                                     
                                                                     
                                                                     
                                                                        Ψ
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         ]
                                                      
                                                      
                                                         [
                                                         
                                                            
                                                               
                                                                  
                                                                     0
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     0
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        D
                                                                     
                                                                     L
                                                                  
                                                               
                                                            
                                                         
                                                         ]
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   
                                                      =
                                                      
                                                         
                                                            
                                                               
                                                                  1
                                                                  
                                                                     c
                                                                     ˇ
                                                                  
                                                               
                                                               
                                                                  p
                                                                  −
                                                               
                                                               
                                                                  
                                                                     Q
                                                                     
                                                                        −
                                                                        +
                                                                     
                                                                  
                                                               
                                                            
                                                            ︸
                                                         
                                                         
                                                            β
                                                            ˇ
                                                         
                                                      
                                                      
                                                         e
                                                         
                                                            
                                                               K
                                                            
                                                            x
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  Ψ
                                                               
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  L
                                                               
                                                            
                                                            ︸
                                                         
                                                         
                                                            
                                                               B
                                                            
                                                            ˇ
                                                         
                                                      
                                                      =
                                                      
                                                         β
                                                         ˇ
                                                      
                                                      
                                                         e
                                                         
                                                            
                                                               K
                                                            
                                                            x
                                                         
                                                      
                                                      
                                                         
                                                            B
                                                         
                                                         ˇ
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Note that the workload just before the arrival can be exactly zero as well, with probability mass

                           
                              (47)
                              
                                 
                                    
                                       
                                          
                                             p
                                             ˇ
                                          
                                       
                                       
                                          
                                             =
                                             
                                                1
                                                
                                                   c
                                                   ˇ
                                                
                                             
                                             
                                                p
                                                −
                                             
                                             
                                                
                                                   D
                                                
                                                L
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The normalization constant is 
                           
                              
                                 c
                                 ˇ
                              
                              =
                              
                                 p
                                 −
                              
                              
                                 
                                    D
                                 
                                 L
                              
                              1
                              +
                              
                                 p
                                 −
                              
                              
                                 
                                    Q
                                    
                                       −
                                       +
                                    
                                 
                              
                              
                                 
                                    (
                                    −
                                    
                                       K
                                    
                                    )
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 
                                    B
                                 
                                 ˇ
                              
                              1
                           
                        .

Similar to Theorem 5, it is again possible to similarity transform the representation 
                           
                              
                                 β
                                 ˇ
                              
                              ,
                              
                                 K
                              
                           
                         and 
                           
                              
                                 B
                              
                              ˇ
                           
                         to 
                           
                              
                                 
                                    β
                                    ˇ
                                 
                                 ′
                              
                              ,
                              
                                 
                                    K
                                 
                                 ′
                              
                           
                         and 
                           
                              
                                 
                                    
                                       B
                                    
                                    ˇ
                                 
                              
                              ′
                           
                         such that 
                           
                              
                                 
                                    K
                                 
                                 ′
                              
                              1
                              +
                              
                                 
                                    
                                       
                                          B
                                       
                                       ˇ
                                    
                                 
                                 ′
                              
                              1
                              =
                              0
                           
                         holds.

As mentioned before, first the waiting time (denoted by WL
                        ) is characterized, then the service time is added afterward to get the sojourn time.

As done in Section 4.2, it is possible to introduce the remaining waiting time process 
                           
                              W
                              (
                              t
                              )
                           
                         and construct a canonical fluid model 
                           
                              {
                              
                                 W
                                 ¯
                              
                              
                                 (
                                 t
                                 )
                              
                              ,
                              
                                 Z
                                 ¯
                              
                              
                                 (
                                 t
                                 )
                              
                              }
                           
                         whose busy period 
                           
                              B
                              ¯
                           
                         is closely related to the waiting time. The blocks of the generator of this fluid model are

                           
                              (48)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   ¯
                                                
                                                
                                                   +
                                                   +
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               K
                                                            
                                                            ′
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               
                                                                  S
                                                                  H
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   ¯
                                                
                                                
                                                   +
                                                   −
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     B
                                                                  
                                                                  ˇ
                                                               
                                                            
                                                            ′
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (49)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   ¯
                                                
                                                
                                                   −
                                                   +
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                            
                                                            
                                                            
                                                               
                                                                  D
                                                               
                                                               H
                                                            
                                                            ⊗
                                                            
                                                               σ
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   ¯
                                                
                                                
                                                   −
                                                   −
                                                
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   D
                                                
                                                0
                                             
                                             +
                                             
                                                
                                                   D
                                                
                                                L
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        and the distribution of 
                           
                              
                                 Z
                                 ¯
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         at 
                           
                              t
                              =
                              0
                           
                         (that defines the initial distribution of the busy period) is

                           
                              (50)
                              
                                 
                                    
                                       
                                          
                                             
                                                κ
                                                ¯
                                             
                                             =
                                             
                                                {
                                                P
                                                
                                                   (
                                                   
                                                      
                                                         Z
                                                         ¯
                                                      
                                                      +
                                                   
                                                   
                                                      (
                                                      0
                                                      )
                                                   
                                                   =
                                                   i
                                                   )
                                                
                                                }
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      β
                                                      ˇ
                                                   
                                                   ′
                                                
                                                
                                                0
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Note that everything is the same as in Section 4.2, except the parameters of the initial workload distribution. Hence, it is not surprising that 
                           
                              
                                 W
                                 L
                              
                              =
                              
                                 B
                                 ¯
                              
                              /
                              2
                           
                        .

                           Corollary 7
                           
                              The distribution of WL in time domain, in LST domain, and its moments can be expressed by
                              
                                 
                                    (51)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      F
                                                      
                                                         W
                                                         L
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      F
                                                      
                                                         B
                                                         ¯
                                                      
                                                   
                                                   
                                                      (
                                                      2
                                                      t
                                                      )
                                                   
                                                   ,
                                                   
                                                   
                                                      f
                                                      
                                                         W
                                                         L
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                   =
                                                   
                                                      f
                                                      
                                                         
                                                            B
                                                            ¯
                                                         
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      /
                                                      2
                                                      )
                                                   
                                                   ,
                                                   
                                                   E
                                                   
                                                      (
                                                      
                                                         W
                                                         L
                                                         k
                                                      
                                                      )
                                                   
                                                   =
                                                   E
                                                   
                                                      (
                                                      
                                                         
                                                            B
                                                            ¯
                                                         
                                                         k
                                                      
                                                      )
                                                   
                                                   /
                                                   
                                                      2
                                                      k
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

As 
                           
                              
                                 T
                                 L
                              
                              =
                              
                                 W
                                 L
                              
                              +
                              
                                 S
                                 L
                              
                           
                         holds, it is straight forward to obtain the LST of the distribution of TL
                         and its moments.

                           Corollary 8
                           
                              The LST of the distribution of TL is given by
                              
                                 
                                    (52)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      
                                                         T
                                                         L
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                   =
                                                   
                                                      f
                                                      
                                                         W
                                                         L
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                   
                                                      f
                                                      
                                                         S
                                                         L
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Taking the derivatives of 
                           
                              
                                 f
                                 
                                    T
                                    L
                                 
                                 *
                              
                              
                                 (
                                 s
                                 )
                              
                           
                         with respect to s and tending s → 0 yields the moments of the sojourn time.

                           Corollary 9
                           
                              The moments of the sojourn time TL are given by
                              
                                 
                                    (53)
                                    
                                       
                                          
                                             
                                                
                                                   E
                                                   
                                                      (
                                                      
                                                         T
                                                         L
                                                         k
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         0
                                                      
                                                      k
                                                   
                                                   
                                                      (
                                                      
                                                         k
                                                         i
                                                      
                                                      )
                                                   
                                                   E
                                                   
                                                      (
                                                      
                                                         W
                                                         L
                                                         i
                                                      
                                                      )
                                                   
                                                   E
                                                   
                                                      (
                                                      
                                                         S
                                                         L
                                                         
                                                            k
                                                            −
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The distribution function of the sojourn time is more involved to obtain. One could directly express it as a continuous time convolution of 
                           
                              
                                 F
                                 
                                    W
                                    L
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         and 
                           
                              
                                 f
                                 
                                    S
                                    L
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              ,
                           
                         but it would involve an integral which can be evaluated only numerically. Remind that both 
                           
                              
                                 F
                                 
                                    T
                                    L
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         in the preemptive resume case and 
                           
                              
                                 F
                                 
                                    W
                                    L
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         in the non-preemptive case are derived from the distribution of the busy period of an appropriate fluid model, which is computed in terms of Erlangization (see Section 3.2), meaning that an order-n approximation is applied where increasing n improves the accuracy. For the preemptive resume case we had that the order-n approximation is

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                F
                                                
                                                   
                                                      T
                                                      L
                                                   
                                                   ,
                                                   preemp
                                                   .
                                                
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             P
                                             
                                                (
                                                
                                                   B
                                                   ˜
                                                
                                                /
                                                2
                                                
                                                <
                                                
                                                Erlang
                                                
                                                   (
                                                   n
                                                   ,
                                                   
                                                      n
                                                      t
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             P
                                             
                                                (
                                                
                                                   B
                                                   ˜
                                                
                                                <
                                                Erlang
                                                
                                                   (
                                                   n
                                                   ,
                                                   
                                                      n
                                                      
                                                         2
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                )
                                             
                                             =
                                             
                                                κ
                                                ˜
                                             
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   0
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   
                                                      Ψ
                                                   
                                                   ˜
                                                
                                                k
                                                ν
                                             
                                             1
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        with 
                           
                              ν
                              =
                              n
                              /
                              (
                              2
                              t
                              )
                           
                         and 
                           
                              
                                 κ
                                 ˜
                              
                              
                                 
                                    
                                       Ψ
                                    
                                    ˜
                                 
                                 k
                                 ν
                              
                              1
                           
                         holding the probabilities that k Exp(ν) events occur during the busy period.

In the non-preemptive case, however, busy period 
                           
                              B
                              ¯
                           
                         corresponds to the waiting time only. Thus, we have that the sojourn time distribution is

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                F
                                                
                                                   
                                                      T
                                                      L
                                                   
                                                
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             P
                                             
                                                (
                                                
                                                   B
                                                   ¯
                                                
                                                /
                                                2
                                                +
                                                
                                                   S
                                                   L
                                                
                                                <
                                                Erlang
                                                
                                                   (
                                                   n
                                                   ,
                                                   
                                                      n
                                                      t
                                                   
                                                   )
                                                
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           Theorem 8
                           
                              The order-n approximation of the distribution function of TL is
                              
                                 
                                    (54)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      F
                                                      
                                                         
                                                            T
                                                            L
                                                         
                                                      
                                                      
                                                         (
                                                         n
                                                         )
                                                      
                                                   
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   =
                                                   
                                                      κ
                                                      ¯
                                                   
                                                   
                                                      ∑
                                                      
                                                         k
                                                         =
                                                         0
                                                      
                                                      
                                                         n
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ¯
                                                         
                                                      
                                                      k
                                                      ν
                                                   
                                                   1
                                                   
                                                      d
                                                      
                                                         n
                                                         −
                                                         k
                                                      
                                                   
                                                   +
                                                   
                                                      p
                                                      ˇ
                                                   
                                                   1
                                                   
                                                      d
                                                      n
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where
                              
                                 
                                    ν
                                    =
                                    n
                                    /
                                    (
                                    2
                                    t
                                    )
                                    ,
                                 
                               
                              matrices
                              
                                 
                                    
                                       
                                          
                                             Ψ
                                          
                                          ¯
                                       
                                    
                                    k
                                    ν
                                 
                               
                              are defined by 
                              Theorem 4 
                              with using
                              
                                 
                                    
                                       Q
                                    
                                    ¯
                                 
                               
                              instead of 
                              Q, and probabilities dn are given by
                              
                                 
                                    (55)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      d
                                                      n
                                                   
                                                   =
                                                   1
                                                   −
                                                   
                                                      σ
                                                      L
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            I
                                                         
                                                         −
                                                         
                                                            
                                                               S
                                                               L
                                                            
                                                         
                                                         /
                                                         
                                                            (
                                                            2
                                                            ν
                                                            )
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         n
                                                      
                                                   
                                                   1
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

We have that

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      F
                                                      
                                                         
                                                            T
                                                            L
                                                         
                                                      
                                                      
                                                         (
                                                         n
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   P
                                                   
                                                      (
                                                      
                                                         B
                                                         ¯
                                                      
                                                      /
                                                      2
                                                      +
                                                      
                                                         S
                                                         L
                                                      
                                                      <
                                                      Erlang
                                                      
                                                         (
                                                         n
                                                         ,
                                                         
                                                            n
                                                            t
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   P
                                                   (
                                                   
                                                      B
                                                      ¯
                                                   
                                                   +
                                                   2
                                                   
                                                      S
                                                      L
                                                   
                                                   <
                                                   Erlang
                                                   
                                                      (
                                                      n
                                                      ,
                                                      ν
                                                      )
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      κ
                                                      ¯
                                                   
                                                   
                                                      ∑
                                                      
                                                         k
                                                         =
                                                         0
                                                      
                                                      
                                                         n
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ¯
                                                         
                                                      
                                                      k
                                                      ν
                                                   
                                                   1
                                                   ·
                                                   
                                                      
                                                         
                                                            P
                                                            (
                                                            2
                                                            
                                                               S
                                                               L
                                                            
                                                            <
                                                            Erlang
                                                            
                                                               (
                                                               n
                                                               −
                                                               k
                                                               ,
                                                               ν
                                                               )
                                                            
                                                            )
                                                         
                                                         ︸
                                                      
                                                      
                                                         d
                                                         
                                                            n
                                                            −
                                                            k
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   +
                                                   
                                                   
                                                      p
                                                      ˇ
                                                   
                                                   1
                                                   ·
                                                   
                                                      
                                                         
                                                            P
                                                            (
                                                            2
                                                            
                                                               S
                                                               L
                                                            
                                                            <
                                                            Erlang
                                                            
                                                               (
                                                               n
                                                               ,
                                                               ν
                                                               )
                                                            
                                                            )
                                                         
                                                         ︸
                                                      
                                                      
                                                         d
                                                         n
                                                      
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              where the second term corresponds to the case when 
                                 
                                    
                                       W
                                       L
                                    
                                    =
                                    0
                                 
                              . The d
                              ℓ probabilities can be derived as

                                 
                                    
                                       
                                          
                                             
                                                
                                                   d
                                                   n
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   P
                                                   
                                                      (
                                                      2
                                                      
                                                         S
                                                         L
                                                      
                                                      <
                                                      Erlang
                                                      
                                                         (
                                                         n
                                                         ,
                                                         ν
                                                         )
                                                      
                                                      )
                                                   
                                                   =
                                                   P
                                                   
                                                      (
                                                      
                                                         S
                                                         L
                                                      
                                                      <
                                                      Erlang
                                                      
                                                         (
                                                         n
                                                         ,
                                                         2
                                                         ν
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   1
                                                   −
                                                   
                                                      ∫
                                                      
                                                         u
                                                         =
                                                         0
                                                      
                                                      ∞
                                                   
                                                   
                                                      
                                                         
                                                            (
                                                            2
                                                            ν
                                                            u
                                                            )
                                                         
                                                         
                                                            n
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         n
                                                         −
                                                         1
                                                         )
                                                         !
                                                      
                                                   
                                                   2
                                                   ν
                                                   
                                                      e
                                                      
                                                         −
                                                         2
                                                         ν
                                                         u
                                                      
                                                   
                                                   
                                                      σ
                                                      L
                                                   
                                                   
                                                      e
                                                      
                                                         
                                                            
                                                               S
                                                            
                                                            L
                                                         
                                                         u
                                                      
                                                   
                                                   1
                                                   d
                                                   u
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   1
                                                   −
                                                   
                                                      
                                                         
                                                            (
                                                            −
                                                            ν
                                                            )
                                                         
                                                         
                                                            n
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         n
                                                         −
                                                         1
                                                         )
                                                         !
                                                      
                                                   
                                                   2
                                                   ν
                                                   
                                                      σ
                                                      L
                                                   
                                                   
                                                      ∫
                                                      
                                                         u
                                                         =
                                                         0
                                                      
                                                      ∞
                                                   
                                                   
                                                      
                                                         d
                                                         
                                                            n
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         d
                                                         
                                                            ν
                                                            
                                                               n
                                                               −
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      e
                                                      
                                                         −
                                                         2
                                                         ν
                                                         u
                                                      
                                                   
                                                   
                                                      e
                                                      
                                                         
                                                            
                                                               S
                                                            
                                                            L
                                                         
                                                         u
                                                      
                                                   
                                                   1
                                                   d
                                                   u
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   1
                                                   −
                                                   
                                                      
                                                         
                                                            (
                                                            −
                                                            ν
                                                            )
                                                         
                                                         
                                                            n
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         n
                                                         −
                                                         1
                                                         )
                                                         !
                                                      
                                                   
                                                   2
                                                   ν
                                                   
                                                      σ
                                                      L
                                                   
                                                   
                                                      
                                                         d
                                                         
                                                            n
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         d
                                                         
                                                            ν
                                                            
                                                               n
                                                               −
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         2
                                                         ν
                                                         
                                                            I
                                                         
                                                         −
                                                         
                                                            
                                                               S
                                                            
                                                            L
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   1
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   1
                                                   −
                                                   
                                                      
                                                         (
                                                         2
                                                         ν
                                                         )
                                                      
                                                      n
                                                   
                                                   
                                                      σ
                                                      L
                                                   
                                                   
                                                      
                                                         (
                                                         2
                                                         ν
                                                         
                                                            I
                                                         
                                                         −
                                                         
                                                            
                                                               S
                                                            
                                                            L
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         n
                                                      
                                                   
                                                   1
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              that equals to Eq. (55).□

As in the preemptive resume case, first the number of low priority jobs at low priority departures is analyzed, from which the results corresponding to a random point in time are derived.

To obtain the number of low priority jobs at low priority departures (XL
                        ) a tagged low priority job is picked, and the number of low priority arrivals is counted during its stay in the system. This quantity consists of two components: the number of arrivals during the waiting time, and the number of additional arrivals during the service time.

The number of arrivals during the waiting time can be derived from the fluid model representing the remaining waiting time process introduced in Section 5.2. We follow the exactly same recipe as in Section 4.3 with the preemptive case, thus we modify the background process of the fluid model 
                           
                              
                                 Q
                              
                              ¯
                           
                         such that it counts the number of arrivals during the busy period and get 
                           
                              
                                 
                                    
                                       Q
                                    
                                    ¯
                                 
                              
                              ′
                           
                        . The blocks of the corresponding 
                           
                              
                                 
                                    
                                       Ψ
                                    
                                    ¯
                                 
                              
                              ′
                           
                         matrix, 
                           
                              
                                 
                                    Ψ
                                 
                                 ¯
                              
                              k
                           
                         are holding the probabilities that k arrivals occurred during the busy period (that is, during the waiting time) given the initial phase of the MMAP. These matrices can be calculated as Theorem 6 does in the preemptive resume case, the only difference is that matrix 
                           
                              
                                 Q
                              
                              ¯
                           
                         needs to be used instead of matrix 
                           
                              
                                 Q
                              
                              ˜
                           
                        .

As for the second component, let us introduce matrices Ai
                        , i ≥ 0 whose (k, ℓ)th entry is the probability that the MMAP generates i low priority arrivals during a low priority service time starting from phase k and the MMAP phase at the end of service is ℓ. Matrices Ai
                         are matrix-geometric

                           
                              (56)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   A
                                                   i
                                                
                                             
                                             =
                                             
                                                α
                                             
                                             ·
                                             
                                                
                                                   A
                                                
                                                i
                                             
                                             
                                                a
                                             
                                             ,
                                             
                                             i
                                             ≥
                                             0
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where

                           
                              (57)
                              
                                 
                                    
                                       
                                          
                                             α
                                          
                                       
                                       
                                          
                                             =
                                             
                                                I
                                             
                                             ⊗
                                             
                                                σ
                                                L
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (58)
                              
                                 
                                    
                                       
                                          
                                             A
                                          
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   (
                                                   −
                                                   
                                                      (
                                                      
                                                         
                                                            D
                                                         
                                                         0
                                                      
                                                      +
                                                      
                                                         
                                                            D
                                                         
                                                         H
                                                      
                                                      )
                                                   
                                                   ⊕
                                                   
                                                      
                                                         S
                                                      
                                                      L
                                                   
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      D
                                                   
                                                   L
                                                
                                                ⊗
                                                
                                                   I
                                                
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (59)
                              
                                 
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   (
                                                   −
                                                   
                                                      (
                                                      
                                                         
                                                            D
                                                         
                                                         0
                                                      
                                                      +
                                                      
                                                         
                                                            D
                                                         
                                                         H
                                                      
                                                      )
                                                   
                                                   ⊕
                                                   
                                                      
                                                         S
                                                      
                                                      L
                                                   
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   I
                                                
                                                ⊗
                                                
                                                   s
                                                   L
                                                
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           Theorem 9
                           
                              The joint probability of the number of low priority jobs in the system and the phase of the MMAP at low priority departure instants is
                              
                                 
                                    (60)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                         ̲
                                                      
                                                      i
                                                      L
                                                   
                                                   =
                                                   
                                                      h
                                                      i
                                                   
                                                   ·
                                                   
                                                      a
                                                   
                                                   +
                                                   
                                                      p
                                                      ˇ
                                                   
                                                   
                                                      
                                                         A
                                                         i
                                                      
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where matrix
                              
                                 
                                    
                                       h
                                       0
                                    
                                    =
                                    
                                       κ
                                       ¯
                                    
                                    
                                       
                                          
                                             Ψ
                                          
                                          ¯
                                       
                                       0
                                    
                                 
                               and hi, i > 0 is defined recursively as
                              
                                 
                                    (61)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      h
                                                      i
                                                   
                                                   =
                                                   
                                                      h
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   ·
                                                   
                                                      A
                                                   
                                                   +
                                                   
                                                      κ
                                                      ¯
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ¯
                                                      
                                                      i
                                                   
                                                   
                                                      α
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Let us sum the number of arrivals during the waiting time and during the service time by convolution, yielding

                                 
                                    (62)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                         ̲
                                                      
                                                      i
                                                      L
                                                   
                                                   =
                                                   
                                                      ∑
                                                      
                                                         k
                                                         =
                                                         0
                                                      
                                                      i
                                                   
                                                   
                                                      κ
                                                      ¯
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ¯
                                                      
                                                      k
                                                   
                                                   
                                                      
                                                         A
                                                         
                                                            i
                                                            −
                                                            k
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      p
                                                      ˇ
                                                   
                                                   
                                                      
                                                         A
                                                         i
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                               
                                                                  k
                                                                  =
                                                                  0
                                                               
                                                               i
                                                            
                                                            
                                                               κ
                                                               ¯
                                                            
                                                            
                                                               
                                                                  
                                                                     Ψ
                                                                  
                                                                  ¯
                                                               
                                                               k
                                                            
                                                            
                                                               α
                                                            
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  i
                                                                  −
                                                                  k
                                                               
                                                            
                                                         
                                                         ︸
                                                      
                                                      
                                                         h
                                                         i
                                                      
                                                   
                                                   
                                                      a
                                                   
                                                   +
                                                   
                                                      p
                                                      ˇ
                                                   
                                                   
                                                      
                                                         A
                                                         i
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              The recursion for hi
                               can be shown by

                                 
                                    (63)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      h
                                                      i
                                                   
                                                   =
                                                   
                                                      ∑
                                                      
                                                         k
                                                         =
                                                         0
                                                      
                                                      i
                                                   
                                                   
                                                      κ
                                                      ¯
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ¯
                                                      
                                                      k
                                                   
                                                   
                                                      α
                                                   
                                                   
                                                      
                                                         A
                                                      
                                                      
                                                         i
                                                         −
                                                         k
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                               
                                                                  k
                                                                  =
                                                                  0
                                                               
                                                               
                                                                  i
                                                                  −
                                                                  1
                                                               
                                                            
                                                            
                                                               κ
                                                               ¯
                                                            
                                                            
                                                               
                                                                  
                                                                     Ψ
                                                                  
                                                                  ¯
                                                               
                                                               k
                                                            
                                                            
                                                               α
                                                            
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  i
                                                                  −
                                                                  1
                                                                  −
                                                                  k
                                                               
                                                            
                                                         
                                                         ︸
                                                      
                                                      
                                                         h
                                                         
                                                            i
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                   ·
                                                   
                                                      A
                                                   
                                                   +
                                                   
                                                      κ
                                                      ¯
                                                   
                                                   
                                                      
                                                         
                                                            Ψ
                                                         
                                                         ¯
                                                      
                                                      i
                                                   
                                                   
                                                      α
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              □

By introducing the generating functions 
                           
                              
                                 
                                    Ψ
                                 
                                 ¯
                              
                              
                                 (
                                 z
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    0
                                 
                                 ∞
                              
                              
                                 z
                                 i
                              
                              
                                 
                                    
                                       Ψ
                                    
                                    ¯
                                 
                                 i
                              
                           
                         and 
                           
                              
                                 A
                              
                              
                                 (
                                 z
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    0
                                 
                                 ∞
                              
                              
                                 z
                                 i
                              
                              
                                 
                                    A
                                    i
                                 
                              
                              ,
                           
                         the generating function 
                           
                              
                                 X
                                 L
                              
                              
                                 (
                                 z
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    0
                                 
                                 ∞
                              
                              
                                 z
                                 i
                              
                              
                                 
                                    x
                                    ̲
                                 
                                 i
                                 L
                              
                           
                         is easy to obtain from Eqs. (62) and (56).

                           Corollary 10
                           
                              XL
                              (z) is expressed by
                              
                                 
                                    (64)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                      L
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   =
                                                   
                                                      κ
                                                      ¯
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      ¯
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   
                                                      A
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   +
                                                   
                                                      p
                                                      ˇ
                                                   
                                                   
                                                      A
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where matrix
                              
                                 
                                    
                                       A
                                    
                                    
                                       (
                                       z
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          i
                                          =
                                          0
                                       
                                       ∞
                                    
                                    
                                       z
                                       i
                                    
                                    
                                       
                                          A
                                          i
                                       
                                    
                                 
                               
                              has the following closed form formula
                              
                                 
                                    (65)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   (
                                                   z
                                                   )
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      α
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            I
                                                         
                                                         −
                                                         z
                                                         
                                                            A
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      a
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Based on Eq. (40) the factorial moments at departures are calculated by routine derivations of Eq. (64).

                           Corollary 11
                           
                              For the kth factorial moment of the number of low priority jobs at low priority departures we have
                              
                                 
                                    (66)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      E
                                                      
                                                         (
                                                         
                                                            X
                                                            L
                                                            k
                                                         
                                                         )
                                                      
                                                   
                                                   ̲
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         0
                                                      
                                                      k
                                                   
                                                   
                                                      (
                                                      
                                                         k
                                                         i
                                                      
                                                      )
                                                   
                                                   
                                                      κ
                                                      ¯
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               Ψ
                                                            
                                                            ¯
                                                         
                                                      
                                                      
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         A
                                                      
                                                      
                                                         (
                                                         k
                                                         −
                                                         i
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      p
                                                      ˇ
                                                   
                                                   
                                                      
                                                         A
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where matrices
                              
                                 
                                    
                                       
                                          
                                             
                                                Ψ
                                             
                                             ¯
                                          
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          d
                                          i
                                       
                                       
                                          d
                                          
                                             z
                                             i
                                          
                                       
                                    
                                    
                                       
                                          Ψ
                                       
                                       ¯
                                    
                                    
                                       
                                          
                                             (
                                             z
                                             )
                                          
                                          |
                                       
                                       
                                          z
                                          =
                                          1
                                       
                                    
                                 
                               
                              are obtained similar to 
                              
                                 Eq. (42) 
                              and matrices
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                    
                                    =
                                    
                                       
                                          d
                                          i
                                       
                                       
                                          d
                                          
                                             z
                                             i
                                          
                                       
                                    
                                    
                                       
                                          
                                             A
                                          
                                          
                                             (
                                             z
                                             )
                                          
                                          |
                                       
                                       
                                          z
                                          =
                                          1
                                       
                                    
                                 
                               
                              have the following closed form:
                              
                                 
                                    (67)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   i
                                                   !
                                                   
                                                      α
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            I
                                                         
                                                         −
                                                         
                                                            A
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         A
                                                      
                                                      i
                                                   
                                                   
                                                      a
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Having characterized the number of low priority jobs at low priority departure epochs, the properties of the number of low priority jobs at a random point in time are given by Theorem 7 and Corollaries 5 and 6.

In the non-preemptive case the high priority class cannot be analyzed in separation, since a high priority job cannot be served immediately when a low priority job is in the server.

We use the workload process of the high priority class denoted by 
                           
                              {
                              
                                 V
                                 H
                              
                              
                                 (
                                 t
                                 )
                              
                              ,
                              t
                              >
                              0
                              }
                           
                         to derive the performance measures.
                           1
                        
                        
                           1
                           Contrary to Sections 4.1 and 5.1, where the workload process of the entire system is discussed, the workload process considered here applies only to the high priority class.
                         The trajectory of 
                           
                              
                                 V
                                 H
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         contains intervals where the slope is zero corresponding to the periods when the server serves low priority jobs. As before, 
                           
                              
                                 V
                                 H
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         is transformed to a fluid model (see Fig. 5
                         for an example).

The blocks of the generator matrix of this fluid model are defined by

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                +
                                                +
                                             
                                             H
                                          
                                       
                                       
                                          
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               
                                                                  S
                                                                  H
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               
                                                                  S
                                                                  H
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   +
                                                   −
                                                
                                                H
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                          
                                       
                                       
                                       
                                    
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                +
                                                0
                                             
                                             H
                                          
                                       
                                       
                                          
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                −
                                                +
                                             
                                             H
                                          
                                       
                                       
                                          
                                             =
                                             
                                                [
                                                
                                                   0
                                                
                                                
                                                
                                                
                                                
                                                   
                                                      D
                                                   
                                                   H
                                                
                                                ⊗
                                                
                                                   σ
                                                   H
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   −
                                                   −
                                                
                                                H
                                             
                                             =
                                             
                                                
                                                   D
                                                
                                                0
                                             
                                             +
                                             
                                                
                                                   D
                                                
                                                L
                                             
                                             ,
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   −
                                                   0
                                                
                                                H
                                             
                                             =
                                             
                                                0
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                0
                                                +
                                             
                                             H
                                          
                                       
                                       
                                          
                                             =
                                             
                                                [
                                                
                                                   
                                                      D
                                                   
                                                   H
                                                
                                                ⊗
                                                
                                                   I
                                                
                                                ⊗
                                                
                                                   σ
                                                   H
                                                
                                                
                                                
                                                
                                                
                                                   0
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   0
                                                   −
                                                
                                                H
                                             
                                             =
                                             
                                                I
                                             
                                             ⊗
                                             
                                                s
                                                L
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             00
                                             H
                                          
                                       
                                       
                                          
                                             =
                                             
                                                (
                                                
                                                   
                                                      D
                                                   
                                                   0
                                                
                                                +
                                                
                                                   
                                                      D
                                                   
                                                   L
                                                
                                                )
                                             
                                             ⊕
                                             
                                                
                                                   S
                                                
                                                L
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Four state groups can be identified in the generator. The two state groups of 
                           
                              S
                              +
                           
                         both correspond to the workload accumulation due to a new high priority arrival. The difference is that in the first state group the server works on a low priority job, thus the phase of its service needs to be maintained during the workload accumulation. In the negative states 
                           
                              S
                              −
                           
                         the server is working on a high, in the zero states 
                           
                              S
                              0
                           
                         the server is working on a low priority job.

The probability of the phases when the workload process leaves level zero, denoted by vector κH
                        , is not easy to obtain. Regarding this vector we are relying on the results of Takine (1996), which we re-formulate and simplify at several points due to the PH distributed service times.

Let us investigate the system at the departures that leave the high priority queue empty, and introduce two probability vectors, ϕ and ϕ
                        0 associated with this embedded process. The ith entry of ϕ
                        0 is the probability that the whole system is empty at the embedded instant and the phase of the MMAP is i. Entry i of vector ϕ is the probability that the embedded process is in state i in the product space of the MMAP phase and the phase of the low priority service time.

                           Theorem 10
                           
                              Vector ϕ
                              0 
                              is given by
                              
                                 
                                    (68)
                                    
                                       
                                          
                                             
                                                
                                                   ϕ
                                                   0
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      
                                                         
                                                            (
                                                            1
                                                            −
                                                            ρ
                                                            )
                                                         
                                                         
                                                            p
                                                            −
                                                         
                                                         
                                                            (
                                                            −
                                                            
                                                               
                                                                  D
                                                               
                                                               0
                                                            
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            λ
                                                            L
                                                         
                                                         
                                                            p
                                                            −
                                                         
                                                         1
                                                         +
                                                         
                                                            (
                                                            1
                                                            −
                                                            ρ
                                                            )
                                                         
                                                         
                                                            p
                                                            −
                                                         
                                                         
                                                            
                                                               D
                                                            
                                                            H
                                                         
                                                         1
                                                      
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where
                              
                                 
                                    p
                                    −
                                 
                               
                              is the probability mass vector of the fluid queue representing the workload process of the whole system (see 
                              
                                 Sections 4.1
                               
                              and 
                              
                                 5.1
                              
                              ).
                           


                              Vector ϕ is the unique solution to the linear system
                              
                                 
                                    (69)
                                    
                                       
                                          
                                             
                                                ϕ
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      (
                                                      ϕ
                                                      −
                                                      
                                                         ϕ
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      (
                                                      
                                                         I
                                                      
                                                      ⊗
                                                      
                                                         σ
                                                         L
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            (
                                                            
                                                               
                                                                  D
                                                               
                                                               0
                                                            
                                                            +
                                                            
                                                               
                                                                  D
                                                               
                                                               L
                                                            
                                                            )
                                                         
                                                         ⊕
                                                         
                                                            
                                                               S
                                                               L
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            D
                                                         
                                                         H
                                                      
                                                      ⊗
                                                      
                                                         I
                                                      
                                                      ⊗
                                                      
                                                         σ
                                                         H
                                                      
                                                      
                                                      
                                                         0
                                                      
                                                      ]
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      H
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      (
                                                      ϕ
                                                      −
                                                      
                                                         ϕ
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      (
                                                      
                                                         I
                                                      
                                                      ⊗
                                                      
                                                         σ
                                                         L
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            (
                                                            
                                                               
                                                                  D
                                                               
                                                               0
                                                            
                                                            +
                                                            
                                                               
                                                                  D
                                                               
                                                               L
                                                            
                                                            )
                                                         
                                                         ⊕
                                                         
                                                            
                                                               S
                                                               L
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         I
                                                      
                                                      ⊗
                                                      
                                                         s
                                                         L
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      ϕ
                                                      0
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            
                                                               D
                                                            
                                                            0
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            D
                                                         
                                                         L
                                                      
                                                      ⊗
                                                      
                                                         σ
                                                         L
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            (
                                                            
                                                               
                                                                  D
                                                               
                                                               0
                                                            
                                                            +
                                                            
                                                               
                                                                  D
                                                               
                                                               L
                                                            
                                                            )
                                                         
                                                         ⊕
                                                         
                                                            
                                                               S
                                                               L
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            D
                                                         
                                                         H
                                                      
                                                      ⊗
                                                      
                                                         I
                                                      
                                                      ⊗
                                                      
                                                         σ
                                                         H
                                                      
                                                      
                                                      
                                                      
                                                         0
                                                      
                                                      ]
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      H
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      ϕ
                                                      0
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            
                                                               D
                                                            
                                                            0
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            D
                                                         
                                                         L
                                                      
                                                      ⊗
                                                      
                                                         σ
                                                         L
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            (
                                                            
                                                               
                                                                  D
                                                               
                                                               0
                                                            
                                                            +
                                                            
                                                               
                                                                  D
                                                               
                                                               L
                                                            
                                                            )
                                                         
                                                         ⊕
                                                         
                                                            
                                                               S
                                                               L
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         I
                                                      
                                                      ⊗
                                                      
                                                         s
                                                         L
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      ϕ
                                                      0
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            
                                                               D
                                                            
                                                            0
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      [
                                                      
                                                         0
                                                      
                                                      
                                                      
                                                      
                                                         
                                                            D
                                                         
                                                         H
                                                      
                                                      ⊗
                                                      
                                                         σ
                                                         H
                                                      
                                                      ]
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      H
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (70)
                                    
                                       
                                          
                                             
                                                
                                                   ϕ
                                                   1
                                                
                                             
                                             
                                                
                                                   =
                                                   1
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where 
                              
                                 Ψ
                              
                              
                                 H
                               
                              is the solution of the NARE
                              
                                 
                                    (71)
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         Ψ
                                                      
                                                      H
                                                   
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         −
                                                         +
                                                      
                                                      H
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      H
                                                   
                                                   +
                                                   
                                                      
                                                         Ψ
                                                      
                                                      H
                                                   
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         −
                                                         −
                                                      
                                                      H
                                                   
                                                   +
                                                   
                                                      (
                                                      
                                                         
                                                            Q
                                                         
                                                         
                                                            +
                                                            +
                                                         
                                                         H
                                                      
                                                      +
                                                      
                                                         
                                                            Q
                                                         
                                                         
                                                            +
                                                            0
                                                         
                                                         H
                                                      
                                                      
                                                         
                                                            (
                                                            −
                                                            
                                                               
                                                                  Q
                                                               
                                                               00
                                                               H
                                                            
                                                            )
                                                         
                                                         
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            Q
                                                         
                                                         
                                                            0
                                                            +
                                                         
                                                         H
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         Ψ
                                                      
                                                      H
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         +
                                                         −
                                                      
                                                      H
                                                   
                                                   +
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         +
                                                         0
                                                      
                                                      H
                                                   
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            
                                                               Q
                                                            
                                                            00
                                                            H
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         0
                                                         −
                                                      
                                                      H
                                                   
                                                   =
                                                   
                                                      0
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           


                              Eq. (68) follows from Takine (1996), Theorem 3.1 and Takine (1996), Lemma 3.2.


                              Eq. (69) has five terms. The first one corresponds to the case when there are low priority jobs in the system when the last high priority job leaves. The server starts to serve a low priority job. The PH of the service process and the MMAP evolve together, and the MMAP generates a high priority arrival before the current service is completed, and initiates the workload process (see Fig. 5). The next departure leaving the high priority class empty occurs when the workload of the high priority class returns to level zero, with the corresponding phase transitions given by 
                                 Ψ
                              
                              
                                 H
                               (which satisfies the usual NARE after censoring out the zero states). According to the second term the low priority service is completed before the MMAP generates a high priority job, providing the phase of the next embedded point. In the third and fourth term the last high priority job leaves the system empty, and the next arriving job is a low priority one, while in the last term the next arriving job is a high priority one.□

Let us introduce vectors 
                           
                              q
                              L
                              H
                           
                         and 
                           
                              q
                              0
                              H
                           
                         as the stationary phase probabilities that the server is working on a low priority job and that the system is idle when there are no high priority jobs in the system, respectively. These probability vectors can be obtained from ϕ and ϕ
                        0 by taking into account the mean amount of time spent in various phases in the system, yielding

                           
                              (72)
                              
                                 
                                    
                                       
                                          
                                             q
                                             L
                                             H
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                1
                                                
                                                   c
                                                   H
                                                
                                             
                                             
                                                (
                                                ϕ
                                                −
                                                
                                                   ϕ
                                                   0
                                                
                                                +
                                                
                                                   ϕ
                                                   0
                                                
                                                
                                                   
                                                      (
                                                      −
                                                      
                                                         
                                                            D
                                                         
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   
                                                      D
                                                   
                                                   L
                                                
                                                )
                                             
                                             
                                                (
                                                
                                                   I
                                                
                                                
                                                ⊗
                                                
                                                
                                                   σ
                                                   L
                                                
                                                )
                                             
                                             
                                                
                                                   (
                                                   −
                                                   
                                                      (
                                                      
                                                         
                                                            D
                                                         
                                                         0
                                                      
                                                      
                                                      +
                                                      
                                                      
                                                         
                                                            D
                                                         
                                                         L
                                                      
                                                      )
                                                   
                                                   
                                                   ⊕
                                                   
                                                   
                                                      
                                                         S
                                                      
                                                      L
                                                   
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             q
                                             0
                                             H
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                1
                                                
                                                   c
                                                   H
                                                
                                             
                                             
                                                ϕ
                                                0
                                             
                                             
                                                
                                                   (
                                                   −
                                                   
                                                      
                                                         D
                                                      
                                                      0
                                                   
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where cH
                         is a normalization constant. From these vectors the initial phase distribution vector for the high priority workload process denoted by κH
                         is given by

                           
                              (73)
                              
                                 
                                    
                                       
                                          
                                             
                                                κ
                                                H
                                             
                                             =
                                             
                                                q
                                                L
                                                H
                                             
                                             
                                                [
                                                
                                                   
                                                      D
                                                   
                                                   H
                                                
                                                
                                                ⊗
                                                
                                                
                                                   I
                                                
                                                
                                                ⊗
                                                
                                                
                                                   σ
                                                   H
                                                
                                                
                                                
                                                
                                                
                                                   0
                                                
                                                ]
                                             
                                             +
                                             
                                                q
                                                0
                                                H
                                             
                                             
                                                [
                                                
                                                   0
                                                
                                                
                                                
                                                
                                                
                                                   
                                                      D
                                                   
                                                   H
                                                
                                                
                                                ⊗
                                                
                                                
                                                   σ
                                                   H
                                                
                                                ]
                                             
                                             =
                                             
                                                q
                                                L
                                                H
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   0
                                                   +
                                                
                                                H
                                             
                                             +
                                             
                                                q
                                                0
                                                H
                                             
                                             
                                                
                                                   Q
                                                
                                                
                                                   −
                                                   +
                                                
                                                H
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Finally, the next two theorems provide the performance measures for the high priority jobs.

                           Theorem 11
                           
                              The probability density function of the sojourn time of high priority jobs
                              
                                 
                                    
                                       f
                                       
                                          T
                                          H
                                       
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                 
                               
                              is matrix-exponential
                              
                                 
                                    (74)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      
                                                         T
                                                         H
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   ζ
                                                   
                                                      e
                                                      
                                                         
                                                            Z
                                                         
                                                         t
                                                      
                                                   
                                                   v
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              with parameters
                              
                                 
                                    (75)
                                    
                                       
                                          ζ
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            κ
                                                            H
                                                         
                                                         
                                                         0
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          /
                                          c
                                          ,
                                          
                                          
                                             Z
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            K
                                                         
                                                         H
                                                      
                                                   
                                                   
                                                      
                                                         [
                                                         
                                                            
                                                               
                                                                  
                                                                     1
                                                                     ⊗
                                                                     
                                                                        I
                                                                     
                                                                     ⊗
                                                                     
                                                                        s
                                                                        H
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     0
                                                                  
                                                               
                                                            
                                                         
                                                         ]
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            S
                                                            L
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                          
                                          v
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      
                                                         1
                                                         ⊗
                                                         
                                                            s
                                                            H
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         s
                                                         L
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                              where
                              
                                 
                                    
                                       
                                          K
                                       
                                       H
                                    
                                    =
                                    
                                       
                                          Q
                                       
                                       
                                          +
                                          +
                                       
                                       H
                                    
                                    +
                                    
                                       
                                          Q
                                       
                                       
                                          +
                                          0
                                       
                                       H
                                    
                                    
                                       
                                          (
                                          −
                                          
                                             
                                                Q
                                             
                                             00
                                             H
                                          
                                          )
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          0
                                          +
                                       
                                       H
                                    
                                    +
                                    
                                       
                                          Ψ
                                       
                                       H
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          −
                                          +
                                       
                                       H
                                    
                                 
                               
                              and c is the normalization constant.
                           

The density of the workload at high priority arrival including the service time requirement the job brought to the system is 
                                 
                                    
                                       κ
                                       H
                                    
                                    
                                       e
                                       
                                          
                                             
                                                K
                                             
                                             H
                                          
                                          x
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          +
                                          0
                                       
                                       H
                                    
                                 
                               if the server works on a low priority job and it is 
                                 
                                    
                                       κ
                                       H
                                    
                                    
                                       e
                                       
                                          
                                             
                                                K
                                             
                                             H
                                          
                                          x
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          +
                                          −
                                       
                                       H
                                    
                                 
                               otherwise (see the points marked by circles in Fig. 5). In the latter case the sojourn time of the entering job is x. In the former case, however, the remaining service time of the low priority job has to be taken into account as well. The phase of the low priority service is also encoded in the background process, hence we have

                                 
                                    (76)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      
                                                         T
                                                         H
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         κ
                                                         H
                                                      
                                                      
                                                         ∫
                                                         
                                                            x
                                                            =
                                                            0
                                                         
                                                         ∞
                                                      
                                                      
                                                         e
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               H
                                                            
                                                            x
                                                         
                                                      
                                                      
                                                         
                                                            Q
                                                         
                                                         
                                                            +
                                                            0
                                                         
                                                         H
                                                      
                                                      
                                                         (
                                                         1
                                                         ⊗
                                                         
                                                            I
                                                         
                                                         )
                                                      
                                                      
                                                         e
                                                         
                                                            
                                                               
                                                                  S
                                                               
                                                               L
                                                            
                                                            
                                                               (
                                                               t
                                                               −
                                                               x
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         s
                                                         L
                                                      
                                                      
                                                      d
                                                      t
                                                      +
                                                      
                                                         κ
                                                         H
                                                      
                                                      
                                                         e
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               H
                                                            
                                                            x
                                                         
                                                      
                                                      
                                                         
                                                            Q
                                                         
                                                         
                                                            +
                                                            −
                                                         
                                                         H
                                                      
                                                      1
                                                      )
                                                   
                                                   /
                                                   c
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              The convolution of the two matrix exponentials with parameters K
                              
                                 H
                               and S
                              L can be represented by a single matrix exponential with parameter Z according to Loan (1978). The second term can be expressed using ζe
                              
                                 Z
                                 t
                               as well, by adding transitions from the first matrix block to the absorbing state with rates 
                                 
                                    
                                       
                                          Q
                                       
                                       
                                          +
                                          −
                                       
                                       H
                                    
                                    1
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                0
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                   ⊗
                                                   
                                                      s
                                                      H
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                 
                              . Putting together the two terms provides the theorem.□


                              The LST of the distribution function and the moments of TH are given by
                              
                                 
                                    (77)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      
                                                         T
                                                         H
                                                      
                                                      *
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   ζ
                                                   
                                                      
                                                         (
                                                         s
                                                         
                                                            I
                                                         
                                                         −
                                                         
                                                            Z
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   v
                                                   ,
                                                   
                                                   E
                                                   
                                                      (
                                                      
                                                         T
                                                         H
                                                         k
                                                      
                                                      )
                                                   
                                                   =
                                                   k
                                                   !
                                                   ζ
                                                   
                                                      
                                                         (
                                                         −
                                                         
                                                            Z
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   v
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

For the analysis of the number of high priority jobs in the system we introduce a quasi birth–death process (QBD, Latouche and Ramaswami, 1999), where the matrices corresponding to level backward, local and level forward transitions (denoted by 
                           
                              
                                 
                                    A
                                    −
                                 
                              
                              ,
                           
                         
                        A0
                         and 
                           
                              
                                 
                                    A
                                    +
                                 
                              
                              ,
                           
                         respectively) are

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                A
                                                0
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  0
                                                               
                                                               +
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  L
                                                               
                                                               )
                                                            
                                                            ⊕
                                                            
                                                               
                                                                  S
                                                                  L
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               L
                                                            
                                                            
                                                               σ
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  0
                                                               
                                                               +
                                                               
                                                                  
                                                                     D
                                                                  
                                                                  L
                                                               
                                                               )
                                                            
                                                            ⊕
                                                            
                                                               
                                                                  S
                                                                  H
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                A
                                                −
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                [
                                                
                                                   
                                                      
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               s
                                                               H
                                                            
                                                            
                                                               σ
                                                               H
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                             
                                                
                                                   A
                                                   +
                                                
                                             
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  D
                                                               
                                                               H
                                                            
                                                            ⊗
                                                            
                                                               I
                                                            
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  D
                                                               
                                                               H
                                                            
                                                            ⊗
                                                            
                                                               I
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        In the first group of states the server is working on a low, in the second one it is working on a high priority job. It is possible to move from the first state group to second one (see matrix A0
                        ), but not the way around at levels > 0.

The entries of vector 
                           
                              
                                 y
                                 ̲
                              
                              i
                              H
                           
                         are the probabilities that there are i high priority jobs in the system and the background process is in different phases. It is well known that QBDs have a matrix geometric distribution.

                           Theorem 12
                           
                              Vectors
                              
                                 
                                    
                                       y
                                       ̲
                                    
                                    i
                                    H
                                 
                               
                              have the following matrix geometric form:
                              
                                 
                                    (78)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      y
                                                      ̲
                                                   
                                                   i
                                                   H
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      
                                                         y
                                                         ̲
                                                      
                                                      0
                                                      H
                                                   
                                                   
                                                      
                                                         R
                                                      
                                                      i
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where matrix 
                              R 
                              is the minimal non-negative solution to the matrix-quadratic equation
                              
                                 
                                    (79)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         A
                                                         +
                                                      
                                                   
                                                   +
                                                   
                                                      R
                                                   
                                                   
                                                      
                                                         A
                                                         0
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         R
                                                      
                                                      2
                                                   
                                                   
                                                      
                                                         A
                                                         −
                                                      
                                                   
                                                   =
                                                   
                                                      0
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              and the probability of level 0 is
                              
                                 
                                    
                                       y
                                       0
                                       H
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      q
                                                      L
                                                      H
                                                   
                                                   
                                                   
                                                      q
                                                      0
                                                      H
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    /
                                    
                                       c
                                       ′
                                    
                                 
                              . The normalization constant is
                              
                                 
                                    
                                       c
                                       ′
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      q
                                                      L
                                                      H
                                                   
                                                   
                                                   
                                                      q
                                                      0
                                                      H
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       
                                          (
                                          
                                             I
                                          
                                          −
                                          
                                             R
                                          
                                          )
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    1
                                 
                              .

By definition in Eq. (72), vectors 
                                 
                                    q
                                    L
                                    H
                                 
                               and 
                                 
                                    q
                                    0
                                    H
                                 
                               are the stationary phase probability vectors given that there are no high priority jobs in the system. The matrix-geometric stationary distribution is a standard property of QBDs (see Latouche & Ramaswami, 1999).□


                              The generating function of the number of high priority jobs
                              
                                 
                                    
                                       Y
                                       H
                                    
                                    
                                       (
                                       z
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          i
                                          =
                                          0
                                       
                                       ∞
                                    
                                    
                                       z
                                       i
                                    
                                    
                                       
                                          y
                                          ̲
                                       
                                       i
                                       H
                                    
                                    1
                                 
                               
                              and the factorial moments
                              
                                 
                                    E
                                    (
                                    
                                       Y
                                       H
                                       k
                                    
                                    )
                                 
                               
                              are given by
                              
                                 
                                    (80)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Y
                                                      H
                                                   
                                                   
                                                      (
                                                      z
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      y
                                                      0
                                                      H
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            I
                                                         
                                                         −
                                                         z
                                                         
                                                            R
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   1
                                                   ,
                                                   
                                                   E
                                                   
                                                      (
                                                      
                                                         Y
                                                         H
                                                         k
                                                      
                                                      )
                                                   
                                                   =
                                                   k
                                                   !
                                                   
                                                      y
                                                      0
                                                      H
                                                   
                                                   
                                                      
                                                         R
                                                      
                                                      k
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            I
                                                         
                                                         −
                                                         
                                                            R
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   1
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The presented approach can be generalized to arbitrary many job classes as well. The details are given in Appendix B.

We implemented the presented analysis methods in MATLAB.
                        2
                     
                     
                        2
                        Our implementation can be downloaded from http://www.hit.bme.hu/~ghorvath/software.
                      The implementation computes all performance measures considered in the paper by both preemptive resume and non-preemptive service, and for any number of job classes.

In our implementation the NARE problems are solved by the ADDA procedure (Wang, Wang, & Li, 2012). We note that one of the two linear terms in the NAREs in this paper are block diagonal, which can be exploited by a novel technique to improve the computation speed further (Meini, 2013), but we did not use this possibility. The Sylvester equations are solved by the lyap function of MATLAB, which is based on the Hessenberg–Schur algorithm (Golub, Nash, & Loan, 1979).

In this section we compare our procedure with three prior methods: the method of Alfa et al. (2003) (transformed to continuous time), its improved version published in Horváth et al. (2009), and the procedure of Horváth (2012). Note that the latter two procedures are far less general than Alfa et al. (2003) or the proposed one. They can handle only preemptive resume service, they do not analyze the sojourn time at all, and Horváth (2012) is only able to provide the moments of the number of jobs.

Since all involved procedures are exact, only the scalability is investigated, that is, the analysis time as the function of the number of phases.

For this purpose let us define the MMAP matrices as

                        
                           
                              
                                 
                                    
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                0
                                             
                                             
                                                (
                                                K
                                                )
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      •
                                                   
                                                   
                                                      
                                                         K
                                                         ν
                                                      
                                                   
                                                
                                                
                                                   
                                                      γ
                                                   
                                                   
                                                      •
                                                   
                                                   
                                                      
                                                         (
                                                         K
                                                         −
                                                         1
                                                         )
                                                         ν
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      ⋱
                                                   
                                                   
                                                      ⋱
                                                   
                                                   
                                                      ⋱
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      
                                                         (
                                                         K
                                                         −
                                                         1
                                                         )
                                                         γ
                                                      
                                                   
                                                   
                                                      •
                                                   
                                                   
                                                      ν
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                   
                                                      
                                                         K
                                                         γ
                                                      
                                                   
                                                   
                                                      •
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                L
                                             
                                             
                                                (
                                                K
                                                )
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                   
                                                      
                                                         
                                                            r
                                                            L
                                                         
                                                         /
                                                         K
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      
                                                         2
                                                         
                                                            r
                                                            L
                                                         
                                                         /
                                                         K
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                   
                                                      ⋱
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                   
                                                   
                                                      
                                                         r
                                                         L
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     and matrix 
                        
                           
                              D
                           
                           
                              H
                           
                           
                              (
                              K
                              )
                           
                        
                      is defined similarly. The diagonal entries denoted by • are determined uniquely such that the row sums of 
                        
                           
                              
                                 D
                              
                              
                                 0
                              
                              
                                 (
                                 K
                                 )
                              
                           
                           +
                           
                              
                                 D
                              
                              
                                 L
                              
                              
                                 (
                                 K
                                 )
                              
                           
                           +
                           
                              
                                 D
                              
                              
                                 H
                              
                              
                                 (
                                 K
                                 )
                              
                           
                        
                      are zeroes.

The service times are characterized by order-2 PH distributions with parameters

                        
                           
                              
                                 
                                    
                                       
                                          σ
                                          H
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         0.16667
                                                      
                                                   
                                                   
                                                      
                                                         0.83333
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                    
                                       
                                    
                                    
                                       
                                          σ
                                          L
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         0.58824
                                                      
                                                   
                                                   
                                                      
                                                         0.41176
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             S
                                             H
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         −
                                                         0.66667
                                                      
                                                   
                                                   
                                                      
                                                         0.66667
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      
                                                         −
                                                         4
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                    
                                       
                                    
                                    
                                       
                                          
                                             S
                                          
                                          L
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         −
                                                         3.2941
                                                      
                                                   
                                                   
                                                      
                                                         3.2941
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      
                                                         −
                                                         5.6
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     having service rates 
                        
                           
                              μ
                              L
                           
                           =
                           2.8
                        
                      and 
                        
                           
                              μ
                              H
                           
                           =
                           2
                        
                     . The utilization depends on K, it varies between 0.6 and 0.75.


                     Fig. 6
                      depicts the analysis time required to obtain the first 10 moments of the number of low priority jobs in the system in the preemptive case as the function of K. (This is the only performance measure that is supported by all the procedures.) It is clearly visible that the presented method is at least an order of magnitude faster than the prior ones, and is able to solve systems with a large number of phases. No numerical problems were encountered even with the largest model. Additionally, as opposed to Horváth et al. (2009) and Horváth (2012), the presented procedure can provide sojourn time related performance measures, and is able to handle the case of non-preemptive service as well.

Another simple numerical example can be found in the online supplementary material.

@&#CONCLUSION@&#

This paper presents a unique approach for the analysis of priority queues with MMAP input and PH distributed service times in the sense that the performance measures are derived from various properties of the busy period process of fluid queues. Several recent research results are utilized, including the workload-based queue analysis approach, the solution of fluid processes with jumps and the matrix-analytic methods for Markovian fluid models. The result is an easy to implement procedure, which, according to our numerical experiments is numerically reliable and at least an order of magnitude faster that past procedures.

This section gives the outline of the analysis when the number of classes is greater than 2. Instead of H and L, the classes are denoted by integer numbers 
                        
                           1
                           ⋯
                           K
                        
                      such that a greater number corresponds to higher priority. The analysis is provided for class k, 1 ≤ k < K.

To characterize the amount of work in the system found by a class k job upon its arrival, classes < k can be neglected. For classes ≥ k the workload process is similar to the one in Fig. 1, but we have to distinguish various types of upward jumps corresponding to various job classes, thus, when a job arrives, it initiates the phase type distribution representing the service time of its class. Hence, the blocks of the generator of the fluid model representing the workload process are (see also Eq. (18))

                        
                           (A.1)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                +
                                                +
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               S
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                   
                                                   
                                                
                                                
                                                   
                                                   
                                                      ⋱
                                                   
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               S
                                                               K
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                          
                                          
                                             
                                                Q
                                             
                                             
                                                +
                                                −
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            K
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (A.2)
                           
                              
                                 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             −
                                             +
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               k
                                                            
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            k
                                                         
                                                         
                                                         ⋯
                                                         
                                                         
                                                            
                                                               D
                                                               K
                                                            
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            K
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                          
                                          
                                             
                                                Q
                                             
                                             
                                                −
                                                −
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             ∑
                                             
                                                i
                                                =
                                                0
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                D
                                             
                                             i
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

From the matrix-exponentially distributed stationary solution of the fluid model π
                     (k)(x), the density of the workload at class k arrivals, is expressed by

                        
                           (A.3)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                π
                                                ^
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          
                                             (
                                             x
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             1
                                             
                                                
                                                   c
                                                   ^
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                          
                                             π
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          
                                             (
                                             x
                                             )
                                          
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      1
                                                      
                                                         
                                                            c
                                                            ^
                                                         
                                                         
                                                            (
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      p
                                                      −
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         −
                                                         +
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                
                                                ︸
                                             
                                             
                                                
                                                   β
                                                   ^
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                          
                                             e
                                             
                                                
                                                   
                                                      K
                                                   
                                                   
                                                      (
                                                      k
                                                      )
                                                   
                                                
                                                x
                                             
                                          
                                          
                                             
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  I
                                                               
                                                               ⊗
                                                               
                                                                  s
                                                                  k
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            ⋮
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                   ]
                                                
                                                ︸
                                             
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      ^
                                                   
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where the normalization constant is 
                        
                           
                              
                                 c
                                 ^
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           =
                           
                              p
                              −
                              
                                 (
                                 k
                                 )
                              
                           
                           
                              
                                 Q
                              
                              
                                 −
                                 +
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           
                              
                                 (
                                 −
                                 
                                    
                                       K
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                 
                                 )
                              
                              
                                 −
                                 1
                              
                           
                           
                              
                                 
                                    B
                                 
                                 ^
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           1
                        
                     .

The 
                        
                           (
                           
                              
                                 β
                                 ^
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           ,
                           
                              
                                 K
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           ,
                           
                              
                                 
                                    
                                       B
                                    
                                    ^
                                 
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           )
                        
                      representation is transformed to 
                        
                           (
                           
                              
                                 
                                    β
                                    ′
                                 
                                 ^
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           ,
                           
                              
                                 
                                    K
                                    ′
                                 
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           ,
                           
                              
                                 
                                    
                                       
                                          
                                             B
                                          
                                       
                                       ′
                                    
                                    ^
                                 
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           )
                        
                      to ensure the proper row-sums by using Theorem 5.

The blocks of the generator of the fluid model corresponding to the remaining sojourn time process are similar to the ones of the two-class case (see Eq. (25)), the difference is that now there are more than one classes that have priority over class k. Hence we get

                        
                           (A.4)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             ˜
                                          
                                          
                                             +
                                             +
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               K
                                                               ′
                                                            
                                                         
                                                         
                                                            (
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                
                                                
                                                   
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               S
                                                               
                                                                  k
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      ⋱
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               S
                                                               K
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                          
                                          
                                             
                                                
                                                   Q
                                                
                                                ˜
                                             
                                             
                                                +
                                                −
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     B
                                                                  
                                                                  ′
                                                               
                                                               ^
                                                            
                                                         
                                                         
                                                            (
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            K
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             ˜
                                          
                                          
                                             −
                                             +
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               
                                                                  k
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      ⋯
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               K
                                                            
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            K
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                          
                                          
                                             
                                                
                                                   Q
                                                
                                                ˜
                                             
                                             
                                                −
                                                −
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             ∑
                                             
                                                i
                                                =
                                                0
                                             
                                             k
                                          
                                          
                                             
                                                D
                                             
                                             i
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     and the initial phase distribution is

                        
                           (A.5)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                κ
                                                ˜
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               β
                                                               ′
                                                            
                                                            ^
                                                         
                                                         
                                                            (
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      ⋯
                                                   
                                                   
                                                      0
                                                   
                                                
                                             
                                             ]
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

The performance measures related to the sojourn time can be derived from this fluid queue exactly as in the two-class case.

For the number of jobs the results of Section 4.3 can be applied with slight modifications. Instead of D
                     L we have to use Dk
                     . Furthermore, in Theorem 6 and Corollaries 3 and 4 matrix D
                     0 needs to be replaced by 
                        
                           
                              ∑
                              
                                 i
                                 =
                                 0
                              
                              
                                 k
                                 −
                                 1
                              
                           
                           
                              
                                 D
                              
                              i
                           
                           ,
                        
                      while in Theorem 7 and Corollary 5 matrix 
                        
                           
                              
                                 D
                              
                              0
                           
                           +
                           
                              
                                 D
                              
                              H
                           
                        
                      needs to be replaced by 
                        
                           
                              ∑
                              
                                 i
                                 =
                                 0
                                 ,
                                 i
                                 ≠
                                 k
                              
                              K
                           
                           
                              
                                 D
                              
                              i
                           
                        
                     .

This section provides the analysis for class k, 1 < k < K.

To characterize the amount of work in the system when a class k job arrives, we need to analyze the workload process restricted to the time periods when class ≥ k jobs are present in the system. This workload process is similar to the one discussed in Section 5.4, and depicted in Fig. 5.

The blocks of the generator of the fluid model representing the workload process are as follows.
                        
                           
                              
                                 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             +
                                             +
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               I
                                                            
                                                            1
                                                         
                                                         ⊗
                                                         
                                                            
                                                               S
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                   
                                                   
                                                   
                                                   
                                                
                                                
                                                   
                                                   
                                                      ⋱
                                                   
                                                   
                                                   
                                                   
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               I
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                         ⊗
                                                         
                                                            
                                                               S
                                                               K
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                   
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               S
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                   
                                                   
                                                      ⋱
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               S
                                                               K
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             +
                                             −
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            K
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                          
                                          
                                             
                                                Q
                                             
                                             
                                                +
                                                0
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               I
                                                            
                                                            1
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            
                                                               I
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            K
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             0
                                             +
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               k
                                                            
                                                         
                                                         ⊗
                                                         
                                                            
                                                               I
                                                            
                                                            1
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            k
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               K
                                                            
                                                         
                                                         ⊗
                                                         
                                                            
                                                               I
                                                            
                                                            1
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            K
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋱
                                                   
                                                   
                                                   
                                                      ⋱
                                                   
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                      
                                                         
                                                         
                                                         
                                                         
                                                         
                                                            
                                                               D
                                                               k
                                                            
                                                         
                                                         ⊗
                                                         
                                                            
                                                               I
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            k
                                                         
                                                      
                                                   
                                                   
                                                   
                                                      
                                                         
                                                         
                                                         
                                                         
                                                         
                                                            
                                                               D
                                                               K
                                                            
                                                         
                                                         ⊗
                                                         
                                                            
                                                               I
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            K
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             Q
                                          
                                          00
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               i
                                                               =
                                                               0
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               D
                                                            
                                                            i
                                                         
                                                         ⊕
                                                         
                                                            
                                                               S
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                      ⋱
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               i
                                                               =
                                                               0
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               D
                                                            
                                                            i
                                                         
                                                         ⊕
                                                         
                                                            
                                                               S
                                                               
                                                                  k
                                                                  −
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                          
                                          
                                             
                                                Q
                                             
                                             
                                                0
                                                −
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            1
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ⋮
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         ⊗
                                                         
                                                            s
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             −
                                             +
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               k
                                                            
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            k
                                                         
                                                      
                                                   
                                                   
                                                      ⋯
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               D
                                                               K
                                                            
                                                         
                                                         ⊗
                                                         
                                                            σ
                                                            K
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ,
                                          
                                          
                                             
                                                Q
                                             
                                             
                                                −
                                                −
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             ∑
                                             
                                                i
                                                =
                                                0
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                D
                                             
                                             i
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where matrix I
                     
                        j
                      is an identity matrix of the same size as S
                     
                        j
                     .

The states of the background process can be grouped to four state groups. In the zero states 
                        
                           S
                           0
                        
                      there are class ≥ k jobs in the system, but the server is working on a class < k one. The class of the current job in the server and its phase are encoded into 
                        
                           S
                           0
                        
                     . When a class ≥ k job arrives, the background process moves to 
                        
                           
                              S
                              +
                           
                           ,
                        
                      where the workload is increased by the service time of the job. Two state groups can be distinguished in 
                        
                           S
                           +
                        
                     . In the first state group there is a low priority job in the server, thus the background process needs to keep track of (1) the phase of the arrival process, (2) the class of the job in the server, (3) the phase of the service time of the job in the server, (4) the class of the job that arrived, and (5) the phase of the service time of the job that arrived. While the workload is increasing, the arrival process and the service of the job in the server are frozen. The second state group of 
                        
                           S
                           +
                        
                      takes care of the increase of the workload when there is no lower priority job in the server. Finally, 
                        
                           S
                           −
                        
                      represents the periods when class ≥ k jobs are served and the workload decreases by a slope of one accordingly.

The fundamental matrices corresponding to this fluid model are denoted by 
                        Ψ
                     
                     (k) and K
                     (k).

To characterize the steady state behavior of the workload process at arrivals, it remains to derive the initial phase of the background process when a class ≥ k job arrives when only class < k jobs are present in the system. To derive the initial phase probability vector we investigate the system at those departure instants where the departing job leaves no class ≥ k job in the system. Similar to vectors ϕ and ϕ
                     0 (defined in Section 5.4), we introduce probability vectors 
                        
                           ϕ
                           i
                           
                              (
                              k
                              )
                           
                        
                     . Entry j of 
                        
                           ϕ
                           i
                           
                              (
                              k
                              )
                           
                        
                      is the probability that there are no jobs with priority higher than i in the system at these instants and the phase of the MMAP is j. Thus,

                        
                           (B.1)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                {
                                                
                                                   ϕ
                                                   i
                                                   
                                                      (
                                                      k
                                                      )
                                                   
                                                
                                                }
                                             
                                             j
                                          
                                          
                                          
                                       
                                    
                                    
                                       
                                          
                                          =
                                          
                                       
                                    
                                    
                                       
                                          
                                          
                                          P
                                          (
                                          phase
                                          
                                          at
                                          
                                          departure
                                          
                                          is
                                          
                                          j
                                          
                                          and
                                          
                                          only
                                          
                                          
                                             
                                             ≤
                                             
                                             i
                                          
                                          
                                          classes
                                          
                                          are
                                          
                                          present
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                          |
                                          
                                          no
                                          
                                          class
                                          
                                          
                                             >
                                             k
                                          
                                          
                                          jobs
                                          
                                          in
                                          
                                          the
                                          
                                          system
                                          
                                          at
                                          
                                          departure
                                          )
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

Vector 
                        
                           ϕ
                           k
                           
                              (
                              k
                              )
                           
                        
                      can be obtained as a solution of a set of linear equations. Based on Theorem 3 of Takine (1999) and Eq. (69) we have linear equations

                        
                           (B.2)
                           
                              
                                 
                                    
                                       
                                          ϕ
                                          k
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             k
                                          
                                          
                                             (
                                             
                                                ϕ
                                                i
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                             −
                                             
                                                ϕ
                                                
                                                   i
                                                   −
                                                   1
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                             +
                                             
                                                ϕ
                                                0
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                             
                                                
                                                   (
                                                   −
                                                   
                                                      
                                                         D
                                                      
                                                      0
                                                   
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   D
                                                
                                                i
                                             
                                             )
                                          
                                          
                                             (
                                             
                                                I
                                             
                                             ⊗
                                             
                                                σ
                                                i
                                             
                                             )
                                          
                                          
                                             
                                                (
                                                −
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      0
                                                   
                                                   k
                                                
                                                
                                                   
                                                      D
                                                   
                                                   j
                                                
                                                ⊕
                                                
                                                   
                                                      S
                                                      i
                                                   
                                                
                                                )
                                             
                                             
                                                −
                                                1
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          ·
                                          
                                          
                                             (
                                             
                                                (
                                                
                                                   I
                                                
                                                ⊗
                                                
                                                   s
                                                   i
                                                
                                                )
                                             
                                             +
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   k
                                                   +
                                                   1
                                                
                                                K
                                             
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                            ⋯
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           D
                                                                        
                                                                        j
                                                                     
                                                                     ⊗
                                                                     
                                                                        I
                                                                     
                                                                     ⊗
                                                                     σ
                                                                  
                                                                  
                                                                     j
                                                                     th
                                                                  
                                                               
                                                               j
                                                            
                                                            
                                                               ⋯
                                                               
                                                                  0
                                                               
                                                               
                                                               |
                                                               
                                                               
                                                                  0
                                                               
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             ·
                                             
                                                
                                                   Ψ
                                                
                                                
                                                   (
                                                   k
                                                   +
                                                   1
                                                   )
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          +
                                          
                                          
                                             ϕ
                                             0
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          
                                             
                                                (
                                                −
                                                
                                                   
                                                      D
                                                   
                                                   0
                                                
                                                )
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             ∑
                                             
                                                j
                                                =
                                                k
                                                +
                                                1
                                             
                                             K
                                          
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                            |
                                                            
                                                            
                                                               0
                                                            
                                                            ⋯
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        D
                                                                     
                                                                     j
                                                                  
                                                                  ⊗
                                                                  σ
                                                               
                                                               
                                                                  j
                                                                  th
                                                               
                                                            
                                                            j
                                                         
                                                         ⋯
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          ·
                                          
                                             
                                                Ψ
                                             
                                             
                                                (
                                                k
                                                +
                                                1
                                                )
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where term i in the sum corresponds to the case when the class of the next job to serve is i (i ≤ k). The service of this job is started. The next departure in the embedded process can occur when either the service of this job ends, or when a higher priority job arrives. In the latter case matrix 
                        
                           
                              Ψ
                           
                           
                              (
                              k
                              +
                              1
                              )
                           
                        
                      determines the phase transitions between the beginning and the end of the busy period of priority > k jobs. The last term is related to the case when the system is empty at departure, and the next arriving job is a high priority ( > k) one.

To get a fully determined system of linear equations for vectors 
                        
                           ϕ
                           k
                           
                              (
                              k
                              )
                           
                        
                      the following relations are also needed (see Lemma 2 and Eq. (17) of Takine, 1999):

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          k
                                       
                                    
                                    
                                       
                                          =
                                          P
                                          (
                                          no
                                          
                                          class
                                          
                                          
                                             >
                                             k
                                          
                                          
                                          jobs
                                          
                                          in
                                          
                                          the
                                          
                                          system
                                          
                                          at
                                          
                                          departure
                                          )
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          =
                                          
                                             1
                                             λ
                                          
                                          
                                             ∑
                                             
                                                j
                                                =
                                                1
                                             
                                             k
                                          
                                          
                                             λ
                                             j
                                          
                                          +
                                          
                                             1
                                             λ
                                          
                                          κ
                                          
                                             ∑
                                             
                                                j
                                                =
                                                k
                                                +
                                                1
                                             
                                             K
                                          
                                          
                                             
                                                D
                                             
                                             j
                                          
                                          1
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ϕ
                                             i
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          ·
                                          
                                             p
                                             k
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             ϕ
                                             i
                                             
                                                (
                                                i
                                                )
                                             
                                          
                                          ·
                                          
                                             p
                                             i
                                          
                                          ,
                                          
                                          k
                                          ,
                                          i
                                          =
                                          1
                                          ,
                                          ⋯
                                          ,
                                          K
                                          −
                                          1
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where κ is the initial vector of the matrix-exponentially distributed workload process of the whole system (including all priority classes).

Similar to the two-class case in Eq. (72), we introduce vectors 
                        
                           
                              q
                              i
                              
                                 (
                                 k
                                 )
                              
                           
                           ,
                           
                           i
                           =
                           1
                           ,
                           ⋯
                           ,
                           k
                           −
                           1
                        
                      representing the stationary distribution of the phase when there are no class ≥ k jobs in the system and the server is working on a class i job, and vector 
                        
                           q
                           0
                           
                              (
                              k
                              )
                           
                        
                      for the case when the system is idle. We have

                        
                           
                              
                                 
                                    
                                       
                                          q
                                          i
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          (
                                          
                                             ϕ
                                             i
                                             
                                                (
                                                k
                                                −
                                                1
                                                )
                                             
                                          
                                          −
                                          
                                             ϕ
                                             
                                                i
                                                −
                                                1
                                             
                                             
                                                (
                                                k
                                                −
                                                1
                                                )
                                             
                                          
                                          +
                                          
                                             ϕ
                                             0
                                             
                                                (
                                                k
                                                −
                                                1
                                                )
                                             
                                          
                                          
                                             
                                                (
                                                −
                                                
                                                   
                                                      D
                                                   
                                                   0
                                                
                                                )
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                D
                                             
                                             i
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          ×
                                          
                                             (
                                             
                                                I
                                             
                                             ⊗
                                             
                                                σ
                                                i
                                             
                                             )
                                          
                                          
                                             
                                                (
                                                −
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      0
                                                   
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   
                                                      D
                                                   
                                                   j
                                                
                                                ⊕
                                                
                                                   
                                                      S
                                                      i
                                                   
                                                
                                                )
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          q
                                          0
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ϕ
                                             0
                                             
                                                (
                                                k
                                                −
                                                1
                                                )
                                             
                                          
                                          
                                             
                                                (
                                                −
                                                
                                                   
                                                      D
                                                   
                                                   0
                                                
                                                )
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

Concatenating vectors 
                        
                           q
                           i
                           
                              (
                              k
                              )
                           
                        
                      to 
                        
                           
                              q
                              L
                              
                                 (
                                 k
                                 )
                              
                           
                           =
                           
                              {
                              
                                 q
                                 i
                                 
                                    (
                                    k
                                    )
                                 
                              
                              ,
                              i
                              =
                              1
                              ,
                              ⋯
                              ,
                              k
                              −
                              1
                              }
                           
                        
                      the initial vector of the workload process for class ≥ k jobs denoted by κ
                     (k) is given by (see also Eq. (73) for two priorities)

                        
                           (B.3)
                           
                              
                                 
                                    
                                       
                                          κ
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             q
                                             L
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          ·
                                          
                                             
                                                Q
                                             
                                             
                                                0
                                                +
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          +
                                          
                                             q
                                             0
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          ·
                                          
                                             
                                                Q
                                             
                                             
                                                −
                                                +
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

Now we express the stationary density of the initial workload of class ≥ k jobs, the amount of workload that a class k arrival finds in the system. Four cases are distinguished:

                        
                           •
                           At the class k arrival there are no class ≥ k jobs in the system, but the server is working on a class < k job. The initial workload for the arrival equals the remaining service time of the class < k job.

At the class k arrival there are class ≥ k jobs in the system, but the server is working on a class < k job. The initial workload equals to the workload of class ≥ k jobs residing in the queue plus the remaining service time of the class < k job.

At the class k arrival there are class ≥ k jobs in the system, and the server is working on a class ≥ k job. The initial workload equals to the workload of the class ≥ k jobs residing in the queue.

At the class k arrival there are no jobs in the system at all. The initial workload is zero.

Thus, the initial workload equals to either the workload of the class ≥ k jobs, or to the remaining service time, or to the sum of both. Similar to Eq. (75) in the two-class case, it is matrix-exponentially distributed in the general case as well,

                        
                           (B.4)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                π
                                                ˇ
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          
                                             (
                                             x
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             ζ
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          
                                             e
                                             
                                                
                                                   
                                                      Z
                                                   
                                                   
                                                      (
                                                      k
                                                      )
                                                   
                                                
                                                t
                                             
                                          
                                          
                                             
                                                V
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     with parameters

                        
                           (B.5)
                           
                              
                                 
                                    ζ
                                    
                                       (
                                       k
                                       )
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                κ
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                
                                                   q
                                                   L
                                                   
                                                      (
                                                      k
                                                      )
                                                   
                                                
                                                ·
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     D
                                                                     k
                                                                  
                                                               
                                                               ⊗
                                                               
                                                                  
                                                                     I
                                                                  
                                                                  1
                                                               
                                                            
                                                         
                                                         
                                                         
                                                      
                                                      
                                                         
                                                         
                                                            ⋱
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     D
                                                                     k
                                                                  
                                                               
                                                               ⊗
                                                               
                                                                  
                                                                     I
                                                                  
                                                                  
                                                                     k
                                                                     −
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ]
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 /
                                 
                                    
                                       c
                                       ˇ
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (B.6)
                           
                              
                                 
                                    
                                       Z
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   K
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         +
                                                         0
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         Ψ
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         −
                                                         0
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                   )
                                                
                                                ·
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     D
                                                                     k
                                                                  
                                                               
                                                               ⊗
                                                               
                                                                  
                                                                     I
                                                                  
                                                                  1
                                                               
                                                            
                                                         
                                                         
                                                         
                                                      
                                                      
                                                         
                                                         
                                                            ⋱
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     D
                                                                     k
                                                                  
                                                               
                                                               ⊗
                                                               
                                                                  
                                                                     I
                                                                  
                                                                  
                                                                     k
                                                                     −
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ]
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                0
                                             
                                          
                                          
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               
                                                                  S
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ⋱
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               I
                                                            
                                                            ⊗
                                                            
                                                               
                                                                  S
                                                                  
                                                                     k
                                                                     −
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (B.7)
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Ψ
                                                   
                                                   
                                                      (
                                                      k
                                                      )
                                                   
                                                
                                                
                                                   
                                                      D
                                                      k
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                1
                                                ⊗
                                                
                                                   s
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             
                                                1
                                                ⊗
                                                
                                                   s
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                              
                           
                        
                     and the probability that the initial workload at arrival is zero is given by

                        
                           (B.8)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                p
                                                ˇ
                                             
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          =
                                          
                                             1
                                             
                                                
                                                   c
                                                   ˇ
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                          
                                             q
                                             0
                                             
                                                (
                                                k
                                                )
                                             
                                          
                                          
                                             
                                                D
                                                k
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     The normalization constant is obtained as 
                        
                           
                              
                                 c
                                 ˇ
                              
                              
                                 (
                                 k
                                 )
                              
                           
                           =
                           1
                           /
                           
                              (
                              
                                 
                                    p
                                    ˇ
                                 
                                 
                                    (
                                    k
                                    )
                                 
                              
                              1
                              +
                              
                                 ζ
                                 
                                    (
                                    k
                                    )
                                 
                              
                              
                                 
                                    (
                                    −
                                    
                                       
                                          Z
                                       
                                       
                                          (
                                          k
                                          )
                                       
                                    
                                    )
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 
                                    V
                                 
                                 
                                    (
                                    k
                                    )
                                 
                              
                              1
                              )
                           
                        
                     . The first state group of this matrix-exponential distribution generates the workload of class ≥ k jobs residing in the queue at the arrival, while the second state group represents the remaining service time of the low priority job residing in the server.

The fluid model representing the remaining waiting time of class k jobs can be characterized by the same matrices as in the preemptive resume case given by Eq. (A.4). The only difference is that instead of K′
                     (k), 
                        
                           
                              
                                 
                                    B
                                 
                                 ^
                              
                           
                           
                              
                                 
                                 ′
                              
                              
                                 (
                                 k
                                 )
                              
                           
                        
                      and β′(k), the parameters of the initial workload are Z
                     (k), V
                     (k) and ζ
                     (k) in the non-preemptive case. Given the fluid model for the remaining waiting time, the performance measures are derived just like in the two-class case in Sections 5.2 and 5.3.

Supplementary material associated with this article can be found, in the online version, at 10.1016/j.ejor.2015.03.004.


                     
                        
                           
                        
                     
                  

@&#REFERENCES@&#

