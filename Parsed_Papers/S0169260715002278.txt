@&#MAIN-TITLE@&#Analysis of the method for ventilation heterogeneity assessment using the Otis model and forced oscillations

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We analyse the method for bimodal lung ventilation heterogeneity identification.


                        
                        
                           
                           Respiratory impedance measurement by forced oscillations in bimodal model was proposed.


                        
                        
                           
                           In case of the Otis model the index (H) was defined as the ratio of two time constants.


                        
                        
                           
                           Mean values of heterogeneity were computed, both for simulated and experimental data.


                        
                        
                           
                           The knowledge of bimodality may be helpful when using mechanical ventilation.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Ventilation heterogeneity

Otis model

Forced oscillations

Levenberg–Marquart algorithm

Monte Carlo simulations

Mechanical lung simulator

@&#ABSTRACT@&#


               
               
                  Increased heterogeneity of the lung disturbs pulmonary gas exchange. During bronchoconstriction, inflammation of lung parenchyma or acute respiratory distress syndrome, inhomogeneous lung ventilation can become bimodal and increase the risk of ventilator-induced lung injury during mechanical ventilation. A simple index sensitive to ventilation heterogeneity would be very useful in clinical practice. In the case of bimodal ventilation, the index (H) can be defined as the ratio between the longer and shorter time constant characterising regions of contrary mechanical properties. These time constants can be derived from the Otis model fitted to input impedance (Z
                     
                        in
                     ) measured using forced oscillations. In this paper we systematically investigated properties of the aforementioned approach. The research included both numerical simulations and real experiments with a dual-lung simulator. Firstly, a computational model mimicking the physical simulator was derived and then used as a forward model to generate synthetic flow and pressure signals. These data were used to calculate the input impedance and then the Otis inverse model was fitted to Z
                     
                        in
                      by means of the Levenberg–Marquardt (LM) algorithm. Finally, the obtained estimates of model parameters were used to compute H. The analysis of the above procedure was performed in the frame of Monte Carlo simulations. For each selected value of H, forward simulations with randomly chosen lung parameters were repeated 1000 times. Resulting signals were superimposed by additive Gaussian noise. The estimated values of H properly indicated the increasing level of simulated inhomogeneity, however with underestimation and variation increasing with H. The main factor responsible for the growing estimation bias was the fixed starting vector required by the LM algorithm. Introduction of a correction formula perfectly reduced this systematic error. The experimental results with the dual-lung simulator confirmed potential of the proposed procedure to properly deduce the lung heterogeneity level. We conclude that the heterogeneity index H can be used to assess bimodal ventilation imbalances in cases when this phenomenon dominates lung properties, however future analyses, including the impact of lung tissue viscoelasticity and distributed airway or tissue inhomogeneity on H estimates, as well as studies in the time domain, are advisable.
               
            

@&#INTRODUCTION@&#

Distribution of ventilation in respiratory system is not homogeneous. In a physiological lung it can be caused by many reasons like the airway tree asymmetry, gravitational effects or individual differences in regional mechanical properties [1]. Under pathological conditions this heterogeneity drastically intensifies, particularly in asthma [2]. The imbalances in lung ventilation affect gas exchange efficiency [3] and increase the risk of ventilator-induced lung injury during artificial ventilation [4,5]. Additionally, bronchoconstriction may lead to self-organized patterns of patchy ventilation [6] which becomes generally bimodal [7–9].

There are many methods to visualise heterogeneity directly, using different imaging techniques [10–13], and deduced indirectly from multiple-breath nitrogen washout [14,15]. All above procedures are not commonly used in routine diagnostics. In contrast, the forced oscillation technique (FOT) is a non-invasive method. In FOT, multi-sinusoidal flow oscillations are generated at the airway opening, and the relationship between the flow and resulting pressure oscillations reflects respiratory mechanics in the frequency domain. It has been found that low-frequency lung impedance, measured by FOT, is extremely sensitive to inhomogeneous airway constriction [16,17].

One of the primary ways to understand real objects and to infer the intrinsic properties from raw measurements is mathematical modelling and computer simulations [18–20]. Many models of different scale and structure, both in the time and frequency domains, were proposed to describe lung mechanics (e.g. [21–23]) and to capture ventilation heterogeneity, e.g. [4,15–17,24–28]. Among them the Otis model [29] and its modifications has been of particular interest. It assumes a simplified lung structure consisting of two uneven compartments arranged in parallel (sometimes completed by central airway properties), with only a few lumped parameters, being easy for mathematical description in the time and frequency domains and thus for a further use. These properties explain why the Otis model has been extensively explored for the last decades, e.g. [24,30–36]. Simultaneously, some controversies over its plausibility and interpretation have cumulated. The most substantial ones concern: weak stability of parameter estimates [37], unidentifiability (i.e. impossibility of assigning unique values to unknown parameters [38]) of the Laplace representation of the model [39], similar effects of parallel ventilation heterogeneity and viscoelastic properties of lung tissue on lung impedance [33,40], and the equivalence of this model to a one-compartment structure when the time constants characterising the two compartments are equal [29,36].

Being aware of the prior use and above limitations of the Otis model, we have investigated its possible application in the assessment of bimodal ventilation heterogeneity using the forced oscillations. Such a patchy behaviour is characteristic for asthmatic bronchospasm and we hypothesise that the model with two parallel compartments may be sufficient to capture the difference between the well and poorly ventilated regions.

Simple indices, sensitive to pathological changes, are very useful in clinical practice and can allow for the use of the appropriate procedures for medical treatment as ventilatory support [23,41]. The knowledge of bimodality may be particularly helpful when using independent lung ventilation [42]. In the case of the Otis model, an index (H) can be defined as the ratio between the longer and shorter time constant. Early studies yielded surprisingly high values of H 
                     [32,35]. Since true mechanics of the complex respiratory system is never exactly known, in this work we systematically validate the method using both computer simulations and a physical dual-lung simulator with adjustable mechanical properties.

Successive sections of this paper present the implementation and validation of a computer model for the lung simulator, selection of the optimal excitation waveform, a method for input impedance calculation and a parameter estimation procedure, Monte Carlo simulations with the forward and inverse models showing main factors influencing the result, and the experimental validation of the method by measurements of H for various configurations of lung simulator mechanics. The achieved results demonstrate the strengths and weaknesses of this approach and motivate one to extend this research by taking into account viscoelastic properties of lung tissue, distributed heterogeneity, and analyses in the time domain.

@&#METHODS@&#

Bimodal ventilation of the lung can be easy simulated using the two-compartment mechanical simulator Dual Adult Model 5600i (Michigan Instruments, Inc., USA). Gas flows into the simulator through a central airway with replaceable, fixed-orifice flow resistor R
                        
                           C
                        , branching out into two peripheral airways with their resistors R
                        1 and R
                        2. They lead to separate elastomer bellows simulating two lungs with compliances C
                        1 and C
                        2. The compliances were independently adjusted using a steel springs, which were stretched during inflation. We were able to use the resistors of nominal values of 5 and 20cmH2O/(L/s) and to set compliances in the range between 0.01 and 0.1L/cmH2O.

Since the number of mechanical settings is limited, a computational forward model for the lung simulator, enabling a wide variety of ventilation simulations under fully controlled conditions necessary to evaluate the method, has been developed. Taking into account the structure of the simulator, inertia of bellows (L
                        1 and L
                        2) and gas leakage from this pneumatic system (represented by leakage resistance R
                        
                           U
                        ), an electric analogue of the simulator is shown in Fig. 1
                        .

The mathematical description of the model in the time domain can be derived in the state space, as follows:
                           
                              (1)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      d
                                                      
                                                         Q
                                                         1
                                                      
                                                   
                                                   
                                                      d
                                                      t
                                                   
                                                
                                                =
                                                −
                                                
                                                   
                                                      
                                                         R
                                                         U
                                                      
                                                      +
                                                      
                                                         R
                                                         C
                                                      
                                                      +
                                                      
                                                         R
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         L
                                                         1
                                                      
                                                   
                                                
                                                
                                                   Q
                                                   1
                                                
                                                −
                                                
                                                   
                                                      
                                                         R
                                                         U
                                                      
                                                      +
                                                      
                                                         R
                                                         C
                                                      
                                                   
                                                   
                                                      
                                                         L
                                                         1
                                                      
                                                   
                                                
                                                
                                                   Q
                                                   2
                                                
                                                −
                                                
                                                   1
                                                   
                                                      
                                                         L
                                                         1
                                                      
                                                   
                                                
                                                
                                                   P
                                                   
                                                      C
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         R
                                                         U
                                                      
                                                   
                                                   
                                                      
                                                         I
                                                         1
                                                      
                                                   
                                                
                                                Q
                                                ,
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      d
                                                      
                                                         Q
                                                         2
                                                      
                                                   
                                                   
                                                      d
                                                      t
                                                   
                                                
                                                =
                                                −
                                                
                                                   
                                                      
                                                         R
                                                         U
                                                      
                                                      +
                                                      
                                                         R
                                                         C
                                                      
                                                   
                                                   
                                                      
                                                         L
                                                         2
                                                      
                                                   
                                                
                                                
                                                   Q
                                                   1
                                                
                                                −
                                                
                                                   
                                                      
                                                         R
                                                         U
                                                      
                                                      +
                                                      
                                                         R
                                                         C
                                                      
                                                      +
                                                      
                                                         R
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         L
                                                         2
                                                      
                                                   
                                                
                                                
                                                   Q
                                                   2
                                                
                                                −
                                                
                                                   1
                                                   
                                                      
                                                         L
                                                         2
                                                      
                                                   
                                                
                                                
                                                   P
                                                   
                                                      C
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         R
                                                         U
                                                      
                                                   
                                                   
                                                      
                                                         L
                                                         2
                                                      
                                                   
                                                
                                                Q
                                                ,
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      d
                                                      
                                                         P
                                                         
                                                            C
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      d
                                                      t
                                                   
                                                
                                                =
                                                
                                                   1
                                                   
                                                      
                                                         C
                                                         1
                                                      
                                                   
                                                
                                                
                                                   Q
                                                   1
                                                
                                                ,
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      d
                                                      
                                                         P
                                                         
                                                            C
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      d
                                                      t
                                                   
                                                
                                                =
                                                
                                                   1
                                                   
                                                      
                                                         C
                                                         2
                                                      
                                                   
                                                
                                                
                                                   Q
                                                   2
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where Q
                        
                           i
                         are flows, P
                        
                           Ci
                         are pressures drops over the compliances, and indexes 1 and 2 denote the two compartments. The model is excited by input flow Q, and its output, pressure P measured at the inlet of the simulator, is given by:
                           
                              (2)
                              
                                 
                                    P
                                    =
                                    
                                       R
                                       U
                                    
                                    (
                                    Q
                                    −
                                    
                                       Q
                                       1
                                    
                                    −
                                    
                                       Q
                                       2
                                    
                                    )
                                 
                              
                           
                        
                     

The forward model was implemented in the Matlab/Simulink environment (The MathWorks, USA). To make it more realistic, the resistances and compliances were simulated in accordance with their static characteristics (Fig. 2
                        ), measured with the set-up described in Section 2.5.1 (i.e. generating constant flows through resistances and recording pressure drops across them, and inflating simulator bellows to assumed volume – the integral of flow – and measuring pressures inside them). The characteristics of resistances appeared slightly parabolic, as in Rohrer's equation [43], so quadratic functions were fitted to measured flow-pressure data (Fig. 2A):
                           
                              (3)
                              
                                 
                                    
                                       R
                                       i
                                    
                                    =
                                    
                                       k
                                       
                                          a
                                          i
                                       
                                    
                                    +
                                    
                                       k
                                       
                                          b
                                          i
                                       
                                    
                                    ⋅
                                    
                                       Q
                                    
                                    ,
                                 
                              
                           
                        where i stands for C, 1, or 2. Simulator elastances (reciprocals of compliances, E
                        =1/C) could be properly described by linear functions fitted to volume–pressure data (Fig. 2B).

The implemented forward model was experimentally validated comparing its predictions with pressures recorded at the simulator inlet (P) and inside the bellows (P
                        1 and P
                        2) (Fig. 3
                        ). Both the model and the simulator were excited by the same input flow imitating mechanical ventilation with a rectangular waveform. The compliances of the bellows were set for C
                        1
                        =0.017 and C
                        2
                        =0.075L/cmH2O and the inertances were assessed as L
                        1
                        =
                        L
                        2
                        =4×10−2
                        cmH2O/(L/s2). Observing the systematic pressure drop in bellows, R
                        
                           U
                         was experimentally determined as 1.2×104
                        cmH2O/(L/s).

The validated model was then used to generate synthetic measurement data for a wide range of mechanical properties of the two-compartment system, enabling a systematic evaluation of the method (Section 2.3).

Estimation of heterogeneity H using forced oscillations consists of a few stages. The first step involves the calculation of input impedance Z
                        
                           in
                         of the respiratory system from flow and pressure signals measured at the inlet, then the Otis inverse model is fitted to the real and imaginary parts of Z
                        
                           in
                         yielding estimates of its parameters, and finally H is calculated from the estimates of peripheral resistances and compliances.

Lung inhomogeneities are well visible only at low frequencies [32]. To ensure a good accuracy of calculated impedance in the presence of nonlinear distortions resulting from the properties of the system (as nonlinear resistances), a sophisticated oscillatory excitation has been proposed, called the optimal ventilatory waveform (OVW) [44]. It consists of 7 sinusoids with frequencies between 0.15 and 8.1Hz (specifically: 0.156250, 0.390625, 0.859375, 1.484375, 2.421875, 4.609375, and 8.046875Hz), none of which is a sum or difference of two others, so the higher harmonics produced by system nonlinearities and intermodulation do not distort the fundamental ones. Additionally, integer numbers of periods of each sinusoid fall within the analysed time of 12.8s, guaranteeing that the total air volume delivered to the lung (the integral of flow) is zero. We have used the OVW with equal amplitudes and phases optimised to minimise the peak-to-peak value of exciting flow Q. To avoid distortion in the pressure response caused by the transient state of the dynamic system, the flow signal is generated for 15s, and data from the last 12.8s are used to estimate Z
                           
                              in
                           . This relatively short time of excitation (only 2 periods of the slowest sinusoid included) and a relatively small peak amplitude (about 0.1L/s) arise from the intention of using this method in the first instance with conscious subjects holding breath or with paralysed ventilated patients.

First, the recorded flow and pressure signals are low-pass filtered (the cut-off frequency of 10Hz). Then the tight end data of 12.8s is selected for further processing. Knowing the frequency distribution in both signals, measured flow and pressure can be modelled as the Fourier series [45]:
                              
                                 (4)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Q
                                                      m
                                                   
                                                   (
                                                   t
                                                   )
                                                   =
                                                   
                                                      a
                                                      0
                                                   
                                                   +
                                                   
                                                      ∑
                                                      
                                                         k
                                                         =
                                                         1
                                                      
                                                      7
                                                   
                                                   
                                                      (
                                                      
                                                         a
                                                         k
                                                      
                                                      cos
                                                      (
                                                      2
                                                      π
                                                      
                                                         f
                                                         k
                                                      
                                                      t
                                                      )
                                                      +
                                                      
                                                         b
                                                         k
                                                      
                                                      sin
                                                      (
                                                      2
                                                      π
                                                      
                                                         f
                                                         k
                                                      
                                                      t
                                                      )
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      P
                                                      m
                                                   
                                                   (
                                                   t
                                                   )
                                                   =
                                                   
                                                      c
                                                      0
                                                   
                                                   +
                                                   
                                                      ∑
                                                      
                                                         k
                                                         =
                                                         1
                                                      
                                                      7
                                                   
                                                   
                                                      (
                                                      
                                                         c
                                                         k
                                                      
                                                      cos
                                                      (
                                                      2
                                                      π
                                                      
                                                         f
                                                         k
                                                      
                                                      t
                                                      )
                                                      +
                                                      
                                                         d
                                                         k
                                                      
                                                      sin
                                                      (
                                                      2
                                                      π
                                                      
                                                         f
                                                         k
                                                      
                                                      t
                                                      )
                                                      )
                                                      +
                                                      
                                                         k
                                                         1
                                                      
                                                      
                                                         ∫
                                                         0
                                                         t
                                                      
                                                      
                                                         V
                                                         (
                                                         τ
                                                         )
                                                         d
                                                         τ
                                                      
                                                      +
                                                      
                                                         k
                                                         2
                                                      
                                                      t
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where V is the volume of air pumped into the lungs. The two last terms in the pressure model have been added to compensate the observed pressure drop caused by gas leakage from the inflated bellows (see Appendix) – it had been checked before that the resulting slow trend in pressure signal disturbs the impedance estimates at lowest frequencies, and finally the calculated heterogeneity index. The above models are fitted to the measurement data by means of the least-squares method (LS), yielding the estimates of their parameters. The estimates â
                           1–â
                           7, 
                              
                                 
                                    
                                       b
                                       ˆ
                                    
                                    1
                                 
                                 –
                                 
                                    
                                       b
                                       ˆ
                                    
                                    7
                                 
                              
                           , ĉ
                           1–ĉ
                           7, and 
                              
                                 
                                    
                                       d
                                       ˆ
                                    
                                    1
                                 
                                 –
                                 
                                    
                                       d
                                       ˆ
                                    
                                    7
                                 
                              
                            are then used to assess the input impedance:
                              
                                 (5)
                                 
                                    
                                       
                                          
                                             Z
                                             ˆ
                                          
                                          
                                             i
                                             n
                                          
                                       
                                       (
                                       
                                          f
                                          k
                                       
                                       )
                                       =
                                       
                                          
                                             
                                                
                                                   c
                                                   ˆ
                                                
                                                k
                                             
                                             −
                                             j
                                             
                                                
                                                   d
                                                   ˆ
                                                
                                                k
                                             
                                          
                                          
                                             
                                                
                                                   a
                                                   ˆ
                                                
                                                k
                                             
                                             −
                                             j
                                             
                                                
                                                   b
                                                   ˆ
                                                
                                                k
                                             
                                          
                                       
                                       ,
                                    
                                 
                              
                           where 
                              
                                 j
                                 =
                                 
                                    
                                       −
                                       1
                                    
                                 
                              
                           .

The last step of the presented method consists in calculating the heterogeneity index, defined as the ratio of the time constants, from the estimates of inverse model parameters. It is desirable that the identified model has a reasonably small number of parameters, so the structure with aggregated inertances, now located in the central airway segment, has been chosen for identification (Fig. 4
                           ).

The input impedance of the two-compartment structure shown in Fig. 4 is as follows:
                              
                                 (6)
                                 
                                    
                                       
                                          Z
                                          m
                                       
                                       (
                                       ω
                                       )
                                       =
                                       
                                          R
                                          C
                                       
                                       +
                                       j
                                       ω
                                       
                                          L
                                          C
                                       
                                       +
                                       
                                          
                                             (
                                             
                                                R
                                                1
                                             
                                             −
                                             j
                                             
                                                E
                                                1
                                             
                                             /
                                             ω
                                             )
                                             (
                                             
                                                R
                                                2
                                             
                                             −
                                             j
                                             
                                                E
                                                2
                                             
                                             /
                                             ω
                                             )
                                          
                                          
                                             
                                                R
                                                1
                                             
                                             +
                                             
                                                R
                                                2
                                             
                                             −
                                             j
                                             (
                                             
                                                E
                                                1
                                             
                                             +
                                             
                                                E
                                                2
                                             
                                             )
                                             /
                                             ω
                                          
                                       
                                       ,
                                    
                                 
                              
                           where elastances E
                           1
                           =1/C
                           1, E
                           2
                           =1/C
                           2, and ω
                           =2πf. Fitting model (6) to the real and imaginary parts of Z
                           
                              in
                            calculated from OWV signals returns the estimates of the six model parameters. Unfortunately, when the time constants become equal (i.e. R
                           1
                           C
                           1
                           =
                           R
                           2
                           C
                           2), the model reduces to a one-compartment system and it turns out to be unidentifiable [36]. Even for slightly different time constants, the identification is still ill-conditioned. Additionally, the model is nonlinear-in-parameters. To avoid numerical problems in such circumstances, the Levenberg–Marquardt (LM) algorithm is used during the estimation of the parameter vector 
                              θ
                           . This approach reduces the variance of estimators (potentially huge) at the cost of their bias, iteratively updating the estimates vector [46]:
                              
                                 (7)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                             
                                             ˆ
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                             
                                             ˆ
                                          
                                          i
                                       
                                       +
                                       
                                          
                                             (
                                             
                                                
                                                   X
                                                
                                                i
                                                T
                                             
                                             
                                                
                                                   W
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   X
                                                
                                                i
                                             
                                             +
                                             
                                                λ
                                                i
                                             
                                             
                                                I
                                             
                                             )
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             X
                                          
                                          i
                                          T
                                       
                                       
                                          
                                             W
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             ε
                                          
                                          i
                                       
                                       ,
                                    
                                 
                              
                           where X
                           =∂Z
                           
                              m
                           /∂θ is the model sensitivity matrix, I is the identity matrix, 
                              
                                 
                                    
                                       ε
                                    
                                    i
                                 
                                 =
                                 
                                    
                                       
                                          Z
                                       
                                       ˆ
                                    
                                    
                                       i
                                       n
                                    
                                 
                                 −
                                 
                                    
                                       Z
                                    
                                    m
                                 
                                 (
                                 
                                    
                                       
                                          θ
                                       
                                       ˆ
                                    
                                    i
                                 
                                 )
                              
                            are residues, and λ is the regularisation parameter (stating from 10−6 and then divided or multiplied by 10 in a case of F
                           NLS decreasing or increasing, respectively). The weighting matrix W is additionally used to balance the model fitting both to the real and imaginary (with values closed to 0 for higher frequencies) parts of 
                              
                                 
                                    
                                       Z
                                       ˆ
                                    
                                    
                                       i
                                       n
                                    
                                 
                              
                           . Specifically, it consists of weights W
                           
                              R
                            and W
                           
                              I
                            calculated as mean squared real and imaginary parts of measured impedance, respectively, so finally this iterative procedure minimises (in a regularised way) the weighted nonlinear least-squares functional in the form:
                              
                                 (8)
                                 
                                    
                                       
                                          F
                                          
                                             NLS
                                          
                                       
                                       (
                                       
                                          θ
                                       
                                       )
                                       =
                                       
                                          1
                                          
                                             
                                                W
                                                R
                                             
                                          
                                       
                                       
                                          ∑
                                          
                                             k
                                             =
                                             1
                                          
                                          7
                                       
                                       
                                          
                                             
                                                (
                                                Re
                                                (
                                                
                                                   
                                                      Z
                                                      ˆ
                                                   
                                                   
                                                      in
                                                   
                                                
                                                (
                                                
                                                   f
                                                   k
                                                
                                                )
                                                )
                                                −
                                                Re
                                                (
                                                
                                                   Z
                                                   m
                                                
                                                (
                                                
                                                   θ
                                                
                                                ,
                                                
                                                   f
                                                   k
                                                
                                                )
                                                )
                                                )
                                             
                                             2
                                          
                                          +
                                          
                                             1
                                             
                                                
                                                   W
                                                   I
                                                
                                             
                                          
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             7
                                          
                                          
                                             
                                                
                                                   (
                                                   Im
                                                   (
                                                   
                                                      
                                                         Z
                                                         ˆ
                                                      
                                                      
                                                         in
                                                      
                                                   
                                                   (
                                                   
                                                      f
                                                      k
                                                   
                                                   )
                                                   )
                                                   −
                                                   Im
                                                   (
                                                   
                                                      Z
                                                      m
                                                   
                                                   (
                                                   
                                                      θ
                                                   
                                                   ,
                                                   
                                                      f
                                                      k
                                                   
                                                   )
                                                   )
                                                   )
                                                
                                                2
                                             
                                          
                                       
                                       ,
                                    
                                 
                              
                           where Re(·) and Im(·) denote the real and imaginary parts of complex impedance. The LM algorithm handles potential numerical problems with matrix inversion (e.g. equal time constants in the Otis model imply linear dependence of some columns in the sensitivity matrix X, and then a zero determinant of X
                           T
                           X) by using the regularisation term λ
                           I (see Eq. (7)). Sufficiently large λ, tuned iteratively, guarantees numerically stable inversion of the “regularised matrix” (X
                           T
                           X
                           +
                           λ
                           I).

Using LM, a priori knowledge about typical values of parameters can be included as the starting vector [47]. Additionally, constrains are imposed on estimates to preserve their plausibility (Table 1
                           ).

A separate problem in nonlinear estimation is the choice of the starting point. This is done in two stages, according to the hierarchical identification approach [48]. Firstly, a simple one-compartment linear model R
                           
                              rs
                           –L
                           
                              rs
                           –E
                           
                              rs
                            is fitted to the impedance data by LS, enabling the assessment of global respiratory parameters. Then the respiratory resistance R
                           
                              rs
                            is partitioned by a half into R
                           
                              C
                            and peripheral resistances in parallel. Also respiratory elastance E
                           
                              rs
                            is split into E
                           1 and E
                           2 
                           [24] so as the resultant time constants ratio H
                           start
                           =3. This preliminary starting vector θ
                           start is then used to initiate the procedure of random search [37] with an iteratively damped region of interest around θ
                           start (10,000 steps with a damping factor of 0.994). Finally, the optimised starting vector is used as the input for the LM algorithm.

To systematically assess the whole procedure of bimodal heterogeneity estimation from FOT signals, the Monte Carlo simulations were performed for chosen values of the heterogeneity index (1000 runs as a compromise between the accuracy of statistical analyses and the time of simulations). All the procedures were self-implemented using the Matlab software (The MathWorks, USA).

Assuming a given level of inhomogeneity H
                        
                           a
                        , firstly the values of five parameter of the forward model (k
                        
                           aC
                        , L
                        1
                        =
                        L
                        2, k
                        
                           a1, C
                        1 and C
                        2) were drawn from the uniform distribution on presumed variability ranges (Table 2
                        ), and then k
                        
                           a2 was set to fulfil the heterogeneity condition (neglecting the nonlinear components of resistances):
                           
                              (9)
                              
                                 
                                    
                                       H
                                       a
                                    
                                    =
                                    
                                       
                                          
                                             k
                                             
                                                a
                                                1
                                             
                                          
                                          
                                             C
                                             1
                                          
                                       
                                       
                                          
                                             k
                                             
                                                a
                                                2
                                             
                                          
                                          
                                             C
                                             2
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

For each set of parameters, synthetic pressure data were generated using the forward model for the dual-lung simulator excited by the optimised ventilatory flow. Both the flow and pressure signals were disturbed by additive white Gaussian noise with standard deviations assessed from measurements in the acquisition system: σ
                        
                           Q
                        
                        =5.2×10−4
                        L/s and σ
                        
                           P
                        
                        =1.9×10−2
                        cmH2O respectively. These data were then used to estimate the input impedance of the system, according to Eqs. (4)–(5). Finally, the two-compartment model (Fig. 4) was identified by fitting its impedance (Eq. (6)) to the estimated Z
                        
                           in
                        , using the LM algorithm. The estimates of model parameters served to assess the “measured” heterogeneity index:
                           
                              (10)
                              
                                 
                                    
                                       H
                                       ˆ
                                    
                                    =
                                    
                                       
                                          
                                             
                                                R
                                                ˆ
                                             
                                             1
                                          
                                          
                                             
                                                C
                                                ˆ
                                             
                                             1
                                          
                                       
                                       
                                          
                                             
                                                R
                                                ˆ
                                             
                                             2
                                          
                                          
                                             
                                                C
                                                ˆ
                                             
                                             2
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

The procedure of heterogeneity estimation for the assumed H
                        
                           a
                         and random model parameter values was repeated 1000 times. Such a set of estimates was then used to calculate their mean value Ĥ, standard deviation σ
                        
                           H
                         and coefficient of variation CV
                        
                           H
                        
                        =
                        σ
                        
                           H
                        /Ĥ (Fig. 5
                        ).

The analysis covered the impact of three factors: the choice of starting vector (consistent with global properties of the system and guaranteeing pre-assumed heterogeneity H
                        start
                        =3), imperfect estimation of input impedance from the measured oscillatory signals, and the use of one central inertance L
                        
                           C
                         in the identified model instead of two peripheral inertances characterising the simulator. All investigations were done using the Monte Carlo approach described above.

Firstly, the almost perfect situation was studied when the theoretical impedance was calculated for a given set of parameters with Eq. (6), and then used in the estimation procedure starting from the preliminary vector θ
                        start located in the neighbourhood of the true parameter vector (±20%, the uniform distribution). Next, similar calculations were repeated using, however, the starting vector chosen in the way proposed in Section 2.2.3. Finally, this procedure was run again, this time with the theoretical impedance computed for the lung simulator structure (i.e. with two peripheral inertances – see Fig. 1).

To validate the above described method, a measurement setup has been assembled and then dynamically calibrated using a glass bottle of 10L [49]. A flow generator was used to produce the optimal ventilatory signal. It consists of a piston, a screw and a servo-drive. The 3.0L±0.4% calibration pump (Cardinal Health, Germany) was used as a piston, the ball screw FDW 16-5 B1 (HIWIN Corp., USA) was used as linear actuator. The EZF501 servomotor controlled by the SDS5040 servo-drive (both Stöber, Germany) was applied to achieve a good reproducibility of the signal. The temperature compensated and calibrated, on-chip signal conditioned, integrated silicon pressure transducer MPXV5004G (Honeywell, USA) was used to measure pressure up to 40cmH2O with accuracy ±2.5% of a full scale. Additionally, the pressure sensor was calibrated by means of the HD 2134.2 micromanometry pressure meter (Delta Ohm S.r.L, Italy). The RSS100HR pneumotachometry system with analogue output (Hans Rudolph, Inc., USA) was used to register flow. Both the signals were finally sampled at 200Hz. All of the measurement setup components were controlled by the National Instrument's c-RIO-9022 real time system and Labview application (NI, USA).

The experimental validation of the method was done using the above described measurement system and the lung simulator Dual Adult Model 5600i with limited possibilities of mechanical settings. The pneumatic resistors were permanently set with their nominal values: R
                           
                              C
                           
                           =5cmH2O/L/s, R
                           
                              1
                           
                           =5cmH2O/L/s and R
                           
                              2
                           
                           =20cmH2O/L/s, whereas the compliances of bellows were set by adjusting the spring grips to values yielding approximate ventilation heterogeneities of: 1, 2, 4, 6, and 8. Each time the true values of the set compliances were measured by acquiring their static characteristics. The true properties of resistances were measured previously (see Section 2.1). Having the preconcerted configuration of the lung simulator, it was excited by the OVW, and both the inlet flow and pressure signals were recorded by the measurement setup. These experimental data were finally used to calculate the heterogeneity index using the afore-described procedure.

@&#RESULTS@&#

The Monte Carlo simulations have been performed for chosen values of the heterogeneity index. Mean values of H, standard deviations and coefficients of variation calculated from a 1000 of repetitions are gathered in Table 3
                        . It is visible that the procedure properly (with an acceptable level of variability) extracts increasing bimodal inhomogeneity of ventilation from the FOT signals, however, the higher level of heterogeneity the bigger underestimation of H. The most accurate are the estimates for H
                        
                           a
                        
                        =2, and the error of estimation (both the systematic and random component) increases for H
                        
                           a
                         close to 1 as well as for developing heterogeneity.

The results of Monte Carlo simulations exploring some features of the procedure for heterogeneity estimation are shown in Table 4
                        . The two first columns report results for the inverse model fitted to its theoretical (undisturbed) impedance calculated with Eq. (6). For each level of assumed heterogeneity H
                        
                           a
                        , the mean value and standard deviation of estimates were computed for the starting vector located in the neighbourhood of the true parameter vector (Ĥ
                        
                           T
                         and σ
                        
                           Ht
                         – first column), for the starting vector obtained in the way proposed in Section 2.2.3 (Ĥ
                        
                           C
                         and σ
                        
                           Hc
                         – second column), and for the theoretical impedance calculated for the structure with two peripheral inertances (Ĥ
                        
                           P
                         and σ
                        
                           Hp
                         – third column). Only the first approach yielded all the mean heterogeneity indexes fully consistent with the assumed values.

The developed procedure for heterogeneity estimation was tested using a few settings of the lung simulator, mimicking different levels of bimodal ventilation. Resistances R
                        
                           C
                        , R
                        1, and R
                        2 as well as compliance C
                        1 were kept unchanged with measured static properties: k
                        
                           aC
                        
                        =4.48, k
                        
                           a1
                        =4.31, k
                        
                           a2
                        =18.8cmH2O/(L/s), and C
                        1
                        =0.0443L/cmH2O, whereas the value of C
                        2 was altered to roughly get the assumed values of H, according to Eq. (9).

Exemplary courses of inlet flow and pressure, measured for assumed H
                        
                           a
                        
                        =4, are shown in Fig. 6
                        , and the input impedances calculated for different settings of the passive lung simulator are illustrated in Fig. 7
                         together with the fits of the inverse model.

The measured properties of the lung simulator and the estimated values of the heterogeneity index are shown in Table 5
                        . Despite there is only one set of measurement data for a given simulator arrangement, estimations (obtained with the same preliminary starting vector) has been repeated 1000 times to capture the stochastic effect of the random search on the optimised starting vectors, and thus on the estimates. This enabled to assess both the mean value and standard deviation of H.

@&#DISCUSSION@&#

This work aims at the analysis of the method for the assessment of bimodal ventilation heterogeneity using the Otis model and forced oscillations. Such pattern of ventilation has been reported for constricted lungs [7–9], and there is some evidence for bimodal ventilation distribution also during lung injury (e.g. Fig. 7 in [50]). Other works suggest, however, that certain bronchoconstriction arrangements cannot be adequately characterised by just two compartments (e.g. [51]).

Otis et al. [29] were the first who interpreted the observed influence of changes in breathing frequency on the distribution of ventilation by means of uneven time constants characterising separate lung pathways. The proposed model with two nonuniformly ventilated compartments in parallel appeared, however, equivalent to other structures characterised by a biquadratic form of input impedance [31]. Follow-up analyses of simple lumped parameter models fitted to frequency data showed that this approach would not allow a distinction between parallel inhomogeneities and tissue viscoelasticity [33,35,52]. In effect, the homogeneous viscoelastic model (particularly the constant-phase one) fits impedance spectra with satisfactory precision also during pathological conditions, even when the diseased lungs are invariably heterogeneous [44,53,54]. Also a converse situation is possible, i.e. when the model with parallel inhomogeneity fits well data coming from homogeneous lungs with distinct viscoelasticity. Thus, a meaningful physiological interpretation of the Otis model properties (as the time constants) seems particularly plausible in pathologies with dominating bimodal ventilation. Under such conditions, however, one should probably consider a model having both ventilation inhomogeneities and viscoelastic tissues [32,33]. Such structures were proposed, e.g. [44] and including airway distributed heterogeneity [25]. Alternatively, an inverse model with homogenous airways and stochastically heterogeneous tissue may be used [27]. Both approaches including distributed inhomogeneity were intensively studied (e.g. [50,51]). A level to which the viscoelastic tissue properties and distributed heterogeneities influence the estimation of existing bimodal ventilation heterogeneity remains to be studied, and the first step is to evaluate the method based on the Otis structure alone, as is done in the present work. Specifically, the properties of the proposed estimation procedure are the main subject of concern.

The ratio between the number of impedance data used to identify the two-compartment model (7 resistances and 7 reactances) and the number of model parameters (6 parameters) is unfavourably small. Any perturbation in Z
                     
                        in
                      has therefore substantial influence on the parameter estimates. Coefficients used to calculate Z
                     
                        in
                      are estimated from thousands of measured flow and pressure data so the random noise impact is strongly damped. This procedure does not, however, protect the estimate Z
                     
                        in
                      from other types of disturbances, particularly such as trends and quasi-cyclic ones. Fortunately, the pressure drift caused by gas leakage, disturbing estimation of Z
                     
                        in
                      at the lowest frequencies, has been successfully eliminated by the additional terms included in the oscillating pressure model (Eq. (4)). Comparing the results shown in Table 3 and in the second column of Table 4, where the same estimation procedure was used to fit the model to impedance calculated from the simulated flow and pressure signals (including the nonlinear effects of resistances, gas leakage and additive noise, Table 3) and theoretical Z
                     
                        in
                      computed from model (6) (Table 4) it is clear that the potential impact of the aforementioned factors corrupting the FOT signals is negligible, but resulting in larger σ
                     
                        H
                      for H
                     
                        a
                      equal to 1.2 and 2. Also the use of a simpler model (with one central inertance L
                     
                        C
                     ) fitted to Z
                     
                        in
                      instead of the structurally more adequate one (with two peripheral inertances L
                     1 and L
                     2) has not disturbed the estimation of ventilation heterogeneity (compare the second and third column in Table 4).

The standard deviations of estimators assessed in Table 3, higher for larger inhomogeneities, are related to two factors. The first one can be explained by the sensitivity analysis, specifically by correlations between parameter estimators conditioning the joint confidence region [32]. They can be preliminarily evaluated by analysing correlations between the sensitivity vectors used in the LM procedure. The inverse model is nonlinear and its sensitivity matrix is dependent on the parameter vector, so using a linear approximation the local correlation coefficients have been calculated for parameter vectors yielding the same H
                     
                        a
                      as in Table 3 and averaged using the Monte Carlo approach. The largest correlations are as follows: 0.995 between R
                     
                        C
                      and R
                     1, and R
                     
                        C
                      and R
                     2 for H
                     
                        a
                     
                     =1.2; 0.944 between R
                     
                        C
                      and R
                     2 for H
                     
                        a
                     
                     =2; 0.909 between R
                     2 and E
                     1 for H
                     
                        a
                     
                     =4; 0.964 between R
                     2 and E
                     1 for H
                     
                        a
                     
                     =6, and 0.960 between R
                     2 and E
                     1 for H
                     
                        a
                     
                     =8. The smallest correlations occur for medium heterogeneities (H
                     
                        a
                      equal to 2 and 4), and the largest ones for the almost homogeneous structure (H close to 1). The latter fact comes from the loss of identifiability of the two-compartment model, which then becomes equivalent to the one-compartment structure [36]. Nevertheless, σ
                     
                        H
                      for H
                     
                        a
                     
                     =1.2 is kept small due to the regularisation mechanism holed up in the LM algorithm. High correlations between parameter estimators make that the hyper-surface of minimised functional (7) becomes very flat (at least in some directions) in the neighbourhood of the optimal parameter vector and, in effect, the model stays well fitted to the data for a fairly broad range of parameter values. This is reflected in large values of standard deviation for H
                     
                        a
                      equal to 6 and 8. Additional increase of estimates variation (taking into account that the maximal correlations are comparable for H
                     
                        a
                      equal to 6 and 8) stems therefore from the second factor – growing ranges of parameter variabilities used in the Monte Carlo simulations (see Table 2). It is worth to note, however, that in all the cases the coefficients of variation remain at a reasonably small level (Table 3), which is a desirable feature when one tries to differentiate between various levels of lung ventilation dysfunction. On the other hand, the growing variation of parameter estimates with the increasing level of heterogeneity questions to some extent the results and interpretation of former trials reporting very high values of the heterogeneity index [32,35].

The increase of the estimation systematic error for higher inhomogeneities (Table 3) arises from the heterogeneity level assumed as H
                     start
                     =3 when forming the preliminary starting vector and from the aforementioned flat hyper-surface of the minimised functional, resulting in the underestimation of higher heterogeneities. This is reasoned by the comparison of mean values of H in Table 3 and in the two first columns of Table 4. The approach used for formulating the preliminary starting vector has appeared to be the main factor responsible for the growing estimation bias. It would be enough to start the estimation procedure from the neighbourhood of the true parameter vector (±20% in simulations) to get an accurate estimate of heterogeneity (in terms of the expected value, see the first column of Table 4). Unfortunately, this region is never known a prori in real trials. Knowing, however, a systematic error characterising a given measurement method, one may try to find a relationship between measured and true values, and then to use it when compensating the estimator bias. The regression of H
                     
                        a
                      on Ĥ from Table 3 is appropriately described by a quadratic function (R
                     2
                     =0.99996), and the following correction formula can be proposed for the estimation procedure:
                        
                           (11)
                           
                              
                                 
                                    H
                                    
                                       c
                                       o
                                       r
                                       r
                                    
                                 
                                 =
                                 0.071
                                 
                                    
                                       H
                                       ˆ
                                    
                                    2
                                 
                                 +
                                 0.89
                                 
                                    H
                                    ˆ
                                 
                                 −
                                 0.023
                              
                           
                        
                     
                  

Using this formula, the corrected values of mean heterogeneity estimates were computed, both for simulated (Table 3) and experimental data (Table 5), and shown in Table 6
                     . The results obtained for the synthetic data are adequate, as one can expect when correcting data with a formula derived from them. Nevertheless, this shows that the method proposed in this paper, supplemented by the estimate correction, would give satisfactory outcomes (the accurate estimation of the heterogeneity index with acceptable level of variance) in conditions determined solely by the included phenomena, as: bimodal ventilation, elastic lung properties, nonlinear resistances, gas leakage, and additive measurement noise. Moreover, a similar forward–inverse approach [52] with a more complex forward model, including e.g. distributed ventilation heterogeneity and constant-phase tissue properties [25,27], can be used in the future to improve the algorithm's accuracy for more general cases.

Real objects are always more complicated than forward models and this is visible in the corrected values of measured heterogeneity, which still differ from the values set in the lung simulator (Table 6). In this case however, the differences stem not only from model idealisation, but also from errors of simulator characteristics measurements, yielding only approximate values of set heterogeneity. Nevertheless, both the raw (Table 5) and corrected (Table 6) values of H measured experimentally with the proposed method properly indicate increasing level of ventilation heterogeneity when systematically changing the mechanical properties of the lung simulator.

@&#CONCLUSIONS@&#

A simply determined index, correlated with the lung ventilation inhomogeneity level, would be clinically useful, particularly in pulmonary function diagnostics and for mechanical ventilators settings. Among several proposals, the ratio H between the two time constants of the Otis parallel model is characterised by especially positive attributes: straightforward interpretation and technical simplicity of applying the forced oscillation technique. The outcomes of undertaken literature study suggest that this approach is suitable in the case of lung heterogeneity dominating over other structural or mechanical properties, as e.g. tissue viscoelasticity. Particularly, the bimodal ventilation following bronchoconstriction and self-organized mechanisms in the respiratory system represents the primary field of interest.

Interpreting the input respiratory impedance measured by forced oscillations in terms of the Otis model parameters involves the use of a procedure fitting the model to impedance data. We have shown that estimates yielded by the Levenberg–Marquardt algorithm properly assess the increasing level of ventilation heterogeneity, and that the results are insensitive both to measurement noise (at the level present in the measurement setup) and a simplified structure of the inverse model. Moreover, the estimation bias stemming from a fixed H
                     start can be compensated using a correction equation. Simultaneously, the coefficient of variation persists at an acceptable level for all investigated degrees of heterogeneity. Also experimental trials have returned heterogeneity indexes consistent with set values.

The proposed method was analysed using the dual-lung mechanical simulator and its mathematical model, both well corresponding to the identified Otis structure after the use of correction equation. In measurements with real subjects some lung properties as tissue viscoelasticity cannot be neglected. Having encouraging results achieved in this study, in future analyses it would be worth to answer the question regarding the possibility of determining the ventilation heterogeneity in the presence of viscoelastic phenomena, distributed airway or tissue inhomogeneity or spontaneous activity of respiratory muscle, as well as to extend the study into the time domain.

@&#ACKNOWLEDGEMENTS@&#

This work was partially supported by the National Science Centre under decision DEC-2013-11-B-ST7-01173.

Elevated pressure in the inflated lung simulator causes gas outflow Q
                     
                        L
                      through leakinesses of the pneumatic system, being proportional to this pressure:
                        
                           (A1)
                           
                              
                                 
                                    Q
                                    L
                                 
                                 (
                                 t
                                 )
                                 =
                                 
                                    k
                                    R
                                 
                                 P
                                 (
                                 t
                                 )
                                 ,
                              
                           
                        
                     where k
                     
                        R
                      is a reciprocal of leakage resistance. Taking into account the static characteristics of the bellows (Fig. 2B), the pressure is proportional to the actual gas volume:
                        
                           (A2)
                           
                              
                                 P
                                 (
                                 t
                                 )
                                 =
                                 E
                                 ⋅
                                 V
                                 (
                                 t
                                 )
                                 +
                                 
                                    P
                                    0
                                 
                                 ,
                              
                           
                        
                     so the gas leakage is given by:
                        
                           (A3)
                           
                              
                                 
                                    Q
                                    L
                                 
                                 (
                                 t
                                 )
                                 =
                                 
                                    k
                                    R
                                 
                                 (
                                 E
                                 ⋅
                                 V
                                 (
                                 t
                                 )
                                 +
                                 
                                    P
                                    0
                                 
                                 )
                                 =
                                 
                                    k
                                    
                                       Q
                                       1
                                    
                                 
                                 V
                                 (
                                 t
                                 )
                                 +
                                 
                                    k
                                    
                                       Q
                                       2
                                    
                                 
                              
                           
                        
                     where k
                     
                        Q1 and k
                     
                        Q2 are constants. The drop of gas volume ΔV resulting from this leakage amounts to:
                        
                           (A4)
                           
                              
                                 
                                    Δ
                                 
                                 V
                                 (
                                 t
                                 )
                                 =
                                 
                                    ∫
                                    0
                                    t
                                 
                                 
                                    
                                       Q
                                       U
                                    
                                    (
                                    τ
                                    )
                                    d
                                    τ
                                 
                                 =
                                 
                                    k
                                    
                                       Q
                                       1
                                    
                                 
                                 
                                    ∫
                                    0
                                    t
                                 
                                 
                                    V
                                    (
                                    τ
                                    )
                                    d
                                    τ
                                 
                                 +
                                 
                                    k
                                    
                                       Q
                                       2
                                    
                                 
                                 t
                              
                           
                        
                     
                  

Finally, the pressure drop ΔP caused by the decrease of gas volume, visible in measurement data and included in the pressure signal model (Eq. (4)), is proportional to ΔV (see Fig. 2B):
                        
                           (A5)
                           
                              
                                 
                                    Δ
                                 
                                 P
                                 (
                                 t
                                 )
                                 =
                                 E
                                 ⋅
                                 
                                    Δ
                                 
                                 V
                                 (
                                 t
                                 )
                                 =
                                 
                                    k
                                    1
                                 
                                 
                                    ∫
                                    0
                                    t
                                 
                                 
                                    V
                                    (
                                    τ
                                    )
                                    d
                                    τ
                                 
                                 +
                                 
                                    k
                                    2
                                 
                                 t
                                 .
                              
                           
                        
                     
                  

@&#REFERENCES@&#

