@&#MAIN-TITLE@&#Motility bar: A new tool for motility analysis of endoluminal videos

@&#HIGHLIGHTS@&#


               
                  Author-Highlights
                  
                     
                        
                           
                           We propose computer vision tools for the analysis of the motility bar image [1].


                        
                        
                           
                           A method for contraction analysis is proposed.


                        
                        
                           
                           A method for lumen perimeter change characterization is introduced.


                        
                        
                           
                           An algorithm for stable motility segments detection is described.


                        
                        
                           
                           Quick analysis time with good qualitative and quantitative results.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Small intestine

Motility

WCE

Computer vision

Image classification

@&#ABSTRACT@&#


               
               
                  Wireless Capsule Endoscopy (WCE) provides a new perspective of the small intestine, since it enables, for the first time, visualization of the entire organ. However, the long visual video analysis time, due to the large number of data in a single WCE study, was an important factor impeding the widespread use of the capsule as a tool for intestinal abnormalities detection. Therefore, the introduction of WCE triggered a new field for the application of computational methods, and in particular, of computer vision. In this paper, we follow the computational approach and come up with a new perspective on the small intestine motility problem. Our approach consists of three steps: first, we review a tool for the visualization of the motility information contained in WCE video; second, we propose algorithms for the characterization of two motility building-blocks: contraction detector and lumen size estimation; finally, we introduce an approach to detect segments of stable motility behavior. Our claims are supported by an evaluation performed with 10 WCE videos, suggesting that our methods ably capture the intestinal motility information.
               
            

@&#INTRODUCTION@&#

Small intestine is a tubular organ that connects stomach with large intestine. Its main function is the digestion and the absorption of nutrients and minerals found in the food. To do so, the small intestine pushes the ingesta by means of an intestinal activity called motility. In general, motility can be categorized in two different dynamic phenomena [2]: peristalsis, synchronized movement of the intestinal wall responsible for moving the ingesta in one direction and segmentation, unsynchronized movement of the intestinal wall, which has the effect of mixing the contents but not pushing them along the intestinal tract. The movement of the intestinal wall is called contraction. When the intestine is not active (neither peristalsis nor segmentation is occurring) then the organ is referred to as static.

The peristalsis and the segmentation are regulated by three types of intestinal contractions [3]:
                        
                           •
                           
                              Rhythmic phasic contractions that consist of brief periods of both relaxation and contraction. These contractions cause mixing and slow propulsion of ingesta.


                              Ultrapropulsive contractions that are used to move rapidly the intestinal content without regard for digestion or absorption. These contractions are two to four times larger in amplitude and four to six times longer in duration than phasic contractions. Moreover, since the goal of these contractions is to clean the intestine rapidly, they propagate uninterruptedly over long distances of the small intestine.


                              Tonic contractions that are maintained for a longer period of time (from several minutes to several hours). The precise role of these contractions in the digestion process has not yet been established [3].

Currently, the main source of information, which leads to a diagnosis of small intestine motility disorders, is manometry [4,5]. However, this technique has three shortcuts: (1) it is highly invasive, causing patient discomfort; (2) it does not provide the visualization of the intestine; and (3) only a part of the organ can be evaluated. Therefore, the researchers are actively looking at alternative methods for evaluating intestinal motility. These alternatives include techniques such as magnetic resonance imaging (MRI) [6–9], magnet tracking system [10], sonograph [11] or pH and pressure measurements [12]. For a review of tools for monitoring intestinal motility, refer to [13,14].

Recently, it was shown that Wireless Capsule Endoscopy (WCE) can be used as a tool for intestinal motility inspection [15]. The main advantage of the capsule is the fact that it allows inner-visualization of the entire small intestine in a non-invasive manner. There are only two factors that control the capsule movement, velocity and direction: the small intestine motor activity and the gravity. Thus, the capsule transit time can reach up to more than 8h, resulting in a video that has up to 60.000 frames. The main limitation of WCE is the time associated with video analysis time.

To overcome a problem of large amount of video frames, a variety of systems for WCE video analysis have been developed (for a review refer to [16]). Only a small amount of works deal with the application of WCE to the small intestine motility analysis, including contraction analysis and static segments detection. Contraction detection is tackled in [17,18], where a three-stage cascade for contraction detection is proposed, or in [19], where a sequential design is developed. In [20], a method for the contraction׳s central frame detection (referred to as wrinkle frame), based on a mid-level centrality descriptor combined with a structural output SVM classifier, is presented. Whereas, static sequences are characterized by color distribution changes between consecutive frames [21–23]. All methods for static frames detection are used as filters to reduce the video analysis time, they are not considered as modules extracting motility information. In this scenario, the static frames, once detected, are removed or subsampled.

To reduce the motility analysis time, we previously designed a tool for visual analysis of WCE video, called motility bar. An early version of this tool was introduced in [1]
                     
                        1
                     
                     
                        1
                        In [1], the motility bar is referred to as longitudinal view.
                      (see Section 2 for a review of the motility bar). The idea of the bar is to map information present in 3D video signal into 2D motility image. This transformation is done by picking a single line of pixels, representing a diameter of the circular image of WCE, in every video frame. The concatenation of all the lines of pixels composes a motility bar. The reduction is framed as an optimization problem that finds the best mapping from a frame to a line of pixels. The best mapping is the one that maintains, where possible, lumen size information and, thus, motility information. In order to solve the optimization problem, Dynamic Programming method is used.

The motility bar has several advantages over the video-based visualization of the gut. First, it introduces a new way for the visual inspection of the small intestine motility since, for the first time, the whole intestinal motility can be evaluated at one glance at an image representing all the motility information. Second, it permits to develop more efficient automatic algorithms for endoluminal image analysis leaving behind classical, inefficient video frame processing methods. Finally, the representation of the whole intestinal motility in a single image permits to focus on holistic aspects of the motility analysis that were not exploited up to now (e.g. sequential nature of intestinal events).

The aim of this paper to introduce automatic methods for characterization of intestinal behavior visible in the motility bar. For the first time, a system for global characterization of the intestinal motility, which combines a motility bar with computational methods, is presented. In detail, the contributions of the paper are the following:
                        
                           •
                           We introduce automatic methods for the detection of intestinal events using the motility bar image: a method for characterizing the intestinal contractions (Section 3.1) and a lumen perimeter estimator (Section 3.2).

We propose an unsupervised algorithm for the analysis of multivariate data streams that can capture segments of stable intestinal motility (Section 3.3).

We perform exhaustive visual evaluation of the proposed methods for sequential motility description. To this end, we present several rankings of motility segments (Section 4).

@&#BACKGROUND@&#

In this section, we review the algorithm for motility bar building, which was firstly introduced in [1] as an optimization problem with two constraints: intestinal lumen visibility and motility bar smoothness.

WCE video can be considered as a stream of m frames. Each frame displays the relation between intestinal lumen and intestinal wall
                        2
                     
                     
                        2
                        In some cases this information might be occluded by the intestinal content or might be out of the field of view of the capsule.
                      (for an example, see Fig. 1
                     (a)). The evolution of the lumen–wall relationship throughout the video represents the motility viewed by the capsule. Each frame can be represented by a set of diameters (see Fig. 1(b) and (c)). According to [1], if we pick the diameter that best represents intestinal motility information in a single frame and concatenate the diameters from the whole video then, as a result, we obtain an image that represents the WCE video motility information.

The choice of the best diameter can be formalized as follows. Let us parameterize the diameters by an angle (measured counter clockwise and starting with the vertical diameter, see white line in central image in Fig. 1). Let 
                        d
                        (
                        
                           
                              α
                           
                           
                              i
                           
                        
                        )
                      denote the pixels lying on the diameter with an angle α in i-th frame, then the lumen visibility cost D can be defined as
                        
                           (1)
                           
                              D
                              (
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              1
                              /
                              (
                              σ
                              (
                              d
                              (
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              )
                              )
                              +
                              1
                              )
                              +
                              μ
                              (
                              d
                              (
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              )
                              )
                           
                        
                     where it is assumed that the values of the vector 
                        d
                        (
                        
                           
                              α
                           
                           
                              i
                           
                        
                        )
                      are in the range 
                        [
                        0
                        ,
                        1
                        ]
                      (a gray scale image), σ represents the standard deviation and μ represents the mean value.

As shown in [1], it is important to control the level up to which the diameter angle can change between two consecutive frames, since, if no restriction on the angle is imposed, the resulting image is difficult to interpret. The angle smoothness is restricted by two factors:
                        
                           •
                           Angle change: 
                                 V
                                 ′
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 180
                                 °
                                 −
                                 |
                                 180
                                 °
                                 −
                                 |
                                 
                                    
                                       α
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 ∥
                              .

Similarity between two diameters: 
                                 
                                    
                                       V
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 ∥
                                 d
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 )
                                 −
                                 d
                                 (
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 
                                    
                                       ∥
                                    
                                    
                                       2
                                    
                                 
                              .

Finally, the task of motility bar building can be formulated as an optimization problem of finding the best path in a graph that represents all possible diameters in a video. The cost of a candidate solution 
                        (
                        
                           
                              α
                           
                           
                              1
                           
                        
                        ,
                        …
                        ,
                        
                           
                              α
                           
                           
                              m
                           
                        
                        )
                      to the problem can be defined according to the following cost equation:
                        
                           (3)
                           
                              E
                              (
                              
                                 
                                    α
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    α
                                 
                                 
                                    n
                                 
                              
                              )
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    m
                                 
                              
                              D
                              (
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              )
                              +
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    2
                                 
                                 
                                    m
                                 
                              
                              V
                              (
                              
                                 
                                    α
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                              ,
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              )
                              .
                           
                        
                     
                  

The minimal cost solution to Eq. (3) is found using Dynamic Programming method [24]. The motility bar is an image obtained after concatenating the optimal solution diameters. Fig. 2
                      shows the results of the motility bar building algorithm. Note, how the diameter adapts its angle to the lumen position in the WCE frame. Moreover, modifying the cost function it is possible to follow different clinical phenomena in the small intestine, e.g. by maximizing the visibility of intestinal content or bleeding regions.

An example of the motility bar is presented in Fig. 3
                     . The image represents the entire small intestine and is divided into 9 rows, each one representing 30min of video. Each row represents the evolution of intestinal lumen (visible in black-like color), intestinal wall (visible in orange-like color) and intestinal content (visible in green-like color). Contractions are visible as oscillations of intestinal wall (or, alternatively, oscillations in lumen size).

Three observations can be made based on the visual inspection of intestinal patterns shown in Fig. 3: (1) different intestinal motility behavior can be generally characterized by two phenomena, contractile velocity and lumen size; (2) in some cases intestinal content impedes proper visualization of intestinal wall/lumen (e.g. see last row in Fig. 3); and, (3) intestinal events appear grouped as a sequence of stable motility behavior, e.g. it is extremely rare to see only one contraction, contractions always appear as grouped intestine oscillations, a fact that is hardly observed in frame-based analysis and inspection (to see examples of stable motility behavior, refer to Fig. 4
                     ).

@&#METHODS@&#

In this section, we present three methods for automatic analysis of the motility information visible in the motility bar: (1) contractile frequency characterization, (2) lumen perimeter characterization and (3) stable motility segments detection.

In this subsection, we introduce a framework for automatic analysis of contractile patterns that are seen in the motility bar. To characterize the contractile events, we detect the dark regions separating two oscillatory wall movements in the motility bar.

In order to fully understand the concept of contraction in the motility bar, let us present a synthetic example. Contractions can be described (in frame view) as open–close–open lumen sequence (see Fig. 5
                        (a)). Moreover, let us define the zone between two contractions as a sequence of open lumens between two wall closures (see Fig. 5(a)). The same event can be represented in the motility bar (see Fig. 5(b), where a contractile sequence is presented). To estimate the contractile frequency, one can measure either contractions or zones between contractions. In our set-up, we count the number of zones separating contractions and refer to one separation zone as valley.

@&#METHODOLOGY@&#

The input to the method is a color image representing the motility bar, the output is a binary signal with value 1, where a contractile oscillation is detected. To detect contractions, the method performs 3 basic steps:
                              
                                 •
                                 
                                    Step 1: Apply a set of Gabor-like filters in order to detect valleys in the image.


                                    Step 2: Convert the valley image into 1D signal representing valley positions.


                                    Step 3: Detect peaks representing contractions in valleys׳ positions signal.


                           Step 1. From RGB to valley image: The first step of the method is the detection of valleys in the motility bar. The architecture of the system is shown in Fig. 6
                           (a). We process separately each of the R, G and B image channels. Finally, we pool the four resulting images by applying L
                           3 norm to each pixel position and, as a result, a single image is obtained.
                              3
                           
                           
                              3
                              The p-norm acting on a vector of four pixels 
                                    x
                                    =
                                    
                                       
                                          [
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                3
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                4
                                             
                                          
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                  is defined as 
                                    
                                       
                                          L
                                       
                                       
                                          p
                                       
                                    
                                    =
                                    
                                       
                                          (
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                4
                                             
                                          
                                          |
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                |
                                             
                                             
                                                p
                                             
                                          
                                          )
                                       
                                       
                                          1
                                          /
                                          p
                                       
                                    
                                 . L
                                 1 norm is a simple sum of the absolute values of vector components. In case of L
                                 3, since the components are raised to the power of 3 before summing them up, the influence of the low-scored pixels is reduced. The reduction level of the low-scored pixels increases with increment in p and for 
                                    p
                                    =
                                    ∞
                                  the norm 
                                    
                                       
                                          L
                                       
                                       
                                          ∞
                                       
                                    
                                    =
                                    max
                                    
                                       
                                          [
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                3
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                4
                                             
                                          
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                  takes into account only the maximum vector component.
                           
                        

There are two inputs to the method: an RGB image and a set of filters. We use 4 filters that correspond to the detection of valleys at different time scales (different contractile frequencies). The filters that we use correspond to second order derivative of Gaussian filters and are defined in the direction of time axis of the motility bar, so that they look only for vertical valleys (see Fig. 7
                            for images representing the filters). All filters have a height of 10 pixels and are normalized to have mean 0 and energy 1. The filters can be characterized by a scale parameter (the duration of the ridge). We use the ones that detect valleys at the following scales
                              4
                           
                           
                              4
                              The maximum contractile frequency is 12 contractions per minute thus, the minimal time separating two contractions is 5s. The maximal time interval separating two contractions might be very long and is difficult to determine, in our system, we use an arbitrary value of 14s.
                           :
                              
                                 •
                                 
                                    Filter 1: 10 frames, 5s,


                                    Filter 2: 16 frames, 8s,


                                    Filter 3: 22 frames, 11s,


                                    Filter 4: 28 frames, 14s.


                           Fig. 6(b) shows how the filters are applied to each image channel. The first step is a convolution of an image with the filters. In the second step, we apply hyperbolic tangent non-linearity in order to normalize the filter responses into the range [−1, 1]. Since we are interested in valleys (and not in ridges), we set all negative responses to 0. In order to boost the high filter responses, we raise the results to the power of 3. We follow by summing up the result on neighboring scales and joining the results using L3 norm.

Some examples of valley images are presented in Fig. 8
                            (2nd row). As it can be seen, the method detects well the dark zones of separations between two contractions (valleys).


                           Step 2. Valley image to 1D signal: To convert a valley image ;into a 1D signal, a percentile is calculated for each vertical line of the motility bar. Since we are not interested in shallow (not well marked) contractions, a percentile 75 is applied so that a condition on the oscillation size is imposed. This restriction is important, since some small oscillations are not contractions and can represent external oscillatory movements, e.g. respiratory oscillations. The results of this step are shown in Fig. 8 (3rd and 4th rows).


                           Step 3. 1D signal to binary image: In the last step of the method, the 1D signal is converted into a binary signal representing the detected contractile movements. This is done by the local maxima detection. We impose two restrictions on local maxima: the minimum height of the peak, and the distance between two neighboring local maxima (used to avoid two detections separated by small amount of time).
                              5
                           
                           
                              5
                              The minimum hight is set to 0.4, and the distance is set to 7 frames.
                            The result of the peak detection is shown in Fig. 8 (5th row). As it can be seen, strong peaks are correctly detected while low peaks are not classified as contractions.

Finally, the binary signal with contractile information is used to estimate the frequency of contractions. The frequency is estimated using 1min sliding window. The results are presented in Fig. 9
                            (bottom line). The maximum value of the frequency plot represents 12 contractions per minute, the minimal value indicates 0 contractions per minute.

In WCE image, the lumen is visually characterized as a dark region with low illumination intensity. Thus, our detection method of the lumen is based on the light intensity analysis.

@&#METHODOLOGY@&#

The lumen perimeter estimation algorithm follows three-step procedure:
                              
                                 •
                                 
                                    Step 1: Reduce the noise in color distribution by applying mean-shift clustering [25].


                                    Step 2: Convert image into gray scale image and apply threshold in order to obtain the regions of lumen.


                                    Step 3: Apply morphological operations in order to obtain smooth regions of intestinal lumen.

It is important to note that the colors seen in WCE videos occupy only a small subspace of RGB cube. In order to reduce the noise in the color feature space, we use the mean-shift method. This method clusters the color space by finding the maxima in color density function. Each cluster is represented by a color corresponding to its maxima. Thus, as a result, an image can be represented with a smaller number of colors. Mean-shift for image segmentation has three parameters: spatial bandwidth h
                           
                              S
                           , range (feature) bandwidth h
                           
                              r
                            and minimal region size M 
                           [25]. We use the Edison implementation
                              6
                           
                           
                              6
                              Available at: http://coewww.rutgers.edu/riul/research/code/EDISON/.
                            of the mean-shift method with the following parameters 
                              (
                              
                                 
                                    h
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    h
                                 
                                 
                                    r
                                 
                              
                              ,
                              M
                              )
                              =
                              (
                              10
                              ,
                              4
                              ,
                              100
                              )
                           . The parameters were set through visual validation, in such a way that the perception of lumen in the motility bar was not modified.

In the second step, the image is transformed into a gray scale image and a threshold is applied. The gray scale image has values in the range of 
                              [
                              0
                              ,
                              1
                              ]
                            and the threshold is fixed to 0.3. This step computes a binary image, where black represents the lumen and white represents no lumen regions. In order to remove small regions of lumen, morphological operations of opening and closing are applied.
                              7
                           
                           
                              7
                              We use two-dimensional eight-connected neighborhood.
                            
                           Fig. 10
                           (a) shows the results of lumen segmentation from the motility bar (black area). As it can be seen, the lumen segments coincide well with their original position in the motility bar.

Finally, we convert the segmentation results into a numerical value, representing the percentage of each line of the motility bar that is occupied by intestinal lumen. This value is calculated for each line of the motility bar. Fig. 10(b) shows the results of the lumen size estimation (bottom line), where the maximum value means that 100% of the motility bar represents lumen.

Small intestine can be described in terms of stable motility segments, where each one can be described in terms of lumen size change and contractile frequency. In the current section, we propose an algorithm for the detection of these constant motility patterns.

Three aspects of the stable motility segments detection require some further attention. First, segment duration can be highly variable (from several seconds up to an hour). Second, we describe a segment in terms of contractile frequency and lumen perimeter change thus, we have a two-variate data stream. Finally, since no labels are available for the task of segment detection, we must deal with unsupervised methods. Therefore, the method used for automatic detection of the sequential events has to be able to cope with all three previously mentioned characteristics.

A first approach to automatic detection of motility segments was proposed in [26], where an extension to multivariate signals of the approach introduced in [27] is proposed. The motility segmentation algorithm is based on an adaptive-length sliding window approach. Whenever a difference in the regime of the multidimensional signal is detected at given time, the method splits the window into two subwindows and detects a change point. If no proof of two different regimes inside the window is found, the method expands the window by adding one new element from the data stream. The division is based on the concentration inequality derived from Hoeffding׳s inequality [28]. Due to the implication of this inequality, the method controls the false alarms and provides the statistical guarantees on false positive and false negative rates.

Instead of calculating the difference between two means of the multivariate stream norms, as it is done in [26], we propose to calculate the norm of differences of two multivariate means. This formulation makes the algorithm sensitive to changes that differ only in vector components permutation, meaning that our method is capable to differentiate between a vector 
                           
                              
                                 [
                                 0
                                 ,
                                 1
                                 ]
                              
                              
                                 T
                              
                           
                         and a vector 
                           
                              
                                 [
                                 1
                                 ,
                                 0
                                 ]
                              
                              
                                 T
                              
                           
                         (note that both vectors have a unit norm and are indifferentiable by [26]).

The algorithm can be formalized as follows. Let us consider a multivariate data stream 
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                              
                              
                                 →
                              
                           
                           ,
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                              
                              
                                 →
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 →
                              
                           
                           ,
                           …
                        , where each observation 
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 →
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                    
                                       k
                                    
                                 
                                 ]
                              
                              
                                 T
                              
                           
                        , 
                           i
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           t
                           ,
                           …
                         is a k-dimensional vector. Each sample 
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 →
                              
                           
                         is generated according to some multivariate distribution D
                        
                           i
                        . Each 
                           
                              
                                 x
                              
                              
                                 i
                              
                              
                                 j
                              
                           
                           ∈
                           [
                           0
                           ,
                           1
                           ]
                        . Let 
                           
                              
                                 μ
                              
                              
                                 →
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       μ
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       μ
                                    
                                    
                                       k
                                    
                                 
                                 ]
                              
                              
                                 T
                              
                           
                         be the expected value of 
                           
                              
                                 x
                              
                              
                                 →
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       W
                                    
                                 
                              
                              
                                 →
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       W
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       W
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       W
                                    
                                    
                                       k
                                    
                                 
                                 ]
                              
                              
                                 T
                              
                           
                         be the estimated mean within the window W. Nothing else is known about the data stream.


                        Algorithm 1 shows the segmentation algorithm for a k-dimensional data stream. We begin with a window W. At each step t of the algorithm, we add next data from the data stream (increasing the size of window W by one). We form all bi-partitions 
                           
                              
                                 W
                              
                              
                                 1
                              
                           
                           ·
                           
                              
                                 W
                              
                              
                                 0
                              
                           
                         of window W and calculate the means of the bi-partitions. As soon as the p-norm of differences between the calculated means of a bi-partition is greater or equal to ϵ
                        
                           cut
                        , we can reduce the size of the window W by dropping the oldest stream elements and reducing the size of W.

Note that one of the advantages of the algorithm is that it has only one parameter: the confidence value 
                           δ
                           ∈
                           (
                           0
                           ,
                           1
                           )
                        . 
                           Algorithm 1
                           Segmentation algorithm for k-dimensional data stream. 
                                 
                                    
                                       
                                       
                                          
                                             
                                                Require: multivariate data stream 
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                   ,
                                                   …
                                                
                                             
                                          
                                          
                                             
                                                Require: δ parameter
                                          
                                          
                                             1: Initialize window W
                                             
                                          
                                          
                                             2: for each 
                                                   t
                                                   >
                                                   0
                                                 
                                                do
                                             
                                          
                                          
                                             3: add 
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                 to the head of W: 
                                                   W
                                                   ←
                                                   W
                                                   ∪
                                                   {
                                                   
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                 }
                                          
                                          
                                             4:while exists a split of W into 
                                                   W
                                                   =
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                 such that 
                                                   ∥
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     μ
                                                                  
                                                                  
                                                                     ^
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     W
                                                                  
                                                                  
                                                                     0
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     μ
                                                                  
                                                                  
                                                                     ^
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     W
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                   
                                                      
                                                         ∥
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                   ≥
                                                   
                                                      
                                                         ϵ
                                                      
                                                      
                                                         cut
                                                      
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             5: Drop elements of W
                                                0 from the tail of W
                                             
                                          
                                          
                                             6:end while
                                             
                                          
                                          
                                             
                                                Ensure: detected changes
                                          
                                       
                                    
                                 
                              
                           

Let n, n
                        0 and n
                        1 denote the sizes of the window W, W
                        0 and W
                        1. Let σ
                        2
                        
                           W
                         be the observed variance of the p-norm of the elements in the window W. Then, using δ we can compute the threshold value ϵ
                        
                           cut
                         as follows:
                           
                              (4)
                              
                                 
                                    
                                       ϵ
                                    
                                    
                                       cut
                                    
                                 
                                 =
                                 
                                    
                                       k
                                    
                                    
                                       1
                                       /
                                       p
                                    
                                 
                                 (
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   2
                                                
                                                
                                                   m
                                                
                                             
                                             
                                                
                                                   σ
                                                
                                                
                                                   W
                                                
                                                
                                                   2
                                                
                                             
                                             ln
                                             
                                                
                                                   2
                                                
                                                
                                                   k
                                                   
                                                      
                                                         δ
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                          )
                                       
                                       
                                          1
                                          /
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          2
                                       
                                       
                                          3
                                          m
                                       
                                    
                                    ln
                                    
                                       
                                          2
                                       
                                       
                                          k
                                          
                                             
                                                δ
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              
                                 δ
                              
                              
                                 ′
                              
                           
                           =
                           δ
                           /
                           n
                         and 
                           m
                           =
                           1
                           /
                           (
                           1
                           /
                           
                              
                                 n
                              
                              
                                 0
                              
                           
                           +
                           1
                           /
                           
                              
                                 n
                              
                              
                                 1
                              
                           
                           )
                        . In the evaluation of the data stream segmentation algorithm, we used the following input parameters: 
                           δ
                           =
                           0.1
                         and p=2.

@&#RESULTS@&#

In this section, we present the validation of the proposed techniques for sequential motility analysis system. The system is composed of three elements: (1) motility bar construction reviewed in Section 2, (2) automatic methods for motility features extraction from the motility bar presented in Sections 3:1 and 3:2, and (3) method for unsupervised detection of constant motility segments presented in Section 3.3.

In the evaluation of the system, we use a set of 10 WCE videos (10 healthy volunteers; age range: 20–60 years). The data acquisition was performed at Vall d׳Hebron hospital in Barcelona with Given Imaging PillCam SB2, with a frame rate of 2 frames per second and the resolution of 256×256 pixels per frame.

@&#IMPLEMENTATION@&#

For each video, small intestine entrance and small intestine exit were manually labeled by an expert. Then, for the entire small intestine, we computed the motility bar representation and used this representation to perform automatic analysis of contractile activity and lumen perimeter estimation. The resulting motility bars had the height of 256 pixels and variable length (depending on small intestine transit time). In our case we had videos of 20000–40000 frames and thus, the length of the motility bar ranged from 20000 to 40000 pixels. Finally, the segments of constant intestinal motility were obtained. We implemented the algorithms in Matlab and ran them on Intel I5-2520 CPU machine, the average time needed for feature extraction and segmentation was 190s. To put this number into a context, let us compare our analysis time to timings of two frame-based algorithms: the method proposed in [19] takes, on average, 3h for one video, while the procedure described in [18] reports, on average, 2.5h for a single WCE study.

First, to evaluate the contraction frequency descriptor we presented a 100 random motility bar segments to an expert. The expert was asked to count number of visible contraction pattern in the motility bar. Using these annotations we calculated the frequency of contractions in a segment and contrasted them with the results of our system for contraction frequency characterization. The correlation of frequencies in the segments (our system vs. human) is 84%. To put this number into a context, we asked another expert to label the contractions in the same set of 100 segments. The obtained correlation between the two experts was 89%.

Second, we presented a new set of 100 randomly selected motility bar segments to two experts with a task of labeling visible lumen. Similarly as before, we calculated the correlation of our lumen perimeter detection system with the obtained expert annotations (we measured the occupancy of lumen in a segment), the resulting correlation was of 86% (with 90% correlation between the two experts).

In this subsection we describe qualitative validation. In the first experiment, we visualized a single WCE study (see Fig. 11
                        (b)). The video is displayed in 9 rows (each one represents the information from 3600 frames of WCE that correspond to 30min). Each row is composed of 3 images (from top to bottom): motility bar, contraction density information and lumen size information. The color legend is displayed in Fig. 11(a).

In the next experiment, we visually evaluate whether the description provided by color-coding represents well the information shown in the motility bar. To do so, we use the segments obtained from all 10 videos and construct three rankings. Results are shown in Fig. 12
                        , where we show three groups of contractile activity: (1) static intestine (Fig. 12(a), between 0 and 1 contraction per minute), (2) moderate intestine activity (Fig. 12(b), between 3 and 4 contractions per minute) and (3) highly active intestine (Fig. 12(c), more than 8 contractions per minute). All subfigures are ordered from small to large lumen size. Due to the space limitations, segments longer than 250s are not shown.

Finally, we evaluate how our motility descriptors perform in the presence of intestinal content. In particular, we would like to capture mixing contractions, the ones that are responsible for the segmentation of the digestia. Note that the segmentation is hardly visible in video view and that this phenomena in not detectable by video-based contraction analysis methods (e.g. [19] filters out all the intestinal content frames before applying contraction detector). To this end, we manually select sequences that present intestinal content. The results are presented in Fig. 13
                        . Sequences are ordered from static (top-left) to highly active intestine (bottom-right).

@&#DISCUSSION@&#

In this section, we discuss the results of the proposed pipeline for motility analysis. The motility bar feature extraction time is much faster that the alternative frame based methods (190s our method vs. 2.5–3h [18,19]). The designed methods for contractile frequency characterization and for lumen perimeter estimation have good correlations with human annotator (very similar to the correlation between the annotations of two experts) suggesting that the introduced methods capture well the experts׳ visual impression of the intestinal motility. Furthermore, our unsupervised segmentation method has very plausible statistical properties, due to the implication of concentration inequality, the method controls the false positive and the false negative rates.

The qualitative validation gives encouraging results. Three observations can be made:
                        
                           •
                           As it can be seen in Fig. 11(b), the color-coding adapts well to the information displayed in the motility bar for both descriptors: contraction density and lumen size. Moreover, whenever a significant change in motility occurs, a new segment is detected (see changes in color-coding in Fig. 11(b), e.g. 4th row).

Analyzing the images shown in Fig. 12, several observations can be made. First, comparing the sequences in each subfigure (Fig. 12(a)–(c)), it can be seen that the sequences are well ordered from the point of view of lumen size. Second, comparing the subfigures (Fig. 12(a) with (b) and (c)), one can conclude that the grouping of the images into different intestinal activities captures well the oscillations visible in the motility bar.

One can easily spot a continuous transition from static turbid content to moderate intestinal activity with the presence of intestinal content up to highly frequent segmentation movements in Fig. 13.

Three additional comments should be done with respect to the qualitative validation. First, that some static sequences show very rapid oscillations that represent respiratory oscillations (e.g. see row 3 sequence 9 in Fig. 12(a)). It is important to note that our contraction detector is tuned in order to ignore respiratory oscillations (see Section 3.1). Second, one limitation of our approach can be observed, dark intestinal content might be confused with lumen (e.g. see Fig. 13 row 2 sequence 8). This confusion is caused by the fact that the dark intestinal content in gray-scale image is visually similar to the intestinal lumen. Finally, we would like to remark that the lumen perimeter measurements are done in the motility bar that represents the projection of the lumen into a line of pixels representing the WCE frame diameter. Therefore, this measure should not be interpreted as lumen size but rather as relative change of lumen perimeter throughout the video.

The speed up in the analysis time comes from the change in the motility representation, from frame-based to motility bar. Therefore, although the tools for characterization of the motility information presented in this paper give good results, it might be the case that some motility information is lost while building the motility bar. This information lost was quantified in [1], where it was stated that the motility bar displays the lumen in 87% of the time. The lumen might be lost when the intestine (or capsule) is moving very abruptly between consecutive frames and the lumen is relatively small with respect to the capsule׳s field of view. However, since lumen is lost in individual frames and not in the long video sequences, the missing lumen does not affect the global estimate of the intestinal motility events, as it was shown in [1].

@&#CONCLUSIONS@&#

In this paper, we proposed a complete description of intestinal motility events. Our approach introduced a new perspective on the motility problem and was composed of three steps: first, we reviewed a tool for the visualization of the motility information contained in WCE video; second, we proposed algorithms for the detection of two motility building-blocks: contraction characterization and lumen size estimation; finally, we introduced an approach to detect segments of stable motility behavior. The validation of the sequential features showed that the introduced description captures well the motility phenomena and thus, this characterization might potentially be used in a decision support system for the intestinal motility analysis.

The introduced description has several advantages. First, it is intuitive and it permits to evaluate the intestinal motility at a glance from a single image representing all the necessary information. Second, the extraction of motility features from the motility bar is very time efficient. Finally, the sequential features can potentially be used as a starting point to higher level motility analysis that can lead to better understanding of the small intestine.

As future work, we would like to test the clinical importance of the sequential features. Moreover, we would like to evaluate if, using the sequential approach to motility description, a generative model could be created, for both healthy subjects and abnormal motility subjects. If this is the case, these generated intestine motility images could be used in order to increase the size of current data sets used in abnormal motility detection.

None declared.

@&#ACKNOWLEDGMENTS@&#

This work was supported in part by a research grant from Given Imaging Ltd., Yoqneam, Israel, as well as by Spanish MINECO Grant TIN2012-38187-C03.

@&#REFERENCES@&#

