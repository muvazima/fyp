@&#MAIN-TITLE@&#Monte Carlo method for photon heating using temperature-dependent optical properties

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Couples the Monte Carlo Method of photon transport with heat transfer.


                        
                        
                           
                           Allows for both optical and thermal properties to vary with temperature.


                        
                        
                           
                           Interpolates local optical properties based on local temperatures.


                        
                        
                           
                           Enhances simulation accuracy in systems that undergo large thermal changes.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Monte Carlo

Photon transport

Temperature-dependent

Heat transfer

Optical irradiation

Laser heating

@&#ABSTRACT@&#


               
               
                  The Monte Carlo method for photon transport is often used to predict the volumetric heating that an optical source will induce inside a tissue or material. This method relies on constant (with respect to temperature) optical properties, specifically the coefficients of scattering and absorption. In reality, optical coefficients are typically temperature-dependent, leading to error in simulation results. The purpose of this study is to develop a method that can incorporate variable properties and accurately simulate systems where the temperature will greatly vary, such as in the case of laser-thawing of frozen tissues.
                  A numerical simulation was developed that utilizes the Monte Carlo method for photon transport to simulate the thermal response of a system that allows temperature-dependent optical and thermal properties. This was done by combining traditional Monte Carlo photon transport with a heat transfer simulation to provide a feedback loop that selects local properties based on current temperatures, for each moment in time. Additionally, photon steps are segmented to accurately obtain path lengths within a homogenous (but not isothermal) material. Validation of the simulation was done using comparisons to established Monte Carlo simulations using constant properties, and a comparison to the Beer–Lambert law for temperature-variable properties.
                  The simulation is able to accurately predict the thermal response of a system whose properties can vary with temperature. The difference in results between variable-property and constant property methods for the representative system of laser-heated silicon can become larger than 100K. This simulation will return more accurate results of optical irradiation absorption in a material which undergoes a large change in temperature. This increased accuracy in simulated results leads to better thermal predictions in living tissues and can provide enhanced planning and improved experimental and procedural outcomes.
               
            

@&#INTRODUCTION@&#

Heating a medium using electromagnetic irradiation is a common technique in a variety of disciplines, ranging from electronics to medicine to welding. There exist numerous applications where electromagnetic heating is intended to induce some thermal damage or structural change in a medium. For example, in medicine, lasers are often used in ablative techniques, where the temperature of the surrounding tissue needs to stay within a certain threshold [1]. Other techniques use laser heating to prevent thermal damage inherent in cryosurgery [2]. While lasers are often used in medicine due to their precision, other irradiative techniques are gaining prominence, such as microwave irradiation [3].

Myriad tools currently exist to simulate the optical distribution within a material, principally using the Beer–Lambert equation to directly determine optical distribution, or Monte-Carlo simulations to determine photon scattering and distribution [4,5]. No matter the method used, the optical distribution is then used to determine the thermal response of the material to the optical irradiation. These approaches to simulating the optical distribution critically neglect the temperature dependent nature of a material's optical properties.

Current simulation techniques use constant optical properties, often at room temperature, to determine the optical distribution within the material. While this may in practice be a reasonable approximation for materials that do not experience a large change in temperature, this limitation becomes important as thermal gradients become large. This is especially true in the case of a material which undergoes phase change.

Variable Optical Irradiation Distribution Simulation software (VOIDSim) was developed to simulate irradiative heating while using temperature-dependent optical and thermal properties. The software not only will determine the optical distribution within the material, but also will simulate the thermal response of the material to the irradiation. Furthermore, the software is robust enough to allow a variety of irradiative source geometries, temporal irradiative profiles, and an arbitrary system geometry.

The program is called Variable Optical Irradiation Distribution Simulation (VOIDSim). VOIDSim requires the user to define a simulation geometry using a series of CAD files (STL file format), with a single file corresponding to a single material in the simulation. The terminology represented in Fig. 1
                         will be referenced in this paper.

The “system” refers to all modeled solid bodies in the simulation, or rather, all physical domains wherein energy propagation is considered. The system is divided into domains, which share all properties (constant or variable), and at the outset are homogeneous. Each domain is defined as a collection of triangles which form its surface. Each domain is divided into a regular grid of cells (not shown in Fig. 1) with nodes at the center of each cell. Each cell has uniform homogeneous properties at each moment in time.

The program includes Monte Carlo photon tracing algorithms developed by Prahl et al. [4] and refined by Wang et al. [5]. As VOIDSim allows for arbitrary geometries (not limited to a single domain, or horizontal layers) it utilizes ray-tracing techniques to determine angles of incidence, specifically using the ray-triangle intersection algorithm developed by Moller and Trumbore [6]. The flow diagram for VOIDSim is shown below, in Fig. 2
                        .

Before the program can start, the user must provide the appropriate inputs into the program. VOIDSim provides a form-based user interface based on .NET Winforms. The user specifies all pertinent thermal and optical properties for each domain in the GUI. Variable properties are defined as look-up tables, with each data point requiring the temperature and property value. VOIDSim utilizes linear interpolation/extrapolation to retrieve properties based on current system temperatures. In the case of extrapolation, if a physically impossible property is derived (e.g. negative thermal conductivity) that property is set to its logical boundary (e.g. thermal conductivity equals zero). Once all required inputs are satisfied, the user may start the simulation.

In preprocessing, the program converts all user inputs to SI units (kilograms, meters, seconds, and Kelvin) to avoid any conversion errors. Memory is allocated for each node in the system, all constants are computed, and the initial system condition is recorded. For n photons “Photon Deposition” occurs, which determines the spatial distribution of a photon packet. Before the distribution can be calculated the photons must be initialized in their starting locations (“Photon Initialization”). Once Photon Deposition has concluded for n photons, “Heat Transfer” in the system is calculated for an incremented moment in time. The simulation time is updated, and the program returns to Photon Deposition if the update condition requires it, otherwise it proceeds with the next time step of Heat Transfer. Once the user-defined simulation time elapses, the simulation is complete.

The majority of the subroutines in Photon Deposition are similar to those found in MCML [5], for example. Where Photon Deposition majorly differs is its treatment of geometries (to allow for arbitrarily-shaped geometries) and how it incorporates variable optical properties.

Rather than immediately determining the distance a photon will move in a medium, based on the medium's total optical attenuation coefficient, a photon is first given Movement Energy, which is defined as the negative natural log of a random number, between zero and one. This is done to reduce calculations as well as to provide a way for a photon to move in a domain with non-constant optical coefficients.

VOIDSim allows arbitrary geometries, and does not rely on domain boundaries in any particular plane. To achieve this the photon is assigned to a particular domain, based on its location. Each domain has a set of triangles which define its surface. To determine where the nearest boundary of collision is, a ray-triangle intersection algorithm [6] is used for each of the triangles that belong to the photon's current domain. Exactly one triangle will be intersected by the ray defined by the photon's current location and direction. The distance to this triangle is calculated and used as the distance to the nearest boundary.

Determining the distance that a photon will move with a given movement energy must be done on a cell-to-cell basis when optical properties are permitted to vary. First the distance between a photon and its nearest boundary in its current direction is calculated. Then the index of the cell in which the photon is located is determined. The distance from the photon to the wall of the current cell is also calculated. Finally the total attenuation coefficient for the current cell is interpolated/extrapolated and the distance the photon can move with its current movement energy within the current cell is determined. The photon then moves the least of these three distances, leaving it in the middle of the cell, on the cell wall, or on the boundary wall. Its movement energy is appropriately discounted, and if any movement energy remains, the process is repeated until either no movement energy remains, or until the photon collides with the domain boundary.

To determine the amount of weight deposited, or the appropriate scatter angle, when variable optical properties are used, the local optical property must be determined. First, the photon location is translated into the index of the cell in which it currently resides. The temperature of this cell is then used to determine the absorption and scattering coefficients in the case of weight deposit, or the anisotropy of scattering in the case of getting the scatter angle.

Heat transfer is done by dividing the system into individual cells. At each node (the center of each cell) an energy balance based on the non-steady conservation of energy is used. Heat into each node is a summation of conductive heat energy (from surrounding cells), irradiation energy (from photon deposition), volumetric heating and perfusion (bioheat). Explicit finite difference heat transfer is then used to calculate the subsequent temperatures at each node.

Additionally each cell carries a fusion energy, related to its current physical state (frozen or thawed). In order for a cell to change temperature from a frozen to thawed state (or vice versa), the heat into each node is first used to provide/take the required fusion energy for the change in physical state. Any leftover heat is used to change the cell's temperature.

To validate the results that VOIDSim generates, VOIDSim results were compared to those of existing numerical solutions, as well as to fundamental laws. As there currently exists no simulation that can replicate the geometry and physics that VOIDSim uses, it becomes necessary to validate VOIDSim in a piecemeal fashion by comparing subsets of VOIDSim capabilities with existing solutions. This is done first using constant optical properties, and then with varying optical properties.

The algorithms in VOIDSim utilize the same underlying mathematical approximations to physical phenomena that several other existing Monte-Carlo based simulations use. As such, results from VOIDSim should be identical (within a statistical distribution) when identical properties and geometry are used with each simulation. The three test cases that Wang et al. [5] used for validation were also used to validate VOIDSim results. The first is a semi-infinite slab of material, with irradiation incident normal to its surface. 100 simulations of 50,000 photons each were run for VOIDSim, and the results averaged. The results are compared to various classic simulations in Table 1
                        .

As shown in Table 1 there is close agreement of the steady state reflectance for each of the studies shown. The relative error between VOIDSim results and to that of Giovanelli 0.48%. To determine the range of values that statistically represent a valid solution for 50,000 photons, 100 runs of 50,000 photons were simulated, and the results displayed in a histogram in Fig. 3
                        .

While the differences in solutions are not insignificant, all solutions are well within the expected distribution of solutions for Monte Carlo simulations. This analysis is not repeated as there is expected to be a similar distribution for all Monte Carlo based simulations.


                        Table 2
                         represents a simulation where the boundary condition (refractive index) is now matched with the external refractive index, and the slab is now thin enough (two optical depths thick) for irradiation to partially pass through. The irradiation is again normally incident upon the surface of the slab. There is an even closer alignment of the results from VOIDSim and those of the other simulations. The largest relative difference for reflection and transmission are 0.43% and 0.07%, respectively.

Finally there is the comparison to multiple stacked layers (Table 3
                        ) with irradiation normally incident upon the outside surface of the first layer. The largest relative errors for reflection and transmission are 0.29% and 2.36%, respectively.

For this validation, a system consisting of a single domain in the shape of a cube with sides of 1cm will be used. The simulated material is silicon, with variable optical properties as shown in Table 4
                        , from [10], and constant properties as shown in Table 5
                        .

For this simulation a collimated circular-profile laser with 0.5cm diameter and power of 70W will be directed toward the z
                        =0 surface of the cube. The cube will be irradiated continuously for 10s. Due to the high thermal diffusivity of silicon (91mm2
                        s−1) and small size of the system, the temperature of the system will be treated as homogenous, and a lumped-capacitance heating model may be used. The simulation evaluated using VOIDSim is compared to the Beer–Lambert law of absorption, shown in Eq. (1), where A is the absorption, μ
                        
                           a
                        (T) and μ
                        
                           s
                         are the absorption and scattering coefficients (μ
                        
                           a
                         being a function of temperature), respectively, and ℓ is the thickness of the material. R
                        
                           sp
                         is the specular reflection, and as this simulation uses matched boundary conditions (refractive index of system and external domain both equal one) it is equal to zero.

Beer–Lambert law for absorption:


                        
                           
                              (1)
                              
                                 
                                    A
                                    (
                                    T
                                    )
                                    =
                                    (
                                    1
                                    −
                                    
                                       R
                                       
                                          s
                                          p
                                       
                                    
                                    )
                                    (
                                    1
                                    −
                                    
                                       e
                                       
                                          −
                                          (
                                          
                                             μ
                                             a
                                          
                                          (
                                          T
                                          )
                                          +
                                          
                                             μ
                                             s
                                          
                                          )
                                          ℓ
                                       
                                    
                                    )
                                 
                              
                           
                        
                     

Once the absorption is known, then it can be multiplied by the energy into the system to determine the proceeding temperature. Eq. (2) represents the algorithm for determining the subsequent temperature of the system, where dT is the differential temperature, dt is the differential time, P is the laser power, ρ is the density of the material, V is the volume of the material, and c is the specific heat of the material.

Lumped-capacitance ODE:
                           
                              (2)
                              
                                 
                                    
                                       
                                          d
                                          T
                                       
                                       
                                          d
                                          t
                                       
                                    
                                    =
                                    
                                       
                                          A
                                          (
                                          T
                                          )
                                          P
                                       
                                       
                                          ρ
                                          V
                                          c
                                       
                                    
                                 
                              
                           
                        
                     

The Euler method, with a step size of 0.1s, is used to solve the ODE for both a constant absorption coefficient as well as an absorption coefficient that is continuously reevaluated based on the current temperature, utilizing linear interpolation of Table 4. As previously stated, VOIDSim divides each domain into a rectangular grid of cells to solve the finite difference heat transfer simulation and to incorporate variable optical properties. A cell size of 0.2cm on each side (x, y, and z) and a time step of 0.1s was used for this simulation.


                        Fig. 4
                         shows the temperatures of the silicon cube using both VOIDSim and the Beer–Lambert law. The difference between the methods shows a maximum relative error of 1.52% at any moment in time, which is likely due to the statistical error, first explored in Section 3.1.

While heat transfer is an integral part of VOIDSim, its validation is not exhaustively presented here. This brevity is due to the fact that the heat transfer algorithm that was used is not novel, and it has previously been successfully implemented in numerous applications in various programming languages.

The simulation whose results are presented in Fig. 4 shows a simple case of heat transfer in a model with very high thermal diffusivity. While the result demonstrates that the heat transfer model employed correlates well with fundamental laws (the lumped-capacitance ODE), a secondary heat transfer validation is presented here. The simulation will not include any optical irradiation, but will consider a case where there is a phase change from solid to liquid without convection. The results are compared to a COMSOL Model Gallery example (model 474 [11]). When considering phase change, the COMSOL simulation approximates the changes in properties and latent heat of fusion with step and Dirac delta functions, while VOIDSim uses step functions. This means that very near the transition temperature, between solid and liquid, COMSOL thermal properties will smoothly change, while those of VOIDSim change abruptly. While the treatments are not identical, they are sufficiently similar for comparison purposes.

The simulation geometry is a square rod of ice, 1cm in length, and initially at 253K. The cell size is 0.01cm, and the time step used was 1s. The far end of the rod (x
                        =1cm) is held at a constant 353K, and all other surfaces are thermally insulated, limiting heat transfer to one dimension. The properties use for the ice/water are listed in Table 6
                        .

The enthalpy of fusion used is 333,500J/kg. The same model was solved using both VOIDSim and COMSOL, first considering phase change physics, and once again while omitting the latent heat of fusion. The results of the simulations are shown in Fig. 5
                        .


                        Fig. 5 shows the thermal profile of the rod at three points in time. For the case where latent heat is ignored, a single thermal profile at 30s is shown, where there is a maximum discrepancy between solutions of 1°. The introduction of latent heat slows the temperature change of the ice rod with elbows at the transition temperature as expected, although there is slight disagreement between VOIDSim and COMSOL results which gets progressively worse as time goes on. At 30s, the maximum discrepancy at any point along the rod is 4.5°C. This discrepancy is likely due to the different ways in which VOIDSim and COMSOL treat property changes at the transition temperature, especially the latent heat. Furthermore the time step used by COMSOL varies, while that of VOIDSim remains constant. Even with this observed discrepancy there is sufficient evidence that VOIDSim does implement phase change simulation and heat transfer correctly and with reasonably good accuracy.

To demonstrate the benefit of using VOIDSim over current Monte Carlo photon propagation simulations, a simple representative simulation was done. While ideally the authors would prefer to present a biomedical simulation, there exist too many unknown parameters to perform such a simulation with any degree of certainty. Generally, there is very sparse information on the optical characteristics of tissues with respect to temperature, and these values would need to be first determined before any realistic simulation is to be performed. For this representative simulation a silicon cube is used, with identical geometry, properties, and parameters as previously described in Section 3.2. The refractive index of the silicon is changed from 1 to 3.5, and the laser power is changed to 80W. These parameters are similar to what might be seen in a real-world silicon machining process. Again the temperature of the cube is assumed to be isothermal. The simulation will be done for two cases. The first will represent a traditional analysis, assuming a constant absorption coefficient, using the value at room temperature. The second will utilize variable absorption coefficients. The center temperature of each simulation is plotted with respect to time, below in Fig. 6
                     .

@&#DISCUSSION AND CONCLUSION@&#

As exhibited by the small differences between results of VOIDSim and various established methods, VOIDSim can accurately simulate photon propagation. Furthermore, it has been demonstrated that VOIDSim has the ability to correct significant error that exists in a simulation where constant optical properties are assumed.

For the representative simulation shown in Fig. 6, both the VOIDSim and the Beer–Lambert law curves start heating at the same rate, as both absorb the same amount of incident irradiation initially. As the variable-property simulation (VOIDSim) heats up, however, the absorption coefficient also increases, leading to greater absorption and faster heating. The two curves diverge as the constant-property simulation (Beer–Lambert) will always absorb the same percentage of incoming irradiation, while the variable-property simulation absorbs nearly all available irradiation as it warms up.

There is a difference of over 100K between the two curves after 10s, and this difference will become larger as time goes on. While this temperature difference in a manufacturing process may be unimportant, small changes in temperature can be critical in the heating of biological materials. As a simulation does not currently exist that allows accurate prediction of system temperature where variable properties are used, the capabilities of VOIDSim become paramount in applications where optical properties vary with temperature.

Note that a major limitation of VOIDSim is its inability to simulate temperature-dependent indices of refraction. This limitation was intentionally included due to the high computational expense of determining the optical path due to continuously variable gradients in the index of refraction. Thus while domains may have indices that vary from each other, domains will always have a homogenous temperature-independent index of refraction. An additional limitation of VOIDSim is that it only considers solid and liquid phases of material, where the liquid phase is locked in place (no convection). This means that laser heating methods that avoid ablation may be accurately simulated. Both these limitations may be eliminated in future versions of VOIDSim software.

The main advantage of VOIDSim over open source Monte Carlo simulators is that it can accurately simulate photon absorption and the resulting heating and heat transfer in a feedback loop. This allows VOIDSim to include temperature information in determining the photon distribution, whereas no other simulation currently is able. As previously stated, this can result in large increases in accuracy over simulations that neglect this temperature dependence.

VOIDSim is currently available as a standalone windows desktop application. As previously noted, VOIDSim requires STL format CAD models to define its geometry. These models may be created within the program, or can imported from established solid modeling programs. All data entry and software options are set in a tabbed graphical user interface. Rudimentary data post processing and visualization is done within VOIDSim. Optionally, VOIDSim can automatically export data to third-party programs (i.e. MATLAB, SciLab, Excel) for advanced post processing and visualization. VOIDSim software can be installed in any computer running Microsoft Windows, and the speed of execution will be highly dependent upon processor speed and RAM. VOIDSim is currently available upon request from the authors.

VOIDSim was initially developed to simulate the thermal response of frozen tissue to laser heating. VOIDSim allows for the accurate depiction of photon transport in systems that undergo large changes in temperature, and hence, large changes in optical properties. Especially when considering living biological tissues, even small discrepancies in simulated temperatures can literally mean life and death. VOIDSim alleviates the discrepancies introduced by the assumption of constant optical properties, potentially leading to better experimental and clinical planning, and more favorable outcomes. Note that to enable the commencement of preclinical trials, a careful characterization of the optical properties of tissues with regard to temperature is required, as such data is currently very sparse in the literature.

No author has any conflict of interest to declare.

@&#ACKNOWLEDGEMENTS@&#

ABS acknowledges financial support from 2011 UC MEXUS Dissertation Research Grant.

@&#REFERENCES@&#

