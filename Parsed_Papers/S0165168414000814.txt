@&#MAIN-TITLE@&#Simultaneous localization and mapping in wireless sensor networks

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We propose an algorithm to solve the simultaneous localization and mapping problem in wireless sensor networks.


                        
                        
                           
                           We introduce a semiparametric statistical model to take random perturbations into account.


                        
                        
                           
                           The algorithm is based on a newly proposed online Expectation Maximization procedure and on sequential Monte Carlo methods.


                        
                        
                           
                           The performance of the algorithm is illustrated with both simulated data and a true data set.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Simultaneous localization and mapping

Indoor localization

Received signal strength indicator

Parameter estimation

Signal propagation

@&#ABSTRACT@&#


               
               
                  Mobile device localization in wireless sensor networks is a challenging task. It has already been addressed when the WiFi propagation maps of the access points are modeled deterministically or estimated using an offline human training calibration. However, these techniques do not take into account the environmental dynamics. In this paper, the maps are assumed to be made of an average indoor propagation model combined with a perturbation field which represents the influence of the environment. This perturbation field is embedded with a distribution describing the prior knowledge about the environmental influence. The device is localized with Sequential Monte Carlo methods and relies on the estimation of the propagation maps. This inference task is performed online, using the observations sequentially, with a new online Expectation Maximization based algorithm. The performance of the algorithm is illustrated with Monte Carlo experiments using both simulated data and a true data set.
               
            

@&#INTRODUCTION@&#

In this paper, we consider a WiFi communication network made up of a mobile device, a server and WiFi access points (AP). In this context, a key step to localize the mobile device is to estimate the WiFi signal strength at different positions in the environment. However, in an indoor environment, signals may experience complex attenuation such as shadowing or reflection.

Different techniques can be used to approximate the WiFi propagation map of each AP. In Gorce et al. [19], a deterministic model based on the characteristics of the surrounding AP and on the localization of the obstacles in the environment is introduced. In Bahl and Padmanabhan [2] and Evennou and Marx [16], a previous offline training phase is performed. In this site survey, the signal strength indicator (RSSI) received from different AP is measured at some previously determined positions. This allows us to build an accurate estimation of the signal strength, but only for a finite number of points. Ferris et al. [17] provide a method to extend these measures to the entire map using Gaussian processes techniques.

In this paper, we propose an estimation method that does not require any calibration procedure. The propagation maps are estimated online, without storing the observations, using the data sent by the mobile device. Any modification in the signal propagation (due to new obstacles for instance) affects the data sent by the mobile device. Then, while these changes deteriorate the accuracy of localization systems based on fixed estimators of the propagation maps, our estimation procedure takes them into account. Thus, as illustrated in Section 5.2, the accuracy of our localization method improves with time instead of degrading.

We use a semiparametric statistical model introduced in [15, Chapter 5]: the propagation maps are made of a parametric average indoor model and a nonparametric perturbation field. This model combines a prior knowledge on signal propagation with random perturbations due to the obstacles. Based on the data collected by the mobile device, the parameters and the perturbation field can be estimated. The proposed procedure relies on a new online Expectation Maximization (EM) based algorithm introduced in Le Corff and Fort [21,22] and on Sequential Monte Carlo methods. The device position can be simultaneously estimated using the weighted samples produced by the Sequential Monte Carlo method.

The structure of this paper is the following. Section 2 details the approach of the paper in comparison with other methods for localization and mapping in wireless sensor networks. Section 3 describes the model and defines the notations. Section 4 introduces our algorithm for the considered Simultaneous Localization and Mapping (SLAM) problem. Section 5 illustrates the performance of this algorithm with numerical experiments.

In a radio network field, the signal strength is measured by the RSS (received signal strength, in dBm). Each WiFi connected device can compute the RSS as it is needed to associate the device with the AP providing the best signal/noise ratio. Localization systems based on RSS measurements allow us to locate any WiFi connected device.
                           Remark 1
                           Different devices might have different methods to compute the RSS. It is common to use the terminology of RSSI (received signal strength indicator) expressed without unit to name the information on the signal level provided by a WiFi device. To overcome the issue of information disparity between WiFi connected devices, a previous RSSI to RSS conversion might be needed for each localized device. The conversion rule is specific to the device׳s WiFi card. For the sake of clarity, we assume in this paper that the mobile device׳s RSSI corresponds to the standard RSS.

Using RSS to estimate the position of the device is challenging. As represented in Fig. 1
                        , RSS is highly unstable as it fluctuates considerably between two consecutive measures at the same position. It is common to describe the RSS variations using a Gaussian representation.

Despite the instant variations of the RSS, its mean value strongly depends on the position of the device. The function that returns the expected RSS at each position is called the propagation map. In free spaces, signals propagate in straight line from the emitter to the receptor. The propagation maps are isotropic and can be described using few parameters, see Friis [18]. Therefore, there exist two parameters c and d such that the strength of a signal received at x and emitted at O is 
                           c
                           +
                           d
                           
                           log
                           (
                           ∥
                           x
                           −
                           O
                           ∥
                           )
                         where c and d depend on the network characteristics.

On the other hand, indoor propagation of WiFi signals is not isotropic. Fig. 2
                         represents the propagation map of a WiFi signal in an indoor environment. This figure was built deterministically by Gorce et al. [19] using the physical properties of electromagnetic signals.

Let X
                           
                              k
                            be the device position at time k. The received signal strength vector measured by the device, denoted by Y
                           
                              k
                           , is written as
                              
                                 (1)
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          k
                                       
                                    
                                    =
                                    
                                       
                                          F
                                       
                                       
                                          k
                                       
                                       
                                          ⋆
                                       
                                    
                                    (
                                    
                                       
                                          X
                                       
                                       
                                          k
                                       
                                    
                                    )
                                    +
                                    
                                       
                                          ϵ
                                       
                                       
                                          k
                                       
                                    
                                    .
                                 
                              
                           
                        

In the following, the superscript ⋆ is used to name the true value of every unknown parameter involved in the model. 
                              
                                 
                                    {
                                    
                                       
                                          ϵ
                                       
                                       
                                          k
                                       
                                    
                                    }
                                 
                                 
                                    k
                                    ≥
                                    0
                                 
                              
                            are i.i.d. multidimensional random variables with distribution 
                              N
                              (
                              0
                              ,
                              
                                 
                                    σ
                                 
                                 
                                    ⋆
                                    ,
                                    2
                                 
                              
                              Id
                              )
                            where Id is the identity matrix. Each component of 
                              
                                 
                                    F
                                 
                                 
                                    k
                                 
                                 
                                    ⋆
                                 
                              
                              (
                              x
                              )
                            represents the expected RSS at position x relative to an AP. The time dependency of 
                              
                                 
                                    F
                                 
                                 
                                    ⋆
                                 
                              
                            brings the environmental effects on the propagation maps into relief. The distribution of 
                              
                                 
                                    {
                                    
                                       
                                          ϵ
                                       
                                       
                                          k
                                       
                                    
                                    }
                                 
                                 
                                    k
                                    ≥
                                    0
                                 
                              
                            implies that the noise affecting the RSS of different AP are independent. This assumption is somehow strong, however, the correlation between the RSS of different AP can be hardly taken into account and can strongly depend on the environment configuration.

Indoor localization requires to overcome two challenges. One has to design a good approximation of 
                              
                                 
                                    F
                                 
                                 
                                    k
                                 
                                 
                                    ⋆
                                 
                              
                            and then to use this approximation to estimate the position X
                           
                              k
                            corresponding to a given measure Y
                           
                              k
                           .

The contribution of this paper is a new estimation procedure of the propagation maps. This new method is combined to a localization algorithm to highlight the relevance of our estimation procedure. Using our propagation maps estimator, many positioning algorithms may be considered. We do not address a comparison of the accuracy between our method and the state of art but a new way to improve indoor localization deployment at a large scale.


                           
                              
                                 
                                    F
                                 
                                 
                                    k
                                 
                                 
                                    ⋆
                                 
                              
                            can be approximated deterministically using physical properties (see [19,26]). Such constructions need a precise description of the environment such as the position and the composition of the walls and furniture present in the environment. They also need a fine knowledge about the different factors influencing signal propagation such as the humidity level in the environment. Without this precise description, the propagation maps built using deterministic methods may be far from reality.

Most of the existing WiFi based localization systems use a preliminary measurement campaign (offline) which is also called fingerprinting technique. A human operator performs a site survey by measuring the RSS from different AP at some fixed positions in the environment. This set of measures, associated with positions, can be directly stored in a database [2] to be used in the localization system as a reference. These measures can also be extrapolated to the entire map using kriging methods such as in Ferris et al. [17]. Users must compile a fairly dense radio map comprising many RSS measurements at many sampled points to attain reasonable positioning accuracy. Moreover, these methods suppose that the propagation maps remain constant which, with our notation, means that the propagation function 
                              
                                 
                                    F
                                 
                                 
                                    ⋆
                                 
                              
                            does not depend on time. The measurement campaign can be seen as an instant “photograph” of the propagation map and has to be regularly performed in order to maintain the accuracy of the system. These problems have particularly been spotted by Chen et al. [9] and Madigan et al. [24]. Chen et al. [9] introduce RFID sensors in the environment to perform passive site survey. Madigan et al. [24] use a hierarchical Bayesian model to localize the mobile without site survey but rely on isotropic propagation maps which might lead to a bad estimation in complex indoor environments (although they study a more elaborate model that includes “corridors effects”).

In this paper, we present a new estimation procedure of the propagation maps which does not involve any measurement campaign or additional sensors. The considered model does not assume any knowledge on the environment apart from the position of the AP. The propagation maps are estimated using an online Expectation Maximization (EM) based algorithm using the RSS measurements collected by the device. A similar approach can be found in Chai and Yang [8] which uses the classical EM algorithm to refine the propagation maps estimators obtained using a preliminary site survey. The first substantial benefit of our method concerns its ability to be implemented in any building. Moreover, unlike fingerprinting based methods, the precision of our localization system does not degrade with time as each measure Y
                           
                              k
                            is used to improve the propagation maps estimators. The computation of the estimators requires sufficient statistics. These statistics summarize the information contained in all the past measures since they were last reset. If there are regular environmental modifications that strongly affect the WiFi propagation, regularly resetting these sufficient statistics is enough to improve the estimation. Then, our system is more robust than site survey based methods using static propagation maps estimators.

Once the expected RSS has been estimated for the whole map or for some fixed positions, the device can be localized. Bahl and Padmanabhan [2] use the nearest neighbor algorithm. With this algorithm, the strong variability of the RSS leads to a very unstable localization. We use particle filtering to track the mobile device. Such filters have already been used by Ferris et al. [17] in a similar way. Evennou and Marx [16] introduce particle filtering on the Voronoi diagram. Such filters provide a much more stable sequence of positions despite the high variability of the data.
                              Remark 2
                              There is no chance to identify 
                                    
                                       
                                          {
                                          
                                             
                                                F
                                             
                                             
                                                k
                                             
                                             
                                                ⋆
                                             
                                          
                                          }
                                       
                                       
                                          k
                                          ≥
                                          0
                                       
                                    
                                  with the observations 
                                    
                                       
                                          {
                                          
                                             
                                                Y
                                             
                                             
                                                k
                                             
                                          
                                          }
                                       
                                       
                                          k
                                          ≥
                                          0
                                       
                                    
                                  only. In the next section, we omit the time dependency of 
                                    
                                       
                                          F
                                       
                                       
                                          ⋆
                                       
                                    
                                  which might seem contradictory with our introduction. However, as stated in the above section, regularly resetting the sufficient statistics allows us to adapt the algorithm to environmental changes.

Let X
                     
                        k
                      be the cartesian coordinates of the mobile device at time k in a two-dimensional compact space. This compact space represents the map of the one-floor building where the localization is performed. This continuous environment is discretized into a finite grid map, denoted by 
                        C
                     . It is assumed that 
                        
                           
                              {
                              
                                 
                                    X
                                 
                                 
                                    k
                                 
                              
                              }
                           
                           
                              k
                              ≥
                              1
                           
                        
                      is a Markov chain taking values in 
                        C
                      with initial distribution ν and Markov transition matrix given, for all 
                        (
                        x
                        ,
                        x
                        ′
                        )
                        ∈
                        
                           
                              C
                           
                           
                              2
                           
                        
                     , by
                        
                           (2)
                           
                              q
                              (
                              x
                              ,
                              x
                              ′
                              )
                              ∝
                              
                                 
                                    e
                                 
                                 
                                    −
                                    ∥
                                    x
                                    −
                                    x
                                    ′
                                    
                                       
                                          ∥
                                       
                                       
                                          2
                                       
                                    
                                    /
                                    a
                                 
                              
                              ,
                           
                        
                     where 
                        ∥
                        ·
                        ∥
                      denotes the usual euclidean norm in 
                        
                           
                              R
                           
                           
                              2
                           
                        
                      (the associated inner product is denoted by 
                        〈
                        ·
                        ,
                        ·
                        〉
                     ). 
                        a
                        ∈
                        
                           
                              R
                           
                           
                              +
                           
                           
                              ⋆
                           
                        
                      depends on the average speed of the mobile and is assumed to be known. Therefore, the initial state X
                     0 is distributed according to ν and, for any 
                        k
                        ≥
                        1
                      and any 
                        x
                        ∈
                        C
                     , given 
                        
                           
                              X
                           
                           
                              k
                           
                        
                        =
                        x
                     , 
                        
                           
                              X
                           
                           
                              k
                              +
                              1
                           
                        
                        =
                        x
                        ′
                      with probability 
                        q
                        (
                        x
                        ,
                        x
                        ′
                        )
                     .

Let B be the number of AP and 
                        |
                        C
                        |
                      be the cardinality of 
                        C
                     . In the sequel, for any 
                        B
                        ×
                        
                           
                              R
                           
                           
                              |
                              C
                              |
                           
                        
                      matrix A, we use the shorthand notation A
                     
                        j
                      for the vector 
                        
                           
                              {
                              
                                 
                                    A
                                 
                                 
                                    j
                                    ,
                                    x
                                 
                              
                              }
                           
                           
                              x
                              ∈
                              C
                           
                        
                      and A
                     
                        j
                     
                     2 for the vector 
                        
                           
                              {
                              
                                 
                                    A
                                 
                                 
                                    j
                                    ,
                                    x
                                 
                                 
                                    2
                                 
                              
                              }
                           
                           
                              x
                              ∈
                              C
                           
                        
                     . At each time step 
                        k
                        ≥
                        1
                      and for each 
                        j
                        ∈
                        {
                        1
                        ,
                        …
                        ,
                        B
                        }
                     , the mobile device measures and sends to the server the observation 
                        
                           
                              Y
                           
                           
                              k
                              ,
                              j
                           
                        
                      given by
                        
                           (3)
                           
                              
                                 
                                    Y
                                 
                                 
                                    k
                                    ,
                                    j
                                 
                              
                              
                                 
                                    =
                                 
                                 
                                    def
                                 
                              
                              
                                 
                                    μ
                                 
                                 
                                    j
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    ⋆
                                 
                              
                              +
                              
                                 
                                    δ
                                 
                                 
                                    j
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    ⋆
                                 
                              
                              +
                              
                                 
                                    ε
                                 
                                 
                                    k
                                    ,
                                    j
                                 
                              
                              ,
                           
                        
                     where
                        
                           •
                           
                              
                                 
                                    
                                       μ
                                    
                                    
                                       j
                                       ,
                                       x
                                    
                                    
                                       ⋆
                                    
                                 
                               is the j-th average indoor propagation term at position x. For all 
                                 x
                                 ∈
                                 C
                               and all 
                                 j
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 B
                                 }
                              , 
                                 
                                    
                                       μ
                                    
                                    
                                       j
                                       ,
                                       x
                                    
                                    
                                       ⋆
                                    
                                 
                               only depends on the distance between x and O
                              
                                 j
                               where O
                              
                                 j
                               is the known position of the j-th AP. In the sequel, we use the so-called Friis transmission equation given by Friis [18]:
                                 
                                    (4)
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             j
                                             ,
                                             x
                                          
                                          
                                             ⋆
                                          
                                       
                                       
                                          
                                             =
                                          
                                          
                                             def
                                          
                                       
                                       
                                          
                                             c
                                          
                                          
                                             j
                                          
                                          
                                             ⋆
                                          
                                       
                                       +
                                       
                                          
                                             d
                                          
                                          
                                             j
                                          
                                          
                                             ⋆
                                          
                                       
                                       
                                       log
                                       ∥
                                       x
                                       −
                                       
                                          
                                             O
                                          
                                          
                                             j
                                          
                                       
                                       ∥
                                       ,
                                    
                                 
                              where 
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                    
                                       ⋆
                                    
                                 
                               and 
                                 
                                    
                                       d
                                    
                                    
                                       j
                                    
                                    
                                       ⋆
                                    
                                 
                               are parameters depending on the environment and where 
                                 log
                               is the logarithm to the base e.


                              
                                 
                                    
                                       δ
                                    
                                    
                                       j
                                    
                                    
                                       ⋆
                                    
                                 
                               is an additive term due to random perturbations. A similar model of WiFi propagation maps using Gaussian processes can be found in Ferris et al. [17]. It is assumed that the parameters 
                                 
                                    
                                       {
                                       
                                          
                                             δ
                                          
                                          
                                             j
                                          
                                          
                                             ⋆
                                          
                                       
                                       }
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       B
                                    
                                 
                               are embedded with the prior distribution π given, for any 
                                 δ
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       B
                                       |
                                       C
                                       |
                                    
                                 
                              , by 
                                 
                                    
                                       π
                                       (
                                       δ
                                       )
                                       ∝
                                       exp
                                       {
                                       
                                          −
                                          
                                             
                                                1
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                B
                                             
                                          
                                          
                                             
                                                δ
                                             
                                             
                                                j
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                Σ
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                δ
                                             
                                             
                                                j
                                             
                                          
                                       
                                       }
                                       ,
                                    
                                 
                              where for any matrix A, 
                                 
                                    
                                       A
                                    
                                    
                                       T
                                    
                                 
                               is the transpose of A and where 
                                 Σ
                               is assumed to be known.


                              
                                 
                                    
                                       {
                                       
                                          
                                             ε
                                          
                                          
                                             k
                                          
                                       
                                       }
                                    
                                    
                                       k
                                       ≥
                                       0
                                    
                                 
                               is a sequence of i.i.d Gaussian random vectors in 
                                 
                                    
                                       R
                                    
                                    
                                       B
                                    
                                 
                              , independent of 
                                 
                                    
                                       {
                                       
                                          
                                             X
                                          
                                          
                                             k
                                          
                                       
                                       }
                                    
                                    
                                       k
                                       ≥
                                       1
                                    
                                 
                              , with mean 0 and covariance matrix 
                                 
                                    
                                       σ
                                    
                                    
                                       ⋆
                                       ,
                                       2
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       B
                                    
                                 
                              , where I
                              
                                 B
                               is the identity matrix of size B×B.


                     
                        
                           
                              F
                           
                           
                              j
                           
                           
                              ⋆
                           
                        
                        
                           
                              =
                           
                           
                              def
                           
                        
                        
                           
                              μ
                           
                           
                              j
                           
                           
                              ⋆
                           
                        
                        +
                        
                           
                              δ
                           
                           
                              j
                           
                           
                              ⋆
                           
                        
                      will be referred to as the true propagation map of the j-th AP and 
                        
                           
                              F
                           
                           
                              ⋆
                           
                        
                        
                           
                              =
                           
                           
                              def
                           
                        
                        
                           
                              {
                              
                                 
                                    F
                                 
                                 
                                    j
                                 
                                 
                                    ⋆
                                 
                              
                              }
                           
                           
                              j
                              =
                              1
                           
                           
                              B
                           
                        
                      as the true propagation maps. Fig. 3
                      displays a realization of 
                        
                           
                              δ
                           
                           
                              j
                           
                           
                              ⋆
                           
                        
                      (sampled from π) and the functions 
                        
                           
                              μ
                           
                           
                              j
                           
                           
                              ⋆
                           
                        
                      and 
                        
                           
                              F
                           
                           
                              j
                           
                           
                              ⋆
                           
                        
                     , defined on the grid 
                        C
                        =
                        {
                        0
                        ,
                        …
                        ,
                        30
                        }
                        ×
                        {
                        0
                        ,
                        …
                        ,
                        30
                        }
                     . The parameters used in this figure are 
                        
                           
                              O
                           
                           
                              j
                           
                        
                        =
                        (
                        15
                        ,
                        15
                        )
                     , and 
                        
                           
                              c
                           
                           
                              j
                           
                           
                              ⋆
                           
                        
                     , 
                        
                           
                              d
                           
                           
                              j
                           
                           
                              ⋆
                           
                        
                      and 
                        Σ
                      are given in Section 5. In the sequel, we write 
                        
                           
                              
                                 
                                    θ
                                 
                                 
                                    ⋆
                                 
                              
                              
                                 
                                    =
                                 
                                 
                                    def
                                 
                              
                              (
                              
                                 
                                    c
                                 
                                 
                                    ⋆
                                 
                              
                              ,
                              
                              
                                 
                                    d
                                 
                                 
                                    ⋆
                                 
                              
                              ,
                              
                              
                                 
                                    δ
                                 
                                 
                                    ⋆
                                 
                              
                              ,
                              
                              
                                 
                                    σ
                                 
                                 
                                    ⋆
                                    ,
                                    2
                                 
                              
                              )
                              ,
                           
                        
                     where 
                        
                           
                              
                                 
                                    c
                                 
                                 
                                    ⋆
                                 
                              
                              
                                 
                                    =
                                 
                                 
                                    def
                                 
                              
                              
                                 
                                    {
                                    
                                       
                                          c
                                       
                                       
                                          j
                                       
                                       
                                          ⋆
                                       
                                    
                                    }
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    B
                                 
                              
                              ,
                              
                              
                                 
                                    d
                                 
                                 
                                    ⋆
                                 
                              
                              
                                 
                                    =
                                 
                                 
                                    def
                                 
                              
                              
                                 
                                    {
                                    
                                       
                                          d
                                       
                                       
                                          j
                                       
                                       
                                          ⋆
                                       
                                    
                                    }
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    B
                                 
                              
                              
                              and
                              
                              
                                 
                                    δ
                                 
                                 
                                    ⋆
                                 
                              
                              
                                 
                                    =
                                 
                                 
                                    def
                                 
                              
                              
                                 
                                    {
                                    
                                       
                                          δ
                                       
                                       
                                          j
                                       
                                       
                                          ⋆
                                       
                                    
                                    }
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    B
                                 
                              
                              .
                           
                        
                     For any 
                        x
                        ∈
                        C
                      and any 
                        k
                        ≥
                        1
                     , the distribution of Y
                     
                        k
                      conditionally to 
                        
                           
                              X
                           
                           
                              k
                           
                        
                        =
                        x
                      has a density with respect to the Lebesgue measure on 
                        
                           
                              R
                           
                           
                              B
                           
                        
                      given by 
                        
                           
                              g
                           
                           
                              
                                 
                                    θ
                                 
                                 
                                    ⋆
                                 
                              
                           
                        
                        (
                        x
                        ,
                        
                           
                              Y
                           
                           
                              k
                           
                        
                        )
                     , where, for all 
                        y
                        
                           
                              =
                           
                           
                              def
                           
                        
                        (
                        
                           
                              y
                           
                           
                              1
                           
                        
                        ,
                        …
                        ,
                        
                           
                              y
                           
                           
                              B
                           
                        
                        )
                        ∈
                        
                           
                              R
                           
                           
                              B
                           
                        
                     , 
                        
                           
                              
                                 
                                    g
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          ⋆
                                       
                                    
                                 
                              
                              (
                              x
                              ,
                              y
                              )
                              
                                 
                                    =
                                 
                                 
                                    def
                                 
                              
                              
                                 
                                    (
                                    2
                                    π
                                    
                                       
                                          σ
                                       
                                       
                                          ⋆
                                          ,
                                          2
                                       
                                    
                                    )
                                 
                                 
                                    −
                                    B
                                    /
                                    2
                                 
                              
                              
                                 
                                    ∏
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    B
                                 
                              
                              
                              exp
                              {
                              
                                 −
                                 
                                    
                                       |
                                       
                                          
                                             y
                                          
                                          
                                             j
                                          
                                       
                                       −
                                       
                                          
                                             F
                                          
                                          
                                             j
                                             ,
                                             x
                                          
                                          
                                             ⋆
                                          
                                       
                                       
                                          
                                             |
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             σ
                                          
                                          
                                             ⋆
                                             ,
                                             2
                                          
                                       
                                    
                                 
                              
                              }
                              .
                           
                        
                     In the sequel, we aim at simultaneously estimating the device position and 
                        
                           
                              θ
                           
                           
                              ⋆
                           
                        
                      using the observations 
                        
                           
                              {
                              
                                 
                                    Y
                                 
                                 
                                    k
                                 
                              
                              }
                           
                           
                              k
                              ≥
                              1
                           
                        
                     . For any positive integer n, any observation set 
                        (
                        
                           
                              y
                           
                           
                              1
                           
                        
                        ,
                        …
                        ,
                        
                           
                              y
                           
                           
                              n
                           
                        
                        )
                      shortly denoted by 
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                     , and any parameter 
                        θ
                        =
                        (
                        c
                        ,
                        d
                        ,
                        δ
                        ,
                        
                           
                              σ
                           
                           
                              2
                           
                        
                        )
                     , the likelihood of the observations 
                        
                           
                              y
                           
                           
                              1
                              :
                              n
                           
                        
                      is given by 
                        
                           
                              
                                 
                                    L
                                 
                                 
                                    θ
                                 
                              
                              (
                              
                                 
                                    y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              )
                              
                                 
                                    =
                                 
                                 
                                    def
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    
                                       
                                          x
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    ∈
                                    
                                       
                                          C
                                       
                                       
                                          n
                                       
                                    
                                 
                              
                              ν
                              (
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              )
                              
                                 
                                    g
                                 
                                 
                                    θ
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    1
                                 
                              
                              )
                              
                                 
                                    ∏
                                 
                                 
                                    k
                                    =
                                    2
                                 
                                 
                                    n
                                 
                              
                              q
                              (
                              
                                 
                                    x
                                 
                                 
                                    k
                                    −
                                    1
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                              )
                              
                                 
                                    g
                                 
                                 
                                    θ
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    k
                                 
                              
                              )
                              .
                           
                        
                     Let n be a positive integer and 
                        
                           
                              Y
                           
                           
                              1
                              :
                              n
                           
                        
                      be a set of observations. The estimator of 
                        
                           
                              θ
                           
                           
                              ⋆
                           
                        
                      is set as one maximizer of the function:
                        
                           (5)
                           
                              θ
                              =
                              (
                              c
                              ,
                              d
                              ,
                              δ
                              ,
                              
                                 
                                    σ
                                 
                                 
                                    2
                                 
                              
                              )
                              ↦
                              
                                 
                                    n
                                 
                                 
                                    −
                                    1
                                 
                              
                              [
                              log
                              
                              
                                 
                                    L
                                 
                                 
                                    θ
                                 
                              
                              (
                              
                                 
                                    Y
                                 
                                 
                                    1
                                    :
                                    n
                                 
                              
                              )
                              +
                              log
                              
                              π
                              (
                              δ
                              )
                              ]
                              .
                           
                        
                     
                  

The EM algorithm is a well-known iterative algorithm to perform maximum likelihood estimation in hidden Markov models [13]. An EM based algorithm can be introduced to maximize (5). Each iteration of this algorithm is decomposed into an E-step where the expectation of the complete data log-likelihood (log of the joint distribution of the states and the observations) conditionally on the observations is computed; and a M-step which updates the parameter estimate. Let 
                           
                              
                                 Y
                              
                              
                                 1
                                 :
                                 n
                              
                           
                         be a fixed set of observations and θ
                        
                           i
                         be the current map estimate.
                           
                              (i)
                              The E-step amounts to computing the conditional expectation
                                    
                                       (6)
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                Y
                                             
                                             
                                                1
                                                :
                                                n
                                             
                                          
                                          ;
                                          θ
                                          )
                                          =
                                          
                                             
                                                E
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                             
                                          
                                          [
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   n
                                                
                                             
                                             
                                             log
                                             
                                             
                                                
                                                   p
                                                
                                                
                                                   θ
                                                
                                             
                                             (
                                             
                                                
                                                   X
                                                
                                                
                                                   1
                                                   :
                                                   n
                                                
                                             
                                             ,
                                             
                                                
                                                   Y
                                                
                                                
                                                   1
                                                   :
                                                   n
                                                
                                             
                                             )
                                             |
                                             
                                                
                                                   Y
                                                
                                                
                                                   1
                                                   :
                                                   n
                                                
                                             
                                          
                                          ]
                                          ,
                                       
                                    
                                 where 
                                    log
                                    
                                    
                                       
                                          p
                                       
                                       
                                          θ
                                       
                                    
                                    (
                                    
                                       
                                          X
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    ,
                                    
                                       
                                          Y
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    )
                                  is the complete data log-likelihood and 
                                    
                                       
                                          E
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                    
                                    [
                                    ·
                                    |
                                    
                                       
                                          Y
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    ]
                                  is the conditional expectation given 
                                    
                                       
                                          Y
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                  when the map is θ
                                 
                                    i
                                 .

The M-step computes the new value θ
                                 
                                    i+1 by choosing one of the maps θ maximizing 
                                    
                                       
                                          θ
                                          =
                                          (
                                          c
                                          ,
                                          d
                                          ,
                                          δ
                                          ,
                                          
                                             
                                                σ
                                             
                                             
                                                2
                                             
                                          
                                          )
                                          ↦
                                          
                                             
                                                Q
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                Y
                                             
                                             
                                                1
                                                :
                                                n
                                             
                                          
                                          ;
                                          θ
                                          )
                                          +
                                          
                                             
                                                n
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                          log
                                          
                                          π
                                          (
                                          δ
                                          )
                                          .
                                       
                                    
                                 
                              

Map update. 
                                 
                                    
                                       
                                       
                                          
                                             
                                                Require: 
                                                n, 
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                , 
                                                   
                                                      
                                                         {
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               2
                                                               ,
                                                               j
                                                            
                                                         
                                                         }
                                                      
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         B
                                                      
                                                   
                                                , 
                                                   
                                                      
                                                         {
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               3
                                                               ,
                                                               j
                                                            
                                                         
                                                         }
                                                      
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         B
                                                      
                                                   
                                                .
                                          
                                          
                                             1: Computation of intermediate quantities
                                             
                                          
                                          
                                             2: for 
                                                j=1 to B 
                                                do
                                             
                                          
                                          
                                             3: 
                                                for 
                                                
                                                   x
                                                   ∈
                                                   C
                                                 
                                                do
                                             
                                          
                                          
                                             4: 
                                                
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         j
                                                         ,
                                                         x
                                                      
                                                   
                                                   =
                                                   log
                                                   ∥
                                                   x
                                                   −
                                                   
                                                      
                                                         O
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∥
                                                .
                                          
                                          
                                             5: 
                                                end for
                                             
                                          
                                          
                                             6: 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         0
                                                         ,
                                                         j
                                                      
                                                   
                                                   =
                                                   diag
                                                   (
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   +
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  σ
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                         
                                                            n
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         Σ
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                .
                                          
                                          
                                             7: 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         1
                                                         ,
                                                         j
                                                      
                                                   
                                                   =
                                                   diag
                                                   (
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   [
                                                   
                                                      
                                                         I
                                                      
                                                      
                                                         |
                                                         C
                                                         |
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         0
                                                         ,
                                                         j
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                   diag
                                                   (
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   ]
                                                .
                                          
                                          
                                             8: 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         I
                                                      
                                                      
                                                         |
                                                         C
                                                         |
                                                      
                                                   
                                                   −
                                                   diag
                                                   (
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         0
                                                         ,
                                                         j
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                .
                                          
                                          
                                             9: 
                                                
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         1
                                                         ,
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         1
                                                         ,
                                                         j
                                                      
                                                   
                                                   1
                                                .
                                          
                                          
                                             10: 
                                                
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         1
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                .
                                          
                                          
                                             11: 
                                                
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         3
                                                         ,
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         j
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         1
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                .
                                          
                                          
                                             12: 
                                                
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         1
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         4
                                                         ,
                                                         j
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                .
                                          
                                          
                                             13: end for
                                             
                                          
                                          
                                             14: Parameter update
                                             
                                          
                                          
                                             15: for 
                                                j=1 to B 
                                                do
                                             
                                          
                                          
                                             16: 
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         j
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   [
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         3
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         j
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   ]
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                .
                                          
                                          
                                             17: 
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         j
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   [
                                                   −
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         1
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         j
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   ]
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                .
                                          
                                          
                                             18: 
                                                
                                                   
                                                      
                                                         δ
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         0
                                                         ,
                                                         j
                                                      
                                                   
                                                   [
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                   
                                                   −
                                                   diag
                                                   (
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   (
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   1
                                                   +
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                   ]
                                                .
                                          
                                          
                                             19: 
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   1
                                                   +
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         D
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         δ
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                .
                                          
                                          
                                             20:
                                                
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         B
                                                      
                                                   
                                                   {
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         j
                                                      
                                                      
                                                         
                                                            
                                                            
                                                               T
                                                            
                                                         
                                                      
                                                   
                                                   
                                                   diag
                                                   (
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   −
                                                   2
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         2
                                                         ,
                                                         j
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         S
                                                      
                                                      
                                                         3
                                                         ,
                                                         j
                                                      
                                                   
                                                   }
                                                .
                                          
                                          
                                             21: end for
                                             
                                          
                                          
                                             22: return 
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   =
                                                   (
                                                   c
                                                   ,
                                                   d
                                                   ,
                                                   δ
                                                   ,
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   )
                                                .
                                          
                                       
                                    
                                 
                              
                           

This two step process can be repeated until the likelihood does not improve significantly. However, when the observations are obtained sequentially, this algorithm does not produce a new estimate as new observations are received. The mobile device localization requires an online method which does not store the data and which frequently updates the propagation maps.

Online variants of the EM algorithm have been proposed to obtain map estimates each time a new observation is available. In the case of i.i.d. observations, Cappé and Moulines [6] proposed the first EM based online algorithm. This algorithm replaces the exact computation of the sufficient statistics 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                        , 
                           
                              
                                 S
                              
                              
                                 2
                                 ,
                                 j
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 3
                                 ,
                                 j
                              
                           
                         by a stochastic approximation step. In the case of hidden Markov models, when both the observations and the states take a finite number of values (resp. when the state-space is finite) an online EM-based algorithm was proposed by Mongillo and Denève [25] (resp. by [5]). These algorithms combine an online approximation of the filtering distributions of the hidden states and a stochastic approximation step to compute an online approximation of the sufficient statistics. This has been extended to the case of general state-space models with Sequential Monte Carlo algorithms in Cappé [4], Del Moral et al. [12] and Le Corff et al. [23]. More recently, Le Corff and Fort [21,22] proposed the Block Online EM (BOEM) algorithm in which the estimate is kept fixed as block of observations is received and is updated at the end of each block. See also Andrieu et al. [1] for an overview of online estimation procedures using Sequential Monte Carlo methods.

This paper introduces an EM algorithm for online localization in wireless sensor networks based on the algorithm introduced in Le Corff and Fort [21,22]. Let 
                           
                              
                                 {
                                 
                                    
                                       τ
                                    
                                    
                                       k
                                    
                                 
                                 }
                              
                              
                                 k
                                 ≥
                                 1
                              
                           
                         be a sequence of block-sizes and define 
                           
                              
                                 T
                              
                              
                                 0
                              
                           
                           
                              
                                 =
                              
                              
                                 def
                              
                           
                           0
                         and, for any 
                           k
                           ≥
                           1
                        , 
                           
                              
                                 T
                              
                              
                                 k
                              
                           
                           
                              
                                 =
                              
                              
                                 def
                              
                           
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 k
                              
                           
                           
                              
                                 τ
                              
                              
                                 i
                              
                           
                        . Within each block of observations 
                           
                              
                                 Y
                              
                              
                                 k
                              
                           
                           
                              
                                 =
                              
                              
                                 def
                              
                           
                           
                              
                                 Y
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 1
                                 :
                                 
                                    
                                       T
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                           
                        , the estimate θ
                        
                           k
                         is kept fixed and the sufficient statistics 
                           
                              
                                 S
                              
                              
                                 1
                              
                              
                                 k
                              
                           
                        , 
                           
                              
                                 S
                              
                              
                                 2
                                 ,
                                 j
                              
                              
                                 k
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 3
                                 ,
                                 j
                              
                              
                                 k
                              
                           
                         are computed sequentially using the current estimate θ
                        
                           k
                        , the observations 
                           
                              
                                 Y
                              
                              
                                 k
                              
                           
                         and τ
                        
                           k+1 as the number of observations. The superscript k indicates which observations are used in the definition of the statistics. The next parameter estimate θ
                        
                           k+1 is computed when the last observation 
                           
                              
                                 Y
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                           
                         is received using Algorithm 1.

Unlike in the traditional EM algorithm where the sufficient statistics are computed using forward–backward techniques, Cappé [5], Del Moral et al. [12] and Le Corff and Fort [22] proposed to compute the sufficient statistics recursively (i.e. as the observations are received and without any storage). In general state-space hidden Markov models, these online computations are not available in closed form (except in simple models such as linear Gaussian models) and have to be approximated, e.g. using sequential Monte Carlo methods [4,12]. For finite state-space hidden Markov models, the computations can be performed in theory but are computationally too expensive if the number of states is too large (which is the case in our localization framework, see Section 5). Therefore, sequential Monte Carlo methods are used in this paper to localize the mobile.

In this case, the filtering distribution ϕ
                        
                           t
                        
                        
                           k
                         on the block k, i.e the distribution of 
                           
                              
                                 X
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 t
                              
                           
                         given 
                           
                              
                                 Y
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 1
                                 :
                                 
                                    
                                       T
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 t
                              
                           
                         and 
                           
                              
                                 X
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       k
                                    
                                 
                              
                           
                           ~
                           ν
                        , is approximated by weighted particles 
                           
                              
                                 {
                                 (
                                 
                                    
                                       ξ
                                    
                                    
                                       
                                          
                                             T
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       ω
                                    
                                    
                                       
                                          
                                             T
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 }
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 N
                              
                           
                         such that 
                           
                              
                                 
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       t
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 x
                                 )
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       ω
                                    
                                    
                                       
                                          
                                             T
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       δ
                                    
                                    
                                       
                                          
                                             ξ
                                          
                                          
                                             
                                                
                                                   T
                                                
                                                
                                                   k
                                                
                                             
                                             +
                                             t
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 (
                                 x
                                 )
                                 ,
                              
                           
                        where 
                           
                              
                                 δ
                              
                              
                                 
                                    
                                       ξ
                                    
                                    
                                       
                                          
                                             T
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       t
                                    
                                    
                                       i
                                    
                                 
                              
                           
                         denotes the Dirac distribution at position 
                           
                              
                                 ξ
                              
                              
                                 
                                    
                                       T
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 t
                              
                              
                                 i
                              
                           
                        . For all 
                           k
                           ≥
                           0
                         and 
                           t
                           ∈
                           {
                           1
                           ,
                           …
                           ,
                           
                              
                                 τ
                              
                              
                                 k
                                 +
                                 1
                              
                           
                           }
                        , 
                           
                              
                                 {
                                 
                                    
                                       ξ
                                    
                                    
                                       
                                          
                                             T
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 }
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 N
                              
                           
                         is a set of possible mobile positions at time 
                           
                              
                                 T
                              
                              
                                 k
                              
                           
                           +
                           t
                        . At each time step, the new population of particles is built from the previous population using the bootstrap filter, see Gordon et al. [20]. The Bootstrap filter combines sequential importance sampling and resampling steps to produce this set of random particles with associated importance weights. Implementations of such procedures are detailed in Cappé [3], Del Moral [11], Cappé et al. [7], and Doucet and Johansen [14].


                        Online map estimation: We describe here the online approximation on the block 
                           
                              
                                 Y
                              
                              
                                 k
                              
                           
                         of the statistic 
                           
                              
                                 S
                              
                              
                                 1
                              
                              
                                 k
                              
                           
                         which is used to compute the map estimate θ
                        
                           k+1 when 
                           
                              
                                 T
                              
                              
                                 k
                                 +
                                 1
                              
                           
                         is received. The computations for 
                           
                              
                                 S
                              
                              
                                 2
                                 ,
                                 j
                              
                              
                                 k
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 3
                                 ,
                                 j
                              
                              
                                 k
                              
                           
                         follow the same lines. The rationale to establish this online approximation can be found in Del Moral et al. [12]. The first particles ξ
                        0
                        
                           i
                        , 
                           i
                           ∈
                           {
                           1
                           ,
                           …
                           ,
                           N
                           }
                        , are sampled uniformly in 
                           C
                         and the first weights are set as 
                           
                              
                                 ω
                              
                              
                                 0
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 N
                              
                              
                                 −
                                 1
                              
                           
                        , 
                           i
                           ∈
                           {
                           1
                           ,
                           …
                           ,
                           N
                           }
                        :
                           
                              (i)
                              Set 
                                    
                                       
                                          ρ
                                       
                                       
                                          
                                             
                                                T
                                             
                                             
                                                k
                                             
                                          
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    0
                                  for all 
                                    i
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    N
                                    }
                                 .

For all 
                                    t
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          τ
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    }
                                  repeat
                                    
                                       (a)
                                       For all 
                                             i
                                             ∈
                                             {
                                             1
                                             ,
                                             …
                                             ,
                                             N
                                             }
                                          ,
                                             
                                                
                                                   
                                                      •
                                                   
                                                
                                                draw I in 
                                                      {
                                                      1
                                                      ,
                                                      …
                                                      ,
                                                      N
                                                      }
                                                    with probabilities 
                                                      
                                                         
                                                            {
                                                            
                                                               
                                                                  ω
                                                               
                                                               
                                                                  
                                                                     
                                                                        T
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  +
                                                                  t
                                                                  −
                                                                  1
                                                               
                                                               
                                                                  ℓ
                                                               
                                                            
                                                            }
                                                         
                                                         
                                                            ℓ
                                                            =
                                                            1
                                                         
                                                         
                                                            N
                                                         
                                                      
                                                   ;

sample 
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            
                                                               
                                                                  T
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            +
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ~
                                                      q
                                                      (
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            
                                                               
                                                                  T
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            +
                                                            t
                                                            −
                                                            1
                                                         
                                                         
                                                            I
                                                         
                                                      
                                                      ,
                                                      ·
                                                      )
                                                   ;

set 
                                                      
                                                         
                                                            ω
                                                         
                                                         
                                                            
                                                               
                                                                  T
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            +
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ∝
                                                      
                                                         
                                                            g
                                                         
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            
                                                               
                                                                  T
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            +
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            Y
                                                         
                                                         
                                                            
                                                               
                                                                  T
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            +
                                                            t
                                                         
                                                      
                                                      )
                                                   .

Compute 
                                             
                                                
                                                   
                                                      
                                                         ρ
                                                      
                                                      
                                                         
                                                            
                                                               T
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         +
                                                         t
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         ξ
                                                      
                                                      
                                                         
                                                            
                                                               T
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         +
                                                         t
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   +
                                                   
                                                      
                                                         t
                                                         −
                                                         1
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         ℓ
                                                         =
                                                         1
                                                      
                                                      
                                                         N
                                                      
                                                   
                                                   ×
                                                   
                                                      
                                                         
                                                            
                                                               ω
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               +
                                                               t
                                                               −
                                                               1
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         q
                                                         (
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               +
                                                               t
                                                               −
                                                               1
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               +
                                                               t
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                         
                                                            
                                                               ρ
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               +
                                                               t
                                                               −
                                                               1
                                                            
                                                            
                                                               ℓ
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               p
                                                               =
                                                               1
                                                            
                                                            
                                                               N
                                                            
                                                         
                                                         
                                                            
                                                               ω
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               +
                                                               t
                                                               −
                                                               1
                                                            
                                                            
                                                               p
                                                            
                                                         
                                                         q
                                                         (
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               +
                                                               t
                                                               −
                                                               1
                                                            
                                                            
                                                               p
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               +
                                                               t
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       

The approximation of 
                                    
                                       
                                          S
                                       
                                       
                                          1
                                       
                                       
                                          k
                                       
                                    
                                  on the block 
                                    
                                       
                                          Y
                                       
                                       
                                          k
                                       
                                    
                                  is then given by 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                1
                                             
                                             
                                                k
                                             
                                          
                                          =
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                          
                                             
                                                ω
                                             
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      k
                                                   
                                                
                                                +
                                                
                                                   
                                                      τ
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                ρ
                                             
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      k
                                                   
                                                
                                                +
                                                
                                                   
                                                      τ
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                             
                                             
                                                i
                                             
                                          
                                          .
                                       
                                    
                                 
                              

Once these computations are done for each statistic, the estimate θ
                                 
                                    k+1 is computed by Algorithm 1 applied with 
                                    
                                       
                                          
                                             
                                                S
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          1
                                       
                                       
                                          k
                                       
                                    
                                 , 
                                    
                                       
                                          
                                             
                                                S
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          2
                                          ,
                                          j
                                       
                                       
                                          k
                                       
                                    
                                 , 
                                    
                                       
                                          
                                             
                                                S
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          3
                                          ,
                                          j
                                       
                                       
                                          k
                                       
                                    
                                  and τ
                                 
                                    k+1.

The BOEM proposed in Le Corff and Fort [22] also introduced an averaged estimate 
                           
                              
                                 {
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 }
                              
                              
                                 k
                                 ≥
                                 0
                              
                           
                         based on a weighted mean of all the sufficient statistics computed in the past. It is proved in Le Corff and Fort [22] that this averaged estimator has an optimal rate of convergence. This can be easily done recursively after the computation of each statistic in step (iii). Step (iii) is then followed by


                        
                           (
                           iii
                           ′
                           )
                         Compute (with 
                           
                              
                                 
                                    
                                       S
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 1
                              
                              
                                 0
                              
                           
                           =
                           0
                        ) 
                           
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       1
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             T
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       
                                          
                                             T
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       1
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             τ
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             T
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                    
                                       k
                                    
                                 
                                 .
                              
                           
                        And step (iv) is then followed by


                        
                           (
                           iv
                           ′
                           )
                         Once these computations are done for each statistic, the estimate 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 k
                                 +
                                 1
                              
                           
                         is computed by Algorithm 1 applied with 
                           
                              
                                 
                                    
                                       S
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 1
                              
                              
                                 k
                              
                           
                        , 
                           
                              
                                 
                                    
                                       S
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 2
                                 ,
                                 j
                              
                              
                                 k
                              
                           
                        , 
                           
                              
                                 
                                    
                                       S
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 3
                                 ,
                                 j
                              
                              
                                 k
                              
                           
                         and 
                           
                              
                                 T
                              
                              
                                 k
                                 +
                                 1
                              
                           
                        .


                        Localization procedure: At each time step, we compute two estimators of the device position:
                           
                              (i)
                              
                                 Nonaveraged algorithm: At each time step, the estimation of the device position is set as the particle with the greatest importance weight: 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                =
                                             
                                             
                                                def
                                             
                                          
                                          
                                             
                                                ξ
                                             
                                             
                                                t
                                             
                                             
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      max
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                          where
                                          
                                          
                                             
                                                i
                                             
                                             
                                                max
                                             
                                          
                                          
                                             
                                                =
                                             
                                             
                                                def
                                             
                                          
                                          
                                             
                                                argmax
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             
                                                ω
                                             
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          .
                                       
                                    
                                 
                              


                                 Averaged algorithm: As the average sequence 
                                    
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                k
                                             
                                          
                                          }
                                       
                                       
                                          k
                                          ≥
                                          0
                                       
                                    
                                  has a better rate of convergence, another particle system 
                                    {
                                    (
                                    
                                       
                                          
                                             
                                                ξ
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    }
                                  is run using only step (ii) (a) above by replacing θ
                                 
                                    k
                                  by 
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          k
                                       
                                    
                                 . Then, the estimation of the device position is set as 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                =
                                             
                                             
                                                def
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                t
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            i
                                                         
                                                         
                                                            ˜
                                                         
                                                      
                                                   
                                                   
                                                      max
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                          where
                                          
                                          
                                             
                                                
                                                   
                                                      i
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                max
                                             
                                          
                                          
                                             
                                                =
                                             
                                             
                                                def
                                             
                                          
                                          
                                             
                                                argmax
                                             
                                             
                                                i
                                             
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      ω
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          .
                                       
                                    
                                 
                              

Other natural estimators of the device position such as the posterior means could be used: 
                           
                              
                                 
                                    
                                       
                                          
                                             X
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       ω
                                    
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 
                                 and
                                 
                                 
                                    
                                       
                                          
                                             X
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          
                                             ω
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ξ
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 .
                              
                           
                        However, we did not observe significant differences between the estimated localization provided by the posterior means and by the proposed estimators with both simulated and true data. Moreover, we observed that the bootstrap filter sometimes produces several clouds of particles remote from each other (each of them is concentrated around local maxima of the filtering distribution). In this case, the proposed estimators offer a better accuracy than the weighted means. Finally, some indoor maps may not be convex such as in Section 5.2. In this case, the weighted means may not belong to the map while the proposed estimators always do.


                        Stabilization procedure: We add a stabilization step which consists in regularly replacing the original map estimate by the averaged one 
                           (
                           
                              
                                 θ
                              
                              
                                 k
                              
                           
                           ←
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 k
                              
                           
                           )
                        . This step is needed to improve the performance of the algorithm as detailed in Section 5.

@&#EXPERIMENTS@&#

In this section, all experiments are performed on the finite grid 
                           C
                           =
                           {
                           0
                           ,
                           …
                           ,
                           30
                           }
                           ×
                           {
                           0
                           ,
                           …
                           ,
                           30
                           }
                        . Note that in the following the particles are sampled on the square 
                           [
                           0
                           ,
                           30
                           ]
                           ×
                           [
                           0
                           ,
                           30
                           ]
                         before being associated with the corresponding cells in the finite grid 
                           C
                        . Each AP is modeled using the same coefficients 
                           
                              
                                 c
                              
                              
                                 ⋆
                              
                           
                         and 
                           
                              
                                 d
                              
                              
                                 ⋆
                              
                           
                        : 
                           
                              
                                 ∀
                                 j
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 B
                                 }
                                 ,
                                 
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                    
                                       ⋆
                                    
                                 
                                 =
                                 −
                                 26
                                 
                                 and
                                 
                                 
                                    
                                       d
                                    
                                    
                                       j
                                    
                                    
                                       ⋆
                                    
                                 
                                 =
                                 −
                                 17.5
                                 .
                              
                           
                        
                        
                           Σ
                         is a Gaussian covariance function defined by 
                           Σ
                           (
                           x
                           ,
                           x
                           ′
                           )
                           
                              
                                 =
                              
                              
                                 def
                              
                           
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           ⁎
                           exp
                           (
                           −
                           |
                           x
                           −
                           x
                           ′
                           
                              
                                 |
                              
                              
                                 2
                              
                           
                           /
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           )
                         with 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           =
                           10
                         and 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           =
                           18
                        . Generalities about hyper-parameter determination in spatial data modeling can be found in Cressie [10]. Ferris et al. [17] also describe the determination of the hyper-parameters v
                        1 and v
                        2 (when 
                           
                              
                                 c
                              
                              
                                 j
                              
                              
                                 ⋆
                              
                           
                         and 
                           
                              
                                 d
                              
                              
                                 j
                              
                              
                                 ⋆
                              
                           
                         are set to zero). In our case, these coefficients were calibrated after a measurement campaign in the office presented in Section 5.2. The corresponding grid stepsize is 1m. Details about the calibration method for this particular model can be found in Dumont [15, Section 5.1]. This measurement campaign might seem contradictory with our aim to get ride of such a campaign. However, we use this calibration to find relevant values for the true parameters 
                           
                              
                                 c
                              
                              
                                 j
                              
                              
                                 ⋆
                              
                           
                        , 
                           
                              
                                 d
                              
                              
                                 j
                              
                              
                                 ⋆
                              
                           
                        . We also use this measurement campaign to estimate the hyper-parameters v
                        1 and v
                        2 that characterize the prior distribution of 
                           
                              
                                 δ
                              
                              
                                 ⋆
                              
                           
                        . Their values influence the smoothness of the Gaussian field 
                           
                              
                                 δ
                              
                              
                                 ⋆
                              
                           
                        . An online estimation of v
                        1 and v
                        2 could be considered but is not addressed in this paper. We assess that a partial measurement campaign on a part of the environment only could be sufficient to calibrate them. We can also consider the same values of v
                        1 and v
                        2 for different environments so that 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           =
                           10
                         and 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           =
                           18
                         can be used directly and no measurement campaign is needed. The variance of the observation noise is 
                           
                              
                                 σ
                              
                              
                                 ⋆
                                 ,
                                 2
                              
                           
                           =
                           25
                         (this value was calibrated by computing the variance of a set of RSS observations at a fixed position). Thevariance of the transition kernel defined in (2) is chosen such that a=6.

All runs are started with the same initial estimates: 
                           
                              
                                 δ
                              
                              
                                 0
                              
                           
                           =
                           0
                        , 
                           
                              
                                 σ
                              
                              
                                 0
                              
                              
                                 2
                              
                           
                           =
                           30
                         and 
                           
                              
                                 ∀
                                 j
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 B
                                 }
                                 ,
                                 
                                 
                                    
                                       c
                                    
                                    
                                       0
                                       ,
                                       j
                                    
                                 
                                 =
                                 −
                                 10
                                 ,
                                 
                                 
                                    
                                       d
                                    
                                    
                                       0
                                       ,
                                       j
                                    
                                 
                                 =
                                 −
                                 30
                                 .
                              
                           
                        
                     

The number of particles is N=25 and the initial position of each particle is chosen randomly and uniformly in 
                           C
                        . The block sizes are given by 
                           
                              
                                 ∀
                                 k
                                 ∈
                                 N
                                 ,
                                 
                                 
                                    
                                       τ
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 10
                                 k
                                 +
                                 500
                                 .
                              
                           
                        
                     


                        Mapping error: For each map 
                           
                              
                                 F
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 μ
                              
                              
                                 j
                              
                           
                           +
                           
                              
                                 δ
                              
                              
                                 j
                              
                           
                        , the estimation error is set as the normalized L1 error, such that the distance of a given map F
                        
                           j
                         to the true map 
                           
                              
                                 F
                              
                              
                                 j
                              
                              
                                 ⋆
                              
                           
                           =
                           
                              
                                 μ
                              
                              
                                 j
                              
                              
                                 ⋆
                              
                           
                           +
                           
                              
                                 δ
                              
                              
                                 j
                              
                              
                                 ⋆
                              
                           
                         is 
                           
                              
                                 
                                    
                                       ϵ
                                    
                                    
                                       j
                                    
                                 
                                 
                                    
                                       =
                                    
                                    
                                       def
                                    
                                 
                                 
                                    
                                       1
                                    
                                    
                                       |
                                       C
                                       |
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       x
                                       ∈
                                       C
                                    
                                 
                                 |
                                 
                                    
                                       F
                                    
                                    
                                       j
                                       ,
                                       x
                                    
                                 
                                 −
                                 
                                    
                                       F
                                    
                                    
                                       j
                                       ,
                                       x
                                    
                                    
                                       ⋆
                                    
                                 
                                 |
                                 ,
                              
                           
                        and the error displayed is the mean over all maps: 
                           
                              
                                 
                                    
                                       ϵ
                                    
                                    
                                       ¯
                                    
                                 
                                 
                                    
                                       =
                                    
                                    
                                       def
                                    
                                 
                                 
                                    
                                       1
                                    
                                    
                                       B
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       B
                                    
                                 
                                 
                                    
                                       ϵ
                                    
                                    
                                       j
                                    
                                 
                                 .
                              
                           
                        
                     


                        Localization error: For a given block 
                           {
                           
                              
                                 T
                              
                              
                                 k
                              
                           
                           +
                           1
                           ,
                           …
                           ,
                           
                              
                                 T
                              
                              
                                 k
                                 +
                                 1
                              
                           
                           }
                        , the localization error is set as the 0.8-quantile of the sample:
                           
                              •
                              
                                 
                                    ∥
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          t
                                       
                                    
                                    −
                                    
                                       
                                          X
                                       
                                       
                                          t
                                       
                                    
                                    ∥
                                 , 
                                    t
                                    ∈
                                    {
                                    
                                       
                                          T
                                       
                                       
                                          k
                                       
                                    
                                    +
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    }
                                 , for the nonaveraged algorithm;


                                 
                                    ∥
                                    
                                       
                                          
                                             
                                                X
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          t
                                       
                                    
                                    −
                                    
                                       
                                          X
                                       
                                       
                                          t
                                       
                                    
                                    ∥
                                 , 
                                    t
                                    ∈
                                    {
                                    
                                       
                                          T
                                       
                                       
                                          k
                                       
                                    
                                    +
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    }
                                 , for the averaged algorithm.

To assess the performance of our method we also display the estimated position given with a particle system run with the true maps 
                           
                              
                                 F
                              
                              
                                 j
                              
                              
                                 ⋆
                              
                           
                         (i.e. using 
                           
                              
                                 θ
                              
                              
                                 ⋆
                              
                           
                         instead of θ
                        
                           k
                         in step ii) (a) of the algorithm). The localization error obtained using the true propagation maps 
                           
                              
                                 F
                              
                              
                                 ⋆
                              
                           
                         and the true variance 
                           
                              
                                 σ
                              
                              
                                 ⋆
                                 ,
                                 2
                              
                           
                         will be referred to as the reference estimator localization error. Fig. 4
                         displays the localization error for a different number of AP as a function of the number of blocks when the stabilization step is omitted. As expected, both the reference estimator localization error and the localization error of the averaged algorithm are improved as the number of AP increases. However, even with a great number of AP, the localization error of the averaged estimate does not converge to the reference estimator localization error. This is confirmed by Fig. 5
                         which displays the map estimation error and the localization error for the greatest number of AP (B=17). As shown in Fig. 5a the estimated position does not converge as the number of blocks (i.e. as the number of estimations) increases. After 50 blocks (about 40,000 observations) the position, which is badly estimated, does not provide good map estimates which increases the error on the averaged map estimate. Fig. 5b shows that both the map estimate and its averaged version do not converge. This convergence problem can be due to the curse of dimensionality since the number of parameters to estimate is high. Moreover, the higher the parameter space dimension is, the more likely the EM based algorithms are prone to converge towards local minima (see [7]). To overcome this difficulty, we propose to use the good behavior of the averaged estimate 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 k
                              
                           
                         which offers a more accurate positioning than the non-averaged version θ
                        
                           k
                         (c.f. Fig. 5). Then θ
                        
                           k
                         is regularly replaced by the averaged version 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 k
                              
                           
                        . In Fig. 6
                        , this stabilization process is performed each time 
                           
                              
                                 N
                              
                              
                                 b
                              
                           
                           =
                           5
                         blocks have been used. As shown by Fig. 6a and b, this greatly improves the performance of the estimation of the maps and of the localization. Hence, the proposed algorithm uses this stabilization procedure and the averaged estimate to localize the mobile.


                        Figs. 7 and 8
                        
                         illustrate the performance of the algorithm for the localization and for the estimation of the maps over 50 independent Monte Carlo runs. In Fig. 7, the reference localization error (i.e. when the maps are known) is also displayed. The convergence of the localization error to the reference error is almost reached after 100 blocks (about 100,000 observations). Similarly, the error for the estimation of the maps given by the averaged algorithm goes on decreasing after 100 blocks (the decrease is slower after 75 blocks).

In this section, 10 AP are set up in an office environment. Fig. 9
                         represents a map of this environment as well as the position of the AP. The map is discretized using a grid 
                           C
                           ⊂
                           {
                           0
                           ,
                           …
                           ,
                           32
                           }
                           ×
                           {
                           0
                           ,
                           …
                           ,
                           28
                           }
                        . Note a major difference between the model given in Section 3 and the real data situation. For any measure Y
                        
                           k
                         sent by the device, only several AP are represented in Y
                        
                           k
                        . Therefore, the maps 
                           
                              
                                 
                                    
                                       F
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 
                                    
                                       μ
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 j
                              
                           
                           +
                           
                              
                                 
                                    
                                       δ
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 j
                              
                           
                         are not estimated simultaneously as, for any time step k, two AP might appear a different number of times in 
                           
                              
                                 Y
                              
                              
                                 1
                                 :
                                 k
                              
                           
                        . We thus slightly modify our algorithm by introducing specific blocks and measure counters relative to each AP. We shortly denote by “
                           j
                           ∈
                           
                              
                                 Y
                              
                              
                                 k
                              
                           
                        ” the fact that AP j belongs to Y
                        
                           k
                        .

The variance 
                           
                              
                                 σ
                              
                              
                                 ⋆
                                 ,
                                 2
                              
                           
                         is assumed to be known and its value 
                           (
                           
                              
                                 σ
                              
                              
                                 ⋆
                                 ,
                                 2
                              
                           
                           =
                           25
                           
                           
                              
                                 dBm
                              
                              
                                 2
                              
                           
                           )
                         is calibrated using a measurement campaign at a fixed position. About T=20,000 measures of the RSSI have been made by walking in the office for around 2h and 45min with a WiFi connected device (the device measures the RSSI every 0.5s). Our algorithm produces position estimates however, unlike in the simulated data case, we do not have a direct access to the real position and thus cannot observe the localization error. To overcome this difficulty, we proceed to four phases of test. During each phase, we regularly identify the true position associated with the last measure. For i in 
                           {
                           1
                           ,
                           2
                           ,
                           3
                           ,
                           4
                           }
                        , we denote by 
                           
                              
                                 S
                              
                              
                                 test
                                 ,
                                 i
                              
                           
                         the set of all the time steps belonging to phase i, and by 
                           
                              
                                 {
                                 
                                    
                                       X
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 }
                              
                              
                                 t
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       test
                                       ,
                                       i
                                    
                                 
                              
                           
                         the data collected during this phase of test. These data will be used to compare the estimated positions 
                           
                              
                                 {
                                 
                                    
                                       
                                          
                                             X
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 }
                              
                              
                                 t
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       test
                                       ,
                                       i
                                    
                                 
                              
                           
                         with the true positions 
                           
                              
                                 {
                                 
                                    
                                       X
                                    
                                    
                                       t
                                    
                                 
                                 }
                              
                              
                                 t
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       test
                                       ,
                                       i
                                    
                                 
                              
                           
                        . We will also use these data to estimate the mapping error by considering, for any 
                           j
                           =
                           {
                           1
                           ,
                           …
                           ,
                           10
                           }
                        , 
                           
                              
                                 
                                    
                                       ϵ
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             4
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             
                                                
                                                   S
                                                
                                                
                                                   test
                                                   ,
                                                   i
                                                
                                             
                                          
                                       
                                       |
                                       
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   ˜
                                                
                                             
                                          
                                          
                                             j
                                             ,
                                             
                                                
                                                   X
                                                
                                                
                                                   t
                                                
                                             
                                          
                                       
                                       −
                                       
                                          
                                             Y
                                          
                                          
                                             t
                                             ,
                                             j
                                          
                                       
                                       |
                                       
                                          
                                             1
                                          
                                          
                                             j
                                             ∈
                                             
                                                
                                                   Y
                                                
                                                
                                                   t
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             4
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             ∈
                                             
                                                
                                                   S
                                                
                                                
                                                   test
                                                   ,
                                                   i
                                                
                                             
                                          
                                       
                                       
                                          
                                             1
                                          
                                          
                                             j
                                             ∈
                                             
                                                
                                                   Y
                                                
                                                
                                                   t
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 1
                              
                              
                                 j
                                 ∈
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                              
                           
                         equals 1 if measure Y
                        
                           t
                         does contain AP j and equals 0 otherwise. Finally, we set 
                           
                              
                                 
                                    
                                       ϵ
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       10
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       10
                                    
                                 
                                 
                                    
                                       ϵ
                                    
                                    
                                       j
                                    
                                 
                                 .
                              
                           
                        We run our algorithm twice on the data using the hyper-parameters 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           =
                           10
                        , 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           =
                           18
                        . For these two experiments we will start the algorithm using different initial propagation maps: 
                           
                              
                                 
                                    
                                       F
                                    
                                    
                                       j
                                       ,
                                       x
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       μ
                                    
                                    
                                       j
                                       ,
                                       x
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       d
                                    
                                    
                                       0
                                    
                                 
                                 
                                 log
                                 (
                                 ∥
                                 x
                                 −
                                 
                                    
                                       O
                                    
                                    
                                       j
                                    
                                 
                                 ∥
                                 )
                                 ,
                                 
                                 j
                                 ∈
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 10
                                 }
                                 ,
                              
                           
                        
                        c
                        0 and d
                        0 being common to all AP and δ
                        0 being set to zero. In the experiment 1, we consider initial parameters 
                           
                              
                                 c
                              
                              
                                 0
                              
                           
                           =
                           −
                           37
                         and 
                           
                              
                                 d
                              
                              
                                 0
                              
                           
                           =
                           −
                           9
                         which allow us to start the algorithm with initial estimators not too far from the real propagation maps (see Table 1
                        ). In the experiment 2, we choose 
                           
                              
                                 c
                              
                              
                                 0
                              
                           
                           =
                           −
                           37
                         and 
                           
                              
                                 d
                              
                              
                                 0
                              
                           
                           =
                           9
                        . In this case, d
                        0 being positive, the initial estimators state that the further the device is from an AP, the stronger the signal will be expected. This implies that the experiment 2 starts the algorithm with a completely wrong idea about how WiFi signals propagate in the environment (see Table 1).

In the two experiments the maps 
                           
                              
                                 
                                    
                                       F
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 
                                    
                                       μ
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 j
                              
                           
                           +
                           
                              
                                 
                                    
                                       δ
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 j
                              
                           
                         were updated a different number of times depending on the AP. This number of updates varies from two times for AP 2 to six times for AP 9. The evolution of the localization precision for the experiment 1 (resp. experiment 2) can be observed in Fig. 10
                         (resp. Fig. 11
                        ). Figs. 10 and 11 show that the localization improves with time for both experiments. We can observe in Fig. 10 that after a first period of improvement, the precision seems to reach a bound. On the contrary, with the experiment 2, the precision starts really badly as we expected considering the initial point of our algorithm. The precision seems to stay constant until enough measures have been gathered by the device and until enough updates of the maps have been done. While the precision improves by around 1.5m between the first test phase and the last one for the experiment 1, for the experiment 2, the precision considerably improves with time with a difference of 6.6m between the beginning and the end of the experiment (see Table 2
                        ). Fig. 12
                         and Table 2 show that the experiment 2 final precision accuracy reaches (and even slightly overtake) the precision obtained with the experiment 1.

These observations confirm the robustness of our approach. If changes occur in the environment (modifying the way WiFi signals propagate), the difference between the resulting propagation maps and the current estimator will never be as substantial as it was between the true propagation maps and the initial estimate considered in the experiment 2. We reckon that our algorithm can adapt to such changes in order to maintain the accuracy of the localization if the sufficient statistics 
                           
                              
                                 S
                              
                              
                                 ˜
                              
                           
                        , k and T
                        
                           k
                         are regularly reset. Finally, more elaborate localization algorithms could be considered to improve the accuracy. However, the aim of this paper lies in the efficiency of our propagation maps estimation procedure for localization purpose rather than the localization algorithm itself.

@&#CONCLUSION@&#

In this paper, we propose an online EM based algorithm to estimate the propagation maps needed in any WiFi based localization system. The main difference with the existing localization solutions is that these propagation maps are estimated using the data sent by the mobile device originally used for localization purposes. The existing WiFi based localization systems establish these propagation maps either in a deterministic way or by running a previous hand-made survey. In case of environmental modifications, the propagation maps are changed. Our technique can easily adapt to these changes by regularly reinitializing the estimation procedure while hand-made survey based systems cannot take into account these modifications without renewing the survey. Other elements could be analyzed such as the size of the environment or the materials constituting the obstacles in the environment that might particularly influence the “right choice” of the hyper-parameters v
                     1 and v
                     2. An online estimation procedure of these hyper-parameters could be considered. It is possible to use different localization techniques using more sophisticated human motion model for instance in order to improve positioning accuracy. However, our algorithm only needs few information on the environment, namely the size of the indoor map and the AP positions. More sophisticated models might need more information and thus make the installation process more complex.

@&#REFERENCES@&#

