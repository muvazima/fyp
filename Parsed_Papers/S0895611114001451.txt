@&#MAIN-TITLE@&#Automating the design of resection guides specific to patient anatomy in knee replacement surgery by enhanced 3D curvature and surface modeling of distal femur shape models

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The mean-shift technique applied to the surface curvature facilitates the region clustering.


                        
                        
                           
                           The anatomy of the IF can be consistently represented through a hyperbolic paraboloid.


                        
                        
                           
                           The Whiteside line can be nicely approximated with the principal direction of the saddle shape.


                        
                        
                           
                           The detection of the WL is reliable, more repeatable than that obtained through manual digitations.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Whiteside line

Distal femur surface

Intercondylar fossa

Hyperbolic paraboloid fitting

Patient-specific resection guides

Knee replacement

@&#ABSTRACT@&#


               
               
                  Personalized resection guides (PRG) have been recently proposed in the domain of knee replacement, demonstrating clinical outcome similar or even superior to both manual and navigated interventions. Among the mandatory pre-surgical steps for PRG prototyping, the measurement of clinical landmarks (CL) on the bony surfaces is recognized as a key issue due to lack of standardized methodologies, operator-dependent variability and time expenditure. In this paper, we focus on the reliability and repeatability of an anterior–posterior axis, also known as Whiteside line (WL), of the distal femur proposing automatic surface processing and modeling methods aimed at overcoming some of the major concerns related to the manual identification of such CL on 2D images and 3D models. We show that the measurement of WL, exploiting the principle of mean-shifting surface curvature, is highly repeatable and coherent with clinical knowledge.
               
            

@&#INTRODUCTION@&#

Innovative approaches to bone surgical preparation have been recently proposed in knee replacement (KR), which are based on resection guides specific to the patient anatomy [1]. Such guides, matching the anatomy of the distal femur and the proximal tibia, support planned bone cuts without violating the intramedullary canal, typical in traditional surgery. Moreover, the use of such personalized resection guides (PRG) is less invasive than navigation that requires additional intra-osseous pins necessary to bone tracking. Nonetheless, some pre-surgical steps are mandatory for PRG prototyping namely the reconstruction of the three-dimensional (3D) bone geometry of the patient's specific anatomy from computed tomography (CT) or magnetic resonance imaging (MRI) scans, the determination of the clinical landmarks (CL) for computing the optimal size and the 6D alignment of the prosthesis components, along with the bony cuts, and finally the computation of the geometric matching between the guides and the bony surfaces. Basically, rotational alignment accuracy and anatomical surface matching quality of the PRG determine the reliability of the surgery. As a consequence, imaging resolution and preliminary processing steps as image segmentation, CL identification, 3D surface modeling becomes fundamental factors for the success of the PRG-based surgery.

CL identification was acknowledged to be a critical step especially as it is prone to intra- and inter-observer variability, being highly dependent on the radiological experience of the operator, requires computer skills and is time consuming [6,7,10]. Among different CL of the distal femur, the intercondylar anterior–posterior axis, also known as Whiteside line (WL), is the target of this work. It is commonly adopted as a reference line to the determination of the knee flexion–extension axis and for positioning the femoral component on the axial plane altogether [11–20] or alternatively to the posterior condylar line (PCL) and the trans-epicondylar axis (TEA) in severely valgus knees [21,22]. High correlation of the WL direction with respect to that of the posterior condylar line for both varus and valgus knees was reported as well [23]. From the anatomical point of view, the WL is defined as the line connecting the deepest part of the anterior patellar groove (APG) to the center of the posterior intercondylar notch (PIN). In the pre-operative stage, these two landmarks are commonly digitized by expert operators in planning images and surface models. Hand digitization was reported to be subject to intra- and inter-operator errors [8].

Recent approaches in computer assisted orthopedic surgery aimed at overcoming operator dependability focusing on automatic bone shape processing methods. Among different techniques, surface curvature was considered useful for 3D image segmentation [24,25], surface registration [26] and automatic extraction of anatomical features [27–32]. Operatively, surface curvature is an invariant measure for shape description, independent on the position and the orientation that can be exploited for reliable detection of concavities and convexities. The advantage is that its magnitude provides a direct measurement of the saliency of both points and regions that are anatomically and clinically relevant. In fact, while smooth portions of the bony shapes lead to near zero curvature values, uniform curved and abrupt local variation areas are clearly characterized by curvature extremes, which can be alternatively classified in pit/valley and ridge/peak regions. In addition, curvature is a local measure, in the sense that a small perturbation or a morphological variation confined to a narrow region has limited spatial effects on the overall shape. When using surface curvature for detecting CL in the bone shapes, two main issues have to be however addressed. Firstly, point and line landmarks result in wider areas rather than easily identifiable discrete features. In addition, because there are no clear geometric separations among morphological areas, region clustering can lead to either over- or under-estimation. Secondly, the morphological variability and shape degeneracy in presence of pathologic conditions, along with 3D reconstruction noise and surface resolution, reduce the reliability of the curvature assessment worsening region partition. As an outcome, classical shape curvature descriptors, as mean and Gaussian curvatures, were shown to be insufficient for automatic 3D bone segmentation [32]. In [32,33], we proved that curvature-based algorithms can be used to improve surface segmentation and registration by exploiting the principle of mean-shifting shape curvature. Basically, this approach involves the curvature smoothing, reducing the effect of noise and increasing the separation between concavities and convexities without modifying the surface topology.

In the present work, we extended such previous methodological developments to automatically detect the WL on the distal femur geometry, featuring measure repeatability, measure reliability with anatomical and clinical knowledge, and computational consistency with clinical workflow. The method extracted the inter-condylar fossa (IF) from the femur, exploiting the mean-shifted curvature, synthesized the IF by a hyperbolic paraboloid and finally identified the WL as the main saddle direction. The validation was performed upon 42 distal femur models reconstructed from CT studies of patients.

Diagnostic CT scans of forty-two patients (21 males and 21 females) with a mean age of 56 years (25–84), were acquired at the CTO Hospital (Orthopedic Trauma Centre) in Milan (Italy) from 03/05/2011 to 19/10/2012 (Table 1
                        ). Every image dataset, running approximately from the distal femur to the proximal tibia, were acquired through a 6-slice CT scanner Siemens Emotion featuring a resolution of 512×512 pixels (pixel size from 0.25mm×0.25mm to 0.5mm×0.5mm) and an axial range between 1 and 2mm. An expert radiological operator performed the manual segmentation to extract the bony profiles and reconstruct the three-dimensional geometry (triangular surface mesh) of the distal femur using the Amira software (VSG|FEI Visualization Sciences Group, Oregon USA). In the segmentation procedure, osteophytes and articular cartilage were kept out. The reconstructed surface was described by an average number of faces approximately of 20,000.

Given that a surface mesh is composed by a set V of vertices and F triangular faces, the surface curvature can be determined in correspondence to each vertex by processing the normal directions of the vertices in its neighborhood. Each vertex v features 
                           
                              
                                 N
                                 F
                              
                              (
                              v
                              )
                           
                         adjacent faces and a normal direction 
                           
                              
                                 n
                              
                              (
                              v
                              )
                           
                        . Each face f is characterized by a normal direction n(f). Considering c(f) the centroid of the face f, the relation between 
                           
                              
                                 n
                              
                              (
                              v
                              )
                           
                         and n(f) can be expressed as:
                           
                              (1)
                              
                                 
                                    
                                       n
                                    
                                    (
                                    v
                                    )
                                    =
                                    
                                       
                                          
                                             ∑
                                             
                                                f
                                                ∈
                                                
                                                   N
                                                   F
                                                
                                             
                                          
                                          
                                             w
                                             (
                                             f
                                             )
                                             
                                                n
                                             
                                             (
                                             f
                                             )
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      f
                                                      ∈
                                                      
                                                         N
                                                         F
                                                      
                                                   
                                                
                                                
                                                   w
                                                   (
                                                   f
                                                   )
                                                   
                                                      n
                                                   
                                                   (
                                                   f
                                                   )
                                                
                                             
                                          
                                       
                                    
                                     
                                    with
                                       
                                    w
                                    (
                                    f
                                    )
                                    =
                                    
                                       1
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                (
                                                f
                                                )
                                                −
                                                v
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Assuming the neighborhood of vertex v represented by T adjacent vertices, one can compute T curvatures 
                           
                              
                                 k
                                 t
                              
                           
                         at v. From 
                           
                              {
                              
                                 k
                                 t
                              
                              }
                           
                         set, the maximum k
                        1 and the minimum k
                        2 curvatures, called main curvatures, can be computed. The traditional way to express the curvature at any point v of a surface takes into account the mean k
                        
                           M
                         and the Gaussian k
                        
                           G
                         curvatures, which are related to the two main curvatures by:
                           
                              (2)
                              
                                 
                                    
                                       k
                                       M
                                    
                                    =
                                    
                                       
                                          
                                             k
                                             1
                                          
                                          +
                                          
                                             k
                                             2
                                          
                                       
                                       2
                                    
                                     
                                     
                                    
                                       k
                                       G
                                    
                                    =
                                    
                                       k
                                       1
                                    
                                    *
                                    
                                       k
                                       2
                                    
                                 
                              
                           
                        
                     

A more compact expression of the local curvature consists in using a single curvature value as:
                           
                              (3)
                              
                                 
                                    
                                       k
                                       C
                                    
                                    =
                                    
                                       2
                                       π
                                    
                                    arctan
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      1
                                                      −
                                                      
                                                         
                                                            
                                                               k
                                                               G
                                                            
                                                         
                                                         
                                                            
                                                               k
                                                               M
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                −
                                                1
                                                /
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        which has the advantage of being bounded in the (−1,+1) range. Positive and negative values of 
                           
                              
                                 k
                                 C
                              
                           
                         identify ridge/peak and pit/valley regions, respectively. Nonetheless, noise on the surface vertices disrupts the curvature estimation making fuzzy the separation amongst concavities and convexities.

In order to reduce the noise effects, concurrently avoiding the modification of the surface topology that can sensibly affect the anatomical morphology, a procedure based on mean-shifting paradigm [34] to refine curvature 
                           
                              
                                 k
                                 C
                              
                           
                         was adopted. In general, mean-shift allows the iterative location of the maxima of a density function given discrete data sampled from that function. Such maxima correspond to function modes (clusters) that can be used to synthetically represent the original data. A mean-shift vector m, obtained from the gradient of the density function, is computed for each data point using nearby points (see Appendix A.1). Considering the curvature case [33], the processing is driven by:
                           
                              (4)
                              
                                 
                                    
                                       k
                                       C
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    (
                                    v
                                    )
                                    =
                                    
                                       k
                                       C
                                       i
                                    
                                    (
                                    v
                                    )
                                    +
                                    m
                                    (
                                    
                                       k
                                       C
                                       i
                                    
                                    (
                                    v
                                    )
                                    )
                                 
                              
                           
                        where 
                           
                              m
                              (
                              
                                 k
                                 C
                                 i
                              
                              (
                              v
                              )
                              )
                           
                         is the mean-shift curvature at iteration step i (see Appendix A.2) at the vertex v, computed over a predefined vertex neighborhood. The simplest neighborhood for v can be defined as the 1st order ring of vertices explicitly connected through edges in the surface topology. Increasing the ring order allows increasing the smoothness in flat region and the sharpening the curvedness in concave and convex regions. The curvature updating is carried out until 
                           
                              |
                              
                                 k
                                 C
                                 
                                    i
                                    +
                                    1
                                 
                              
                              (
                              v
                              )
                              −
                              
                                 k
                                 C
                                 i
                              
                              (
                              v
                              )
                              |
                           
                         is less than a user specified threshold 
                           ε
                        , which corresponds to a lower bound for the magnitude of the mean-shift vector.

While the anatomical definition of the WL implies tracing a line passing through the center of the APG and the PIN (Fig. 1a), the detection of such two points as bony landmarks, both in images and intra-operatively on the patient bone, can be unreliable. The trochlear groove is typically a concave region whose the deepest part is however not easy to simplify to a single point [35]. The identification of the intercondylar notch can be affected by uncertainty, as well. As evidenced in [36], systematic deviations to normality, due to osteoarthritis, can correspond to increased smoothness at intercondylar notch level. In order to raise the dependability of the measure, most of the navigation procedures entail the direct measure of the WL direction by a tracking tool which is aligned distally to the IF [13]. It seems therefore consistent considering the WL of the distal femur (Fig. 1b) as the linear geometric approximation of the distal part of the IF. Assuming that IF is shaped as a saddle, it can be well characterized by its curvature: it presents a concavity and boundaries, in the medio-lateral direction, which are characterized by a curvature sign change. The distal margins of the patellar groove and the intercondylar notch, respectively, can be considered reliable boundaries in the anterior and posterior directions. Operatively, the segmentation of the distal part of the IF is performed according to the following main steps: (a) extracting concave regions through surface curvature analysis; (b) clustering concave regions and identifying the greatest cluster as the IF; (c) computing the margins of the distal IF and segment the distal part of the IF.

The procedure for automatically identifying the IF is detailed in Fig. 2
                        . In step 1, the raw curvature (k
                        
                           C
                        ) is computed (Eq. (3)). In step 2, the curvature gets refined through the mean-shift method. In step 3, two vertex sets (convex and concave regions) are obtained using a curvature threshold 
                           
                              
                                 
                                    k
                                    ¯
                                 
                                 C
                              
                           
                        , which was automatically computed on k
                        
                           C
                         value histogram. In step 4, the concavity vertex set 
                           
                              (
                              
                                 k
                                 C
                              
                              <
                              
                                 
                                    k
                                    ¯
                                 
                                 C
                              
                              )
                           
                         is clustered exploiting mesh connectivity (triangular faces). A triangle is added to a face list, if all of its three vertices express a concavity. Clustered regions consist in edge-connected faces within a list. A recursive algorithm associates edge-connected adjacent triangles and continues until no edge-connected triangles within the region are left [33]. In step 5, the intercondylar fossa cluster is separated from the cluster set as the widest cluster. The threshold 
                           
                              
                                 
                                    k
                                    ¯
                                 
                                 C
                              
                           
                         was automatically setup to the mean value of the k
                        
                           C
                         distribution.

In order to locate the anterior and the posterior boundaries of the distal part of the IF, we developed a procedure based on the analysis of the cluster edges along anatomical planes (Fig. 3
                        ). The best approximations of the frontal plane and the antero-posterior direction are automatically attained using a custom optimization procedure, which maximizes the similarity between the cross sections of the two condyles, based on genetic algorithms [31]. The sagittal plane is computed by orthogonal cross vector product between the estimated frontal and CT axial planes. The boundaries of the intercondylar fossa in anterior and posterior directions are computed by processing the curvature profiles of the cross-sections obtained by slicing the surface through planes parallel to the coronal plane.

The slicing, starting at the geometrical center of the distal femur surface (the surface is approximately symmetric with respect to the coronal plane passing through its geometrical center) is iteratively shifted in medio-lateral direction with alternative steps of ±1mm until reaching convex regions (internal part of the condyles). In each cross-section, sharp 2D curvature sign changes are detected. The IF boundary detection exploits the curvature sign changes alongside the cross-section profile (Fig. 4
                        ). Starting from the upper anterior part of the cross-section, the local curvature is assumed to represent a concavity (trochlear fossa). Running along the profile, the curvature has a first sign change that corresponds to the anterior bound of the distal IF. The procedure looks for the next curvature sign change along the profile featuring a high value, detecting the posterior bound of the distal tract of the IF. The distal IF is finally separated by the overall IF using the identified boundaries.

Considering a the canonical equation of the hyperbolic paraboloid 
                           
                              Z
                              =
                              (
                              
                                 x
                                 2
                              
                              /
                              
                                 a
                                 2
                              
                              )
                              −
                              (
                              
                                 y
                                 2
                              
                              /
                              
                                 b
                                 2
                              
                              )
                           
                        , this can be generalized in matrix form including the rotation 
                           R
                         and the translation 
                           t
                        
                        =[x
                        0 
                        y
                        0 
                        z
                        0]T as:
                           
                              (5)
                              
                                 
                                    
                                       
                                          p
                                       
                                       T
                                    
                                    
                                       
                                          R
                                       
                                       T
                                    
                                    
                                       ARp
                                    
                                    +
                                    
                                       g
                                    
                                    ⋅
                                    
                                       p
                                    
                                    =
                                    0
                                 
                              
                           
                        where
                           
                              (6a)
                              
                                 
                                    
                                       p
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             
                                                
                                                   
                                                      x
                                                      −
                                                      
                                                         x
                                                         0
                                                      
                                                   
                                                
                                                
                                                   
                                                      y
                                                      −
                                                      
                                                         y
                                                         0
                                                      
                                                   
                                                
                                                
                                                   
                                                      z
                                                      −
                                                      
                                                         z
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                          ]
                                       
                                       T
                                    
                                 
                              
                           
                        
                        
                           
                              (6b)
                              
                                 
                                    
                                       A
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      1
                                                      /
                                                      
                                                         a
                                                         2
                                                      
                                                   
                                                
                                                
                                                    
                                                
                                                
                                                    
                                                
                                             
                                             
                                                
                                                    
                                                
                                                
                                                   
                                                      −
                                                      1
                                                      /
                                                      
                                                         b
                                                         2
                                                      
                                                   
                                                
                                                
                                                    
                                                
                                             
                                             
                                                
                                                    
                                                
                                                
                                                    
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6c)
                              
                                 
                                    
                                       g
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                          ]
                                       
                                       T
                                    
                                 
                              
                           
                        
                     

In order to solve the fitting problem, we estimated in the least-square sense the 3 rotation parameters, the 3 translation parameters and the 2 factor forms (a, b) by implementing the method described in [37]. The saddle direction, corresponding to the anterior–posterior axis, was finally the y direction of the canonical form of the hyperbolic paraboloid oriented according to the estimated rotation matrix (Fig. 5
                        ).

The reliability of the WL measurement can be assumed to be strictly dependent on the fitting error of the hyperbolic paraboloid on the distal IF data. Here, we indirectly quantified such reliability by the root mean squared error of the distribution of the minimum distance between the each IF point p
                        
                           i
                         and the paraboloid surface G as:
                           
                              (7)
                              
                                 
                                    e
                                    =
                                    
                                       1
                                       M
                                    
                                    
                                       ∑
                                       i
                                       M
                                    
                                    
                                       min
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                      i
                                                   
                                                   −
                                                   
                                                      g
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 g
                                 i
                              
                           
                         is the generic point on G. This quantity, measured across the patient population provided an indication of the anatomical consistency of the distal IF as a representative of the WL.

The repeatability of the automatic detection of the WL was investigated by processing the same original surface represented in four different detail levels, corresponding to different numbers of surface faces (15k, 10k, 5k, 3k). The surface with 15k faces was considered as representative of highest quality (reference mesh) and the other lower detail surfaces were compared to it. Median values, lower and upper quartiles ranges were considered. The three error distributions (3k/15k, 5k/15k, 10k/15k) obtained from this analysis underwent a statistical comparison using a Wilcoxon test with 5% significance level.

The agreement of the results to the clinical knowledge was proved by comparing the WL direction, obtained by the automatic method applied to the 15k face surface, to the direction of the WL line, represented by the axis connecting the PIN and APG, manually detected (digital selection) on the original CT dataset and the reconstructed surface on Amira software package. This was performed by the same radiological expert who segmented the original CT images. In order to smooth intra-observer variability, the landmarks of the 42 datasets were digitized five times. In each dataset, PIN and APG were averaged across the three different measures as:
                           
                              (8)
                              
                                 
                                    
                                       P
                                       ¯
                                    
                                    =
                                    
                                       
                                          
                                             ∑
                                             5
                                          
                                          
                                             
                                                P
                                                i
                                             
                                          
                                       
                                       5
                                    
                                    →
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                   ¯
                                                
                                                (
                                                x
                                                )
                                                =
                                                
                                                   
                                                      
                                                         ∑
                                                         5
                                                      
                                                      
                                                         
                                                            P
                                                            i
                                                         
                                                         (
                                                         x
                                                         )
                                                      
                                                   
                                                   5
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                   ¯
                                                
                                                (
                                                y
                                                )
                                                =
                                                
                                                   
                                                      
                                                         ∑
                                                         3
                                                      
                                                      
                                                         
                                                            P
                                                            i
                                                         
                                                         (
                                                         y
                                                         )
                                                      
                                                   
                                                   5
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                   ¯
                                                
                                                (
                                                z
                                                )
                                                =
                                                
                                                   
                                                      
                                                         ∑
                                                         3
                                                      
                                                      
                                                         
                                                            P
                                                            i
                                                         
                                                         (
                                                         z
                                                         )
                                                      
                                                   
                                                   5
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        and the WL were the direction of the line joining the two points. In order to test the geometric relation of the WL with the TEA, two additional point landmarks were digitized, namely the medial (MEP) and lateral (LEP) epicondyles. The validity of the 3D curvature method was compared to the method described in [31], which was based on 2D processing of the cross-section profiles of the IF. Again, a statistical analysis of the distribution errors was performed using the Wilcoxon test with 5% significance level.

@&#RESULTS@&#

The processing was successful across all the 42 distal femur surfaces. The procedure, implemented in Matlab (Matworks), took on average 18s to compute the curvature mean-shifting, the region clustering, the distal IF segmentation and the hyperbolic paraboloid fitting. An example of the k
                        
                           C
                         curvature mean-shifting (subject 24) was reported in Fig. 6
                        , where the result was graphically matched to the mean and the original k
                        
                           C
                         curvatures. The corresponding histogram plots were displayed as well. As it can be seen, the mean curvature for clustering was unfeasible due to weak separation amongst surface regions. The distribution of the curvature k
                        
                           C
                         was better spread into the (−1…1) range but it is still noisy. The mean-shifting technique sensibly improved the separation amongst regions.

As far as the hyperbolic paraboloid fitting, the boundaries of the joined distribution of the a and b parameters (Eq. (6b)), computed across the 42 subjects, were 4–9 and 3–9, respectively (Fig. 7
                        ). Lower a values corresponded to narrower IF in the axial plane whereas lower b values corresponded to more bended IF in the sagittal plane. The median of the distribution of e (Eq. (7)) across the 42 subjects was 0.55mm (Fig. 8
                        ), thus enforcing the assumption that the IF can be mathematically modeled through a saddle-like shape.

High repeatability was found at all the three considered surface details (3k, 5k, 10k) with respect to the reference surface detail 15k (Fig. 9
                        ). Median differences lower than 1° were obtained with variability lower than 4°. No statistical difference was detected among the three datasets.

The manual identification of the four point landmarks (PIN, APG, MEP, LEP) for a single distal femur took on average about 28s. The intra-observer variability of the PIN was significantly better than that of the APG (p
                        <0.001), LEP (p
                        <0.0001) and MEP (p
                        <0.001), respectively (Table 1). The corresponding variability (median error of the axis direction) of the WL and TEA was about 3.5° and about 2.5°, respectively.

Angular skew error distributions of the WL direction computed with 2D method (upper panel) presented in [31] and the actual surface-based (lower panel) method were reported in Fig. 10
                        . One point error in the first distribution corresponds to the angle between the WL determined by the manual identification of the PIN and the APG, and the WL determined by the 2D method [31]. Equivalently, each point in the first distribution corresponds to the error in the angle between the WL computed by manual digitation and the WL computed using the actual 3D method. The angular difference (manual versus automatic) distributions of the WL directions were depicted in Fig. 11
                         for both 2D [31] and 3D (present) method. Median errors were lower than 3.5° with no statistically significant difference (p
                        >0.35) in between the two distributions.

The WL, assessed by the automatic technique, was on average externally rotated with respect to the TEA. The angular values approximately ranged from 83° to 115° (Fig. 12
                        ).

@&#DISCUSSION AND CONCLUSIONS@&#

In order to address subjectivity of the measurements, automatic methodologies, applied to CT images and bone surface models, have been recently proposed. In [9], the authors proposed an automatic method for the detection of the anatomical landmarks of the distal femur and proximal tibia based on surface curvature analysis including a priori knowledge about bone morphology. However, surface curvature estimation was shown to be sensitive to mesh quality and manual shape refinement is required. An automatic 3D analysis of the medial and lateral condylar shapes was proposed to compute a flexion–extension axis of the distal femur, alternative to the transepicondylar axis [28]. Nonetheless, this method still required the manual initialization of the sagittal cutting plane. In [30,31], the same authors of the present paper reported the outcome of 3D-based techniques for the automatic segmentation of the lower limb bones and CL assessment, showing that high repeatability, measured on a cadaveric dataset, can be attained. It was shown that the proximal femur surface can be completely synthesized in terms of clinical features of the femoral head, the neck and the trocanter. The proposed work moved along this research approach introducing the curvature mean-shifting to improve the automatic segmentation of the IF and the hyperbolic paraboloid fitting of the IF to compute the WL direction. The validation was performed on a large dataset of the distal femur surfaces reconstructed from CT studies of patients affected by cartilage damage in the knee. According to our recent developments [26,33], the mean-shift paradigm proved a suitable technique to enhance the 3D shape segmentation based on surface curvature.

As far as surface modeling is concerned, we showed that the hyperbolic paraboloid is a very good representation of the distal IF (residual fitting errors lower than 1mm), whose morphology can be straightforwardly classified according to the shape parameters (a, b). The advantage of using a parametric representation of the IF was that the direction of the WL was the y axis of the canonical form of the quadric. As a significant result, we found that the WL is more repeatable than the WL traced through the manual digitations of APG and PIN point landmarks (∼1° against ∼3.5°). We should however consider that 3.5° was the intra-observer variability and we could expect an increase of such value when considering multiple-operator detection. The median value of the angular error distribution, computed between the automatic and the manual WL directions, being lower than 3.5°, can be considered a good index of agreement with clinical knowledge (Figs. 10 and 11). This consideration is also supported by the proof that the WL was mostly externally rotated (Fig. 12) with respect to the TEA, in agreement with the literature [16,38]. Interestingly, the perpendicularity angular range between TEA and WL was quite large (∼32°), which can be ascribed to inter-subject morphologic differences, being this a compelling motivation for the use of patient-specific pre-operative planning and PRG. This has also interesting implications when poor clinical outcomes are linked to alignment errors as small as 3 degrees. In this case, the comparison amongst competitive alignment landmarks (e.g. TEA, WL, PCL) could improve the implant positioning.

The reported study focused on the reliable assessment of the WL in the distal femur using automatic algorithms reducing operator dependency. It should be however pointed out that, given the variability in KR outcome, minimizing the subjectivity in the surgical procedure (identification of landmarks) does not guarantee a good clinical outcome for the patient. Nonetheless, automating the CL detection quality, both pre-operatively and intra-operatively, can reduce sensibly the variability and avoid outliers impacting positively on the overall quality of the surgical outcome. As a matter of fact, the identification of the WL and the TEA in pre-operative images was shown to be greatly operator-dependent [8]. The intra-operative identification of the TEA was reported to be even more difficult due to the soft tissue underlying the epicondyles [38]. The intra-operative identification of the WL, while technically easier than TEA, as the IF is anatomically well defined, was reported to suffer from high inter-observer variability as well [16,39]. It has been suggested that sensible deviations from the TEA are linked to increased forces, abnormal kinematics, and patient-reported pain. In addition, general criticism to the use of the WL asserted that it is a very short landmark, and therefore even small uncertainties in palpation of the APG and PIN can lead to relevant (10°) rotational errors [40–42]. Many studies in KR have reported that alignment errors of the femoral component, measured in the axial plane, greater than 3.0° are associated with less satisfactory function and accelerated levels of failure [38]. This clearly means that any landmark axis, utilized to determine such an alignment, should be measured with an accuracy sufficient to keep the axis direction uncertainty lower than 3.0° with respect to the nominal value [16]. However, the nominal value is not known and the reproducibility of the measure is utilized instead as a factor for the measurement quality. Despite the technical difficulty of attaining repeatable measurements, the WL still remain one of the most utilized landmarks to compute the correct rotational alignment of the femoral component. It was proposed in the literature [11,16] as an alternative to the TEA and grew up its surgical role because of a number of clinical and technical reasons. Clinically, the use of WL for establishing the correct rotational alignment was reported to avoid patello-femoral and femoro-tibial problems [15,43]. Actually, the patello-femoral joint is supposed to be addressed by orientation according to the WL, as it is the connection of the lowest points of the trochlea [11]. Rotation of the femoral component perpendicular to the WL has the aim of bringing the trochlea of the implant into the same position as the preoperative natural trochlea. On nonarthrotic cadaver specimens, it was possible to show that an orientation according to the Whiteside line leads to a balanced mediolateral femorotibial pressure distribution across the range of motion [44]. However, while there is value in reducing the variability associated with identifying WL since it is undoubtedly used as a reference, it has to be acknowledged that the clinical benefit to align the femoral component to WL over other landmarks in KR has not been established yet. Nonetheless, as earlier discussed new surgical techniques based on custom tools can requires alignment landmarks other than the traditional TEA.

One of the main issues in KR is rotational alignment and up to know no proven superiority among traditional different alignment landmarks and tools has been established despite the fact gap balancing technique was shown to be less prone to outliers [45]. Likewise more recently new compartmental devices have been suggested as the new frontier in knee reconstructive surgery. As the matter of fact, these new implants, for instance the one used in isolated femoro-patella arthroplasty, have been proposed on the market according to a patient-specific criterion and a more conservative philosophy, based on an anatomical resurfacing of the knee, saving bones, ligaments, tissues and often using inlays techniques. Obviously, in order to solve any potential rotational problem in such anatomical implants new techniques should been considered like those ones based on PRG instrumentation [1,2], which however require new references and new acquisition methods. In detail, PRG design rests on preoperative imaging (computed tomography and magnetic resonance imaging) not common in traditional orthopedic clinical practice [3]. Proposed benefits of PRG encompass a decrease in operative time, instrument trays required, and the ability to preoperatively plan a patient's component size, position, and alignment. In addition, an improvement in postoperative mechanical alignment is expected, without violation of the intramedullary canal. On this purpose, our study should not only be correlated to classical total KR designs but to these implants, which constitute new challenging applications in knee reconstructive surgery driven by patient-specific design.

However, some recent studies conveyed criticisms [46–48] upon this approach regarding the pre-operative workflow, the surgical approach and the cost/benefit ratio with respect to traditional or even navigated surgery. As far as PRG design concerned, the preoperative workflow was criticized to be highly demanding in terms of radiological skills, data processing and required time [48]. The manual determination of the CL was shown to be highly variable both in images and surfaces [8,9]. As far as the surgery is concerned, the PRG-based approach, while avoiding additional alignment instruments, cannot deal with medio-lateral ligament balancing. Therefore, if a recut is needed, the surgeon must switch the technique to a traditional intervention with intramedullary instrumentation losing all the benefits of the PRG. This can be more likely in case of ligament laxity, which can be only roughly envisaged in the preoperative stage. Switching the traditional surgical technique is mandatory also when the osteophytes, which are generally removed during surgery, are not carefully considered at the PGR design stage. However, in resurfacing interventions, limited to one or even two compartments (e.g. Journey-Deuce implant by Smith&Nephew), where the anterior and posterior ligaments are spared, the use of personalized resection guides is of true benefit and automated planning systems can be utilized more extensively with surgical advantages [4,5,47].

In conclusion, the main contributions of the paper can be summarized as follows: (a) the mean-shift technique applied to the surface curvature facilitate the region clustering in the distal femur and by consequence the segmentation of the IF; (b) the anatomy of the IF can be consistently represented through a hyperbolic paraboloid; its shape parameters can be used to quantify and classify the IF morphology, and even evaluate deviations to normality; (c) the WL is approximated with the principal direction of the saddle shape; (d) the detection of the WL is reliable, more repeatable than that obtained through manual digitations, and also in agreement with clinical knowledge; (e) the overall technique is automatic, does not require any initialization and reduces the processing time with respect to time required by the expert operator. The reported methodological framework can be therefore considered feasible to be included into a computerized planning system of KR and extended to the design and model of PRG.

None of the authors have relevant conflicts of interest to declare.

In the basic representation, considering r data points 
                           
                              
                                 
                                    x
                                 
                                 i
                              
                              ∈
                              
                                 ℝ
                                 n
                              
                           
                        , the multivariate kernel density estimate using a kernel, F(x) is given by:
                           
                              (A1)
                              
                                 
                                    d
                                    (
                                    x
                                    )
                                    =
                                    
                                       1
                                       r
                                    
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       r
                                    
                                    
                                       
                                          1
                                          
                                             
                                                a
                                                i
                                                n
                                             
                                          
                                       
                                    
                                    F
                                    
                                       
                                          
                                             
                                                x
                                                −
                                                
                                                   x
                                                   i
                                                
                                             
                                             
                                                
                                                   a
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where a
                        
                           i
                        , termed bandwidth parameter and dependent on the ith point, defines the range of the kernel. Among different potential solutions, a constant bandwidth parameter a is usually heuristically chosen [34]. Traditionally, radial symmetric kernels are adopted as:
                           
                              (A2)
                              
                                 
                                    F
                                    (
                                    x
                                    )
                                    =
                                    p
                                    f
                                    (
                                    
                                       
                                          
                                             x
                                          
                                       
                                       2
                                    
                                    )
                                 
                              
                           
                        with p a normalization factor assuring that (x) integrates to 1. The most utilized kernels are the uniform, the Epanechnikov, the biweight, the Gaussian and the triangular. In particular, the following general function:
                           
                              (A3)
                              
                                 
                                    F
                                    (
                                    x
                                    ,
                                    c
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                (
                                                1
                                                −
                                                
                                                   x
                                                   2
                                                
                                                )
                                             
                                             c
                                          
                                       
                                       
                                          
                                             2
                                             
                                                2
                                                c
                                                +
                                                1
                                             
                                          
                                          B
                                          (
                                          c
                                          +
                                          1
                                          ,
                                          c
                                          +
                                          1
                                          )
                                       
                                    
                                     
                                    with
                                       
                                    B
                                    (
                                    u
                                    ,
                                    v
                                    )
                                    =
                                    
                                       
                                          Γ
                                          (
                                          u
                                          )
                                          Γ
                                          (
                                          v
                                          )
                                       
                                       
                                          Γ
                                          (
                                          u
                                          +
                                          v
                                          )
                                       
                                    
                                 
                              
                           
                        where 
                           
                              Γ
                              (
                              n
                              +
                              1
                              )
                              =
                              n
                              !
                           
                        , which holds for 
                           
                              {
                              
                                 x
                              
                              <
                              1
                              }
                           
                        , can be specialized in the uniform (c
                        =0), the Epanechnikov (c
                        =1), and the biweight (c
                        =2) kernels, respectively. The mean-shift algorithm requires the determination of the gradient of the density function estimator (Eq. (A3)). The mean-shift vector points toward the direction of the maximum increase in density and is proportional to the density gradient estimate at point x obtained with the kernel F.

In the curvature case, the feature space is a joint domain 
                           
                              Ω
                              =
                              {
                              (
                              v
                              ,
                              
                                 k
                                 C
                              
                              (
                              v
                              )
                              )
                              :
                              v
                              ∈
                              V
                              ,
                              
                                 k
                                 C
                              
                              ∈
                              K
                              }
                           
                         involving a 2D manifold constituted of the 3D coordinates of the vertices v (belonging to the vertex set V of the surface), and the 1D curvature k
                        
                           C
                         (spanning the curvature set K). A generalized bivariate mean-shift density function can be then defined as:
                           
                              (A4)
                              
                                 
                                    d
                                    (
                                    v
                                    ,
                                    
                                       k
                                       C
                                    
                                    (
                                    v
                                    )
                                    )
                                    =
                                    
                                       1
                                       
                                          r
                                          
                                             a
                                             2
                                          
                                          
                                             b
                                             2
                                          
                                       
                                    
                                    
                                       ∑
                                       
                                          
                                             v
                                             j
                                          
                                          ∈
                                          V
                                       
                                    
                                    
                                       
                                          F
                                          a
                                       
                                       
                                          
                                             
                                                
                                                   v
                                                   −
                                                   
                                                      v
                                                      j
                                                   
                                                
                                                a
                                             
                                          
                                       
                                       
                                          F
                                          b
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      k
                                                      C
                                                   
                                                   (
                                                   v
                                                   )
                                                   −
                                                   
                                                      k
                                                      C
                                                   
                                                   (
                                                   
                                                      v
                                                      j
                                                   
                                                   )
                                                
                                                b
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where F
                        
                           a
                         and F
                        
                           b
                         are the two kernel functions, a and b are the constant bandwidth parameters and r is the number of mesh vertices in the set V. Without losing generality, the kernel F
                        
                           a
                         can be setup to a flat function and the bandwidth parameter can be set to a constant, i.e. 
                           
                              
                                 F
                                 a
                              
                              (
                              x
                              )
                              =
                              1
                           
                         for 
                           
                              
                                 x
                              
                              ≤
                              t
                           
                         and 0 otherwise. Distance parameter t defines the bound of the kernel. For polygonal surfaces, such distance bound can be substituted by vertex neighborhood. The simplest neighborhood can be defined as the 1st order ring of vertices explicitly connected through edges in the surface topology to the current vertex v. Neighborhood rings of increasing order can be progressively considered to increase the smoothing effect of mean-shifting. Considering the assumption on kernel F
                        
                           a
                         and setting a
                        =2 (Eq. (A4)) simplifies further in:
                           
                              (A5)
                              
                                 
                                    d
                                    (
                                    
                                       k
                                       C
                                    
                                    (
                                    v
                                    )
                                    )
                                    =
                                    
                                       1
                                       
                                          4
                                          n
                                          b
                                       
                                    
                                    
                                       ∑
                                       
                                          
                                             v
                                             j
                                          
                                          ∈
                                          
                                             N
                                             V
                                          
                                          (
                                          v
                                          )
                                       
                                    
                                    
                                       
                                          F
                                          b
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      k
                                                      C
                                                   
                                                   (
                                                   v
                                                   )
                                                   −
                                                   
                                                      k
                                                      C
                                                   
                                                   (
                                                   
                                                      v
                                                      j
                                                   
                                                   )
                                                
                                                b
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 N
                                 V
                              
                           
                         represents the neighborhood set of n vertices in the neighborhood of the current vertex v.

Assuming that 
                           
                              
                                 F
                                 b
                              
                              =
                              p
                              
                                 f
                                 b
                              
                              (
                              
                                 
                                    
                                       x
                                    
                                 
                                 2
                              
                              )
                           
                         is a radial symmetric kernel (Eq. (A2)), the gradient of the curvature density of Eq. (A5) assumes the following shape:
                           
                              (A6)
                              
                                 
                                    ∇
                                    d
                                    (
                                    
                                       k
                                       C
                                    
                                    (
                                    v
                                    )
                                    )
                                    =
                                    p
                                    
                                       
                                          m
                                          (
                                          
                                             k
                                             C
                                          
                                          (
                                          v
                                          )
                                          )
                                       
                                       
                                          2
                                          n
                                          
                                             b
                                             3
                                          
                                       
                                    
                                    
                                       ∑
                                       
                                          
                                             v
                                             j
                                          
                                          ∈
                                          
                                             N
                                             V
                                          
                                          (
                                          v
                                          )
                                       
                                    
                                    
                                       
                                          g
                                          b
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  k
                                                                  C
                                                               
                                                               (
                                                               v
                                                               )
                                                               −
                                                               
                                                                  k
                                                                  C
                                                               
                                                               (
                                                               
                                                                  v
                                                                  j
                                                               
                                                               )
                                                            
                                                            b
                                                         
                                                      
                                                   
                                                
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 g
                                 b
                              
                              (
                              x
                              )
                              =
                              −
                              
                                 
                                    F
                                    ′
                                 
                                 b
                              
                              (
                              x
                              )
                           
                         and
                           
                              (A7)
                              
                                 
                                    m
                                    (
                                    
                                       k
                                       C
                                    
                                    (
                                    v
                                    )
                                    )
                                    =
                                    −
                                    
                                       k
                                       C
                                    
                                    (
                                    v
                                    )
                                    +
                                    
                                       
                                          
                                             ∑
                                             
                                                
                                                   v
                                                   j
                                                
                                                ∈
                                                
                                                   N
                                                   V
                                                
                                                (
                                                v
                                                )
                                             
                                          
                                          
                                             
                                                k
                                                C
                                             
                                             (
                                             
                                                v
                                                j
                                             
                                             )
                                             
                                                g
                                                b
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  k
                                                                  C
                                                               
                                                               (
                                                               v
                                                               )
                                                               −
                                                               
                                                                  k
                                                                  C
                                                               
                                                               (
                                                               
                                                                  v
                                                                  j
                                                               
                                                               )
                                                               /
                                                               b
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                             
                                                
                                                   v
                                                   j
                                                
                                                ∈
                                                
                                                   N
                                                   V
                                                
                                                (
                                                v
                                                )
                                             
                                          
                                          
                                             
                                                g
                                                b
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  k
                                                                  C
                                                               
                                                               (
                                                               v
                                                               )
                                                               −
                                                               
                                                                  k
                                                                  C
                                                               
                                                               (
                                                               
                                                                  v
                                                                  j
                                                               
                                                               )
                                                               /
                                                               b
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        is the mean-shifted curvature at the vertex v. The curvature 
                           
                              
                                 k
                                 C
                              
                              (
                              v
                              )
                           
                         is iteratively refined as:
                           
                              (A8)
                              
                                 
                                    
                                       k
                                       C
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    (
                                    v
                                    )
                                    =
                                    
                                       k
                                       C
                                       i
                                    
                                    (
                                    v
                                    )
                                    +
                                    m
                                    (
                                    
                                       k
                                       C
                                       i
                                    
                                    (
                                    v
                                    )
                                    )
                                 
                              
                           
                        until 
                           
                              
                                 
                                    
                                       k
                                       C
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    (
                                    v
                                    )
                                    −
                                    
                                       k
                                       C
                                       i
                                    
                                    (
                                    v
                                    )
                                 
                              
                           
                         is less than a user specified threshold 
                           ε
                        , which corresponds to a lower bound for the magnitude of the mean-shift vector. The regions of low-density values are of no interest for the feature space analysis and, in such regions, the mean-shift steps are large. Similarly, near local maxima the steps are small and the analysis more refined. The mean-shifted curvature algorithm thus is an adaptive gradient ascent method that further intensifies maxima and minima increasing the difference between convex and concave regions as well.

@&#REFERENCES@&#

